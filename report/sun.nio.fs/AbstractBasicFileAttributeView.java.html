<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>AbstractBasicFileAttributeView.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.nio.fs</a> &gt; <span class="el_source">AbstractBasicFileAttributeView.java</span></div><h1>AbstractBasicFileAttributeView.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2008, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.nio.fs;

import java.nio.file.attribute.*;
import java.util.*;
import java.io.IOException;

/**
 * Base implementation of BasicFileAttributeView
 */

abstract class AbstractBasicFileAttributeView
    implements BasicFileAttributeView, DynamicFileAttributeView
{
    private static final String SIZE_NAME = &quot;size&quot;;
    private static final String CREATION_TIME_NAME = &quot;creationTime&quot;;
    private static final String LAST_ACCESS_TIME_NAME = &quot;lastAccessTime&quot;;
    private static final String LAST_MODIFIED_TIME_NAME = &quot;lastModifiedTime&quot;;
    private static final String FILE_KEY_NAME = &quot;fileKey&quot;;
    private static final String IS_DIRECTORY_NAME = &quot;isDirectory&quot;;
    private static final String IS_REGULAR_FILE_NAME = &quot;isRegularFile&quot;;
    private static final String IS_SYMBOLIC_LINK_NAME = &quot;isSymbolicLink&quot;;
    private static final String IS_OTHER_NAME = &quot;isOther&quot;;

    // the names of the basic attributes
<span class="fc" id="L50">    static final Set&lt;String&gt; basicAttributeNames =</span>
<span class="fc" id="L51">        Util.newSet(SIZE_NAME,</span>
                    CREATION_TIME_NAME,
                    LAST_ACCESS_TIME_NAME,
                    LAST_MODIFIED_TIME_NAME,
                    FILE_KEY_NAME,
                    IS_DIRECTORY_NAME,
                    IS_REGULAR_FILE_NAME,
                    IS_SYMBOLIC_LINK_NAME,
                    IS_OTHER_NAME);

<span class="fc" id="L61">    protected AbstractBasicFileAttributeView() { }</span>

    @Override
    public String name() {
<span class="fc" id="L65">        return &quot;basic&quot;;</span>
    }

    @Override
    public void setAttribute(String attribute, Object value)
        throws IOException
    {
<span class="fc bfc" id="L72" title="All 2 branches covered.">        if (attribute.equals(LAST_MODIFIED_TIME_NAME)) {</span>
<span class="fc" id="L73">            setTimes((FileTime)value, null, null);</span>
<span class="fc" id="L74">            return;</span>
        }
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">        if (attribute.equals(LAST_ACCESS_TIME_NAME)) {</span>
<span class="nc" id="L77">            setTimes(null, (FileTime)value, null);</span>
<span class="nc" id="L78">            return;</span>
        }
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">        if (attribute.equals(CREATION_TIME_NAME)) {</span>
<span class="nc" id="L81">            setTimes(null, null, (FileTime)value);</span>
<span class="nc" id="L82">            return;</span>
        }
<span class="fc" id="L84">        throw new IllegalArgumentException(&quot;'&quot; + name() + &quot;:&quot; +</span>
            attribute + &quot;' not recognized&quot;);
    }

    /**
     * Used to build a map of attribute name/values.
     */
    static class AttributesBuilder {
<span class="fc" id="L92">        private Set&lt;String&gt; names = new HashSet&lt;&gt;();</span>
<span class="fc" id="L93">        private Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span>
        private boolean copyAll;

<span class="fc" id="L96">        private AttributesBuilder(Set&lt;String&gt; allowed, String[] requested) {</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">            for (String name: requested) {</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">                if (name.equals(&quot;*&quot;)) {</span>
<span class="fc" id="L99">                    copyAll = true;</span>
                } else {
<span class="fc bfc" id="L101" title="All 2 branches covered.">                    if (!allowed.contains(name))</span>
<span class="fc" id="L102">                        throw new IllegalArgumentException(&quot;'&quot; + name + &quot;' not recognized&quot;);</span>
<span class="fc" id="L103">                    names.add(name);</span>
                }
            }
<span class="fc" id="L106">        }</span>

        /**
         * Creates builder to build up a map of the matching attributes
         */
        static AttributesBuilder create(Set&lt;String&gt; allowed, String[] requested) {
<span class="fc" id="L112">            return new AttributesBuilder(allowed, requested);</span>
        }

        /**
         * Returns true if the attribute should be returned in the map
         */
        boolean match(String name) {
<span class="fc bfc" id="L119" title="All 4 branches covered.">            return copyAll || names.contains(name);</span>
        }

        void add(String name, Object value) {
<span class="fc" id="L123">            map.put(name, value);</span>
<span class="fc" id="L124">        }</span>

        /**
         * Returns the map. Discard all references to the AttributesBuilder
         * after invoking this method.
         */
        Map&lt;String,Object&gt; unmodifiableMap() {
<span class="fc" id="L131">            return Collections.unmodifiableMap(map);</span>
        }
    }

    /**
     * Invoked by readAttributes or sub-classes to add all matching basic
     * attributes to the builder
     */
    final void addRequestedBasicAttributes(BasicFileAttributes attrs,
                                           AttributesBuilder builder)
    {
<span class="fc bfc" id="L142" title="All 2 branches covered.">        if (builder.match(SIZE_NAME))</span>
<span class="fc" id="L143">            builder.add(SIZE_NAME, attrs.size());</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">        if (builder.match(CREATION_TIME_NAME))</span>
<span class="fc" id="L145">            builder.add(CREATION_TIME_NAME, attrs.creationTime());</span>
<span class="fc bfc" id="L146" title="All 2 branches covered.">        if (builder.match(LAST_ACCESS_TIME_NAME))</span>
<span class="fc" id="L147">            builder.add(LAST_ACCESS_TIME_NAME, attrs.lastAccessTime());</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">        if (builder.match(LAST_MODIFIED_TIME_NAME))</span>
<span class="fc" id="L149">            builder.add(LAST_MODIFIED_TIME_NAME, attrs.lastModifiedTime());</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">        if (builder.match(FILE_KEY_NAME))</span>
<span class="fc" id="L151">            builder.add(FILE_KEY_NAME, attrs.fileKey());</span>
<span class="fc bfc" id="L152" title="All 2 branches covered.">        if (builder.match(IS_DIRECTORY_NAME))</span>
<span class="fc" id="L153">            builder.add(IS_DIRECTORY_NAME, attrs.isDirectory());</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">        if (builder.match(IS_REGULAR_FILE_NAME))</span>
<span class="fc" id="L155">            builder.add(IS_REGULAR_FILE_NAME, attrs.isRegularFile());</span>
<span class="fc bfc" id="L156" title="All 2 branches covered.">        if (builder.match(IS_SYMBOLIC_LINK_NAME))</span>
<span class="fc" id="L157">            builder.add(IS_SYMBOLIC_LINK_NAME, attrs.isSymbolicLink());</span>
<span class="fc bfc" id="L158" title="All 2 branches covered.">        if (builder.match(IS_OTHER_NAME))</span>
<span class="fc" id="L159">            builder.add(IS_OTHER_NAME, attrs.isOther());</span>
<span class="fc" id="L160">    }</span>

    @Override
    public Map&lt;String,Object&gt; readAttributes(String[] requested)
        throws IOException
    {
<span class="fc" id="L166">        AttributesBuilder builder =</span>
<span class="fc" id="L167">            AttributesBuilder.create(basicAttributeNames, requested);</span>
<span class="fc" id="L168">        addRequestedBasicAttributes(readAttributes(), builder);</span>
<span class="fc" id="L169">        return builder.unmodifiableMap();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>