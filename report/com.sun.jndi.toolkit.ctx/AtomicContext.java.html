<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AtomicContext.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.jndi.toolkit.ctx</a> &gt; <span class="el_source">AtomicContext.java</span></div><h1>AtomicContext.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.jndi.toolkit.ctx;

import javax.naming.*;

/**
  * Clients: deal only with names for its own naming service
  * and deals with single contexts that can be built up into
  * hierarchical naming systems.
  * Direct subclasses of AtomicContext must provide implementations for
  * the abstract a_ Context methods, and c_parseComponent().
  *
  * If the subclass implements the notion of implicit nns,
  * it must override the a_*_nns Context methods as well.
  *
  * @author Rosanna Lee
  *
  */

public abstract class AtomicContext extends ComponentContext {
<span class="fc" id="L45">    private static int debug = 0;</span>

<span class="fc" id="L47">    protected AtomicContext () {</span>
<span class="fc" id="L48">        _contextType = _ATOMIC;</span>
<span class="fc" id="L49">    }</span>

// ------ Abstract methods whose implementation are provided by subclasses


    /* Equivalent to Context methods */
    protected abstract Object a_lookup(String name, Continuation cont)
        throws NamingException;
    protected abstract Object a_lookupLink(String name, Continuation cont)
        throws NamingException;

    protected abstract NamingEnumeration&lt;NameClassPair&gt; a_list(
        Continuation cont) throws NamingException;
    protected abstract NamingEnumeration&lt;Binding&gt; a_listBindings(
        Continuation cont) throws NamingException;
    protected abstract void a_bind(String name, Object obj, Continuation cont)
        throws NamingException;
    protected abstract void a_rebind(String name, Object obj, Continuation cont)
        throws NamingException;
    protected abstract void a_unbind(String name, Continuation cont)
        throws NamingException;
    protected abstract void a_destroySubcontext(String name, Continuation cont)
        throws NamingException;
    protected abstract Context a_createSubcontext(String name,
        Continuation cont) throws NamingException;
    protected abstract void a_rename(String oldname, Name newname,
        Continuation cont) throws NamingException;
    protected abstract NameParser a_getNameParser(Continuation cont)
        throws NamingException;

    /* Parsing */
    /**
     * Parse 'inputName' into two parts:
     * head: the first component in this name
     * tail: the rest of the unused name.
     *
     * Subclasses should provide an implementation for this method
     * which parses inputName using its own name syntax.
     */
    protected abstract StringHeadTail c_parseComponent(String inputName,
        Continuation cont) throws NamingException;


// ------ Methods that need to be overridden by subclass

    /* Resolution method for supporting federation */
    /**
      * Resolves the nns for 'name' when the named context is acting
      * as an intermediate context.
      *
      * For a system that supports junctions, this would be equilvalent to
      *         a_lookup(name, cont);
      * because for junctions, an intermediate slash simply signifies
      * a syntactic separator.
      *
      * For a system that supports implicit nns, this would be equivalent to
      *         a_lookup_nns(name, cont);
      * because for implicit nns, a slash always signifies the implicit nns,
      * regardless of whether it is intermediate or trailing.
      *
      * By default this method supports junctions, and also allows for an
      * implicit nns to be dynamically determined through the use of the
      * &quot;nns&quot; reference (see a_processJunction_nns()).
      * Contexts that implement implicit nns directly should provide an
      * appropriate override.
      */
    protected Object a_resolveIntermediate_nns(String name, Continuation cont)
        throws NamingException {
            try {
<span class="nc" id="L118">                final Object obj = a_lookup(name, cont);</span>

                // Do not append &quot;&quot; to Continuation 'cont' even if set
                // because the intention is to ignore the nns

                //
<span class="nc bnc" id="L124" title="All 4 branches missed.">                if (obj != null &amp;&amp; getClass().isInstance(obj)) {</span>
                    // If &quot;obj&quot; is in the same type as this object, it must
                    // not be a junction. Continue the lookup with &quot;/&quot;.

<span class="nc" id="L128">                    cont.setContinueNNS(obj, name, this);</span>
<span class="nc" id="L129">                    return null;</span>

<span class="nc bnc" id="L131" title="All 4 branches missed.">                } else if (obj != null &amp;&amp; !(obj instanceof Context)) {</span>
                    // obj is not even a context, so try to find its nns
                    // dynamically by constructing a Reference containing obj.
<span class="nc" id="L134">                    RefAddr addr = new RefAddr(&quot;nns&quot;) {</span>
                        public Object getContent() {
<span class="nc" id="L136">                            return obj;</span>
                        }
                        private static final long serialVersionUID =
                            -3399518522645918499L;
                    };
<span class="nc" id="L141">                    Reference ref = new Reference(&quot;java.lang.Object&quot;, addr);</span>

                    // Resolved name has trailing slash to indicate nns
<span class="nc" id="L144">                    CompositeName resName = new CompositeName();</span>
<span class="nc" id="L145">                    resName.add(name);</span>
<span class="nc" id="L146">                    resName.add(&quot;&quot;); // add trailing slash</span>

                    // Set continuation leave it to
                    // PartialCompositeContext.getPCContext() to throw CPE.
                    // Do not use setContinueNNS() because we've already
                    // consumed &quot;/&quot; (i.e., moved it to resName).

<span class="nc" id="L153">                    cont.setContinue(ref, resName, this);</span>
<span class="nc" id="L154">                    return null;</span>

                } else {
<span class="nc" id="L157">                    return obj;</span>
                }

<span class="nc" id="L160">            } catch (NamingException e) {</span>
<span class="nc" id="L161">                e.appendRemainingComponent(&quot;&quot;); // add nns back</span>
<span class="nc" id="L162">                throw e;</span>
            }
        }

    /* Equivalent of Context Methods for supporting nns */

    // The following methods are called when the DirContext methods
    // are invoked with a name that has a trailing slash.
    // For naming systems that support implicit nns,
    // the trailing slash signifies the implicit nns.
    // For such naming systems, override these a_*_nns methods.
    //
    // For naming systems that support junctions (explicit nns),
    // the trailing slash is meaningless because a junction does not
    // have an implicit nns.  The default implementation here
    // throws a NameNotFoundException for such names.
    // If a context wants to accept a trailing slash as having
    // the same meaning as the same name without a trailing slash,
    // then it should override these a_*_nns methods.


    protected Object a_lookup_nns(String name, Continuation cont)
        throws NamingException {
<span class="nc" id="L185">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L186">            return null;</span>
        }

    protected Object a_lookupLink_nns(String name, Continuation cont)
        throws NamingException {
<span class="nc" id="L191">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L192">            return null;</span>
        }

    protected NamingEnumeration&lt;NameClassPair&gt; a_list_nns(Continuation cont)
        throws NamingException {
<span class="nc" id="L197">            a_processJunction_nns(cont);</span>
<span class="nc" id="L198">            return null;</span>
        }
    protected NamingEnumeration&lt;Binding&gt; a_listBindings_nns(Continuation cont)
        throws NamingException {
<span class="nc" id="L202">            a_processJunction_nns(cont);</span>
<span class="nc" id="L203">            return null;</span>
        }

    protected void a_bind_nns(String name, Object obj, Continuation cont)
        throws NamingException {
<span class="nc" id="L208">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L209">        }</span>

    protected void a_rebind_nns(String name, Object obj, Continuation cont)
        throws NamingException {
<span class="nc" id="L213">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L214">        }</span>

    protected void a_unbind_nns(String name, Continuation cont)
        throws NamingException {
<span class="nc" id="L218">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L219">        }</span>

    protected Context a_createSubcontext_nns(String name, Continuation cont)
        throws NamingException {
<span class="nc" id="L223">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L224">            return null;</span>
        }

    protected void a_destroySubcontext_nns(String name, Continuation cont)
        throws NamingException {
<span class="nc" id="L229">            a_processJunction_nns(name, cont);</span>
<span class="nc" id="L230">        }</span>

    protected void a_rename_nns(String oldname, Name newname, Continuation cont)
        throws NamingException {
<span class="nc" id="L234">            a_processJunction_nns(oldname, cont);</span>
<span class="nc" id="L235">        }</span>

    protected NameParser a_getNameParser_nns(Continuation cont)
        throws NamingException {
<span class="nc" id="L239">            a_processJunction_nns(cont);</span>
<span class="nc" id="L240">            return null;</span>
        }



    protected boolean isEmpty(String name) {
<span class="nc bnc" id="L246" title="All 4 branches missed.">        return name == null || name.equals(&quot;&quot;);</span>
    }

// ------ implementations of c_  and c_*_nns methods using
// ------ the corresponding a_ and a_*_nns methods

    /* Equivalent to methods in  Context interface */

    protected Object c_lookup(Name name, Continuation cont)
        throws NamingException {
<span class="nc" id="L256">            Object ret = null;</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont)) {</span>
<span class="nc" id="L258">                ret = a_lookup(name.toString(), cont);</span>
<span class="nc bnc" id="L259" title="All 4 branches missed.">                if (ret != null &amp;&amp; ret instanceof LinkRef) {</span>
<span class="nc" id="L260">                    cont.setContinue(ret, name, this);</span>
<span class="nc" id="L261">                    ret = null;</span>
                }
            }
<span class="nc" id="L264">            return ret;</span>
        }

    protected Object c_lookupLink(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont)) {</span>
<span class="nc" id="L270">                return a_lookupLink(name.toString(), cont);</span>
            }
<span class="nc" id="L272">            return null;</span>
        }

    protected NamingEnumeration&lt;NameClassPair&gt; c_list(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L277" title="All 2 branches missed.">            if (resolve_to_context(name, cont)) {</span>
<span class="nc" id="L278">                return a_list(cont);</span>
            }
<span class="nc" id="L280">            return null;</span>
        }

    protected NamingEnumeration&lt;Binding&gt; c_listBindings(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L285" title="All 2 branches missed.">            if (resolve_to_context(name, cont)) {</span>
<span class="nc" id="L286">                return a_listBindings(cont);</span>
            }
<span class="nc" id="L288">            return null;</span>
        }

    protected void c_bind(Name name, Object obj, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L293" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont))</span>
<span class="nc" id="L294">                a_bind(name.toString(), obj, cont);</span>
<span class="nc" id="L295">        }</span>

    protected void c_rebind(Name name, Object obj, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L299" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont))</span>
<span class="nc" id="L300">                a_rebind(name.toString(), obj, cont);</span>
<span class="nc" id="L301">        }</span>

    protected void c_unbind(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L305" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont))</span>
<span class="nc" id="L306">                a_unbind(name.toString(), cont);</span>
<span class="nc" id="L307">        }</span>

    protected void c_destroySubcontext(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L311" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont))</span>
<span class="nc" id="L312">                a_destroySubcontext(name.toString(), cont);</span>
<span class="nc" id="L313">        }</span>

    protected Context c_createSubcontext(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L317" title="All 2 branches missed.">            if (resolve_to_penultimate_context(name, cont))</span>
<span class="nc" id="L318">                return a_createSubcontext(name.toString(), cont);</span>
            else
<span class="nc" id="L320">                return null;</span>
        }

    protected void c_rename(Name oldname, Name newname,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L325" title="All 2 branches missed.">            if (resolve_to_penultimate_context(oldname, cont))</span>
<span class="nc" id="L326">                 a_rename(oldname.toString(), newname, cont);</span>
<span class="nc" id="L327">        }</span>

    protected NameParser c_getNameParser(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L331" title="All 2 branches missed.">            if (resolve_to_context(name, cont))</span>
<span class="nc" id="L332">                return a_getNameParser(cont);</span>
<span class="nc" id="L333">            return null;</span>
        }

    /* The following are overridden only for AtomicContexts.
     * AtomicContext is used by PartialCompositeDirContext and ComponentDirContext
     * in the inheritance tree to make use of methods in
     * PartialCompositeContext and ComponentContext. We only want to use the
     * atomic forms when we're actually an atomic context.
     */

    /* From ComponentContext */

    protected Object c_resolveIntermediate_nns(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L347" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc" id="L348">                Object ret = null;</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont)) {</span>
<span class="nc" id="L350">                    ret = a_resolveIntermediate_nns(name.toString(), cont);</span>
<span class="nc bnc" id="L351" title="All 4 branches missed.">                    if (ret != null &amp;&amp; ret instanceof LinkRef) {</span>
<span class="nc" id="L352">                        cont.setContinue(ret, name, this);</span>
<span class="nc" id="L353">                        ret = null;</span>
                    }
                }
<span class="nc" id="L356">                return ret;</span>
            } else {
                // use ComponentContext
<span class="nc" id="L359">                return super.c_resolveIntermediate_nns(name, cont);</span>
            }
        }

    /* Equivalent to methods in Context interface for nns */

    protected Object c_lookup_nns(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L367" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc" id="L368">                Object ret = null;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont)) {</span>
<span class="nc" id="L370">                    ret = a_lookup_nns(name.toString(), cont);</span>
<span class="nc bnc" id="L371" title="All 4 branches missed.">                    if (ret != null &amp;&amp; ret instanceof LinkRef) {</span>
<span class="nc" id="L372">                        cont.setContinue(ret, name, this);</span>
<span class="nc" id="L373">                        ret = null;</span>
                    }
                }
<span class="nc" id="L376">                return ret;</span>
            } else {
<span class="nc" id="L378">                return super.c_lookup_nns(name, cont);</span>
            }
        }

    protected Object c_lookupLink_nns(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L384" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
                // %%% check logic
<span class="nc" id="L386">                resolve_to_nns_and_continue(name, cont);</span>
<span class="nc" id="L387">                return null;</span>
            } else {
                // use ComponentContext
<span class="nc" id="L390">                return super.c_lookupLink_nns(name, cont);</span>
            }
        }

    protected NamingEnumeration&lt;NameClassPair&gt; c_list_nns(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L396" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc" id="L397">                resolve_to_nns_and_continue(name, cont);</span>
<span class="nc" id="L398">                return null;</span>
            } else {
                // use ComponentContext
<span class="nc" id="L401">                return super.c_list_nns(name, cont);</span>
            }
        }

    protected NamingEnumeration&lt;Binding&gt; c_listBindings_nns(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L407" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc" id="L408">                resolve_to_nns_and_continue(name, cont);</span>
<span class="nc" id="L409">                return null;</span>
            } else {
                // use ComponentContext
<span class="nc" id="L412">                return super.c_listBindings_nns(name, cont);</span>
            }
        }

    protected void c_bind_nns(Name name, Object obj, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L418" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont))</span>
<span class="nc" id="L420">                    a_bind_nns(name.toString(), obj, cont);</span>
            } else {
                // use ComponentContext
<span class="nc" id="L423">                super.c_bind_nns(name, obj, cont);</span>
            }
<span class="nc" id="L425">        }</span>

    protected void c_rebind_nns(Name name, Object obj, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont))</span>
<span class="nc" id="L431">                    a_rebind_nns(name.toString(), obj, cont);</span>
            } else {
                // use ComponentContext
<span class="nc" id="L434">                super.c_rebind_nns(name, obj, cont);</span>
            }
<span class="nc" id="L436">        }</span>

    protected void c_unbind_nns(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L440" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont))</span>
<span class="nc" id="L442">                    a_unbind_nns(name.toString(), cont);</span>
            } else {
                // use ComponentContext
<span class="nc" id="L445">                super.c_unbind_nns(name, cont);</span>
            }
<span class="nc" id="L447">        }</span>

    protected Context c_createSubcontext_nns(Name name,
        Continuation cont) throws NamingException {
<span class="nc bnc" id="L451" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont))</span>
<span class="nc" id="L453">                    return a_createSubcontext_nns(name.toString(), cont);</span>
                else
<span class="nc" id="L455">                    return null;</span>
            } else {
                // use ComponentContext
<span class="nc" id="L458">                return super.c_createSubcontext_nns(name, cont);</span>
            }
        }

    protected void c_destroySubcontext_nns(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L464" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(name, cont))</span>
<span class="nc" id="L466">                    a_destroySubcontext_nns(name.toString(), cont);</span>
            } else {
                // use ComponentContext
<span class="nc" id="L469">                super.c_destroySubcontext_nns(name, cont);</span>
            }
<span class="nc" id="L471">        }</span>

    protected void c_rename_nns(Name oldname, Name newname, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L475" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">                if (resolve_to_penultimate_context_nns(oldname, cont))</span>
<span class="nc" id="L477">                    a_rename_nns(oldname.toString(), newname, cont);</span>
            } else {
                // use ComponentContext
<span class="nc" id="L480">                super.c_rename_nns(oldname, newname, cont);</span>
            }
<span class="nc" id="L482">        }</span>

    protected NameParser c_getNameParser_nns(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L486" title="All 2 branches missed.">            if (_contextType == _ATOMIC) {</span>
<span class="nc" id="L487">                resolve_to_nns_and_continue(name, cont);</span>
<span class="nc" id="L488">                return null;</span>
            } else {
                // use COmponentContext
<span class="nc" id="L491">                return super.c_getNameParser_nns(name, cont);</span>
            }
        }

// --------------    internal methods used by this class

    /* Handles nns for junctions */
    /**
      * This function is used when implementing a naming system that
      * supports junctions.  For example, when the a_bind_nns(name, newobj)
      * method is invoked, that means the caller is attempting to bind the
      * object 'newobj' to the nns of 'name'.  For context that supports
      * junctions, 'name' names a junction and is pointing to the root
      * of another naming system, which in turn might have an nns.
      * This means that a_bind_nns() should first resolve 'name' and attempt to
      * continue the operation in the context named by 'name'.  (i.e. bind
      * to the nns of the context named by 'name').
      * If name is already empty, then throw NameNotFoundException because
      * this context by default does not have any nns.
      */
    protected void a_processJunction_nns(String name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L513" title="All 2 branches missed.">            if (name.equals(&quot;&quot;)) {</span>
<span class="nc" id="L514">                NameNotFoundException e = new NameNotFoundException();</span>
<span class="nc" id="L515">                cont.setErrorNNS(this, name);</span>
<span class="nc" id="L516">                throw cont.fillInException(e);</span>
            }
            try {
                // lookup name to continue operation in nns
<span class="nc" id="L520">                Object target = a_lookup(name, cont);</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">                if (cont.isContinue())</span>
<span class="nc" id="L522">                    cont.appendRemainingComponent(&quot;&quot;);  // add nns back</span>
                else {
<span class="nc" id="L524">                    cont.setContinueNNS(target, name, this);</span>
                }
<span class="nc" id="L526">            } catch (NamingException e) {</span>
<span class="nc" id="L527">                e.appendRemainingComponent(&quot;&quot;); // add nns back</span>
<span class="nc" id="L528">                throw e;</span>
<span class="nc" id="L529">            }</span>
<span class="nc" id="L530">        }</span>

    /**
      * This function is used when implementing a naming system that
      * supports junctions.  For example, when the a_list_nns(newobj)
      * method is invoked, that means the caller is attempting to list the
      * the nns context of of this context.  For a context that supports
      * junctions, it by default does not have any nns.  Consequently,
      * a NameNotFoundException is thrown.
      */
    protected void a_processJunction_nns(Continuation cont) throws NamingException {

        // Construct a new Reference that contains this context.
<span class="nc" id="L543">        RefAddr addr = new RefAddr(&quot;nns&quot;) {</span>
            public Object getContent() {
<span class="nc" id="L545">                return AtomicContext.this;</span>
            }
            private static final long serialVersionUID = 3449785852664978312L;
        };
<span class="nc" id="L549">        Reference ref = new Reference(&quot;java.lang.Object&quot;, addr);</span>

        // Set continuation leave it to PartialCompositeContext.getPCContext()
        // to throw the exception.
        // Do not use setContinueNNS() because we've are
        // setting relativeResolvedName to &quot;/&quot;.
<span class="nc" id="L555">        cont.setContinue(ref, _NNS_NAME, this);</span>
<span class="nc" id="L556">    }</span>

    /* *********** core resolution routines ******************* */

    /** Resolve to context named by 'name'.
      * Returns true if at named context (i.e. 'name' is empty name).
      * Returns false otherwise, and sets Continuation on parts of 'name'
      * not yet resolved.
      */
    protected boolean resolve_to_context(Name name, Continuation cont)
    throws NamingException {
<span class="nc" id="L567">        String target = name.toString();</span>


<span class="nc" id="L570">        StringHeadTail ht = c_parseComponent(target, cont);</span>
<span class="nc" id="L571">        String tail = ht.getTail();</span>
<span class="nc" id="L572">        String head = ht.getHead();</span>

<span class="nc bnc" id="L574" title="All 2 branches missed.">        if (debug &gt; 0)</span>
<span class="nc" id="L575">            System.out.println(&quot;RESOLVE TO CONTEXT(&quot; + target + &quot;) = {&quot; +</span>
                               head + &quot;, &quot; + tail + &quot;}&quot;);

<span class="nc bnc" id="L578" title="All 2 branches missed.">        if (head == null) {</span>
            // something is wrong; no name at all
<span class="nc" id="L580">            InvalidNameException e = new InvalidNameException();</span>
<span class="nc" id="L581">            throw cont.fillInException(e);</span>
        }
<span class="nc bnc" id="L583" title="All 2 branches missed.">        if (!isEmpty(head)) {</span>
            // if there is head is a non-empty name
            // this means more resolution to be done
            try {
<span class="nc" id="L587">                Object headCtx = a_lookup(head, cont);</span>
//              System.out.println(&quot;answer &quot; + headCtx);
<span class="nc bnc" id="L589" title="All 2 branches missed.">                if (headCtx != null)</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                    cont.setContinue(headCtx, head, this, (tail == null ? &quot;&quot; : tail));</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">                else if (cont.isContinue())</span>
<span class="nc" id="L592">                    cont.appendRemainingComponent(tail);</span>
<span class="nc" id="L593">            } catch (NamingException e) {</span>
<span class="nc" id="L594">                e.appendRemainingComponent(tail);</span>
<span class="nc" id="L595">                throw e;</span>
<span class="nc" id="L596">            }</span>
        } else {
<span class="nc" id="L598">            cont.setSuccess();  // clear</span>
<span class="nc" id="L599">            return true;</span>
        }
<span class="nc" id="L601">        return false;</span>
    }

    /**
      * Resolves to penultimate context named by 'name'.
      * Returns true if penultimate context has been reached (i.e. name
      * only has one atomic component left).
      * Returns false otherwise, and sets Continuation to parts of name
      * not yet resolved.
      */
    protected boolean resolve_to_penultimate_context(Name name, Continuation cont)
    throws NamingException {
<span class="nc" id="L613">        String target = name.toString();</span>

<span class="nc bnc" id="L615" title="All 2 branches missed.">        if (debug &gt; 0)</span>
<span class="nc" id="L616">            System.out.println(&quot;RESOLVE TO PENULTIMATE&quot; + target);</span>

<span class="nc" id="L618">        StringHeadTail ht = c_parseComponent(target, cont);</span>
<span class="nc" id="L619">        String tail = ht.getTail();</span>
<span class="nc" id="L620">        String head = ht.getHead();</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">        if (head == null) {</span>
            // something is wrong; no name at all
<span class="nc" id="L623">            InvalidNameException e = new InvalidNameException();</span>
<span class="nc" id="L624">            throw cont.fillInException(e);</span>
        }

<span class="nc bnc" id="L627" title="All 2 branches missed.">        if (!isEmpty(tail)) {</span>
            // more components; hence not at penultimate context yet
            try {
<span class="nc" id="L630">                Object headCtx = a_lookup(head, cont);</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">                if (headCtx != null)</span>
<span class="nc" id="L632">                    cont.setContinue(headCtx, head, this, tail);</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">                else if (cont.isContinue())</span>
<span class="nc" id="L634">                    cont.appendRemainingComponent(tail);</span>
<span class="nc" id="L635">            } catch (NamingException e) {</span>
<span class="nc" id="L636">                e.appendRemainingComponent(tail);</span>
<span class="nc" id="L637">                throw e;</span>
<span class="nc" id="L638">            }</span>
        } else {
            // already at penultimate context
<span class="nc" id="L641">            cont.setSuccess();  // clear</span>
<span class="nc" id="L642">            return true;</span>
        }
<span class="nc" id="L644">        return false;</span>
    }

    /**
      * This function is similar to resolve_to_penultimate_context()
      * except it should only be called by the nns() functions.
      * This function fixes any exception or continuations so that
      * it will have the proper nns name.
      */
    protected boolean resolve_to_penultimate_context_nns(Name name,
                                                         Continuation cont)
        throws NamingException {
            try {
<span class="nc bnc" id="L657" title="All 2 branches missed.">        if (debug &gt; 0)</span>
<span class="nc" id="L658">            System.out.println(&quot;RESOLVE TO PENULTIMATE NNS&quot; + name.toString());</span>
<span class="nc" id="L659">                boolean answer = resolve_to_penultimate_context(name, cont);</span>

                // resolve_to_penultimate_context() only calls a_lookup().
                // Any continuation it sets is lacking the nns, so
                // we need to add it back
<span class="nc bnc" id="L664" title="All 2 branches missed.">                if (cont.isContinue())</span>
<span class="nc" id="L665">                    cont.appendRemainingComponent(&quot;&quot;);</span>

<span class="nc" id="L667">                return answer;</span>
<span class="nc" id="L668">            } catch (NamingException e) {</span>
                // resolve_to_penultimate_context() only calls a_lookup().
                // Any exceptions it throws is lacking the nns, so
                // we need to add it back.
<span class="nc" id="L672">                e.appendRemainingComponent(&quot;&quot;);</span>
<span class="nc" id="L673">                throw e;</span>
            }
        }

    /**
      * Resolves to nns associated with 'name' and set Continuation
      * to the result.
      */
    protected void resolve_to_nns_and_continue(Name name, Continuation cont)
        throws NamingException {
<span class="nc bnc" id="L683" title="All 2 branches missed.">        if (debug &gt; 0)</span>
<span class="nc" id="L684">            System.out.println(&quot;RESOLVE TO NNS AND CONTINUE&quot; + name.toString());</span>

<span class="nc bnc" id="L686" title="All 2 branches missed.">        if (resolve_to_penultimate_context_nns(name, cont)) {</span>
<span class="nc" id="L687">            Object nns = a_lookup_nns(name.toString(), cont);</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">            if (nns != null)</span>
<span class="nc" id="L689">                cont.setContinue(nns, name, this);</span>
        }
<span class="nc" id="L691">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>