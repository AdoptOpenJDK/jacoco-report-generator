<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>PartialCompositeContext.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.jndi.toolkit.ctx</a> &gt; <span class="el_source">PartialCompositeContext.java</span></div><h1>PartialCompositeContext.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.jndi.toolkit.ctx;

import java.util.Hashtable;
import java.util.Enumeration;

import javax.naming.*;
import javax.naming.spi.Resolver;
import javax.naming.spi.ResolveResult;
import javax.naming.spi.NamingManager;

/**
  * PartialCompositeContext implements Context operations on
  * composite names using implementations of the p_ interfaces
  * defined by its subclasses.
  *
  * The main purpose provided by this class is that it deals with
  * partial resolutions and continuations, so that callers of the
  * Context operation don't have to.
  *
  * Types of clients that will be direct subclasses of
  * PartialCompositeContext may be service providers that implement
  * one of the JNDI protocols, but which do not deal with
  * continuations.  Usually, service providers will be using
  * one of the subclasses of PartialCompositeContext.
  *
  * @author Rosanna Lee
  */


public abstract class PartialCompositeContext implements Context, Resolver {
    protected static final int _PARTIAL = 1;
    protected static final int _COMPONENT = 2;
    protected static final int _ATOMIC = 3;

<span class="fc" id="L60">    protected int _contextType = _PARTIAL;</span>

<span class="fc" id="L62">    static final CompositeName _EMPTY_NAME = new CompositeName();</span>
    static CompositeName _NNS_NAME;

    static {
        try {
<span class="fc" id="L67">            _NNS_NAME = new CompositeName(&quot;/&quot;);</span>
<span class="nc" id="L68">        } catch (InvalidNameException e) {</span>
            // Should never happen
<span class="fc" id="L70">        }</span>
<span class="fc" id="L71">    }</span>

<span class="fc" id="L73">    protected PartialCompositeContext() {</span>
<span class="fc" id="L74">    }</span>

// ------ Abstract methods whose implementations come from subclasses

    /* Equivalent to method in  Resolver interface */
    protected abstract ResolveResult p_resolveToClass(Name name,
        Class&lt;?&gt; contextType, Continuation cont) throws NamingException;

    /* Equivalent to methods in Context interface */
    protected abstract Object p_lookup(Name name, Continuation cont)
        throws NamingException;
    protected abstract Object p_lookupLink(Name name, Continuation cont)
        throws NamingException;
    protected abstract NamingEnumeration&lt;NameClassPair&gt; p_list(Name name,
        Continuation cont) throws NamingException;
    protected abstract NamingEnumeration&lt;Binding&gt; p_listBindings(Name name,
        Continuation cont) throws NamingException;
    protected abstract void p_bind(Name name, Object obj, Continuation cont)
        throws NamingException;
    protected abstract void p_rebind(Name name, Object obj, Continuation cont)
        throws NamingException;
    protected abstract void p_unbind(Name name, Continuation cont)
        throws NamingException;
    protected abstract void p_destroySubcontext(Name name, Continuation cont)
        throws NamingException;
    protected abstract Context p_createSubcontext(Name name, Continuation cont)
        throws NamingException;
    protected abstract void p_rename(Name oldname, Name newname,
                                     Continuation cont)
        throws NamingException;
    protected abstract NameParser p_getNameParser(Name name, Continuation cont)
        throws NamingException;

// ------ should be overridden by subclass;
// ------ not abstract only for backward compatibility

    /**
     * A cheap way of getting the environment.
     * Default implementation is NOT cheap because it simply calls
     * getEnvironment(), which most implementations clone before returning.
     * Subclass should ALWAYS override this with the cheapest possible way.
     * The toolkit knows to clone when necessary.
     * @return The possibly null environment of the context.
     */
    protected Hashtable&lt;?,?&gt; p_getEnvironment() throws NamingException {
<span class="nc" id="L119">        return getEnvironment();</span>
    }


// ------ implementations of methods in Resolver and Context
// ------ using corresponding p_ methods provided by subclass

    /* implementations for method in Resolver interface using p_ method */

    public ResolveResult resolveToClass(String name,
                                        Class&lt;? extends Context&gt; contextType)
        throws NamingException
    {
<span class="nc" id="L132">        return resolveToClass(new CompositeName(name), contextType);</span>
    }

    public ResolveResult resolveToClass(Name name,
                                        Class&lt;? extends Context&gt; contextType)
        throws NamingException
    {
<span class="nc" id="L139">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L140">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L141">        Continuation cont = new Continuation(name, env);</span>
        ResolveResult answer;
<span class="nc" id="L143">        Name nm = name;</span>

        try {
<span class="nc" id="L146">            answer = ctx.p_resolveToClass(nm, contextType, cont);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L148">                nm = cont.getRemainingName();</span>
<span class="nc" id="L149">                ctx = getPCContext(cont);</span>
<span class="nc" id="L150">                answer = ctx.p_resolveToClass(nm, contextType, cont);</span>
            }
<span class="nc" id="L152">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L153">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            if (!(cctx instanceof Resolver)) {</span>
<span class="nc" id="L155">                throw e;</span>
            }
<span class="nc" id="L157">            answer = ((Resolver)cctx).resolveToClass(e.getRemainingName(),</span>
                                                     contextType);
<span class="nc" id="L159">        }</span>
<span class="nc" id="L160">        return answer;</span>
    }

    /* implementations for methods in Context interface using p_ methods */

    public Object lookup(String name) throws NamingException {
<span class="nc" id="L166">        return lookup(new CompositeName(name));</span>
    }

    public Object lookup(Name name) throws NamingException {
<span class="nc" id="L170">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L171">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L172">        Continuation cont = new Continuation(name, env);</span>
        Object answer;
<span class="nc" id="L174">        Name nm = name;</span>

        try {
<span class="nc" id="L177">            answer = ctx.p_lookup(nm, cont);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L179">                nm = cont.getRemainingName();</span>
<span class="nc" id="L180">                ctx = getPCContext(cont);</span>
<span class="nc" id="L181">                answer = ctx.p_lookup(nm, cont);</span>
            }
<span class="nc" id="L183">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L184">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L185">            answer = cctx.lookup(e.getRemainingName());</span>
<span class="nc" id="L186">        }</span>
<span class="nc" id="L187">        return answer;</span>
    }

    public void bind(String name, Object newObj) throws NamingException {
<span class="nc" id="L191">        bind(new CompositeName(name), newObj);</span>
<span class="nc" id="L192">    }</span>

    public void bind(Name name, Object newObj) throws NamingException {
<span class="nc" id="L195">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L196">        Name nm = name;</span>
<span class="nc" id="L197">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L198">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L201">            ctx.p_bind(nm, newObj, cont);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L203">                nm = cont.getRemainingName();</span>
<span class="nc" id="L204">                ctx = getPCContext(cont);</span>
<span class="nc" id="L205">                ctx.p_bind(nm, newObj, cont);</span>
            }
<span class="nc" id="L207">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L208">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L209">            cctx.bind(e.getRemainingName(), newObj);</span>
<span class="nc" id="L210">        }</span>
<span class="nc" id="L211">    }</span>

    public void rebind(String name, Object newObj) throws NamingException {
<span class="nc" id="L214">        rebind(new CompositeName(name), newObj);</span>
<span class="nc" id="L215">    }</span>
    public void rebind(Name name, Object newObj) throws NamingException {
<span class="nc" id="L217">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L218">        Name nm = name;</span>
<span class="nc" id="L219">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L220">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L223">            ctx.p_rebind(nm, newObj, cont);</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L225">                nm = cont.getRemainingName();</span>
<span class="nc" id="L226">                ctx = getPCContext(cont);</span>
<span class="nc" id="L227">                ctx.p_rebind(nm, newObj, cont);</span>
            }
<span class="nc" id="L229">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L230">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L231">            cctx.rebind(e.getRemainingName(), newObj);</span>
<span class="nc" id="L232">        }</span>
<span class="nc" id="L233">    }</span>

    public void unbind(String name) throws NamingException {
<span class="nc" id="L236">        unbind(new CompositeName(name));</span>
<span class="nc" id="L237">    }</span>
    public void unbind(Name name) throws NamingException {
<span class="nc" id="L239">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L240">        Name nm = name;</span>
<span class="nc" id="L241">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L242">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L245">            ctx.p_unbind(nm, cont);</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L247">                nm = cont.getRemainingName();</span>
<span class="nc" id="L248">                ctx = getPCContext(cont);</span>
<span class="nc" id="L249">                ctx.p_unbind(nm, cont);</span>
            }
<span class="nc" id="L251">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L252">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L253">            cctx.unbind(e.getRemainingName());</span>
<span class="nc" id="L254">        }</span>
<span class="nc" id="L255">    }</span>

    public void rename(String oldName, String newName) throws NamingException {
<span class="nc" id="L258">        rename(new CompositeName(oldName), new CompositeName(newName));</span>
<span class="nc" id="L259">    }</span>
    public void rename(Name oldName, Name newName)
        throws NamingException
    {
<span class="nc" id="L263">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L264">        Name nm = oldName;</span>
<span class="nc" id="L265">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L266">        Continuation cont = new Continuation(oldName, env);</span>

        try {
<span class="nc" id="L269">            ctx.p_rename(nm, newName, cont);</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L271">                nm = cont.getRemainingName();</span>
<span class="nc" id="L272">                ctx = getPCContext(cont);</span>
<span class="nc" id="L273">                ctx.p_rename(nm, newName, cont);</span>
            }
<span class="nc" id="L275">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L276">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">            if (e.getRemainingNewName() != null) {</span>
                // %%% e.getRemainingNewName() should never be null
<span class="nc" id="L279">                newName = e.getRemainingNewName();</span>
            }
<span class="nc" id="L281">            cctx.rename(e.getRemainingName(), newName);</span>
<span class="nc" id="L282">        }</span>
<span class="nc" id="L283">    }</span>

    public NamingEnumeration&lt;NameClassPair&gt; list(String name)
        throws NamingException
    {
<span class="nc" id="L288">        return list(new CompositeName(name));</span>
    }

    public NamingEnumeration&lt;NameClassPair&gt; list(Name name)
        throws NamingException
    {
<span class="nc" id="L294">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L295">        Name nm = name;</span>
        NamingEnumeration&lt;NameClassPair&gt; answer;
<span class="nc" id="L297">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L298">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L301">            answer = ctx.p_list(nm, cont);</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L303">                nm = cont.getRemainingName();</span>
<span class="nc" id="L304">                ctx = getPCContext(cont);</span>
<span class="nc" id="L305">                answer = ctx.p_list(nm, cont);</span>
            }
<span class="nc" id="L307">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L308">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L309">            answer = cctx.list(e.getRemainingName());</span>
<span class="nc" id="L310">        }</span>
<span class="nc" id="L311">        return answer;</span>
    }

    public NamingEnumeration&lt;Binding&gt; listBindings(String name)
        throws NamingException
    {
<span class="nc" id="L317">        return listBindings(new CompositeName(name));</span>
    }

    public NamingEnumeration&lt;Binding&gt; listBindings(Name name)
        throws NamingException
    {
<span class="nc" id="L323">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L324">        Name nm = name;</span>
        NamingEnumeration&lt;Binding&gt; answer;
<span class="nc" id="L326">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L327">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L330">            answer = ctx.p_listBindings(nm, cont);</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L332">                nm = cont.getRemainingName();</span>
<span class="nc" id="L333">                ctx = getPCContext(cont);</span>
<span class="nc" id="L334">                answer = ctx.p_listBindings(nm, cont);</span>
            }
<span class="nc" id="L336">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L337">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L338">            answer = cctx.listBindings(e.getRemainingName());</span>
<span class="nc" id="L339">        }</span>
<span class="nc" id="L340">        return answer;</span>
    }

    public void destroySubcontext(String name) throws NamingException {
<span class="nc" id="L344">        destroySubcontext(new CompositeName(name));</span>
<span class="nc" id="L345">    }</span>

    public void destroySubcontext(Name name) throws NamingException {
<span class="nc" id="L348">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L349">        Name nm = name;</span>
<span class="nc" id="L350">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L351">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L354">            ctx.p_destroySubcontext(nm, cont);</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L356">                nm = cont.getRemainingName();</span>
<span class="nc" id="L357">                ctx = getPCContext(cont);</span>
<span class="nc" id="L358">                ctx.p_destroySubcontext(nm, cont);</span>
            }
<span class="nc" id="L360">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L361">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L362">            cctx.destroySubcontext(e.getRemainingName());</span>
<span class="nc" id="L363">        }</span>
<span class="nc" id="L364">    }</span>

    public Context createSubcontext(String name) throws NamingException {
<span class="nc" id="L367">        return createSubcontext(new CompositeName(name));</span>
    }

    public Context createSubcontext(Name name) throws NamingException {
<span class="nc" id="L371">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L372">        Name nm = name;</span>
        Context answer;
<span class="nc" id="L374">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L375">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L378">            answer = ctx.p_createSubcontext(nm, cont);</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L380">                nm = cont.getRemainingName();</span>
<span class="nc" id="L381">                ctx = getPCContext(cont);</span>
<span class="nc" id="L382">                answer = ctx.p_createSubcontext(nm, cont);</span>
            }
<span class="nc" id="L384">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L385">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L386">            answer = cctx.createSubcontext(e.getRemainingName());</span>
<span class="nc" id="L387">        }</span>
<span class="nc" id="L388">        return answer;</span>
    }

    public Object lookupLink(String name) throws NamingException {
<span class="nc" id="L392">        return lookupLink(new CompositeName(name));</span>
    }

    public Object lookupLink(Name name) throws NamingException {
<span class="nc" id="L396">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L397">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L398">        Continuation cont = new Continuation(name, env);</span>
        Object answer;
<span class="nc" id="L400">        Name nm = name;</span>

        try {
<span class="nc" id="L403">            answer = ctx.p_lookupLink(nm, cont);</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L405">                nm = cont.getRemainingName();</span>
<span class="nc" id="L406">                ctx = getPCContext(cont);</span>
<span class="nc" id="L407">                answer = ctx.p_lookupLink(nm, cont);</span>
            }
<span class="nc" id="L409">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L410">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L411">            answer = cctx.lookupLink(e.getRemainingName());</span>
<span class="nc" id="L412">        }</span>
<span class="nc" id="L413">        return answer;</span>
    }

    public NameParser getNameParser(String name) throws NamingException {
<span class="nc" id="L417">        return getNameParser(new CompositeName(name));</span>
    }

    public NameParser getNameParser(Name name) throws NamingException {
<span class="nc" id="L421">        PartialCompositeContext ctx = this;</span>
<span class="nc" id="L422">        Name nm = name;</span>
        NameParser answer;
<span class="nc" id="L424">        Hashtable&lt;?,?&gt; env = p_getEnvironment();</span>
<span class="nc" id="L425">        Continuation cont = new Continuation(name, env);</span>

        try {
<span class="nc" id="L428">            answer = ctx.p_getNameParser(nm, cont);</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">            while (cont.isContinue()) {</span>
<span class="nc" id="L430">                nm = cont.getRemainingName();</span>
<span class="nc" id="L431">                ctx = getPCContext(cont);</span>
<span class="nc" id="L432">                answer = ctx.p_getNameParser(nm, cont);</span>
            }
<span class="nc" id="L434">        } catch (CannotProceedException e) {</span>
<span class="nc" id="L435">            Context cctx = NamingManager.getContinuationContext(e);</span>
<span class="nc" id="L436">            answer = cctx.getNameParser(e.getRemainingName());</span>
<span class="nc" id="L437">        }</span>
<span class="nc" id="L438">        return answer;</span>
    }

    public String composeName(String name, String prefix)
            throws NamingException {
<span class="nc" id="L443">        Name fullName = composeName(new CompositeName(name),</span>
                                    new CompositeName(prefix));
<span class="nc" id="L445">        return fullName.toString();</span>
    }

    /**
     * This default implementation simply concatenates the two names.
     * There's one twist when the &quot;java.naming.provider.compose.elideEmpty&quot;
     * environment setting is set to &quot;true&quot;:  if each name contains a
     * nonempty component, and if 'prefix' ends with an empty component or
     * 'name' starts with one, then one empty component is dropped.
     * For example:
     * &lt;pre&gt;
     *                            elideEmpty=false     elideEmpty=true
     * {&quot;a&quot;} + {&quot;b&quot;}          =&gt;  {&quot;a&quot;, &quot;b&quot;}           {&quot;a&quot;, &quot;b&quot;}
     * {&quot;a&quot;} + {&quot;&quot;}           =&gt;  {&quot;a&quot;, &quot;&quot;}            {&quot;a&quot;, &quot;&quot;}
     * {&quot;a&quot;} + {&quot;&quot;, &quot;b&quot;}      =&gt;  {&quot;a&quot;, &quot;&quot;, &quot;b&quot;}       {&quot;a&quot;, &quot;b&quot;}
     * {&quot;a&quot;, &quot;&quot;} + {&quot;b&quot;, &quot;&quot;}  =&gt;  {&quot;a&quot;, &quot;&quot;, &quot;b&quot;, &quot;&quot;}   {&quot;a&quot;, &quot;b&quot;, &quot;&quot;}
     * {&quot;a&quot;, &quot;&quot;} + {&quot;&quot;, &quot;b&quot;}  =&gt;  {&quot;a&quot;, &quot;&quot;, &quot;&quot;, &quot;b&quot;}   {&quot;a&quot;, &quot;&quot;, &quot;b&quot;}
     * &lt;/pre&gt;
     */
    public Name composeName(Name name, Name prefix) throws NamingException {
<span class="nc" id="L465">        Name res = (Name)prefix.clone();</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">        if (name == null) {</span>
<span class="nc" id="L467">            return res;</span>
        }
<span class="nc" id="L469">        res.addAll(name);</span>

<span class="nc" id="L471">        String elide = (String)</span>
<span class="nc" id="L472">            p_getEnvironment().get(&quot;java.naming.provider.compose.elideEmpty&quot;);</span>
<span class="nc bnc" id="L473" title="All 4 branches missed.">        if (elide == null || !elide.equalsIgnoreCase(&quot;true&quot;)) {</span>
<span class="nc" id="L474">            return res;</span>
        }

<span class="nc" id="L477">        int len = prefix.size();</span>

<span class="nc bnc" id="L479" title="All 4 branches missed.">        if (!allEmpty(prefix) &amp;&amp; !allEmpty(name)) {</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (res.get(len - 1).equals(&quot;&quot;)) {</span>
<span class="nc" id="L481">                res.remove(len - 1);</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">            } else if (res.get(len).equals(&quot;&quot;)) {</span>
<span class="nc" id="L483">                res.remove(len);</span>
            }
        }
<span class="nc" id="L486">        return res;</span>
    }


// ------ internal methods used by PartialCompositeContext

    /**
     * Tests whether a name contains a nonempty component.
     */
    protected static boolean allEmpty(Name name) {
<span class="nc" id="L496">        Enumeration&lt;String&gt; enum_ = name.getAll();</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">        while (enum_.hasMoreElements()) {</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">            if (!enum_.nextElement().isEmpty()) {</span>
<span class="nc" id="L499">                return false;</span>
            }
        }
<span class="nc" id="L502">        return true;</span>
    }

    /**
     * Retrieves a PartialCompositeContext for the resolved object in
     * cont.  Throws CannotProceedException if not successful.
     */
    protected static PartialCompositeContext getPCContext(Continuation cont)
            throws NamingException {

<span class="nc" id="L512">        Object obj = cont.getResolvedObj();</span>
<span class="nc" id="L513">        PartialCompositeContext pctx = null;</span>

<span class="nc bnc" id="L515" title="All 2 branches missed.">        if (obj instanceof PartialCompositeContext) {</span>
            // Just cast if octx already is PartialCompositeContext
            // %%% ignoring environment for now
<span class="nc" id="L518">            return (PartialCompositeContext)obj;</span>
        } else {
<span class="nc" id="L520">            throw cont.fillInException(new CannotProceedException());</span>
        }
    }
};
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>