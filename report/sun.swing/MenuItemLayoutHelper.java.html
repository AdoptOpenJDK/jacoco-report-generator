<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MenuItemLayoutHelper.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.swing</a> &gt; <span class="el_source">MenuItemLayoutHelper.java</span></div><h1>MenuItemLayoutHelper.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.swing;

import static sun.swing.SwingUtilities2.BASICMENUITEMUI_MAX_TEXT_OFFSET;

import javax.swing.*;
import javax.swing.plaf.basic.BasicHTML;
import javax.swing.text.View;
import java.awt.*;
import java.awt.event.KeyEvent;
import java.util.Map;
import java.util.HashMap;

/**
 * Calculates preferred size and layouts menu items.
 */
<span class="nc bnc" id="L41" title="All 2 branches missed.">public class MenuItemLayoutHelper {</span>

    /* Client Property keys for calculation of maximal widths */
<span class="nc" id="L44">    public static final StringUIClientPropertyKey MAX_ARROW_WIDTH =</span>
                        new StringUIClientPropertyKey(&quot;maxArrowWidth&quot;);
<span class="nc" id="L46">    public static final StringUIClientPropertyKey MAX_CHECK_WIDTH =</span>
                        new StringUIClientPropertyKey(&quot;maxCheckWidth&quot;);
<span class="nc" id="L48">    public static final StringUIClientPropertyKey MAX_ICON_WIDTH =</span>
                        new StringUIClientPropertyKey(&quot;maxIconWidth&quot;);
<span class="nc" id="L50">    public static final StringUIClientPropertyKey MAX_TEXT_WIDTH =</span>
                        new StringUIClientPropertyKey(&quot;maxTextWidth&quot;);
<span class="nc" id="L52">    public static final StringUIClientPropertyKey MAX_ACC_WIDTH =</span>
                        new StringUIClientPropertyKey(&quot;maxAccWidth&quot;);
<span class="nc" id="L54">    public static final StringUIClientPropertyKey MAX_LABEL_WIDTH =</span>
                        new StringUIClientPropertyKey(&quot;maxLabelWidth&quot;);

    private JMenuItem mi;
    private JComponent miParent;

    private Font font;
    private Font accFont;
    private FontMetrics fm;
    private FontMetrics accFm;

    private Icon icon;
    private Icon checkIcon;
    private Icon arrowIcon;
    private String text;
    private String accText;

    private boolean isColumnLayout;
    private boolean useCheckAndArrow;
    private boolean isLeftToRight;
    private boolean isTopLevelMenu;
    private View htmlView;

    private int verticalAlignment;
    private int horizontalAlignment;
    private int verticalTextPosition;
    private int horizontalTextPosition;
    private int gap;
    private int leadingGap;
    private int afterCheckIconGap;
    private int minTextOffset;

    private int leftTextExtraWidth;

    private Rectangle viewRect;

    private RectSize iconSize;
    private RectSize textSize;
    private RectSize accSize;
    private RectSize checkSize;
    private RectSize arrowSize;
    private RectSize labelSize;

    /**
     * The empty protected constructor is necessary for derived classes.
     */
<span class="nc" id="L100">    protected MenuItemLayoutHelper() {</span>
<span class="nc" id="L101">    }</span>

    public MenuItemLayoutHelper(JMenuItem mi, Icon checkIcon, Icon arrowIcon,
                      Rectangle viewRect, int gap, String accDelimiter,
                      boolean isLeftToRight, Font font, Font accFont,
<span class="nc" id="L106">                      boolean useCheckAndArrow, String propertyPrefix) {</span>
<span class="nc" id="L107">        reset(mi, checkIcon, arrowIcon, viewRect, gap, accDelimiter,</span>
              isLeftToRight, font, accFont, useCheckAndArrow, propertyPrefix);
<span class="nc" id="L109">    }</span>

    protected void reset(JMenuItem mi, Icon checkIcon, Icon arrowIcon,
                      Rectangle viewRect, int gap, String accDelimiter,
                      boolean isLeftToRight, Font font, Font accFont,
                      boolean useCheckAndArrow, String propertyPrefix) {
<span class="nc" id="L115">        this.mi = mi;</span>
<span class="nc" id="L116">        this.miParent = getMenuItemParent(mi);</span>
<span class="nc" id="L117">        this.accText = getAccText(accDelimiter);</span>
<span class="nc" id="L118">        this.verticalAlignment = mi.getVerticalAlignment();</span>
<span class="nc" id="L119">        this.horizontalAlignment = mi.getHorizontalAlignment();</span>
<span class="nc" id="L120">        this.verticalTextPosition = mi.getVerticalTextPosition();</span>
<span class="nc" id="L121">        this.horizontalTextPosition = mi.getHorizontalTextPosition();</span>
<span class="nc" id="L122">        this.useCheckAndArrow = useCheckAndArrow;</span>
<span class="nc" id="L123">        this.font = font;</span>
<span class="nc" id="L124">        this.accFont = accFont;</span>
<span class="nc" id="L125">        this.fm = mi.getFontMetrics(font);</span>
<span class="nc" id="L126">        this.accFm = mi.getFontMetrics(accFont);</span>
<span class="nc" id="L127">        this.isLeftToRight = isLeftToRight;</span>
<span class="nc" id="L128">        this.isColumnLayout = isColumnLayout(isLeftToRight,</span>
                horizontalAlignment, horizontalTextPosition,
                verticalTextPosition);
<span class="nc bnc" id="L131" title="All 2 branches missed.">        this.isTopLevelMenu = (this.miParent == null) ? true : false;</span>
<span class="nc" id="L132">        this.checkIcon = checkIcon;</span>
<span class="nc" id="L133">        this.icon = getIcon(propertyPrefix);</span>
<span class="nc" id="L134">        this.arrowIcon = arrowIcon;</span>
<span class="nc" id="L135">        this.text = mi.getText();</span>
<span class="nc" id="L136">        this.gap = gap;</span>
<span class="nc" id="L137">        this.afterCheckIconGap = getAfterCheckIconGap(propertyPrefix);</span>
<span class="nc" id="L138">        this.minTextOffset = getMinTextOffset(propertyPrefix);</span>
<span class="nc" id="L139">        this.htmlView = (View) mi.getClientProperty(BasicHTML.propertyKey);</span>
<span class="nc" id="L140">        this.viewRect = viewRect;</span>

<span class="nc" id="L142">        this.iconSize = new RectSize();</span>
<span class="nc" id="L143">        this.textSize = new RectSize();</span>
<span class="nc" id="L144">        this.accSize = new RectSize();</span>
<span class="nc" id="L145">        this.checkSize = new RectSize();</span>
<span class="nc" id="L146">        this.arrowSize = new RectSize();</span>
<span class="nc" id="L147">        this.labelSize = new RectSize();</span>
<span class="nc" id="L148">        calcExtraWidths();</span>
<span class="nc" id="L149">        calcWidthsAndHeights();</span>
<span class="nc" id="L150">        setOriginalWidths();</span>
<span class="nc" id="L151">        calcMaxWidths();</span>

<span class="nc" id="L153">        this.leadingGap = getLeadingGap(propertyPrefix);</span>
<span class="nc" id="L154">        calcMaxTextOffset(viewRect);</span>
<span class="nc" id="L155">    }</span>

    private void calcExtraWidths() {
<span class="nc" id="L158">        leftTextExtraWidth = getLeftExtraWidth(text);</span>
<span class="nc" id="L159">    }</span>

    private int getLeftExtraWidth(String str) {
<span class="nc" id="L162">        int lsb = SwingUtilities2.getLeftSideBearing(mi, fm, str);</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">        if (lsb &lt; 0) {</span>
<span class="nc" id="L164">            return -lsb;</span>
        } else {
<span class="nc" id="L166">            return 0;</span>
        }
    }

    private void setOriginalWidths() {
<span class="nc" id="L171">        iconSize.origWidth = iconSize.width;</span>
<span class="nc" id="L172">        textSize.origWidth = textSize.width;</span>
<span class="nc" id="L173">        accSize.origWidth = accSize.width;</span>
<span class="nc" id="L174">        checkSize.origWidth = checkSize.width;</span>
<span class="nc" id="L175">        arrowSize.origWidth = arrowSize.width;</span>
<span class="nc" id="L176">    }</span>

    private String getAccText(String acceleratorDelimiter) {
<span class="nc" id="L179">        String accText = &quot;&quot;;</span>
<span class="nc" id="L180">        KeyStroke accelerator = mi.getAccelerator();</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (accelerator != null) {</span>
<span class="nc" id="L182">            int modifiers = accelerator.getModifiers();</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">            if (modifiers &gt; 0) {</span>
<span class="nc" id="L184">                accText = KeyEvent.getKeyModifiersText(modifiers);</span>
<span class="nc" id="L185">                accText += acceleratorDelimiter;</span>
            }
<span class="nc" id="L187">            int keyCode = accelerator.getKeyCode();</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">            if (keyCode != 0) {</span>
<span class="nc" id="L189">                accText += KeyEvent.getKeyText(keyCode);</span>
            } else {
<span class="nc" id="L191">                accText += accelerator.getKeyChar();</span>
            }
        }
<span class="nc" id="L194">        return accText;</span>
    }

    private Icon getIcon(String propertyPrefix) {
        // In case of column layout, .checkIconFactory is defined for this UI,
        // the icon is compatible with it and useCheckAndArrow() is true,
        // then the icon is handled by the checkIcon.
<span class="nc" id="L201">        Icon icon = null;</span>
<span class="nc" id="L202">        MenuItemCheckIconFactory iconFactory =</span>
<span class="nc" id="L203">                (MenuItemCheckIconFactory) UIManager.get(propertyPrefix</span>
                        + &quot;.checkIconFactory&quot;);
<span class="nc bnc" id="L205" title="All 6 branches missed.">        if (!isColumnLayout || !useCheckAndArrow || iconFactory == null</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">                || !iconFactory.isCompatible(checkIcon, propertyPrefix)) {</span>
<span class="nc" id="L207">            icon = mi.getIcon();</span>
        }
<span class="nc" id="L209">        return icon;</span>
    }

    private int getMinTextOffset(String propertyPrefix) {
<span class="nc" id="L213">        int minimumTextOffset = 0;</span>
<span class="nc" id="L214">        Object minimumTextOffsetObject =</span>
<span class="nc" id="L215">                UIManager.get(propertyPrefix + &quot;.minimumTextOffset&quot;);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (minimumTextOffsetObject instanceof Integer) {</span>
<span class="nc" id="L217">            minimumTextOffset = (Integer) minimumTextOffsetObject;</span>
        }
<span class="nc" id="L219">        return minimumTextOffset;</span>
    }

    private int getAfterCheckIconGap(String propertyPrefix) {
<span class="nc" id="L223">        int afterCheckIconGap = gap;</span>
<span class="nc" id="L224">        Object afterCheckIconGapObject =</span>
<span class="nc" id="L225">                UIManager.get(propertyPrefix + &quot;.afterCheckIconGap&quot;);</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (afterCheckIconGapObject instanceof Integer) {</span>
<span class="nc" id="L227">            afterCheckIconGap = (Integer) afterCheckIconGapObject;</span>
        }
<span class="nc" id="L229">        return afterCheckIconGap;</span>
    }

    private int getLeadingGap(String propertyPrefix) {
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (checkSize.getMaxWidth() &gt; 0) {</span>
<span class="nc" id="L234">            return getCheckOffset(propertyPrefix);</span>
        } else {
<span class="nc" id="L236">            return gap; // There is no any check icon</span>
        }
    }

    private int getCheckOffset(String propertyPrefix) {
<span class="nc" id="L241">        int checkIconOffset = gap;</span>
<span class="nc" id="L242">        Object checkIconOffsetObject =</span>
<span class="nc" id="L243">                UIManager.get(propertyPrefix + &quot;.checkIconOffset&quot;);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (checkIconOffsetObject instanceof Integer) {</span>
<span class="nc" id="L245">            checkIconOffset = (Integer) checkIconOffsetObject;</span>
        }
<span class="nc" id="L247">        return checkIconOffset;</span>
    }

    protected void calcWidthsAndHeights() {
        // iconRect
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (icon != null) {</span>
<span class="nc" id="L253">            iconSize.width = icon.getIconWidth();</span>
<span class="nc" id="L254">            iconSize.height = icon.getIconHeight();</span>
        }

        // accRect
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (!accText.equals(&quot;&quot;)) {</span>
<span class="nc" id="L259">            accSize.width = SwingUtilities2.stringWidth(mi, accFm, accText);</span>
<span class="nc" id="L260">            accSize.height = accFm.getHeight();</span>
        }

        // textRect
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (text == null) {</span>
<span class="nc" id="L265">            text = &quot;&quot;;</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">        } else if (!text.equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">            if (htmlView != null) {</span>
                // Text is HTML
<span class="nc" id="L269">                textSize.width =</span>
<span class="nc" id="L270">                        (int) htmlView.getPreferredSpan(View.X_AXIS);</span>
<span class="nc" id="L271">                textSize.height =</span>
<span class="nc" id="L272">                        (int) htmlView.getPreferredSpan(View.Y_AXIS);</span>
            } else {
                // Text isn't HTML
<span class="nc" id="L275">                textSize.width = SwingUtilities2.stringWidth(mi, fm, text);</span>
<span class="nc" id="L276">                textSize.height = fm.getHeight();</span>
            }
        }

<span class="nc bnc" id="L280" title="All 2 branches missed.">        if (useCheckAndArrow) {</span>
            // checkIcon
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (checkIcon != null) {</span>
<span class="nc" id="L283">                checkSize.width = checkIcon.getIconWidth();</span>
<span class="nc" id="L284">                checkSize.height = checkIcon.getIconHeight();</span>
            }
            // arrowRect
<span class="nc bnc" id="L287" title="All 2 branches missed.">            if (arrowIcon != null) {</span>
<span class="nc" id="L288">                arrowSize.width = arrowIcon.getIconWidth();</span>
<span class="nc" id="L289">                arrowSize.height = arrowIcon.getIconHeight();</span>
            }
        }

        // labelRect
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (isColumnLayout) {</span>
<span class="nc" id="L295">            labelSize.width = iconSize.width + textSize.width + gap;</span>
<span class="nc" id="L296">            labelSize.height = max(checkSize.height, iconSize.height,</span>
<span class="nc" id="L297">                    textSize.height, accSize.height, arrowSize.height);</span>
        } else {
<span class="nc" id="L299">            Rectangle textRect = new Rectangle();</span>
<span class="nc" id="L300">            Rectangle iconRect = new Rectangle();</span>
<span class="nc" id="L301">            SwingUtilities.layoutCompoundLabel(mi, fm, text, icon,</span>
                    verticalAlignment, horizontalAlignment,
                    verticalTextPosition, horizontalTextPosition,
                    viewRect, iconRect, textRect, gap);
<span class="nc" id="L305">            textRect.width += leftTextExtraWidth;</span>
<span class="nc" id="L306">            Rectangle labelRect = iconRect.union(textRect);</span>
<span class="nc" id="L307">            labelSize.height = labelRect.height;</span>
<span class="nc" id="L308">            labelSize.width = labelRect.width;</span>
        }
<span class="nc" id="L310">    }</span>

    protected void calcMaxWidths() {
<span class="nc" id="L313">        calcMaxWidth(checkSize, MAX_CHECK_WIDTH);</span>
<span class="nc" id="L314">        calcMaxWidth(arrowSize, MAX_ARROW_WIDTH);</span>
<span class="nc" id="L315">        calcMaxWidth(accSize, MAX_ACC_WIDTH);</span>

<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (isColumnLayout) {</span>
<span class="nc" id="L318">            calcMaxWidth(iconSize, MAX_ICON_WIDTH);</span>
<span class="nc" id="L319">            calcMaxWidth(textSize, MAX_TEXT_WIDTH);</span>
<span class="nc" id="L320">            int curGap = gap;</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">            if ((iconSize.getMaxWidth() == 0)</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">                    || (textSize.getMaxWidth() == 0)) {</span>
<span class="nc" id="L323">                curGap = 0;</span>
            }
<span class="nc" id="L325">            labelSize.maxWidth =</span>
<span class="nc" id="L326">                    calcMaxValue(MAX_LABEL_WIDTH, iconSize.maxWidth</span>
<span class="nc" id="L327">                            + textSize.maxWidth + curGap);</span>
<span class="nc" id="L328">        } else {</span>
            // We shouldn't use current icon and text widths
            // in maximal widths calculation for complex layout.
<span class="nc" id="L331">            iconSize.maxWidth = getParentIntProperty(MAX_ICON_WIDTH);</span>
<span class="nc" id="L332">            calcMaxWidth(labelSize, MAX_LABEL_WIDTH);</span>
            // If maxLabelWidth is wider
            // than the widest icon + the widest text + gap,
            // we should update the maximal text witdh
<span class="nc" id="L336">            int candidateTextWidth = labelSize.maxWidth - iconSize.maxWidth;</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">            if (iconSize.maxWidth &gt; 0) {</span>
<span class="nc" id="L338">                candidateTextWidth -= gap;</span>
            }
<span class="nc" id="L340">            textSize.maxWidth = calcMaxValue(MAX_TEXT_WIDTH, candidateTextWidth);</span>
        }
<span class="nc" id="L342">    }</span>

    protected void calcMaxWidth(RectSize rs, Object key) {
<span class="nc" id="L345">        rs.maxWidth = calcMaxValue(key, rs.width);</span>
<span class="nc" id="L346">    }</span>

    /**
     * Calculates and returns maximal value through specified parent component
     * client property.
     *
     * @param propertyName name of the property, which stores the maximal value.
     * @param value a value which pretends to be maximal
     * @return maximal value among the parent property and the value.
     */
    protected int calcMaxValue(Object propertyName, int value) {
        // Get maximal value from parent client property
<span class="nc" id="L358">        int maxValue = getParentIntProperty(propertyName);</span>
        // Store new maximal width in parent client property
<span class="nc bnc" id="L360" title="All 2 branches missed.">        if (value &gt; maxValue) {</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">            if (miParent != null) {</span>
<span class="nc" id="L362">                miParent.putClientProperty(propertyName, value);</span>
            }
<span class="nc" id="L364">            return value;</span>
        } else {
<span class="nc" id="L366">            return maxValue;</span>
        }
    }

    /**
     * Returns parent client property as int.
     * @param propertyName name of the parent property.
     * @return value of the property as int.
     */
    protected int getParentIntProperty(Object propertyName) {
<span class="nc" id="L376">        Object value = null;</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (miParent != null) {</span>
<span class="nc" id="L378">            value = miParent.getClientProperty(propertyName);</span>
        }
<span class="nc bnc" id="L380" title="All 4 branches missed.">        if ((value == null) || !(value instanceof Integer)) {</span>
<span class="nc" id="L381">            value = 0;</span>
        }
<span class="nc" id="L383">        return (Integer) value;</span>
    }

    public static boolean isColumnLayout(boolean isLeftToRight,
                                         JMenuItem mi) {
<span class="nc bnc" id="L388" title="All 4 branches missed.">        assert(mi != null);</span>
<span class="nc" id="L389">        return isColumnLayout(isLeftToRight, mi.getHorizontalAlignment(),</span>
<span class="nc" id="L390">                mi.getHorizontalTextPosition(), mi.getVerticalTextPosition());</span>
    }

    /**
     * Answers should we do column layout for a menu item or not.
     * We do it when a user doesn't set any alignments
     * and text positions manually, except the vertical alignment.
     */
    public static boolean isColumnLayout(boolean isLeftToRight,
                                         int horizontalAlignment,
                                         int horizontalTextPosition,
                                         int verticalTextPosition) {
<span class="nc bnc" id="L402" title="All 2 branches missed.">        if (verticalTextPosition != SwingConstants.CENTER) {</span>
<span class="nc" id="L403">            return false;</span>
        }
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (isLeftToRight) {</span>
<span class="nc bnc" id="L406" title="All 4 branches missed.">            if (horizontalAlignment != SwingConstants.LEADING</span>
                    &amp;&amp; horizontalAlignment != SwingConstants.LEFT) {
<span class="nc" id="L408">                return false;</span>
            }
<span class="nc bnc" id="L410" title="All 4 branches missed.">            if (horizontalTextPosition != SwingConstants.TRAILING</span>
                    &amp;&amp; horizontalTextPosition != SwingConstants.RIGHT) {
<span class="nc" id="L412">                return false;</span>
            }
        } else {
<span class="nc bnc" id="L415" title="All 4 branches missed.">            if (horizontalAlignment != SwingConstants.LEADING</span>
                    &amp;&amp; horizontalAlignment != SwingConstants.RIGHT) {
<span class="nc" id="L417">                return false;</span>
            }
<span class="nc bnc" id="L419" title="All 4 branches missed.">            if (horizontalTextPosition != SwingConstants.TRAILING</span>
                    &amp;&amp; horizontalTextPosition != SwingConstants.LEFT) {
<span class="nc" id="L421">                return false;</span>
            }
        }
<span class="nc" id="L424">        return true;</span>
    }

    /**
     * Calculates maximal text offset.
     * It is required for some L&amp;Fs (ex: Vista L&amp;F).
     * The offset is meaningful only for L2R column layout.
     *
     * @param viewRect the rectangle, the maximal text offset
     * will be calculated for.
     */
    private void calcMaxTextOffset(Rectangle viewRect) {
<span class="nc bnc" id="L436" title="All 4 branches missed.">        if (!isColumnLayout || !isLeftToRight) {</span>
<span class="nc" id="L437">            return;</span>
        }

        // Calculate the current text offset
<span class="nc" id="L441">        int offset = viewRect.x + leadingGap + checkSize.maxWidth</span>
<span class="nc" id="L442">                + afterCheckIconGap + iconSize.maxWidth + gap;</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">        if (checkSize.maxWidth == 0) {</span>
<span class="nc" id="L444">            offset -= afterCheckIconGap;</span>
        }
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if (iconSize.maxWidth == 0) {</span>
<span class="nc" id="L447">            offset -= gap;</span>
        }

        // maximal text offset shouldn't be less than minimal text offset;
<span class="nc bnc" id="L451" title="All 2 branches missed.">        if (offset &lt; minTextOffset) {</span>
<span class="nc" id="L452">            offset = minTextOffset;</span>
        }

        // Calculate and store the maximal text offset
<span class="nc" id="L456">        calcMaxValue(SwingUtilities2.BASICMENUITEMUI_MAX_TEXT_OFFSET, offset);</span>
<span class="nc" id="L457">    }</span>

    /**
     * Layout icon, text, check icon, accelerator text and arrow icon
     * in the viewRect and return their positions.
     *
     * If horizontalAlignment, verticalTextPosition and horizontalTextPosition
     * are default (user doesn't set any manually) the layouting algorithm is:
     * Elements are layouted in the five columns:
     * check icon + icon + text + accelerator text + arrow icon
     *
     * In the other case elements are layouted in the four columns:
     * check icon + label + accelerator text + arrow icon
     * Label is union of icon and text.
     *
     * The order of columns can be reversed.
     * It depends on the menu item orientation.
     */
    public LayoutResult layoutMenuItem() {
<span class="nc" id="L476">        LayoutResult lr = createLayoutResult();</span>
<span class="nc" id="L477">        prepareForLayout(lr);</span>

<span class="nc bnc" id="L479" title="All 2 branches missed.">        if (isColumnLayout()) {</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (isLeftToRight()) {</span>
<span class="nc" id="L481">                doLTRColumnLayout(lr, getLTRColumnAlignment());</span>
            } else {
<span class="nc" id="L483">                doRTLColumnLayout(lr, getRTLColumnAlignment());</span>
            }
        } else {
<span class="nc bnc" id="L486" title="All 2 branches missed.">            if (isLeftToRight()) {</span>
<span class="nc" id="L487">                doLTRComplexLayout(lr, getLTRColumnAlignment());</span>
            } else {
<span class="nc" id="L489">                doRTLComplexLayout(lr, getRTLColumnAlignment());</span>
            }
        }

<span class="nc" id="L493">        alignAccCheckAndArrowVertically(lr);</span>
<span class="nc" id="L494">        return lr;</span>
    }

    private LayoutResult createLayoutResult() {
<span class="nc" id="L498">        return new LayoutResult(</span>
<span class="nc" id="L499">                new Rectangle(iconSize.width, iconSize.height),</span>
<span class="nc" id="L500">                new Rectangle(textSize.width, textSize.height),</span>
<span class="nc" id="L501">                new Rectangle(accSize.width,  accSize.height),</span>
<span class="nc" id="L502">                new Rectangle(checkSize.width, checkSize.height),</span>
<span class="nc" id="L503">                new Rectangle(arrowSize.width, arrowSize.height),</span>
<span class="nc" id="L504">                new Rectangle(labelSize.width, labelSize.height)</span>
        );
    }

    public ColumnAlignment getLTRColumnAlignment() {
<span class="nc" id="L509">        return ColumnAlignment.LEFT_ALIGNMENT;</span>
    }

    public ColumnAlignment getRTLColumnAlignment() {
<span class="nc" id="L513">        return ColumnAlignment.RIGHT_ALIGNMENT;</span>
    }

    protected void prepareForLayout(LayoutResult lr) {
<span class="nc" id="L517">        lr.checkRect.width = checkSize.maxWidth;</span>
<span class="nc" id="L518">        lr.accRect.width = accSize.maxWidth;</span>
<span class="nc" id="L519">        lr.arrowRect.width = arrowSize.maxWidth;</span>
<span class="nc" id="L520">    }</span>

    /**
     * Aligns the accelertor text and the check and arrow icons vertically
     * with the center of the label rect.
     */
    private void alignAccCheckAndArrowVertically(LayoutResult lr) {
<span class="nc" id="L527">        lr.accRect.y = (int)(lr.labelRect.y</span>
<span class="nc" id="L528">                + (float)lr.labelRect.height/2</span>
<span class="nc" id="L529">                - (float)lr.accRect.height/2);</span>
<span class="nc" id="L530">        fixVerticalAlignment(lr, lr.accRect);</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">        if (useCheckAndArrow) {</span>
<span class="nc" id="L532">            lr.arrowRect.y = (int)(lr.labelRect.y</span>
<span class="nc" id="L533">                    + (float)lr.labelRect.height/2</span>
<span class="nc" id="L534">                    - (float)lr.arrowRect.height/2);</span>
<span class="nc" id="L535">            lr.checkRect.y = (int)(lr.labelRect.y</span>
<span class="nc" id="L536">                    + (float)lr.labelRect.height/2</span>
<span class="nc" id="L537">                    - (float)lr.checkRect.height/2);</span>
<span class="nc" id="L538">            fixVerticalAlignment(lr, lr.arrowRect);</span>
<span class="nc" id="L539">            fixVerticalAlignment(lr, lr.checkRect);</span>
        }
<span class="nc" id="L541">    }</span>

    /**
     * Fixes vertical alignment of all menu item elements if rect.y
     * or (rect.y + rect.height) is out of viewRect bounds
     */
    private void fixVerticalAlignment(LayoutResult lr, Rectangle r) {
<span class="nc" id="L548">        int delta = 0;</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">        if (r.y &lt; viewRect.y) {</span>
<span class="nc" id="L550">            delta = viewRect.y - r.y;</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">        } else if (r.y + r.height &gt; viewRect.y + viewRect.height) {</span>
<span class="nc" id="L552">            delta = viewRect.y + viewRect.height - r.y - r.height;</span>
        }
<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (delta != 0) {</span>
<span class="nc" id="L555">            lr.checkRect.y += delta;</span>
<span class="nc" id="L556">            lr.iconRect.y += delta;</span>
<span class="nc" id="L557">            lr.textRect.y += delta;</span>
<span class="nc" id="L558">            lr.accRect.y += delta;</span>
<span class="nc" id="L559">            lr.arrowRect.y += delta;</span>
<span class="nc" id="L560">            lr.labelRect.y += delta;</span>
        }
<span class="nc" id="L562">    }</span>

    private void doLTRColumnLayout(LayoutResult lr, ColumnAlignment alignment) {
        // Set maximal width for all the five basic rects
        // (three other ones are already maximal)
<span class="nc" id="L567">        lr.iconRect.width = iconSize.maxWidth;</span>
<span class="nc" id="L568">        lr.textRect.width = textSize.maxWidth;</span>

        // Set X coordinates
        // All rects will be aligned at the left side
<span class="nc" id="L572">        calcXPositionsLTR(viewRect.x, leadingGap, gap, lr.checkRect,</span>
<span class="nc" id="L573">                lr.iconRect, lr.textRect);</span>

        // Tune afterCheckIconGap
<span class="nc bnc" id="L576" title="All 2 branches missed.">        if (lr.checkRect.width &gt; 0) { // there is the afterCheckIconGap</span>
<span class="nc" id="L577">            lr.iconRect.x += afterCheckIconGap - gap;</span>
<span class="nc" id="L578">            lr.textRect.x += afterCheckIconGap - gap;</span>
        }

<span class="nc" id="L581">        calcXPositionsRTL(viewRect.x + viewRect.width, leadingGap, gap,</span>
<span class="nc" id="L582">                lr.arrowRect, lr.accRect);</span>

        // Take into account minimal text offset
<span class="nc" id="L585">        int textOffset = lr.textRect.x - viewRect.x;</span>
<span class="nc bnc" id="L586" title="All 4 branches missed.">        if (!isTopLevelMenu &amp;&amp; (textOffset &lt; minTextOffset)) {</span>
<span class="nc" id="L587">            lr.textRect.x += minTextOffset - textOffset;</span>
        }

<span class="nc" id="L590">        alignRects(lr, alignment);</span>

        // Set Y coordinate for text and icon.
        // Y coordinates for other rects
        // will be calculated later in layoutMenuItem.
<span class="nc" id="L595">        calcTextAndIconYPositions(lr);</span>

        // Calculate valid X and Y coordinates for labelRect
<span class="nc" id="L598">        lr.setLabelRect(lr.textRect.union(lr.iconRect));</span>
<span class="nc" id="L599">    }</span>

    private void doLTRComplexLayout(LayoutResult lr, ColumnAlignment alignment) {
<span class="nc" id="L602">        lr.labelRect.width = labelSize.maxWidth;</span>

        // Set X coordinates
<span class="nc" id="L605">        calcXPositionsLTR(viewRect.x, leadingGap, gap, lr.checkRect,</span>
<span class="nc" id="L606">                lr.labelRect);</span>

        // Tune afterCheckIconGap
<span class="nc bnc" id="L609" title="All 2 branches missed.">        if (lr.checkRect.width &gt; 0) { // there is the afterCheckIconGap</span>
<span class="nc" id="L610">            lr.labelRect.x += afterCheckIconGap - gap;</span>
        }

<span class="nc" id="L613">        calcXPositionsRTL(viewRect.x + viewRect.width,</span>
<span class="nc" id="L614">                leadingGap, gap, lr.arrowRect, lr.accRect);</span>

        // Take into account minimal text offset
<span class="nc" id="L617">        int labelOffset = lr.labelRect.x - viewRect.x;</span>
<span class="nc bnc" id="L618" title="All 4 branches missed.">        if (!isTopLevelMenu &amp;&amp; (labelOffset &lt; minTextOffset)) {</span>
<span class="nc" id="L619">            lr.labelRect.x += minTextOffset - labelOffset;</span>
        }

<span class="nc" id="L622">        alignRects(lr, alignment);</span>

        // Center labelRect vertically
<span class="nc" id="L625">        calcLabelYPosition(lr);</span>

<span class="nc" id="L627">        layoutIconAndTextInLabelRect(lr);</span>
<span class="nc" id="L628">    }</span>

    private void doRTLColumnLayout(LayoutResult lr, ColumnAlignment alignment) {
        // Set maximal width for all the five basic rects
        // (three other ones are already maximal)
<span class="nc" id="L633">        lr.iconRect.width = iconSize.maxWidth;</span>
<span class="nc" id="L634">        lr.textRect.width = textSize.maxWidth;</span>

        // Set X coordinates
<span class="nc" id="L637">        calcXPositionsRTL(viewRect.x + viewRect.width, leadingGap, gap,</span>
<span class="nc" id="L638">                lr.checkRect, lr.iconRect, lr.textRect);</span>

        // Tune the gap after check icon
<span class="nc bnc" id="L641" title="All 2 branches missed.">        if (lr.checkRect.width &gt; 0) { // there is the gap after check icon</span>
<span class="nc" id="L642">            lr.iconRect.x -= afterCheckIconGap - gap;</span>
<span class="nc" id="L643">            lr.textRect.x -= afterCheckIconGap - gap;</span>
        }

<span class="nc" id="L646">        calcXPositionsLTR(viewRect.x, leadingGap, gap, lr.arrowRect,</span>
<span class="nc" id="L647">                lr.accRect);</span>

        // Take into account minimal text offset
<span class="nc" id="L650">        int textOffset = (viewRect.x + viewRect.width)</span>
<span class="nc" id="L651">                       - (lr.textRect.x + lr.textRect.width);</span>
<span class="nc bnc" id="L652" title="All 4 branches missed.">        if (!isTopLevelMenu &amp;&amp; (textOffset &lt; minTextOffset)) {</span>
<span class="nc" id="L653">            lr.textRect.x -= minTextOffset - textOffset;</span>
        }

<span class="nc" id="L656">        alignRects(lr, alignment);</span>

        // Set Y coordinates for text and icon.
        // Y coordinates for other rects
        // will be calculated later in layoutMenuItem.
<span class="nc" id="L661">        calcTextAndIconYPositions(lr);</span>

        // Calculate valid X and Y coordinate for labelRect
<span class="nc" id="L664">        lr.setLabelRect(lr.textRect.union(lr.iconRect));</span>
<span class="nc" id="L665">    }</span>

    private void doRTLComplexLayout(LayoutResult lr, ColumnAlignment alignment) {
<span class="nc" id="L668">        lr.labelRect.width = labelSize.maxWidth;</span>

        // Set X coordinates
<span class="nc" id="L671">        calcXPositionsRTL(viewRect.x + viewRect.width, leadingGap, gap,</span>
<span class="nc" id="L672">                lr.checkRect, lr.labelRect);</span>

        // Tune the gap after check icon
<span class="nc bnc" id="L675" title="All 2 branches missed.">        if (lr.checkRect.width &gt; 0) { // there is the gap after check icon</span>
<span class="nc" id="L676">            lr.labelRect.x -= afterCheckIconGap - gap;</span>
        }

<span class="nc" id="L679">        calcXPositionsLTR(viewRect.x, leadingGap, gap, lr.arrowRect, lr.accRect);</span>

        // Take into account minimal text offset
<span class="nc" id="L682">        int labelOffset = (viewRect.x + viewRect.width)</span>
<span class="nc" id="L683">                        - (lr.labelRect.x + lr.labelRect.width);</span>
<span class="nc bnc" id="L684" title="All 4 branches missed.">        if (!isTopLevelMenu &amp;&amp; (labelOffset &lt; minTextOffset)) {</span>
<span class="nc" id="L685">            lr.labelRect.x -= minTextOffset - labelOffset;</span>
        }

<span class="nc" id="L688">        alignRects(lr, alignment);</span>

        // Center labelRect vertically
<span class="nc" id="L691">        calcLabelYPosition(lr);</span>

<span class="nc" id="L693">        layoutIconAndTextInLabelRect(lr);</span>
<span class="nc" id="L694">    }</span>

    private void alignRects(LayoutResult lr, ColumnAlignment alignment) {
<span class="nc" id="L697">        alignRect(lr.checkRect, alignment.getCheckAlignment(),</span>
<span class="nc" id="L698">                  checkSize.getOrigWidth());</span>
<span class="nc" id="L699">        alignRect(lr.iconRect, alignment.getIconAlignment(),</span>
<span class="nc" id="L700">                  iconSize.getOrigWidth());</span>
<span class="nc" id="L701">        alignRect(lr.textRect, alignment.getTextAlignment(),</span>
<span class="nc" id="L702">                  textSize.getOrigWidth());</span>
<span class="nc" id="L703">        alignRect(lr.accRect, alignment.getAccAlignment(),</span>
<span class="nc" id="L704">                  accSize.getOrigWidth());</span>
<span class="nc" id="L705">        alignRect(lr.arrowRect, alignment.getArrowAlignment(),</span>
<span class="nc" id="L706">                  arrowSize.getOrigWidth());</span>
<span class="nc" id="L707">    }</span>

    private void alignRect(Rectangle rect, int alignment, int origWidth) {
<span class="nc bnc" id="L710" title="All 2 branches missed.">        if (alignment == SwingConstants.RIGHT) {</span>
<span class="nc" id="L711">            rect.x = rect.x + rect.width - origWidth;</span>
        }
<span class="nc" id="L713">        rect.width = origWidth;</span>
<span class="nc" id="L714">    }</span>

    protected void layoutIconAndTextInLabelRect(LayoutResult lr) {
<span class="nc" id="L717">        lr.setTextRect(new Rectangle());</span>
<span class="nc" id="L718">        lr.setIconRect(new Rectangle());</span>
<span class="nc" id="L719">        SwingUtilities.layoutCompoundLabel(</span>
                mi, fm, text,icon, verticalAlignment, horizontalAlignment,
<span class="nc" id="L721">                verticalTextPosition, horizontalTextPosition, lr.labelRect,</span>
<span class="nc" id="L722">                lr.iconRect, lr.textRect, gap);</span>
<span class="nc" id="L723">    }</span>

    private void calcXPositionsLTR(int startXPos, int leadingGap,
                                   int gap, Rectangle... rects) {
<span class="nc" id="L727">        int curXPos = startXPos + leadingGap;</span>
<span class="nc bnc" id="L728" title="All 2 branches missed.">        for (Rectangle rect : rects) {</span>
<span class="nc" id="L729">            rect.x = curXPos;</span>
<span class="nc bnc" id="L730" title="All 2 branches missed.">            if (rect.width &gt; 0) {</span>
<span class="nc" id="L731">                curXPos += rect.width + gap;</span>
            }
        }
<span class="nc" id="L734">    }</span>

    private void calcXPositionsRTL(int startXPos, int leadingGap,
                                   int gap, Rectangle... rects) {
<span class="nc" id="L738">        int curXPos = startXPos - leadingGap;</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">        for (Rectangle rect : rects) {</span>
<span class="nc" id="L740">            rect.x = curXPos - rect.width;</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">            if (rect.width &gt; 0) {</span>
<span class="nc" id="L742">                curXPos -= rect.width + gap;</span>
            }
        }
<span class="nc" id="L745">    }</span>

   /**
     * Sets Y coordinates of text and icon
     * taking into account the vertical alignment
     */
    private void calcTextAndIconYPositions(LayoutResult lr) {
<span class="nc bnc" id="L752" title="All 2 branches missed.">        if (verticalAlignment == SwingUtilities.TOP) {</span>
<span class="nc" id="L753">            lr.textRect.y  = (int)(viewRect.y</span>
<span class="nc" id="L754">                    + (float)lr.labelRect.height/2</span>
<span class="nc" id="L755">                    - (float)lr.textRect.height/2);</span>
<span class="nc" id="L756">            lr.iconRect.y  = (int)(viewRect.y</span>
<span class="nc" id="L757">                    + (float)lr.labelRect.height/2</span>
<span class="nc" id="L758">                    - (float)lr.iconRect.height/2);</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">        } else if (verticalAlignment == SwingUtilities.CENTER) {</span>
<span class="nc" id="L760">            lr.textRect.y = (int)(viewRect.y</span>
                    + (float)viewRect.height/2
<span class="nc" id="L762">                    - (float)lr.textRect.height/2);</span>
<span class="nc" id="L763">            lr.iconRect.y = (int)(viewRect.y</span>
                    + (float)viewRect.height/2
<span class="nc" id="L765">                    - (float)lr.iconRect.height/2);</span>
        }
<span class="nc bnc" id="L767" title="All 2 branches missed.">        else if (verticalAlignment == SwingUtilities.BOTTOM) {</span>
<span class="nc" id="L768">            lr.textRect.y = (int)(viewRect.y</span>
                    + viewRect.height
<span class="nc" id="L770">                    - (float)lr.labelRect.height/2</span>
<span class="nc" id="L771">                    - (float)lr.textRect.height/2);</span>
<span class="nc" id="L772">            lr.iconRect.y = (int)(viewRect.y</span>
                    + viewRect.height
<span class="nc" id="L774">                    - (float)lr.labelRect.height/2</span>
<span class="nc" id="L775">                    - (float)lr.iconRect.height/2);</span>
        }
<span class="nc" id="L777">    }</span>

    /**
     * Sets labelRect Y coordinate
     * taking into account the vertical alignment
     */
    private void calcLabelYPosition(LayoutResult lr) {
<span class="nc bnc" id="L784" title="All 2 branches missed.">        if (verticalAlignment == SwingUtilities.TOP) {</span>
<span class="nc" id="L785">            lr.labelRect.y  = viewRect.y;</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">        } else if (verticalAlignment == SwingUtilities.CENTER) {</span>
<span class="nc" id="L787">            lr.labelRect.y = (int)(viewRect.y</span>
                    + (float)viewRect.height/2
<span class="nc" id="L789">                    - (float)lr.labelRect.height/2);</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">        } else if (verticalAlignment == SwingUtilities.BOTTOM) {</span>
<span class="nc" id="L791">            lr.labelRect.y  = viewRect.y + viewRect.height</span>
<span class="nc" id="L792">                    - lr.labelRect.height;</span>
        }
<span class="nc" id="L794">    }</span>

    /**
     * Returns parent of this component if it is not a top-level menu
     * Otherwise returns null.
     * @param menuItem the menu item whose parent will be returned.
     * @return parent of this component if it is not a top-level menu
     * Otherwise returns null.
     */
    public static JComponent getMenuItemParent(JMenuItem menuItem) {
<span class="nc" id="L804">        Container parent = menuItem.getParent();</span>
<span class="nc bnc" id="L805" title="All 4 branches missed.">        if ((parent instanceof JComponent) &amp;&amp;</span>
             (!(menuItem instanceof JMenu) ||
<span class="nc bnc" id="L807" title="All 2 branches missed.">               !((JMenu)menuItem).isTopLevelMenu())) {</span>
<span class="nc" id="L808">            return (JComponent) parent;</span>
        } else {
<span class="nc" id="L810">            return null;</span>
        }
    }

    public static void clearUsedParentClientProperties(JMenuItem menuItem) {
<span class="nc" id="L815">        clearUsedClientProperties(getMenuItemParent(menuItem));</span>
<span class="nc" id="L816">    }</span>

    public static void clearUsedClientProperties(JComponent c) {
<span class="nc bnc" id="L819" title="All 2 branches missed.">        if (c != null) {</span>
<span class="nc" id="L820">            c.putClientProperty(MAX_ARROW_WIDTH, null);</span>
<span class="nc" id="L821">            c.putClientProperty(MAX_CHECK_WIDTH, null);</span>
<span class="nc" id="L822">            c.putClientProperty(MAX_ACC_WIDTH, null);</span>
<span class="nc" id="L823">            c.putClientProperty(MAX_TEXT_WIDTH, null);</span>
<span class="nc" id="L824">            c.putClientProperty(MAX_ICON_WIDTH, null);</span>
<span class="nc" id="L825">            c.putClientProperty(MAX_LABEL_WIDTH, null);</span>
<span class="nc" id="L826">            c.putClientProperty(BASICMENUITEMUI_MAX_TEXT_OFFSET, null);</span>
        }
<span class="nc" id="L828">    }</span>

    /**
     * Finds and returns maximal integer value in the given array.
     * @param values array where the search will be performed.
     * @return maximal vaule.
     */
    public static int max(int... values) {
<span class="nc" id="L836">        int maxValue = Integer.MIN_VALUE;</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">        for (int i : values) {</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">            if (i &gt; maxValue) {</span>
<span class="nc" id="L839">                maxValue = i;</span>
            }
        }
<span class="nc" id="L842">        return maxValue;</span>
    }

    public static Rectangle createMaxRect() {
<span class="nc" id="L846">        return new Rectangle(0, 0, Integer.MAX_VALUE, Integer.MAX_VALUE);</span>
    }

    public static void addMaxWidth(RectSize size, int gap, Dimension result) {
<span class="nc bnc" id="L850" title="All 2 branches missed.">        if (size.maxWidth &gt; 0) {</span>
<span class="nc" id="L851">            result.width += size.maxWidth + gap;</span>
        }
<span class="nc" id="L853">    }</span>

    public static void addWidth(int width, int gap, Dimension result) {
<span class="nc bnc" id="L856" title="All 2 branches missed.">        if (width &gt; 0) {</span>
<span class="nc" id="L857">            result.width += width + gap;</span>
        }
<span class="nc" id="L859">    }</span>

    public JMenuItem getMenuItem() {
<span class="nc" id="L862">        return mi;</span>
    }

    public JComponent getMenuItemParent() {
<span class="nc" id="L866">        return miParent;</span>
    }

    public Font getFont() {
<span class="nc" id="L870">        return font;</span>
    }

    public Font getAccFont() {
<span class="nc" id="L874">        return accFont;</span>
    }

    public FontMetrics getFontMetrics() {
<span class="nc" id="L878">        return fm;</span>
    }

    public FontMetrics getAccFontMetrics() {
<span class="nc" id="L882">        return accFm;</span>
    }

    public Icon getIcon() {
<span class="nc" id="L886">        return icon;</span>
    }

    public Icon getCheckIcon() {
<span class="nc" id="L890">        return checkIcon;</span>
    }

    public Icon getArrowIcon() {
<span class="nc" id="L894">        return arrowIcon;</span>
    }

    public String getText() {
<span class="nc" id="L898">        return text;</span>
    }

    public String getAccText() {
<span class="nc" id="L902">        return accText;</span>
    }

    public boolean isColumnLayout() {
<span class="nc" id="L906">        return isColumnLayout;</span>
    }

    public boolean useCheckAndArrow() {
<span class="nc" id="L910">        return useCheckAndArrow;</span>
    }

    public boolean isLeftToRight() {
<span class="nc" id="L914">        return isLeftToRight;</span>
    }

    public boolean isTopLevelMenu() {
<span class="nc" id="L918">        return isTopLevelMenu;</span>
    }

    public View getHtmlView() {
<span class="nc" id="L922">        return htmlView;</span>
    }

    public int getVerticalAlignment() {
<span class="nc" id="L926">        return verticalAlignment;</span>
    }

    public int getHorizontalAlignment() {
<span class="nc" id="L930">        return horizontalAlignment;</span>
    }

    public int getVerticalTextPosition() {
<span class="nc" id="L934">        return verticalTextPosition;</span>
    }

    public int getHorizontalTextPosition() {
<span class="nc" id="L938">        return horizontalTextPosition;</span>
    }

    public int getGap() {
<span class="nc" id="L942">        return gap;</span>
    }

    public int getLeadingGap() {
<span class="nc" id="L946">        return leadingGap;</span>
    }

    public int getAfterCheckIconGap() {
<span class="nc" id="L950">        return afterCheckIconGap;</span>
    }

    public int getMinTextOffset() {
<span class="nc" id="L954">        return minTextOffset;</span>
    }

    public Rectangle getViewRect() {
<span class="nc" id="L958">        return viewRect;</span>
    }

    public RectSize getIconSize() {
<span class="nc" id="L962">        return iconSize;</span>
    }

    public RectSize getTextSize() {
<span class="nc" id="L966">        return textSize;</span>
    }

    public RectSize getAccSize() {
<span class="nc" id="L970">        return accSize;</span>
    }

    public RectSize getCheckSize() {
<span class="nc" id="L974">        return checkSize;</span>
    }

    public RectSize getArrowSize() {
<span class="nc" id="L978">        return arrowSize;</span>
    }

    public RectSize getLabelSize() {
<span class="nc" id="L982">        return labelSize;</span>
    }

    protected void setMenuItem(JMenuItem mi) {
<span class="nc" id="L986">        this.mi = mi;</span>
<span class="nc" id="L987">    }</span>

    protected void setMenuItemParent(JComponent miParent) {
<span class="nc" id="L990">        this.miParent = miParent;</span>
<span class="nc" id="L991">    }</span>

    protected void setFont(Font font) {
<span class="nc" id="L994">        this.font = font;</span>
<span class="nc" id="L995">    }</span>

    protected void setAccFont(Font accFont) {
<span class="nc" id="L998">        this.accFont = accFont;</span>
<span class="nc" id="L999">    }</span>

    protected void setFontMetrics(FontMetrics fm) {
<span class="nc" id="L1002">        this.fm = fm;</span>
<span class="nc" id="L1003">    }</span>

    protected void setAccFontMetrics(FontMetrics accFm) {
<span class="nc" id="L1006">        this.accFm = accFm;</span>
<span class="nc" id="L1007">    }</span>

    protected void setIcon(Icon icon) {
<span class="nc" id="L1010">        this.icon = icon;</span>
<span class="nc" id="L1011">    }</span>

    protected void setCheckIcon(Icon checkIcon) {
<span class="nc" id="L1014">        this.checkIcon = checkIcon;</span>
<span class="nc" id="L1015">    }</span>

    protected void setArrowIcon(Icon arrowIcon) {
<span class="nc" id="L1018">        this.arrowIcon = arrowIcon;</span>
<span class="nc" id="L1019">    }</span>

    protected void setText(String text) {
<span class="nc" id="L1022">        this.text = text;</span>
<span class="nc" id="L1023">    }</span>

    protected void setAccText(String accText) {
<span class="nc" id="L1026">        this.accText = accText;</span>
<span class="nc" id="L1027">    }</span>

    protected void setColumnLayout(boolean columnLayout) {
<span class="nc" id="L1030">        isColumnLayout = columnLayout;</span>
<span class="nc" id="L1031">    }</span>

    protected void setUseCheckAndArrow(boolean useCheckAndArrow) {
<span class="nc" id="L1034">        this.useCheckAndArrow = useCheckAndArrow;</span>
<span class="nc" id="L1035">    }</span>

    protected void setLeftToRight(boolean leftToRight) {
<span class="nc" id="L1038">        isLeftToRight = leftToRight;</span>
<span class="nc" id="L1039">    }</span>

    protected void setTopLevelMenu(boolean topLevelMenu) {
<span class="nc" id="L1042">        isTopLevelMenu = topLevelMenu;</span>
<span class="nc" id="L1043">    }</span>

    protected void setHtmlView(View htmlView) {
<span class="nc" id="L1046">        this.htmlView = htmlView;</span>
<span class="nc" id="L1047">    }</span>

    protected void setVerticalAlignment(int verticalAlignment) {
<span class="nc" id="L1050">        this.verticalAlignment = verticalAlignment;</span>
<span class="nc" id="L1051">    }</span>

    protected void setHorizontalAlignment(int horizontalAlignment) {
<span class="nc" id="L1054">        this.horizontalAlignment = horizontalAlignment;</span>
<span class="nc" id="L1055">    }</span>

    protected void setVerticalTextPosition(int verticalTextPosition) {
<span class="nc" id="L1058">        this.verticalTextPosition = verticalTextPosition;</span>
<span class="nc" id="L1059">    }</span>

    protected void setHorizontalTextPosition(int horizontalTextPosition) {
<span class="nc" id="L1062">        this.horizontalTextPosition = horizontalTextPosition;</span>
<span class="nc" id="L1063">    }</span>

    protected void setGap(int gap) {
<span class="nc" id="L1066">        this.gap = gap;</span>
<span class="nc" id="L1067">    }</span>

    protected void setLeadingGap(int leadingGap) {
<span class="nc" id="L1070">        this.leadingGap = leadingGap;</span>
<span class="nc" id="L1071">    }</span>

    protected void setAfterCheckIconGap(int afterCheckIconGap) {
<span class="nc" id="L1074">        this.afterCheckIconGap = afterCheckIconGap;</span>
<span class="nc" id="L1075">    }</span>

    protected void setMinTextOffset(int minTextOffset) {
<span class="nc" id="L1078">        this.minTextOffset = minTextOffset;</span>
<span class="nc" id="L1079">    }</span>

    protected void setViewRect(Rectangle viewRect) {
<span class="nc" id="L1082">        this.viewRect = viewRect;</span>
<span class="nc" id="L1083">    }</span>

    protected void setIconSize(RectSize iconSize) {
<span class="nc" id="L1086">        this.iconSize = iconSize;</span>
<span class="nc" id="L1087">    }</span>

    protected void setTextSize(RectSize textSize) {
<span class="nc" id="L1090">        this.textSize = textSize;</span>
<span class="nc" id="L1091">    }</span>

    protected void setAccSize(RectSize accSize) {
<span class="nc" id="L1094">        this.accSize = accSize;</span>
<span class="nc" id="L1095">    }</span>

    protected void setCheckSize(RectSize checkSize) {
<span class="nc" id="L1098">        this.checkSize = checkSize;</span>
<span class="nc" id="L1099">    }</span>

    protected void setArrowSize(RectSize arrowSize) {
<span class="nc" id="L1102">        this.arrowSize = arrowSize;</span>
<span class="nc" id="L1103">    }</span>

    protected void setLabelSize(RectSize labelSize) {
<span class="nc" id="L1106">        this.labelSize = labelSize;</span>
<span class="nc" id="L1107">    }</span>

    public int getLeftTextExtraWidth() {
<span class="nc" id="L1110">        return leftTextExtraWidth;</span>
    }

    /**
     * Returns false if the component is a JMenu and it is a top
     * level menu (on the menubar).
     */
    public static boolean useCheckAndArrow(JMenuItem menuItem) {
<span class="nc" id="L1118">        boolean b = true;</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">        if ((menuItem instanceof JMenu) &amp;&amp;</span>
<span class="nc bnc" id="L1120" title="All 2 branches missed.">                (((JMenu) menuItem).isTopLevelMenu())) {</span>
<span class="nc" id="L1121">            b = false;</span>
        }
<span class="nc" id="L1123">        return b;</span>
    }

    public static class LayoutResult {
        private Rectangle iconRect;
        private Rectangle textRect;
        private Rectangle accRect;
        private Rectangle checkRect;
        private Rectangle arrowRect;
        private Rectangle labelRect;

<span class="nc" id="L1134">        public LayoutResult() {</span>
<span class="nc" id="L1135">            iconRect = new Rectangle();</span>
<span class="nc" id="L1136">            textRect = new Rectangle();</span>
<span class="nc" id="L1137">            accRect = new Rectangle();</span>
<span class="nc" id="L1138">            checkRect = new Rectangle();</span>
<span class="nc" id="L1139">            arrowRect = new Rectangle();</span>
<span class="nc" id="L1140">            labelRect = new Rectangle();</span>
<span class="nc" id="L1141">        }</span>

        public LayoutResult(Rectangle iconRect, Rectangle textRect,
                            Rectangle accRect, Rectangle checkRect,
<span class="nc" id="L1145">                            Rectangle arrowRect, Rectangle labelRect) {</span>
<span class="nc" id="L1146">            this.iconRect = iconRect;</span>
<span class="nc" id="L1147">            this.textRect = textRect;</span>
<span class="nc" id="L1148">            this.accRect = accRect;</span>
<span class="nc" id="L1149">            this.checkRect = checkRect;</span>
<span class="nc" id="L1150">            this.arrowRect = arrowRect;</span>
<span class="nc" id="L1151">            this.labelRect = labelRect;</span>
<span class="nc" id="L1152">        }</span>

        public Rectangle getIconRect() {
<span class="nc" id="L1155">            return iconRect;</span>
        }

        public void setIconRect(Rectangle iconRect) {
<span class="nc" id="L1159">            this.iconRect = iconRect;</span>
<span class="nc" id="L1160">        }</span>

        public Rectangle getTextRect() {
<span class="nc" id="L1163">            return textRect;</span>
        }

        public void setTextRect(Rectangle textRect) {
<span class="nc" id="L1167">            this.textRect = textRect;</span>
<span class="nc" id="L1168">        }</span>

        public Rectangle getAccRect() {
<span class="nc" id="L1171">            return accRect;</span>
        }

        public void setAccRect(Rectangle accRect) {
<span class="nc" id="L1175">            this.accRect = accRect;</span>
<span class="nc" id="L1176">        }</span>

        public Rectangle getCheckRect() {
<span class="nc" id="L1179">            return checkRect;</span>
        }

        public void setCheckRect(Rectangle checkRect) {
<span class="nc" id="L1183">            this.checkRect = checkRect;</span>
<span class="nc" id="L1184">        }</span>

        public Rectangle getArrowRect() {
<span class="nc" id="L1187">            return arrowRect;</span>
        }

        public void setArrowRect(Rectangle arrowRect) {
<span class="nc" id="L1191">            this.arrowRect = arrowRect;</span>
<span class="nc" id="L1192">        }</span>

        public Rectangle getLabelRect() {
<span class="nc" id="L1195">            return labelRect;</span>
        }

        public void setLabelRect(Rectangle labelRect) {
<span class="nc" id="L1199">            this.labelRect = labelRect;</span>
<span class="nc" id="L1200">        }</span>

        public Map&lt;String, Rectangle&gt; getAllRects() {
<span class="nc" id="L1203">            Map&lt;String, Rectangle&gt; result = new HashMap&lt;String, Rectangle&gt;();</span>
<span class="nc" id="L1204">            result.put(&quot;checkRect&quot;, checkRect);</span>
<span class="nc" id="L1205">            result.put(&quot;iconRect&quot;, iconRect);</span>
<span class="nc" id="L1206">            result.put(&quot;textRect&quot;, textRect);</span>
<span class="nc" id="L1207">            result.put(&quot;accRect&quot;, accRect);</span>
<span class="nc" id="L1208">            result.put(&quot;arrowRect&quot;, arrowRect);</span>
<span class="nc" id="L1209">            result.put(&quot;labelRect&quot;, labelRect);</span>
<span class="nc" id="L1210">            return result;</span>
        }
    }

    public static class ColumnAlignment {
        private int checkAlignment;
        private int iconAlignment;
        private int textAlignment;
        private int accAlignment;
        private int arrowAlignment;

<span class="nc" id="L1221">        public static final ColumnAlignment LEFT_ALIGNMENT =</span>
                new ColumnAlignment(
                        SwingConstants.LEFT,
                        SwingConstants.LEFT,
                        SwingConstants.LEFT,
                        SwingConstants.LEFT,
                        SwingConstants.LEFT
                );

<span class="nc" id="L1230">        public static final ColumnAlignment RIGHT_ALIGNMENT =</span>
                new ColumnAlignment(
                        SwingConstants.RIGHT,
                        SwingConstants.RIGHT,
                        SwingConstants.RIGHT,
                        SwingConstants.RIGHT,
                        SwingConstants.RIGHT
                );

        public ColumnAlignment(int checkAlignment, int iconAlignment,
                               int textAlignment, int accAlignment,
<span class="nc" id="L1241">                               int arrowAlignment) {</span>
<span class="nc" id="L1242">            this.checkAlignment = checkAlignment;</span>
<span class="nc" id="L1243">            this.iconAlignment = iconAlignment;</span>
<span class="nc" id="L1244">            this.textAlignment = textAlignment;</span>
<span class="nc" id="L1245">            this.accAlignment = accAlignment;</span>
<span class="nc" id="L1246">            this.arrowAlignment = arrowAlignment;</span>
<span class="nc" id="L1247">        }</span>

        public int getCheckAlignment() {
<span class="nc" id="L1250">            return checkAlignment;</span>
        }

        public int getIconAlignment() {
<span class="nc" id="L1254">            return iconAlignment;</span>
        }

        public int getTextAlignment() {
<span class="nc" id="L1258">            return textAlignment;</span>
        }

        public int getAccAlignment() {
<span class="nc" id="L1262">            return accAlignment;</span>
        }

        public int getArrowAlignment() {
<span class="nc" id="L1266">            return arrowAlignment;</span>
        }
    }

    public static class RectSize {
        private int width;
        private int height;
        private int origWidth;
        private int maxWidth;

<span class="nc" id="L1276">        public RectSize() {</span>
<span class="nc" id="L1277">        }</span>

<span class="nc" id="L1279">        public RectSize(int width, int height, int origWidth, int maxWidth) {</span>
<span class="nc" id="L1280">            this.width = width;</span>
<span class="nc" id="L1281">            this.height = height;</span>
<span class="nc" id="L1282">            this.origWidth = origWidth;</span>
<span class="nc" id="L1283">            this.maxWidth = maxWidth;</span>
<span class="nc" id="L1284">        }</span>

        public int getWidth() {
<span class="nc" id="L1287">            return width;</span>
        }

        public int getHeight() {
<span class="nc" id="L1291">            return height;</span>
        }

        public int getOrigWidth() {
<span class="nc" id="L1295">            return origWidth;</span>
        }

        public int getMaxWidth() {
<span class="nc" id="L1299">            return maxWidth;</span>
        }

        public void setWidth(int width) {
<span class="nc" id="L1303">            this.width = width;</span>
<span class="nc" id="L1304">        }</span>

        public void setHeight(int height) {
<span class="nc" id="L1307">            this.height = height;</span>
<span class="nc" id="L1308">        }</span>

        public void setOrigWidth(int origWidth) {
<span class="nc" id="L1311">            this.origWidth = origWidth;</span>
<span class="nc" id="L1312">        }</span>

        public void setMaxWidth(int maxWidth) {
<span class="nc" id="L1315">            this.maxWidth = maxWidth;</span>
<span class="nc" id="L1316">        }</span>

        public String toString() {
<span class="nc" id="L1319">            return &quot;[w=&quot; + width + &quot;,h=&quot; + height + &quot;,ow=&quot;</span>
                    + origWidth + &quot;,mw=&quot; + maxWidth + &quot;]&quot;;
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>