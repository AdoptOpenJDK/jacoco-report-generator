<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>Sequence.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.sound.midi</a> &gt; <span class="el_source">Sequence.java</span></div><h1>Sequence.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2004, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.sound.midi;

import java.util.Vector;
import com.sun.media.sound.MidiUtils;


/**
 * A &lt;code&gt;Sequence&lt;/code&gt; is a data structure containing musical
 * information (often an entire song or composition) that can be played
 * back by a &lt;code&gt;{@link Sequencer}&lt;/code&gt; object. Specifically, the
 * &lt;code&gt;Sequence&lt;/code&gt; contains timing
 * information and one or more tracks.  Each &lt;code&gt;{@link Track track}&lt;/code&gt; consists of a
 * series of MIDI events (such as note-ons, note-offs, program changes, and meta-events).
 * The sequence's timing information specifies the type of unit that is used
 * to time-stamp the events in the sequence.
 * &lt;p&gt;
 * A &lt;code&gt;Sequence&lt;/code&gt; can be created from a MIDI file by reading the file
 * into an input stream and invoking one of the &lt;code&gt;getSequence&lt;/code&gt; methods of
 * {@link MidiSystem}.  A sequence can also be built from scratch by adding new
 * &lt;code&gt;Tracks&lt;/code&gt; to an empty &lt;code&gt;Sequence&lt;/code&gt;, and adding
 * &lt;code&gt;{@link MidiEvent}&lt;/code&gt; objects to these &lt;code&gt;Tracks&lt;/code&gt;.
 *
 * @see Sequencer#setSequence(java.io.InputStream stream)
 * @see Sequencer#setSequence(Sequence sequence)
 * @see Track#add(MidiEvent)
 * @see MidiFileFormat
 *
 * @author Kara Kytle
 */
public class Sequence {


    // Timing types

    /**
     * The tempo-based timing type, for which the resolution is expressed in pulses (ticks) per quarter note.
     * @see #Sequence(float, int)
     */
    public static final float PPQ                                                       = 0.0f;

    /**
     * The SMPTE-based timing type with 24 frames per second (resolution is expressed in ticks per frame).
     * @see #Sequence(float, int)
     */
    public static final float SMPTE_24                                          = 24.0f;

    /**
     * The SMPTE-based timing type with 25 frames per second (resolution is expressed in ticks per frame).
     * @see #Sequence(float, int)
     */
    public static final float SMPTE_25                                          = 25.0f;

    /**
     * The SMPTE-based timing type with 29.97 frames per second (resolution is expressed in ticks per frame).
     * @see #Sequence(float, int)
     */
    public static final float SMPTE_30DROP                                      = 29.97f;

    /**
     * The SMPTE-based timing type with 30 frames per second (resolution is expressed in ticks per frame).
     * @see #Sequence(float, int)
     */
    public static final float SMPTE_30                                          = 30.0f;


    // Variables

    /**
     * The timing division type of the sequence.
     * @see #PPQ
     * @see #SMPTE_24
     * @see #SMPTE_25
     * @see #SMPTE_30DROP
     * @see #SMPTE_30
     * @see #getDivisionType
     */
    protected float divisionType;

    /**
     * The timing resolution of the sequence.
     * @see #getResolution
     */
    protected int resolution;

    /**
     * The MIDI tracks in this sequence.
     * @see #getTracks
     */
<span class="nc" id="L114">    protected Vector&lt;Track&gt; tracks = new Vector&lt;Track&gt;();</span>


    /**
     * Constructs a new MIDI sequence with the specified timing division
     * type and timing resolution.  The division type must be one of the
     * recognized MIDI timing types.  For tempo-based timing,
     * &lt;code&gt;divisionType&lt;/code&gt; is PPQ (pulses per quarter note) and
     * the resolution is specified in ticks per beat.  For SMTPE timing,
     * &lt;code&gt;divisionType&lt;/code&gt; specifies the number of frames per
     * second and the resolution is specified in ticks per frame.
     * The sequence will contain no initial tracks.  Tracks may be
     * added to or removed from the sequence using &lt;code&gt;{@link #createTrack}&lt;/code&gt;
     * and &lt;code&gt;{@link #deleteTrack}&lt;/code&gt;.
     *
     * @param divisionType the timing division type (PPQ or one of the SMPTE types)
     * @param resolution the timing resolution
     * @throws InvalidMidiDataException if &lt;code&gt;divisionType&lt;/code&gt; is not valid
     *
     * @see #PPQ
     * @see #SMPTE_24
     * @see #SMPTE_25
     * @see #SMPTE_30DROP
     * @see #SMPTE_30
     * @see #getDivisionType
     * @see #getResolution
     * @see #getTracks
     */
<span class="nc" id="L142">    public Sequence(float divisionType, int resolution) throws InvalidMidiDataException {</span>

<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (divisionType == PPQ)</span>
<span class="nc" id="L145">            this.divisionType = PPQ;</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">        else if (divisionType == SMPTE_24)</span>
<span class="nc" id="L147">            this.divisionType = SMPTE_24;</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        else if (divisionType == SMPTE_25)</span>
<span class="nc" id="L149">            this.divisionType = SMPTE_25;</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">        else if (divisionType == SMPTE_30DROP)</span>
<span class="nc" id="L151">            this.divisionType = SMPTE_30DROP;</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        else if (divisionType == SMPTE_30)</span>
<span class="nc" id="L153">            this.divisionType = SMPTE_30;</span>
<span class="nc" id="L154">        else throw new InvalidMidiDataException(&quot;Unsupported division type: &quot; + divisionType);</span>

<span class="nc" id="L156">        this.resolution = resolution;</span>
<span class="nc" id="L157">    }</span>


    /**
     * Constructs a new MIDI sequence with the specified timing division
     * type, timing resolution, and number of tracks.  The division type must be one of the
     * recognized MIDI timing types.  For tempo-based timing,
     * &lt;code&gt;divisionType&lt;/code&gt; is PPQ (pulses per quarter note) and
     * the resolution is specified in ticks per beat.  For SMTPE timing,
     * &lt;code&gt;divisionType&lt;/code&gt; specifies the number of frames per
     * second and the resolution is specified in ticks per frame.
     * The sequence will be initialized with the number of tracks specified by
     * &lt;code&gt;numTracks&lt;/code&gt;. These tracks are initially empty (i.e.
     * they contain only the meta-event End of Track).
     * The tracks may be retrieved for editing using the &lt;code&gt;{@link #getTracks}&lt;/code&gt;
     * method.  Additional tracks may be added, or existing tracks removed,
     * using &lt;code&gt;{@link #createTrack}&lt;/code&gt; and &lt;code&gt;{@link #deleteTrack}&lt;/code&gt;.
     *
     * @param divisionType the timing division type (PPQ or one of the SMPTE types)
     * @param resolution the timing resolution
     * @param numTracks the initial number of tracks in the sequence.
     * @throws InvalidMidiDataException if &lt;code&gt;divisionType&lt;/code&gt; is not valid
     *
     * @see #PPQ
     * @see #SMPTE_24
     * @see #SMPTE_25
     * @see #SMPTE_30DROP
     * @see #SMPTE_30
     * @see #getDivisionType
     * @see #getResolution
     */
<span class="nc" id="L188">    public Sequence(float divisionType, int resolution, int numTracks) throws InvalidMidiDataException {</span>

<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (divisionType == PPQ)</span>
<span class="nc" id="L191">            this.divisionType = PPQ;</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">        else if (divisionType == SMPTE_24)</span>
<span class="nc" id="L193">            this.divisionType = SMPTE_24;</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">        else if (divisionType == SMPTE_25)</span>
<span class="nc" id="L195">            this.divisionType = SMPTE_25;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">        else if (divisionType == SMPTE_30DROP)</span>
<span class="nc" id="L197">            this.divisionType = SMPTE_30DROP;</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">        else if (divisionType == SMPTE_30)</span>
<span class="nc" id="L199">            this.divisionType = SMPTE_30;</span>
<span class="nc" id="L200">        else throw new InvalidMidiDataException(&quot;Unsupported division type: &quot; + divisionType);</span>

<span class="nc" id="L202">        this.resolution = resolution;</span>

<span class="nc bnc" id="L204" title="All 2 branches missed.">        for (int i = 0; i &lt; numTracks; i++) {</span>
<span class="nc" id="L205">            tracks.addElement(new Track());</span>
        }
<span class="nc" id="L207">    }</span>


    /**
     * Obtains the timing division type for this sequence.
     * @return the division type (PPQ or one of the SMPTE types)
     *
     * @see #PPQ
     * @see #SMPTE_24
     * @see #SMPTE_25
     * @see #SMPTE_30DROP
     * @see #SMPTE_30
     * @see #Sequence(float, int)
     * @see MidiFileFormat#getDivisionType()
     */
    public float getDivisionType() {
<span class="nc" id="L223">        return divisionType;</span>
    }


    /**
     * Obtains the timing resolution for this sequence.
     * If the sequence's division type is PPQ, the resolution is specified in ticks per beat.
     * For SMTPE timing, the resolution is specified in ticks per frame.
     *
     * @return the number of ticks per beat (PPQ) or per frame (SMPTE)
     * @see #getDivisionType
     * @see #Sequence(float, int)
     * @see MidiFileFormat#getResolution()
     */
    public int getResolution() {
<span class="nc" id="L238">        return resolution;</span>
    }


    /**
     * Creates a new, initially empty track as part of this sequence.
     * The track initially contains the meta-event End of Track.
     * The newly created track is returned.  All tracks in the sequence
     * may be retrieved using &lt;code&gt;{@link #getTracks}&lt;/code&gt;.  Tracks may be
     * removed from the sequence using &lt;code&gt;{@link #deleteTrack}&lt;/code&gt;.
     * @return the newly created track
     */
    public Track createTrack() {

<span class="nc" id="L252">        Track track = new Track();</span>
<span class="nc" id="L253">        tracks.addElement(track);</span>

<span class="nc" id="L255">        return track;</span>
    }


    /**
     * Removes the specified track from the sequence.
     * @param track the track to remove
     * @return &lt;code&gt;true&lt;/code&gt; if the track existed in the track and was removed,
     * otherwise &lt;code&gt;false&lt;/code&gt;.
     *
     * @see #createTrack
     * @see #getTracks
     */
    public boolean deleteTrack(Track track) {

<span class="nc" id="L270">        synchronized(tracks) {</span>

<span class="nc" id="L272">            return tracks.removeElement(track);</span>
<span class="nc" id="L273">        }</span>
    }


    /**
     * Obtains an array containing all the tracks in this sequence.
     * If the sequence contains no tracks, an array of length 0 is returned.
     * @return the array of tracks
     *
     * @see #createTrack
     * @see #deleteTrack
     */
    public Track[] getTracks() {

<span class="nc" id="L287">        return (Track[]) tracks.toArray(new Track[tracks.size()]);</span>
    }


    /**
     * Obtains the duration of this sequence, expressed in microseconds.
     * @return this sequence's duration in microseconds.
     */
    public long getMicrosecondLength() {

<span class="nc" id="L297">        return com.sun.media.sound.MidiUtils.tick2microsecond(this, getTickLength(), null);</span>
    }


    /**
     * Obtains the duration of this sequence, expressed in MIDI ticks.
     *
     * @return this sequence's length in ticks
     *
     * @see #getMicrosecondLength
     */
    public long getTickLength() {

<span class="nc" id="L310">        long length = 0;</span>

<span class="nc" id="L312">        synchronized(tracks) {</span>

<span class="nc bnc" id="L314" title="All 2 branches missed.">            for(int i=0; i&lt;tracks.size(); i++ ) {</span>
<span class="nc" id="L315">                long temp = ((Track)tracks.elementAt(i)).ticks();</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                if( temp&gt;length ) {</span>
<span class="nc" id="L317">                    length = temp;</span>
                }
            }
<span class="nc" id="L320">            return length;</span>
<span class="nc" id="L321">        }</span>
    }


    /**
     * Obtains a list of patches referenced in this sequence.
     * This patch list may be used to load the required
     * &lt;code&gt;{@link Instrument}&lt;/code&gt; objects
     * into a &lt;code&gt;{@link Synthesizer}&lt;/code&gt;.
     *
     * @return an array of &lt;code&gt;{@link Patch}&lt;/code&gt; objects used in this sequence
     *
     * @see Synthesizer#loadInstruments(Soundbank, Patch[])
     */
    public Patch[] getPatchList() {

        // $$kk: 04.09.99: need to implement!!
<span class="nc" id="L338">        return new Patch[0];</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>