<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>VMManagementImpl.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.management</a> &gt; <span class="el_source">VMManagementImpl.java</span></div><h1>VMManagementImpl.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.management;

import sun.misc.Perf;
import sun.management.counter.*;
import sun.management.counter.perf.*;
import java.nio.ByteBuffer;
import java.io.IOException;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.util.List;
import java.util.Arrays;
import java.util.Collections;
import java.security.AccessController;
import java.security.PrivilegedAction;
import sun.security.action.GetPropertyAction;

/**
 * Implementation of VMManagement interface that accesses the management
 * attributes and operations locally within the same Java virtual
 * machine.
 */
<span class="fc" id="L47">class VMManagementImpl implements VMManagement {</span>

    private static String version;

    private static boolean compTimeMonitoringSupport;
    private static boolean threadContentionMonitoringSupport;
    private static boolean currentThreadCpuTimeSupport;
    private static boolean otherThreadCpuTimeSupport;
    private static boolean bootClassPathSupport;
    private static boolean objectMonitorUsageSupport;
    private static boolean synchronizerUsageSupport;
    private static boolean threadAllocatedMemorySupport;
    private static boolean gcNotificationSupport;
    private static boolean remoteDiagnosticCommandsSupport;


    static {
<span class="fc" id="L64">        version = getVersion0();</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">        if (version == null) {</span>
<span class="nc" id="L66">            throw new AssertionError(&quot;Invalid Management Version&quot;);</span>
        }
<span class="fc" id="L68">        initOptionalSupportFields();</span>
<span class="fc" id="L69">    }</span>
    private native static String getVersion0();
    private native static void initOptionalSupportFields();

    // Optional supports
    public boolean isCompilationTimeMonitoringSupported() {
<span class="nc" id="L75">        return compTimeMonitoringSupport;</span>
    }

    public boolean isThreadContentionMonitoringSupported() {
<span class="nc" id="L79">        return threadContentionMonitoringSupport;</span>
    }

    public boolean isCurrentThreadCpuTimeSupported() {
<span class="nc" id="L83">        return currentThreadCpuTimeSupport;</span>
    }

    public boolean isOtherThreadCpuTimeSupported() {
<span class="fc" id="L87">        return otherThreadCpuTimeSupport;</span>
    }

    public boolean isBootClassPathSupported() {
<span class="nc" id="L91">        return bootClassPathSupport;</span>
    }

    public boolean isObjectMonitorUsageSupported() {
<span class="nc" id="L95">        return objectMonitorUsageSupport;</span>
    }

    public boolean isSynchronizerUsageSupported() {
<span class="fc" id="L99">        return synchronizerUsageSupport;</span>
    }

    public boolean isThreadAllocatedMemorySupported() {
<span class="nc" id="L103">        return threadAllocatedMemorySupport;</span>
    }

    public boolean isGcNotificationSupported() {
<span class="nc" id="L107">        return gcNotificationSupport;</span>
    }

    public boolean isRemoteDiagnosticCommandsSupported() {
<span class="nc" id="L111">        return remoteDiagnosticCommandsSupport;</span>
    }

    public native boolean isThreadContentionMonitoringEnabled();
    public native boolean isThreadCpuTimeEnabled();
    public native boolean isThreadAllocatedMemoryEnabled();

    // Class Loading Subsystem
    public int    getLoadedClassCount() {
<span class="nc" id="L120">        long count = getTotalClassCount() - getUnloadedClassCount();</span>
<span class="nc" id="L121">        return (int) count;</span>
    }
    public native long getTotalClassCount();
    public native long getUnloadedClassCount();

    public native boolean getVerboseClass();

    // Memory Subsystem
    public native boolean getVerboseGC();

    // Runtime Subsystem
    public String   getManagementVersion() {
<span class="nc" id="L133">        return version;</span>
    }

    public String getVmId() {
<span class="nc" id="L137">        int pid = getProcessId();</span>
<span class="nc" id="L138">        String hostname = &quot;localhost&quot;;</span>
        try {
<span class="nc" id="L140">            hostname = InetAddress.getLocalHost().getHostName();</span>
<span class="nc" id="L141">        } catch (UnknownHostException e) {</span>
            // ignore
<span class="nc" id="L143">        }</span>

<span class="nc" id="L145">        return pid + &quot;@&quot; + hostname;</span>
    }
    private native int getProcessId();

    public String   getVmName() {
<span class="nc" id="L150">        return System.getProperty(&quot;java.vm.name&quot;);</span>
    }

    public String   getVmVendor() {
<span class="nc" id="L154">        return System.getProperty(&quot;java.vm.vendor&quot;);</span>
    }
    public String   getVmVersion() {
<span class="nc" id="L157">        return System.getProperty(&quot;java.vm.version&quot;);</span>
    }
    public String   getVmSpecName()  {
<span class="nc" id="L160">        return System.getProperty(&quot;java.vm.specification.name&quot;);</span>
    }
    public String   getVmSpecVendor() {
<span class="nc" id="L163">        return System.getProperty(&quot;java.vm.specification.vendor&quot;);</span>
    }
    public String   getVmSpecVersion() {
<span class="nc" id="L166">        return System.getProperty(&quot;java.vm.specification.version&quot;);</span>
    }
    public String   getClassPath() {
<span class="nc" id="L169">        return System.getProperty(&quot;java.class.path&quot;);</span>
    }
    public String   getLibraryPath()  {
<span class="nc" id="L172">        return System.getProperty(&quot;java.library.path&quot;);</span>
    }

    public String   getBootClassPath( ) {
<span class="nc" id="L176">        PrivilegedAction&lt;String&gt; pa</span>
            = new GetPropertyAction(&quot;sun.boot.class.path&quot;);
<span class="nc" id="L178">        String result =  AccessController.doPrivileged(pa);</span>
<span class="nc" id="L179">        return result;</span>
    }

    public long getUptime() {
<span class="nc" id="L183">        return getUptime0();</span>
    }

<span class="fc" id="L186">    private List&lt;String&gt; vmArgs = null;</span>
    public synchronized List&lt;String&gt; getVmArguments() {
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (vmArgs == null) {</span>
<span class="nc" id="L189">            String[] args = getVmArguments0();</span>
<span class="nc bnc" id="L190" title="All 4 branches missed.">            List&lt;String&gt; l = ((args != null &amp;&amp; args.length != 0) ? Arrays.asList(args) :</span>
<span class="nc" id="L191">                                        Collections.&lt;String&gt;emptyList());</span>
<span class="nc" id="L192">            vmArgs = Collections.unmodifiableList(l);</span>
        }
<span class="nc" id="L194">        return vmArgs;</span>
    }
    public native String[] getVmArguments0();

    public native long getStartupTime();
    private native long getUptime0();
    public native int getAvailableProcessors();

    // Compilation Subsystem
    public String   getCompilerName() {
<span class="nc" id="L204">        String name =  AccessController.doPrivileged(</span>
<span class="nc" id="L205">            new PrivilegedAction&lt;String&gt;() {</span>
                public String run() {
<span class="nc" id="L207">                    return System.getProperty(&quot;sun.management.compiler&quot;);</span>
                }
            });
<span class="nc" id="L210">        return name;</span>
    }
    public native long getTotalCompileTime();

    // Thread Subsystem
    public native long getTotalThreadCount();
    public native int  getLiveThreadCount();
    public native int  getPeakThreadCount();
    public native int  getDaemonThreadCount();

    // Operating System
    public String getOsName() {
<span class="nc" id="L222">        return System.getProperty(&quot;os.name&quot;);</span>
    }
    public String getOsArch() {
<span class="nc" id="L225">        return System.getProperty(&quot;os.arch&quot;);</span>
    }
    public String getOsVersion() {
<span class="nc" id="L228">        return System.getProperty(&quot;os.version&quot;);</span>
    }

    // Hotspot-specific runtime support
    public native long getSafepointCount();
    public native long getTotalSafepointTime();
    public native long getSafepointSyncTime();
    public native long getTotalApplicationNonStoppedTime();

    public native long getLoadedClassSize();
    public native long getUnloadedClassSize();
    public native long getClassLoadingTime();
    public native long getMethodDataSize();
    public native long getInitializedClassCount();
    public native long getClassInitializationTime();
    public native long getClassVerificationTime();

    // Performance Counter Support
<span class="fc" id="L246">    private PerfInstrumentation perfInstr = null;</span>
<span class="fc" id="L247">    private boolean noPerfData = false;</span>

    private synchronized PerfInstrumentation getPerfInstrumentation() {
<span class="nc bnc" id="L250" title="All 4 branches missed.">        if (noPerfData || perfInstr != null) {</span>
<span class="nc" id="L251">             return perfInstr;</span>
        }

        // construct PerfInstrumentation object
<span class="nc" id="L255">        Perf perf =  AccessController.doPrivileged(new Perf.GetPerfAction());</span>
        try {
<span class="nc" id="L257">            ByteBuffer bb = perf.attach(0, &quot;r&quot;);</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">            if (bb.capacity() == 0) {</span>
<span class="nc" id="L259">                noPerfData = true;</span>
<span class="nc" id="L260">                return null;</span>
            }
<span class="nc" id="L262">            perfInstr = new PerfInstrumentation(bb);</span>
<span class="nc" id="L263">        } catch (IllegalArgumentException e) {</span>
            // If the shared memory doesn't exist e.g. if -XX:-UsePerfData
            // was set
<span class="nc" id="L266">            noPerfData = true;</span>
<span class="nc" id="L267">        } catch (IOException e) {</span>
<span class="nc" id="L268">            throw new AssertionError(e);</span>
<span class="nc" id="L269">        }</span>
<span class="nc" id="L270">        return perfInstr;</span>
    }

    public List&lt;Counter&gt; getInternalCounters(String pattern) {
<span class="nc" id="L274">        PerfInstrumentation perf = getPerfInstrumentation();</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (perf != null) {</span>
<span class="nc" id="L276">            return perf.findByPattern(pattern);</span>
        } else {
<span class="nc" id="L278">            return Collections.emptyList();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>