<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GaugeMonitor.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.management.monitor</a> &gt; <span class="el_source">GaugeMonitor.java</span></div><h1>GaugeMonitor.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management.monitor;

import static com.sun.jmx.defaults.JmxProperties.MONITOR_LOGGER;
import java.util.logging.Level;
import javax.management.MBeanNotificationInfo;
import javax.management.ObjectName;
import static javax.management.monitor.Monitor.NumericalType.*;
import static javax.management.monitor.MonitorNotification.*;

/**
 * Defines a monitor MBean designed to observe the values of a gauge attribute.
 *
 * &lt;P&gt; A gauge monitor observes an attribute that is continuously
 * variable with time. A gauge monitor sends notifications as
 * follows:
 *
 * &lt;UL&gt;
 *
 * &lt;LI&gt; if the attribute value is increasing and becomes equal to or
 * greater than the high threshold value, a {@link
 * MonitorNotification#THRESHOLD_HIGH_VALUE_EXCEEDED threshold high
 * notification} is sent. The notify high flag must be set to
 * &lt;CODE&gt;true&lt;/CODE&gt;.
 *
 * &lt;BR&gt;Subsequent crossings of the high threshold value do not cause
 * further notifications unless the attribute value becomes equal to
 * or less than the low threshold value.&lt;/LI&gt;
 *
 * &lt;LI&gt; if the attribute value is decreasing and becomes equal to or
 * less than the low threshold value, a {@link
 * MonitorNotification#THRESHOLD_LOW_VALUE_EXCEEDED threshold low
 * notification} is sent. The notify low flag must be set to
 * &lt;CODE&gt;true&lt;/CODE&gt;.
 *
 * &lt;BR&gt;Subsequent crossings of the low threshold value do not cause
 * further notifications unless the attribute value becomes equal to
 * or greater than the high threshold value.&lt;/LI&gt;
 *
 * &lt;/UL&gt;
 *
 * This provides a hysteresis mechanism to avoid repeated triggering
 * of notifications when the attribute value makes small oscillations
 * around the high or low threshold value.
 *
 * &lt;P&gt; If the gauge difference mode is used, the value of the derived
 * gauge is calculated as the difference between the observed gauge
 * values for two successive observations.
 *
 * &lt;BR&gt;The derived gauge value (V[t]) is calculated using the following method:
 * &lt;UL&gt;
 * &lt;LI&gt;V[t] = gauge[t] - gauge[t-GP]&lt;/LI&gt;
 * &lt;/UL&gt;
 *
 * This implementation of the gauge monitor requires the observed
 * attribute to be of the type integer or floating-point
 * (&lt;CODE&gt;Byte&lt;/CODE&gt;, &lt;CODE&gt;Integer&lt;/CODE&gt;, &lt;CODE&gt;Short&lt;/CODE&gt;,
 * &lt;CODE&gt;Long&lt;/CODE&gt;, &lt;CODE&gt;Float&lt;/CODE&gt;, &lt;CODE&gt;Double&lt;/CODE&gt;).
 *
 *
 * @since 1.5
 */
public class GaugeMonitor extends Monitor implements GaugeMonitorMBean {

    /*
     * ------------------------------------------
     *  PACKAGE CLASSES
     * ------------------------------------------
     */

    static class GaugeMonitorObservedObject extends ObservedObject {

        public GaugeMonitorObservedObject(ObjectName observedObject) {
<span class="nc" id="L98">            super(observedObject);</span>
<span class="nc" id="L99">        }</span>

        public final synchronized boolean getDerivedGaugeValid() {
<span class="nc" id="L102">            return derivedGaugeValid;</span>
        }
        public final synchronized void setDerivedGaugeValid(
                                                 boolean derivedGaugeValid) {
<span class="nc" id="L106">            this.derivedGaugeValid = derivedGaugeValid;</span>
<span class="nc" id="L107">        }</span>
        public final synchronized NumericalType getType() {
<span class="nc" id="L109">            return type;</span>
        }
        public final synchronized void setType(NumericalType type) {
<span class="nc" id="L112">            this.type = type;</span>
<span class="nc" id="L113">        }</span>
        public final synchronized Number getPreviousScanGauge() {
<span class="nc" id="L115">            return previousScanGauge;</span>
        }
        public final synchronized void setPreviousScanGauge(
                                                  Number previousScanGauge) {
<span class="nc" id="L119">            this.previousScanGauge = previousScanGauge;</span>
<span class="nc" id="L120">        }</span>
        public final synchronized int getStatus() {
<span class="nc" id="L122">            return status;</span>
        }
        public final synchronized void setStatus(int status) {
<span class="nc" id="L125">            this.status = status;</span>
<span class="nc" id="L126">        }</span>

        private boolean derivedGaugeValid;
        private NumericalType type;
        private Number previousScanGauge;
        private int status;
    }

    /*
     * ------------------------------------------
     *  PRIVATE VARIABLES
     * ------------------------------------------
     */

    /**
     * Gauge high threshold.
     *
     * &lt;BR&gt;The default value is a null Integer object.
     */
<span class="nc" id="L145">    private Number highThreshold = INTEGER_ZERO;</span>

    /**
     * Gauge low threshold.
     *
     * &lt;BR&gt;The default value is a null Integer object.
     */
<span class="nc" id="L152">    private Number lowThreshold = INTEGER_ZERO;</span>

    /**
     * Flag indicating if the gauge monitor notifies when exceeding
     * the high threshold.
     *
     * &lt;BR&gt;The default value is &lt;CODE&gt;false&lt;/CODE&gt;.
     */
<span class="nc" id="L160">    private boolean notifyHigh = false;</span>

    /**
     * Flag indicating if the gauge monitor notifies when exceeding
     * the low threshold.
     *
     * &lt;BR&gt;The default value is &lt;CODE&gt;false&lt;/CODE&gt;.
     */
<span class="nc" id="L168">    private boolean notifyLow = false;</span>

    /**
     * Flag indicating if the gauge difference mode is used.  If the
     * gauge difference mode is used, the derived gauge is the
     * difference between two consecutive observed values.  Otherwise,
     * the derived gauge is directly the value of the observed
     * attribute.
     *
     * &lt;BR&gt;The default value is set to &lt;CODE&gt;false&lt;/CODE&gt;.
     */
<span class="nc" id="L179">    private boolean differenceMode = false;</span>

<span class="nc" id="L181">    private static final String[] types = {</span>
        RUNTIME_ERROR,
        OBSERVED_OBJECT_ERROR,
        OBSERVED_ATTRIBUTE_ERROR,
        OBSERVED_ATTRIBUTE_TYPE_ERROR,
        THRESHOLD_ERROR,
        THRESHOLD_HIGH_VALUE_EXCEEDED,
        THRESHOLD_LOW_VALUE_EXCEEDED
    };

<span class="nc" id="L191">    private static final MBeanNotificationInfo[] notifsInfo = {</span>
        new MBeanNotificationInfo(
            types,
            &quot;javax.management.monitor.MonitorNotification&quot;,
            &quot;Notifications sent by the GaugeMonitor MBean&quot;)
    };

    // Flags needed to implement the hysteresis mechanism.
    //
    private static final int RISING             = 0;
    private static final int FALLING            = 1;
    private static final int RISING_OR_FALLING  = 2;

    /*
     * ------------------------------------------
     *  CONSTRUCTORS
     * ------------------------------------------
     */

    /**
     * Default constructor.
     */
<span class="nc" id="L213">    public GaugeMonitor() {</span>
<span class="nc" id="L214">    }</span>

    /*
     * ------------------------------------------
     *  PUBLIC METHODS
     * ------------------------------------------
     */

    /**
     * Starts the gauge monitor.
     */
    public synchronized void start() {
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (isActive()) {</span>
<span class="nc" id="L227">            MONITOR_LOGGER.logp(Level.FINER, GaugeMonitor.class.getName(),</span>
                    &quot;start&quot;, &quot;the monitor is already active&quot;);
<span class="nc" id="L229">            return;</span>
        }
        // Reset values.
        //
<span class="nc bnc" id="L233" title="All 2 branches missed.">        for (ObservedObject o : observedObjects) {</span>
<span class="nc" id="L234">            final GaugeMonitorObservedObject gmo =</span>
                (GaugeMonitorObservedObject) o;
<span class="nc" id="L236">            gmo.setStatus(RISING_OR_FALLING);</span>
<span class="nc" id="L237">            gmo.setPreviousScanGauge(null);</span>
<span class="nc" id="L238">        }</span>
<span class="nc" id="L239">        doStart();</span>
<span class="nc" id="L240">    }</span>

    /**
     * Stops the gauge monitor.
     */
    public synchronized void stop() {
<span class="nc" id="L246">        doStop();</span>
<span class="nc" id="L247">    }</span>

    // GETTERS AND SETTERS
    //--------------------

    /**
     * Gets the derived gauge of the specified object, if this object is
     * contained in the set of observed MBeans, or &lt;code&gt;null&lt;/code&gt; otherwise.
     *
     * @param object the name of the MBean.
     *
     * @return The derived gauge of the specified object.
     *
     */
    @Override
    public synchronized Number getDerivedGauge(ObjectName object) {
<span class="nc" id="L263">        return (Number) super.getDerivedGauge(object);</span>
    }

    /**
     * Gets the derived gauge timestamp of the specified object, if
     * this object is contained in the set of observed MBeans, or
     * &lt;code&gt;0&lt;/code&gt; otherwise.
     *
     * @param object the name of the object whose derived gauge
     * timestamp is to be returned.
     *
     * @return The derived gauge timestamp of the specified object.
     *
     */
    @Override
    public synchronized long getDerivedGaugeTimeStamp(ObjectName object) {
<span class="nc" id="L279">        return super.getDerivedGaugeTimeStamp(object);</span>
    }

    /**
     * Returns the derived gauge of the first object in the set of
     * observed MBeans.
     *
     * @return The derived gauge.
     *
     * @deprecated As of JMX 1.2, replaced by
     * {@link #getDerivedGauge(ObjectName)}
     */
    @Deprecated
    public synchronized Number getDerivedGauge() {
<span class="nc bnc" id="L293" title="All 2 branches missed.">        if (observedObjects.isEmpty()) {</span>
<span class="nc" id="L294">            return null;</span>
        } else {
<span class="nc" id="L296">            return (Number) observedObjects.get(0).getDerivedGauge();</span>
        }
    }

    /**
     * Gets the derived gauge timestamp of the first object in the set
     * of observed MBeans.
     *
     * @return The derived gauge timestamp.
     *
     * @deprecated As of JMX 1.2, replaced by
     * {@link #getDerivedGaugeTimeStamp(ObjectName)}
     */
    @Deprecated
    public synchronized long getDerivedGaugeTimeStamp() {
<span class="nc bnc" id="L311" title="All 2 branches missed.">        if (observedObjects.isEmpty()) {</span>
<span class="nc" id="L312">            return 0;</span>
        } else {
<span class="nc" id="L314">            return observedObjects.get(0).getDerivedGaugeTimeStamp();</span>
        }
    }

    /**
     * Gets the high threshold value common to all observed MBeans.
     *
     * @return The high threshold value.
     *
     * @see #setThresholds
     */
    public synchronized Number getHighThreshold() {
<span class="nc" id="L326">        return highThreshold;</span>
    }

    /**
     * Gets the low threshold value common to all observed MBeans.
     *
     * @return The low threshold value.
     *
     * @see #setThresholds
     */
    public synchronized Number getLowThreshold() {
<span class="nc" id="L337">        return lowThreshold;</span>
    }

    /**
     * Sets the high and the low threshold values common to all
     * observed MBeans.
     *
     * @param highValue The high threshold value.
     * @param lowValue The low threshold value.
     *
     * @exception IllegalArgumentException The specified high/low
     * threshold is null or the low threshold is greater than the high
     * threshold or the high threshold and the low threshold are not
     * of the same type.
     *
     * @see #getHighThreshold
     * @see #getLowThreshold
     */
    public synchronized void setThresholds(Number highValue, Number lowValue)
        throws IllegalArgumentException {

<span class="nc bnc" id="L358" title="All 4 branches missed.">        if ((highValue == null) || (lowValue == null)) {</span>
<span class="nc" id="L359">            throw new IllegalArgumentException(&quot;Null threshold value&quot;);</span>
        }

<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (highValue.getClass() != lowValue.getClass()) {</span>
<span class="nc" id="L363">            throw new IllegalArgumentException(&quot;Different type &quot; +</span>
                                               &quot;threshold values&quot;);
        }

<span class="nc bnc" id="L367" title="All 2 branches missed.">        if (isFirstStrictlyGreaterThanLast(lowValue, highValue,</span>
<span class="nc" id="L368">                                           highValue.getClass().getName())) {</span>
<span class="nc" id="L369">            throw new IllegalArgumentException(&quot;High threshold less than &quot; +</span>
                                               &quot;low threshold&quot;);
        }

<span class="nc bnc" id="L373" title="All 4 branches missed.">        if (highThreshold.equals(highValue) &amp;&amp; lowThreshold.equals(lowValue))</span>
<span class="nc" id="L374">            return;</span>
<span class="nc" id="L375">        highThreshold = highValue;</span>
<span class="nc" id="L376">        lowThreshold = lowValue;</span>

        // Reset values.
        //
<span class="nc" id="L380">        int index = 0;</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">        for (ObservedObject o : observedObjects) {</span>
<span class="nc" id="L382">            resetAlreadyNotified(o, index++, THRESHOLD_ERROR_NOTIFIED);</span>
<span class="nc" id="L383">            final GaugeMonitorObservedObject gmo =</span>
                (GaugeMonitorObservedObject) o;
<span class="nc" id="L385">            gmo.setStatus(RISING_OR_FALLING);</span>
<span class="nc" id="L386">        }</span>
<span class="nc" id="L387">    }</span>

    /**
     * Gets the high notification's on/off switch value common to all
     * observed MBeans.
     *
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if the gauge monitor notifies when
     * exceeding the high threshold, &lt;CODE&gt;false&lt;/CODE&gt; otherwise.
     *
     * @see #setNotifyHigh
     */
    public synchronized boolean getNotifyHigh() {
<span class="nc" id="L399">        return notifyHigh;</span>
    }

    /**
     * Sets the high notification's on/off switch value common to all
     * observed MBeans.
     *
     * @param value The high notification's on/off switch value.
     *
     * @see #getNotifyHigh
     */
    public synchronized void setNotifyHigh(boolean value) {
<span class="nc bnc" id="L411" title="All 2 branches missed.">        if (notifyHigh == value)</span>
<span class="nc" id="L412">            return;</span>
<span class="nc" id="L413">        notifyHigh = value;</span>
<span class="nc" id="L414">    }</span>

    /**
     * Gets the low notification's on/off switch value common to all
     * observed MBeans.
     *
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if the gauge monitor notifies when
     * exceeding the low threshold, &lt;CODE&gt;false&lt;/CODE&gt; otherwise.
     *
     * @see #setNotifyLow
     */
    public synchronized boolean getNotifyLow() {
<span class="nc" id="L426">        return notifyLow;</span>
    }

    /**
     * Sets the low notification's on/off switch value common to all
     * observed MBeans.
     *
     * @param value The low notification's on/off switch value.
     *
     * @see #getNotifyLow
     */
    public synchronized void setNotifyLow(boolean value) {
<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (notifyLow == value)</span>
<span class="nc" id="L439">            return;</span>
<span class="nc" id="L440">        notifyLow = value;</span>
<span class="nc" id="L441">    }</span>

    /**
     * Gets the difference mode flag value common to all observed MBeans.
     *
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if the difference mode is used,
     * &lt;CODE&gt;false&lt;/CODE&gt; otherwise.
     *
     * @see #setDifferenceMode
     */
    public synchronized boolean getDifferenceMode() {
<span class="nc" id="L452">        return differenceMode;</span>
    }

    /**
     * Sets the difference mode flag value common to all observed MBeans.
     *
     * @param value The difference mode flag value.
     *
     * @see #getDifferenceMode
     */
    public synchronized void setDifferenceMode(boolean value) {
<span class="nc bnc" id="L463" title="All 2 branches missed.">        if (differenceMode == value)</span>
<span class="nc" id="L464">            return;</span>
<span class="nc" id="L465">        differenceMode = value;</span>

        // Reset values.
        //
<span class="nc bnc" id="L469" title="All 2 branches missed.">        for (ObservedObject o : observedObjects) {</span>
<span class="nc" id="L470">            final GaugeMonitorObservedObject gmo =</span>
                (GaugeMonitorObservedObject) o;
<span class="nc" id="L472">            gmo.setStatus(RISING_OR_FALLING);</span>
<span class="nc" id="L473">            gmo.setPreviousScanGauge(null);</span>
<span class="nc" id="L474">        }</span>
<span class="nc" id="L475">    }</span>

   /**
     * Returns a &lt;CODE&gt;NotificationInfo&lt;/CODE&gt; object containing the
     * name of the Java class of the notification and the notification
     * types sent by the gauge monitor.
     */
    @Override
    public MBeanNotificationInfo[] getNotificationInfo() {
<span class="nc" id="L484">        return notifsInfo.clone();</span>
    }

    /*
     * ------------------------------------------
     *  PRIVATE METHODS
     * ------------------------------------------
     */

    /**
     * Updates the derived gauge attribute of the observed object.
     *
     * @param scanGauge The value of the observed attribute.
     * @param o The observed object.
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if the derived gauge value is valid,
     * &lt;CODE&gt;false&lt;/CODE&gt; otherwise.  The derived gauge value is
     * invalid when the differenceMode flag is set to
     * &lt;CODE&gt;true&lt;/CODE&gt; and it is the first notification (so we
     * haven't 2 consecutive values to update the derived gauge).
     */
    private synchronized boolean updateDerivedGauge(
        Object scanGauge, GaugeMonitorObservedObject o) {

        boolean is_derived_gauge_valid;

        // The gauge difference mode is used.
        //
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (differenceMode) {</span>

            // The previous scan gauge has been initialized.
            //
<span class="nc bnc" id="L515" title="All 2 branches missed.">            if (o.getPreviousScanGauge() != null) {</span>
<span class="nc" id="L516">                setDerivedGaugeWithDifference((Number)scanGauge, o);</span>
<span class="nc" id="L517">                is_derived_gauge_valid = true;</span>
            }
            // The previous scan gauge has not been initialized.
            // We cannot update the derived gauge...
            //
            else {
<span class="nc" id="L523">                is_derived_gauge_valid = false;</span>
            }
<span class="nc" id="L525">            o.setPreviousScanGauge((Number)scanGauge);</span>
        }
        // The gauge difference mode is not used.
        //
        else {
<span class="nc" id="L530">            o.setDerivedGauge((Number)scanGauge);</span>
<span class="nc" id="L531">            is_derived_gauge_valid = true;</span>
        }

<span class="nc" id="L534">        return is_derived_gauge_valid;</span>
    }

    /**
     * Updates the notification attribute of the observed object
     * and notifies the listeners only once if the notify flag
     * is set to &lt;CODE&gt;true&lt;/CODE&gt;.
     * @param o The observed object.
     */
    private synchronized MonitorNotification updateNotifications(
        GaugeMonitorObservedObject o) {

<span class="nc" id="L546">        MonitorNotification n = null;</span>

        // Send high notification if notifyHigh is true.
        // Send low notification if notifyLow is true.
        //
<span class="nc bnc" id="L551" title="All 2 branches missed.">        if (o.getStatus() == RISING_OR_FALLING) {</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">            if (isFirstGreaterThanLast((Number)o.getDerivedGauge(),</span>
                                       highThreshold,
<span class="nc" id="L554">                                       o.getType())) {</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">                if (notifyHigh) {</span>
<span class="nc" id="L556">                    n = new MonitorNotification(</span>
                            THRESHOLD_HIGH_VALUE_EXCEEDED,
                            this,
                            0,
                            0,
                            &quot;&quot;,
                            null,
                            null,
                            null,
                            highThreshold);
                }
<span class="nc" id="L567">                o.setStatus(FALLING);</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">            } else if (isFirstGreaterThanLast(lowThreshold,</span>
<span class="nc" id="L569">                                              (Number)o.getDerivedGauge(),</span>
<span class="nc" id="L570">                                              o.getType())) {</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">                if (notifyLow) {</span>
<span class="nc" id="L572">                    n = new MonitorNotification(</span>
                            THRESHOLD_LOW_VALUE_EXCEEDED,
                            this,
                            0,
                            0,
                            &quot;&quot;,
                            null,
                            null,
                            null,
                            lowThreshold);
                }
<span class="nc" id="L583">                o.setStatus(RISING);</span>
            }
        } else {
<span class="nc bnc" id="L586" title="All 2 branches missed.">            if (o.getStatus() == RISING) {</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (isFirstGreaterThanLast((Number)o.getDerivedGauge(),</span>
                                           highThreshold,
<span class="nc" id="L589">                                           o.getType())) {</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                    if (notifyHigh) {</span>
<span class="nc" id="L591">                        n = new MonitorNotification(</span>
                                THRESHOLD_HIGH_VALUE_EXCEEDED,
                                this,
                                0,
                                0,
                                &quot;&quot;,
                                null,
                                null,
                                null,
                                highThreshold);
                    }
<span class="nc" id="L602">                    o.setStatus(FALLING);</span>
                }
<span class="nc bnc" id="L604" title="All 2 branches missed.">            } else if (o.getStatus() == FALLING) {</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">                if (isFirstGreaterThanLast(lowThreshold,</span>
<span class="nc" id="L606">                                           (Number)o.getDerivedGauge(),</span>
<span class="nc" id="L607">                                           o.getType())) {</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">                    if (notifyLow) {</span>
<span class="nc" id="L609">                        n = new MonitorNotification(</span>
                                THRESHOLD_LOW_VALUE_EXCEEDED,
                                this,
                                0,
                                0,
                                &quot;&quot;,
                                null,
                                null,
                                null,
                                lowThreshold);
                    }
<span class="nc" id="L620">                    o.setStatus(RISING);</span>
                }
            }
        }

<span class="nc" id="L625">        return n;</span>
    }

    /**
     * Sets the derived gauge when the differenceMode flag is set to
     * &lt;CODE&gt;true&lt;/CODE&gt;.  Both integer and floating-point types are
     * allowed.
     *
     * @param scanGauge The value of the observed attribute.
     * @param o The observed object.
     */
    private synchronized void setDerivedGaugeWithDifference(
        Number scanGauge, GaugeMonitorObservedObject o) {
<span class="nc" id="L638">        Number prev = o.getPreviousScanGauge();</span>
        Number der;
<span class="nc bnc" id="L640" title="All 7 branches missed.">        switch (o.getType()) {</span>
        case INTEGER:
<span class="nc" id="L642">            der = Integer.valueOf(((Integer)scanGauge).intValue() -</span>
<span class="nc" id="L643">                                  ((Integer)prev).intValue());</span>
<span class="nc" id="L644">            break;</span>
        case BYTE:
<span class="nc" id="L646">            der = Byte.valueOf((byte)(((Byte)scanGauge).byteValue() -</span>
<span class="nc" id="L647">                                      ((Byte)prev).byteValue()));</span>
<span class="nc" id="L648">            break;</span>
        case SHORT:
<span class="nc" id="L650">            der = Short.valueOf((short)(((Short)scanGauge).shortValue() -</span>
<span class="nc" id="L651">                                        ((Short)prev).shortValue()));</span>
<span class="nc" id="L652">            break;</span>
        case LONG:
<span class="nc" id="L654">            der = Long.valueOf(((Long)scanGauge).longValue() -</span>
<span class="nc" id="L655">                               ((Long)prev).longValue());</span>
<span class="nc" id="L656">            break;</span>
        case FLOAT:
<span class="nc" id="L658">            der = Float.valueOf(((Float)scanGauge).floatValue() -</span>
<span class="nc" id="L659">                                ((Float)prev).floatValue());</span>
<span class="nc" id="L660">            break;</span>
        case DOUBLE:
<span class="nc" id="L662">            der = Double.valueOf(((Double)scanGauge).doubleValue() -</span>
<span class="nc" id="L663">                                 ((Double)prev).doubleValue());</span>
<span class="nc" id="L664">            break;</span>
        default:
            // Should never occur...
<span class="nc" id="L667">            MONITOR_LOGGER.logp(Level.FINEST, GaugeMonitor.class.getName(),</span>
                    &quot;setDerivedGaugeWithDifference&quot;,
                    &quot;the threshold type is invalid&quot;);
<span class="nc" id="L670">            return;</span>
        }
<span class="nc" id="L672">        o.setDerivedGauge(der);</span>
<span class="nc" id="L673">    }</span>

    /**
     * Tests if the first specified Number is greater than or equal to
     * the last.  Both integer and floating-point types are allowed.
     *
     * @param greater The first Number to compare with the second.
     * @param less The second Number to compare with the first.
     * @param type The number type.
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if the first specified Number is
     * greater than or equal to the last, &lt;CODE&gt;false&lt;/CODE&gt;
     * otherwise.
     */
    private boolean isFirstGreaterThanLast(Number greater,
                                           Number less,
                                           NumericalType type) {

<span class="nc bnc" id="L690" title="All 3 branches missed.">        switch (type) {</span>
        case INTEGER:
        case BYTE:
        case SHORT:
        case LONG:
<span class="nc bnc" id="L695" title="All 2 branches missed.">            return (greater.longValue() &gt;= less.longValue());</span>
        case FLOAT:
        case DOUBLE:
<span class="nc bnc" id="L698" title="All 2 branches missed.">            return (greater.doubleValue() &gt;= less.doubleValue());</span>
        default:
            // Should never occur...
<span class="nc" id="L701">            MONITOR_LOGGER.logp(Level.FINEST, GaugeMonitor.class.getName(),</span>
                    &quot;isFirstGreaterThanLast&quot;,
                    &quot;the threshold type is invalid&quot;);
<span class="nc" id="L704">            return false;</span>
        }
    }

    /**
     * Tests if the first specified Number is strictly greater than the last.
     * Both integer and floating-point types are allowed.
     *
     * @param greater The first Number to compare with the second.
     * @param less The second Number to compare with the first.
     * @param className The number class name.
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if the first specified Number is
     * strictly greater than the last, &lt;CODE&gt;false&lt;/CODE&gt; otherwise.
     */
    private boolean isFirstStrictlyGreaterThanLast(Number greater,
                                                   Number less,
                                                   String className) {

<span class="nc bnc" id="L722" title="All 2 branches missed.">        if (className.equals(&quot;java.lang.Integer&quot;) ||</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">            className.equals(&quot;java.lang.Byte&quot;) ||</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">            className.equals(&quot;java.lang.Short&quot;) ||</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">            className.equals(&quot;java.lang.Long&quot;)) {</span>

<span class="nc bnc" id="L727" title="All 2 branches missed.">            return (greater.longValue() &gt; less.longValue());</span>
        }
<span class="nc bnc" id="L729" title="All 2 branches missed.">        else if (className.equals(&quot;java.lang.Float&quot;) ||</span>
<span class="nc bnc" id="L730" title="All 2 branches missed.">                 className.equals(&quot;java.lang.Double&quot;)) {</span>

<span class="nc bnc" id="L732" title="All 2 branches missed.">            return (greater.doubleValue() &gt; less.doubleValue());</span>
        }
        else {
            // Should never occur...
<span class="nc" id="L736">            MONITOR_LOGGER.logp(Level.FINEST, GaugeMonitor.class.getName(),</span>
                    &quot;isFirstStrictlyGreaterThanLast&quot;,
                    &quot;the threshold type is invalid&quot;);
<span class="nc" id="L739">            return false;</span>
        }
    }

    /*
     * ------------------------------------------
     *  PACKAGE METHODS
     * ------------------------------------------
     */

    /**
     * Factory method for ObservedObject creation.
     *
     * @since 1.6
     */
    @Override
    ObservedObject createObservedObject(ObjectName object) {
<span class="nc" id="L756">        final GaugeMonitorObservedObject gmo =</span>
            new GaugeMonitorObservedObject(object);
<span class="nc" id="L758">        gmo.setStatus(RISING_OR_FALLING);</span>
<span class="nc" id="L759">        gmo.setPreviousScanGauge(null);</span>
<span class="nc" id="L760">        return gmo;</span>
    }

    /**
     * This method globally sets the derived gauge type for the given
     * &quot;object&quot; and &quot;attribute&quot; after checking that the type of the
     * supplied observed attribute value is one of the value types
     * supported by this monitor.
     */
    @Override
    synchronized boolean isComparableTypeValid(ObjectName object,
                                               String attribute,
                                               Comparable&lt;?&gt; value) {
<span class="nc" id="L773">        final GaugeMonitorObservedObject o =</span>
<span class="nc" id="L774">            (GaugeMonitorObservedObject) getObservedObject(object);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">        if (o == null)</span>
<span class="nc" id="L776">            return false;</span>

        // Check that the observed attribute is either of type
        // &quot;Integer&quot; or &quot;Float&quot;.
        //
<span class="nc bnc" id="L781" title="All 2 branches missed.">        if (value instanceof Integer) {</span>
<span class="nc" id="L782">            o.setType(INTEGER);</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">        } else if (value instanceof Byte) {</span>
<span class="nc" id="L784">            o.setType(BYTE);</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">        } else if (value instanceof Short) {</span>
<span class="nc" id="L786">            o.setType(SHORT);</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">        } else if (value instanceof Long) {</span>
<span class="nc" id="L788">            o.setType(LONG);</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">        } else if (value instanceof Float) {</span>
<span class="nc" id="L790">            o.setType(FLOAT);</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">        } else if (value instanceof Double) {</span>
<span class="nc" id="L792">            o.setType(DOUBLE);</span>
        } else {
<span class="nc" id="L794">            return false;</span>
        }
<span class="nc" id="L796">        return true;</span>
    }

    @Override
    synchronized Comparable&lt;?&gt; getDerivedGaugeFromComparable(
                                                  ObjectName object,
                                                  String attribute,
                                                  Comparable&lt;?&gt; value) {
<span class="nc" id="L804">        final GaugeMonitorObservedObject o =</span>
<span class="nc" id="L805">            (GaugeMonitorObservedObject) getObservedObject(object);</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">        if (o == null)</span>
<span class="nc" id="L807">            return null;</span>

        // Update the derived gauge attributes and check the
        // validity of the new value. The derived gauge value
        // is invalid when the differenceMode flag is set to
        // true and it is the first notification, i.e. we
        // haven't got 2 consecutive values to update the
        // derived gauge.
        //
<span class="nc" id="L816">        o.setDerivedGaugeValid(updateDerivedGauge(value, o));</span>

<span class="nc" id="L818">        return (Comparable&lt;?&gt;) o.getDerivedGauge();</span>
    }

    @Override
    synchronized void onErrorNotification(MonitorNotification notification) {
<span class="nc" id="L823">        final GaugeMonitorObservedObject o = (GaugeMonitorObservedObject)</span>
<span class="nc" id="L824">            getObservedObject(notification.getObservedObject());</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">        if (o == null)</span>
<span class="nc" id="L826">            return;</span>

        // Reset values.
        //
<span class="nc" id="L830">        o.setStatus(RISING_OR_FALLING);</span>
<span class="nc" id="L831">        o.setPreviousScanGauge(null);</span>
<span class="nc" id="L832">    }</span>

    @Override
    synchronized MonitorNotification buildAlarmNotification(
                                               ObjectName object,
                                               String attribute,
                                               Comparable&lt;?&gt; value) {
<span class="nc" id="L839">        final GaugeMonitorObservedObject o =</span>
<span class="nc" id="L840">            (GaugeMonitorObservedObject) getObservedObject(object);</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">        if (o == null)</span>
<span class="nc" id="L842">            return null;</span>

        // Notify the listeners if the updated derived
        // gauge value is valid.
        //
        final MonitorNotification alarm;
<span class="nc bnc" id="L848" title="All 2 branches missed.">        if (o.getDerivedGaugeValid())</span>
<span class="nc" id="L849">            alarm = updateNotifications(o);</span>
        else
<span class="nc" id="L851">            alarm = null;</span>
<span class="nc" id="L852">        return alarm;</span>
    }

    /**
     * Tests if the threshold high and threshold low are both of the
     * same type as the gauge.  Both integer and floating-point types
     * are allowed.
     *
     * Note:
     *   If the optional lowThreshold or highThreshold have not been
     *   initialized, their default value is an Integer object with
     *   a value equal to zero.
     *
     * @param object The observed object.
     * @param attribute The observed attribute.
     * @param value The sample value.
     * @return &lt;CODE&gt;true&lt;/CODE&gt; if type is the same,
     * &lt;CODE&gt;false&lt;/CODE&gt; otherwise.
     */
    @Override
    synchronized boolean isThresholdTypeValid(ObjectName object,
                                              String attribute,
                                              Comparable&lt;?&gt; value) {
<span class="nc" id="L875">        final GaugeMonitorObservedObject o =</span>
<span class="nc" id="L876">            (GaugeMonitorObservedObject) getObservedObject(object);</span>
<span class="nc bnc" id="L877" title="All 2 branches missed.">        if (o == null)</span>
<span class="nc" id="L878">            return false;</span>

<span class="nc" id="L880">        Class&lt;? extends Number&gt; c = classForType(o.getType());</span>
<span class="nc bnc" id="L881" title="All 2 branches missed.">        return (isValidForType(highThreshold, c) &amp;&amp;</span>
<span class="nc bnc" id="L882" title="All 2 branches missed.">                isValidForType(lowThreshold, c));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>