<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>DialogCallbackHandler.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.security.auth.callback</a> &gt; <span class="el_source">DialogCallbackHandler.java</span></div><h1>DialogCallbackHandler.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2012, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.security.auth.callback;

/* JAAS imports */
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.ConfirmationCallback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.callback.TextOutputCallback;
import javax.security.auth.callback.UnsupportedCallbackException;

/* Java imports */
import java.awt.Component;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import javax.swing.Box;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPasswordField;
import javax.swing.JTextField;

/**
 * &lt;p&gt;
 * Uses a Swing dialog window to query the user for answers to
 * authentication questions.
 * This can be used by a JAAS application to instantiate a
 * CallbackHandler
 * @see javax.security.auth.callback
 * @deprecated This class will be removed in a future release.
 */
@jdk.Exported(false)
@Deprecated
public class DialogCallbackHandler implements CallbackHandler {

    /* -- Fields -- */

    /* The parent window, or null if using the default parent */
    private Component parentComponent;
    private static final int JPasswordFieldLen = 8 ;
    private static final int JTextFieldLen = 8 ;

    /* -- Methods -- */

    /**
     * Creates a callback dialog with the default parent window.
     */
<span class="fc" id="L73">    public DialogCallbackHandler() { }</span>

    /**
     * Creates a callback dialog and specify the parent window.
     *
     * @param parentComponent the parent window -- specify &lt;code&gt;null&lt;/code&gt;
     * for the default parent
     */
<span class="nc" id="L81">    public DialogCallbackHandler(Component parentComponent) {</span>
<span class="nc" id="L82">        this.parentComponent = parentComponent;</span>
<span class="nc" id="L83">    }</span>

    /*
     * An interface for recording actions to carry out if the user
     * clicks OK for the dialog.
     */
    private static interface Action {
         void perform();
    }

    /**
     * Handles the specified set of callbacks.
     *
     * @param callbacks the callbacks to handle
     * @throws UnsupportedCallbackException if the callback is not an
     * instance  of NameCallback or PasswordCallback
     */

    public void handle(Callback[] callbacks)
        throws UnsupportedCallbackException
    {
        /* Collect messages to display in the dialog */
<span class="nc" id="L105">        final List&lt;Object&gt; messages = new ArrayList&lt;&gt;(3);</span>

        /* Collection actions to perform if the user clicks OK */
<span class="nc" id="L108">        final List&lt;Action&gt; okActions = new ArrayList&lt;&gt;(2);</span>

<span class="nc" id="L110">        ConfirmationInfo confirmation = new ConfirmationInfo();</span>

<span class="nc bnc" id="L112" title="All 2 branches missed.">        for (int i = 0; i &lt; callbacks.length; i++) {</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">            if (callbacks[i] instanceof TextOutputCallback) {</span>
<span class="nc" id="L114">                TextOutputCallback tc = (TextOutputCallback) callbacks[i];</span>

<span class="nc bnc" id="L116" title="All 4 branches missed.">                switch (tc.getMessageType()) {</span>
                case TextOutputCallback.INFORMATION:
<span class="nc" id="L118">                    confirmation.messageType = JOptionPane.INFORMATION_MESSAGE;</span>
<span class="nc" id="L119">                    break;</span>
                case TextOutputCallback.WARNING:
<span class="nc" id="L121">                    confirmation.messageType = JOptionPane.WARNING_MESSAGE;</span>
<span class="nc" id="L122">                    break;</span>
                case TextOutputCallback.ERROR:
<span class="nc" id="L124">                    confirmation.messageType = JOptionPane.ERROR_MESSAGE;</span>
<span class="nc" id="L125">                    break;</span>
                default:
<span class="nc" id="L127">                    throw new UnsupportedCallbackException(</span>
                        callbacks[i], &quot;Unrecognized message type&quot;);
                }

<span class="nc" id="L131">                messages.add(tc.getMessage());</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">            } else if (callbacks[i] instanceof NameCallback) {</span>
<span class="nc" id="L134">                final NameCallback nc = (NameCallback) callbacks[i];</span>

<span class="nc" id="L136">                JLabel prompt = new JLabel(nc.getPrompt());</span>

<span class="nc" id="L138">                final JTextField name = new JTextField(JTextFieldLen);</span>
<span class="nc" id="L139">                String defaultName = nc.getDefaultName();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                if (defaultName != null) {</span>
<span class="nc" id="L141">                    name.setText(defaultName);</span>
                }

                /*
                 * Put the prompt and name in a horizontal box,
                 * and add that to the set of messages.
                 */
<span class="nc" id="L148">                Box namePanel = Box.createHorizontalBox();</span>
<span class="nc" id="L149">                namePanel.add(prompt);</span>
<span class="nc" id="L150">                namePanel.add(name);</span>
<span class="nc" id="L151">                messages.add(namePanel);</span>

                /* Store the name back into the callback if OK */
<span class="nc" id="L154">                okActions.add(new Action() {</span>
                    public void perform() {
<span class="nc" id="L156">                        nc.setName(name.getText());</span>
<span class="nc" id="L157">                    }</span>
                });

<span class="nc bnc" id="L160" title="All 2 branches missed.">            } else if (callbacks[i] instanceof PasswordCallback) {</span>
<span class="nc" id="L161">                final PasswordCallback pc = (PasswordCallback) callbacks[i];</span>

<span class="nc" id="L163">                JLabel prompt = new JLabel(pc.getPrompt());</span>

<span class="nc" id="L165">                final JPasswordField password =</span>
                                        new JPasswordField(JPasswordFieldLen);
<span class="nc bnc" id="L167" title="All 2 branches missed.">                if (!pc.isEchoOn()) {</span>
<span class="nc" id="L168">                    password.setEchoChar('*');</span>
                }

<span class="nc" id="L171">                Box passwordPanel = Box.createHorizontalBox();</span>
<span class="nc" id="L172">                passwordPanel.add(prompt);</span>
<span class="nc" id="L173">                passwordPanel.add(password);</span>
<span class="nc" id="L174">                messages.add(passwordPanel);</span>

<span class="nc" id="L176">                okActions.add(new Action() {</span>
                    public void perform() {
<span class="nc" id="L178">                        pc.setPassword(password.getPassword());</span>
<span class="nc" id="L179">                    }</span>
                });

<span class="nc bnc" id="L182" title="All 2 branches missed.">            } else if (callbacks[i] instanceof ConfirmationCallback) {</span>
<span class="nc" id="L183">                ConfirmationCallback cc = (ConfirmationCallback)callbacks[i];</span>

<span class="nc" id="L185">                confirmation.setCallback(cc);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if (cc.getPrompt() != null) {</span>
<span class="nc" id="L187">                    messages.add(cc.getPrompt());</span>
                }

<span class="nc" id="L190">            } else {</span>
<span class="nc" id="L191">                throw new UnsupportedCallbackException(</span>
                    callbacks[i], &quot;Unrecognized Callback&quot;);
            }
        }

        /* Display the dialog */
<span class="nc" id="L197">        int result = JOptionPane.showOptionDialog(</span>
            parentComponent,
<span class="nc" id="L199">            messages.toArray(),</span>
            &quot;Confirmation&quot;,                     /* title */
            confirmation.optionType,
            confirmation.messageType,
            null,                               /* icon */
            confirmation.options,               /* options */
            confirmation.initialValue);         /* initialValue */

        /* Perform the OK actions */
<span class="nc bnc" id="L208" title="All 4 branches missed.">        if (result == JOptionPane.OK_OPTION</span>
            || result == JOptionPane.YES_OPTION)
        {
<span class="nc" id="L211">            Iterator&lt;Action&gt; iterator = okActions.iterator();</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">            while (iterator.hasNext()) {</span>
<span class="nc" id="L213">                iterator.next().perform();</span>
            }
        }
<span class="nc" id="L216">        confirmation.handleResult(result);</span>
<span class="nc" id="L217">    }</span>

    /*
     * Provides assistance with translating between JAAS and Swing
     * confirmation dialogs.
     */
<span class="nc" id="L223">    private static class ConfirmationInfo {</span>

        private int[] translations;

<span class="nc" id="L227">        int optionType = JOptionPane.OK_CANCEL_OPTION;</span>
<span class="nc" id="L228">        Object[] options = null;</span>
<span class="nc" id="L229">        Object initialValue = null;</span>

<span class="nc" id="L231">        int messageType = JOptionPane.QUESTION_MESSAGE;</span>

        private ConfirmationCallback callback;

        /* Set the confirmation callback handler */
        void setCallback(ConfirmationCallback callback)
            throws UnsupportedCallbackException
        {
<span class="nc" id="L239">            this.callback = callback;</span>

<span class="nc" id="L241">            int confirmationOptionType = callback.getOptionType();</span>
<span class="nc bnc" id="L242" title="All 5 branches missed.">            switch (confirmationOptionType) {</span>
            case ConfirmationCallback.YES_NO_OPTION:
<span class="nc" id="L244">                optionType = JOptionPane.YES_NO_OPTION;</span>
<span class="nc" id="L245">                translations = new int[] {</span>
                    JOptionPane.YES_OPTION, ConfirmationCallback.YES,
                    JOptionPane.NO_OPTION, ConfirmationCallback.NO,
                    JOptionPane.CLOSED_OPTION, ConfirmationCallback.NO
                };
<span class="nc" id="L250">                break;</span>
            case ConfirmationCallback.YES_NO_CANCEL_OPTION:
<span class="nc" id="L252">                optionType = JOptionPane.YES_NO_CANCEL_OPTION;</span>
<span class="nc" id="L253">                translations = new int[] {</span>
                    JOptionPane.YES_OPTION, ConfirmationCallback.YES,
                    JOptionPane.NO_OPTION, ConfirmationCallback.NO,
                    JOptionPane.CANCEL_OPTION, ConfirmationCallback.CANCEL,
                    JOptionPane.CLOSED_OPTION, ConfirmationCallback.CANCEL
                };
<span class="nc" id="L259">                break;</span>
            case ConfirmationCallback.OK_CANCEL_OPTION:
<span class="nc" id="L261">                optionType = JOptionPane.OK_CANCEL_OPTION;</span>
<span class="nc" id="L262">                translations = new int[] {</span>
                    JOptionPane.OK_OPTION, ConfirmationCallback.OK,
                    JOptionPane.CANCEL_OPTION, ConfirmationCallback.CANCEL,
                    JOptionPane.CLOSED_OPTION, ConfirmationCallback.CANCEL
                };
<span class="nc" id="L267">                break;</span>
            case ConfirmationCallback.UNSPECIFIED_OPTION:
<span class="nc" id="L269">                options = callback.getOptions();</span>
                /*
                 * There's no way to know if the default option means
                 * to cancel the login, but there isn't a better way
                 * to guess this.
                 */
<span class="nc" id="L275">                translations = new int[] {</span>
<span class="nc" id="L276">                    JOptionPane.CLOSED_OPTION, callback.getDefaultOption()</span>
                };
<span class="nc" id="L278">                break;</span>
            default:
<span class="nc" id="L280">                throw new UnsupportedCallbackException(</span>
                    callback,
                    &quot;Unrecognized option type: &quot; + confirmationOptionType);
            }

<span class="nc" id="L285">            int confirmationMessageType = callback.getMessageType();</span>
<span class="nc bnc" id="L286" title="All 4 branches missed.">            switch (confirmationMessageType) {</span>
            case ConfirmationCallback.WARNING:
<span class="nc" id="L288">                messageType = JOptionPane.WARNING_MESSAGE;</span>
<span class="nc" id="L289">                break;</span>
            case ConfirmationCallback.ERROR:
<span class="nc" id="L291">                messageType = JOptionPane.ERROR_MESSAGE;</span>
<span class="nc" id="L292">                break;</span>
            case ConfirmationCallback.INFORMATION:
<span class="nc" id="L294">                messageType = JOptionPane.INFORMATION_MESSAGE;</span>
<span class="nc" id="L295">                break;</span>
            default:
<span class="nc" id="L297">                throw new UnsupportedCallbackException(</span>
                    callback,
                    &quot;Unrecognized message type: &quot; + confirmationMessageType);
            }
<span class="nc" id="L301">        }</span>


        /* Process the result returned by the Swing dialog */
        void handleResult(int result) {
<span class="nc bnc" id="L306" title="All 2 branches missed.">            if (callback == null) {</span>
<span class="nc" id="L307">                return;</span>
            }

<span class="nc bnc" id="L310" title="All 2 branches missed.">            for (int i = 0; i &lt; translations.length; i += 2) {</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                if (translations[i] == result) {</span>
<span class="nc" id="L312">                    result = translations[i + 1];</span>
<span class="nc" id="L313">                    break;</span>
                }
            }
<span class="nc" id="L316">            callback.setSelectedIndex(result);</span>
<span class="nc" id="L317">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>