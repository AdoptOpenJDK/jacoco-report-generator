<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PosixFilePermissions.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.nio.file.attribute</a> &gt; <span class="el_source">PosixFilePermissions.java</span></div><h1>PosixFilePermissions.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2007, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.nio.file.attribute;

import static java.nio.file.attribute.PosixFilePermission.*;
import java.util.*;

/**
 * This class consists exclusively of static methods that operate on sets of
 * {@link PosixFilePermission} objects.
 *
 * @since 1.7
 */

public final class PosixFilePermissions {
<span class="nc" id="L39">    private PosixFilePermissions() { }</span>

    // Write string representation of permission bits to {@code sb}.
    private static void writeBits(StringBuilder sb, boolean r, boolean w, boolean x) {
<span class="nc bnc" id="L43" title="All 2 branches missed.">        if (r) {</span>
<span class="nc" id="L44">            sb.append('r');</span>
        } else {
<span class="nc" id="L46">            sb.append('-');</span>
        }
<span class="nc bnc" id="L48" title="All 2 branches missed.">        if (w) {</span>
<span class="nc" id="L49">            sb.append('w');</span>
        } else {
<span class="nc" id="L51">            sb.append('-');</span>
        }
<span class="nc bnc" id="L53" title="All 2 branches missed.">        if (x) {</span>
<span class="nc" id="L54">            sb.append('x');</span>
        } else {
<span class="nc" id="L56">            sb.append('-');</span>
        }
<span class="nc" id="L58">    }</span>

    /**
     * Returns the {@code String} representation of a set of permissions. It
     * is guaranteed that the returned {@code String} can be parsed by the
     * {@link #fromString} method.
     *
     * &lt;p&gt; If the set contains {@code null} or elements that are not of type
     * {@code PosixFilePermission} then these elements are ignored.
     *
     * @param   perms
     *          the set of permissions
     *
     * @return  the string representation of the permission set
     */
    public static String toString(Set&lt;PosixFilePermission&gt; perms) {
<span class="nc" id="L74">        StringBuilder sb = new StringBuilder(9);</span>
<span class="nc" id="L75">        writeBits(sb, perms.contains(OWNER_READ), perms.contains(OWNER_WRITE),</span>
<span class="nc" id="L76">          perms.contains(OWNER_EXECUTE));</span>
<span class="nc" id="L77">        writeBits(sb, perms.contains(GROUP_READ), perms.contains(GROUP_WRITE),</span>
<span class="nc" id="L78">          perms.contains(GROUP_EXECUTE));</span>
<span class="nc" id="L79">        writeBits(sb, perms.contains(OTHERS_READ), perms.contains(OTHERS_WRITE),</span>
<span class="nc" id="L80">          perms.contains(OTHERS_EXECUTE));</span>
<span class="nc" id="L81">        return sb.toString();</span>
    }

    private static boolean isSet(char c, char setValue) {
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (c == setValue)</span>
<span class="nc" id="L86">            return true;</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">        if (c == '-')</span>
<span class="nc" id="L88">            return false;</span>
<span class="nc" id="L89">        throw new IllegalArgumentException(&quot;Invalid mode&quot;);</span>
    }
<span class="nc" id="L91">    private static boolean isR(char c) { return isSet(c, 'r'); }</span>
<span class="nc" id="L92">    private static boolean isW(char c) { return isSet(c, 'w'); }</span>
<span class="nc" id="L93">    private static boolean isX(char c) { return isSet(c, 'x'); }</span>

    /**
     * Returns the set of permissions corresponding to a given {@code String}
     * representation.
     *
     * &lt;p&gt; The {@code perms} parameter is a {@code String} representing the
     * permissions. It has 9 characters that are interpreted as three sets of
     * three. The first set refers to the owner's permissions; the next to the
     * group permissions and the last to others. Within each set, the first
     * character is {@code 'r'} to indicate permission to read, the second
     * character is {@code 'w'} to indicate permission to write, and the third
     * character is {@code 'x'} for execute permission. Where a permission is
     * not set then the corresponding character is set to {@code '-'}.
     *
     * &lt;p&gt; &lt;b&gt;Usage Example:&lt;/b&gt;
     * Suppose we require the set of permissions that indicate the owner has read,
     * write, and execute permissions, the group has read and execute permissions
     * and others have none.
     * &lt;pre&gt;
     *   Set&amp;lt;PosixFilePermission&amp;gt; perms = PosixFilePermissions.fromString(&quot;rwxr-x---&quot;);
     * &lt;/pre&gt;
     *
     * @param   perms
     *          string representing a set of permissions
     *
     * @return  the resulting set of permissions
     *
     * @throws  IllegalArgumentException
     *          if the string cannot be converted to a set of permissions
     *
     * @see #toString(Set)
     */
    public static Set&lt;PosixFilePermission&gt; fromString(String perms) {
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (perms.length() != 9)</span>
<span class="nc" id="L128">            throw new IllegalArgumentException(&quot;Invalid mode&quot;);</span>
<span class="nc" id="L129">        Set&lt;PosixFilePermission&gt; result = EnumSet.noneOf(PosixFilePermission.class);</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (isR(perms.charAt(0))) result.add(OWNER_READ);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (isW(perms.charAt(1))) result.add(OWNER_WRITE);</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (isX(perms.charAt(2))) result.add(OWNER_EXECUTE);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (isR(perms.charAt(3))) result.add(GROUP_READ);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (isW(perms.charAt(4))) result.add(GROUP_WRITE);</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (isX(perms.charAt(5))) result.add(GROUP_EXECUTE);</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (isR(perms.charAt(6))) result.add(OTHERS_READ);</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (isW(perms.charAt(7))) result.add(OTHERS_WRITE);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (isX(perms.charAt(8))) result.add(OTHERS_EXECUTE);</span>
<span class="nc" id="L139">        return result;</span>
    }

    /**
     * Creates a {@link FileAttribute}, encapsulating a copy of the given file
     * permissions, suitable for passing to the {@link java.nio.file.Files#createFile
     * createFile} or {@link java.nio.file.Files#createDirectory createDirectory}
     * methods.
     *
     * @param   perms
     *          the set of permissions
     *
     * @return  an attribute encapsulating the given file permissions with
     *          {@link FileAttribute#name name} {@code &quot;posix:permissions&quot;}
     *
     * @throws  ClassCastException
     *          if the set contains elements that are not of type {@code
     *          PosixFilePermission}
     */
    public static FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt;
        asFileAttribute(Set&lt;PosixFilePermission&gt; perms)
    {
        // copy set and check for nulls (CCE will be thrown if an element is not
        // a PosixFilePermission)
<span class="fc" id="L163">        perms = new HashSet&lt;PosixFilePermission&gt;(perms);</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">        for (PosixFilePermission p: perms) {</span>
<span class="pc bpc" id="L165" title="1 of 2 branches missed.">            if (p == null)</span>
<span class="nc" id="L166">                throw new NullPointerException();</span>
<span class="fc" id="L167">        }</span>
<span class="fc" id="L168">        final Set&lt;PosixFilePermission&gt; value = perms;</span>
<span class="fc" id="L169">        return new FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt;() {</span>
            @Override
            public String name() {
<span class="fc" id="L172">                return &quot;posix:permissions&quot;;</span>
            }
            @Override
            public Set&lt;PosixFilePermission&gt; value() {
<span class="fc" id="L176">                return Collections.unmodifiableSet(value);</span>
            }
        };
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>