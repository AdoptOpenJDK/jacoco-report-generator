<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>ModelMBeanInfoSupport.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.management.modelmbean</a> &gt; <span class="el_source">ModelMBeanInfoSupport.java</span></div><h1>ModelMBeanInfoSupport.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
/*
 * @author    IBM Corp.
 *
 * Copyright IBM Corp. 1999-2000.  All rights reserved.
 */

package javax.management.modelmbean;

import static com.sun.jmx.defaults.JmxProperties.MODELMBEAN_LOGGER;
import com.sun.jmx.mbeanserver.GetPropertyAction;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.ObjectStreamField;
import java.security.AccessController;
import java.util.logging.Level;

import javax.management.Descriptor;
import javax.management.MBeanAttributeInfo;
import javax.management.MBeanConstructorInfo;
import javax.management.MBeanException;
import javax.management.MBeanInfo;
import javax.management.MBeanNotificationInfo;
import javax.management.MBeanOperationInfo;
import javax.management.RuntimeOperationsException;

/**
 * This class represents the meta data for ModelMBeans.  Descriptors have been
 * added on the meta data objects.
 * &lt;P&gt;
 * Java resources wishing to be manageable instantiate the ModelMBean using the
 * MBeanServer's createMBean method.  The resource then sets the ModelMBeanInfo
 * and Descriptors for the ModelMBean instance. The attributes and operations
 * exposed via the ModelMBeanInfo for the ModelMBean are accessible
 * from MBeans, connectors/adaptors like other MBeans. Through the Descriptors,
 * values and methods in the managed application can be defined and mapped to
 * attributes and operations of the ModelMBean.
 * This mapping can be defined during development in a file or dynamically and
 * programmatically at runtime.
 * &lt;P&gt;
 * Every ModelMBean which is instantiated in the MBeanServer becomes manageable:
 * its attributes and operations
 * become remotely accessible through the connectors/adaptors connected to that
 * MBeanServer.
 * A Java object cannot be registered in the MBeanServer unless it is a JMX
 * compliant MBean.
 * By instantiating a ModelMBean, resources are guaranteed that the MBean is
 * valid.
 *
 * MBeanException and RuntimeOperationsException must be thrown on every public
 * method.  This allows for wrapping exceptions from distributed
 * communications (RMI, EJB, etc.)
 *
 * &lt;p&gt;The &lt;b&gt;serialVersionUID&lt;/b&gt; of this class is
 * &lt;code&gt;-1935722590756516193L&lt;/code&gt;.
 *
 * @since 1.5
 */
@SuppressWarnings(&quot;serial&quot;)
public class ModelMBeanInfoSupport extends MBeanInfo implements ModelMBeanInfo {

    // Serialization compatibility stuff:
    // Two serial forms are supported in this class. The selected form depends
    // on system property &quot;jmx.serial.form&quot;:
    //  - &quot;1.0&quot; for JMX 1.0
    //  - any other value for JMX 1.1 and higher
    //
    // Serial version for old serial form
    private static final long oldSerialVersionUID = -3944083498453227709L;
    //
    // Serial version for new serial form
    private static final long newSerialVersionUID = -1935722590756516193L;
    //
    // Serializable fields in old serial form
<span class="nc" id="L100">    private static final ObjectStreamField[] oldSerialPersistentFields =</span>
    {
        new ObjectStreamField(&quot;modelMBeanDescriptor&quot;, Descriptor.class),
                new ObjectStreamField(&quot;mmbAttributes&quot;, MBeanAttributeInfo[].class),
                new ObjectStreamField(&quot;mmbConstructors&quot;, MBeanConstructorInfo[].class),
                new ObjectStreamField(&quot;mmbNotifications&quot;, MBeanNotificationInfo[].class),
                new ObjectStreamField(&quot;mmbOperations&quot;, MBeanOperationInfo[].class),
                new ObjectStreamField(&quot;currClass&quot;, String.class)
    };
    //
    // Serializable fields in new serial form
<span class="nc" id="L111">    private static final ObjectStreamField[] newSerialPersistentFields =</span>
    {
        new ObjectStreamField(&quot;modelMBeanDescriptor&quot;, Descriptor.class),
                new ObjectStreamField(&quot;modelMBeanAttributes&quot;, MBeanAttributeInfo[].class),
                new ObjectStreamField(&quot;modelMBeanConstructors&quot;, MBeanConstructorInfo[].class),
                new ObjectStreamField(&quot;modelMBeanNotifications&quot;, MBeanNotificationInfo[].class),
                new ObjectStreamField(&quot;modelMBeanOperations&quot;, MBeanOperationInfo[].class)
    };
    //
    // Actual serial version and serial form
    private static final long serialVersionUID;
    /**
     * @serialField modelMBeanDescriptor Descriptor The descriptor containing
     *              MBean wide policy
     * @serialField modelMBeanAttributes ModelMBeanAttributeInfo[] The array of
     *              {@link ModelMBeanAttributeInfo} objects which
     *              have descriptors
     * @serialField modelMBeanConstructors MBeanConstructorInfo[] The array of
     *              {@link ModelMBeanConstructorInfo} objects which
     *              have descriptors
     * @serialField modelMBeanNotifications MBeanNotificationInfo[] The array of
     *              {@link ModelMBeanNotificationInfo} objects which
     *              have descriptors
     * @serialField modelMBeanOperations MBeanOperationInfo[] The array of
     *              {@link ModelMBeanOperationInfo} objects which
     *              have descriptors
     */
    private static final ObjectStreamField[] serialPersistentFields;
<span class="nc" id="L139">    private static boolean compat = false;</span>
    static {
        try {
<span class="nc" id="L142">            GetPropertyAction act = new GetPropertyAction(&quot;jmx.serial.form&quot;);</span>
<span class="nc" id="L143">            String form = AccessController.doPrivileged(act);</span>
<span class="nc bnc" id="L144" title="All 4 branches missed.">            compat = (form != null &amp;&amp; form.equals(&quot;1.0&quot;));</span>
<span class="nc" id="L145">        } catch (Exception e) {</span>
            // OK: No compat with 1.0
<span class="nc" id="L147">        }</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (compat) {</span>
<span class="nc" id="L149">            serialPersistentFields = oldSerialPersistentFields;</span>
<span class="nc" id="L150">            serialVersionUID = oldSerialVersionUID;</span>
        } else {
<span class="nc" id="L152">            serialPersistentFields = newSerialPersistentFields;</span>
<span class="nc" id="L153">            serialVersionUID = newSerialVersionUID;</span>
        }
    }
    //
    // END Serialization compatibility stuff

    /**
     * @serial The descriptor containing MBean wide policy
     */
<span class="nc" id="L162">    private Descriptor modelMBeanDescriptor = null;</span>

    /* The following fields always have the same values as the
       fields inherited from MBeanInfo and are retained only for
       compatibility.  By rewriting the serialization code we could
       get rid of them.

       These fields can't be final because they are assigned to by
       readObject().  */

    /**
     * @serial The array of {@link ModelMBeanAttributeInfo} objects which
     *         have descriptors
     */
    private MBeanAttributeInfo[] modelMBeanAttributes;

    /**
     * @serial The array of {@link ModelMBeanConstructorInfo} objects which
     *         have descriptors
     */
    private MBeanConstructorInfo[] modelMBeanConstructors;

    /**
     * @serial The array of {@link ModelMBeanNotificationInfo} objects which
     *         have descriptors
     */
    private MBeanNotificationInfo[] modelMBeanNotifications;

    /**
     * @serial The array of {@link ModelMBeanOperationInfo} objects which
     *         have descriptors
     */
    private MBeanOperationInfo[] modelMBeanOperations;

    private static final String ATTR = &quot;attribute&quot;;
    private static final String OPER = &quot;operation&quot;;
    private static final String NOTF = &quot;notification&quot;;
    private static final String CONS = &quot;constructor&quot;;
    private static final String MMB = &quot;mbean&quot;;
    private static final String ALL = &quot;all&quot;;
    private static final String currClass = &quot;ModelMBeanInfoSupport&quot;;

    /**
     * Constructs a ModelMBeanInfoSupport which is a duplicate of the given
     * ModelMBeanInfo.  The returned object is a shallow copy of the given
     * object.  Neither the Descriptor nor the contained arrays
     * ({@code ModelMBeanAttributeInfo[]} etc) are cloned.  This method is
     * chiefly of interest to modify the Descriptor of the returned instance
     * via {@link #setDescriptor setDescriptor} without affecting the
     * Descriptor of the original object.
     *
     * @param mbi the ModelMBeanInfo instance from which the ModelMBeanInfo
     * being created is initialized.
     */
    public ModelMBeanInfoSupport(ModelMBeanInfo  mbi) {
<span class="nc" id="L217">        super(mbi.getClassName(),</span>
<span class="nc" id="L218">                mbi.getDescription(),</span>
<span class="nc" id="L219">                mbi.getAttributes(),</span>
<span class="nc" id="L220">                mbi.getConstructors(),</span>
<span class="nc" id="L221">                mbi.getOperations(),</span>
<span class="nc" id="L222">                mbi.getNotifications());</span>

<span class="nc" id="L224">        modelMBeanAttributes = mbi.getAttributes();</span>
<span class="nc" id="L225">        modelMBeanConstructors = mbi.getConstructors();</span>
<span class="nc" id="L226">        modelMBeanOperations = mbi.getOperations();</span>
<span class="nc" id="L227">        modelMBeanNotifications = mbi.getNotifications();</span>

        try {
<span class="nc" id="L230">            Descriptor mbeandescriptor = mbi.getMBeanDescriptor();</span>
<span class="nc" id="L231">            modelMBeanDescriptor = validDescriptor(mbeandescriptor);</span>
<span class="nc" id="L232">        } catch (MBeanException mbe) {</span>
<span class="nc" id="L233">            modelMBeanDescriptor = validDescriptor(null);</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L235">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L236">                        ModelMBeanInfoSupport.class.getName(),</span>
                        &quot;ModelMBeanInfo(ModelMBeanInfo)&quot;,
                        &quot;Could not get a valid modelMBeanDescriptor, &quot; +
                        &quot;setting a default Descriptor&quot;);
            }
<span class="nc" id="L241">        }</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L244">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L245">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;ModelMBeanInfo(ModelMBeanInfo)&quot;, &quot;Exit&quot;);
        }
<span class="nc" id="L248">    }</span>

    /**
     * Creates a ModelMBeanInfoSupport with the provided information,
     * but the descriptor is a default.
     * The default descriptor is: name=className, descriptorType=&quot;mbean&quot;,
     * displayName=className, persistPolicy=&quot;never&quot;, log=&quot;F&quot;, visibility=&quot;1&quot;
     *
     * @param className classname of the MBean
     * @param description human readable description of the
     * ModelMBean
     * @param attributes array of ModelMBeanAttributeInfo objects
     * which have descriptors
     * @param constructors array of ModelMBeanConstructorInfo
     * objects which have descriptors
     * @param operations array of ModelMBeanOperationInfo objects
     * which have descriptors
     * @param notifications array of ModelMBeanNotificationInfo
     * objects which have descriptors
     */
    public ModelMBeanInfoSupport(String className,
            String description,
            ModelMBeanAttributeInfo[] attributes,
            ModelMBeanConstructorInfo[] constructors,
            ModelMBeanOperationInfo[] operations,
            ModelMBeanNotificationInfo[] notifications) {
<span class="nc" id="L274">        this(className, description, attributes, constructors,</span>
                operations, notifications, null);
<span class="nc" id="L276">    }</span>

    /**
     * Creates a ModelMBeanInfoSupport with the provided information
     * and the descriptor given in parameter.
     *
     * @param className classname of the MBean
     * @param description human readable description of the
     * ModelMBean
     * @param attributes array of ModelMBeanAttributeInfo objects
     * which have descriptors
     * @param constructors array of ModelMBeanConstructorInfo
     * objects which have descriptor
     * @param operations array of ModelMBeanOperationInfo objects
     * which have descriptor
     * @param notifications array of ModelMBeanNotificationInfo
     * objects which have descriptor
     * @param mbeandescriptor descriptor to be used as the
     * MBeanDescriptor containing MBean wide policy. If the
     * descriptor is null, a default descriptor will be constructed.
     * The default descriptor is:
     * name=className, descriptorType=&quot;mbean&quot;, displayName=className,
     * persistPolicy=&quot;never&quot;, log=&quot;F&quot;, visibility=&quot;1&quot;.  If the descriptor
     * does not contain all of these fields, the missing ones are
     * added with these default values.
     *
     * @exception RuntimeOperationsException Wraps an
     * IllegalArgumentException for invalid descriptor passed in
     * parameter.  (see {@link #getMBeanDescriptor
     * getMBeanDescriptor} for the definition of a valid MBean
     * descriptor.)
     */

    public ModelMBeanInfoSupport(String    className,
            String description,
            ModelMBeanAttributeInfo[] attributes,
            ModelMBeanConstructorInfo[] constructors,
            ModelMBeanOperationInfo[] operations,
            ModelMBeanNotificationInfo[] notifications,
            Descriptor mbeandescriptor) {
<span class="nc bnc" id="L316" title="All 8 branches missed.">        super(className,</span>
                description,
                (attributes != null) ? attributes : NO_ATTRIBUTES,
                (constructors != null) ? constructors : NO_CONSTRUCTORS,
                (operations != null) ? operations : NO_OPERATIONS,
                (notifications != null) ? notifications : NO_NOTIFICATIONS);
        /* The values saved here are possibly null, but we
           check this everywhere they are referenced.  If at
           some stage we replace null with an empty array
           here, as we do in the superclass constructor
           parameters, then we must also do this in
           readObject().  */
<span class="nc" id="L328">        modelMBeanAttributes = attributes;</span>
<span class="nc" id="L329">        modelMBeanConstructors = constructors;</span>
<span class="nc" id="L330">        modelMBeanOperations = operations;</span>
<span class="nc" id="L331">        modelMBeanNotifications = notifications;</span>
<span class="nc" id="L332">        modelMBeanDescriptor = validDescriptor(mbeandescriptor);</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L334">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L335">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;ModelMBeanInfoSupport(String,String,ModelMBeanAttributeInfo[],&quot; +
                    &quot;ModelMBeanConstructorInfo[],ModelMBeanOperationInfo[],&quot; +
                    &quot;ModelMBeanNotificationInfo[],Descriptor)&quot;,
                    &quot;Exit&quot;);
        }
<span class="nc" id="L341">    }</span>

<span class="nc" id="L343">    private static final ModelMBeanAttributeInfo[] NO_ATTRIBUTES =</span>
            new ModelMBeanAttributeInfo[0];
<span class="nc" id="L345">    private static final ModelMBeanConstructorInfo[] NO_CONSTRUCTORS =</span>
            new ModelMBeanConstructorInfo[0];
<span class="nc" id="L347">    private static final ModelMBeanNotificationInfo[] NO_NOTIFICATIONS =</span>
            new ModelMBeanNotificationInfo[0];
<span class="nc" id="L349">    private static final ModelMBeanOperationInfo[] NO_OPERATIONS =</span>
            new ModelMBeanOperationInfo[0];

    // Java doc inherited from MOdelMBeanInfo interface

    /**
     * Returns a shallow clone of this instance.  Neither the Descriptor nor
     * the contained arrays ({@code ModelMBeanAttributeInfo[]} etc) are
     * cloned.  This method is chiefly of interest to modify the Descriptor
     * of the clone via {@link #setDescriptor setDescriptor} without affecting
     * the Descriptor of the original object.
     *
     * @return a shallow clone of this instance.
     */
    public Object clone() {
<span class="nc" id="L364">        return(new ModelMBeanInfoSupport(this));</span>
    }


    public Descriptor[] getDescriptors(String inDescriptorType)
    throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L371">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L372">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getDescriptors(String)&quot;, &quot;Entry&quot;);
        }

<span class="nc bnc" id="L376" title="All 4 branches missed.">        if ((inDescriptorType == null) || (inDescriptorType.equals(&quot;&quot;))) {</span>
<span class="nc" id="L377">            inDescriptorType = &quot;all&quot;;</span>
        }

        // if no descriptors of that type, will return empty array
        //
        final Descriptor[] retList;

<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (inDescriptorType.equalsIgnoreCase(MMB)) {</span>
<span class="nc" id="L385">            retList = new Descriptor[] {modelMBeanDescriptor};</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(ATTR)) {</span>
<span class="nc" id="L387">            final MBeanAttributeInfo[] attrList = modelMBeanAttributes;</span>
<span class="nc" id="L388">            int numAttrs = 0;</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">            if (attrList != null) numAttrs = attrList.length;</span>

<span class="nc" id="L391">            retList = new Descriptor[numAttrs];</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">            for (int i=0; i &lt; numAttrs; i++) {</span>
<span class="nc" id="L393">                retList[i] = (((ModelMBeanAttributeInfo)</span>
<span class="nc" id="L394">                    attrList[i]).getDescriptor());</span>
            }
<span class="nc bnc" id="L396" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(OPER)) {</span>
<span class="nc" id="L397">            final MBeanOperationInfo[] operList = modelMBeanOperations;</span>
<span class="nc" id="L398">            int numOpers = 0;</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">            if (operList != null) numOpers = operList.length;</span>

<span class="nc" id="L401">            retList = new Descriptor[numOpers];</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">            for (int i=0; i &lt; numOpers; i++) {</span>
<span class="nc" id="L403">                retList[i] = (((ModelMBeanOperationInfo)</span>
<span class="nc" id="L404">                    operList[i]).getDescriptor());</span>
            }
<span class="nc bnc" id="L406" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(CONS)) {</span>
<span class="nc" id="L407">            final MBeanConstructorInfo[] consList =  modelMBeanConstructors;</span>
<span class="nc" id="L408">            int numCons = 0;</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            if (consList != null) numCons = consList.length;</span>

<span class="nc" id="L411">            retList = new Descriptor[numCons];</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">            for (int i=0; i &lt; numCons; i++) {</span>
<span class="nc" id="L413">                retList[i] = (((ModelMBeanConstructorInfo)</span>
<span class="nc" id="L414">                    consList[i]).getDescriptor());</span>
            }
<span class="nc bnc" id="L416" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(NOTF)) {</span>
<span class="nc" id="L417">            final MBeanNotificationInfo[] notifList = modelMBeanNotifications;</span>
<span class="nc" id="L418">            int numNotifs = 0;</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">            if (notifList != null) numNotifs = notifList.length;</span>

<span class="nc" id="L421">            retList = new Descriptor[numNotifs];</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">            for (int i=0; i &lt; numNotifs; i++) {</span>
<span class="nc" id="L423">                retList[i] = (((ModelMBeanNotificationInfo)</span>
<span class="nc" id="L424">                    notifList[i]).getDescriptor());</span>
            }
<span class="nc bnc" id="L426" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(ALL)) {</span>

<span class="nc" id="L428">            final MBeanAttributeInfo[] attrList = modelMBeanAttributes;</span>
<span class="nc" id="L429">            int numAttrs = 0;</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">            if (attrList != null) numAttrs = attrList.length;</span>

<span class="nc" id="L432">            final MBeanOperationInfo[] operList = modelMBeanOperations;</span>
<span class="nc" id="L433">            int numOpers = 0;</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">            if (operList != null) numOpers = operList.length;</span>

<span class="nc" id="L436">            final MBeanConstructorInfo[] consList = modelMBeanConstructors;</span>
<span class="nc" id="L437">            int numCons = 0;</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            if (consList != null) numCons = consList.length;</span>

<span class="nc" id="L440">            final MBeanNotificationInfo[] notifList = modelMBeanNotifications;</span>
<span class="nc" id="L441">            int numNotifs = 0;</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">            if (notifList != null) numNotifs = notifList.length;</span>

<span class="nc" id="L444">            int count = numAttrs + numCons + numOpers + numNotifs + 1;</span>
<span class="nc" id="L445">            retList = new Descriptor[count];</span>

<span class="nc" id="L447">            retList[count-1] = modelMBeanDescriptor;</span>

<span class="nc" id="L449">            int j=0;</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">            for (int i=0; i &lt; numAttrs; i++) {</span>
<span class="nc" id="L451">                retList[j] = (((ModelMBeanAttributeInfo)</span>
<span class="nc" id="L452">                    attrList[i]).getDescriptor());</span>
<span class="nc" id="L453">                j++;</span>
            }
<span class="nc bnc" id="L455" title="All 2 branches missed.">            for (int i=0; i &lt; numCons; i++) {</span>
<span class="nc" id="L456">                retList[j] = (((ModelMBeanConstructorInfo)</span>
<span class="nc" id="L457">                    consList[i]).getDescriptor());</span>
<span class="nc" id="L458">                j++;</span>
            }
<span class="nc bnc" id="L460" title="All 2 branches missed.">            for (int i=0; i &lt; numOpers; i++) {</span>
<span class="nc" id="L461">                retList[j] = (((ModelMBeanOperationInfo)operList[i]).</span>
<span class="nc" id="L462">                        getDescriptor());</span>
<span class="nc" id="L463">                j++;</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">            for (int i=0; i &lt; numNotifs; i++) {</span>
<span class="nc" id="L466">                retList[j] = (((ModelMBeanNotificationInfo)notifList[i]).</span>
<span class="nc" id="L467">                        getDescriptor());</span>
<span class="nc" id="L468">                j++;</span>
            }
<span class="nc" id="L470">        } else {</span>
<span class="nc" id="L471">            final IllegalArgumentException iae =</span>
                    new IllegalArgumentException(&quot;Descriptor Type is invalid&quot;);
            final String msg = &quot;Exception occurred trying to find&quot;+
                    &quot; the descriptors of the MBean&quot;;
<span class="nc" id="L475">            throw new RuntimeOperationsException(iae,msg);</span>
        }
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L478">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L479">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getDescriptors(String)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L483">        return retList;</span>
    }


    public void setDescriptors(Descriptor[] inDescriptors)
    throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L489" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L490">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L491">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;setDescriptors(Descriptor[])&quot;, &quot;Entry&quot;);
        }
<span class="nc bnc" id="L494" title="All 2 branches missed.">        if (inDescriptors==null) {</span>
            // throw RuntimeOperationsException - invalid descriptor
<span class="nc" id="L496">            throw new RuntimeOperationsException(</span>
                    new IllegalArgumentException(&quot;Descriptor list is invalid&quot;),
                    &quot;Exception occurred trying to set the descriptors &quot; +
                    &quot;of the MBeanInfo&quot;);
        }
<span class="nc bnc" id="L501" title="All 2 branches missed.">        if (inDescriptors.length == 0) { // empty list, no-op</span>
<span class="nc" id="L502">            return;</span>
        }
<span class="nc bnc" id="L504" title="All 2 branches missed.">        for (int j=0; j &lt; inDescriptors.length; j++) {</span>
<span class="nc" id="L505">            setDescriptor(inDescriptors[j],null);</span>
        }
<span class="nc bnc" id="L507" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L508">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L509">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;setDescriptors(Descriptor[])&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L513">    }</span>


    /**
     * Returns a Descriptor requested by name.
     *
     * @param inDescriptorName The name of the descriptor.
     *
     * @return Descriptor containing a descriptor for the ModelMBean with the
     *         same name. If no descriptor is found, null is returned.
     *
     * @exception MBeanException Wraps a distributed communication Exception.
     * @exception RuntimeOperationsException Wraps an IllegalArgumentException
     *            for null name.
     *
     * @see #setDescriptor
     */

    public Descriptor getDescriptor(String inDescriptorName)
    throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L534">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L535">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getDescriptor(String)&quot;, &quot;Entry&quot;);
        }
<span class="nc" id="L538">        return(getDescriptor(inDescriptorName, null));</span>
    }


    public Descriptor getDescriptor(String inDescriptorName,
            String inDescriptorType)
            throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L545" title="All 2 branches missed.">        if (inDescriptorName==null) {</span>
            // throw RuntimeOperationsException - invalid descriptor
<span class="nc" id="L547">            throw new RuntimeOperationsException(</span>
                    new IllegalArgumentException(&quot;Descriptor is invalid&quot;),
                    &quot;Exception occurred trying to set the descriptors of &quot; +
                    &quot;the MBeanInfo&quot;);
        }

<span class="nc bnc" id="L553" title="All 2 branches missed.">        if (MMB.equalsIgnoreCase(inDescriptorType)) {</span>
<span class="nc" id="L554">            return (Descriptor) modelMBeanDescriptor.clone();</span>
        }

            /* The logic here is a bit convoluted, because we are
               dealing with two possible cases, depending on whether
               inDescriptorType is null.  If it's not null, then only
               one of the following ifs will run, and it will either
               return a descriptor or null.  If inDescriptorType is
               null, then all of the following ifs will run until one
               of them finds a descriptor.  */
<span class="nc bnc" id="L564" title="All 4 branches missed.">        if (ATTR.equalsIgnoreCase(inDescriptorType) || inDescriptorType == null) {</span>
<span class="nc" id="L565">            ModelMBeanAttributeInfo attr = getAttribute(inDescriptorName);</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if (attr != null)</span>
<span class="nc" id="L567">                return attr.getDescriptor();</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">            if (inDescriptorType != null)</span>
<span class="nc" id="L569">                return null;</span>
        }
<span class="nc bnc" id="L571" title="All 4 branches missed.">        if (OPER.equalsIgnoreCase(inDescriptorType) || inDescriptorType == null) {</span>
<span class="nc" id="L572">            ModelMBeanOperationInfo oper = getOperation(inDescriptorName);</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">            if (oper != null)</span>
<span class="nc" id="L574">                return oper.getDescriptor();</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">            if (inDescriptorType != null)</span>
<span class="nc" id="L576">                return null;</span>
        }
<span class="nc bnc" id="L578" title="All 4 branches missed.">        if (CONS.equalsIgnoreCase(inDescriptorType) || inDescriptorType == null) {</span>
<span class="nc" id="L579">            ModelMBeanConstructorInfo oper =</span>
<span class="nc" id="L580">                    getConstructor(inDescriptorName);</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">            if (oper != null)</span>
<span class="nc" id="L582">                return oper.getDescriptor();</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">            if (inDescriptorType != null)</span>
<span class="nc" id="L584">                return null;</span>
        }
<span class="nc bnc" id="L586" title="All 4 branches missed.">        if (NOTF.equalsIgnoreCase(inDescriptorType) || inDescriptorType == null) {</span>
<span class="nc" id="L587">            ModelMBeanNotificationInfo notif =</span>
<span class="nc" id="L588">                    getNotification(inDescriptorName);</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">            if (notif != null)</span>
<span class="nc" id="L590">                return notif.getDescriptor();</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">            if (inDescriptorType != null)</span>
<span class="nc" id="L592">                return null;</span>
        }
<span class="nc bnc" id="L594" title="All 2 branches missed.">        if (inDescriptorType == null)</span>
<span class="nc" id="L595">            return null;</span>
<span class="nc" id="L596">        throw new RuntimeOperationsException(</span>
                new IllegalArgumentException(&quot;Descriptor Type is invalid&quot;),
                &quot;Exception occurred trying to find the descriptors of the MBean&quot;);

    }



    public void setDescriptor(Descriptor inDescriptor,
            String inDescriptorType)
            throws MBeanException, RuntimeOperationsException {
        final String excMsg =
                &quot;Exception occurred trying to set the descriptors of the MBean&quot;;
<span class="nc bnc" id="L609" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L610">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L611">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;setDescriptor(Descriptor,String)&quot;, &quot;Entry&quot;);
        }

<span class="nc bnc" id="L615" title="All 2 branches missed.">        if (inDescriptor==null) {</span>
<span class="nc" id="L616">            inDescriptor = new DescriptorSupport();</span>
        }

<span class="nc bnc" id="L619" title="All 4 branches missed.">        if ((inDescriptorType == null) || (inDescriptorType.equals(&quot;&quot;))) {</span>
<span class="nc" id="L620">            inDescriptorType =</span>
<span class="nc" id="L621">                    (String) inDescriptor.getFieldValue(&quot;descriptorType&quot;);</span>

<span class="nc bnc" id="L623" title="All 2 branches missed.">            if (inDescriptorType == null) {</span>
<span class="nc" id="L624">                   MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L625">                                ModelMBeanInfoSupport.class.getName(),</span>
                                &quot;setDescriptor(Descriptor,String)&quot;,
                                &quot;descriptorType null in both String parameter and Descriptor, defaulting to &quot;+ MMB);
<span class="nc" id="L628">                inDescriptorType = MMB;</span>
            }
        }

<span class="nc" id="L632">        String inDescriptorName =</span>
<span class="nc" id="L633">                (String) inDescriptor.getFieldValue(&quot;name&quot;);</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">        if (inDescriptorName == null) {</span>
<span class="nc" id="L635">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L636">                                ModelMBeanInfoSupport.class.getName(),</span>
                                &quot;setDescriptor(Descriptor,String)&quot;,
<span class="nc" id="L638">                                &quot;descriptor name null, defaulting to &quot;+ this.getClassName());</span>
<span class="nc" id="L639">            inDescriptorName = this.getClassName();</span>
        }
<span class="nc" id="L641">        boolean found = false;</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if (inDescriptorType.equalsIgnoreCase(MMB)) {</span>
<span class="nc" id="L643">            setMBeanDescriptor(inDescriptor);</span>
<span class="nc" id="L644">            found = true;</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(ATTR)) {</span>
<span class="nc" id="L646">            MBeanAttributeInfo[] attrList =  modelMBeanAttributes;</span>
<span class="nc" id="L647">            int numAttrs = 0;</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">            if (attrList != null) numAttrs = attrList.length;</span>

<span class="nc bnc" id="L650" title="All 2 branches missed.">            for (int i=0; i &lt; numAttrs; i++) {</span>
<span class="nc bnc" id="L651" title="All 2 branches missed.">                if (inDescriptorName.equals(attrList[i].getName())) {</span>
<span class="nc" id="L652">                    found = true;</span>
<span class="nc" id="L653">                    ModelMBeanAttributeInfo mmbai =</span>
                            (ModelMBeanAttributeInfo) attrList[i];
<span class="nc" id="L655">                    mmbai.setDescriptor(inDescriptor);</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">                    if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L657">                        StringBuilder strb = new StringBuilder()</span>
<span class="nc" id="L658">                        .append(&quot;Setting descriptor to &quot;).append(inDescriptor)</span>
<span class="nc" id="L659">                        .append(&quot;\t\n local: AttributeInfo descriptor is &quot;)</span>
<span class="nc" id="L660">                        .append(mmbai.getDescriptor())</span>
<span class="nc" id="L661">                        .append(&quot;\t\n modelMBeanInfo: AttributeInfo descriptor is &quot;)</span>
<span class="nc" id="L662">                        .append(this.getDescriptor(inDescriptorName,&quot;attribute&quot;));</span>
<span class="nc" id="L663">                        MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L664">                                ModelMBeanInfoSupport.class.getName(),</span>
                                &quot;setDescriptor(Descriptor,String)&quot;,
<span class="nc" id="L666">                                strb.toString());</span>
                    }
                }
            }
<span class="nc bnc" id="L670" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(OPER)) {</span>
<span class="nc" id="L671">            MBeanOperationInfo[] operList =  modelMBeanOperations;</span>
<span class="nc" id="L672">            int numOpers = 0;</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">            if (operList != null) numOpers = operList.length;</span>

<span class="nc bnc" id="L675" title="All 2 branches missed.">            for (int i=0; i &lt; numOpers; i++) {</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">                if (inDescriptorName.equals(operList[i].getName())) {</span>
<span class="nc" id="L677">                    found = true;</span>
<span class="nc" id="L678">                    ModelMBeanOperationInfo mmboi =</span>
                            (ModelMBeanOperationInfo) operList[i];
<span class="nc" id="L680">                    mmboi.setDescriptor(inDescriptor);</span>
                }
            }
<span class="nc bnc" id="L683" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(CONS)) {</span>
<span class="nc" id="L684">            MBeanConstructorInfo[] consList =  modelMBeanConstructors;</span>
<span class="nc" id="L685">            int numCons = 0;</span>
<span class="nc bnc" id="L686" title="All 2 branches missed.">            if (consList != null) numCons = consList.length;</span>

<span class="nc bnc" id="L688" title="All 2 branches missed.">            for (int i=0; i &lt; numCons; i++) {</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">                if (inDescriptorName.equals(consList[i].getName())) {</span>
<span class="nc" id="L690">                    found = true;</span>
<span class="nc" id="L691">                    ModelMBeanConstructorInfo mmbci =</span>
                            (ModelMBeanConstructorInfo) consList[i];
<span class="nc" id="L693">                    mmbci.setDescriptor(inDescriptor);</span>
                }
            }
<span class="nc bnc" id="L696" title="All 2 branches missed.">        } else if (inDescriptorType.equalsIgnoreCase(NOTF)) {</span>
<span class="nc" id="L697">            MBeanNotificationInfo[] notifList =  modelMBeanNotifications;</span>
<span class="nc" id="L698">            int numNotifs = 0;</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if (notifList != null) numNotifs = notifList.length;</span>

<span class="nc bnc" id="L701" title="All 2 branches missed.">            for (int i=0; i &lt; numNotifs; i++) {</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">                if (inDescriptorName.equals(notifList[i].getName())) {</span>
<span class="nc" id="L703">                    found = true;</span>
<span class="nc" id="L704">                    ModelMBeanNotificationInfo mmbni =</span>
                            (ModelMBeanNotificationInfo) notifList[i];
<span class="nc" id="L706">                    mmbni.setDescriptor(inDescriptor);</span>
                }
            }
<span class="nc" id="L709">        } else {</span>
<span class="nc" id="L710">            RuntimeException iae =</span>
                    new IllegalArgumentException(&quot;Invalid descriptor type: &quot; +
                    inDescriptorType);
<span class="nc" id="L713">            throw new RuntimeOperationsException(iae, excMsg);</span>
        }

<span class="nc bnc" id="L716" title="All 2 branches missed.">        if (!found) {</span>
<span class="nc" id="L717">            RuntimeException iae =</span>
                    new IllegalArgumentException(&quot;Descriptor name is invalid: &quot; +
                    &quot;type=&quot; + inDescriptorType +
                    &quot;; name=&quot; + inDescriptorName);
<span class="nc" id="L721">            throw new RuntimeOperationsException(iae, excMsg);</span>
        }
<span class="nc bnc" id="L723" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L724">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L725">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;setDescriptor(Descriptor,String)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L729">    }</span>


    public ModelMBeanAttributeInfo getAttribute(String inName)
    throws MBeanException, RuntimeOperationsException {
<span class="nc" id="L734">        ModelMBeanAttributeInfo retInfo = null;</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L736">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L737">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getAttribute(String)&quot;, &quot;Entry&quot;);
        }
<span class="nc bnc" id="L740" title="All 2 branches missed.">        if (inName == null) {</span>
<span class="nc" id="L741">            throw new RuntimeOperationsException(</span>
                    new IllegalArgumentException(&quot;Attribute Name is null&quot;),
                    &quot;Exception occurred trying to get the &quot; +
                    &quot;ModelMBeanAttributeInfo of the MBean&quot;);
        }
<span class="nc" id="L746">        MBeanAttributeInfo[] attrList = modelMBeanAttributes;</span>
<span class="nc" id="L747">        int numAttrs = 0;</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">        if (attrList != null) numAttrs = attrList.length;</span>

<span class="nc bnc" id="L750" title="All 4 branches missed.">        for (int i=0; (i &lt; numAttrs) &amp;&amp; (retInfo == null); i++) {</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L752">                final StringBuilder strb = new StringBuilder()</span>
<span class="nc" id="L753">                .append(&quot;\t\n this.getAttributes() MBeanAttributeInfo Array &quot;)</span>
<span class="nc" id="L754">                .append(i).append(&quot;:&quot;)</span>
<span class="nc" id="L755">                .append(((ModelMBeanAttributeInfo)attrList[i]).getDescriptor())</span>
<span class="nc" id="L756">                .append(&quot;\t\n this.modelMBeanAttributes MBeanAttributeInfo Array &quot;)</span>
<span class="nc" id="L757">                .append(i).append(&quot;:&quot;)</span>
<span class="nc" id="L758">                .append(((ModelMBeanAttributeInfo)modelMBeanAttributes[i]).getDescriptor());</span>
<span class="nc" id="L759">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L760">                        ModelMBeanInfoSupport.class.getName(),</span>
<span class="nc" id="L761">                        &quot;getAttribute(String)&quot;, strb.toString());</span>
            }
<span class="nc bnc" id="L763" title="All 2 branches missed.">            if (inName.equals(attrList[i].getName())) {</span>
<span class="nc" id="L764">                retInfo = ((ModelMBeanAttributeInfo)attrList[i].clone());</span>
            }
        }
<span class="nc bnc" id="L767" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L768">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L769">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getAttribute(String)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L773">        return retInfo;</span>
    }



    public ModelMBeanOperationInfo getOperation(String inName)
    throws MBeanException, RuntimeOperationsException {
<span class="nc" id="L780">        ModelMBeanOperationInfo retInfo = null;</span>
<span class="nc bnc" id="L781" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L782">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L783">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getOperation(String)&quot;, &quot;Entry&quot;);
        }
<span class="nc bnc" id="L786" title="All 2 branches missed.">        if (inName == null) {</span>
<span class="nc" id="L787">            throw new RuntimeOperationsException(</span>
                    new IllegalArgumentException(&quot;inName is null&quot;),
                    &quot;Exception occurred trying to get the &quot; +
                    &quot;ModelMBeanOperationInfo of the MBean&quot;);
        }
<span class="nc" id="L792">        MBeanOperationInfo[] operList = modelMBeanOperations; //this.getOperations();</span>
<span class="nc" id="L793">        int numOpers = 0;</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">        if (operList != null) numOpers = operList.length;</span>

<span class="nc bnc" id="L796" title="All 4 branches missed.">        for (int i=0; (i &lt; numOpers) &amp;&amp; (retInfo == null); i++) {</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">            if (inName.equals(operList[i].getName())) {</span>
<span class="nc" id="L798">                retInfo = ((ModelMBeanOperationInfo) operList[i].clone());</span>
            }
        }
<span class="nc bnc" id="L801" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L802">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L803">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getOperation(String)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L807">        return retInfo;</span>
    }

    /**
     * Returns the ModelMBeanConstructorInfo requested by name.
     * If no ModelMBeanConstructorInfo exists for this name null is returned.
     *
     * @param inName the name of the constructor.
     *
     * @return the constructor info for the named constructor, or null
     * if there is none.
     *
     * @exception MBeanException Wraps a distributed communication Exception.
     * @exception RuntimeOperationsException Wraps an IllegalArgumentException
     *            for a null constructor name.
     */

    public ModelMBeanConstructorInfo getConstructor(String inName)
    throws MBeanException, RuntimeOperationsException {
<span class="nc" id="L826">        ModelMBeanConstructorInfo retInfo = null;</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L828">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L829">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getConstructor(String)&quot;, &quot;Entry&quot;);
        }
<span class="nc bnc" id="L832" title="All 2 branches missed.">        if (inName == null) {</span>
<span class="nc" id="L833">            throw new RuntimeOperationsException(</span>
                    new IllegalArgumentException(&quot;Constructor name is null&quot;),
                    &quot;Exception occurred trying to get the &quot; +
                    &quot;ModelMBeanConstructorInfo of the MBean&quot;);
        }
<span class="nc" id="L838">        MBeanConstructorInfo[] consList = modelMBeanConstructors; //this.getConstructors();</span>
<span class="nc" id="L839">        int numCons = 0;</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">        if (consList != null) numCons = consList.length;</span>

<span class="nc bnc" id="L842" title="All 4 branches missed.">        for (int i=0; (i &lt; numCons) &amp;&amp; (retInfo == null); i++) {</span>
<span class="nc bnc" id="L843" title="All 2 branches missed.">            if (inName.equals(consList[i].getName())) {</span>
<span class="nc" id="L844">                retInfo = ((ModelMBeanConstructorInfo) consList[i].clone());</span>
            }
        }
<span class="nc bnc" id="L847" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L848">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L849">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getConstructor(String)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L853">        return retInfo;</span>
    }


    public ModelMBeanNotificationInfo getNotification(String inName)
    throws MBeanException, RuntimeOperationsException {
<span class="nc" id="L859">        ModelMBeanNotificationInfo retInfo = null;</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L861">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L862">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getNotification(String)&quot;, &quot;Entry&quot;);
        }
<span class="nc bnc" id="L865" title="All 2 branches missed.">        if (inName == null) {</span>
<span class="nc" id="L866">            throw new RuntimeOperationsException(</span>
                    new IllegalArgumentException(&quot;Notification name is null&quot;),
                    &quot;Exception occurred trying to get the &quot; +
                    &quot;ModelMBeanNotificationInfo of the MBean&quot;);
        }
<span class="nc" id="L871">        MBeanNotificationInfo[] notifList = modelMBeanNotifications; //this.getNotifications();</span>
<span class="nc" id="L872">        int numNotifs = 0;</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">        if (notifList != null) numNotifs = notifList.length;</span>

<span class="nc bnc" id="L875" title="All 4 branches missed.">        for (int i=0; (i &lt; numNotifs) &amp;&amp; (retInfo == null); i++) {</span>
<span class="nc bnc" id="L876" title="All 2 branches missed.">            if (inName.equals(notifList[i].getName())) {</span>
<span class="nc" id="L877">                retInfo = ((ModelMBeanNotificationInfo) notifList[i].clone());</span>
            }
        }
<span class="nc bnc" id="L880" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L881">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L882">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getNotification(String)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L886">        return retInfo;</span>
    }


    /* We override MBeanInfo.getDescriptor() to return our descriptor. */
    /**
     * @since 1.6
     */
    @Override
    public Descriptor getDescriptor() {
<span class="nc" id="L896">        return getMBeanDescriptorNoException();</span>
    }

    public Descriptor getMBeanDescriptor() throws MBeanException {
<span class="nc" id="L900">        return getMBeanDescriptorNoException();</span>
    }

    private Descriptor getMBeanDescriptorNoException() {
<span class="nc bnc" id="L904" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L905">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L906">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getMBeanDescriptorNoException()&quot;, &quot;Entry&quot;);
        }

<span class="nc bnc" id="L910" title="All 2 branches missed.">        if (modelMBeanDescriptor == null)</span>
<span class="nc" id="L911">            modelMBeanDescriptor = validDescriptor(null);</span>

<span class="nc bnc" id="L913" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L914">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L915">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;getMBeanDescriptorNoException()&quot;,
                    &quot;Exit, returning: &quot; + modelMBeanDescriptor);
        }
<span class="nc" id="L919">        return (Descriptor) modelMBeanDescriptor.clone();</span>
    }

    public void setMBeanDescriptor(Descriptor inMBeanDescriptor)
    throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L924" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L925">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L926">                    ModelMBeanInfoSupport.class.getName(),</span>
                    &quot;setMBeanDescriptor(Descriptor)&quot;, &quot;Entry&quot;);
        }
<span class="nc" id="L929">        modelMBeanDescriptor = validDescriptor(inMBeanDescriptor);</span>
<span class="nc" id="L930">    }</span>


    /**
     * Clones the passed in Descriptor, sets default values, and checks for validity.
     * If the Descriptor is invalid (for instance by having the wrong &quot;name&quot;),
     * this indicates programming error and a RuntimeOperationsException will be thrown.
     *
     * The following fields will be defaulted if they are not already set:
     * displayName=className,name=className,descriptorType=&quot;mbean&quot;,
     * persistPolicy=&quot;never&quot;, log=&quot;F&quot;, visibility=&quot;1&quot;
     *
     * @param in Descriptor to be checked, or null which is equivalent to
     * an empty Descriptor.
     * @exception RuntimeOperationsException if Descriptor is invalid
     */
    private Descriptor validDescriptor(final Descriptor in) throws RuntimeOperationsException {
        Descriptor clone;
<span class="nc bnc" id="L948" title="All 2 branches missed.">        boolean defaulted = (in == null);</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">        if (defaulted) {</span>
<span class="nc" id="L950">            clone = new DescriptorSupport();</span>
<span class="nc" id="L951">            MODELMBEAN_LOGGER.finer(&quot;Null Descriptor, creating new.&quot;);</span>
        } else {
<span class="nc" id="L953">            clone = (Descriptor) in.clone();</span>
        }

        //Setting defaults.
<span class="nc bnc" id="L957" title="All 4 branches missed.">        if (defaulted &amp;&amp; clone.getFieldValue(&quot;name&quot;)==null) {</span>
<span class="nc" id="L958">            clone.setField(&quot;name&quot;, this.getClassName());</span>
<span class="nc" id="L959">            MODELMBEAN_LOGGER.finer(&quot;Defaulting Descriptor name to &quot; + this.getClassName());</span>
        }
<span class="nc bnc" id="L961" title="All 4 branches missed.">        if (defaulted &amp;&amp; clone.getFieldValue(&quot;descriptorType&quot;)==null) {</span>
<span class="nc" id="L962">            clone.setField(&quot;descriptorType&quot;, MMB);</span>
<span class="nc" id="L963">            MODELMBEAN_LOGGER.finer(&quot;Defaulting descriptorType to \&quot;&quot; + MMB + &quot;\&quot;&quot;);</span>
        }
<span class="nc bnc" id="L965" title="All 2 branches missed.">        if (clone.getFieldValue(&quot;displayName&quot;) == null) {</span>
<span class="nc" id="L966">            clone.setField(&quot;displayName&quot;,this.getClassName());</span>
<span class="nc" id="L967">            MODELMBEAN_LOGGER.finer(&quot;Defaulting Descriptor displayName to &quot; + this.getClassName());</span>
        }
<span class="nc bnc" id="L969" title="All 2 branches missed.">        if (clone.getFieldValue(&quot;persistPolicy&quot;) == null) {</span>
<span class="nc" id="L970">            clone.setField(&quot;persistPolicy&quot;,&quot;never&quot;);</span>
<span class="nc" id="L971">            MODELMBEAN_LOGGER.finer(&quot;Defaulting Descriptor persistPolicy to \&quot;never\&quot;&quot;);</span>
        }
<span class="nc bnc" id="L973" title="All 2 branches missed.">        if (clone.getFieldValue(&quot;log&quot;) == null) {</span>
<span class="nc" id="L974">            clone.setField(&quot;log&quot;,&quot;F&quot;);</span>
<span class="nc" id="L975">            MODELMBEAN_LOGGER.finer(&quot;Defaulting Descriptor \&quot;log\&quot; field to \&quot;F\&quot;&quot;);</span>
        }
<span class="nc bnc" id="L977" title="All 2 branches missed.">        if (clone.getFieldValue(&quot;visibility&quot;) == null) {</span>
<span class="nc" id="L978">            clone.setField(&quot;visibility&quot;,&quot;1&quot;);</span>
<span class="nc" id="L979">            MODELMBEAN_LOGGER.finer(&quot;Defaulting Descriptor visibility to 1&quot;);</span>
        }

        //Checking validity
<span class="nc bnc" id="L983" title="All 2 branches missed.">        if (!clone.isValid()) {</span>
<span class="nc" id="L984">             throw new RuntimeOperationsException(new IllegalArgumentException(&quot;Invalid Descriptor argument&quot;),</span>
                &quot;The isValid() method of the Descriptor object itself returned false,&quot;+
<span class="nc" id="L986">                &quot;one or more required fields are invalid. Descriptor:&quot; + clone.toString());</span>
        }

<span class="nc bnc" id="L989" title="All 2 branches missed.">        if (! ((String)clone.getFieldValue(&quot;descriptorType&quot;)).equalsIgnoreCase(MMB)) {</span>
<span class="nc" id="L990">                 throw new RuntimeOperationsException(new IllegalArgumentException(&quot;Invalid Descriptor argument&quot;),</span>
                &quot;The Descriptor \&quot;descriptorType\&quot; field does not match the object described. &quot; +
<span class="nc" id="L992">                 &quot; Expected: &quot;+ MMB + &quot; , was: &quot; + clone.getFieldValue(&quot;descriptorType&quot;));</span>
        }

<span class="nc" id="L995">        return clone;</span>
    }




    /**
     * Deserializes a {@link ModelMBeanInfoSupport} from an {@link ObjectInputStream}.
     */
    private void readObject(ObjectInputStream in)
    throws IOException, ClassNotFoundException {
<span class="nc bnc" id="L1006" title="All 2 branches missed.">        if (compat) {</span>
            // Read an object serialized in the old serial form
            //
<span class="nc" id="L1009">            ObjectInputStream.GetField fields = in.readFields();</span>
<span class="nc" id="L1010">            modelMBeanDescriptor =</span>
<span class="nc" id="L1011">                    (Descriptor) fields.get(&quot;modelMBeanDescriptor&quot;, null);</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">            if (fields.defaulted(&quot;modelMBeanDescriptor&quot;)) {</span>
<span class="nc" id="L1013">                throw new NullPointerException(&quot;modelMBeanDescriptor&quot;);</span>
            }
<span class="nc" id="L1015">            modelMBeanAttributes =</span>
<span class="nc" id="L1016">                    (MBeanAttributeInfo[]) fields.get(&quot;mmbAttributes&quot;, null);</span>
<span class="nc bnc" id="L1017" title="All 2 branches missed.">            if (fields.defaulted(&quot;mmbAttributes&quot;)) {</span>
<span class="nc" id="L1018">                throw new NullPointerException(&quot;mmbAttributes&quot;);</span>
            }
<span class="nc" id="L1020">            modelMBeanConstructors =</span>
<span class="nc" id="L1021">                    (MBeanConstructorInfo[]) fields.get(&quot;mmbConstructors&quot;, null);</span>
<span class="nc bnc" id="L1022" title="All 2 branches missed.">            if (fields.defaulted(&quot;mmbConstructors&quot;)) {</span>
<span class="nc" id="L1023">                throw new NullPointerException(&quot;mmbConstructors&quot;);</span>
            }
<span class="nc" id="L1025">            modelMBeanNotifications =</span>
<span class="nc" id="L1026">                    (MBeanNotificationInfo[]) fields.get(&quot;mmbNotifications&quot;, null);</span>
<span class="nc bnc" id="L1027" title="All 2 branches missed.">            if (fields.defaulted(&quot;mmbNotifications&quot;)) {</span>
<span class="nc" id="L1028">                throw new NullPointerException(&quot;mmbNotifications&quot;);</span>
            }
<span class="nc" id="L1030">            modelMBeanOperations =</span>
<span class="nc" id="L1031">                    (MBeanOperationInfo[]) fields.get(&quot;mmbOperations&quot;, null);</span>
<span class="nc bnc" id="L1032" title="All 2 branches missed.">            if (fields.defaulted(&quot;mmbOperations&quot;)) {</span>
<span class="nc" id="L1033">                throw new NullPointerException(&quot;mmbOperations&quot;);</span>
            }
<span class="nc" id="L1035">        } else {</span>
            // Read an object serialized in the new serial form
            //
<span class="nc" id="L1038">            in.defaultReadObject();</span>
        }
<span class="nc" id="L1040">    }</span>


    /**
     * Serializes a {@link ModelMBeanInfoSupport} to an {@link ObjectOutputStream}.
     */
    private void writeObject(ObjectOutputStream out)
    throws IOException {
<span class="nc bnc" id="L1048" title="All 2 branches missed.">        if (compat) {</span>
            // Serializes this instance in the old serial form
            //
<span class="nc" id="L1051">            ObjectOutputStream.PutField fields = out.putFields();</span>
<span class="nc" id="L1052">            fields.put(&quot;modelMBeanDescriptor&quot;, modelMBeanDescriptor);</span>
<span class="nc" id="L1053">            fields.put(&quot;mmbAttributes&quot;, modelMBeanAttributes);</span>
<span class="nc" id="L1054">            fields.put(&quot;mmbConstructors&quot;, modelMBeanConstructors);</span>
<span class="nc" id="L1055">            fields.put(&quot;mmbNotifications&quot;, modelMBeanNotifications);</span>
<span class="nc" id="L1056">            fields.put(&quot;mmbOperations&quot;, modelMBeanOperations);</span>
<span class="nc" id="L1057">            fields.put(&quot;currClass&quot;, currClass);</span>
<span class="nc" id="L1058">            out.writeFields();</span>
<span class="nc" id="L1059">        } else {</span>
            // Serializes this instance in the new serial form
            //
<span class="nc" id="L1062">            out.defaultWriteObject();</span>
        }
<span class="nc" id="L1064">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>