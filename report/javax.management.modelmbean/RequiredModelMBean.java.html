<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>RequiredModelMBean.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.management.modelmbean</a> &gt; <span class="el_source">RequiredModelMBean.java</span></div><h1>RequiredModelMBean.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
/*
 * @author    IBM Corp.
 *
 * Copyright IBM Corp. 1999-2000.  All rights reserved.
 */


package javax.management.modelmbean;

/* java imports */

import static com.sun.jmx.defaults.JmxProperties.MODELMBEAN_LOGGER;
import java.io.FileOutputStream;
import java.io.PrintStream;
import java.lang.reflect.InvocationTargetException;

import java.lang.reflect.Method;
import java.security.AccessControlContext;
import java.security.AccessController;
import java.security.PrivilegedAction;

import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.logging.Level;
import java.util.Map;
import java.util.Set;

import java.util.Vector;
import javax.management.Attribute;
import javax.management.AttributeChangeNotification;
import javax.management.AttributeChangeNotificationFilter;
import javax.management.AttributeList;
import javax.management.AttributeNotFoundException;
import javax.management.Descriptor;
import javax.management.InstanceNotFoundException;
import javax.management.InvalidAttributeValueException;
import javax.management.ListenerNotFoundException;
import javax.management.MBeanAttributeInfo;
import javax.management.MBeanConstructorInfo;
import javax.management.MBeanException;
import javax.management.MBeanInfo;
import javax.management.MBeanNotificationInfo;
import javax.management.MBeanOperationInfo;
import javax.management.MBeanRegistration;
import javax.management.MBeanServer;
import javax.management.MBeanServerFactory;
import javax.management.Notification;
import javax.management.NotificationBroadcasterSupport;
import javax.management.NotificationEmitter;
import javax.management.NotificationFilter;
import javax.management.NotificationListener;
import javax.management.ObjectName;
import javax.management.ReflectionException;
import javax.management.RuntimeErrorException;
import javax.management.RuntimeOperationsException;
import javax.management.ServiceNotFoundException;
import javax.management.loading.ClassLoaderRepository;
import sun.misc.JavaSecurityAccess;
import sun.misc.SharedSecrets;

import sun.reflect.misc.MethodUtil;
import sun.reflect.misc.ReflectUtil;

/**
 * This class is the implementation of a ModelMBean. An appropriate
 * implementation of a ModelMBean must be shipped with every JMX Agent
 * and the class must be named RequiredModelMBean.
 * &lt;P&gt;
 * Java resources wishing to be manageable instantiate the
 * RequiredModelMBean using the MBeanServer's createMBean method.
 * The resource then sets the MBeanInfo and Descriptors for the
 * RequiredModelMBean instance. The attributes and operations exposed
 * via the ModelMBeanInfo for the ModelMBean are accessible
 * from MBeans, connectors/adaptors like other MBeans. Through the
 * Descriptors, values and methods in the managed application can be
 * defined and mapped to attributes and operations of the ModelMBean.
 * This mapping can be defined in an XML formatted file or dynamically and
 * programmatically at runtime.
 * &lt;P&gt;
 * Every RequiredModelMBean which is instantiated in the MBeanServer
 * becomes manageable:&lt;br&gt;
 * its attributes and operations become remotely accessible through the
 * connectors/adaptors connected to that MBeanServer.
 * &lt;P&gt;
 * A Java object cannot be registered in the MBeanServer unless it is a
 * JMX compliant MBean. By instantiating a RequiredModelMBean, resources
 * are guaranteed that the MBean is valid.
 *
 * MBeanException and RuntimeOperationsException must be thrown on every
 * public method.  This allows for wrapping exceptions from distributed
 * communications (RMI, EJB, etc.)
 *
 * @since 1.5
 */

public class RequiredModelMBean
    implements ModelMBean, MBeanRegistration, NotificationEmitter {

    /*************************************/
    /* attributes                        */
    /*************************************/
    ModelMBeanInfo modelMBeanInfo;

    /* Notification broadcaster for any notification to be sent
     * from the application through the RequiredModelMBean.  */
<span class="nc" id="L131">    private NotificationBroadcasterSupport generalBroadcaster = null;</span>

    /* Notification broadcaster for attribute change notifications */
<span class="nc" id="L134">    private NotificationBroadcasterSupport attributeBroadcaster = null;</span>

    /* handle, name, or reference for instance on which the actual invoke
     * and operations will be executed */
<span class="nc" id="L138">    private Object managedResource = null;</span>


    /* records the registering in MBeanServer */
<span class="nc" id="L142">    private boolean registered = false;</span>
<span class="nc" id="L143">    private transient MBeanServer server = null;</span>

<span class="nc" id="L145">    private final static JavaSecurityAccess javaSecurityAccess = SharedSecrets.getJavaSecurityAccess();</span>
<span class="nc" id="L146">    final private AccessControlContext acc = AccessController.getContext();</span>

    /*************************************/
    /* constructors                      */
    /*************************************/

    /**
     * Constructs an &lt;CODE&gt;RequiredModelMBean&lt;/CODE&gt; with an empty
     * ModelMBeanInfo.
     * &lt;P&gt;
     * The RequiredModelMBean's MBeanInfo and Descriptors
     * can be customized using the {@link #setModelMBeanInfo} method.
     * After the RequiredModelMBean's MBeanInfo and Descriptors are
     * customized, the RequiredModelMBean can be registered with
     * the MBeanServer.
     *
     * @exception MBeanException Wraps a distributed communication Exception.
     *
     * @exception RuntimeOperationsException Wraps a {@link
     * RuntimeException} during the construction of the object.
     **/
    public RequiredModelMBean()
<span class="nc" id="L168">        throws MBeanException, RuntimeOperationsException {</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L170">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L171">                    RequiredModelMBean.class.getName(),</span>
                    &quot;RequiredModelMBean()&quot;, &quot;Entry&quot;);
        }
<span class="nc" id="L174">        modelMBeanInfo = createDefaultModelMBeanInfo();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L176">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L177">                    RequiredModelMBean.class.getName(),</span>
                    &quot;RequiredModelMBean()&quot;, &quot;Exit&quot;);
        }
<span class="nc" id="L180">    }</span>

    /**
     * Constructs a RequiredModelMBean object using ModelMBeanInfo passed in.
     * As long as the RequiredModelMBean is not registered
     * with the MBeanServer yet, the RequiredModelMBean's MBeanInfo and
     * Descriptors can be customized using the {@link #setModelMBeanInfo}
     * method.
     * After the RequiredModelMBean's MBeanInfo and Descriptors are
     * customized, the RequiredModelMBean can be registered with the
     * MBeanServer.
     *
     * @param mbi The ModelMBeanInfo object to be used by the
     *            RequiredModelMBean. The given ModelMBeanInfo is cloned
     *            and modified as specified by {@link #setModelMBeanInfo}
     *
     * @exception MBeanException Wraps a distributed communication Exception.
     * @exception RuntimeOperationsException Wraps an
     *    {link java.lang.IllegalArgumentException}:
     *          The MBeanInfo passed in parameter is null.
     *
     **/
    public RequiredModelMBean(ModelMBeanInfo mbi)
<span class="nc" id="L203">        throws MBeanException, RuntimeOperationsException {</span>

<span class="nc bnc" id="L205" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L206">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L207">                    RequiredModelMBean.class.getName(),</span>
                    &quot;RequiredModelMBean(MBeanInfo)&quot;, &quot;Entry&quot;);
        }
<span class="nc" id="L210">        setModelMBeanInfo(mbi);</span>

<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L213">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L214">                    RequiredModelMBean.class.getName(),</span>
                    &quot;RequiredModelMBean(MBeanInfo)&quot;, &quot;Exit&quot;);
        }
<span class="nc" id="L217">    }</span>


    /*************************************/
    /* initializers                      */
    /*************************************/

    /**
     * Initializes a ModelMBean object using ModelMBeanInfo passed in.
     * This method makes it possible to set a customized ModelMBeanInfo on
     * the ModelMBean as long as it is not registered with the MBeanServer.
     * &lt;br&gt;
     * Once the ModelMBean's ModelMBeanInfo (with Descriptors) are
     * customized and set on the ModelMBean, the  ModelMBean be
     * registered with the MBeanServer.
     * &lt;P&gt;
     * If the ModelMBean is currently registered, this method throws
     * a {@link javax.management.RuntimeOperationsException} wrapping an
     * {@link IllegalStateException}
     * &lt;P&gt;
     * If the given &lt;var&gt;inModelMBeanInfo&lt;/var&gt; does not contain any
     * {@link ModelMBeanNotificationInfo} for the &lt;code&gt;GENERIC&lt;/code&gt;
     * or &lt;code&gt;ATTRIBUTE_CHANGE&lt;/code&gt; notifications, then the
     * RequiredModelMBean will supply its own default
     * {@link ModelMBeanNotificationInfo ModelMBeanNotificationInfo}s for
     * those missing notifications.
     *
     * @param mbi The ModelMBeanInfo object to be used
     *        by the ModelMBean.
     *
     * @exception MBeanException Wraps a distributed communication
     *        Exception.
     * @exception RuntimeOperationsException
     * &lt;ul&gt;&lt;li&gt;Wraps an {@link IllegalArgumentException} if
     *         the MBeanInfo passed in parameter is null.&lt;/li&gt;
     *     &lt;li&gt;Wraps an {@link IllegalStateException} if the ModelMBean
     *         is currently registered in the MBeanServer.&lt;/li&gt;
     * &lt;/ul&gt;
     *
     **/
    public void setModelMBeanInfo(ModelMBeanInfo mbi)
        throws MBeanException, RuntimeOperationsException {

<span class="nc bnc" id="L260" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L261">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L262">                    RequiredModelMBean.class.getName(),</span>
                &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,&quot;Entry&quot;);
        }

<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (mbi == null) {</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L268">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L269">                        RequiredModelMBean.class.getName(),</span>
                    &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,
                    &quot;ModelMBeanInfo is null: Raising exception.&quot;);
            }
<span class="nc" id="L273">            final RuntimeException x = new</span>
                IllegalArgumentException(&quot;ModelMBeanInfo must not be null&quot;);
            final String exceptionText =
                &quot;Exception occurred trying to initialize the &quot; +
                &quot;ModelMBeanInfo of the RequiredModelMBean&quot;;
<span class="nc" id="L278">            throw new RuntimeOperationsException(x,exceptionText);</span>
        }

<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (registered) {</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L283">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L284">                        RequiredModelMBean.class.getName(),</span>
                    &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,
                    &quot;RequiredMBean is registered: Raising exception.&quot;);
            }
            final String exceptionText =
                &quot;Exception occurred trying to set the &quot; +
                &quot;ModelMBeanInfo of the RequiredModelMBean&quot;;
<span class="nc" id="L291">            final RuntimeException x = new IllegalStateException(</span>
             &quot;cannot call setModelMBeanInfo while ModelMBean is registered&quot;);
<span class="nc" id="L293">            throw new RuntimeOperationsException(x,exceptionText);</span>
        }

<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L297">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L298">                    RequiredModelMBean.class.getName(),</span>
                &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,
<span class="nc" id="L300">                &quot;Setting ModelMBeanInfo to &quot; + printModelMBeanInfo(mbi));</span>
<span class="nc" id="L301">            int noOfNotifications = 0;</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">            if (mbi.getNotifications() != null) {</span>
<span class="nc" id="L303">                noOfNotifications = mbi.getNotifications().length;</span>
            }
<span class="nc" id="L305">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L306">                    RequiredModelMBean.class.getName(),</span>
                &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,
                &quot;ModelMBeanInfo notifications has &quot; +
                noOfNotifications + &quot; elements&quot;);
        }

<span class="nc" id="L312">        modelMBeanInfo = (ModelMBeanInfo)mbi.clone();</span>

<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L315">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L316">                    RequiredModelMBean.class.getName(),</span>
                &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,&quot;set mbeanInfo to: &quot;+
<span class="nc" id="L318">                 printModelMBeanInfo(modelMBeanInfo));</span>
<span class="nc" id="L319">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L320">                    RequiredModelMBean.class.getName(),</span>
                &quot;setModelMBeanInfo(ModelMBeanInfo)&quot;,&quot;Exit&quot;);
        }
<span class="nc" id="L323">    }</span>


    /**
     * Sets the instance handle of the object against which to
     * execute all methods in this ModelMBean management interface
     * (MBeanInfo and Descriptors).
     *
     * @param mr Object that is the managed resource
     * @param mr_type The type of reference for the managed resource.
     *     &lt;br&gt;Can be: &quot;ObjectReference&quot;, &quot;Handle&quot;, &quot;IOR&quot;, &quot;EJBHandle&quot;,
     *         or &quot;RMIReference&quot;.
     *     &lt;br&gt;In this implementation only &quot;ObjectReference&quot; is supported.
     *
     * @exception MBeanException The initializer of the object has
     *            thrown an exception.
     * @exception InstanceNotFoundException The managed resource
     *            object could not be found
     * @exception InvalidTargetObjectTypeException The managed
     *            resource type should be &quot;ObjectReference&quot;.
     * @exception RuntimeOperationsException Wraps a {@link
     *            RuntimeException} when setting the resource.
     **/
    public void setManagedResource(Object mr, String mr_type)
        throws MBeanException, RuntimeOperationsException,
               InstanceNotFoundException, InvalidTargetObjectTypeException {
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L350">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L351">                    RequiredModelMBean.class.getName(),</span>
                &quot;setManagedResource(Object,String)&quot;,&quot;Entry&quot;);
        }

        // check that the mr_type is supported by this JMXAgent
        // only &quot;objectReference&quot; is supported
<span class="nc bnc" id="L357" title="All 2 branches missed.">        if ((mr_type == null) ||</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">            (! mr_type.equalsIgnoreCase(&quot;objectReference&quot;))) {</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L360">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L361">                        RequiredModelMBean.class.getName(),</span>
                    &quot;setManagedResource(Object,String)&quot;,
                    &quot;Managed Resource Type is not supported: &quot; + mr_type);
            }
<span class="nc" id="L365">            throw new InvalidTargetObjectTypeException(mr_type);</span>
        }

<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L369">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L370">                    RequiredModelMBean.class.getName(),</span>
                &quot;setManagedResource(Object,String)&quot;,
                &quot;Managed Resource is valid&quot;);
        }
<span class="nc" id="L374">        managedResource = mr;</span>

<span class="nc bnc" id="L376" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L377">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L378">                    RequiredModelMBean.class.getName(),</span>
                &quot;setManagedResource(Object, String)&quot;, &quot;Exit&quot;);
        }
<span class="nc" id="L381">    }</span>

    /**
     * &lt;p&gt;Instantiates this MBean instance with the data found for
     * the MBean in the persistent store.  The data loaded could include
     * attribute and operation values.&lt;/p&gt;
     *
     * &lt;p&gt;This method should be called during construction or
     * initialization of this instance, and before the MBean is
     * registered with the MBeanServer.&lt;/p&gt;
     *
     * &lt;p&gt;If the implementation of this class does not support
     * persistence, an {@link MBeanException} wrapping a {@link
     * ServiceNotFoundException} is thrown.&lt;/p&gt;
     *
     * @exception MBeanException Wraps another exception, or
     * persistence is not supported
     * @exception RuntimeOperationsException Wraps exceptions from the
     * persistence mechanism
     * @exception InstanceNotFoundException Could not find or load
     * this MBean from persistent storage
     */
    public void load()
        throws MBeanException, RuntimeOperationsException,
               InstanceNotFoundException {
<span class="nc" id="L406">        final ServiceNotFoundException x = new ServiceNotFoundException(</span>
                                &quot;Persistence not supported for this MBean&quot;);
<span class="nc" id="L408">        throw new MBeanException(x, x.getMessage());</span>
    }

        /**
     * &lt;p&gt;Captures the current state of this MBean instance and writes
     * it out to the persistent store.  The state stored could include
     * attribute and operation values.&lt;/p&gt;
     *
     * &lt;p&gt;If the implementation of this class does not support
     * persistence, an {@link MBeanException} wrapping a {@link
     * ServiceNotFoundException} is thrown.&lt;/p&gt;
     *
     * &lt;p&gt;Persistence policy from the MBean and attribute descriptor
     * is used to guide execution of this method. The MBean should be
     * stored if 'persistPolicy' field is:&lt;/p&gt;
     *
     * &lt;PRE&gt;{@literal  != &quot;never&quot;
     *   = &quot;always&quot;
     *   = &quot;onTimer&quot; and now &gt; 'lastPersistTime' + 'persistPeriod'
     *   = &quot;NoMoreOftenThan&quot; and now &gt; 'lastPersistTime' + 'persistPeriod'
     *   = &quot;onUnregister&quot;
     * }&lt;/PRE&gt;
     *
     * &lt;p&gt;Do not store the MBean if 'persistPolicy' field is:&lt;/p&gt;
     * &lt;PRE&gt;{@literal
     *    = &quot;never&quot;
     *    = &quot;onUpdate&quot;
     *    = &quot;onTimer&quot; &amp;&amp; now &lt; 'lastPersistTime' + 'persistPeriod'
     * }&lt;/PRE&gt;
     *
     * @exception MBeanException Wraps another exception, or
     * persistence is not supported
     * @exception RuntimeOperationsException Wraps exceptions from the
     * persistence mechanism
     * @exception InstanceNotFoundException Could not find/access the
     * persistent store
     */
    public void store()
        throws MBeanException, RuntimeOperationsException,
               InstanceNotFoundException {
<span class="nc" id="L448">        final ServiceNotFoundException x = new ServiceNotFoundException(</span>
                                &quot;Persistence not supported for this MBean&quot;);
<span class="nc" id="L450">        throw new MBeanException(x, x.getMessage());</span>
    }

    /*************************************/
    /* DynamicMBean Interface            */
    /*************************************/

    /**
     * The resolveForCacheValue method checks the descriptor passed in to
     * see if there is a valid cached value in the descriptor.
     * The valid value will be in the 'value' field if there is one.
     * If the 'currencyTimeLimit' field in the descriptor is:
     * &lt;ul&gt;
     *   &lt;li&gt;&lt;b&gt;&amp;lt;0&lt;/b&gt; Then the value is not cached and is never valid.
     *         Null is returned. The 'value' and 'lastUpdatedTimeStamp'
     *         fields are cleared.&lt;/li&gt;
     *   &lt;li&gt;&lt;b&gt;=0&lt;/b&gt; Then the value is always cached and always valid.
     *         The 'value' field is returned.
     *         The 'lastUpdatedTimeStamp' field is not checked.&lt;/li&gt;
     *   &lt;li&gt;&lt;b&gt;&amp;gt;0&lt;/b&gt; Represents the number of seconds that the
     *         'value' field is valid.
     *         The 'value' field is no longer valid when
     *         'lastUpdatedTimeStamp' + 'currencyTimeLimit' &amp;gt; Now.
     *       &lt;ul&gt;
     *       &lt;li&gt;When 'value' is valid, 'valid' is returned.&lt;/li&gt;
     *       &lt;li&gt;When 'value' is no longer valid then null is returned and
     *           'value' and 'lastUpdatedTimeStamp' fields are cleared.&lt;/li&gt;
     *       &lt;/ul&gt;
     *   &lt;/li&gt;
     * &lt;/ul&gt;
     *
     **/
    private Object resolveForCacheValue(Descriptor descr)
        throws MBeanException, RuntimeOperationsException {

<span class="nc" id="L485">        final boolean tracing = MODELMBEAN_LOGGER.isLoggable(Level.FINER);</span>
        final String mth = &quot;resolveForCacheValue(Descriptor)&quot;;
<span class="nc bnc" id="L487" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L488">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L489">                    RequiredModelMBean.class.getName(),mth,&quot;Entry&quot;);</span>
        }

<span class="nc" id="L492">        Object response = null;</span>
<span class="nc" id="L493">        boolean resetValue = false, returnCachedValue = true;</span>
<span class="nc" id="L494">        long currencyPeriod = 0;</span>

<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (descr == null) {</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L498">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L499">                        RequiredModelMBean.class.getName(),mth,</span>
                    &quot;Input Descriptor is null&quot;);
            }
<span class="nc" id="L502">            return response;</span>
        }

<span class="nc bnc" id="L505" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L506">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L507">                    RequiredModelMBean.class.getName(),</span>
                    mth, &quot;descriptor is &quot; + descr);
        }

<span class="nc" id="L511">        final Descriptor mmbDescr = modelMBeanInfo.getMBeanDescriptor();</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">        if (mmbDescr == null) {</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L514">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L515">                    RequiredModelMBean.class.getName(),</span>
                        mth,&quot;MBean Descriptor is null&quot;);
            }
            //return response;
        }

<span class="nc" id="L521">        Object objExpTime = descr.getFieldValue(&quot;currencyTimeLimit&quot;);</span>

        String expTime;
<span class="nc bnc" id="L524" title="All 2 branches missed.">        if (objExpTime != null) {</span>
<span class="nc" id="L525">            expTime = objExpTime.toString();</span>
        } else {
<span class="nc" id="L527">            expTime = null;</span>
        }

<span class="nc bnc" id="L530" title="All 4 branches missed.">        if ((expTime == null) &amp;&amp; (mmbDescr != null)) {</span>
<span class="nc" id="L531">            objExpTime = mmbDescr.getFieldValue(&quot;currencyTimeLimit&quot;);</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">            if (objExpTime != null) {</span>
<span class="nc" id="L533">                expTime = objExpTime.toString();</span>
            } else {
<span class="nc" id="L535">                expTime = null;</span>
            }
        }

<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (expTime != null) {</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L541">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L542">                    RequiredModelMBean.class.getName(),</span>
                        mth,&quot;currencyTimeLimit: &quot; + expTime);
            }

            // convert seconds to milliseconds for time comparison
<span class="nc" id="L547">            currencyPeriod = ((new Long(expTime)).longValue()) * 1000;</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">            if (currencyPeriod &lt; 0) {</span>
                /* if currencyTimeLimit is -1 then value is never cached */
<span class="nc" id="L550">                returnCachedValue = false;</span>
<span class="nc" id="L551">                resetValue = true;</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L553">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L554">                            RequiredModelMBean.class.getName(),mth,</span>
                        currencyPeriod + &quot;: never Cached&quot;);
                }
<span class="nc bnc" id="L557" title="All 2 branches missed.">            } else if (currencyPeriod == 0) {</span>
                /* if currencyTimeLimit is 0 then value is always cached */
<span class="nc" id="L559">                returnCachedValue = true;</span>
<span class="nc" id="L560">                resetValue = false;</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L562">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L563">                            RequiredModelMBean.class.getName(),mth,</span>
                        &quot;always valid Cache&quot;);
                }
            } else {
<span class="nc" id="L567">                Object objtStamp =</span>
<span class="nc" id="L568">                    descr.getFieldValue(&quot;lastUpdatedTimeStamp&quot;);</span>

                String tStamp;
<span class="nc bnc" id="L571" title="All 2 branches missed.">                if (objtStamp != null) tStamp = objtStamp.toString();</span>
<span class="nc" id="L572">                else tStamp = null;</span>

<span class="nc bnc" id="L574" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L575">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L576">                            RequiredModelMBean.class.getName(),mth,</span>
                        &quot;lastUpdatedTimeStamp: &quot; + tStamp);
                }

<span class="nc bnc" id="L580" title="All 2 branches missed.">                if (tStamp == null)</span>
<span class="nc" id="L581">                    tStamp = &quot;0&quot;;</span>

<span class="nc" id="L583">                long lastTime = (new Long(tStamp)).longValue();</span>

<span class="nc bnc" id="L585" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L586">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L587">                            RequiredModelMBean.class.getName(),mth,</span>
                        &quot;currencyPeriod:&quot; + currencyPeriod +
                        &quot; lastUpdatedTimeStamp:&quot; + lastTime);
                }

<span class="nc" id="L592">                long now = (new Date()).getTime();</span>

<span class="nc bnc" id="L594" title="All 2 branches missed.">                if (now &lt; (lastTime + currencyPeriod)) {</span>
<span class="nc" id="L595">                    returnCachedValue = true;</span>
<span class="nc" id="L596">                    resetValue = false;</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">                    if (tracing) {</span>
<span class="nc" id="L598">                        MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L599">                                RequiredModelMBean.class.getName(),mth,</span>
                            &quot; timed valid Cache for &quot; + now + &quot; &lt; &quot; +
                            (lastTime + currencyPeriod));
                    }
                } else { /* value is expired */
<span class="nc" id="L604">                    returnCachedValue = false;</span>
<span class="nc" id="L605">                    resetValue = true;</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">                    if (tracing) {</span>
<span class="nc" id="L607">                        MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L608">                                RequiredModelMBean.class.getName(),mth,</span>
                            &quot;timed expired cache for &quot; + now + &quot; &gt; &quot; +
                            (lastTime + currencyPeriod));
                    }
                }
            }
<span class="nc bnc" id="L614" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L615">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L616">                        RequiredModelMBean.class.getName(),mth,</span>
                    &quot;returnCachedValue:&quot; + returnCachedValue +
                    &quot; resetValue: &quot; + resetValue);
            }

<span class="nc bnc" id="L621" title="All 2 branches missed.">            if (returnCachedValue == true) {</span>
<span class="nc" id="L622">                Object currValue = descr.getFieldValue(&quot;value&quot;);</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">                if (currValue != null) {</span>
                    /* error/validity check return value here */
<span class="nc" id="L625">                    response = currValue;</span>
                    /* need to cast string cached value to type */
<span class="nc bnc" id="L627" title="All 2 branches missed.">                    if (tracing) {</span>
<span class="nc" id="L628">                        MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L629">                                RequiredModelMBean.class.getName(),mth,</span>
                            &quot;valid Cache value: &quot; + currValue);
                    }

                } else {
<span class="nc" id="L634">                    response = null;</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">                    if (tracing) {</span>
<span class="nc" id="L636">                        MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L637">                            RequiredModelMBean.class.getName(),</span>
                                mth,&quot;no Cached value&quot;);
                    }
                }
            }

<span class="nc bnc" id="L643" title="All 2 branches missed.">            if (resetValue == true) {</span>
                /* value is not current, so remove it */
<span class="nc" id="L645">                descr.removeField(&quot;lastUpdatedTimeStamp&quot;);</span>
<span class="nc" id="L646">                descr.removeField(&quot;value&quot;);</span>
<span class="nc" id="L647">                response = null;</span>
<span class="nc" id="L648">                modelMBeanInfo.setDescriptor(descr,null);</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L650">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L651">                        RequiredModelMBean.class.getName(),</span>
                            mth,&quot;reset cached value to null&quot;);
                }
            }
        }

<span class="nc bnc" id="L657" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L658">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L659">                    RequiredModelMBean.class.getName(),mth,&quot;Exit&quot;);</span>
        }

<span class="nc" id="L662">        return response;</span>
    }

    /**
     * Returns the attributes, operations, constructors and notifications
     * that this RequiredModelMBean exposes for management.
     *
     * @return  An instance of ModelMBeanInfo allowing retrieval all
     *          attributes, operations, and Notifications of this MBean.
     *
     **/
    public MBeanInfo getMBeanInfo() {

<span class="nc bnc" id="L675" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L676">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L677">                    RequiredModelMBean.class.getName(),</span>
                    &quot;getMBeanInfo()&quot;,&quot;Entry&quot;);
        }

<span class="nc bnc" id="L681" title="All 2 branches missed.">        if (modelMBeanInfo == null) {</span>
<span class="nc bnc" id="L682" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L683">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L684">                        RequiredModelMBean.class.getName(),</span>
                    &quot;getMBeanInfo()&quot;,&quot;modelMBeanInfo is null&quot;);
            }
<span class="nc" id="L687">            modelMBeanInfo = createDefaultModelMBeanInfo();</span>
            //return new ModelMBeanInfo(&quot; &quot;, &quot;&quot;, null, null, null, null);
        }

<span class="nc bnc" id="L691" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L692">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L693">                    RequiredModelMBean.class.getName(),</span>
                &quot;getMBeanInfo()&quot;,&quot;ModelMBeanInfo is &quot; +
<span class="nc" id="L695">                  modelMBeanInfo.getClassName() + &quot; for &quot; +</span>
<span class="nc" id="L696">                  modelMBeanInfo.getDescription());</span>
<span class="nc" id="L697">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L698">                    RequiredModelMBean.class.getName(),</span>
<span class="nc" id="L699">                &quot;getMBeanInfo()&quot;,printModelMBeanInfo(modelMBeanInfo));</span>
        }

<span class="nc" id="L702">        return((MBeanInfo) modelMBeanInfo.clone());</span>
    }

    private String printModelMBeanInfo(ModelMBeanInfo info) {
<span class="nc" id="L706">        final StringBuilder retStr = new StringBuilder();</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">        if (info == null) {</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L709">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L710">                        RequiredModelMBean.class.getName(),</span>
                        &quot;printModelMBeanInfo(ModelMBeanInfo)&quot;,
                        &quot;ModelMBeanInfo to print is null, &quot; +
                        &quot;printing local ModelMBeanInfo&quot;);
            }
<span class="nc" id="L715">            info = modelMBeanInfo;</span>
        }

<span class="nc" id="L718">        retStr.append(&quot;\nMBeanInfo for ModelMBean is:&quot;);</span>
<span class="nc" id="L719">        retStr.append(&quot;\nCLASSNAME: \t&quot;+ info.getClassName());</span>
<span class="nc" id="L720">        retStr.append(&quot;\nDESCRIPTION: \t&quot;+ info.getDescription());</span>


        try {
<span class="nc" id="L724">            retStr.append(&quot;\nMBEAN DESCRIPTOR: \t&quot;+</span>
<span class="nc" id="L725">                          info.getMBeanDescriptor());</span>
<span class="nc" id="L726">        } catch (Exception e) {</span>
<span class="nc" id="L727">            retStr.append(&quot;\nMBEAN DESCRIPTOR: \t&quot; + &quot; is invalid&quot;);</span>
<span class="nc" id="L728">        }</span>

<span class="nc" id="L730">        retStr.append(&quot;\nATTRIBUTES&quot;);</span>

<span class="nc" id="L732">        final MBeanAttributeInfo[] attrInfo = info.getAttributes();</span>
<span class="nc bnc" id="L733" title="All 4 branches missed.">        if ((attrInfo != null) &amp;&amp; (attrInfo.length&gt;0)) {</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">            for (int i=0; i&lt;attrInfo.length; i++) {</span>
<span class="nc" id="L735">                final ModelMBeanAttributeInfo attInfo =</span>
                    (ModelMBeanAttributeInfo)attrInfo[i];
<span class="nc" id="L737">                retStr.append(&quot; ** NAME: \t&quot;+ attInfo.getName());</span>
<span class="nc" id="L738">                retStr.append(&quot;    DESCR: \t&quot;+ attInfo.getDescription());</span>
<span class="nc" id="L739">                retStr.append(&quot;    TYPE: \t&quot;+ attInfo.getType() +</span>
<span class="nc" id="L740">                              &quot;    READ: \t&quot;+ attInfo.isReadable() +</span>
<span class="nc" id="L741">                              &quot;    WRITE: \t&quot;+ attInfo.isWritable());</span>
<span class="nc" id="L742">                retStr.append(&quot;    DESCRIPTOR: &quot; +</span>
<span class="nc" id="L743">                              attInfo.getDescriptor().toString());</span>
            }
        } else {
<span class="nc" id="L746">            retStr.append(&quot; ** No attributes **&quot;);</span>
        }

<span class="nc" id="L749">        retStr.append(&quot;\nCONSTRUCTORS&quot;);</span>
<span class="nc" id="L750">        final MBeanConstructorInfo[] constrInfo = info.getConstructors();</span>
<span class="nc bnc" id="L751" title="All 4 branches missed.">        if ((constrInfo != null) &amp;&amp; (constrInfo.length &gt; 0 )) {</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">            for (int i=0; i&lt;constrInfo.length; i++) {</span>
<span class="nc" id="L753">                final ModelMBeanConstructorInfo ctorInfo =</span>
                    (ModelMBeanConstructorInfo)constrInfo[i];
<span class="nc" id="L755">                retStr.append(&quot; ** NAME: \t&quot;+ ctorInfo.getName());</span>
<span class="nc" id="L756">                retStr.append(&quot;    DESCR: \t&quot;+</span>
<span class="nc" id="L757">                              ctorInfo.getDescription());</span>
<span class="nc" id="L758">                retStr.append(&quot;    PARAM: \t&quot;+</span>
<span class="nc" id="L759">                              ctorInfo.getSignature().length +</span>
                              &quot; parameter(s)&quot;);
<span class="nc" id="L761">                retStr.append(&quot;    DESCRIPTOR: &quot; +</span>
<span class="nc" id="L762">                              ctorInfo.getDescriptor().toString());</span>
            }
        } else {
<span class="nc" id="L765">            retStr.append(&quot; ** No Constructors **&quot;);</span>
        }

<span class="nc" id="L768">        retStr.append(&quot;\nOPERATIONS&quot;);</span>
<span class="nc" id="L769">        final MBeanOperationInfo[] opsInfo = info.getOperations();</span>
<span class="nc bnc" id="L770" title="All 4 branches missed.">        if ((opsInfo != null) &amp;&amp; (opsInfo.length&gt;0)) {</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">            for (int i=0; i&lt;opsInfo.length; i++) {</span>
<span class="nc" id="L772">                final ModelMBeanOperationInfo operInfo =</span>
                    (ModelMBeanOperationInfo)opsInfo[i];
<span class="nc" id="L774">                retStr.append(&quot; ** NAME: \t&quot;+ operInfo.getName());</span>
<span class="nc" id="L775">                retStr.append(&quot;    DESCR: \t&quot;+ operInfo.getDescription());</span>
<span class="nc" id="L776">                retStr.append(&quot;    PARAM: \t&quot;+</span>
<span class="nc" id="L777">                              operInfo.getSignature().length +</span>
                              &quot; parameter(s)&quot;);
<span class="nc" id="L779">                retStr.append(&quot;    DESCRIPTOR: &quot; +</span>
<span class="nc" id="L780">                              operInfo.getDescriptor().toString());</span>
            }
        } else {
<span class="nc" id="L783">            retStr.append(&quot; ** No operations ** &quot;);</span>
        }

<span class="nc" id="L786">        retStr.append(&quot;\nNOTIFICATIONS&quot;);</span>

<span class="nc" id="L788">        MBeanNotificationInfo[] notifInfo = info.getNotifications();</span>
<span class="nc bnc" id="L789" title="All 4 branches missed.">        if ((notifInfo != null) &amp;&amp; (notifInfo.length&gt;0)) {</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">            for (int i=0; i&lt;notifInfo.length; i++) {</span>
<span class="nc" id="L791">                final ModelMBeanNotificationInfo nInfo =</span>
                    (ModelMBeanNotificationInfo)notifInfo[i];
<span class="nc" id="L793">                retStr.append(&quot; ** NAME: \t&quot;+ nInfo.getName());</span>
<span class="nc" id="L794">                retStr.append(&quot;    DESCR: \t&quot;+ nInfo.getDescription());</span>
<span class="nc" id="L795">                retStr.append(&quot;    DESCRIPTOR: &quot; +</span>
<span class="nc" id="L796">                              nInfo.getDescriptor().toString());</span>
            }
        } else {
<span class="nc" id="L799">            retStr.append(&quot; ** No notifications **&quot;);</span>
        }

<span class="nc" id="L802">        retStr.append(&quot; ** ModelMBean: End of MBeanInfo ** &quot;);</span>

<span class="nc" id="L804">        return retStr.toString();</span>
    }

    /**
     * Invokes a method on or through a RequiredModelMBean and returns
     * the result of the method execution.
     * &lt;P&gt;
     * If the given method to be invoked, together with the provided
     * signature, matches one of RequiredModelMbean
     * accessible methods, this one will be call. Otherwise the call to
     * the given method will be tried on the managed resource.
     * &lt;P&gt;
     * The last value returned by an operation may be cached in
     * the operation's descriptor which
     * is in the ModelMBeanOperationInfo's descriptor.
     * The valid value will be in the 'value' field if there is one.
     * If the 'currencyTimeLimit' field in the descriptor is:
     * &lt;UL&gt;
     * &lt;LI&gt;&lt;b&gt;&amp;lt;0&lt;/b&gt; Then the value is not cached and is never valid.
     *      The operation method is invoked.
     *      The 'value' and 'lastUpdatedTimeStamp' fields are cleared.&lt;/LI&gt;
     * &lt;LI&gt;&lt;b&gt;=0&lt;/b&gt; Then the value is always cached and always valid.
     *      The 'value' field is returned. If there is no 'value' field
     *      then the operation method is invoked for the attribute.
     *      The 'lastUpdatedTimeStamp' field and `value' fields are set to
     *      the operation's return value and the current time stamp.&lt;/LI&gt;
     * &lt;LI&gt;&lt;b&gt;&amp;gt;0&lt;/b&gt; Represents the number of seconds that the 'value'
     *      field is valid.
     *      The 'value' field is no longer valid when
     *      'lastUpdatedTimeStamp' + 'currencyTimeLimit' &amp;gt; Now.
     *      &lt;UL&gt;
     *         &lt;LI&gt;When 'value' is valid, 'value' is returned.&lt;/LI&gt;
     *         &lt;LI&gt;When 'value' is no longer valid then the operation
     *             method is invoked. The 'lastUpdatedTimeStamp' field
     *             and `value' fields are updated.&lt;/lI&gt;
     *      &lt;/UL&gt;
     * &lt;/LI&gt;
     * &lt;/UL&gt;
     *
     * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; because of inconsistencies in previous versions of
     * this specification, it is recommended not to use negative or zero
     * values for &lt;code&gt;currencyTimeLimit&lt;/code&gt;.  To indicate that a
     * cached value is never valid, omit the
     * &lt;code&gt;currencyTimeLimit&lt;/code&gt; field.  To indicate that it is
     * always valid, use a very large number for this field.&lt;/p&gt;
     *
     * @param opName The name of the method to be invoked. The
     *     name can be the fully qualified method name including the
     *     classname, or just the method name if the classname is
     *     defined in the 'class' field of the operation descriptor.
     * @param opArgs An array containing the parameters to be set
     *     when the operation is invoked
     * @param sig An array containing the signature of the
     *     operation. The class objects will be loaded using the same
     *     class loader as the one used for loading the MBean on which
     *     the operation was invoked.
     *
     * @return  The object returned by the method, which represents the
     *     result of invoking the method on the specified managed resource.
     *
     * @exception MBeanException  Wraps one of the following Exceptions:
     * &lt;UL&gt;
     * &lt;LI&gt; An Exception thrown by the managed object's invoked method.&lt;/LI&gt;
     * &lt;LI&gt; {@link ServiceNotFoundException}: No ModelMBeanOperationInfo or
     *      no descriptor defined for the specified operation or the managed
     *      resource is null.&lt;/LI&gt;
     * &lt;LI&gt; {@link InvalidTargetObjectTypeException}: The 'targetType'
     *      field value is not 'objectReference'.&lt;/LI&gt;
     * &lt;/UL&gt;
     * @exception ReflectionException  Wraps an {@link java.lang.Exception}
     *      thrown while trying to invoke the method.
     * @exception RuntimeOperationsException Wraps an
     *      {@link IllegalArgumentException} Method name is null.
     *
     **/
    /*
      The requirement to be able to invoke methods on the
      RequiredModelMBean class itself makes this method considerably
      more complicated than it might otherwise be.  Note that, unlike
      earlier versions, we do not allow you to invoke such methods if
      they are not explicitly mentioned in the ModelMBeanInfo.  Doing
      so was potentially a security problem, and certainly very
      surprising.

      We do not look for the method in the RequiredModelMBean class
      itself if:
      (a) there is a &quot;targetObject&quot; field in the Descriptor for the
      operation; or
      (b) there is a &quot;class&quot; field in the Descriptor for the operation
      and the named class is not RequiredModelMBean or one of its
      superinterfaces; or
      (c) the name of the operation is not the name of a method in
      RequiredModelMBean (this is just an optimization).

      In cases (a) and (b), if you have gone to the trouble of adding
      those fields specifically for this operation then presumably you
      do not want RequiredModelMBean's methods to be called.

      We have to pay attention to class loading issues.  If the
      &quot;class&quot; field is present, the named class has to be resolved
      relative to RequiredModelMBean's class loader to test the
      condition (b) above, and relative to the managed resource's
      class loader to ensure that the managed resource is in fact of
      the named class (or a subclass).  The class names in the sig
      array likewise have to be resolved, first against
      RequiredModelMBean's class loader, then against the managed
      resource's class loader.  There is no point in using any other
      loader because when we call Method.invoke we must call it on
      a Method that is implemented by the target object.
     */
    public Object invoke(String opName, Object[] opArgs, String[] sig)
            throws MBeanException, ReflectionException {

<span class="nc" id="L917">        final boolean tracing = MODELMBEAN_LOGGER.isLoggable(Level.FINER);</span>
        final String mth = &quot;invoke(String, Object[], String[])&quot;;

<span class="nc bnc" id="L920" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L921">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L922">                    RequiredModelMBean.class.getName(), mth, &quot;Entry&quot;);</span>
        }

<span class="nc bnc" id="L925" title="All 2 branches missed.">        if (opName == null) {</span>
<span class="nc" id="L926">            final RuntimeException x =</span>
                new IllegalArgumentException(&quot;Method name must not be null&quot;);
<span class="nc" id="L928">            throw new RuntimeOperationsException(x,</span>
                      &quot;An exception occurred while trying to &quot; +
                      &quot;invoke a method on a RequiredModelMBean&quot;);
        }

<span class="nc" id="L933">        String opClassName = null;</span>
        String opMethodName;

        // Parse for class name and method
<span class="nc" id="L937">        int opSplitter = opName.lastIndexOf(&quot;.&quot;);</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">        if (opSplitter &gt; 0) {</span>
<span class="nc" id="L939">            opClassName = opName.substring(0,opSplitter);</span>
<span class="nc" id="L940">            opMethodName = opName.substring(opSplitter+1);</span>
        } else
<span class="nc" id="L942">            opMethodName = opName;</span>

        /* Ignore anything after a left paren.  We keep this for
           compatibility but it isn't specified.  */
<span class="nc" id="L946">        opSplitter = opMethodName.indexOf(&quot;(&quot;);</span>
<span class="nc bnc" id="L947" title="All 2 branches missed.">        if (opSplitter &gt; 0)</span>
<span class="nc" id="L948">            opMethodName = opMethodName.substring(0,opSplitter);</span>

<span class="nc bnc" id="L950" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L951">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L952">                    RequiredModelMBean.class.getName(),</span>
                    mth, &quot;Finding operation &quot; + opName + &quot; as &quot; + opMethodName);
        }

<span class="nc" id="L956">        ModelMBeanOperationInfo opInfo =</span>
<span class="nc" id="L957">            modelMBeanInfo.getOperation(opMethodName);</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">        if (opInfo == null) {</span>
<span class="nc" id="L959">            final String msg =</span>
                &quot;Operation &quot; + opName + &quot; not in ModelMBeanInfo&quot;;
<span class="nc" id="L961">            throw new MBeanException(new ServiceNotFoundException(msg), msg);</span>
        }

<span class="nc" id="L964">        final Descriptor opDescr = opInfo.getDescriptor();</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">        if (opDescr == null) {</span>
            final String msg = &quot;Operation descriptor null&quot;;
<span class="nc" id="L967">            throw new MBeanException(new ServiceNotFoundException(msg), msg);</span>
        }

<span class="nc" id="L970">        final Object cached = resolveForCacheValue(opDescr);</span>
<span class="nc bnc" id="L971" title="All 2 branches missed.">        if (cached != null) {</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L973">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L974">                        RequiredModelMBean.class.getName(),</span>
                        mth,
                        &quot;Returning cached value&quot;);
            }
<span class="nc" id="L978">            return cached;</span>
        }

<span class="nc bnc" id="L981" title="All 2 branches missed.">        if (opClassName == null)</span>
<span class="nc" id="L982">            opClassName = (String) opDescr.getFieldValue(&quot;class&quot;);</span>
        // may still be null now

<span class="nc" id="L985">        opMethodName = (String) opDescr.getFieldValue(&quot;name&quot;);</span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">        if (opMethodName == null) {</span>
            final String msg =
                &quot;Method descriptor must include `name' field&quot;;
<span class="nc" id="L989">            throw new MBeanException(new ServiceNotFoundException(msg), msg);</span>
        }

<span class="nc" id="L992">        final String targetTypeField = (String)</span>
<span class="nc" id="L993">            opDescr.getFieldValue(&quot;targetType&quot;);</span>
<span class="nc bnc" id="L994" title="All 2 branches missed.">        if (targetTypeField != null</span>
<span class="nc bnc" id="L995" title="All 2 branches missed.">            &amp;&amp; !targetTypeField.equalsIgnoreCase(&quot;objectReference&quot;)) {</span>
<span class="nc" id="L996">            final String msg =</span>
                &quot;Target type must be objectReference: &quot; + targetTypeField;
<span class="nc" id="L998">            throw new MBeanException(new InvalidTargetObjectTypeException(msg),</span>
                                     msg);
        }

<span class="nc" id="L1002">        final Object targetObjectField = opDescr.getFieldValue(&quot;targetObject&quot;);</span>
<span class="nc bnc" id="L1003" title="All 4 branches missed.">        if (tracing &amp;&amp; targetObjectField != null)</span>
<span class="nc" id="L1004">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1005">                    RequiredModelMBean.class.getName(),</span>
                        mth, &quot;Found target object in descriptor&quot;);

        /* Now look for the method, either in RequiredModelMBean itself
           or in the target object.  Set &quot;method&quot; and &quot;targetObject&quot;
           appropriately.  */
        Method method;
        Object targetObject;

<span class="nc" id="L1014">        method = findRMMBMethod(opMethodName, targetObjectField,</span>
                                opClassName, sig);

<span class="nc bnc" id="L1017" title="All 2 branches missed.">        if (method != null)</span>
<span class="nc" id="L1018">            targetObject = this;</span>
        else {
<span class="nc bnc" id="L1020" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L1021">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1022">                    RequiredModelMBean.class.getName(),</span>
                        mth, &quot;looking for method in managedResource class&quot;);
            }
<span class="nc bnc" id="L1025" title="All 2 branches missed.">            if (targetObjectField != null)</span>
<span class="nc" id="L1026">                targetObject = targetObjectField;</span>
            else {
<span class="nc" id="L1028">                targetObject = managedResource;</span>
<span class="nc bnc" id="L1029" title="All 2 branches missed.">                if (targetObject == null) {</span>
<span class="nc" id="L1030">                    final String msg =</span>
                        &quot;managedResource for invoke &quot; + opName +
                        &quot; is null&quot;;
<span class="nc" id="L1033">                    Exception snfe = new ServiceNotFoundException(msg);</span>
<span class="nc" id="L1034">                    throw new MBeanException(snfe);</span>
                }
            }

            final Class&lt;?&gt; targetClass;

<span class="nc bnc" id="L1040" title="All 2 branches missed.">            if (opClassName != null) {</span>
                try {
<span class="nc" id="L1042">                    AccessControlContext stack = AccessController.getContext();</span>
<span class="nc" id="L1043">                    final Object obj = targetObject;</span>
<span class="nc" id="L1044">                    final String className = opClassName;</span>
<span class="nc" id="L1045">                    final ClassNotFoundException[] caughtException = new ClassNotFoundException[1];</span>

<span class="nc" id="L1047">                    targetClass = javaSecurityAccess.doIntersectionPrivilege(new PrivilegedAction&lt;Class&lt;?&gt;&gt;() {</span>

                        @Override
                        public Class&lt;?&gt; run() {
                            try {
<span class="nc" id="L1052">                                ReflectUtil.checkPackageAccess(className);</span>
<span class="nc" id="L1053">                                final ClassLoader targetClassLoader =</span>
<span class="nc" id="L1054">                                    obj.getClass().getClassLoader();</span>
<span class="nc" id="L1055">                                return Class.forName(className, false,</span>
                                                            targetClassLoader);
<span class="nc" id="L1057">                            } catch (ClassNotFoundException e) {</span>
<span class="nc" id="L1058">                                caughtException[0] = e;</span>
                            }
<span class="nc" id="L1060">                            return null;</span>
                        }
                    }, stack, acc);

<span class="nc bnc" id="L1064" title="All 2 branches missed.">                    if (caughtException[0] != null) {</span>
<span class="nc" id="L1065">                        throw caughtException[0];</span>
                    }
<span class="nc" id="L1067">                } catch (ClassNotFoundException e) {</span>
<span class="nc" id="L1068">                    final String msg =</span>
                        &quot;class for invoke &quot; + opName + &quot; not found&quot;;
<span class="nc" id="L1070">                    throw new ReflectionException(e, msg);</span>
<span class="nc" id="L1071">                }</span>
            } else
<span class="nc" id="L1073">                targetClass = targetObject.getClass();</span>

<span class="nc" id="L1075">            method = resolveMethod(targetClass, opMethodName, sig);</span>
        }

<span class="nc bnc" id="L1078" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1079">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1080">                RequiredModelMBean.class.getName(),</span>
                    mth, &quot;found &quot; + opMethodName + &quot;, now invoking&quot;);
        }

<span class="nc" id="L1084">        final Object result =</span>
<span class="nc" id="L1085">            invokeMethod(opName, method, targetObject, opArgs);</span>

<span class="nc bnc" id="L1087" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1088">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1089">                RequiredModelMBean.class.getName(),</span>
                    mth, &quot;successfully invoked method&quot;);
        }

<span class="nc bnc" id="L1093" title="All 2 branches missed.">        if (result != null)</span>
<span class="nc" id="L1094">            cacheResult(opInfo, opDescr, result);</span>

<span class="nc" id="L1096">        return result;</span>
    }

    private Method resolveMethod(Class&lt;?&gt; targetClass,
                                        String opMethodName,
                                        final String[] sig)
            throws ReflectionException {
<span class="nc" id="L1103">        final boolean tracing = MODELMBEAN_LOGGER.isLoggable(Level.FINER);</span>

<span class="nc bnc" id="L1105" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1106">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1107">                RequiredModelMBean.class.getName(),&quot;resolveMethod&quot;,</span>
<span class="nc" id="L1108">                  &quot;resolving &quot; + targetClass.getName() + &quot;.&quot; + opMethodName);</span>
        }

        final Class&lt;?&gt;[] argClasses;

<span class="nc bnc" id="L1113" title="All 2 branches missed.">        if (sig == null)</span>
<span class="nc" id="L1114">            argClasses = null;</span>
        else {
<span class="nc" id="L1116">            final AccessControlContext stack = AccessController.getContext();</span>
<span class="nc" id="L1117">            final ReflectionException[] caughtException = new ReflectionException[1];</span>
<span class="nc" id="L1118">            final ClassLoader targetClassLoader = targetClass.getClassLoader();</span>
<span class="nc" id="L1119">            argClasses = new Class&lt;?&gt;[sig.length];</span>

<span class="nc" id="L1121">            javaSecurityAccess.doIntersectionPrivilege(new PrivilegedAction&lt;Void&gt;() {</span>

                @Override
                public Void run() {
<span class="nc bnc" id="L1125" title="All 2 branches missed.">                    for (int i = 0; i &lt; sig.length; i++) {</span>
<span class="nc bnc" id="L1126" title="All 2 branches missed.">                        if (tracing) {</span>
<span class="nc" id="L1127">                            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1128">                                RequiredModelMBean.class.getName(),&quot;resolveMethod&quot;,</span>
                                    &quot;resolve type &quot; + sig[i]);
                        }
<span class="nc" id="L1131">                        argClasses[i] = (Class&lt;?&gt;) primitiveClassMap.get(sig[i]);</span>
<span class="nc bnc" id="L1132" title="All 2 branches missed.">                        if (argClasses[i] == null) {</span>
                            try {
<span class="nc" id="L1134">                                ReflectUtil.checkPackageAccess(sig[i]);</span>
<span class="nc" id="L1135">                                argClasses[i] =</span>
<span class="nc" id="L1136">                                    Class.forName(sig[i], false, targetClassLoader);</span>
<span class="nc" id="L1137">                            } catch (ClassNotFoundException e) {</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">                                if (tracing) {</span>
<span class="nc" id="L1139">                                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1140">                                            RequiredModelMBean.class.getName(),</span>
                                            &quot;resolveMethod&quot;,
                                            &quot;class not found&quot;);
                                }
                                final String msg = &quot;Parameter class not found&quot;;
<span class="nc" id="L1145">                                caughtException[0] = new ReflectionException(e, msg);</span>
<span class="nc" id="L1146">                            }</span>
                        }
                    }
<span class="nc" id="L1149">                    return null;</span>
                }
            }, stack, acc);

<span class="nc bnc" id="L1153" title="All 2 branches missed.">            if (caughtException[0] != null) {</span>
<span class="nc" id="L1154">                throw caughtException[0];</span>
            }
        }

        try {
<span class="nc" id="L1159">            return targetClass.getMethod(opMethodName, argClasses);</span>
<span class="nc" id="L1160">        } catch (NoSuchMethodException e) {</span>
<span class="nc" id="L1161">            final String msg =</span>
<span class="nc" id="L1162">                &quot;Target method not found: &quot; + targetClass.getName() + &quot;.&quot; +</span>
                opMethodName;
<span class="nc" id="L1164">            throw new ReflectionException(e, msg);</span>
        }
    }

    /* Map e.g. &quot;int&quot; to int.class.  Goodness knows how many time this
       particular wheel has been reinvented.  */
<span class="nc" id="L1170">    private static final Class&lt;?&gt;[] primitiveClasses = {</span>
        int.class, long.class, boolean.class, double.class,
        float.class, short.class, byte.class, char.class,
    };
<span class="nc" id="L1174">    private static final Map&lt;String,Class&lt;?&gt;&gt; primitiveClassMap =</span>
        new HashMap&lt;String,Class&lt;?&gt;&gt;();
    static {
<span class="nc bnc" id="L1177" title="All 2 branches missed.">        for (int i = 0; i &lt; primitiveClasses.length; i++) {</span>
<span class="nc" id="L1178">            final Class&lt;?&gt; c = primitiveClasses[i];</span>
<span class="nc" id="L1179">            primitiveClassMap.put(c.getName(), c);</span>
        }
    }

    /* Find a method in RequiredModelMBean as determined by the given
       parameters.  Return null if there is none, or if the parameters
       exclude using it.  Called from invoke. */
    private Method findRMMBMethod(String opMethodName,
                                         Object targetObjectField,
                                         String opClassName,
                                         String[] sig) {
<span class="nc" id="L1190">        final boolean tracing = MODELMBEAN_LOGGER.isLoggable(Level.FINER);</span>

<span class="nc bnc" id="L1192" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1193">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1194">                RequiredModelMBean.class.getName(),</span>
                    &quot;invoke(String, Object[], String[])&quot;,
                  &quot;looking for method in RequiredModelMBean class&quot;);
        }

<span class="nc bnc" id="L1199" title="All 2 branches missed.">        if (!isRMMBMethodName(opMethodName))</span>
<span class="nc" id="L1200">            return null;</span>
<span class="nc bnc" id="L1201" title="All 2 branches missed.">        if (targetObjectField != null)</span>
<span class="nc" id="L1202">            return null;</span>
<span class="nc" id="L1203">        final Class&lt;RequiredModelMBean&gt; rmmbClass = RequiredModelMBean.class;</span>
        final Class&lt;?&gt; targetClass;
<span class="nc bnc" id="L1205" title="All 2 branches missed.">        if (opClassName == null)</span>
<span class="nc" id="L1206">            targetClass = rmmbClass;</span>
        else {
<span class="nc" id="L1208">            AccessControlContext stack = AccessController.getContext();</span>
<span class="nc" id="L1209">            final String className = opClassName;</span>
<span class="nc" id="L1210">            targetClass = javaSecurityAccess.doIntersectionPrivilege(new PrivilegedAction&lt;Class&lt;?&gt;&gt;() {</span>

                @Override
                public Class&lt;?&gt; run() {
                    try {
<span class="nc" id="L1215">                        ReflectUtil.checkPackageAccess(className);</span>
<span class="nc" id="L1216">                        final ClassLoader targetClassLoader =</span>
<span class="nc" id="L1217">                            rmmbClass.getClassLoader();</span>
<span class="nc" id="L1218">                        Class clz = Class.forName(className, false,</span>
                                                    targetClassLoader);
<span class="nc bnc" id="L1220" title="All 2 branches missed.">                        if (!rmmbClass.isAssignableFrom(clz))</span>
<span class="nc" id="L1221">                            return null;</span>
<span class="nc" id="L1222">                        return clz;</span>
<span class="nc" id="L1223">                    } catch (ClassNotFoundException e) {</span>
<span class="nc" id="L1224">                        return null;</span>
                    }
                }
            }, stack, acc);
        }
        try {
<span class="nc bnc" id="L1230" title="All 2 branches missed.">            return targetClass != null ? resolveMethod(targetClass, opMethodName, sig) : null;</span>
<span class="nc" id="L1231">        } catch (ReflectionException e) {</span>
<span class="nc" id="L1232">            return null;</span>
        }
    }

    /*
     * Invoke the given method, and throw the somewhat unpredictable
     * appropriate exception if the method itself gets an exception.
     */
    private Object invokeMethod(String opName, final Method method,
                                final Object targetObject, final Object[] opArgs)
            throws MBeanException, ReflectionException {
        try {
<span class="nc" id="L1244">            final Throwable[] caughtException = new Throwable[1];</span>
<span class="nc" id="L1245">            AccessControlContext stack = AccessController.getContext();</span>
<span class="nc" id="L1246">            Object rslt = javaSecurityAccess.doIntersectionPrivilege(new PrivilegedAction&lt;Object&gt;() {</span>

                @Override
                public Object run() {
                    try {
<span class="nc" id="L1251">                        ReflectUtil.checkPackageAccess(method.getDeclaringClass());</span>
<span class="nc" id="L1252">                        return MethodUtil.invoke(method, targetObject, opArgs);</span>
<span class="nc" id="L1253">                    } catch (InvocationTargetException e) {</span>
<span class="nc" id="L1254">                        caughtException[0] = e;</span>
<span class="nc" id="L1255">                    } catch (IllegalAccessException e) {</span>
<span class="nc" id="L1256">                        caughtException[0] = e;</span>
<span class="nc" id="L1257">                    }</span>
<span class="nc" id="L1258">                    return null;</span>
                }
            }, stack, acc);
<span class="nc bnc" id="L1261" title="All 2 branches missed.">            if (caughtException[0] != null) {</span>
<span class="nc bnc" id="L1262" title="All 2 branches missed.">                if (caughtException[0] instanceof Exception) {</span>
<span class="nc" id="L1263">                    throw (Exception)caughtException[0];</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">                } else if(caughtException[0] instanceof Error) {</span>
<span class="nc" id="L1265">                    throw (Error)caughtException[0];</span>
                }
            }
<span class="nc" id="L1268">            return rslt;</span>
<span class="nc" id="L1269">        } catch (RuntimeErrorException ree) {</span>
<span class="nc" id="L1270">            throw new RuntimeOperationsException(ree,</span>
                      &quot;RuntimeException occurred in RequiredModelMBean &quot;+
                      &quot;while trying to invoke operation &quot; + opName);
<span class="nc" id="L1273">        } catch (RuntimeException re) {</span>
<span class="nc" id="L1274">            throw new RuntimeOperationsException(re,</span>
                      &quot;RuntimeException occurred in RequiredModelMBean &quot;+
                      &quot;while trying to invoke operation &quot; + opName);
<span class="nc" id="L1277">        } catch (IllegalAccessException iae) {</span>
<span class="nc" id="L1278">            throw new ReflectionException(iae,</span>
                      &quot;IllegalAccessException occurred in &quot; +
                      &quot;RequiredModelMBean while trying to &quot; +
                      &quot;invoke operation &quot; + opName);
<span class="nc" id="L1282">        } catch (InvocationTargetException ite) {</span>
<span class="nc" id="L1283">            Throwable mmbTargEx = ite.getTargetException();</span>
<span class="nc bnc" id="L1284" title="All 2 branches missed.">            if (mmbTargEx instanceof RuntimeException) {</span>
<span class="nc" id="L1285">                throw new MBeanException ((RuntimeException)mmbTargEx,</span>
                      &quot;RuntimeException thrown in RequiredModelMBean &quot;+
                      &quot;while trying to invoke operation &quot; + opName);
<span class="nc bnc" id="L1288" title="All 2 branches missed.">            } else if (mmbTargEx instanceof Error) {</span>
<span class="nc" id="L1289">                throw new RuntimeErrorException((Error)mmbTargEx,</span>
                      &quot;Error occurred in RequiredModelMBean while trying &quot;+
                      &quot;to invoke operation &quot; + opName);
<span class="nc bnc" id="L1292" title="All 2 branches missed.">            } else if (mmbTargEx instanceof ReflectionException) {</span>
<span class="nc" id="L1293">                throw (ReflectionException) mmbTargEx;</span>
            } else {
<span class="nc" id="L1295">                throw new MBeanException ((Exception)mmbTargEx,</span>
                      &quot;Exception thrown in RequiredModelMBean &quot;+
                      &quot;while trying to invoke operation &quot; + opName);
            }
<span class="nc" id="L1299">        } catch (Error err) {</span>
<span class="nc" id="L1300">            throw new RuntimeErrorException(err,</span>
                  &quot;Error occurred in RequiredModelMBean while trying &quot;+
                  &quot;to invoke operation &quot; + opName);
<span class="nc" id="L1303">        } catch (Exception e) {</span>
<span class="nc" id="L1304">            throw new ReflectionException(e,</span>
                  &quot;Exception occurred in RequiredModelMBean while &quot; +
                  &quot;trying to invoke operation &quot; + opName);
        }
    }

    /*
     * Cache the result of an operation in the descriptor, if that is
     * called for by the descriptor's configuration.  Note that we
     * don't remember operation parameters when caching the result, so
     * this is unlikely to be useful if there are any.
     */
    private void cacheResult(ModelMBeanOperationInfo opInfo,
                             Descriptor opDescr, Object result)
            throws MBeanException {

<span class="nc" id="L1320">        Descriptor mmbDesc =</span>
<span class="nc" id="L1321">            modelMBeanInfo.getMBeanDescriptor();</span>

<span class="nc" id="L1323">        Object objctl =</span>
<span class="nc" id="L1324">            opDescr.getFieldValue(&quot;currencyTimeLimit&quot;);</span>
        String ctl;
<span class="nc bnc" id="L1326" title="All 2 branches missed.">        if (objctl != null) {</span>
<span class="nc" id="L1327">            ctl = objctl.toString();</span>
        } else {
<span class="nc" id="L1329">            ctl = null;</span>
        }
<span class="nc bnc" id="L1331" title="All 4 branches missed.">        if ((ctl == null) &amp;&amp; (mmbDesc != null)) {</span>
<span class="nc" id="L1332">            objctl =</span>
<span class="nc" id="L1333">                mmbDesc.getFieldValue(&quot;currencyTimeLimit&quot;);</span>
<span class="nc bnc" id="L1334" title="All 2 branches missed.">            if (objctl != null) {</span>
<span class="nc" id="L1335">                ctl = objctl.toString();</span>
            } else {
<span class="nc" id="L1337">                ctl = null;</span>
            }
        }
<span class="nc bnc" id="L1340" title="All 4 branches missed.">        if ((ctl != null) &amp;&amp; !(ctl.equals(&quot;-1&quot;))) {</span>
<span class="nc" id="L1341">            opDescr.setField(&quot;value&quot;, result);</span>
<span class="nc" id="L1342">            opDescr.setField(&quot;lastUpdatedTimeStamp&quot;,</span>
<span class="nc" id="L1343">                    String.valueOf((new Date()).getTime()));</span>


<span class="nc" id="L1346">            modelMBeanInfo.setDescriptor(opDescr,</span>
                                         &quot;operation&quot;);
<span class="nc bnc" id="L1348" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L1349">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1350">                        RequiredModelMBean.class.getName(),</span>
                        &quot;invoke(String,Object[],Object[])&quot;,
                        &quot;new descriptor is &quot; + opDescr);
            }
        }
<span class="nc" id="L1355">    }</span>

    /*
     * Determine whether the given name is the name of a public method
     * in this class.  This is only an optimization: it prevents us
     * from trying to do argument type lookups and reflection on a
     * method that will obviously fail because it has the wrong name.
     *
     * The first time this method is called we do the reflection, and
     * every other time we reuse the remembered values.
     *
     * It's conceivable that the (possibly malicious) first caller
     * doesn't have the required permissions to do reflection, in
     * which case we don't touch anything so as not to interfere
     * with a later permissionful caller.
     */
    private static Set&lt;String&gt; rmmbMethodNames;
    private static synchronized boolean isRMMBMethodName(String name) {
<span class="nc bnc" id="L1373" title="All 2 branches missed.">        if (rmmbMethodNames == null) {</span>
            try {
<span class="nc" id="L1375">                Set&lt;String&gt; names = new HashSet&lt;String&gt;();</span>
<span class="nc" id="L1376">                Method[] methods = RequiredModelMBean.class.getMethods();</span>
<span class="nc bnc" id="L1377" title="All 2 branches missed.">                for (int i = 0; i &lt; methods.length; i++)</span>
<span class="nc" id="L1378">                    names.add(methods[i].getName());</span>
<span class="nc" id="L1379">                rmmbMethodNames = names;</span>
<span class="nc" id="L1380">            } catch (Exception e) {</span>
<span class="nc" id="L1381">                return true;</span>
                // This is only an optimization so we'll go on to discover
                // whether the name really is an RMMB method.
<span class="nc" id="L1384">            }</span>
        }
<span class="nc" id="L1386">        return rmmbMethodNames.contains(name);</span>
    }

    /**
     * Returns the value of a specific attribute defined for this
     * ModelMBean.
     * The last value returned by an attribute may be cached in the
     * attribute's descriptor.
     * The valid value will be in the 'value' field if there is one.
     * If the 'currencyTimeLimit' field in the descriptor is:
     * &lt;UL&gt;
     * &lt;LI&gt;  &lt;b&gt;&amp;lt;0&lt;/b&gt; Then the value is not cached and is never valid.
     *       The getter method is invoked for the attribute.
     *       The 'value' and 'lastUpdatedTimeStamp' fields are cleared.&lt;/LI&gt;
     * &lt;LI&gt;  &lt;b&gt;=0&lt;/b&gt; Then the value is always cached and always valid.
     *       The 'value' field is returned. If there is no'value' field
     *       then the getter method is invoked for the attribute.
     *       The 'lastUpdatedTimeStamp' field and `value' fields are set
     *       to the attribute's value and the current time stamp.&lt;/LI&gt;
     * &lt;LI&gt;  &lt;b&gt;&amp;gt;0&lt;/b&gt; Represents the number of seconds that the 'value'
     *       field is valid.
     *       The 'value' field is no longer valid when
     *       'lastUpdatedTimeStamp' + 'currencyTimeLimit' &amp;gt; Now.
     *   &lt;UL&gt;
     *        &lt;LI&gt;When 'value' is valid, 'value' is returned.&lt;/LI&gt;
     *        &lt;LI&gt;When 'value' is no longer valid then the getter
     *            method is invoked for the attribute.
     *            The 'lastUpdatedTimeStamp' field and `value' fields
     *            are updated.&lt;/LI&gt;
     *   &lt;/UL&gt;&lt;/LI&gt;
     * &lt;/UL&gt;
     *
     * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; because of inconsistencies in previous versions of
     * this specification, it is recommended not to use negative or zero
     * values for &lt;code&gt;currencyTimeLimit&lt;/code&gt;.  To indicate that a
     * cached value is never valid, omit the
     * &lt;code&gt;currencyTimeLimit&lt;/code&gt; field.  To indicate that it is
     * always valid, use a very large number for this field.&lt;/p&gt;
     *
     * &lt;p&gt;If the 'getMethod' field contains the name of a valid
     * operation descriptor, then the method described by the
     * operation descriptor is executed.  The response from the
     * method is returned as the value of the attribute.  If the
     * operation fails or the returned value is not compatible with
     * the declared type of the attribute, an exception will be thrown.&lt;/p&gt;
     *
     * &lt;p&gt;If no 'getMethod' field is defined then the default value of the
     * attribute is returned. If the returned value is not compatible with
     * the declared type of the attribute, an exception will be thrown.&lt;/p&gt;
     *
     * &lt;p&gt;The declared type of the attribute is the String returned by
     * {@link ModelMBeanAttributeInfo#getType()}.  A value is compatible
     * with this type if one of the following is true:
     * &lt;ul&gt;
     * &lt;li&gt;the value is null;&lt;/li&gt;
     * &lt;li&gt;the declared name is a primitive type name (such as &quot;int&quot;)
     *     and the value is an instance of the corresponding wrapper
     *     type (such as java.lang.Integer);&lt;/li&gt;
     * &lt;li&gt;the name of the value's class is identical to the declared name;&lt;/li&gt;
     * &lt;li&gt;the declared name can be loaded by the value's class loader and
     *     produces a class to which the value can be assigned.&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * &lt;p&gt;In this implementation, in every case where the getMethod needs to
     * be called, because the method is invoked through the standard &quot;invoke&quot;
     * method and thus needs operationInfo, an operation must be specified
     * for that getMethod so that the invocation works correctly.&lt;/p&gt;
     *
     * @param attrName A String specifying the name of the
     * attribute to be retrieved. It must match the name of a
     * ModelMBeanAttributeInfo.
     *
     * @return The value of the retrieved attribute from the
     * descriptor 'value' field or from the invocation of the
     * operation in the 'getMethod' field of the descriptor.
     *
     * @exception AttributeNotFoundException The specified attribute is
     *    not accessible in the MBean.
     *    The following cases may result in an AttributeNotFoundException:
     *    &lt;UL&gt;
     *      &lt;LI&gt; No ModelMBeanInfo was found for the Model MBean.&lt;/LI&gt;
     *      &lt;LI&gt; No ModelMBeanAttributeInfo was found for the specified
     *           attribute name.&lt;/LI&gt;
     *      &lt;LI&gt; The ModelMBeanAttributeInfo isReadable method returns
     *           'false'.&lt;/LI&gt;
     *    &lt;/UL&gt;
     * @exception MBeanException  Wraps one of the following Exceptions:
     *    &lt;UL&gt;
     *      &lt;LI&gt; {@link InvalidAttributeValueException}: A wrong value type
     *           was received from the attribute's getter method or
     *           no 'getMethod' field defined in the descriptor for
     *           the attribute and no default value exists.&lt;/LI&gt;
     *      &lt;LI&gt; {@link ServiceNotFoundException}: No
     *           ModelMBeanOperationInfo defined for the attribute's
     *           getter method or no descriptor associated with the
     *           ModelMBeanOperationInfo or the managed resource is
     *           null.&lt;/LI&gt;
     *      &lt;LI&gt; {@link InvalidTargetObjectTypeException} The 'targetType'
     *           field value is not 'objectReference'.&lt;/LI&gt;
     *      &lt;LI&gt; An Exception thrown by the managed object's getter.&lt;/LI&gt;
     *    &lt;/UL&gt;
     * @exception ReflectionException  Wraps an {@link java.lang.Exception}
     *    thrown while trying to invoke the getter.
     * @exception RuntimeOperationsException Wraps an
     *    {@link IllegalArgumentException}: The attribute name in
     *    parameter is null.
     *
     * @see #setAttribute(javax.management.Attribute)
     **/
    public Object getAttribute(String attrName)
        throws AttributeNotFoundException, MBeanException,
               ReflectionException {
<span class="nc bnc" id="L1498" title="All 2 branches missed.">        if (attrName == null)</span>
<span class="nc" id="L1499">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;attributeName must not be null&quot;),
                &quot;Exception occurred trying to get attribute of a &quot; +
                &quot;RequiredModelMBean&quot;);
        final String mth = &quot;getAttribute(String)&quot;;
<span class="nc" id="L1504">        final boolean tracing = MODELMBEAN_LOGGER.isLoggable(Level.FINER);</span>
<span class="nc bnc" id="L1505" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1506">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1507">                    RequiredModelMBean.class.getName(),</span>
                mth, &quot;Entry with &quot; + attrName);
        }

        /* Check attributeDescriptor for getMethod */
        Object response;

        try {
<span class="nc bnc" id="L1515" title="All 2 branches missed.">            if (modelMBeanInfo == null)</span>
<span class="nc" id="L1516">                throw new AttributeNotFoundException(</span>
                      &quot;getAttribute failed: ModelMBeanInfo not found for &quot;+
                      attrName);

<span class="nc" id="L1520">            ModelMBeanAttributeInfo attrInfo = modelMBeanInfo.getAttribute(attrName);</span>
<span class="nc" id="L1521">            Descriptor mmbDesc = modelMBeanInfo.getMBeanDescriptor();</span>

<span class="nc bnc" id="L1523" title="All 2 branches missed.">            if (attrInfo == null)</span>
<span class="nc" id="L1524">                throw new AttributeNotFoundException(&quot;getAttribute failed:&quot;+</span>
                      &quot; ModelMBeanAttributeInfo not found for &quot; + attrName);

<span class="nc" id="L1527">            Descriptor attrDescr = attrInfo.getDescriptor();</span>
<span class="nc bnc" id="L1528" title="All 2 branches missed.">            if (attrDescr != null) {</span>
<span class="nc bnc" id="L1529" title="All 2 branches missed.">                if (!attrInfo.isReadable())</span>
<span class="nc" id="L1530">                    throw new AttributeNotFoundException(</span>
                          &quot;getAttribute failed: &quot; + attrName +
                          &quot; is not readable &quot;);

<span class="nc" id="L1534">                response = resolveForCacheValue(attrDescr);</span>

                /* return current cached value */
<span class="nc bnc" id="L1537" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L1538">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1539">                            RequiredModelMBean.class.getName(), mth,</span>
                        &quot;*** cached value is &quot; + response);
                }

<span class="nc bnc" id="L1543" title="All 2 branches missed.">                if (response == null) {</span>
                    /* no cached value, run getMethod */
<span class="nc bnc" id="L1545" title="All 2 branches missed.">                    if (tracing) {</span>
<span class="nc" id="L1546">                        MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1547">                                RequiredModelMBean.class.getName(), mth,</span>
                            &quot;**** cached value is null - getting getMethod&quot;);
                    }
<span class="nc" id="L1550">                    String attrGetMethod =</span>
<span class="nc" id="L1551">                        (String)(attrDescr.getFieldValue(&quot;getMethod&quot;));</span>

<span class="nc bnc" id="L1553" title="All 2 branches missed.">                    if (attrGetMethod != null) {</span>
                        /* run method from operations descriptor */
<span class="nc bnc" id="L1555" title="All 2 branches missed.">                        if (tracing) {</span>
<span class="nc" id="L1556">                            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1557">                                    RequiredModelMBean.class.getName(),</span>
                                mth, &quot;invoking a getMethod for &quot; +  attrName);
                        }

<span class="nc" id="L1561">                        Object getResponse =</span>
<span class="nc" id="L1562">                            invoke(attrGetMethod, new Object[] {},</span>
                                   new String[] {});

<span class="nc bnc" id="L1565" title="All 2 branches missed.">                        if (getResponse != null) {</span>
                            // error/validity check return value here
<span class="nc bnc" id="L1567" title="All 2 branches missed.">                            if (tracing) {</span>
<span class="nc" id="L1568">                                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1569">                                        RequiredModelMBean.class.getName(),</span>
                                        mth, &quot;got a non-null response &quot; +
                                        &quot;from getMethod\n&quot;);
                            }

<span class="nc" id="L1574">                            response = getResponse;</span>

                            // change cached value in attribute descriptor
<span class="nc" id="L1577">                            Object objctl =</span>
<span class="nc" id="L1578">                                attrDescr.getFieldValue(&quot;currencyTimeLimit&quot;);</span>

                            String ctl;
<span class="nc bnc" id="L1581" title="All 2 branches missed.">                            if (objctl != null) ctl = objctl.toString();</span>
<span class="nc" id="L1582">                            else ctl = null;</span>

<span class="nc bnc" id="L1584" title="All 4 branches missed.">                            if ((ctl == null) &amp;&amp; (mmbDesc != null)) {</span>
<span class="nc" id="L1585">                                objctl = mmbDesc.</span>
<span class="nc" id="L1586">                                    getFieldValue(&quot;currencyTimeLimit&quot;);</span>
<span class="nc bnc" id="L1587" title="All 2 branches missed.">                                if (objctl != null) ctl = objctl.toString();</span>
<span class="nc" id="L1588">                                else ctl = null;</span>
                            }

<span class="nc bnc" id="L1591" title="All 4 branches missed.">                            if ((ctl != null) &amp;&amp; !(ctl.equals(&quot;-1&quot;))) {</span>
<span class="nc bnc" id="L1592" title="All 2 branches missed.">                                if (tracing) {</span>
<span class="nc" id="L1593">                                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1594">                                            RequiredModelMBean.class.getName(),</span>
                                            mth,
                                            &quot;setting cached value and &quot; +
                                            &quot;lastUpdatedTime in descriptor&quot;);
                                }
<span class="nc" id="L1599">                                attrDescr.setField(&quot;value&quot;, response);</span>
<span class="nc" id="L1600">                                final String stamp = String.valueOf(</span>
<span class="nc" id="L1601">                                    (new Date()).getTime());</span>
<span class="nc" id="L1602">                                attrDescr.setField(&quot;lastUpdatedTimeStamp&quot;,</span>
                                                   stamp);
<span class="nc" id="L1604">                                attrInfo.setDescriptor(attrDescr);</span>
<span class="nc" id="L1605">                                modelMBeanInfo.setDescriptor(attrDescr,</span>
                                                             &quot;attribute&quot;);
<span class="nc bnc" id="L1607" title="All 2 branches missed.">                                if (tracing) {</span>
<span class="nc" id="L1608">                                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1609">                                            RequiredModelMBean.class.getName(),</span>
                                        mth,&quot;new descriptor is &quot; +attrDescr);
<span class="nc" id="L1611">                                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1612">                                            RequiredModelMBean.class.getName(),</span>
                                        mth,&quot;AttributeInfo descriptor is &quot; +
<span class="nc" id="L1614">                                            attrInfo.getDescriptor());</span>
<span class="nc" id="L1615">                                    final String attStr = modelMBeanInfo.</span>
<span class="nc" id="L1616">                                        getDescriptor(attrName,&quot;attribute&quot;).</span>
<span class="nc" id="L1617">                                            toString();</span>
<span class="nc" id="L1618">                                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1619">                                            RequiredModelMBean.class.getName(),</span>
                                            mth,
                                            &quot;modelMBeanInfo: AttributeInfo &quot; +
                                            &quot;descriptor is &quot; + attStr);
                                }
                            }
<span class="nc" id="L1625">                        } else {</span>
                            // response was invalid or really returned null
<span class="nc bnc" id="L1627" title="All 2 branches missed.">                            if (tracing) {</span>
<span class="nc" id="L1628">                                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1629">                                        RequiredModelMBean.class.getName(), mth,</span>
                                    &quot;got a null response from getMethod\n&quot;);
                            }
<span class="nc" id="L1632">                            response = null;</span>
                        }
<span class="nc" id="L1634">                    } else {</span>
                        // not getMethod so return descriptor (default) value
<span class="nc" id="L1636">                        String qualifier=&quot;&quot;;</span>
<span class="nc" id="L1637">                        response = attrDescr.getFieldValue(&quot;value&quot;);</span>
<span class="nc bnc" id="L1638" title="All 2 branches missed.">                        if (response == null) {</span>
<span class="nc" id="L1639">                            qualifier=&quot;default &quot;;</span>
<span class="nc" id="L1640">                            response = attrDescr.getFieldValue(&quot;default&quot;);</span>
                        }
<span class="nc bnc" id="L1642" title="All 2 branches missed.">                        if (tracing) {</span>
<span class="nc" id="L1643">                            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1644">                                    RequiredModelMBean.class.getName(), mth,</span>
                                &quot;could not find getMethod for &quot; +attrName +
                                &quot;, returning descriptor &quot; +qualifier + &quot;value&quot;);
                        }
                        // !! cast response to right class
                    }
                }

                // make sure response class matches type field
<span class="nc" id="L1653">                final String respType = attrInfo.getType();</span>
<span class="nc bnc" id="L1654" title="All 2 branches missed.">                if (response != null) {</span>
<span class="nc" id="L1655">                    String responseClass = response.getClass().getName();</span>
<span class="nc bnc" id="L1656" title="All 2 branches missed.">                    if (!respType.equals(responseClass)) {</span>
<span class="nc" id="L1657">                        boolean wrongType = false;</span>
<span class="nc" id="L1658">                        boolean primitiveType = false;</span>
<span class="nc" id="L1659">                        boolean correspondingTypes = false;</span>
<span class="nc bnc" id="L1660" title="All 2 branches missed.">                        for (int i = 0; i &lt; primitiveTypes.length; i++) {</span>
<span class="nc bnc" id="L1661" title="All 2 branches missed.">                            if (respType.equals(primitiveTypes[i])) {</span>
<span class="nc" id="L1662">                                primitiveType = true;</span>
<span class="nc bnc" id="L1663" title="All 2 branches missed.">                                if (responseClass.equals(primitiveWrappers[i]))</span>
<span class="nc" id="L1664">                                    correspondingTypes = true;</span>
                                break;
                            }
                        }
<span class="nc bnc" id="L1668" title="All 2 branches missed.">                        if (primitiveType) {</span>
                            // inequality may come from primitive/wrapper class
<span class="nc bnc" id="L1670" title="All 2 branches missed.">                            if (!correspondingTypes)</span>
<span class="nc" id="L1671">                                wrongType = true;</span>
                        } else {
                            // inequality may come from type subclassing
                            boolean subtype;
                            try {
<span class="nc" id="L1676">                                final Class respClass = response.getClass();</span>
<span class="nc" id="L1677">                                final Exception[] caughException = new Exception[1];</span>

<span class="nc" id="L1679">                                AccessControlContext stack = AccessController.getContext();</span>

<span class="nc" id="L1681">                                Class c = javaSecurityAccess.doIntersectionPrivilege(new PrivilegedAction&lt;Class&lt;?&gt;&gt;() {</span>

                                    @Override
                                    public Class&lt;?&gt; run() {
                                        try {
<span class="nc" id="L1686">                                            ReflectUtil.checkPackageAccess(respType);</span>
<span class="nc" id="L1687">                                            ClassLoader cl =</span>
<span class="nc" id="L1688">                                                respClass.getClassLoader();</span>
<span class="nc" id="L1689">                                            return Class.forName(respType, true, cl);</span>
<span class="nc" id="L1690">                                        } catch (Exception e) {</span>
<span class="nc" id="L1691">                                            caughException[0] = e;</span>
                                        }
<span class="nc" id="L1693">                                        return null;</span>
                                    }
                                }, stack, acc);

<span class="nc bnc" id="L1697" title="All 2 branches missed.">                                if (caughException[0] != null) {</span>
<span class="nc" id="L1698">                                    throw caughException[0];</span>
                                }

<span class="nc" id="L1701">                                subtype = c.isInstance(response);</span>
<span class="nc" id="L1702">                            } catch (Exception e) {</span>
<span class="nc" id="L1703">                                subtype = false;</span>

<span class="nc bnc" id="L1705" title="All 2 branches missed.">                                if (tracing) {</span>
<span class="nc" id="L1706">                                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1707">                                            RequiredModelMBean.class.getName(),</span>
                                        mth, &quot;Exception: &quot;,e);
                                }
<span class="nc" id="L1710">                            }</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">                            if (!subtype)</span>
<span class="nc" id="L1712">                                wrongType = true;</span>
                        }
<span class="nc bnc" id="L1714" title="All 2 branches missed.">                        if (wrongType) {</span>
<span class="nc bnc" id="L1715" title="All 2 branches missed.">                            if (tracing) {</span>
<span class="nc" id="L1716">                                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1717">                                        RequiredModelMBean.class.getName(), mth,</span>
                                    &quot;Wrong response type '&quot; + respType + &quot;'&quot;);
                            }
                            // throw exception, didn't get
                            // back right attribute type
<span class="nc" id="L1722">                            throw new MBeanException(</span>
                              new InvalidAttributeValueException(
                                &quot;Wrong value type received for get attribute&quot;),
                              &quot;An exception occurred while trying to get an &quot; +
                              &quot;attribute value through a RequiredModelMBean&quot;);
                        }
                    }
                }
<span class="nc" id="L1730">            } else {</span>
<span class="nc bnc" id="L1731" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L1732">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1733">                            RequiredModelMBean.class.getName(), mth,</span>
                            &quot;getMethod failed &quot; + attrName +
                            &quot; not in attributeDescriptor\n&quot;);
                }
<span class="nc" id="L1737">                throw new MBeanException(new</span>
                    InvalidAttributeValueException(
                    &quot;Unable to resolve attribute value, &quot; +
                    &quot;no getMethod defined in descriptor for attribute&quot;),
                    &quot;An exception occurred while trying to get an &quot;+
                    &quot;attribute value through a RequiredModelMBean&quot;);
            }

<span class="nc" id="L1745">        } catch (MBeanException mbe) {</span>
<span class="nc" id="L1746">            throw mbe;</span>
<span class="nc" id="L1747">        } catch (AttributeNotFoundException t) {</span>
<span class="nc" id="L1748">            throw t;</span>
<span class="nc" id="L1749">        } catch (Exception e) {</span>
<span class="nc bnc" id="L1750" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L1751">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1752">                        RequiredModelMBean.class.getName(), mth,</span>
<span class="nc" id="L1753">                        &quot;getMethod failed with &quot; + e.getMessage() +</span>
<span class="nc" id="L1754">                        &quot; exception type &quot; + (e.getClass()).toString());</span>
            }
<span class="nc" id="L1756">            throw new MBeanException(e,&quot;An exception occurred while trying &quot;+</span>
<span class="nc" id="L1757">                      &quot;to get an attribute value: &quot; + e.getMessage());</span>
<span class="nc" id="L1758">        }</span>

<span class="nc bnc" id="L1760" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1761">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1762">                    RequiredModelMBean.class.getName(), mth, &quot;Exit&quot;);</span>
        }

<span class="nc" id="L1765">        return response;</span>
    }

    /**
     * Returns the values of several attributes in the ModelMBean.
     * Executes a getAttribute for each attribute name in the
     * attrNames array passed in.
     *
     * @param attrNames A String array of names of the attributes
     * to be retrieved.
     *
     * @return The array of the retrieved attributes.
     *
     * @exception RuntimeOperationsException Wraps an
     * {@link IllegalArgumentException}: The object name in parameter is
     * null or attributes in parameter is null.
     *
     * @see #setAttributes(javax.management.AttributeList)
     */
    public AttributeList getAttributes(String[] attrNames)      {
<span class="nc bnc" id="L1785" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L1786">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1787">                    RequiredModelMBean.class.getName(),</span>
            &quot;getAttributes(String[])&quot;,&quot;Entry&quot;);
        }

<span class="nc bnc" id="L1791" title="All 2 branches missed.">        if (attrNames == null)</span>
<span class="nc" id="L1792">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;attributeNames must not be null&quot;),
                &quot;Exception occurred trying to get attributes of a &quot;+
                &quot;RequiredModelMBean&quot;);

<span class="nc" id="L1797">        AttributeList responseList = new AttributeList();</span>
<span class="nc bnc" id="L1798" title="All 2 branches missed.">        for (int i = 0; i &lt; attrNames.length; i++) {</span>
            try {
<span class="nc" id="L1800">                responseList.add(new Attribute(attrNames[i],</span>
<span class="nc" id="L1801">                                     getAttribute(attrNames[i])));</span>
<span class="nc" id="L1802">            } catch (Exception e) {</span>
                // eat exceptions because interface doesn't have an
                // exception on it
<span class="nc bnc" id="L1805" title="All 2 branches missed.">                if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L1806">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1807">                            RequiredModelMBean.class.getName(),</span>
                        &quot;getAttributes(String[])&quot;,
                            &quot;Failed to get \&quot;&quot; + attrNames[i] + &quot;\&quot;: &quot;, e);
                }
<span class="nc" id="L1811">            }</span>
        }

<span class="nc bnc" id="L1814" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L1815">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1816">                RequiredModelMBean.class.getName(),</span>
                    &quot;getAttributes(String[])&quot;,&quot;Exit&quot;);
        }

<span class="nc" id="L1820">        return responseList;</span>
    }

    /**
     * Sets the value of a specific attribute of a named ModelMBean.
     *
     * If the 'setMethod' field of the attribute's descriptor
     * contains the name of a valid operation descriptor, then the
     * method described by the operation descriptor is executed.
     * In this implementation, the operation descriptor must be specified
     * correctly and assigned to the modelMBeanInfo so that the 'setMethod'
     * works correctly.
     * The response from the method is set as the value of the attribute
     * in the descriptor.
     *
     * &lt;p&gt;If currencyTimeLimit is &amp;gt; 0, then the new value for the
     * attribute is cached in the attribute descriptor's
     * 'value' field and the 'lastUpdatedTimeStamp' field is set to
     * the current time stamp.
     *
     * &lt;p&gt;If the persist field of the attribute's descriptor is not null
     * then Persistence policy from the attribute descriptor is used to
     * guide storing the attribute in a persistent store.
     * &lt;br&gt;Store the MBean if 'persistPolicy' field is:
     * &lt;UL&gt;
     * &lt;Li&gt; != &quot;never&quot;&lt;/Li&gt;
     * &lt;Li&gt; = &quot;always&quot;&lt;/Li&gt;
     * &lt;Li&gt; = &quot;onUpdate&quot;&lt;/Li&gt;
     * &lt;Li&gt; {@literal = &quot;onTimer&quot; and now &gt; 'lastPersistTime' + 'persistPeriod'}&lt;/Li&gt;
     * &lt;Li&gt; {@literal = &quot;NoMoreOftenThan&quot; and now &gt; 'lastPersistTime' +
     *         'persistPeriod'}&lt;/Li&gt;
     * &lt;/UL&gt;
     * Do not store the MBean if 'persistPolicy' field is:
     * &lt;UL&gt;
     * &lt;Li&gt; = &quot;never&quot;&lt;/Li&gt;
     * &lt;Li&gt; = {@literal = &quot;onTimer&quot; &amp;&amp; now &lt; 'lastPersistTime' + 'persistPeriod'}&lt;/Li&gt;
     * &lt;Li&gt; = &quot;onUnregister&quot;&lt;/Li&gt;
     * &lt;Li&gt; = {@literal = &quot;NoMoreOftenThan&quot; and now &lt; 'lastPersistTime' +
     *        'persistPeriod'}&lt;/Li&gt;
     * &lt;/UL&gt;
     *
     * &lt;p&gt;The ModelMBeanInfo of the Model MBean is stored in a file.
     *
     * @param attribute The Attribute instance containing the name of
     *        the attribute to be set and the value it is to be set to.
     *
     *
     * @exception AttributeNotFoundException The specified attribute is
     *   not accessible in the MBean.
     *   &lt;br&gt;The following cases may result in an AttributeNotFoundException:
     *   &lt;UL&gt;
     *     &lt;LI&gt; No ModelMBeanAttributeInfo is found for the specified
     *          attribute.&lt;/LI&gt;
     *     &lt;LI&gt; The ModelMBeanAttributeInfo's isWritable method returns
     *          'false'.&lt;/LI&gt;
     *   &lt;/UL&gt;
     * @exception InvalidAttributeValueException No descriptor is defined
     *   for the specified attribute.
     * @exception MBeanException Wraps one of the following Exceptions:
     *   &lt;UL&gt;
     *     &lt;LI&gt; An Exception thrown by the managed object's setter.&lt;/LI&gt;
     *     &lt;LI&gt; A {@link ServiceNotFoundException} if a setMethod field is
     *          defined in the descriptor for the attribute and the managed
     *          resource is null; or if no setMethod field is defined and
     *          caching is not enabled for the attribute.
     *          Note that if there is no getMethod field either, then caching
     *          is automatically enabled.&lt;/LI&gt;
     *     &lt;LI&gt; {@link InvalidTargetObjectTypeException} The 'targetType'
     *          field value is not 'objectReference'.&lt;/LI&gt;
     *     &lt;LI&gt; An Exception thrown by the managed object's getter.&lt;/LI&gt;
     *   &lt;/UL&gt;
     * @exception ReflectionException  Wraps an {@link java.lang.Exception}
     *   thrown while trying to invoke the setter.
     * @exception RuntimeOperationsException Wraps an
     *   {@link IllegalArgumentException}: The attribute in parameter is
     *   null.
     *
     * @see #getAttribute(java.lang.String)
     **/
    public void setAttribute(Attribute attribute)
        throws AttributeNotFoundException, InvalidAttributeValueException,
               MBeanException, ReflectionException {
<span class="nc" id="L1902">        final boolean tracing = MODELMBEAN_LOGGER.isLoggable(Level.FINER);</span>
<span class="nc bnc" id="L1903" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L1904">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1905">                    RequiredModelMBean.class.getName(),</span>
                &quot;setAttribute()&quot;,&quot;Entry&quot;);
        }

<span class="nc bnc" id="L1909" title="All 2 branches missed.">        if (attribute == null)</span>
<span class="nc" id="L1910">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;attribute must not be null&quot;),
                &quot;Exception occurred trying to set an attribute of a &quot;+
                &quot;RequiredModelMBean&quot;);

        /* run setMethod if there is one */
        /* return cached value if its current */
        /* set cached value in descriptor and set date/time */
        /* send attribute change Notification */
        /* check persistence policy and persist if need be */
<span class="nc" id="L1920">        String attrName = attribute.getName();</span>
<span class="nc" id="L1921">        Object attrValue = attribute.getValue();</span>
<span class="nc" id="L1922">        boolean updateDescriptor = false;</span>

<span class="nc" id="L1924">        ModelMBeanAttributeInfo attrInfo =</span>
<span class="nc" id="L1925">            modelMBeanInfo.getAttribute(attrName);</span>

<span class="nc bnc" id="L1927" title="All 2 branches missed.">        if (attrInfo == null)</span>
<span class="nc" id="L1928">            throw new AttributeNotFoundException(&quot;setAttribute failed: &quot; +</span>
                                               attrName + &quot; is not found &quot;);

<span class="nc" id="L1931">        Descriptor mmbDesc = modelMBeanInfo.getMBeanDescriptor();</span>
<span class="nc" id="L1932">        Descriptor attrDescr = attrInfo.getDescriptor();</span>

<span class="nc bnc" id="L1934" title="All 2 branches missed.">        if (attrDescr != null) {</span>
<span class="nc bnc" id="L1935" title="All 2 branches missed.">            if (!attrInfo.isWritable())</span>
<span class="nc" id="L1936">                throw new AttributeNotFoundException(&quot;setAttribute failed: &quot;</span>
                                          + attrName + &quot; is not writable &quot;);

<span class="nc" id="L1939">            String attrSetMethod = (String)</span>
<span class="nc" id="L1940">                (attrDescr.getFieldValue(&quot;setMethod&quot;));</span>
<span class="nc" id="L1941">            String attrGetMethod = (String)</span>
<span class="nc" id="L1942">                (attrDescr.getFieldValue(&quot;getMethod&quot;));</span>

<span class="nc" id="L1944">            String attrType = attrInfo.getType();</span>
<span class="nc" id="L1945">            Object currValue = &quot;Unknown&quot;;</span>

            try {
<span class="nc" id="L1948">                currValue = this.getAttribute(attrName);</span>
<span class="nc" id="L1949">            } catch (Throwable t) {</span>
                // OK: Default &quot;Unknown&quot; value used for unknown attribute
<span class="nc" id="L1951">            }</span>

<span class="nc" id="L1953">            Attribute oldAttr = new Attribute(attrName, currValue);</span>

            /* run method from operations descriptor */
<span class="nc bnc" id="L1956" title="All 2 branches missed.">            if (attrSetMethod == null) {</span>
<span class="nc bnc" id="L1957" title="All 2 branches missed.">                if (attrValue != null) {</span>
                    try {
<span class="nc" id="L1959">                        final Class&lt;?&gt; clazz = loadClass(attrType);</span>
<span class="nc bnc" id="L1960" title="All 2 branches missed.">                        if (! clazz.isInstance(attrValue))  throw new</span>
<span class="nc" id="L1961">                            InvalidAttributeValueException(clazz.getName() +</span>
                                                           &quot; expected, &quot;   +
<span class="nc" id="L1963">                                            attrValue.getClass().getName() +</span>
                                                           &quot; received.&quot;);
<span class="nc" id="L1965">                    } catch (ClassNotFoundException x) {</span>
<span class="nc bnc" id="L1966" title="All 2 branches missed.">                        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L1967">                            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L1968">                                    RequiredModelMBean.class.getName(),</span>
                                &quot;setAttribute(Attribute)&quot;,&quot;Class &quot; +
                                    attrType + &quot; for attribute &quot;
                                + attrName + &quot; not found: &quot;, x);
                        }
<span class="nc" id="L1973">                    }</span>
                }
<span class="nc" id="L1975">                updateDescriptor = true;</span>
            } else {
<span class="nc" id="L1977">                invoke(attrSetMethod,</span>
                       (new Object[] {attrValue}),
                       (new String[] {attrType}) );
            }

            /* change cached value */
<span class="nc" id="L1983">            Object objctl = attrDescr.getFieldValue(&quot;currencyTimeLimit&quot;);</span>
            String ctl;
<span class="nc bnc" id="L1985" title="All 2 branches missed.">            if (objctl != null) ctl = objctl.toString();</span>
<span class="nc" id="L1986">            else ctl = null;</span>

<span class="nc bnc" id="L1988" title="All 4 branches missed.">            if ((ctl == null) &amp;&amp; (mmbDesc != null)) {</span>
<span class="nc" id="L1989">                objctl = mmbDesc.getFieldValue(&quot;currencyTimeLimit&quot;);</span>
<span class="nc bnc" id="L1990" title="All 2 branches missed.">                if (objctl != null) ctl = objctl.toString();</span>
<span class="nc" id="L1991">                else ctl = null;</span>
            }

<span class="nc bnc" id="L1994" title="All 4 branches missed.">            final boolean updateCache = ((ctl != null) &amp;&amp; !(ctl.equals(&quot;-1&quot;)));</span>

<span class="nc bnc" id="L1996" title="All 6 branches missed.">             if(attrSetMethod == null  &amp;&amp; !updateCache &amp;&amp; attrGetMethod != null)</span>
<span class="nc" id="L1997">                throw new MBeanException(new ServiceNotFoundException(&quot;No &quot; +</span>
                        &quot;setMethod field is defined in the descriptor for &quot; +
                        attrName + &quot; attribute and caching is not enabled &quot; +
                        &quot;for it&quot;));

<span class="nc bnc" id="L2002" title="All 4 branches missed.">            if (updateCache || updateDescriptor) {</span>
<span class="nc bnc" id="L2003" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L2004">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2005">                        RequiredModelMBean.class.getName(),</span>
                            &quot;setAttribute(Attribute)&quot;,
                            &quot;setting cached value of &quot; +
                            attrName + &quot; to &quot; + attrValue);
                }

<span class="nc" id="L2011">                attrDescr.setField(&quot;value&quot;, attrValue);</span>

<span class="nc bnc" id="L2013" title="All 2 branches missed.">                if (updateCache) {</span>
<span class="nc" id="L2014">                    final String currtime = String.valueOf(</span>
<span class="nc" id="L2015">                        (new Date()).getTime());</span>

<span class="nc" id="L2017">                    attrDescr.setField(&quot;lastUpdatedTimeStamp&quot;, currtime);</span>
                }

<span class="nc" id="L2020">                attrInfo.setDescriptor(attrDescr);</span>

<span class="nc" id="L2022">                modelMBeanInfo.setDescriptor(attrDescr,&quot;attribute&quot;);</span>
<span class="nc bnc" id="L2023" title="All 2 branches missed.">                if (tracing) {</span>
<span class="nc" id="L2024">                    final StringBuilder strb = new StringBuilder()</span>
<span class="nc" id="L2025">                    .append(&quot;new descriptor is &quot;).append(attrDescr)</span>
<span class="nc" id="L2026">                    .append(&quot;. AttributeInfo descriptor is &quot;)</span>
<span class="nc" id="L2027">                    .append(attrInfo.getDescriptor())</span>
<span class="nc" id="L2028">                    .append(&quot;. AttributeInfo descriptor is &quot;)</span>
<span class="nc" id="L2029">                    .append(modelMBeanInfo.getDescriptor(attrName,&quot;attribute&quot;));</span>
<span class="nc" id="L2030">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2031">                            RequiredModelMBean.class.getName(),</span>
<span class="nc" id="L2032">                            &quot;setAttribute(Attribute)&quot;,strb.toString());</span>
                }

            }

<span class="nc bnc" id="L2037" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L2038">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2039">                        RequiredModelMBean.class.getName(),</span>
                &quot;setAttribute(Attribute)&quot;,&quot;sending sendAttributeNotification&quot;);
            }
<span class="nc" id="L2042">            sendAttributeChangeNotification(oldAttr,attribute);</span>

<span class="nc" id="L2044">        } else { // if descriptor ... else no descriptor</span>

<span class="nc bnc" id="L2046" title="All 2 branches missed.">            if (tracing) {</span>
<span class="nc" id="L2047">                    MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2048">                            RequiredModelMBean.class.getName(),</span>
                        &quot;setAttribute(Attribute)&quot;,&quot;setMethod failed &quot;+attrName+
                        &quot; not in attributeDescriptor\n&quot;);
            }

<span class="nc" id="L2053">            throw new InvalidAttributeValueException(</span>
                      &quot;Unable to resolve attribute value, &quot;+
                      &quot;no defined in descriptor for attribute&quot;);
        } // else no descriptor

<span class="nc bnc" id="L2058" title="All 2 branches missed.">        if (tracing) {</span>
<span class="nc" id="L2059">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2060">                    RequiredModelMBean.class.getName(),</span>
                &quot;setAttribute(Attribute)&quot;, &quot;Exit&quot;);
        }

<span class="nc" id="L2064">    }</span>

    /**
     * Sets the values of an array of attributes of this ModelMBean.
     * Executes the setAttribute() method for each attribute in the list.
     *
     * @param attributes A list of attributes: The identification of the
     * attributes to be set and  the values they are to be set to.
     *
     * @return  The array of attributes that were set, with their new
     *    values in Attribute instances.
     *
     * @exception RuntimeOperationsException Wraps an
     *   {@link IllegalArgumentException}: The object name in parameter
     *   is null or attributes in parameter is null.
     *
     * @see #getAttributes
     **/
    public AttributeList setAttributes(AttributeList attributes) {

<span class="nc bnc" id="L2084" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2085">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2086">                    RequiredModelMBean.class.getName(),</span>
                &quot;setAttribute(Attribute)&quot;, &quot;Entry&quot;);
        }

<span class="nc bnc" id="L2090" title="All 2 branches missed.">        if (attributes == null)</span>
<span class="nc" id="L2091">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;attributes must not be null&quot;),
                &quot;Exception occurred trying to set attributes of a &quot;+
                &quot;RequiredModelMBean&quot;);

<span class="nc" id="L2096">        final AttributeList responseList = new AttributeList();</span>

        // Go through the list of attributes
<span class="nc bnc" id="L2099" title="All 2 branches missed.">        for (Attribute attr : attributes.asList()) {</span>
            try {
<span class="nc" id="L2101">                setAttribute(attr);</span>
<span class="nc" id="L2102">                responseList.add(attr);</span>
<span class="nc" id="L2103">            } catch (Exception excep) {</span>
<span class="nc" id="L2104">                responseList.remove(attr);</span>
<span class="nc" id="L2105">            }</span>
<span class="nc" id="L2106">        }</span>

<span class="nc" id="L2108">        return responseList;</span>
    }



    private ModelMBeanInfo createDefaultModelMBeanInfo() {
<span class="nc" id="L2114">        return(new ModelMBeanInfoSupport((this.getClass().getName()),</span>
                   &quot;Default ModelMBean&quot;, null, null, null, null));
    }

    /*************************************/
    /* NotificationBroadcaster Interface */
    /*************************************/


    private synchronized void writeToLog(String logFileName,
                                         String logEntry) throws Exception {

<span class="nc bnc" id="L2126" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2127">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2128">                    RequiredModelMBean.class.getName(),</span>
                &quot;writeToLog(String, String)&quot;,
                &quot;Notification Logging to &quot; + logFileName + &quot;: &quot; + logEntry);
        }
<span class="nc bnc" id="L2132" title="All 4 branches missed.">        if ((logFileName == null) || (logEntry == null)) {</span>
<span class="nc bnc" id="L2133" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2134">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2135">                        RequiredModelMBean.class.getName(),</span>
                    &quot;writeToLog(String, String)&quot;,
                    &quot;Bad input parameters, will not log this entry.&quot;);
            }
<span class="nc" id="L2139">            return;</span>
        }

<span class="nc" id="L2142">        FileOutputStream fos = new FileOutputStream(logFileName, true);</span>
        try {
<span class="nc" id="L2144">            PrintStream logOut = new PrintStream(fos);</span>
<span class="nc" id="L2145">            logOut.println(logEntry);</span>
<span class="nc" id="L2146">            logOut.close();</span>
<span class="nc bnc" id="L2147" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2148">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2149">                        RequiredModelMBean.class.getName(),</span>
                    &quot;writeToLog(String, String)&quot;,&quot;Successfully opened log &quot; +
                        logFileName);
            }
<span class="nc" id="L2153">        } catch (Exception e) {</span>
<span class="nc bnc" id="L2154" title="All 2 branches missed.">            if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2155">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2156">                    RequiredModelMBean.class.getName(),</span>
                        &quot;writeToLog(String, String)&quot;,
<span class="nc" id="L2158">                        &quot;Exception &quot; + e.toString() +</span>
                        &quot; trying to write to the Notification log file &quot; +
                        logFileName);
            }
<span class="nc" id="L2162">            throw e;</span>
        } finally {
<span class="nc" id="L2164">            fos.close();</span>
<span class="nc" id="L2165">        }</span>
<span class="nc" id="L2166">    }</span>


    /**
     * Registers an object which implements the NotificationListener
     * interface as a listener.  This
     * object's 'handleNotification()' method will be invoked when any
     * notification is issued through or by the ModelMBean.  This does
     * not include attributeChangeNotifications.  They must be registered
     * for independently.
     *
     * @param listener The listener object which will handles
     *        notifications emitted by the registered MBean.
     * @param filter The filter object. If null, no filtering will be
     *        performed before handling notifications.
     * @param handback The context to be sent to the listener with
     *        the notification when a notification is emitted.
     *
     * @exception IllegalArgumentException The listener cannot be null.
     *
     * @see #removeNotificationListener
     */
    public void addNotificationListener(NotificationListener listener,
                                        NotificationFilter filter,
                                        Object handback)
        throws java.lang.IllegalArgumentException {
        final String mth = &quot;addNotificationListener(&quot; +
                &quot;NotificationListener, NotificationFilter, Object)&quot;;
<span class="nc bnc" id="L2194" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2195">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2196">                        RequiredModelMBean.class.getName(), mth, &quot;Entry&quot;);</span>
        }

<span class="nc bnc" id="L2199" title="All 2 branches missed.">        if (listener == null)</span>
<span class="nc" id="L2200">            throw new IllegalArgumentException(</span>
                  &quot;notification listener must not be null&quot;);

<span class="nc bnc" id="L2203" title="All 2 branches missed.">        if (generalBroadcaster == null)</span>
<span class="nc" id="L2204">            generalBroadcaster = new NotificationBroadcasterSupport();</span>

<span class="nc" id="L2206">        generalBroadcaster.addNotificationListener(listener, filter,</span>
                                                   handback);
<span class="nc bnc" id="L2208" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2209">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2210">                        RequiredModelMBean.class.getName(), mth,</span>
                    &quot;NotificationListener added&quot;);
<span class="nc" id="L2212">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2213">                        RequiredModelMBean.class.getName(), mth, &quot;Exit&quot;);</span>
        }
<span class="nc" id="L2215">    }</span>

    /**
     * Removes a listener for Notifications from the RequiredModelMBean.
     *
     * @param listener The listener name which was handling notifications
     *    emitted by the registered MBean.
     *    This method will remove all information related to this listener.
     *
     * @exception ListenerNotFoundException The listener is not registered
     *    in the MBean or is null.
     *
     * @see #addNotificationListener
     **/
    public void removeNotificationListener(NotificationListener listener)
        throws ListenerNotFoundException {
<span class="nc bnc" id="L2231" title="All 2 branches missed.">        if (listener == null)</span>
<span class="nc" id="L2232">            throw new ListenerNotFoundException(</span>
                      &quot;Notification listener is null&quot;);

        final String mth=&quot;removeNotificationListener(NotificationListener)&quot;;
<span class="nc bnc" id="L2236" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2237">                MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2238">                    RequiredModelMBean.class.getName(), mth, &quot;Entry&quot;);</span>
        }

<span class="nc bnc" id="L2241" title="All 2 branches missed.">        if (generalBroadcaster == null)</span>
<span class="nc" id="L2242">            throw new ListenerNotFoundException(</span>
                  &quot;No notification listeners registered&quot;);


<span class="nc" id="L2246">        generalBroadcaster.removeNotificationListener(listener);</span>
<span class="nc bnc" id="L2247" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2248">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2249">                    RequiredModelMBean.class.getName(), mth, &quot;Exit&quot;);</span>
        }

<span class="nc" id="L2252">    }</span>

    public void removeNotificationListener(NotificationListener listener,
                                           NotificationFilter filter,
                                           Object handback)
        throws ListenerNotFoundException {

<span class="nc bnc" id="L2259" title="All 2 branches missed.">        if (listener == null)</span>
<span class="nc" id="L2260">            throw new ListenerNotFoundException(</span>
                      &quot;Notification listener is null&quot;);

        final String mth = &quot;removeNotificationListener(&quot; +
                &quot;NotificationListener, NotificationFilter, Object)&quot;;

<span class="nc bnc" id="L2266" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2267">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2268">                    RequiredModelMBean.class.getName(), mth, &quot;Entry&quot;);</span>
        }

<span class="nc bnc" id="L2271" title="All 2 branches missed.">        if (generalBroadcaster == null)</span>
<span class="nc" id="L2272">            throw new ListenerNotFoundException(</span>
                  &quot;No notification listeners registered&quot;);


<span class="nc" id="L2276">        generalBroadcaster.removeNotificationListener(listener,filter,</span>
                                                      handback);

<span class="nc bnc" id="L2279" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2280">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2281">                    RequiredModelMBean.class.getName(), mth, &quot;Exit&quot;);</span>
        }

<span class="nc" id="L2284">    }</span>

    public void sendNotification(Notification ntfyObj)
        throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L2288" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2289">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2290">                    RequiredModelMBean.class.getName(),</span>
                &quot;sendNotification(Notification)&quot;, &quot;Entry&quot;);
        }

<span class="nc bnc" id="L2294" title="All 2 branches missed.">        if (ntfyObj == null)</span>
<span class="nc" id="L2295">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;notification object must not be &quot;+
                                         &quot;null&quot;),
                &quot;Exception occurred trying to send a notification from a &quot;+
                &quot;RequiredModelMBean&quot;);


        // log notification if specified in descriptor
<span class="nc" id="L2303">        Descriptor ntfyDesc =</span>
<span class="nc" id="L2304">            modelMBeanInfo.getDescriptor(ntfyObj.getType(),&quot;notification&quot;);</span>
<span class="nc" id="L2305">        Descriptor mmbDesc = modelMBeanInfo.getMBeanDescriptor();</span>

<span class="nc bnc" id="L2307" title="All 2 branches missed.">        if (ntfyDesc != null) {</span>
<span class="nc" id="L2308">            String logging = (String) ntfyDesc.getFieldValue(&quot;log&quot;);</span>

<span class="nc bnc" id="L2310" title="All 2 branches missed.">            if (logging == null) {</span>
<span class="nc bnc" id="L2311" title="All 2 branches missed.">                if (mmbDesc != null)</span>
<span class="nc" id="L2312">                    logging = (String) mmbDesc.getFieldValue(&quot;log&quot;);</span>
            }

<span class="nc bnc" id="L2315" title="All 2 branches missed.">            if ((logging != null) &amp;&amp;</span>
<span class="nc bnc" id="L2316" title="All 2 branches missed.">                (logging.equalsIgnoreCase(&quot;t&quot;) ||</span>
<span class="nc bnc" id="L2317" title="All 2 branches missed.">                 logging.equalsIgnoreCase(&quot;true&quot;))) {</span>

<span class="nc" id="L2319">                String logfile = (String) ntfyDesc.getFieldValue(&quot;logfile&quot;);</span>
<span class="nc bnc" id="L2320" title="All 2 branches missed.">                if (logfile == null) {</span>
<span class="nc bnc" id="L2321" title="All 2 branches missed.">                    if (mmbDesc != null)</span>
<span class="nc" id="L2322">                        logfile = (String)mmbDesc.getFieldValue(&quot;logfile&quot;);</span>
                }
<span class="nc bnc" id="L2324" title="All 2 branches missed.">                if (logfile != null) {</span>
                    try {
<span class="nc" id="L2326">                        writeToLog(logfile,&quot;LogMsg: &quot; +</span>
<span class="nc" id="L2327">                            ((new Date(ntfyObj.getTimeStamp())).toString())+</span>
<span class="nc" id="L2328">                            &quot; &quot; + ntfyObj.getType() + &quot; &quot; +</span>
<span class="nc" id="L2329">                            ntfyObj.getMessage() + &quot; Severity = &quot; +</span>
<span class="nc" id="L2330">                            (String)ntfyDesc.getFieldValue(&quot;severity&quot;));</span>
<span class="nc" id="L2331">                    } catch (Exception e) {</span>
<span class="nc bnc" id="L2332" title="All 2 branches missed.">                        if (MODELMBEAN_LOGGER.isLoggable(Level.FINE)) {</span>
<span class="nc" id="L2333">                            MODELMBEAN_LOGGER.logp(Level.FINE,</span>
<span class="nc" id="L2334">                                    RequiredModelMBean.class.getName(),</span>
                                    &quot;sendNotification(Notification)&quot;,
                                    &quot;Failed to log &quot; +
<span class="nc" id="L2337">                                    ntfyObj.getType() + &quot; notification: &quot;, e);</span>
                        }
<span class="nc" id="L2339">                    }</span>
                }
            }
        }
<span class="nc bnc" id="L2343" title="All 2 branches missed.">        if (generalBroadcaster != null) {</span>
<span class="nc" id="L2344">            generalBroadcaster.sendNotification(ntfyObj);</span>
        }

<span class="nc bnc" id="L2347" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2348">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2349">                RequiredModelMBean.class.getName(),</span>
                    &quot;sendNotification(Notification)&quot;,
                    &quot;sendNotification sent provided notification object&quot;);
<span class="nc" id="L2352">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2353">                RequiredModelMBean.class.getName(),</span>
                    &quot;sendNotification(Notification)&quot;,&quot; Exit&quot;);
        }

<span class="nc" id="L2357">    }</span>


    public void sendNotification(String ntfyText)
        throws MBeanException, RuntimeOperationsException {
<span class="nc bnc" id="L2362" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2363">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2364">                    RequiredModelMBean.class.getName(),</span>
                &quot;sendNotification(String)&quot;,&quot;Entry&quot;);
        }

<span class="nc bnc" id="L2368" title="All 2 branches missed.">        if (ntfyText == null)</span>
<span class="nc" id="L2369">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;notification message must not &quot;+
                                         &quot;be null&quot;),
                &quot;Exception occurred trying to send a text notification &quot;+
                &quot;from a ModelMBean&quot;);

<span class="nc" id="L2375">        Notification myNtfyObj = new Notification(&quot;jmx.modelmbean.generic&quot;,</span>
                                                  this, 1, ntfyText);
<span class="nc" id="L2377">        sendNotification(myNtfyObj);</span>
<span class="nc bnc" id="L2378" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2379">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2380">                    RequiredModelMBean.class.getName(),</span>
                &quot;sendNotification(String)&quot;,&quot;Notification sent&quot;);
<span class="nc" id="L2382">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2383">                    RequiredModelMBean.class.getName(),</span>
                &quot;sendNotification(String)&quot;,&quot;Exit&quot;);
        }
<span class="nc" id="L2386">    }</span>

    /**
     * Returns `true' if the notification `notifName' is found
     * in `info'. (bug 4744667)
     **/
    private static final
        boolean hasNotification(final ModelMBeanInfo info,
                                final String notifName) {
        try {
<span class="nc bnc" id="L2396" title="All 2 branches missed.">            if (info == null) return false;</span>
<span class="nc bnc" id="L2397" title="All 2 branches missed.">            else return (info.getNotification(notifName)!=null);</span>
<span class="nc" id="L2398">        } catch (MBeanException x) {</span>
<span class="nc" id="L2399">            return false;</span>
<span class="nc" id="L2400">        } catch (RuntimeOperationsException r) {</span>
<span class="nc" id="L2401">            return false;</span>
        }
    }

    /**
     * Creates a default ModelMBeanNotificationInfo for GENERIC
     * notification.  (bug 4744667)
     **/
    private static final ModelMBeanNotificationInfo makeGenericInfo() {
<span class="nc" id="L2410">        final Descriptor genericDescriptor = new DescriptorSupport( new</span>
            String[] {
                &quot;name=GENERIC&quot;,
                &quot;descriptorType=notification&quot;,
                &quot;log=T&quot;,
                &quot;severity=6&quot;,
                &quot;displayName=jmx.modelmbean.generic&quot;} );

<span class="nc" id="L2418">        return new ModelMBeanNotificationInfo(new</span>
            String[] {&quot;jmx.modelmbean.generic&quot;},
            &quot;GENERIC&quot;,
            &quot;A text notification has been issued by the managed resource&quot;,
            genericDescriptor);
    }

    /**
     * Creates a default ModelMBeanNotificationInfo for ATTRIBUTE_CHANGE
     * notification.  (bug 4744667)
     **/
    private static final
        ModelMBeanNotificationInfo makeAttributeChangeInfo() {
<span class="nc" id="L2431">        final Descriptor attributeDescriptor = new DescriptorSupport(new</span>
            String[] {
                &quot;name=ATTRIBUTE_CHANGE&quot;,
                &quot;descriptorType=notification&quot;,
                &quot;log=T&quot;,
                &quot;severity=6&quot;,
                &quot;displayName=jmx.attribute.change&quot;});

<span class="nc" id="L2439">        return new ModelMBeanNotificationInfo(new</span>
            String[] {&quot;jmx.attribute.change&quot;},
            &quot;ATTRIBUTE_CHANGE&quot;,
            &quot;Signifies that an observed MBean attribute value has changed&quot;,
            attributeDescriptor );
    }

    /**
     * Returns the array of Notifications always generated by the
     * RequiredModelMBean.
     * &lt;P&gt;
     *
     * RequiredModelMBean may always send also two additional notifications:
     * &lt;UL&gt;
     *   &lt;LI&gt; One with descriptor &lt;code&gt;&quot;name=GENERIC,descriptorType=notification,log=T,severity=6,displayName=jmx.modelmbean.generic&quot;&lt;/code&gt;&lt;/LI&gt;
     *   &lt;LI&gt; Second is a standard attribute change notification
     *        with descriptor &lt;code&gt;&quot;name=ATTRIBUTE_CHANGE,descriptorType=notification,log=T,severity=6,displayName=jmx.attribute.change&quot;&lt;/code&gt;&lt;/LI&gt;
     * &lt;/UL&gt;
     * Thus these two notifications are always added to those specified
     * by the application.
     *
     * @return MBeanNotificationInfo[]
     *
     **/
    public MBeanNotificationInfo[] getNotificationInfo() {
<span class="nc bnc" id="L2464" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2465">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2466">                    RequiredModelMBean.class.getName(),</span>
                &quot;getNotificationInfo()&quot;,&quot;Entry&quot;);
        }

        // Using hasNotification() is not optimal, but shouldn't really
        // matter in this context...

        // hasGeneric==true if GENERIC notification is present.
        // (bug 4744667)
<span class="nc" id="L2475">        final boolean hasGeneric = hasNotification(modelMBeanInfo,&quot;GENERIC&quot;);</span>

        // hasAttributeChange==true if ATTRIBUTE_CHANGE notification is
        // present.
        // (bug 4744667)
<span class="nc" id="L2480">        final boolean hasAttributeChange =</span>
<span class="nc" id="L2481">           hasNotification(modelMBeanInfo,&quot;ATTRIBUTE_CHANGE&quot;);</span>

        // User supplied list of notification infos.
        //
<span class="nc" id="L2485">        final ModelMBeanNotificationInfo[] currInfo =</span>
<span class="nc" id="L2486">           (ModelMBeanNotificationInfo[])modelMBeanInfo.getNotifications();</span>

        // Length of the returned list of notification infos:
        //    length of user suplied list + possibly 1 for GENERIC, +
        //    possibly 1 for ATTRIBUTE_CHANGE
        //    (bug 4744667)
<span class="nc bnc" id="L2492" title="All 6 branches missed.">        final int len = ((currInfo==null?0:currInfo.length) +</span>
                         (hasGeneric?0:1) + (hasAttributeChange?0:1));

        // Returned list of notification infos:
        //
<span class="nc" id="L2497">        final ModelMBeanNotificationInfo[] respInfo =</span>
           new ModelMBeanNotificationInfo[len];

        // Preserve previous ordering (JMX 1.1)
        //

        // Counter of &quot;standard&quot; notification inserted before user
        // supplied notifications.
        //
<span class="nc" id="L2506">        int inserted=0;</span>
<span class="nc bnc" id="L2507" title="All 2 branches missed.">        if (!hasGeneric)</span>
            // We need to add description for GENERIC notification
            // (bug 4744667)
<span class="nc" id="L2510">            respInfo[inserted++] = makeGenericInfo();</span>


<span class="nc bnc" id="L2513" title="All 2 branches missed.">        if (!hasAttributeChange)</span>
            // We need to add description for ATTRIBUTE_CHANGE notification
            // (bug 4744667)
<span class="nc" id="L2516">            respInfo[inserted++] = makeAttributeChangeInfo();</span>

        // Now copy user supplied list in returned list.
        //
<span class="nc" id="L2520">        final int count  = currInfo.length;</span>
<span class="nc" id="L2521">        final int offset = inserted;</span>
<span class="nc bnc" id="L2522" title="All 2 branches missed.">        for (int j=0; j &lt; count; j++) {</span>
<span class="nc" id="L2523">            respInfo[offset+j] = currInfo[j];</span>
        }

<span class="nc bnc" id="L2526" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2527">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2528">                    RequiredModelMBean.class.getName(),</span>
                &quot;getNotificationInfo()&quot;,&quot;Exit&quot;);
        }

<span class="nc" id="L2532">        return respInfo;</span>
    }


    public void addAttributeChangeNotificationListener(NotificationListener
                                                       inlistener,
                                                       String
                                                       inAttributeName,
                                                       Object inhandback)
        throws MBeanException, RuntimeOperationsException,
               IllegalArgumentException {
        final String mth=&quot;addAttributeChangeNotificationListener(&quot; +
                &quot;NotificationListener, String, Object)&quot;;

<span class="nc bnc" id="L2546" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2547">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2548">                    RequiredModelMBean.class.getName(),mth,&quot;Entry&quot;);</span>
        }

<span class="nc bnc" id="L2551" title="All 2 branches missed.">        if (inlistener == null)</span>
<span class="nc" id="L2552">            throw new IllegalArgumentException(</span>
                  &quot;Listener to be registered must not be null&quot;);


<span class="nc bnc" id="L2556" title="All 2 branches missed.">        if (attributeBroadcaster == null)</span>
<span class="nc" id="L2557">            attributeBroadcaster = new NotificationBroadcasterSupport();</span>

<span class="nc" id="L2559">        AttributeChangeNotificationFilter currFilter =</span>
            new AttributeChangeNotificationFilter();

<span class="nc" id="L2562">        MBeanAttributeInfo[] attrInfo = modelMBeanInfo.getAttributes();</span>
<span class="nc" id="L2563">        boolean found = false;</span>
<span class="nc bnc" id="L2564" title="All 2 branches missed.">        if (inAttributeName == null) {</span>
<span class="nc bnc" id="L2565" title="All 4 branches missed.">            if ((attrInfo != null) &amp;&amp; (attrInfo.length&gt;0)) {</span>
<span class="nc bnc" id="L2566" title="All 2 branches missed.">                for (int i=0; i&lt;attrInfo.length; i++) {</span>
<span class="nc" id="L2567">                    currFilter.enableAttribute(attrInfo[i].getName());</span>
                }
            }
        } else {
<span class="nc bnc" id="L2571" title="All 4 branches missed.">            if ((attrInfo != null) &amp;&amp; (attrInfo.length&gt;0)) {</span>
<span class="nc bnc" id="L2572" title="All 2 branches missed.">                for (int i=0; i&lt;attrInfo.length; i++) {</span>
<span class="nc bnc" id="L2573" title="All 2 branches missed.">                    if (inAttributeName.equals(attrInfo[i].getName())) {</span>
<span class="nc" id="L2574">                        found = true;</span>
<span class="nc" id="L2575">                        currFilter.enableAttribute(inAttributeName);</span>
<span class="nc" id="L2576">                        break;</span>
                    }
                }
            }
<span class="nc bnc" id="L2580" title="All 2 branches missed.">            if (!found) {</span>
<span class="nc" id="L2581">                throw new RuntimeOperationsException(new</span>
                    IllegalArgumentException(
                    &quot;The attribute name does not exist&quot;),
                    &quot;Exception occurred trying to add an &quot;+
                    &quot;AttributeChangeNotification listener&quot;);
            }
        }

<span class="nc bnc" id="L2589" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2590">            Vector&lt;String&gt; enabledAttrs = currFilter.getEnabledAttributes();</span>
<span class="nc bnc" id="L2591" title="All 2 branches missed.">            String s = (enabledAttrs.size() &gt; 1) ?</span>
<span class="nc" id="L2592">                        &quot;[&quot; + enabledAttrs.firstElement() + &quot;, ...]&quot; :</span>
<span class="nc" id="L2593">                        enabledAttrs.toString();</span>
<span class="nc" id="L2594">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2595">                    RequiredModelMBean.class.getName(), mth,</span>
                &quot;Set attribute change filter to &quot; + s);
        }

<span class="nc" id="L2599">        attributeBroadcaster.addNotificationListener(inlistener,currFilter,</span>
                                                     inhandback);
<span class="nc bnc" id="L2601" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2602">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2603">                    RequiredModelMBean.class.getName(),mth,</span>
                    &quot;Notification listener added for &quot; + inAttributeName);
<span class="nc" id="L2605">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2606">                    RequiredModelMBean.class.getName(),mth,&quot;Exit&quot;);</span>
        }
<span class="nc" id="L2608">    }</span>

    public void removeAttributeChangeNotificationListener(
            NotificationListener inlistener, String inAttributeName)
        throws MBeanException, RuntimeOperationsException,
               ListenerNotFoundException {
<span class="nc bnc" id="L2614" title="All 2 branches missed.">        if (inlistener == null) throw new</span>
            ListenerNotFoundException(&quot;Notification listener is null&quot;);

        final String mth = &quot;removeAttributeChangeNotificationListener(&quot; +
                &quot;NotificationListener, String)&quot;;

<span class="nc bnc" id="L2620" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2621">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2622">                    RequiredModelMBean.class.getName(),mth,&quot;Entry&quot;);</span>
        }


<span class="nc bnc" id="L2626" title="All 2 branches missed.">        if (attributeBroadcaster == null)</span>
<span class="nc" id="L2627">            throw new ListenerNotFoundException(</span>
                  &quot;No attribute change notification listeners registered&quot;);


<span class="nc" id="L2631">        MBeanAttributeInfo[] attrInfo = modelMBeanInfo.getAttributes();</span>
<span class="nc" id="L2632">        boolean found = false;</span>
<span class="nc bnc" id="L2633" title="All 4 branches missed.">        if ((attrInfo != null) &amp;&amp; (attrInfo.length&gt;0)) {</span>
<span class="nc bnc" id="L2634" title="All 2 branches missed.">            for (int i=0; i&lt;attrInfo.length; i++) {</span>
<span class="nc bnc" id="L2635" title="All 2 branches missed.">                if (attrInfo[i].getName().equals(inAttributeName)) {</span>
<span class="nc" id="L2636">                    found = true;</span>
<span class="nc" id="L2637">                    break;</span>
                }
            }
        }

<span class="nc bnc" id="L2642" title="All 4 branches missed.">        if ((!found) &amp;&amp; (inAttributeName != null)) {</span>
<span class="nc" id="L2643">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;Invalid attribute name&quot;),
                &quot;Exception occurred trying to remove &quot;+
                &quot;attribute change notification listener&quot;);
        }

        /* note: */
        /* this may be a problem if the same listener is registered for
           multiple attributes with multiple filters and/or handback
           objects.  It may remove all of them */

<span class="nc" id="L2654">        attributeBroadcaster.removeNotificationListener(inlistener);</span>

<span class="nc bnc" id="L2656" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2657">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2658">                    RequiredModelMBean.class.getName(),mth,&quot;Exit&quot;);</span>
        }
<span class="nc" id="L2660">    }</span>

    public void sendAttributeChangeNotification(AttributeChangeNotification
                                                ntfyObj)
        throws MBeanException, RuntimeOperationsException {
        final String mth = &quot;sendAttributeChangeNotification(&quot; +
                &quot;AttributeChangeNotification)&quot;;

<span class="nc bnc" id="L2668" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2669">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2670">                    RequiredModelMBean.class.getName(),mth,&quot;Entry&quot;);</span>
        }

<span class="nc bnc" id="L2673" title="All 2 branches missed.">        if (ntfyObj == null)</span>
<span class="nc" id="L2674">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(
                &quot;attribute change notification object must not be null&quot;),
                &quot;Exception occurred trying to send &quot;+
                &quot;attribute change notification of a ModelMBean&quot;);

<span class="nc" id="L2680">        Object oldv = ntfyObj.getOldValue();</span>
<span class="nc" id="L2681">        Object newv =  ntfyObj.getNewValue();</span>

<span class="nc bnc" id="L2683" title="All 2 branches missed.">        if (oldv == null) oldv = &quot;null&quot;;</span>
<span class="nc bnc" id="L2684" title="All 2 branches missed.">        if (newv == null) newv = &quot;null&quot;;</span>

<span class="nc bnc" id="L2686" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2687">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2688">                    RequiredModelMBean.class.getName(),mth,</span>
                &quot;Sending AttributeChangeNotification with &quot; +
<span class="nc" id="L2690">                ntfyObj.getAttributeName() + ntfyObj.getAttributeType() +</span>
<span class="nc" id="L2691">                ntfyObj.getNewValue() + ntfyObj.getOldValue());</span>
        }

        // log notification if specified in descriptor
<span class="nc" id="L2695">        Descriptor ntfyDesc =</span>
<span class="nc" id="L2696">            modelMBeanInfo.getDescriptor(ntfyObj.getType(),&quot;notification&quot;);</span>
<span class="nc" id="L2697">        Descriptor mmbDesc = modelMBeanInfo.getMBeanDescriptor();</span>

        String logging, logfile;

<span class="nc bnc" id="L2701" title="All 2 branches missed.">        if (ntfyDesc != null) {</span>
<span class="nc" id="L2702">            logging =(String)  ntfyDesc.getFieldValue(&quot;log&quot;);</span>
<span class="nc bnc" id="L2703" title="All 2 branches missed.">            if (logging == null) {</span>
<span class="nc bnc" id="L2704" title="All 2 branches missed.">                if (mmbDesc != null)</span>
<span class="nc" id="L2705">                    logging = (String) mmbDesc.getFieldValue(&quot;log&quot;);</span>
            }
<span class="nc bnc" id="L2707" title="All 2 branches missed.">            if ((logging != null) &amp;&amp;</span>
<span class="nc bnc" id="L2708" title="All 2 branches missed.">                ( logging.equalsIgnoreCase(&quot;t&quot;) ||</span>
<span class="nc bnc" id="L2709" title="All 2 branches missed.">                  logging.equalsIgnoreCase(&quot;true&quot;))) {</span>
<span class="nc" id="L2710">                logfile = (String) ntfyDesc.getFieldValue(&quot;logfile&quot;);</span>
<span class="nc bnc" id="L2711" title="All 2 branches missed.">                if (logfile == null) {</span>
<span class="nc bnc" id="L2712" title="All 2 branches missed.">                    if (mmbDesc != null)</span>
<span class="nc" id="L2713">                        logfile = (String)mmbDesc.getFieldValue(&quot;logfile&quot;);</span>
                }

<span class="nc bnc" id="L2716" title="All 2 branches missed.">                if (logfile != null) {</span>
                    try {
<span class="nc" id="L2718">                        writeToLog(logfile,&quot;LogMsg: &quot; +</span>
<span class="nc" id="L2719">                           ((new Date(ntfyObj.getTimeStamp())).toString())+</span>
<span class="nc" id="L2720">                           &quot; &quot; + ntfyObj.getType() + &quot; &quot; +</span>
<span class="nc" id="L2721">                           ntfyObj.getMessage() +</span>
<span class="nc" id="L2722">                           &quot; Name = &quot; + ntfyObj.getAttributeName() +</span>
                           &quot; Old value = &quot; + oldv +
                           &quot; New value = &quot; + newv);
<span class="nc" id="L2725">                    } catch (Exception e) {</span>
<span class="nc bnc" id="L2726" title="All 2 branches missed.">                        if (MODELMBEAN_LOGGER.isLoggable(Level.FINE)) {</span>
<span class="nc" id="L2727">                            MODELMBEAN_LOGGER.logp(Level.FINE,</span>
<span class="nc" id="L2728">                                    RequiredModelMBean.class.getName(),mth,</span>
<span class="nc" id="L2729">                                &quot;Failed to log &quot; + ntfyObj.getType() +</span>
                                    &quot; notification: &quot;, e);
                        }
<span class="nc" id="L2732">                    }</span>
                }
            }
<span class="nc bnc" id="L2735" title="All 2 branches missed.">        } else if (mmbDesc != null) {</span>
<span class="nc" id="L2736">            logging = (String) mmbDesc.getFieldValue(&quot;log&quot;);</span>
<span class="nc bnc" id="L2737" title="All 2 branches missed.">            if ((logging != null) &amp;&amp;</span>
<span class="nc bnc" id="L2738" title="All 2 branches missed.">                ( logging.equalsIgnoreCase(&quot;t&quot;) ||</span>
<span class="nc bnc" id="L2739" title="All 2 branches missed.">                  logging.equalsIgnoreCase(&quot;true&quot;) )) {</span>
<span class="nc" id="L2740">                logfile = (String) mmbDesc.getFieldValue(&quot;logfile&quot;);</span>

<span class="nc bnc" id="L2742" title="All 2 branches missed.">                if (logfile != null) {</span>
                    try {
<span class="nc" id="L2744">                        writeToLog(logfile,&quot;LogMsg: &quot; +</span>
<span class="nc" id="L2745">                           ((new Date(ntfyObj.getTimeStamp())).toString())+</span>
<span class="nc" id="L2746">                           &quot; &quot; + ntfyObj.getType() + &quot; &quot; +</span>
<span class="nc" id="L2747">                           ntfyObj.getMessage() +</span>
<span class="nc" id="L2748">                           &quot; Name = &quot; + ntfyObj.getAttributeName() +</span>
                           &quot; Old value = &quot; + oldv +
                           &quot; New value = &quot; + newv);
<span class="nc" id="L2751">                    } catch (Exception e) {</span>
<span class="nc bnc" id="L2752" title="All 2 branches missed.">                        if (MODELMBEAN_LOGGER.isLoggable(Level.FINE)) {</span>
<span class="nc" id="L2753">                            MODELMBEAN_LOGGER.logp(Level.FINE,</span>
<span class="nc" id="L2754">                                    RequiredModelMBean.class.getName(),mth,</span>
<span class="nc" id="L2755">                                &quot;Failed to log &quot; + ntfyObj.getType() +</span>
                                    &quot; notification: &quot;, e);
                        }
<span class="nc" id="L2758">                    }</span>
                }
            }
        }
<span class="nc bnc" id="L2762" title="All 2 branches missed.">        if (attributeBroadcaster != null) {</span>
<span class="nc" id="L2763">            attributeBroadcaster.sendNotification(ntfyObj);</span>
        }

        // XXX Revisit: This is a quickfix: it would be better to have a
        //     single broadcaster. However, it is not so simple because
        //     removeAttributeChangeNotificationListener() should
        //     remove only listeners whose filter is an instanceof
        //     AttributeChangeNotificationFilter.
        //
<span class="nc bnc" id="L2772" title="All 2 branches missed.">        if (generalBroadcaster != null) {</span>
<span class="nc" id="L2773">            generalBroadcaster.sendNotification(ntfyObj);</span>
        }

<span class="nc bnc" id="L2776" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2777">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2778">                    RequiredModelMBean.class.getName(),mth,</span>
                &quot;sent notification&quot;);
<span class="nc" id="L2780">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2781">                    RequiredModelMBean.class.getName(),mth,</span>
                &quot;Exit&quot;);
        }
<span class="nc" id="L2784">    }</span>

    public void sendAttributeChangeNotification(Attribute inOldVal,
                                                Attribute inNewVal)
        throws MBeanException, RuntimeOperationsException {
        final String mth =
            &quot;sendAttributeChangeNotification(Attribute, Attribute)&quot;;
<span class="nc bnc" id="L2791" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2792">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2793">                    RequiredModelMBean.class.getName(),mth,</span>
                &quot;Entry&quot;);
        }

        // do we really want to do this?
<span class="nc bnc" id="L2798" title="All 4 branches missed.">        if ((inOldVal == null) || (inNewVal == null))</span>
<span class="nc" id="L2799">            throw new RuntimeOperationsException(new</span>
               IllegalArgumentException(&quot;Attribute object must not be null&quot;),
               &quot;Exception occurred trying to send &quot; +
               &quot;attribute change notification of a ModelMBean&quot;);


<span class="nc bnc" id="L2805" title="All 2 branches missed.">        if (!(inOldVal.getName().equals(inNewVal.getName())))</span>
<span class="nc" id="L2806">            throw new RuntimeOperationsException(new</span>
                IllegalArgumentException(&quot;Attribute names are not the same&quot;),
                &quot;Exception occurred trying to send &quot; +
                &quot;attribute change notification of a ModelMBean&quot;);


<span class="nc" id="L2812">        Object newVal = inNewVal.getValue();</span>
<span class="nc" id="L2813">        Object oldVal = inOldVal.getValue();</span>
<span class="nc" id="L2814">        String className = &quot;unknown&quot;;</span>
<span class="nc bnc" id="L2815" title="All 2 branches missed.">        if (newVal != null)</span>
<span class="nc" id="L2816">            className = newVal.getClass().getName();</span>
<span class="nc bnc" id="L2817" title="All 2 branches missed.">        if (oldVal != null)</span>
<span class="nc" id="L2818">            className = oldVal.getClass().getName();</span>

<span class="nc" id="L2820">        AttributeChangeNotification myNtfyObj = new</span>
            AttributeChangeNotification(this,
                                        1,
<span class="nc" id="L2823">                                        ((new Date()).getTime()),</span>
                                        &quot;AttributeChangeDetected&quot;,
<span class="nc" id="L2825">                                        inOldVal.getName(),</span>
                                        className,
<span class="nc" id="L2827">                                        inOldVal.getValue(),</span>
<span class="nc" id="L2828">                                        inNewVal.getValue());</span>

<span class="nc" id="L2830">        sendAttributeChangeNotification(myNtfyObj);</span>

<span class="nc bnc" id="L2832" title="All 2 branches missed.">        if (MODELMBEAN_LOGGER.isLoggable(Level.FINER)) {</span>
<span class="nc" id="L2833">            MODELMBEAN_LOGGER.logp(Level.FINER,</span>
<span class="nc" id="L2834">                    RequiredModelMBean.class.getName(),mth,</span>
                &quot;Exit&quot;);
        }

<span class="nc" id="L2838">    }</span>

    /**
     * Return the Class Loader Repository used to perform class loading.
     * Subclasses may wish to redefine this method in order to return
     * the appropriate {@link javax.management.loading.ClassLoaderRepository}
     * that should be used in this object.
     *
     * @return the Class Loader Repository.
     *
     */
    protected ClassLoaderRepository getClassLoaderRepository() {
<span class="nc" id="L2850">        return MBeanServerFactory.getClassLoaderRepository(server);</span>
    }

    private Class&lt;?&gt; loadClass(final String className)
        throws ClassNotFoundException {
<span class="nc" id="L2855">        AccessControlContext stack = AccessController.getContext();</span>
<span class="nc" id="L2856">        final ClassNotFoundException[] caughtException = new ClassNotFoundException[1];</span>

<span class="nc" id="L2858">        Class c = javaSecurityAccess.doIntersectionPrivilege(new PrivilegedAction&lt;Class&lt;?&gt;&gt;() {</span>

            @Override
            public Class&lt;?&gt; run() {
                try {
<span class="nc" id="L2863">                    ReflectUtil.checkPackageAccess(className);</span>
<span class="nc" id="L2864">                    return Class.forName(className);</span>
<span class="nc" id="L2865">                } catch (ClassNotFoundException e) {</span>
<span class="nc" id="L2866">                    final ClassLoaderRepository clr =</span>
<span class="nc" id="L2867">                        getClassLoaderRepository();</span>
                    try {
<span class="nc bnc" id="L2869" title="All 2 branches missed.">                        if (clr == null) throw new ClassNotFoundException(className);</span>
<span class="nc" id="L2870">                        return clr.loadClass(className);</span>
<span class="nc" id="L2871">                    } catch (ClassNotFoundException ex) {</span>
<span class="nc" id="L2872">                        caughtException[0] = ex;</span>
                    }
                }
<span class="nc" id="L2875">                return null;</span>
            }
        }, stack, acc);

<span class="nc bnc" id="L2879" title="All 2 branches missed.">        if (caughtException[0] != null) {</span>
<span class="nc" id="L2880">            throw caughtException[0];</span>
        }

<span class="nc" id="L2883">        return c;</span>
    }


    /*************************************/
    /* MBeanRegistration Interface       */
    /*************************************/

    /**
     * Allows the MBean to perform any operations it needs before
     * being registered in the MBean server.  If the name of the MBean
     * is not specified, the MBean can provide a name for its
     * registration.  If any exception is raised, the MBean will not be
     * registered in the MBean server.
     * &lt;P&gt;
     * In order to ensure proper run-time semantics of RequireModelMBean,
     * Any subclass of RequiredModelMBean overloading or overriding this
     * method should call &lt;code&gt;super.preRegister(server, name)&lt;/code&gt;
     * in its own &lt;code&gt;preRegister&lt;/code&gt; implementation.
     *
     * @param server The MBean server in which the MBean will be registered.
     *
     * @param name The object name of the MBean.  This name is null if
     * the name parameter to one of the &lt;code&gt;createMBean&lt;/code&gt; or
     * &lt;code&gt;registerMBean&lt;/code&gt; methods in the {@link MBeanServer}
     * interface is null.  In that case, this method must return a
     * non-null ObjectName for the new MBean.
     *
     * @return The name under which the MBean is to be registered.
     * This value must not be null.  If the &lt;code&gt;name&lt;/code&gt;
     * parameter is not null, it will usually but not necessarily be
     * the returned value.
     *
     * @exception java.lang.Exception This exception will be caught by
     * the MBean server and re-thrown as an
     * {@link javax.management.MBeanRegistrationException
     * MBeanRegistrationException}.
     */
    public ObjectName preRegister(MBeanServer server,
                                  ObjectName name)
        throws java.lang.Exception  {
        // Since ModelMbeanInfo cannot be null (otherwise exception
        // thrown at creation)
        // no exception thrown on ModelMBeanInfo not set.
<span class="nc bnc" id="L2927" title="All 2 branches missed.">        if (name == null) throw new NullPointerException(</span>
                     &quot;name of RequiredModelMBean to registered is null&quot;);
<span class="nc" id="L2929">        this.server = server;</span>
<span class="nc" id="L2930">        return name;</span>
    }

    /**
     * Allows the MBean to perform any operations needed after having been
     * registered in the MBean server or after the registration has failed.
     * &lt;P&gt;
     * In order to ensure proper run-time semantics of RequireModelMBean,
     * Any subclass of RequiredModelMBean overloading or overriding this
     * method should call &lt;code&gt;super.postRegister(registrationDone)&lt;/code&gt;
     * in its own &lt;code&gt;postRegister&lt;/code&gt; implementation.
     *
     * @param registrationDone Indicates whether or not the MBean has
     * been successfully registered in the MBean server. The value
     * false means that the registration phase has failed.
     */
    public void postRegister(Boolean registrationDone) {
<span class="nc" id="L2947">        registered = registrationDone.booleanValue();</span>
<span class="nc" id="L2948">    }</span>

    /**
     * Allows the MBean to perform any operations it needs before
     * being unregistered by the MBean server.
     * &lt;P&gt;
     * In order to ensure proper run-time semantics of RequireModelMBean,
     * Any subclass of RequiredModelMBean overloading or overriding this
     * method should call &lt;code&gt;super.preDeregister()&lt;/code&gt; in its own
     * &lt;code&gt;preDeregister&lt;/code&gt; implementation.
     *
     * @exception java.lang.Exception This exception will be caught by
     * the MBean server and re-thrown as an
     * {@link javax.management.MBeanRegistrationException
     * MBeanRegistrationException}.
     */
    public void preDeregister() throws java.lang.Exception {
<span class="nc" id="L2965">    }</span>

    /**
     * Allows the MBean to perform any operations needed after having been
     * unregistered in the MBean server.
     * &lt;P&gt;
     * In order to ensure proper run-time semantics of RequireModelMBean,
     * Any subclass of RequiredModelMBean overloading or overriding this
     * method should call &lt;code&gt;super.postDeregister()&lt;/code&gt; in its own
     * &lt;code&gt;postDeregister&lt;/code&gt; implementation.
     */
    public void postDeregister() {
<span class="nc" id="L2977">        registered = false;</span>
<span class="nc" id="L2978">        this.server=null;</span>
<span class="nc" id="L2979">    }</span>

    private static final String[] primitiveTypes;
    private static final String[] primitiveWrappers;
    static {
<span class="nc" id="L2984">        primitiveTypes = new String[] {</span>
<span class="nc" id="L2985">            Boolean.TYPE.getName(),</span>
<span class="nc" id="L2986">            Byte.TYPE.getName(),</span>
<span class="nc" id="L2987">            Character.TYPE.getName(),</span>
<span class="nc" id="L2988">            Short.TYPE.getName(),</span>
<span class="nc" id="L2989">            Integer.TYPE.getName(),</span>
<span class="nc" id="L2990">            Long.TYPE.getName(),</span>
<span class="nc" id="L2991">            Float.TYPE.getName(),</span>
<span class="nc" id="L2992">            Double.TYPE.getName(),</span>
<span class="nc" id="L2993">            Void.TYPE.getName()</span>
        };
<span class="nc" id="L2995">        primitiveWrappers = new String[] {</span>
<span class="nc" id="L2996">            Boolean.class.getName(),</span>
<span class="nc" id="L2997">            Byte.class.getName(),</span>
<span class="nc" id="L2998">            Character.class.getName(),</span>
<span class="nc" id="L2999">            Short.class.getName(),</span>
<span class="nc" id="L3000">            Integer.class.getName(),</span>
<span class="nc" id="L3001">            Long.class.getName(),</span>
<span class="nc" id="L3002">            Float.class.getName(),</span>
<span class="nc" id="L3003">            Double.class.getName(),</span>
<span class="nc" id="L3004">            Void.class.getName()</span>
        };
<span class="nc" id="L3006">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>