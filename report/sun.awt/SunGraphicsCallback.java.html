<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SunGraphicsCallback.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.awt</a> &gt; <span class="el_source">SunGraphicsCallback.java</span></div><h1>SunGraphicsCallback.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2007, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.awt;

import java.awt.*;

import sun.util.logging.PlatformLogger;

<span class="nc" id="L32">public abstract class SunGraphicsCallback {</span>
    public static final int HEAVYWEIGHTS = 0x1;
    public static final int LIGHTWEIGHTS = 0x2;
    public static final int TWO_PASSES = 0x4;

<span class="nc" id="L37">    private static final PlatformLogger log = PlatformLogger.getLogger(&quot;sun.awt.SunGraphicsCallback&quot;);</span>

    public abstract void run(Component comp, Graphics cg);

    protected void constrainGraphics(Graphics g, Rectangle bounds) {
<span class="nc bnc" id="L42" title="All 2 branches missed.">        if (g instanceof ConstrainableGraphics) {</span>
<span class="nc" id="L43">            ((ConstrainableGraphics)g).constrain(bounds.x, bounds.y, bounds.width, bounds.height);</span>
        } else {
<span class="nc" id="L45">            g.translate(bounds.x, bounds.y);</span>
        }
<span class="nc" id="L47">        g.clipRect(0, 0, bounds.width, bounds.height);</span>
<span class="nc" id="L48">    }</span>

    @SuppressWarnings(&quot;deprecation&quot;)
    public final void runOneComponent(Component comp, Rectangle bounds,
                                      Graphics g, Shape clip,
                                      int weightFlags) {
<span class="nc bnc" id="L54" title="All 6 branches missed.">        if (comp == null || comp.getPeer() == null || !comp.isVisible()) {</span>
<span class="nc" id="L55">            return;</span>
        }
<span class="nc" id="L57">        boolean lightweight = comp.isLightweight();</span>
<span class="nc bnc" id="L58" title="All 8 branches missed.">        if ((lightweight &amp;&amp; (weightFlags &amp; LIGHTWEIGHTS) == 0) ||</span>
            (!lightweight &amp;&amp; (weightFlags &amp; HEAVYWEIGHTS) == 0)) {
<span class="nc" id="L60">            return;</span>
        }

<span class="nc bnc" id="L63" title="All 2 branches missed.">        if (bounds == null) {</span>
<span class="nc" id="L64">            bounds = comp.getBounds();</span>
        }

<span class="nc bnc" id="L67" title="All 4 branches missed.">        if (clip == null || clip.intersects(bounds)) {</span>
<span class="nc" id="L68">            Graphics cg = g.create();</span>
            try {
<span class="nc" id="L70">                constrainGraphics(cg, bounds);</span>
<span class="nc" id="L71">                cg.setFont(comp.getFont());</span>
<span class="nc" id="L72">                cg.setColor(comp.getForeground());</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">                if (cg instanceof Graphics2D) {</span>
<span class="nc" id="L74">                    ((Graphics2D)cg).setBackground(comp.getBackground());</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">                } else if (cg instanceof Graphics2Delegate) {</span>
<span class="nc" id="L76">                    ((Graphics2Delegate)cg).setBackground(</span>
<span class="nc" id="L77">                        comp.getBackground());</span>
                }
<span class="nc" id="L79">                run(comp, cg);</span>
            } finally {
<span class="nc" id="L81">                cg.dispose();</span>
<span class="nc" id="L82">            }</span>
        }
<span class="nc" id="L84">    }</span>

    public final void runComponents(Component[] comps, Graphics g,
                                    int weightFlags) {
<span class="nc" id="L88">        int ncomponents = comps.length;</span>
<span class="nc" id="L89">        Shape clip = g.getClip();</span>

<span class="nc bnc" id="L91" title="All 4 branches missed.">        if (log.isLoggable(PlatformLogger.Level.FINER) &amp;&amp; (clip != null)) {</span>
<span class="nc" id="L92">            Rectangle newrect = clip.getBounds();</span>
<span class="nc" id="L93">            log.finer(&quot;x = &quot; + newrect.x + &quot;, y = &quot; + newrect.y +</span>
                      &quot;, width = &quot; + newrect.width +
                      &quot;, height = &quot; + newrect.height);
        }

        // A seriously sad hack--
        // Lightweight components always paint behind peered components,
        // even if they are at the top of the Z order. We emulate this
        // behavior by making two printing passes: the first for lightweights;
        // the second for heavyweights.
        //
        // ToDo(dpm): Either build a list of heavyweights during the
        // lightweight pass, or redesign the components array to keep
        // lightweights and heavyweights separate.
<span class="nc bnc" id="L107" title="All 2 branches missed.">        if ((weightFlags &amp; TWO_PASSES) != 0) {</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">            for (int i = ncomponents - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L109">                runOneComponent(comps[i], null, g, clip, LIGHTWEIGHTS);</span>
            }
<span class="nc bnc" id="L111" title="All 2 branches missed.">            for (int i = ncomponents - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L112">                runOneComponent(comps[i], null, g, clip, HEAVYWEIGHTS);</span>
            }
        } else {
<span class="nc bnc" id="L115" title="All 2 branches missed.">            for (int i = ncomponents - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L116">                runOneComponent(comps[i], null, g, clip, weightFlags);</span>
            }
        }
<span class="nc" id="L119">    }</span>

    public static final class PaintHeavyweightComponentsCallback
        extends SunGraphicsCallback
    {
<span class="nc" id="L124">        private static PaintHeavyweightComponentsCallback instance =</span>
            new PaintHeavyweightComponentsCallback();

<span class="nc" id="L127">        private PaintHeavyweightComponentsCallback() {}</span>
        public void run(Component comp, Graphics cg) {
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (!comp.isLightweight()) {</span>
<span class="nc" id="L130">                comp.paintAll(cg);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">            } else if (comp instanceof Container) {</span>
<span class="nc" id="L132">                runComponents(((Container)comp).getComponents(), cg,</span>
                              LIGHTWEIGHTS | HEAVYWEIGHTS);
            }
<span class="nc" id="L135">        }</span>
        public static PaintHeavyweightComponentsCallback getInstance() {
<span class="nc" id="L137">            return instance;</span>
        }
    }
<span class="nc" id="L140">    public static final class PrintHeavyweightComponentsCallback</span>
        extends SunGraphicsCallback
    {
<span class="nc" id="L143">        private static PrintHeavyweightComponentsCallback instance =</span>
            new PrintHeavyweightComponentsCallback();

<span class="nc" id="L146">        private PrintHeavyweightComponentsCallback() {}</span>
        public void run(Component comp, Graphics cg) {
<span class="nc bnc" id="L148" title="All 2 branches missed.">            if (!comp.isLightweight()) {</span>
<span class="nc" id="L149">                comp.printAll(cg);</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">            } else if (comp instanceof Container) {</span>
<span class="nc" id="L151">                runComponents(((Container)comp).getComponents(), cg,</span>
                              LIGHTWEIGHTS | HEAVYWEIGHTS);
            }
<span class="nc" id="L154">        }</span>
        public static PrintHeavyweightComponentsCallback getInstance() {
<span class="nc" id="L156">            return instance;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>