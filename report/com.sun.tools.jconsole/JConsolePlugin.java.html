<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>JConsolePlugin.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.tools.jconsole</a> &gt; <span class="el_source">JConsolePlugin.java</span></div><h1>JConsolePlugin.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2006, 2007, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.tools.jconsole;

import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JPanel;
import javax.swing.SwingWorker;

/**
 * A JConsole plugin class.  JConsole uses the
 * &lt;a href=&quot;{@docRoot}/../../../../api/java/util/ServiceLoader.html&quot;&gt;
 * service provider&lt;/a&gt; mechanism to search the JConsole plugins.
 * Users can provide their JConsole plugins in a jar file
 * containing a file named
 *
 * &lt;blockquote&gt;&lt;pre&gt;
 * META-INF/services/com.sun.tools.jconsole.JConsolePlugin&lt;/pre&gt;&lt;/blockquote&gt;
 *
 * &lt;p&gt; This file contains one line for each plugin, for example,
 *
 * &lt;blockquote&gt;&lt;pre&gt;
 * com.sun.example.JTop&lt;/pre&gt;&lt;/blockquote&gt;
 * &lt;p&gt; which is the fully qualified class name of the class implementing
 * {@code JConsolePlugin}.
 *
 * &lt;p&gt; To load the JConsole plugins in JConsole, run:
 *
 * &lt;blockquote&gt;&lt;pre&gt;
 * jconsole -pluginpath &amp;lt;plugin-path&amp;gt; &lt;/pre&gt;&lt;/blockquote&gt;
 *
 * &lt;p&gt; where &lt;tt&gt;&amp;lt;plugin-path&amp;gt;&lt;/tt&gt; specifies the paths of JConsole
 * plugins to look up which can be a directory or a jar file. Multiple
 * paths are separated by the path separator character of the platform.
 *
 * &lt;p&gt; When a new JConsole window is created for a connection,
 * an instance of each {@code JConsolePlugin} will be created.
 * The {@code JConsoleContext} object is not available at its
 * construction time.
 * JConsole will set the {@link JConsoleContext} object for
 * a plugin after the plugin object is created.  It will then
 * call its {@link #getTabs getTabs} method and add the returned
 * tabs to the JConsole window.
 *
 * @see &lt;a href=&quot;{@docRoot}/../../../../api/java/util/ServiceLoader.html&quot;&gt;
 * java.util.ServiceLoader&lt;/a&gt;
 *
 * @since 1.6
 */
@jdk.Exported
public abstract class JConsolePlugin {
<span class="nc" id="L77">    private volatile JConsoleContext context = null;</span>
<span class="nc" id="L78">    private List&lt;PropertyChangeListener&gt; listeners = null;</span>

    /**
     * Constructor.
     */
<span class="nc" id="L83">    protected JConsolePlugin() {</span>
<span class="nc" id="L84">    }</span>

    /**
     * Sets the {@link JConsoleContext JConsoleContext} object representing
     * the connection to an application.  This method will be called
     * only once after the plugin is created and before the {@link #getTabs}
     * is called. The given {@code context} can be in any
     * {@link JConsoleContext#getConnectionState connection state} when
     * this method is called.
     *
     * @param context a {@code JConsoleContext} object
     */
    public final synchronized void setContext(JConsoleContext context) {
<span class="nc" id="L97">        this.context = context;</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">        if (listeners != null) {</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">            for (PropertyChangeListener l : listeners) {</span>
<span class="nc" id="L100">                context.addPropertyChangeListener(l);</span>
<span class="nc" id="L101">            }</span>
            // throw away the listener list
<span class="nc" id="L103">            listeners = null;</span>
        }
<span class="nc" id="L105">    }</span>

    /**
     * Returns the {@link JConsoleContext JConsoleContext} object representing
     * the connection to an application.  This method may return &lt;tt&gt;null&lt;/tt&gt;
     * if it is called before the {@link #setContext context} is initialized.
     *
     * @return the {@link JConsoleContext JConsoleContext} object representing
     *         the connection to an application.
     */
    public final JConsoleContext getContext() {
<span class="nc" id="L116">        return context;</span>
    }

    /**
     * Returns the tabs to be added in JConsole window.
     * &lt;p&gt;
     * The returned map contains one entry for each tab
     * to be added in the tabbed pane in a JConsole window with
     * the tab name as the key
     * and the {@link JPanel} object as the value.
     * This method returns an empty map if no tab is added by this plugin.
     * This method will be called from the &lt;i&gt;Event Dispatch Thread&lt;/i&gt;
     * once at the new connection time.
     *
     * @return a map of a tab name and a {@link JPanel} object
     *         representing the tabs to be added in the JConsole window;
     *         or an empty map.
     */
    public abstract java.util.Map&lt;String, JPanel&gt; getTabs();

    /**
     * Returns a {@link SwingWorker} to perform
     * the GUI update for this plugin at the same interval
     * as JConsole updates the GUI.
     * &lt;p&gt;
     * JConsole schedules the GUI update at an interval specified
     * for a connection.  This method will be called at every
     * update to obtain a {@code SwingWorker} for each plugin.
     * &lt;p&gt;
     * JConsole will invoke the {@link SwingWorker#execute execute()}
     * method to schedule the returned {@code SwingWorker} for execution
     * if:
     * &lt;ul&gt;
     *   &lt;li&gt; the &lt;tt&gt;SwingWorker&lt;/tt&gt; object has not been executed
     *        (i.e. the {@link SwingWorker#getState} method
     *        returns {@link javax.swing.SwingWorker.StateValue#PENDING PENDING}
     *        state); and&lt;/li&gt;
     *   &lt;li&gt; the &lt;tt&gt;SwingWorker&lt;/tt&gt; object returned in the previous
     *        update has completed the task if it was not &lt;tt&gt;null&lt;/tt&gt;
     *        (i.e. the {@link SwingWorker#isDone SwingWorker.isDone} method
     *        returns &lt;tt&gt;true&lt;/tt&gt;).&lt;/li&gt;
     * &lt;/ul&gt;
     * &lt;br&gt;
     * Otherwise, &lt;tt&gt;SwingWorker&lt;/tt&gt; object will not be scheduled to work.
     *
     * &lt;p&gt;
     * A plugin can schedule its own GUI update and this method
     * will return &lt;tt&gt;null&lt;/tt&gt;.
     *
     * @return a &lt;tt&gt;SwingWorker&lt;/tt&gt; to perform the GUI update; or
     *         &lt;tt&gt;null&lt;/tt&gt;.
     */
    public abstract SwingWorker&lt;?,?&gt; newSwingWorker();

    /**
     * Dispose this plugin. This method is called by JConsole to inform
     * that this plugin will be discarded and that it should free
     * any resources that it has allocated.
     * The {@link #getContext JConsoleContext} can be in any
     * {@link JConsoleContext#getConnectionState connection state} when
     * this method is called.
     */
    public void dispose() {
        // Default nop implementation
<span class="nc" id="L180">    }</span>

    /**
     * Adds a {@link PropertyChangeListener PropertyChangeListener}
     * to the {@link #getContext JConsoleContext} object for this plugin.
     * This method is a convenient method for this plugin to register
     * a listener when the {@code JConsoleContext} object may or
     * may not be available.
     *
     * &lt;p&gt;For example, a plugin constructor can
     * call this method to register a listener to listen to the
     * {@link JConsoleContext.ConnectionState connectionState}
     * property changes and the listener will be added to the
     * {@link JConsoleContext#addPropertyChangeListener JConsoleContext}
     * object when it is available.
     *
     * @param listener  The {@code PropertyChangeListener} to be added
     *
     * @throws NullPointerException if {@code listener} is {@code null}.
     */
    public final void addContextPropertyChangeListener(PropertyChangeListener listener) {
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (listener == null) {</span>
<span class="nc" id="L202">            throw new NullPointerException(&quot;listener is null&quot;);</span>
        }

<span class="nc bnc" id="L205" title="All 2 branches missed.">        if (context == null) {</span>
            // defer registration of the listener until setContext() is called
<span class="nc" id="L207">            synchronized (this) {</span>
                // check again if context is not set
<span class="nc bnc" id="L209" title="All 2 branches missed.">                if (context == null) {</span>
                    // maintain a listener list to be added later
<span class="nc bnc" id="L211" title="All 2 branches missed.">                    if (listeners == null) {</span>
<span class="nc" id="L212">                        listeners = new ArrayList&lt;PropertyChangeListener&gt;();</span>
                    }
<span class="nc" id="L214">                    listeners.add(listener);</span>
<span class="nc" id="L215">                    return;</span>
                }
<span class="nc" id="L217">            }</span>
        }
<span class="nc" id="L219">        context.addPropertyChangeListener(listener);</span>
<span class="nc" id="L220">    }</span>

    /**
     * Removes a {@link PropertyChangeListener PropertyChangeListener}
     * from the listener list of the {@link #getContext JConsoleContext}
     * object for this plugin.
     * If {@code listener} was never added, no exception is
     * thrown and no action is taken.
     *
     * @param listener the {@code PropertyChangeListener} to be removed
     *
     * @throws NullPointerException if {@code listener} is {@code null}.
     */
    public final void removeContextPropertyChangeListener(PropertyChangeListener listener) {
<span class="nc bnc" id="L234" title="All 2 branches missed.">        if (listener == null) {</span>
<span class="nc" id="L235">            throw new NullPointerException(&quot;listener is null&quot;);</span>
        }

<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (context == null) {</span>
            // defer registration of the listener until setContext() is called
<span class="nc" id="L240">            synchronized (this) {</span>
                // check again if context is not set
<span class="nc bnc" id="L242" title="All 2 branches missed.">                if (context == null) {</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                    if (listeners != null) {</span>
<span class="nc" id="L244">                        listeners.remove(listener);</span>
                    }
<span class="nc" id="L246">                    return;</span>
                }
<span class="nc" id="L248">            }</span>
        }
<span class="nc" id="L250">        context.removePropertyChangeListener(listener);</span>
<span class="nc" id="L251">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>