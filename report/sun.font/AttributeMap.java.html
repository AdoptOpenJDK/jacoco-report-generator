<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AttributeMap.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.font</a> &gt; <span class="el_source">AttributeMap.java</span></div><h1>AttributeMap.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2004, 2005, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

/*
  What is the dead simplest thing to do?
  Extend AbstractMap and don't optimize for anything.

  The only new api is 'getValues()' which returns the values struct as
  long as no map api has been called.  If any map api is called,
  create a real map and forward to it, and nuke values because of the
  possibility that the map has been changed.  This is easier than
  trying to create a map that only clears values if the map has been
  changed, or implementing the map API directly on top of the values
  struct.  We can always do that later if need be.
*/

package sun.font;

import java.awt.Paint;
import java.awt.font.GraphicAttribute;
import java.awt.font.NumericShaper;
import java.awt.font.TextAttribute;
import java.awt.font.TransformAttribute;
import java.awt.geom.AffineTransform;
import java.awt.im.InputMethodHighlight;
import java.text.AttributedCharacterIterator.Attribute;
import java.util.AbstractMap;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;
import java.util.Map.Entry;

import static sun.font.AttributeValues.*;

public final class AttributeMap extends AbstractMap&lt;TextAttribute, Object&gt; {
    private AttributeValues values;
    private Map&lt;TextAttribute, Object&gt; delegateMap;

<span class="nc" id="L61">    public AttributeMap(AttributeValues values) {</span>
<span class="nc" id="L62">        this.values = values;</span>
<span class="nc" id="L63">    }</span>

    public Set&lt;Entry&lt;TextAttribute, Object&gt;&gt; entrySet() {
<span class="nc" id="L66">        return delegate().entrySet();</span>
    }

    public Object put(TextAttribute key, Object value) {
<span class="nc" id="L70">        return delegate().put(key, value);</span>
    }

    // internal API
    public AttributeValues getValues() {
<span class="nc" id="L75">        return values;</span>
    }

<span class="nc" id="L78">    private static boolean first = false; // debug</span>
    private Map&lt;TextAttribute, Object&gt; delegate() {
<span class="nc bnc" id="L80" title="All 2 branches missed.">        if (delegateMap == null) {</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">            if (first) {</span>
<span class="nc" id="L82">                first = false;</span>
<span class="nc" id="L83">                Thread.dumpStack();</span>
            }
<span class="nc" id="L85">            delegateMap = values.toMap(new HashMap&lt;TextAttribute, Object&gt;(27));</span>

            // nuke values, once map is accessible it might be mutated and values would
            // no longer reflect its contents
<span class="nc" id="L89">            values = null;</span>
        }

<span class="nc" id="L92">        return delegateMap;</span>
    }

    public String toString() {
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (values != null) {</span>
<span class="nc" id="L97">            return &quot;map of &quot; + values.toString();</span>
        }
<span class="nc" id="L99">        return super.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>