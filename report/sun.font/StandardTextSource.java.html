<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>StandardTextSource.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.font</a> &gt; <span class="el_source">StandardTextSource.java</span></div><h1>StandardTextSource.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2003, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
/*
 *
 * (C) Copyright IBM Corp. 1998-2003 - All Rights Reserved
 */

package sun.font;

import java.awt.Font;
import java.awt.font.FontRenderContext;
import java.awt.font.LineMetrics;

public class StandardTextSource extends TextSource {
  char[] chars;
  int start;
  int len;
  int cstart;
  int clen;
  int level; // assumed all uniform
  int flags; // see GlyphVector.java
  Font font;
  FontRenderContext frc;
  CoreMetrics cm;

  /**
   * Create a simple implementation of a TextSource.
   *
   * Chars is an array containing clen chars in the context, in
   * logical order, contiguously starting at cstart.  Start and len
   * represent that portion of the context representing the true
   * source; start, like cstart, is relative to the start of the
   * character array.
   *
   * Level is the bidi level (0-63 for the entire context. Flags is
   * the layout flags. Font is the font, frc is the render context,
   * and lm is the line metrics for the entire source text, but not
   * necessarily the context.
   */
  public StandardTextSource(char[] chars,
                            int start,
                            int len,
                            int cstart,
                            int clen,
                            int level,
                            int flags,
                            Font font,
                            FontRenderContext frc,
<span class="nc" id="L71">                            CoreMetrics cm) {</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">    if (chars == null) {</span>
<span class="nc" id="L73">      throw new IllegalArgumentException(&quot;bad chars: null&quot;);</span>
    }
<span class="nc bnc" id="L75" title="All 2 branches missed.">    if (cstart &lt; 0) {</span>
<span class="nc" id="L76">      throw new IllegalArgumentException(&quot;bad cstart: &quot; + cstart);</span>
    }
<span class="nc bnc" id="L78" title="All 2 branches missed.">    if (start &lt; cstart) {</span>
<span class="nc" id="L79">      throw new IllegalArgumentException(&quot;bad start: &quot; + start + &quot; for cstart: &quot; + cstart);</span>
    }
<span class="nc bnc" id="L81" title="All 2 branches missed.">    if (clen &lt; 0) {</span>
<span class="nc" id="L82">      throw new IllegalArgumentException(&quot;bad clen: &quot; + clen);</span>
    }
<span class="nc bnc" id="L84" title="All 2 branches missed.">    if (cstart + clen &gt; chars.length) {</span>
<span class="nc" id="L85">      throw new IllegalArgumentException(&quot;bad clen: &quot; + clen + &quot; cstart: &quot; + cstart + &quot; for array len: &quot; + chars.length);</span>
    }
<span class="nc bnc" id="L87" title="All 2 branches missed.">    if (len &lt; 0) {</span>
<span class="nc" id="L88">      throw new IllegalArgumentException(&quot;bad len: &quot; + len);</span>
    }
<span class="nc bnc" id="L90" title="All 2 branches missed.">    if ((start + len) &gt; (cstart + clen)) {</span>
<span class="nc" id="L91">      throw new IllegalArgumentException(&quot;bad len: &quot; + len + &quot; start: &quot; + start + &quot; for cstart: &quot; + cstart + &quot; clen: &quot; + clen);</span>
    }
<span class="nc bnc" id="L93" title="All 2 branches missed.">    if (font == null) {</span>
<span class="nc" id="L94">      throw new IllegalArgumentException(&quot;bad font: null&quot;);</span>
    }
<span class="nc bnc" id="L96" title="All 2 branches missed.">    if (frc == null) {</span>
<span class="nc" id="L97">      throw new IllegalArgumentException(&quot;bad frc: null&quot;);</span>
    }

<span class="nc" id="L100">    this.chars = chars.clone();</span>
<span class="nc" id="L101">    this.start = start;</span>
<span class="nc" id="L102">    this.len = len;</span>
<span class="nc" id="L103">    this.cstart = cstart;</span>
<span class="nc" id="L104">    this.clen = clen;</span>
<span class="nc" id="L105">    this.level = level;</span>
<span class="nc" id="L106">    this.flags = flags;</span>
<span class="nc" id="L107">    this.font = font;</span>
<span class="nc" id="L108">    this.frc = frc;</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">    if (cm != null) {</span>
<span class="nc" id="L111">        this.cm = cm;</span>
    } else {
<span class="nc" id="L113">        LineMetrics metrics = font.getLineMetrics(chars, cstart, clen, frc);</span>
<span class="nc" id="L114">        this.cm = ((FontLineMetrics)metrics).cm;</span>
    }
<span class="nc" id="L116">  }</span>

  /** Create a StandardTextSource whose context is coextensive with the source. */
  public StandardTextSource(char[] chars,
                            int start,
                            int len,
                            int level,
                            int flags,
                            Font font,
                            FontRenderContext frc,
                            CoreMetrics cm) {
<span class="nc" id="L127">    this(chars, start, len, start, len, level, flags, font, frc, cm);</span>
<span class="nc" id="L128">  }</span>

  /** Create a StandardTextSource whose context and source are coextensive with the entire char array. */
  public StandardTextSource(char[] chars,
                            int level,
                            int flags,
                            Font font,
                            FontRenderContext frc) {
<span class="nc" id="L136">    this(chars, 0, chars.length, 0, chars.length, level, flags, font, frc, null);</span>
<span class="nc" id="L137">  }</span>

  /** Create a StandardTextSource whose context and source are all the text in the String. */
  public StandardTextSource(String str,
                            int level,
                            int flags,
                            Font font,
                            FontRenderContext frc) {
<span class="nc" id="L145">    this(str.toCharArray(), 0, str.length(), 0, str.length(), level, flags, font, frc, null);</span>
<span class="nc" id="L146">  }</span>

  // TextSource API

  public char[] getChars() {
<span class="nc" id="L151">    return chars.clone();</span>
  }

  public int getStart() {
<span class="nc" id="L155">    return start;</span>
  }

  public int getLength() {
<span class="nc" id="L159">    return len;</span>
  }

  public int getContextStart() {
<span class="nc" id="L163">    return cstart;</span>
  }

  public int getContextLength() {
<span class="nc" id="L167">    return clen;</span>
  }

  public int getLayoutFlags() {
<span class="nc" id="L171">    return flags;</span>
  }

  public int getBidiLevel() {
<span class="nc" id="L175">    return level;</span>
  }

  public Font getFont() {
<span class="nc" id="L179">    return font;</span>
  }

  public FontRenderContext getFRC() {
<span class="nc" id="L183">    return frc;</span>
  }

  public CoreMetrics getCoreMetrics() {
<span class="nc" id="L187">    return cm;</span>
  }

  public TextSource getSubSource(int start, int length, int dir) {
<span class="nc bnc" id="L191" title="All 6 branches missed.">    if (start &lt; 0 || length &lt; 0 || (start + length) &gt; len) {</span>
<span class="nc" id="L192">      throw new IllegalArgumentException(&quot;bad start (&quot; + start + &quot;) or length (&quot; + length + &quot;)&quot;);</span>
    }

<span class="nc" id="L195">    int level = this.level;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">    if (dir != TextLineComponent.UNCHANGED) {</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">        boolean ltr = (flags &amp; 0x8) == 0;</span>
<span class="nc bnc" id="L198" title="All 8 branches missed.">        if (!(dir == TextLineComponent.LEFT_TO_RIGHT &amp;&amp; ltr) &amp;&amp;</span>
                !(dir == TextLineComponent.RIGHT_TO_LEFT &amp;&amp; !ltr)) {
<span class="nc" id="L200">            throw new IllegalArgumentException(&quot;direction flag is invalid&quot;);</span>
        }
<span class="nc bnc" id="L202" title="All 2 branches missed.">        level = ltr? 0 : 1;</span>
    }

<span class="nc" id="L205">    return new StandardTextSource(chars, this.start + start, length, cstart, clen, level, flags, font, frc, cm);</span>
  }

  public String toString() {
<span class="nc" id="L209">    return toString(WITH_CONTEXT);</span>
  }

  public String toString(boolean withContext) {
<span class="nc" id="L213">    StringBuffer buf = new StringBuffer(super.toString());</span>
<span class="nc" id="L214">    buf.append(&quot;[start:&quot;);</span>
<span class="nc" id="L215">    buf.append(start);</span>
<span class="nc" id="L216">    buf.append(&quot;, len:&quot; );</span>
<span class="nc" id="L217">    buf.append(len);</span>
<span class="nc" id="L218">    buf.append(&quot;, cstart:&quot;);</span>
<span class="nc" id="L219">    buf.append(cstart);</span>
<span class="nc" id="L220">    buf.append(&quot;, clen:&quot; );</span>
<span class="nc" id="L221">    buf.append(clen);</span>
<span class="nc" id="L222">    buf.append(&quot;, chars:\&quot;&quot;);</span>
    int chStart, chLimit;
<span class="nc bnc" id="L224" title="All 2 branches missed.">    if (withContext == WITH_CONTEXT) {</span>
<span class="nc" id="L225">        chStart = cstart;</span>
<span class="nc" id="L226">        chLimit = cstart + clen;</span>
    }
    else {
<span class="nc" id="L229">        chStart = start;</span>
<span class="nc" id="L230">        chLimit = start + len;</span>
    }
<span class="nc bnc" id="L232" title="All 2 branches missed.">    for (int i = chStart; i &lt; chLimit; ++i) {</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">      if (i &gt; chStart) {</span>
<span class="nc" id="L234">        buf.append(&quot; &quot;);</span>
      }
<span class="nc" id="L236">      buf.append(Integer.toHexString(chars[i]));</span>
    }
<span class="nc" id="L238">    buf.append(&quot;\&quot;&quot;);</span>
<span class="nc" id="L239">    buf.append(&quot;, level:&quot;);</span>
<span class="nc" id="L240">    buf.append(level);</span>
<span class="nc" id="L241">    buf.append(&quot;, flags:&quot;);</span>
<span class="nc" id="L242">    buf.append(flags);</span>
<span class="nc" id="L243">    buf.append(&quot;, font:&quot;);</span>
<span class="nc" id="L244">    buf.append(font);</span>
<span class="nc" id="L245">    buf.append(&quot;, frc:&quot;);</span>
<span class="nc" id="L246">    buf.append(frc);</span>
<span class="nc" id="L247">    buf.append(&quot;, cm:&quot;);</span>
<span class="nc" id="L248">    buf.append(cm);</span>
<span class="nc" id="L249">    buf.append(&quot;]&quot;);</span>

<span class="nc" id="L251">    return buf.toString();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>