<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PhysicalStrike.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.font</a> &gt; <span class="el_source">PhysicalStrike.java</span></div><h1>PhysicalStrike.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.font;

import java.awt.Font;
import java.awt.geom.AffineTransform;
import java.awt.geom.GeneralPath;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;
import java.util.concurrent.ConcurrentHashMap;


public abstract class PhysicalStrike extends FontStrike {

    static final long INTMASK = 0xffffffffL;
    static boolean longAddresses;
    static {
<span class="nc bnc" id="L41" title="All 3 branches missed.">        switch (StrikeCache.nativeAddressSize) {</span>
<span class="nc" id="L42">        case 8: longAddresses = true; break;</span>
<span class="nc" id="L43">        case 4: longAddresses = false; break;</span>
<span class="nc" id="L44">        default: throw new RuntimeException(&quot;Unexpected address size&quot;);</span>
        }
<span class="nc" id="L46">    }</span>

    private PhysicalFont physicalFont;
    protected CharToGlyphMapper mapper;
    /* the ScalerContext is a native structure pre-filled with the
     * info needed to setup the scaler for this strike. Its immutable
     * so we set it up when the strike is created and free it when the
     * strike is disposed. There's then no need to pass the info down
     * separately to native on every call to the scaler.
     */
    protected long pScalerContext;

    /* Only one of these two arrays is non-null.
     * use the one that matches size of an address (32 or 64 bits)
     */
    protected long[] longGlyphImages;
    protected int[] intGlyphImages;

    /* Used by the TrueTypeFont subclass, which is the only client
     * of getGlyphPoint(). The field and method are here because
     * there is no TrueTypeFontStrike subclass.
     * This map is a cache of the positions of points on the outline
     * of a TrueType glyph. It is used by the OpenType layout engine
     * to perform mark positioning. Without this cache every position
     * request involves scaling and hinting the glyph outline potentially
     * over and over again.
     */
    ConcurrentHashMap&lt;Integer, Point2D.Float&gt; glyphPointMapCache;

    protected boolean getImageWithAdvance;
    protected static final int complexTX =
        AffineTransform.TYPE_FLIP |
        AffineTransform.TYPE_GENERAL_SCALE |
        AffineTransform.TYPE_GENERAL_ROTATION |
        AffineTransform.TYPE_GENERAL_TRANSFORM |
        AffineTransform.TYPE_QUADRANT_ROTATION;

<span class="nc" id="L83">    PhysicalStrike(PhysicalFont physicalFont, FontStrikeDesc desc) {</span>
<span class="nc" id="L84">        this.physicalFont = physicalFont;</span>
<span class="nc" id="L85">        this.desc = desc;</span>
<span class="nc" id="L86">    }</span>

<span class="nc" id="L88">    protected PhysicalStrike() {</span>
<span class="nc" id="L89">    }</span>
    /* A number of methods are delegated by the strike to the scaler
     * context which is a shared resource on a physical font.
     */

    public int getNumGlyphs() {
<span class="nc" id="L95">        return physicalFont.getNumGlyphs();</span>
    }

    /* These 3 metrics methods below should be implemented to return
     * values in user space.
     */
    StrikeMetrics getFontMetrics() {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (strikeMetrics == null) {</span>
<span class="nc" id="L103">            strikeMetrics =</span>
<span class="nc" id="L104">                physicalFont.getFontMetrics(pScalerContext);</span>
        }
<span class="nc" id="L106">        return strikeMetrics;</span>
    }

    float getCodePointAdvance(int cp) {
<span class="nc" id="L110">        return getGlyphAdvance(physicalFont.getMapper().charToGlyph(cp));</span>
    }

   Point2D.Float getCharMetrics(char ch) {
<span class="nc" id="L114">        return getGlyphMetrics(physicalFont.getMapper().charToGlyph(ch));</span>
    }

    int getSlot0GlyphImagePtrs(int[] glyphCodes, long[] images, int  len) {
<span class="nc" id="L118">        return 0;</span>
    }

    /* Used by the OpenType engine for mark positioning.
     */
    Point2D.Float getGlyphPoint(int glyphCode, int ptNumber) {
<span class="nc" id="L124">        Point2D.Float gp = null;</span>
<span class="nc" id="L125">        Integer ptKey = Integer.valueOf(glyphCode&lt;&lt;16|ptNumber);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (glyphPointMapCache == null) {</span>
<span class="nc" id="L127">            synchronized (this) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                if (glyphPointMapCache == null) {</span>
<span class="nc" id="L129">                    glyphPointMapCache =</span>
                        new ConcurrentHashMap&lt;Integer, Point2D.Float&gt;();
                }
<span class="nc" id="L132">            }</span>
        } else {
<span class="nc" id="L134">            gp = glyphPointMapCache.get(ptKey);</span>
        }

<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (gp == null) {</span>
<span class="nc" id="L138">            gp = (physicalFont.getGlyphPoint(pScalerContext, glyphCode, ptNumber));</span>
<span class="nc" id="L139">            adjustPoint(gp);</span>
<span class="nc" id="L140">            glyphPointMapCache.put(ptKey, gp);</span>
        }
<span class="nc" id="L142">        return gp;</span>
    }

    protected void adjustPoint(Point2D.Float pt) {
<span class="nc" id="L146">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>