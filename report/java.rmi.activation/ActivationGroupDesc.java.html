<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>ActivationGroupDesc.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.rmi.activation</a> &gt; <span class="el_source">ActivationGroupDesc.java</span></div><h1>ActivationGroupDesc.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.rmi.activation;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.Serializable;
import java.rmi.MarshalledObject;
import java.util.Arrays;
import java.util.Properties;

/**
 * An activation group descriptor contains the information necessary to
 * create/recreate an activation group in which to activate objects.
 * Such a descriptor contains: &lt;ul&gt;
 * &lt;li&gt; the group's class name,
 * &lt;li&gt; the group's code location (the location of the group's class), and
 * &lt;li&gt; a &quot;marshalled&quot; object that can contain group specific
 * initialization data. &lt;/ul&gt; &lt;p&gt;
 *
 * The group's class must be a concrete subclass of
 * &lt;code&gt;ActivationGroup&lt;/code&gt;. A subclass of
 * &lt;code&gt;ActivationGroup&lt;/code&gt; is created/recreated via the
 * &lt;code&gt;ActivationGroup.createGroup&lt;/code&gt; static method that invokes
 * a special constructor that takes two arguments: &lt;ul&gt;
 *
 * &lt;li&gt; the group's &lt;code&gt;ActivationGroupID&lt;/code&gt;, and
 * &lt;li&gt; the group's initialization data (in a
 * &lt;code&gt;java.rmi.MarshalledObject&lt;/code&gt;)&lt;/ul&gt;&lt;p&gt;
 *
 * @author      Ann Wollrath
 * @since       1.2
 * @see         ActivationGroup
 * @see         ActivationGroupID
 */
public final class ActivationGroupDesc implements Serializable {

    /**
     * @serial The group's fully package qualified class name.
     */
    private String className;

    /**
     * @serial The location from where to load the group's class.
     */
    private String location;

    /**
     * @serial The group's initialization data.
     */
    private MarshalledObject&lt;?&gt; data;

    /**
     * @serial The controlling options for executing the VM in
     * another process.
     */
    private CommandEnvironment env;

    /**
     * @serial A properties map which will override those set
     * by default in the subprocess environment.
     */
    private Properties props;

    /** indicate compatibility with the Java 2 SDK v1.2 version of class */
    private static final long serialVersionUID = -4936225423168276595L;

    /**
     * Constructs a group descriptor that uses the system defaults for group
     * implementation and code location.  Properties specify Java
     * environment overrides (which will override system properties in
     * the group implementation's VM).  The command
     * environment can control the exact command/options used in
     * starting the child VM, or can be &lt;code&gt;null&lt;/code&gt; to accept
     * rmid's default.
     *
     * &lt;p&gt;This constructor will create an &lt;code&gt;ActivationGroupDesc&lt;/code&gt;
     * with a &lt;code&gt;null&lt;/code&gt; group class name, which indicates the system's
     * default &lt;code&gt;ActivationGroup&lt;/code&gt; implementation.
     *
     * @param overrides the set of properties to set when the group is
     * recreated.
     * @param cmd the controlling options for executing the VM in
     * another process (or &lt;code&gt;null&lt;/code&gt;).
     * @since 1.2
     */
    public ActivationGroupDesc(Properties overrides,
                               CommandEnvironment cmd)
    {
<span class="fc" id="L113">        this(null, null, null, overrides, cmd);</span>
<span class="fc" id="L114">    }</span>

    /**
     * Specifies an alternate group implementation and execution
     * environment to be used for the group.
     *
     * @param className the group's package qualified class name or
     * &lt;code&gt;null&lt;/code&gt;. A &lt;code&gt;null&lt;/code&gt; group class name indicates
     * the system's default &lt;code&gt;ActivationGroup&lt;/code&gt; implementation.
     * @param location the location from where to load the group's
     * class
     * @param data the group's initialization data contained in
     * marshalled form (could contain properties, for example)
     * @param overrides a properties map which will override those set
     * by default in the subprocess environment (will be translated
     * into &lt;code&gt;-D&lt;/code&gt; options), or &lt;code&gt;null&lt;/code&gt;.
     * @param cmd the controlling options for executing the VM in
     * another process (or &lt;code&gt;null&lt;/code&gt;).
     * @since 1.2
     */
    public ActivationGroupDesc(String className,
                               String location,
                               MarshalledObject&lt;?&gt; data,
                               Properties overrides,
                               CommandEnvironment cmd)
<span class="fc" id="L139">    {</span>
<span class="fc" id="L140">        this.props = overrides;</span>
<span class="fc" id="L141">        this.env = cmd;</span>
<span class="fc" id="L142">        this.data = data;</span>
<span class="fc" id="L143">        this.location = location;</span>
<span class="fc" id="L144">        this.className = className;</span>
<span class="fc" id="L145">    }</span>

    /**
     * Returns the group's class name (possibly &lt;code&gt;null&lt;/code&gt;).  A
     * &lt;code&gt;null&lt;/code&gt; group class name indicates the system's default
     * &lt;code&gt;ActivationGroup&lt;/code&gt; implementation.
     * @return the group's class name
     * @since 1.2
     */
    public String getClassName() {
<span class="fc" id="L155">        return className;</span>
    }

    /**
     * Returns the group's code location.
     * @return the group's code location
     * @since 1.2
     */
    public String getLocation() {
<span class="fc" id="L164">        return location;</span>
    }

    /**
     * Returns the group's initialization data.
     * @return the group's initialization data
     * @since 1.2
     */
    public MarshalledObject&lt;?&gt; getData() {
<span class="fc" id="L173">        return data;</span>
    }

    /**
     * Returns the group's property-override list.
     * @return the property-override list, or &lt;code&gt;null&lt;/code&gt;
     * @since 1.2
     */
    public Properties getPropertyOverrides() {
<span class="fc bfc" id="L182" title="All 2 branches covered.">        return (props != null) ? (Properties) props.clone() : null;</span>
    }

    /**
     * Returns the group's command-environment control object.
     * @return the command-environment object, or &lt;code&gt;null&lt;/code&gt;
     * @since 1.2
     */
    public CommandEnvironment getCommandEnvironment() {
<span class="fc" id="L191">        return this.env;</span>
    }


    /**
     * Startup options for ActivationGroup implementations.
     *
     * This class allows overriding default system properties and
     * specifying implementation-defined options for ActivationGroups.
     * @since 1.2
     */
    public static class CommandEnvironment implements Serializable {
        private static final long serialVersionUID = 6165754737887770191L;

        /**
         * @serial
         */
        private String command;

        /**
         * @serial
         */
        private String[] options;

        /**
         * Create a CommandEnvironment with all the necessary
         * information.
         *
         * @param cmdpath the name of the java executable, including
         * the full path, or &lt;code&gt;null&lt;/code&gt;, meaning &quot;use rmid's default&quot;.
         * The named program &lt;em&gt;must&lt;/em&gt; be able to accept multiple
         * &lt;code&gt;-Dpropname=value&lt;/code&gt; options (as documented for the
         * &quot;java&quot; tool)
         *
         * @param argv extra options which will be used in creating the
         * ActivationGroup.  Null has the same effect as an empty
         * list.
         * @since 1.2
         */
        public CommandEnvironment(String cmdpath,
                                  String[] argv)
<span class="fc" id="L232">        {</span>
<span class="fc" id="L233">            this.command = cmdpath;     // might be null</span>

            // Hold a safe copy of argv in this.options
<span class="fc bfc" id="L236" title="All 2 branches covered.">            if (argv == null) {</span>
<span class="fc" id="L237">                this.options = new String[0];</span>
            } else {
<span class="fc" id="L239">                this.options = new String[argv.length];</span>
<span class="fc" id="L240">                System.arraycopy(argv, 0, this.options, 0, argv.length);</span>
            }
<span class="fc" id="L242">        }</span>

        /**
         * Fetch the configured path-qualified java command name.
         *
         * @return the configured name, or &lt;code&gt;null&lt;/code&gt; if configured to
         * accept the default
         * @since 1.2
         */
        public String getCommandPath() {
<span class="nc" id="L252">            return (this.command);</span>
        }

        /**
         * Fetch the configured java command options.
         *
         * @return An array of the command options which will be passed
         * to the new child command by rmid.
         * Note that rmid may add other options before or after these
         * options, or both.
         * Never returns &lt;code&gt;null&lt;/code&gt;.
         * @since 1.2
         */
        public String[] getCommandOptions() {
<span class="nc" id="L266">            return options.clone();</span>
        }

        /**
         * Compares two command environments for content equality.
         *
         * @param       obj     the Object to compare with
         * @return      true if these Objects are equal; false otherwise.
         * @see         java.util.Hashtable
         * @since 1.2
         */
        public boolean equals(Object obj) {

<span class="pc bpc" id="L279" title="1 of 2 branches missed.">            if (obj instanceof CommandEnvironment) {</span>
<span class="fc" id="L280">                CommandEnvironment env = (CommandEnvironment) obj;</span>
<span class="pc bpc" id="L281" title="2 of 4 branches missed.">                return</span>
                    ((command == null ? env.command == null :
<span class="pc bnc" id="L283" title="All 2 branches missed.">                      command.equals(env.command)) &amp;&amp;</span>
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">                     Arrays.equals(options, env.options));</span>
            } else {
<span class="nc" id="L286">                return false;</span>
            }
        }

        /**
         * Return identical values for similar
         * &lt;code&gt;CommandEnvironment&lt;/code&gt;s.
         * @return an integer
         * @see java.util.Hashtable
         */
        public int hashCode()
        {
            // hash command and ignore possibly expensive options
<span class="nc bnc" id="L299" title="All 2 branches missed.">            return (command == null ? 0 : command.hashCode());</span>
        }

        /**
         * &lt;code&gt;readObject&lt;/code&gt; for custom serialization.
         *
         * &lt;p&gt;This method reads this object's serialized form for this
         * class as follows:
         *
         * &lt;p&gt;This method first invokes &lt;code&gt;defaultReadObject&lt;/code&gt; on
         * the specified object input stream, and if &lt;code&gt;options&lt;/code&gt;
         * is &lt;code&gt;null&lt;/code&gt;, then &lt;code&gt;options&lt;/code&gt; is set to a
         * zero-length array of &lt;code&gt;String&lt;/code&gt;.
         */
        private void readObject(ObjectInputStream in)
            throws IOException, ClassNotFoundException
        {
<span class="nc" id="L316">            in.defaultReadObject();</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">            if (options == null) {</span>
<span class="nc" id="L318">                options = new String[0];</span>
            }
<span class="nc" id="L320">        }</span>
    }

    /**
     * Compares two activation group descriptors for content equality.
     *
     * @param   obj     the Object to compare with
     * @return  true if these Objects are equal; false otherwise.
     * @see             java.util.Hashtable
     * @since 1.2
     */
    public boolean equals(Object obj) {

<span class="pc bpc" id="L333" title="1 of 2 branches missed.">        if (obj instanceof ActivationGroupDesc) {</span>
<span class="fc" id="L334">            ActivationGroupDesc desc = (ActivationGroupDesc) obj;</span>
<span class="pc bpc" id="L335" title="2 of 4 branches missed.">            return</span>
                ((className == null ? desc.className == null :
<span class="pc bpc" id="L337" title="4 of 6 branches missed.">                  className.equals(desc.className)) &amp;&amp;</span>
                 (location == null ? desc.location == null :
<span class="pc bpc" id="L339" title="4 of 6 branches missed.">                  location.equals(desc.location)) &amp;&amp;</span>
<span class="pc bpc" id="L340" title="4 of 6 branches missed.">                 (data == null ? desc.data == null : data.equals(desc.data)) &amp;&amp;</span>
<span class="pc bpc" id="L341" title="5 of 6 branches missed.">                 (env == null ? desc.env == null : env.equals(desc.env)) &amp;&amp;</span>
                 (props == null ? desc.props == null :
<span class="pc bpc" id="L343" title="1 of 2 branches missed.">                  props.equals(desc.props)));</span>
        } else {
<span class="nc" id="L345">            return false;</span>
        }
    }

    /**
     * Produce identical numbers for similar &lt;code&gt;ActivationGroupDesc&lt;/code&gt;s.
     * @return an integer
     * @see java.util.Hashtable
     */
    public int hashCode() {
        // hash location, className, data, and env
        // but omit props (may be expensive)
<span class="nc bnc" id="L357" title="All 2 branches missed.">        return ((location == null</span>
                    ? 0
<span class="nc bnc" id="L359" title="All 2 branches missed.">                    : location.hashCode() &lt;&lt; 24) ^</span>
                (env == null
                    ? 0
<span class="nc bnc" id="L362" title="All 2 branches missed.">                    : env.hashCode() &lt;&lt; 16) ^</span>
                (className == null
                    ? 0
<span class="nc bnc" id="L365" title="All 2 branches missed.">                    : className.hashCode() &lt;&lt; 8) ^</span>
                (data == null
                    ? 0
<span class="nc" id="L368">                    : data.hashCode()));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>