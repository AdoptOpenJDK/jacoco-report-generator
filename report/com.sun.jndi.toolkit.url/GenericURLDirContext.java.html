<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>GenericURLDirContext.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.jndi.toolkit.url</a> &gt; <span class="el_source">GenericURLDirContext.java</span></div><h1>GenericURLDirContext.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.jndi.toolkit.url;

import javax.naming.*;
import javax.naming.directory.*;
import javax.naming.spi.ResolveResult;
import javax.naming.spi.DirectoryManager;

import java.util.Hashtable;

/**
 * This abstract class is a generic URL DirContext that accepts as the
 * name argument either a string URL or a Name whose first component
 * is a URL. It resolves the URL to a target context and then continues
 * the operation using the remaining name in the target context as if
 * the first component names a junction.
 *
 * A subclass must define getRootURLContext()
 * to process the URL into head/tail pieces. If it wants to control how
 * URL strings are parsed and compared for the rename() operation, then
 * it should override getNonRootURLSuffixes() and urlEquals().
 *
 * @author Scott Seligman
 * @author Rosanna Lee
 */

abstract public class GenericURLDirContext extends GenericURLContext
implements DirContext {

    protected GenericURLDirContext(Hashtable&lt;?,?&gt; env) {
<span class="fc" id="L54">        super(env);</span>
<span class="fc" id="L55">    }</span>

    /**
     * Gets the context in which to continue the operation. This method
     * is called when this context is asked to process a multicomponent
     * Name in which the first component is a URL.
     * Treat the first component like a junction: resolve it and then use
     * DirectoryManager.getContinuationDirContext() to get the target context in
     * which to operate on the remainder of the name (n.getSuffix(1)).
     * Do this in case intermediate contexts are not DirContext.
     */
    protected DirContext getContinuationDirContext(Name n) throws NamingException {
<span class="nc" id="L67">        Object obj = lookup(n.get(0));</span>
<span class="nc" id="L68">        CannotProceedException cpe = new CannotProceedException();</span>
<span class="nc" id="L69">        cpe.setResolvedObj(obj);</span>
<span class="nc" id="L70">        cpe.setEnvironment(myEnv);</span>
<span class="nc" id="L71">        return DirectoryManager.getContinuationDirContext(cpe);</span>
    }


    public Attributes getAttributes(String name) throws NamingException {
<span class="nc" id="L76">        ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L77">        DirContext ctx = (DirContext)res.getResolvedObj();</span>
        try {
<span class="nc" id="L79">            return ctx.getAttributes(res.getRemainingName());</span>
        } finally {
<span class="nc" id="L81">            ctx.close();</span>
        }
    }

    public Attributes getAttributes(Name name) throws NamingException  {
<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (name.size() == 1) {</span>
<span class="nc" id="L87">            return getAttributes(name.get(0));</span>
        } else {
<span class="nc" id="L89">            DirContext ctx = getContinuationDirContext(name);</span>
            try {
<span class="nc" id="L91">                return ctx.getAttributes(name.getSuffix(1));</span>
            } finally {
<span class="nc" id="L93">                ctx.close();</span>
            }
        }
    }

    public Attributes getAttributes(String name, String[] attrIds)
        throws NamingException {
<span class="fc" id="L100">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="fc" id="L101">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L103">                return ctx.getAttributes(res.getRemainingName(), attrIds);</span>
            } finally {
<span class="pc" id="L105">                ctx.close();</span>
            }
    }

    public Attributes getAttributes(Name name, String[] attrIds)
        throws NamingException {
<span class="nc bnc" id="L111" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L112">                return getAttributes(name.get(0), attrIds);</span>
            } else {
<span class="nc" id="L114">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L116">                    return ctx.getAttributes(name.getSuffix(1), attrIds);</span>
                } finally {
<span class="nc" id="L118">                    ctx.close();</span>
                }
            }
    }

    public void modifyAttributes(String name, int mod_op, Attributes attrs)
        throws NamingException {
<span class="nc" id="L125">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L126">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L128">                ctx.modifyAttributes(res.getRemainingName(), mod_op, attrs);</span>
            } finally {
<span class="nc" id="L130">                ctx.close();</span>
<span class="nc" id="L131">            }</span>
<span class="nc" id="L132">    }</span>

    public void modifyAttributes(Name name, int mod_op, Attributes attrs)
        throws NamingException {
<span class="nc bnc" id="L136" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L137">                modifyAttributes(name.get(0), mod_op, attrs);</span>
            } else {
<span class="nc" id="L139">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L141">                    ctx.modifyAttributes(name.getSuffix(1), mod_op, attrs);</span>
                } finally {
<span class="nc" id="L143">                    ctx.close();</span>
<span class="nc" id="L144">                }</span>
            }
<span class="nc" id="L146">    }</span>

    public void modifyAttributes(String name, ModificationItem[] mods)
        throws NamingException {
<span class="nc" id="L150">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L151">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L153">                ctx.modifyAttributes(res.getRemainingName(), mods);</span>
            } finally {
<span class="nc" id="L155">                ctx.close();</span>
<span class="nc" id="L156">            }</span>
<span class="nc" id="L157">    }</span>

    public void modifyAttributes(Name name, ModificationItem[] mods)
        throws NamingException  {
<span class="nc bnc" id="L161" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L162">                modifyAttributes(name.get(0), mods);</span>
            } else {
<span class="nc" id="L164">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L166">                    ctx.modifyAttributes(name.getSuffix(1), mods);</span>
                } finally {
<span class="nc" id="L168">                    ctx.close();</span>
<span class="nc" id="L169">                }</span>
            }
<span class="nc" id="L171">    }</span>

    public void bind(String name, Object obj, Attributes attrs)
        throws NamingException {
<span class="nc" id="L175">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L176">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L178">                ctx.bind(res.getRemainingName(), obj, attrs);</span>
            } finally {
<span class="nc" id="L180">                ctx.close();</span>
<span class="nc" id="L181">            }</span>
<span class="nc" id="L182">    }</span>

    public void bind(Name name, Object obj, Attributes attrs)
        throws NamingException {
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L187">                bind(name.get(0), obj, attrs);</span>
            } else {
<span class="nc" id="L189">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L191">                    ctx.bind(name.getSuffix(1), obj, attrs);</span>
                } finally {
<span class="nc" id="L193">                    ctx.close();</span>
<span class="nc" id="L194">                }</span>
            }
<span class="nc" id="L196">    }</span>

    public void rebind(String name, Object obj, Attributes attrs)
        throws NamingException {
<span class="nc" id="L200">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L201">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L203">                ctx.rebind(res.getRemainingName(), obj, attrs);</span>
            } finally {
<span class="nc" id="L205">                ctx.close();</span>
<span class="nc" id="L206">            }</span>
<span class="nc" id="L207">    }</span>

    public void rebind(Name name, Object obj, Attributes attrs)
        throws NamingException {
<span class="nc bnc" id="L211" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L212">                rebind(name.get(0), obj, attrs);</span>
            } else {
<span class="nc" id="L214">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L216">                    ctx.rebind(name.getSuffix(1), obj, attrs);</span>
                } finally {
<span class="nc" id="L218">                    ctx.close();</span>
<span class="nc" id="L219">                }</span>
            }
<span class="nc" id="L221">    }</span>

    public DirContext createSubcontext(String name, Attributes attrs)
        throws NamingException {
<span class="nc" id="L225">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L226">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L228">                return ctx.createSubcontext(res.getRemainingName(), attrs);</span>
            } finally {
<span class="nc" id="L230">                ctx.close();</span>
            }
    }

    public DirContext createSubcontext(Name name, Attributes attrs)
        throws NamingException {
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L237">                return createSubcontext(name.get(0), attrs);</span>
            } else {
<span class="nc" id="L239">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L241">                    return ctx.createSubcontext(name.getSuffix(1), attrs);</span>
                } finally {
<span class="nc" id="L243">                    ctx.close();</span>
                }
            }
    }

    public DirContext getSchema(String name) throws NamingException {
<span class="nc" id="L249">        ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L250">        DirContext ctx = (DirContext)res.getResolvedObj();</span>
<span class="nc" id="L251">        return ctx.getSchema(res.getRemainingName());</span>
    }

    public DirContext getSchema(Name name) throws NamingException {
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (name.size() == 1) {</span>
<span class="nc" id="L256">            return getSchema(name.get(0));</span>
        } else {
<span class="nc" id="L258">            DirContext ctx = getContinuationDirContext(name);</span>
            try {
<span class="nc" id="L260">                return ctx.getSchema(name.getSuffix(1));</span>
            } finally {
<span class="nc" id="L262">                ctx.close();</span>
            }
        }
    }

    public DirContext getSchemaClassDefinition(String name)
        throws NamingException {
<span class="nc" id="L269">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L270">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L272">                return ctx.getSchemaClassDefinition(res.getRemainingName());</span>
            } finally {
<span class="nc" id="L274">                ctx.close();</span>
            }
    }

    public DirContext getSchemaClassDefinition(Name name)
        throws NamingException {
<span class="nc bnc" id="L280" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L281">                return getSchemaClassDefinition(name.get(0));</span>
            } else {
<span class="nc" id="L283">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L285">                    return ctx.getSchemaClassDefinition(name.getSuffix(1));</span>
                } finally {
<span class="nc" id="L287">                    ctx.close();</span>
                }
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(String name,
        Attributes matchingAttributes)
        throws NamingException {
<span class="nc" id="L295">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L296">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L298">                return ctx.search(res.getRemainingName(), matchingAttributes);</span>
            } finally {
<span class="nc" id="L300">                ctx.close();</span>
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(Name name,
        Attributes matchingAttributes)
        throws NamingException {
<span class="nc bnc" id="L307" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L308">                return search(name.get(0), matchingAttributes);</span>
            } else {
<span class="nc" id="L310">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L312">                    return ctx.search(name.getSuffix(1), matchingAttributes);</span>
                } finally {
<span class="nc" id="L314">                    ctx.close();</span>
                }
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(String name,
        Attributes matchingAttributes,
        String[] attributesToReturn)
        throws NamingException {
<span class="nc" id="L323">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L324">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L326">                return ctx.search(res.getRemainingName(),</span>
                    matchingAttributes, attributesToReturn);
            } finally {
<span class="nc" id="L329">                ctx.close();</span>
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(Name name,
        Attributes matchingAttributes,
        String[] attributesToReturn)
        throws NamingException {
<span class="nc bnc" id="L337" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L338">                return search(name.get(0), matchingAttributes,</span>
                    attributesToReturn);
            } else {
<span class="nc" id="L341">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L343">                    return ctx.search(name.getSuffix(1),</span>
                        matchingAttributes, attributesToReturn);
                } finally {
<span class="nc" id="L346">                    ctx.close();</span>
                }
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(String name,
        String filter,
        SearchControls cons)
        throws NamingException {
<span class="nc" id="L355">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L356">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L358">                return ctx.search(res.getRemainingName(), filter, cons);</span>
            } finally {
<span class="nc" id="L360">                ctx.close();</span>
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(Name name,
        String filter,
        SearchControls cons)
        throws NamingException {
<span class="nc bnc" id="L368" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L369">                return search(name.get(0), filter, cons);</span>
            } else {
<span class="nc" id="L371">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L373">                    return ctx.search(name.getSuffix(1), filter, cons);</span>
                } finally {
<span class="nc" id="L375">                    ctx.close();</span>
                }
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(String name,
        String filterExpr,
        Object[] filterArgs,
        SearchControls cons)
        throws NamingException {
<span class="nc" id="L385">            ResolveResult res = getRootURLContext(name, myEnv);</span>
<span class="nc" id="L386">            DirContext ctx = (DirContext)res.getResolvedObj();</span>
            try {
<span class="nc" id="L388">                return</span>
<span class="nc" id="L389">                    ctx.search(res.getRemainingName(), filterExpr, filterArgs, cons);</span>
            } finally {
<span class="nc" id="L391">                ctx.close();</span>
            }
    }

    public NamingEnumeration&lt;SearchResult&gt; search(Name name,
        String filterExpr,
        Object[] filterArgs,
        SearchControls cons)
        throws NamingException {
<span class="nc bnc" id="L400" title="All 2 branches missed.">            if (name.size() == 1) {</span>
<span class="nc" id="L401">                return search(name.get(0), filterExpr, filterArgs, cons);</span>
            } else {
<span class="nc" id="L403">                DirContext ctx = getContinuationDirContext(name);</span>
                try {
<span class="nc" id="L405">                return ctx.search(name.getSuffix(1), filterExpr, filterArgs, cons);</span>
                } finally {
<span class="nc" id="L407">                    ctx.close();</span>
                }
            }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>