<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BaseCalendar.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.util.calendar</a> &gt; <span class="el_source">BaseCalendar.java</span></div><h1>BaseCalendar.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.util.calendar;

import java.util.TimeZone;

/**
 * The &lt;code&gt;BaseCalendar&lt;/code&gt; provides basic calendar calculation
 * functions to support the Julian, Gregorian, and Gregorian-based
 * calendar systems.
 *
 * @author Masayoshi Okutsu
 * @since 1.5
 */

<span class="fc bfc" id="L39" title="All 2 branches covered.">public abstract class BaseCalendar extends AbstractCalendar {</span>

    public static final int JANUARY = 1;
    public static final int FEBRUARY = 2;
    public static final int MARCH = 3;
    public static final int APRIL = 4;
    public static final int MAY = 5;
    public static final int JUNE = 6;
    public static final int JULY = 7;
    public static final int AUGUST = 8;
    public static final int SEPTEMBER = 9;
    public static final int OCTOBER = 10;
    public static final int NOVEMBER = 11;
    public static final int DECEMBER = 12;

    // day of week constants
    public static final int SUNDAY = 1;
    public static final int MONDAY = 2;
    public static final int TUESDAY = 3;
    public static final int WEDNESDAY = 4;
    public static final int THURSDAY = 5;
    public static final int FRIDAY = 6;
    public static final int SATURDAY = 7;

    // The base Gregorian year of FIXED_DATES[]
    private static final int BASE_YEAR = 1970;

    // Pre-calculated fixed dates of January 1 from BASE_YEAR
    // (Gregorian). This table covers all the years that can be
    // supported by the POSIX time_t (32-bit) after the Epoch. Note
    // that the data type is int[].
<span class="fc" id="L70">    private static final int[] FIXED_DATES = {</span>
        719163, // 1970
        719528, // 1971
        719893, // 1972
        720259, // 1973
        720624, // 1974
        720989, // 1975
        721354, // 1976
        721720, // 1977
        722085, // 1978
        722450, // 1979
        722815, // 1980
        723181, // 1981
        723546, // 1982
        723911, // 1983
        724276, // 1984
        724642, // 1985
        725007, // 1986
        725372, // 1987
        725737, // 1988
        726103, // 1989
        726468, // 1990
        726833, // 1991
        727198, // 1992
        727564, // 1993
        727929, // 1994
        728294, // 1995
        728659, // 1996
        729025, // 1997
        729390, // 1998
        729755, // 1999
        730120, // 2000
        730486, // 2001
        730851, // 2002
        731216, // 2003
        731581, // 2004
        731947, // 2005
        732312, // 2006
        732677, // 2007
        733042, // 2008
        733408, // 2009
        733773, // 2010
        734138, // 2011
        734503, // 2012
        734869, // 2013
        735234, // 2014
        735599, // 2015
        735964, // 2016
        736330, // 2017
        736695, // 2018
        737060, // 2019
        737425, // 2020
        737791, // 2021
        738156, // 2022
        738521, // 2023
        738886, // 2024
        739252, // 2025
        739617, // 2026
        739982, // 2027
        740347, // 2028
        740713, // 2029
        741078, // 2030
        741443, // 2031
        741808, // 2032
        742174, // 2033
        742539, // 2034
        742904, // 2035
        743269, // 2036
        743635, // 2037
        744000, // 2038
        744365, // 2039
    };

<span class="fc" id="L143">    public abstract static class Date extends CalendarDate {</span>
        protected Date() {
<span class="fc" id="L145">            super();</span>
<span class="fc" id="L146">        }</span>
        protected Date(TimeZone zone) {
<span class="fc" id="L148">            super(zone);</span>
<span class="fc" id="L149">        }</span>

        public Date setNormalizedDate(int normalizedYear, int month, int dayOfMonth) {
<span class="fc" id="L152">            setNormalizedYear(normalizedYear);</span>
<span class="fc" id="L153">            setMonth(month).setDayOfMonth(dayOfMonth);</span>
<span class="fc" id="L154">            return this;</span>
        }

        public abstract int getNormalizedYear();

        public abstract void setNormalizedYear(int normalizedYear);

        // Cache for the fixed date of January 1 and year length of the
        // cachedYear. A simple benchmark showed 7% performance
        // improvement with &gt;90% cache hit. The initial values are for Gregorian.
<span class="fc" id="L164">        int cachedYear = 2004;</span>
<span class="fc" id="L165">        long cachedFixedDateJan1 = 731581L;</span>
<span class="fc" id="L166">        long cachedFixedDateNextJan1 = cachedFixedDateJan1 + 366;</span>

        protected final boolean hit(int year) {
<span class="fc bfc" id="L169" title="All 2 branches covered.">            return year == cachedYear;</span>
        }

        protected final boolean hit(long fixedDate) {
<span class="fc bfc" id="L173" title="All 4 branches covered.">            return (fixedDate &gt;= cachedFixedDateJan1 &amp;&amp;</span>
                    fixedDate &lt; cachedFixedDateNextJan1);
        }
        protected int getCachedYear() {
<span class="fc" id="L177">            return cachedYear;</span>
        }

        protected long getCachedJan1() {
<span class="fc" id="L181">            return cachedFixedDateJan1;</span>
        }

        protected void setCache(int year, long jan1, int len) {
<span class="fc" id="L185">            cachedYear = year;</span>
<span class="fc" id="L186">            cachedFixedDateJan1 = jan1;</span>
<span class="fc" id="L187">            cachedFixedDateNextJan1 = jan1 + len;</span>
<span class="fc" id="L188">        }</span>
    }

    public boolean validate(CalendarDate date) {
<span class="nc" id="L192">        Date bdate = (Date) date;</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (bdate.isNormalized()) {</span>
<span class="nc" id="L194">            return true;</span>
        }
<span class="nc" id="L196">        int month = bdate.getMonth();</span>
<span class="nc bnc" id="L197" title="All 4 branches missed.">        if (month &lt; JANUARY || month &gt; DECEMBER) {</span>
<span class="nc" id="L198">            return false;</span>
        }
<span class="nc" id="L200">        int d = bdate.getDayOfMonth();</span>
<span class="nc bnc" id="L201" title="All 4 branches missed.">        if (d &lt;= 0 || d &gt; getMonthLength(bdate.getNormalizedYear(), month)) {</span>
<span class="nc" id="L202">            return false;</span>
        }
<span class="nc" id="L204">        int dow = bdate.getDayOfWeek();</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">        if (dow != Date.FIELD_UNDEFINED &amp;&amp; dow != getDayOfWeek(bdate)) {</span>
<span class="nc" id="L206">            return false;</span>
        }

<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!validateTime(date)) {</span>
<span class="nc" id="L210">            return false;</span>
        }

<span class="nc" id="L213">        bdate.setNormalized(true);</span>
<span class="nc" id="L214">        return true;</span>
    }

    public boolean normalize(CalendarDate date) {
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">        if (date.isNormalized()) {</span>
<span class="nc" id="L219">            return true;</span>
        }

<span class="fc" id="L222">        Date bdate = (Date) date;</span>
<span class="fc" id="L223">        TimeZone zi = bdate.getZone();</span>

        // If the date has a time zone, then we need to recalculate
        // the calendar fields. Let getTime() do it.
<span class="fc bfc" id="L227" title="All 2 branches covered.">        if (zi != null) {</span>
<span class="fc" id="L228">            getTime(date);</span>
<span class="fc" id="L229">            return true;</span>
        }

<span class="fc" id="L232">        int days = normalizeTime(bdate);</span>
<span class="fc" id="L233">        normalizeMonth(bdate);</span>
<span class="fc" id="L234">        long d = (long)bdate.getDayOfMonth() + days;</span>
<span class="fc" id="L235">        int m = bdate.getMonth();</span>
<span class="fc" id="L236">        int y = bdate.getNormalizedYear();</span>
<span class="fc" id="L237">        int ml = getMonthLength(y, m);</span>

<span class="pc bpc" id="L239" title="2 of 4 branches missed.">        if (!(d &gt; 0 &amp;&amp; d &lt;= ml)) {</span>
<span class="nc bnc" id="L240" title="All 4 branches missed.">            if (d &lt;= 0 &amp;&amp; d &gt; -28) {</span>
<span class="nc" id="L241">                ml = getMonthLength(y, --m);</span>
<span class="nc" id="L242">                d += ml;</span>
<span class="nc" id="L243">                bdate.setDayOfMonth((int) d);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">                if (m == 0) {</span>
<span class="nc" id="L245">                    m = DECEMBER;</span>
<span class="nc" id="L246">                    bdate.setNormalizedYear(y - 1);</span>
                }
<span class="nc" id="L248">                bdate.setMonth(m);</span>
<span class="nc bnc" id="L249" title="All 4 branches missed.">            } else if (d &gt; ml &amp;&amp; d &lt; (ml + 28)) {</span>
<span class="nc" id="L250">                d -= ml;</span>
<span class="nc" id="L251">                ++m;</span>
<span class="nc" id="L252">                bdate.setDayOfMonth((int)d);</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                if (m &gt; DECEMBER) {</span>
<span class="nc" id="L254">                    bdate.setNormalizedYear(y + 1);</span>
<span class="nc" id="L255">                    m = JANUARY;</span>
                }
<span class="nc" id="L257">                bdate.setMonth(m);</span>
            } else {
<span class="nc" id="L259">                long fixedDate = d + getFixedDate(y, m, 1, bdate) - 1L;</span>
<span class="nc" id="L260">                getCalendarDateFromFixedDate(bdate, fixedDate);</span>
<span class="nc" id="L261">            }</span>
        } else {
<span class="fc" id="L263">            bdate.setDayOfWeek(getDayOfWeek(bdate));</span>
        }
<span class="fc" id="L265">        date.setLeapYear(isLeapYear(bdate.getNormalizedYear()));</span>
<span class="fc" id="L266">        date.setZoneOffset(0);</span>
<span class="fc" id="L267">        date.setDaylightSaving(0);</span>
<span class="fc" id="L268">        bdate.setNormalized(true);</span>
<span class="fc" id="L269">        return true;</span>
    }

    void normalizeMonth(CalendarDate date) {
<span class="fc" id="L273">        Date bdate = (Date) date;</span>
<span class="fc" id="L274">        int year = bdate.getNormalizedYear();</span>
<span class="fc" id="L275">        long month = bdate.getMonth();</span>
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">        if (month &lt;= 0) {</span>
<span class="nc" id="L277">            long xm = 1L - month;</span>
<span class="nc" id="L278">            year -= (int)((xm / 12) + 1);</span>
<span class="nc" id="L279">            month = 13 - (xm % 12);</span>
<span class="nc" id="L280">            bdate.setNormalizedYear(year);</span>
<span class="nc" id="L281">            bdate.setMonth((int) month);</span>
<span class="pc bpc" id="L282" title="1 of 2 branches missed.">        } else if (month &gt; DECEMBER) {</span>
<span class="nc" id="L283">            year += (int)((month - 1) / 12);</span>
<span class="nc" id="L284">            month = ((month - 1)) % 12 + 1;</span>
<span class="nc" id="L285">            bdate.setNormalizedYear(year);</span>
<span class="nc" id="L286">            bdate.setMonth((int) month);</span>
        }
<span class="fc" id="L288">    }</span>

    /**
     * Returns 366 if the specified date is in a leap year, or 365
     * otherwise This method does not perform the normalization with
     * the specified &lt;code&gt;CalendarDate&lt;/code&gt;. The
     * &lt;code&gt;CalendarDate&lt;/code&gt; must be normalized to get a correct
     * value.
     *
     * @param a &lt;code&gt;CalendarDate&lt;/code&gt;
     * @return a year length in days
     * @throws ClassCastException if the specified date is not a
     * {@link BaseCalendar.Date}
     */
    public int getYearLength(CalendarDate date) {
<span class="nc bnc" id="L303" title="All 2 branches missed.">        return isLeapYear(((Date)date).getNormalizedYear()) ? 366 : 365;</span>
    }

    public int getYearLengthInMonths(CalendarDate date) {
<span class="nc" id="L307">        return 12;</span>
    }

<span class="fc" id="L310">    static final int[] DAYS_IN_MONTH</span>
        //  12   1   2   3   4   5   6   7   8   9  10  11  12
        = { 31, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
<span class="fc" id="L313">    static final int[] ACCUMULATED_DAYS_IN_MONTH</span>
        //  12/1 1/1 2/1 3/1 4/1 5/1 6/1 7/1 8/1 9/1 10/1 11/1 12/1
        = {  -30,  0, 31, 59, 90,120,151,181,212,243, 273, 304, 334};

<span class="fc" id="L317">    static final int[] ACCUMULATED_DAYS_IN_MONTH_LEAP</span>
        //  12/1 1/1 2/1   3/1   4/1   5/1   6/1   7/1   8/1   9/1   10/1   11/1   12/1
        = {  -30,  0, 31, 59+1, 90+1,120+1,151+1,181+1,212+1,243+1, 273+1, 304+1, 334+1};

    public int getMonthLength(CalendarDate date) {
<span class="fc" id="L322">        Date gdate = (Date) date;</span>
<span class="fc" id="L323">        int month = gdate.getMonth();</span>
<span class="pc bpc" id="L324" title="2 of 4 branches missed.">        if (month &lt; JANUARY || month &gt; DECEMBER) {</span>
<span class="nc" id="L325">            throw new IllegalArgumentException(&quot;Illegal month value: &quot; + month);</span>
        }
<span class="fc" id="L327">        return getMonthLength(gdate.getNormalizedYear(), month);</span>
    }

    // accepts 0 (December in the previous year) to 12.
    private int getMonthLength(int year, int month) {
<span class="fc" id="L332">        int days = DAYS_IN_MONTH[month];</span>
<span class="fc bfc" id="L333" title="All 4 branches covered.">        if (month == FEBRUARY &amp;&amp; isLeapYear(year)) {</span>
<span class="fc" id="L334">            days++;</span>
        }
<span class="fc" id="L336">        return days;</span>
    }

    public long getDayOfYear(CalendarDate date) {
<span class="fc" id="L340">        return getDayOfYear(((Date)date).getNormalizedYear(),</span>
<span class="fc" id="L341">                            date.getMonth(),</span>
<span class="fc" id="L342">                            date.getDayOfMonth());</span>
    }

    final long getDayOfYear(int year, int month, int dayOfMonth) {
<span class="fc" id="L346">        return (long) dayOfMonth</span>
<span class="fc bfc" id="L347" title="All 2 branches covered.">            + (isLeapYear(year) ?</span>
               ACCUMULATED_DAYS_IN_MONTH_LEAP[month] : ACCUMULATED_DAYS_IN_MONTH[month]);
    }

    // protected
    public long getFixedDate(CalendarDate date) {
<span class="fc bfc" id="L353" title="All 2 branches covered.">        if (!date.isNormalized()) {</span>
<span class="fc" id="L354">            normalizeMonth(date);</span>
        }
<span class="fc" id="L356">        return getFixedDate(((Date)date).getNormalizedYear(),</span>
<span class="fc" id="L357">                            date.getMonth(),</span>
<span class="fc" id="L358">                            date.getDayOfMonth(),</span>
                            (BaseCalendar.Date) date);
    }

    // public for java.util.GregorianCalendar
    public long getFixedDate(int year, int month, int dayOfMonth, BaseCalendar.Date cache) {
<span class="fc bfc" id="L364" title="All 4 branches covered.">        boolean isJan1 = month == JANUARY &amp;&amp; dayOfMonth == 1;</span>

        // Look up the one year cache
<span class="fc bfc" id="L367" title="All 4 branches covered.">        if (cache != null &amp;&amp; cache.hit(year)) {</span>
<span class="fc bfc" id="L368" title="All 2 branches covered.">            if (isJan1) {</span>
<span class="fc" id="L369">                return cache.getCachedJan1();</span>
            }
<span class="fc" id="L371">            return cache.getCachedJan1() + getDayOfYear(year, month, dayOfMonth) - 1;</span>
        }

        // Look up the pre-calculated fixed date table
<span class="fc" id="L375">        int n = year - BASE_YEAR;</span>
<span class="fc bfc" id="L376" title="All 4 branches covered.">        if (n &gt;= 0 &amp;&amp; n &lt; FIXED_DATES.length) {</span>
<span class="fc" id="L377">            long jan1 = FIXED_DATES[n];</span>
<span class="fc bfc" id="L378" title="All 2 branches covered.">            if (cache != null) {</span>
<span class="fc bfc" id="L379" title="All 2 branches covered.">                cache.setCache(year, jan1, isLeapYear(year) ? 366 : 365);</span>
            }
<span class="fc bfc" id="L381" title="All 2 branches covered.">            return isJan1 ? jan1 : jan1 + getDayOfYear(year, month, dayOfMonth) - 1;</span>
        }

<span class="fc" id="L384">        long prevyear = (long)year - 1;</span>
<span class="fc" id="L385">        long days = dayOfMonth;</span>

<span class="fc bfc" id="L387" title="All 2 branches covered.">        if (prevyear &gt;= 0) {</span>
<span class="fc" id="L388">            days += (365 * prevyear)</span>
                   + (prevyear / 4)
                   - (prevyear / 100)
                   + (prevyear / 400)
                   + ((367 * month - 362) / 12);
        } else {
<span class="fc" id="L394">            days += (365 * prevyear)</span>
<span class="fc" id="L395">                   + CalendarUtils.floorDivide(prevyear, 4)</span>
<span class="fc" id="L396">                   - CalendarUtils.floorDivide(prevyear, 100)</span>
<span class="fc" id="L397">                   + CalendarUtils.floorDivide(prevyear, 400)</span>
<span class="fc" id="L398">                   + CalendarUtils.floorDivide((367 * month - 362), 12);</span>
        }

<span class="fc bfc" id="L401" title="All 2 branches covered.">        if (month &gt; FEBRUARY) {</span>
<span class="fc bfc" id="L402" title="All 2 branches covered.">            days -=  isLeapYear(year) ? 1 : 2;</span>
        }

        // If it's January 1, update the cache.
<span class="fc bfc" id="L406" title="All 4 branches covered.">        if (cache != null &amp;&amp; isJan1) {</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">            cache.setCache(year, days, isLeapYear(year) ? 366 : 365);</span>
        }

<span class="fc" id="L410">        return days;</span>
    }

    /**
     * Calculates calendar fields and store them in the specified
     * &lt;code&gt;CalendarDate&lt;/code&gt;.
     */
    // should be 'protected'
    public void getCalendarDateFromFixedDate(CalendarDate date,
                                             long fixedDate) {
<span class="fc" id="L420">        Date gdate = (Date) date;</span>
        int year;
        long jan1;
        boolean isLeap;
<span class="fc bfc" id="L424" title="All 2 branches covered.">        if (gdate.hit(fixedDate)) {</span>
<span class="fc" id="L425">            year = gdate.getCachedYear();</span>
<span class="fc" id="L426">            jan1 = gdate.getCachedJan1();</span>
<span class="fc" id="L427">            isLeap = isLeapYear(year);</span>
        } else {
            // Looking up FIXED_DATES[] here didn't improve performance
            // much. So we calculate year and jan1. getFixedDate()
            // will look up FIXED_DATES[] actually.
<span class="fc" id="L432">            year = getGregorianYearFromFixedDate(fixedDate);</span>
<span class="fc" id="L433">            jan1 = getFixedDate(year, JANUARY, 1, null);</span>
<span class="fc" id="L434">            isLeap = isLeapYear(year);</span>
            // Update the cache data
<span class="fc bfc" id="L436" title="All 2 branches covered.">            gdate.setCache (year, jan1, isLeap ? 366 : 365);</span>
        }

<span class="fc" id="L439">        int priorDays = (int)(fixedDate - jan1);</span>
<span class="fc" id="L440">        long mar1 = jan1 + 31 + 28;</span>
<span class="fc bfc" id="L441" title="All 2 branches covered.">        if (isLeap) {</span>
<span class="fc" id="L442">            ++mar1;</span>
        }
<span class="fc bfc" id="L444" title="All 2 branches covered.">        if (fixedDate &gt;= mar1) {</span>
<span class="fc bfc" id="L445" title="All 2 branches covered.">            priorDays += isLeap ? 1 : 2;</span>
        }
<span class="fc" id="L447">        int month = 12 * priorDays + 373;</span>
<span class="pc bpc" id="L448" title="1 of 2 branches missed.">        if (month &gt; 0) {</span>
<span class="fc" id="L449">            month /= 367;</span>
        } else {
<span class="nc" id="L451">            month = CalendarUtils.floorDivide(month, 367);</span>
        }
<span class="fc" id="L453">        long month1 = jan1 + ACCUMULATED_DAYS_IN_MONTH[month];</span>
<span class="fc bfc" id="L454" title="All 4 branches covered.">        if (isLeap &amp;&amp; month &gt;= MARCH) {</span>
<span class="fc" id="L455">            ++month1;</span>
        }
<span class="fc" id="L457">        int dayOfMonth = (int)(fixedDate - month1) + 1;</span>
<span class="fc" id="L458">        int dayOfWeek = getDayOfWeekFromFixedDate(fixedDate);</span>
<span class="pc bpc" id="L459" title="1 of 4 branches missed.">        assert dayOfWeek &gt; 0 : &quot;negative day of week &quot; + dayOfWeek;</span>
<span class="fc" id="L460">        gdate.setNormalizedYear(year);</span>
<span class="fc" id="L461">        gdate.setMonth(month);</span>
<span class="fc" id="L462">        gdate.setDayOfMonth(dayOfMonth);</span>
<span class="fc" id="L463">        gdate.setDayOfWeek(dayOfWeek);</span>
<span class="fc" id="L464">        gdate.setLeapYear(isLeap);</span>
<span class="fc" id="L465">        gdate.setNormalized(true);</span>
<span class="fc" id="L466">    }</span>

    /**
     * Returns the day of week of the given Gregorian date.
     */
    public int getDayOfWeek(CalendarDate date) {
<span class="fc" id="L472">        long fixedDate = getFixedDate(date);</span>
<span class="fc" id="L473">        return getDayOfWeekFromFixedDate(fixedDate);</span>
    }

    public static final int getDayOfWeekFromFixedDate(long fixedDate) {
        // The fixed day 1 (January 1, 1 Gregorian) is Monday.
<span class="fc bfc" id="L478" title="All 2 branches covered.">        if (fixedDate &gt;= 0) {</span>
<span class="fc" id="L479">            return (int)(fixedDate % 7) + SUNDAY;</span>
        }
<span class="fc" id="L481">        return (int)CalendarUtils.mod(fixedDate, 7) + SUNDAY;</span>
    }

    public int getYearFromFixedDate(long fixedDate) {
<span class="nc" id="L485">        return getGregorianYearFromFixedDate(fixedDate);</span>
    }

    /**
     * Returns the Gregorian year number of the given fixed date.
     */
    final int getGregorianYearFromFixedDate(long fixedDate) {
        long d0;
        int  d1, d2, d3, d4;
        int  n400, n100, n4, n1;
        int  year;

<span class="fc bfc" id="L497" title="All 2 branches covered.">        if (fixedDate &gt; 0) {</span>
<span class="fc" id="L498">            d0 = fixedDate - 1;</span>
<span class="fc" id="L499">            n400 = (int)(d0 / 146097);</span>
<span class="fc" id="L500">            d1 = (int)(d0 % 146097);</span>
<span class="fc" id="L501">            n100 = d1 / 36524;</span>
<span class="fc" id="L502">            d2 = d1 % 36524;</span>
<span class="fc" id="L503">            n4 = d2 / 1461;</span>
<span class="fc" id="L504">            d3 = d2 % 1461;</span>
<span class="fc" id="L505">            n1 = d3 / 365;</span>
<span class="fc" id="L506">            d4 = (d3 % 365) + 1;</span>
        } else {
<span class="fc" id="L508">            d0 = fixedDate - 1;</span>
<span class="fc" id="L509">            n400 = (int)CalendarUtils.floorDivide(d0, 146097L);</span>
<span class="fc" id="L510">            d1 = (int)CalendarUtils.mod(d0, 146097L);</span>
<span class="fc" id="L511">            n100 = CalendarUtils.floorDivide(d1, 36524);</span>
<span class="fc" id="L512">            d2 = CalendarUtils.mod(d1, 36524);</span>
<span class="fc" id="L513">            n4 = CalendarUtils.floorDivide(d2, 1461);</span>
<span class="fc" id="L514">            d3 = CalendarUtils.mod(d2, 1461);</span>
<span class="fc" id="L515">            n1 = CalendarUtils.floorDivide(d3, 365);</span>
<span class="fc" id="L516">            d4 = CalendarUtils.mod(d3, 365) + 1;</span>
        }
<span class="fc" id="L518">        year = 400 * n400 + 100 * n100 + 4 * n4 + n1;</span>
<span class="pc bpc" id="L519" title="1 of 4 branches missed.">        if (!(n100 == 4 || n1 == 4)) {</span>
<span class="fc" id="L520">            ++year;</span>
        }
<span class="fc" id="L522">        return year;</span>
    }

    /**
     * @return true if the specified year is a Gregorian leap year, or
     * false otherwise.
     * @see BaseCalendar#isGregorianLeapYear
     */
    protected boolean isLeapYear(CalendarDate date) {
<span class="fc" id="L531">        return isLeapYear(((Date)date).getNormalizedYear());</span>
    }

    boolean isLeapYear(int normalizedYear) {
<span class="fc" id="L535">        return CalendarUtils.isGregorianLeapYear(normalizedYear);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>