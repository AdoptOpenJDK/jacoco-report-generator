<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AWTUtilities.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.awt</a> &gt; <span class="el_source">AWTUtilities.java</span></div><h1>AWTUtilities.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2008, 2009, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.awt;

import java.awt.*;

import sun.awt.AWTAccessor;
import sun.awt.SunToolkit;

/**
 * A collection of utility methods for AWT.
 *
 * The functionality provided by the static methods of the class includes:
 * &lt;ul&gt;
 * &lt;li&gt;Setting shapes on top-level windows
 * &lt;li&gt;Setting a constant alpha value for each pixel of a top-level window
 * &lt;li&gt;Making a window non-opaque, after that it paints only explicitly
 * painted pixels on the screen, with arbitrary alpha values for every pixel.
 * &lt;li&gt;Setting a 'mixing-cutout' shape for a component.
 * &lt;/ul&gt;
 * &lt;p&gt;
 * A &quot;top-level window&quot; is an instance of the {@code Window} class (or its
 * descendant, such as {@code JFrame}).
 * &lt;p&gt;
 * Some of the mentioned features may not be supported by the native platform.
 * To determine whether a particular feature is supported, the user must use
 * the {@code isTranslucencySupported()} method of the class passing a desired
 * translucency kind (a member of the {@code Translucency} enum) as an
 * argument.
 * &lt;p&gt;
 * The per-pixel alpha feature also requires the user to create her/his
 * windows using a translucency-capable graphics configuration.
 * The {@code isTranslucencyCapable()} method must
 * be used to verify whether any given GraphicsConfiguration supports
 * the trasnlcency effects.
 * &lt;p&gt;
 * &lt;b&gt;WARNING&lt;/b&gt;: This class is an implementation detail and only meant
 * for limited use outside of the core platform. This API may change
 * drastically between update release, and it may even be
 * removed or be moved in some other package(s)/class(es).
 */
public final class AWTUtilities {

    /**
     * The AWTUtilities class should not be instantiated
     */
<span class="nc" id="L70">    private AWTUtilities() {</span>
<span class="nc" id="L71">    }</span>

    /** Kinds of translucency supported by the underlying system.
     *  @see #isTranslucencySupported
     */
<span class="nc" id="L76">    public static enum Translucency {</span>
        /**
         * Represents support in the underlying system for windows each pixel
         * of which is guaranteed to be either completely opaque, with
         * an alpha value of 1.0, or completely transparent, with an alpha
         * value of 0.0.
         */
<span class="nc" id="L83">        PERPIXEL_TRANSPARENT,</span>

        /**
         * Represents support in the underlying system for windows all of
         * the pixels of which have the same alpha value between or including
         * 0.0 and 1.0.
         */
<span class="nc" id="L90">        TRANSLUCENT,</span>

        /**
         * Represents support in the underlying system for windows that
         * contain or might contain pixels with arbitrary alpha values
         * between and including 0.0 and 1.0.
         */
<span class="nc" id="L97">        PERPIXEL_TRANSLUCENT;</span>
    }


    /**
     * Returns whether the given level of translucency is supported by
     * the underlying system.
     *
     * Note that this method may sometimes return the value
     * indicating that the particular level is supported, but
     * the native windowing system may still not support the
     * given level of translucency (due to the bugs in
     * the windowing system).
     *
     * @param translucencyKind a kind of translucency support
     *                         (either PERPIXEL_TRANSPARENT,
     *                         TRANSLUCENT, or PERPIXEL_TRANSLUCENT)
     * @return whether the given translucency kind is supported
     */
    public static boolean isTranslucencySupported(Translucency translucencyKind) {
<span class="nc bnc" id="L117" title="All 4 branches missed.">        switch (translucencyKind) {</span>
            case PERPIXEL_TRANSPARENT:
<span class="nc" id="L119">                return isWindowShapingSupported();</span>
            case TRANSLUCENT:
<span class="nc" id="L121">                return isWindowOpacitySupported();</span>
            case PERPIXEL_TRANSLUCENT:
<span class="nc" id="L123">                return isWindowTranslucencySupported();</span>
        }
<span class="nc" id="L125">        return false;</span>
    }


    /**
     * Returns whether the windowing system supports changing the opacity
     * value of top-level windows.
     * Note that this method may sometimes return true, but the native
     * windowing system may still not support the concept of
     * translucency (due to the bugs in the windowing system).
     */
    private static boolean isWindowOpacitySupported() {
<span class="nc" id="L137">        Toolkit curToolkit = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (!(curToolkit instanceof SunToolkit)) {</span>
<span class="nc" id="L139">            return false;</span>
        }
<span class="nc" id="L141">        return ((SunToolkit)curToolkit).isWindowOpacitySupported();</span>
    }

    /**
     * Set the opacity of the window. The opacity is at the range [0..1].
     * Note that setting the opacity level of 0 may or may not disable
     * the mouse event handling on this window. This is
     * a platform-dependent behavior.
     *
     * In order for this method to enable the translucency effect,
     * the isTranslucencySupported() method should indicate that the
     * TRANSLUCENT level of translucency is supported.
     *
     * &lt;p&gt;Also note that the window must not be in the full-screen mode
     * when setting the opacity value &amp;lt; 1.0f. Otherwise
     * the IllegalArgumentException is thrown.
     *
     * @param window the window to set the opacity level to
     * @param opacity the opacity level to set to the window
     * @throws NullPointerException if the window argument is null
     * @throws IllegalArgumentException if the opacity is out of
     *                                  the range [0..1]
     * @throws IllegalArgumentException if the window is in full screen mode,
     *                                  and the opacity is less than 1.0f
     * @throws UnsupportedOperationException if the TRANSLUCENT translucency
     *                                       kind is not supported
     */
    public static void setWindowOpacity(Window window, float opacity) {
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L170">            throw new NullPointerException(</span>
                    &quot;The window argument should not be null.&quot;);
        }

<span class="nc" id="L174">        AWTAccessor.getWindowAccessor().setOpacity(window, opacity);</span>
<span class="nc" id="L175">    }</span>

    /**
     * Get the opacity of the window. If the opacity has not
     * yet being set, this method returns 1.0.
     *
     * @param window the window to get the opacity level from
     * @throws NullPointerException if the window argument is null
     */
    public static float getWindowOpacity(Window window) {
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L186">            throw new NullPointerException(</span>
                    &quot;The window argument should not be null.&quot;);
        }

<span class="nc" id="L190">        return AWTAccessor.getWindowAccessor().getOpacity(window);</span>
    }

    /**
     * Returns whether the windowing system supports changing the shape
     * of top-level windows.
     * Note that this method may sometimes return true, but the native
     * windowing system may still not support the concept of
     * shaping (due to the bugs in the windowing system).
     */
    public static boolean isWindowShapingSupported() {
<span class="nc" id="L201">        Toolkit curToolkit = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">        if (!(curToolkit instanceof SunToolkit)) {</span>
<span class="nc" id="L203">            return false;</span>
        }
<span class="nc" id="L205">        return ((SunToolkit)curToolkit).isWindowShapingSupported();</span>
    }

    /**
     * Returns an object that implements the Shape interface and represents
     * the shape previously set with the call to the setWindowShape() method.
     * If no shape has been set yet, or the shape has been reset to null,
     * this method returns null.
     *
     * @param window the window to get the shape from
     * @return the current shape of the window
     * @throws NullPointerException if the window argument is null
     */
    public static Shape getWindowShape(Window window) {
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L220">            throw new NullPointerException(</span>
                    &quot;The window argument should not be null.&quot;);
        }
<span class="nc" id="L223">        return AWTAccessor.getWindowAccessor().getShape(window);</span>
    }

    /**
     * Sets a shape for the given window.
     * If the shape argument is null, this methods restores
     * the default shape making the window rectangular.
     * &lt;p&gt;Note that in order to set a shape, the window must be undecorated.
     * If the window is decorated, this method ignores the {@code shape}
     * argument and resets the shape to null.
     * &lt;p&gt;Also note that the window must not be in the full-screen mode
     * when setting a non-null shape. Otherwise the IllegalArgumentException
     * is thrown.
     * &lt;p&gt;Depending on the platform, the method may return without
     * effecting the shape of the window if the window has a non-null warning
     * string ({@link Window#getWarningString()}). In this case the passed
     * shape object is ignored.
     *
     * @param window the window to set the shape to
     * @param shape the shape to set to the window
     * @throws NullPointerException if the window argument is null
     * @throws IllegalArgumentException if the window is in full screen mode,
     *                                  and the shape is not null
     * @throws UnsupportedOperationException if the PERPIXEL_TRANSPARENT
     *                                       translucency kind is not supported
     */
    public static void setWindowShape(Window window, Shape shape) {
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L251">            throw new NullPointerException(</span>
                    &quot;The window argument should not be null.&quot;);
        }
<span class="nc" id="L254">        AWTAccessor.getWindowAccessor().setShape(window, shape);</span>
<span class="nc" id="L255">    }</span>

    private static boolean isWindowTranslucencySupported() {
        /*
         * Per-pixel alpha is supported if all the conditions are TRUE:
         *    1. The toolkit is a sort of SunToolkit
         *    2. The toolkit supports translucency in general
         *        (isWindowTranslucencySupported())
         *    3. There's at least one translucency-capable
         *        GraphicsConfiguration
         */

<span class="nc" id="L267">        Toolkit curToolkit = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">        if (!(curToolkit instanceof SunToolkit)) {</span>
<span class="nc" id="L269">            return false;</span>
        }

<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (!((SunToolkit)curToolkit).isWindowTranslucencySupported()) {</span>
<span class="nc" id="L273">            return false;</span>
        }

        GraphicsEnvironment env =
<span class="nc" id="L277">            GraphicsEnvironment.getLocalGraphicsEnvironment();</span>

        // If the default GC supports translucency return true.
        // It is important to optimize the verification this way,
        // see CR 6661196 for more details.
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (isTranslucencyCapable(env.getDefaultScreenDevice()</span>
<span class="nc" id="L283">                    .getDefaultConfiguration()))</span>
        {
<span class="nc" id="L285">            return true;</span>
        }

        // ... otherwise iterate through all the GCs.
<span class="nc" id="L289">        GraphicsDevice[] devices = env.getScreenDevices();</span>

<span class="nc bnc" id="L291" title="All 2 branches missed.">        for (int i = 0; i &lt; devices.length; i++) {</span>
<span class="nc" id="L292">            GraphicsConfiguration[] configs = devices[i].getConfigurations();</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">            for (int j = 0; j &lt; configs.length; j++) {</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">                if (isTranslucencyCapable(configs[j])) {</span>
<span class="nc" id="L295">                    return true;</span>
                }
            }
        }

<span class="nc" id="L300">        return false;</span>
    }

    /**
     * Enables the per-pixel alpha support for the given window.
     * Once the window becomes non-opaque (the isOpaque is set to false),
     * the drawing sub-system is starting to respect the alpha value of each
     * separate pixel. If a pixel gets painted with alpha color component
     * equal to zero, it becomes visually transparent, if the alpha of the
     * pixel is equal to 255, the pixel is fully opaque. Interim values
     * of the alpha color component make the pixel semi-transparent (i.e.
     * translucent).
     * &lt;p&gt;Note that in order for the window to support the per-pixel alpha
     * mode, the window must be created using the GraphicsConfiguration
     * for which the {@link #isTranslucencyCapable}
     * method returns true.
     * &lt;p&gt;Also note that some native systems enable the per-pixel translucency
     * mode for any window created using the translucency-compatible
     * graphics configuration. However, it is highly recommended to always
     * invoke the setWindowOpaque() method for these windows, at least for
     * the sake of cross-platform compatibility reasons.
     * &lt;p&gt;Also note that the window must not be in the full-screen mode
     * when making it non-opaque. Otherwise the IllegalArgumentException
     * is thrown.
     * &lt;p&gt;If the window is a {@code Frame} or a {@code Dialog}, the window must
     * be undecorated prior to enabling the per-pixel translucency effect (see
     * {@link Frame#setUndecorated()} and/or {@link Dialog#setUndecorated()}).
     * If the window becomes decorated through a subsequent call to the
     * corresponding {@code setUndecorated()} method, the per-pixel
     * translucency effect will be disabled and the opaque property reset to
     * {@code true}.
     * &lt;p&gt;Depending on the platform, the method may return without
     * effecting the opaque property of the window if the window has a non-null
     * warning string ({@link Window#getWarningString()}). In this case
     * the passed 'isOpaque' value is ignored.
     *
     * @param window the window to set the shape to
     * @param isOpaque whether the window must be opaque (true),
     *                 or translucent (false)
     * @throws NullPointerException if the window argument is null
     * @throws IllegalArgumentException if the window uses
     *                                  a GraphicsConfiguration for which the
     *                                  {@code isTranslucencyCapable()}
     *                                  method returns false
     * @throws IllegalArgumentException if the window is in full screen mode,
     *                                  and the isOpaque is false
     * @throws IllegalArgumentException if the window is decorated and the
     * isOpaque argument is {@code false}.
     * @throws UnsupportedOperationException if the PERPIXEL_TRANSLUCENT
     *                                       translucency kind is not supported
     */
    public static void setWindowOpaque(Window window, boolean isOpaque) {
<span class="nc bnc" id="L352" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L353">            throw new NullPointerException(</span>
                    &quot;The window argument should not be null.&quot;);
        }
<span class="nc bnc" id="L356" title="All 4 branches missed.">        if (!isOpaque &amp;&amp; !isTranslucencySupported(Translucency.PERPIXEL_TRANSLUCENT)) {</span>
<span class="nc" id="L357">            throw new UnsupportedOperationException(</span>
                    &quot;The PERPIXEL_TRANSLUCENT translucency kind is not supported&quot;);
        }
<span class="nc" id="L360">        AWTAccessor.getWindowAccessor().setOpaque(window, isOpaque);</span>
<span class="nc" id="L361">    }</span>

    /**
     * Returns whether the window is opaque or translucent.
     *
     * @param window the window to set the shape to
     * @return whether the window is currently opaque (true)
     *         or translucent (false)
     * @throws NullPointerException if the window argument is null
     */
    public static boolean isWindowOpaque(Window window) {
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L373">            throw new NullPointerException(</span>
                    &quot;The window argument should not be null.&quot;);
        }

<span class="nc" id="L377">        return window.isOpaque();</span>
    }

    /**
     * Verifies whether a given GraphicsConfiguration supports
     * the PERPIXEL_TRANSLUCENT kind of translucency.
     * All windows that are intended to be used with the {@link #setWindowOpaque}
     * method must be created using a GraphicsConfiguration for which this method
     * returns true.
     * &lt;p&gt;Note that some native systems enable the per-pixel translucency
     * mode for any window created using a translucency-capable
     * graphics configuration. However, it is highly recommended to always
     * invoke the setWindowOpaque() method for these windows, at least
     * for the sake of cross-platform compatibility reasons.
     *
     * @param gc GraphicsConfiguration
     * @throws NullPointerException if the gc argument is null
     * @return whether the given GraphicsConfiguration supports
     *         the translucency effects.
     */
    public static boolean isTranslucencyCapable(GraphicsConfiguration gc) {
<span class="nc bnc" id="L398" title="All 2 branches missed.">        if (gc == null) {</span>
<span class="nc" id="L399">            throw new NullPointerException(&quot;The gc argument should not be null&quot;);</span>
        }
        /*
        return gc.isTranslucencyCapable();
        */
<span class="nc" id="L404">        Toolkit curToolkit = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (!(curToolkit instanceof SunToolkit)) {</span>
<span class="nc" id="L406">            return false;</span>
        }
<span class="nc" id="L408">        return ((SunToolkit)curToolkit).isTranslucencyCapable(gc);</span>
    }

    /**
     * Sets a 'mixing-cutout' shape for the given component.
     *
     * By default a lightweight component is treated as an opaque rectangle for
     * the purposes of the Heavyweight/Lightweight Components Mixing feature.
     * This method enables developers to set an arbitrary shape to be cut out
     * from heavyweight components positioned underneath the lightweight
     * component in the z-order.
     * &lt;p&gt;
     * The {@code shape} argument may have the following values:
     * &lt;ul&gt;
     * &lt;li&gt;{@code null} - reverts the default cutout shape (the rectangle equal
     * to the component's {@code getBounds()})
     * &lt;li&gt;&lt;i&gt;empty-shape&lt;/i&gt; - does not cut out anything from heavyweight
     * components. This makes the given lightweight component effectively
     * transparent. Note that descendants of the lightweight component still
     * affect the shapes of heavyweight components.  An example of an
     * &lt;i&gt;empty-shape&lt;/i&gt; is {@code new Rectangle()}.
     * &lt;li&gt;&lt;i&gt;non-empty-shape&lt;/i&gt; - the given shape will be cut out from
     * heavyweight components.
     * &lt;/ul&gt;
     * &lt;p&gt;
     * The most common example when the 'mixing-cutout' shape is needed is a
     * glass pane component. The {@link JRootPane#setGlassPane()} method
     * automatically sets the &lt;i&gt;empty-shape&lt;/i&gt; as the 'mixing-cutout' shape
     * for the given glass pane component.  If a developer needs some other
     * 'mixing-cutout' shape for the glass pane (which is rare), this must be
     * changed manually after installing the glass pane to the root pane.
     * &lt;p&gt;
     * Note that the 'mixing-cutout' shape neither affects painting, nor the
     * mouse events handling for the given component. It is used exclusively
     * for the purposes of the Heavyweight/Lightweight Components Mixing
     * feature.
     *
     * @param component the component that needs non-default
     * 'mixing-cutout' shape
     * @param shape the new 'mixing-cutout' shape
     * @throws NullPointerException if the component argument is {@code null}
     */
    public static void setComponentMixingCutoutShape(Component component,
            Shape shape)
    {
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (component == null) {</span>
<span class="nc" id="L454">            throw new NullPointerException(</span>
                    &quot;The component argument should not be null.&quot;);
        }

<span class="nc" id="L458">        AWTAccessor.getComponentAccessor().setMixingCutoutShape(component,</span>
                shape);
<span class="nc" id="L460">    }</span>
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>