<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>TransformingPathConsumer2D.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.java2d.pisces</a> &gt; <span class="el_source">TransformingPathConsumer2D.java</span></div><h1>TransformingPathConsumer2D.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2007, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.java2d.pisces;

import sun.awt.geom.PathConsumer2D;
import java.awt.geom.AffineTransform;

<span class="nc" id="L31">final class TransformingPathConsumer2D {</span>
    public static PathConsumer2D
        transformConsumer(PathConsumer2D out,
                          AffineTransform at)
    {
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if (at == null) {</span>
<span class="nc" id="L37">            return out;</span>
        }
<span class="nc" id="L39">        float Mxx = (float) at.getScaleX();</span>
<span class="nc" id="L40">        float Mxy = (float) at.getShearX();</span>
<span class="nc" id="L41">        float Mxt = (float) at.getTranslateX();</span>
<span class="nc" id="L42">        float Myx = (float) at.getShearY();</span>
<span class="nc" id="L43">        float Myy = (float) at.getScaleY();</span>
<span class="nc" id="L44">        float Myt = (float) at.getTranslateY();</span>
<span class="nc bnc" id="L45" title="All 4 branches missed.">        if (Mxy == 0f &amp;&amp; Myx == 0f) {</span>
<span class="nc bnc" id="L46" title="All 4 branches missed.">            if (Mxx == 1f &amp;&amp; Myy == 1f) {</span>
<span class="nc bnc" id="L47" title="All 4 branches missed.">                if (Mxt == 0f &amp;&amp; Myt == 0f) {</span>
<span class="nc" id="L48">                    return out;</span>
                } else {
<span class="nc" id="L50">                    return new TranslateFilter(out, Mxt, Myt);</span>
                }
            } else {
<span class="nc bnc" id="L53" title="All 4 branches missed.">                if (Mxt == 0f &amp;&amp; Myt == 0f) {</span>
<span class="nc" id="L54">                    return new DeltaScaleFilter(out, Mxx, Myy);</span>
                } else {
<span class="nc" id="L56">                    return new ScaleFilter(out, Mxx, Myy, Mxt, Myt);</span>
                }
            }
<span class="nc bnc" id="L59" title="All 4 branches missed.">        } else if (Mxt == 0f &amp;&amp; Myt == 0f) {</span>
<span class="nc" id="L60">            return new DeltaTransformFilter(out, Mxx, Mxy, Myx, Myy);</span>
        } else {
<span class="nc" id="L62">            return new TransformFilter(out, Mxx, Mxy, Mxt, Myx, Myy, Myt);</span>
        }
    }

    public static PathConsumer2D
        deltaTransformConsumer(PathConsumer2D out,
                               AffineTransform at)
    {
<span class="nc bnc" id="L70" title="All 2 branches missed.">        if (at == null) {</span>
<span class="nc" id="L71">            return out;</span>
        }
<span class="nc" id="L73">        float Mxx = (float) at.getScaleX();</span>
<span class="nc" id="L74">        float Mxy = (float) at.getShearX();</span>
<span class="nc" id="L75">        float Myx = (float) at.getShearY();</span>
<span class="nc" id="L76">        float Myy = (float) at.getScaleY();</span>
<span class="nc bnc" id="L77" title="All 4 branches missed.">        if (Mxy == 0f &amp;&amp; Myx == 0f) {</span>
<span class="nc bnc" id="L78" title="All 4 branches missed.">            if (Mxx == 1f &amp;&amp; Myy == 1f) {</span>
<span class="nc" id="L79">                return out;</span>
            } else {
<span class="nc" id="L81">                return new DeltaScaleFilter(out, Mxx, Myy);</span>
            }
        } else {
<span class="nc" id="L84">            return new DeltaTransformFilter(out, Mxx, Mxy, Myx, Myy);</span>
        }
    }

    public static PathConsumer2D
        inverseDeltaTransformConsumer(PathConsumer2D out,
                                      AffineTransform at)
    {
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (at == null) {</span>
<span class="nc" id="L93">            return out;</span>
        }
<span class="nc" id="L95">        float Mxx = (float) at.getScaleX();</span>
<span class="nc" id="L96">        float Mxy = (float) at.getShearX();</span>
<span class="nc" id="L97">        float Myx = (float) at.getShearY();</span>
<span class="nc" id="L98">        float Myy = (float) at.getScaleY();</span>
<span class="nc bnc" id="L99" title="All 4 branches missed.">        if (Mxy == 0f &amp;&amp; Myx == 0f) {</span>
<span class="nc bnc" id="L100" title="All 4 branches missed.">            if (Mxx == 1f &amp;&amp; Myy == 1f) {</span>
<span class="nc" id="L101">                return out;</span>
            } else {
<span class="nc" id="L103">                return new DeltaScaleFilter(out, 1.0f/Mxx, 1.0f/Myy);</span>
            }
        } else {
<span class="nc" id="L106">            float det = Mxx * Myy - Mxy * Myx;</span>
<span class="nc" id="L107">            return new DeltaTransformFilter(out,</span>
                                            Myy / det,
                                            -Mxy / det,
                                            -Myx / det,
                                            Mxx / det);
        }
    }

    static final class TranslateFilter implements PathConsumer2D {
        private final PathConsumer2D out;
        private final float tx;
        private final float ty;

        TranslateFilter(PathConsumer2D out,
                        float tx, float ty)
<span class="nc" id="L122">        {</span>
<span class="nc" id="L123">            this.out = out;</span>
<span class="nc" id="L124">            this.tx = tx;</span>
<span class="nc" id="L125">            this.ty = ty;</span>
<span class="nc" id="L126">        }</span>

        public void moveTo(float x0, float y0) {
<span class="nc" id="L129">            out.moveTo(x0 + tx, y0 + ty);</span>
<span class="nc" id="L130">        }</span>

        public void lineTo(float x1, float y1) {
<span class="nc" id="L133">            out.lineTo(x1 + tx, y1 + ty);</span>
<span class="nc" id="L134">        }</span>

        public void quadTo(float x1, float y1,
                           float x2, float y2)
        {
<span class="nc" id="L139">            out.quadTo(x1 + tx, y1 + ty,</span>
                       x2 + tx, y2 + ty);
<span class="nc" id="L141">        }</span>

        public void curveTo(float x1, float y1,
                            float x2, float y2,
                            float x3, float y3)
        {
<span class="nc" id="L147">            out.curveTo(x1 + tx, y1 + ty,</span>
                        x2 + tx, y2 + ty,
                        x3 + tx, y3 + ty);
<span class="nc" id="L150">        }</span>

        public void closePath() {
<span class="nc" id="L153">            out.closePath();</span>
<span class="nc" id="L154">        }</span>

        public void pathDone() {
<span class="nc" id="L157">            out.pathDone();</span>
<span class="nc" id="L158">        }</span>

        public long getNativeConsumer() {
<span class="nc" id="L161">            return 0;</span>
        }
    }

    static final class ScaleFilter implements PathConsumer2D {
        private final PathConsumer2D out;
        private final float sx;
        private final float sy;
        private final float tx;
        private final float ty;

        ScaleFilter(PathConsumer2D out,
                    float sx, float sy, float tx, float ty)
<span class="nc" id="L174">        {</span>
<span class="nc" id="L175">            this.out = out;</span>
<span class="nc" id="L176">            this.sx = sx;</span>
<span class="nc" id="L177">            this.sy = sy;</span>
<span class="nc" id="L178">            this.tx = tx;</span>
<span class="nc" id="L179">            this.ty = ty;</span>
<span class="nc" id="L180">        }</span>

        public void moveTo(float x0, float y0) {
<span class="nc" id="L183">            out.moveTo(x0 * sx + tx, y0 * sy + ty);</span>
<span class="nc" id="L184">        }</span>

        public void lineTo(float x1, float y1) {
<span class="nc" id="L187">            out.lineTo(x1 * sx + tx, y1 * sy + ty);</span>
<span class="nc" id="L188">        }</span>

        public void quadTo(float x1, float y1,
                           float x2, float y2)
        {
<span class="nc" id="L193">            out.quadTo(x1 * sx + tx, y1 * sy + ty,</span>
                       x2 * sx + tx, y2 * sy + ty);
<span class="nc" id="L195">        }</span>

        public void curveTo(float x1, float y1,
                            float x2, float y2,
                            float x3, float y3)
        {
<span class="nc" id="L201">            out.curveTo(x1 * sx + tx, y1 * sy + ty,</span>
                        x2 * sx + tx, y2 * sy + ty,
                        x3 * sx + tx, y3 * sy + ty);
<span class="nc" id="L204">        }</span>

        public void closePath() {
<span class="nc" id="L207">            out.closePath();</span>
<span class="nc" id="L208">        }</span>

        public void pathDone() {
<span class="nc" id="L211">            out.pathDone();</span>
<span class="nc" id="L212">        }</span>

        public long getNativeConsumer() {
<span class="nc" id="L215">            return 0;</span>
        }
    }

    static final class TransformFilter implements PathConsumer2D {
        private final PathConsumer2D out;
        private final float Mxx;
        private final float Mxy;
        private final float Mxt;
        private final float Myx;
        private final float Myy;
        private final float Myt;

        TransformFilter(PathConsumer2D out,
                        float Mxx, float Mxy, float Mxt,
                        float Myx, float Myy, float Myt)
<span class="nc" id="L231">        {</span>
<span class="nc" id="L232">            this.out = out;</span>
<span class="nc" id="L233">            this.Mxx = Mxx;</span>
<span class="nc" id="L234">            this.Mxy = Mxy;</span>
<span class="nc" id="L235">            this.Mxt = Mxt;</span>
<span class="nc" id="L236">            this.Myx = Myx;</span>
<span class="nc" id="L237">            this.Myy = Myy;</span>
<span class="nc" id="L238">            this.Myt = Myt;</span>
<span class="nc" id="L239">        }</span>

        public void moveTo(float x0, float y0) {
<span class="nc" id="L242">            out.moveTo(x0 * Mxx + y0 * Mxy + Mxt,</span>
                       x0 * Myx + y0 * Myy + Myt);
<span class="nc" id="L244">        }</span>

        public void lineTo(float x1, float y1) {
<span class="nc" id="L247">            out.lineTo(x1 * Mxx + y1 * Mxy + Mxt,</span>
                       x1 * Myx + y1 * Myy + Myt);
<span class="nc" id="L249">        }</span>

        public void quadTo(float x1, float y1,
                           float x2, float y2)
        {
<span class="nc" id="L254">            out.quadTo(x1 * Mxx + y1 * Mxy + Mxt,</span>
                       x1 * Myx + y1 * Myy + Myt,
                       x2 * Mxx + y2 * Mxy + Mxt,
                       x2 * Myx + y2 * Myy + Myt);
<span class="nc" id="L258">        }</span>

        public void curveTo(float x1, float y1,
                            float x2, float y2,
                            float x3, float y3)
        {
<span class="nc" id="L264">            out.curveTo(x1 * Mxx + y1 * Mxy + Mxt,</span>
                        x1 * Myx + y1 * Myy + Myt,
                        x2 * Mxx + y2 * Mxy + Mxt,
                        x2 * Myx + y2 * Myy + Myt,
                        x3 * Mxx + y3 * Mxy + Mxt,
                        x3 * Myx + y3 * Myy + Myt);
<span class="nc" id="L270">        }</span>

        public void closePath() {
<span class="nc" id="L273">            out.closePath();</span>
<span class="nc" id="L274">        }</span>

        public void pathDone() {
<span class="nc" id="L277">            out.pathDone();</span>
<span class="nc" id="L278">        }</span>

        public long getNativeConsumer() {
<span class="nc" id="L281">            return 0;</span>
        }
    }

    static final class DeltaScaleFilter implements PathConsumer2D {
        private final float sx, sy;
        private final PathConsumer2D out;

<span class="nc" id="L289">        public DeltaScaleFilter(PathConsumer2D out, float Mxx, float Myy) {</span>
<span class="nc" id="L290">            sx = Mxx;</span>
<span class="nc" id="L291">            sy = Myy;</span>
<span class="nc" id="L292">            this.out = out;</span>
<span class="nc" id="L293">        }</span>

        public void moveTo(float x0, float y0) {
<span class="nc" id="L296">            out.moveTo(x0 * sx, y0 * sy);</span>
<span class="nc" id="L297">        }</span>

        public void lineTo(float x1, float y1) {
<span class="nc" id="L300">            out.lineTo(x1 * sx, y1 * sy);</span>
<span class="nc" id="L301">        }</span>

        public void quadTo(float x1, float y1,
                           float x2, float y2)
        {
<span class="nc" id="L306">            out.quadTo(x1 * sx, y1 * sy,</span>
                       x2 * sx, y2 * sy);
<span class="nc" id="L308">        }</span>

        public void curveTo(float x1, float y1,
                            float x2, float y2,
                            float x3, float y3)
        {
<span class="nc" id="L314">            out.curveTo(x1 * sx, y1 * sy,</span>
                        x2 * sx, y2 * sy,
                        x3 * sx, y3 * sy);
<span class="nc" id="L317">        }</span>

        public void closePath() {
<span class="nc" id="L320">            out.closePath();</span>
<span class="nc" id="L321">        }</span>

        public void pathDone() {
<span class="nc" id="L324">            out.pathDone();</span>
<span class="nc" id="L325">        }</span>

        public long getNativeConsumer() {
<span class="nc" id="L328">            return 0;</span>
        }
    }

<span class="nc" id="L332">    static final class DeltaTransformFilter implements PathConsumer2D {</span>
        private PathConsumer2D out;
        private final float Mxx;
        private final float Mxy;
        private final float Myx;
        private final float Myy;

        DeltaTransformFilter(PathConsumer2D out,
                             float Mxx, float Mxy,
                             float Myx, float Myy)
<span class="nc" id="L342">        {</span>
<span class="nc" id="L343">            this.out = out;</span>
<span class="nc" id="L344">            this.Mxx = Mxx;</span>
<span class="nc" id="L345">            this.Mxy = Mxy;</span>
<span class="nc" id="L346">            this.Myx = Myx;</span>
<span class="nc" id="L347">            this.Myy = Myy;</span>
<span class="nc" id="L348">        }</span>

        public void moveTo(float x0, float y0) {
<span class="nc" id="L351">            out.moveTo(x0 * Mxx + y0 * Mxy,</span>
                       x0 * Myx + y0 * Myy);
<span class="nc" id="L353">        }</span>

        public void lineTo(float x1, float y1) {
<span class="nc" id="L356">            out.lineTo(x1 * Mxx + y1 * Mxy,</span>
                       x1 * Myx + y1 * Myy);
<span class="nc" id="L358">        }</span>

        public void quadTo(float x1, float y1,
                           float x2, float y2)
        {
<span class="nc" id="L363">            out.quadTo(x1 * Mxx + y1 * Mxy,</span>
                       x1 * Myx + y1 * Myy,
                       x2 * Mxx + y2 * Mxy,
                       x2 * Myx + y2 * Myy);
<span class="nc" id="L367">        }</span>

        public void curveTo(float x1, float y1,
                            float x2, float y2,
                            float x3, float y3)
        {
<span class="nc" id="L373">            out.curveTo(x1 * Mxx + y1 * Mxy,</span>
                        x1 * Myx + y1 * Myy,
                        x2 * Mxx + y2 * Mxy,
                        x2 * Myx + y2 * Myy,
                        x3 * Mxx + y3 * Mxy,
                        x3 * Myx + y3 * Myy);
<span class="nc" id="L379">        }</span>

        public void closePath() {
<span class="nc" id="L382">            out.closePath();</span>
<span class="nc" id="L383">        }</span>

        public void pathDone() {
<span class="nc" id="L386">            out.pathDone();</span>
<span class="nc" id="L387">        }</span>

        public long getNativeConsumer() {
<span class="nc" id="L390">            return 0;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>