<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MBeanServerAccessController.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.jmx.remote.security</a> &gt; <span class="el_source">MBeanServerAccessController.java</span></div><h1>MBeanServerAccessController.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.jmx.remote.security;

import com.sun.jmx.mbeanserver.GetPropertyAction;
import java.io.ObjectInputStream;
import java.security.AccessController;
import java.util.Set;
import javax.management.Attribute;
import javax.management.AttributeList;
import javax.management.AttributeNotFoundException;
import javax.management.InstanceNotFoundException;
import javax.management.InstanceAlreadyExistsException;
import javax.management.IntrospectionException;
import javax.management.InvalidAttributeValueException;
import javax.management.ListenerNotFoundException;
import javax.management.MBeanException;
import javax.management.MBeanInfo;
import javax.management.MBeanRegistrationException;
import javax.management.MBeanServer;
import javax.management.NotCompliantMBeanException;
import javax.management.NotificationFilter;
import javax.management.NotificationListener;
import javax.management.ObjectInstance;
import javax.management.ObjectName;
import javax.management.OperationsException;
import javax.management.QueryExp;
import javax.management.ReflectionException;
import javax.management.loading.ClassLoaderRepository;
import javax.management.remote.MBeanServerForwarder;

/**
 * &lt;p&gt;An object of this class implements the MBeanServer interface
 * and, for each of its methods, calls an appropriate checking method
 * and then forwards the request to a wrapped MBeanServer object.  The
 * checking method may throw a RuntimeException if the operation is
 * not allowed; in this case the request is not forwarded to the
 * wrapped object.&lt;/p&gt;
 *
 * &lt;p&gt;A typical use of this class is to insert it between a connector server
 * such as the RMI connector and the MBeanServer with which the connector
 * is associated.  Requests from the connector client can then be filtered
 * and those operations that are not allowed, or not allowed in a particular
 * context, can be rejected by throwing a &lt;code&gt;SecurityException&lt;/code&gt;
 * in the corresponding &lt;code&gt;check*&lt;/code&gt; method.&lt;/p&gt;
 *
 * &lt;p&gt;This is an abstract class, because in its implementation none of
 * the checking methods does anything.  To be useful, it must be
 * subclassed and at least one of the checking methods overridden to
 * do some checking.  Some or all of the MBeanServer methods may also
 * be overridden, for instance if the default checking behavior is
 * inappropriate.&lt;/p&gt;
 *
 * &lt;p&gt;If there is no SecurityManager, then the access controller will refuse
 * to create an MBean that is a ClassLoader, which includes MLets, or to
 * execute the method addURL on an MBean that is an MLet. This prevents
 * people from opening security holes unintentionally. Otherwise, it
 * would not be obvious that granting write access grants the ability to
 * download and execute arbitrary code in the target MBean server. Advanced
 * users who do want the ability to use MLets are presumably advanced enough
 * to handle policy files and security managers.&lt;/p&gt;
 */
<span class="nc" id="L86">public abstract class MBeanServerAccessController</span>
        implements MBeanServerForwarder {

    public MBeanServer getMBeanServer() {
<span class="nc" id="L90">        return mbs;</span>
    }

    public void setMBeanServer(MBeanServer mbs) {
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (mbs == null)</span>
<span class="nc" id="L95">            throw new IllegalArgumentException(&quot;Null MBeanServer&quot;);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (this.mbs != null)</span>
<span class="nc" id="L97">            throw new IllegalArgumentException(&quot;MBeanServer object already &quot; +</span>
                                               &quot;initialized&quot;);
<span class="nc" id="L99">        this.mbs = mbs;</span>
<span class="nc" id="L100">    }</span>

    /**
     * Check if the caller can do read operations. This method does
     * nothing if so, otherwise throws SecurityException.
     */
    protected abstract void checkRead();

    /**
     * Check if the caller can do write operations.  This method does
     * nothing if so, otherwise throws SecurityException.
     */
    protected abstract void checkWrite();

    /**
     * Check if the caller can create the named class.  The default
     * implementation of this method calls {@link #checkWrite()}.
     */
    protected void checkCreate(String className) {
<span class="nc" id="L119">        checkWrite();</span>
<span class="nc" id="L120">    }</span>

    /**
     * Check if the caller can unregister the named MBean.  The default
     * implementation of this method calls {@link #checkWrite()}.
     */
    protected void checkUnregister(ObjectName name) {
<span class="nc" id="L127">        checkWrite();</span>
<span class="nc" id="L128">    }</span>

    //--------------------------------------------
    //--------------------------------------------
    //
    // Implementation of the MBeanServer interface
    //
    //--------------------------------------------
    //--------------------------------------------

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void addNotificationListener(ObjectName name,
                                        NotificationListener listener,
                                        NotificationFilter filter,
                                        Object handback)
        throws InstanceNotFoundException {
<span class="nc" id="L147">        checkRead();</span>
<span class="nc" id="L148">        getMBeanServer().addNotificationListener(name, listener,</span>
                                                 filter, handback);
<span class="nc" id="L150">    }</span>

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void addNotificationListener(ObjectName name,
                                        ObjectName listener,
                                        NotificationFilter filter,
                                        Object handback)
        throws InstanceNotFoundException {
<span class="nc" id="L161">        checkRead();</span>
<span class="nc" id="L162">        getMBeanServer().addNotificationListener(name, listener,</span>
                                                 filter, handback);
<span class="nc" id="L164">    }</span>

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ObjectInstance createMBean(String className, ObjectName name)
        throws
        ReflectionException,
        InstanceAlreadyExistsException,
        MBeanRegistrationException,
        MBeanException,
        NotCompliantMBeanException {
<span class="nc" id="L177">        checkCreate(className);</span>
<span class="nc" id="L178">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">        if (sm == null) {</span>
<span class="nc" id="L180">            Object object = getMBeanServer().instantiate(className);</span>
<span class="nc" id="L181">            checkClassLoader(object);</span>
<span class="nc" id="L182">            return getMBeanServer().registerMBean(object, name);</span>
        } else {
<span class="nc" id="L184">            return getMBeanServer().createMBean(className, name);</span>
        }
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ObjectInstance createMBean(String className, ObjectName name,
                                      Object params[], String signature[])
        throws
        ReflectionException,
        InstanceAlreadyExistsException,
        MBeanRegistrationException,
        MBeanException,
        NotCompliantMBeanException {
<span class="nc" id="L200">        checkCreate(className);</span>
<span class="nc" id="L201">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">        if (sm == null) {</span>
<span class="nc" id="L203">            Object object = getMBeanServer().instantiate(className,</span>
                                                         params,
                                                         signature);
<span class="nc" id="L206">            checkClassLoader(object);</span>
<span class="nc" id="L207">            return getMBeanServer().registerMBean(object, name);</span>
        } else {
<span class="nc" id="L209">            return getMBeanServer().createMBean(className, name,</span>
                                                params, signature);
        }
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ObjectInstance createMBean(String className,
                                      ObjectName name,
                                      ObjectName loaderName)
        throws
        ReflectionException,
        InstanceAlreadyExistsException,
        MBeanRegistrationException,
        MBeanException,
        NotCompliantMBeanException,
        InstanceNotFoundException {
<span class="nc" id="L228">        checkCreate(className);</span>
<span class="nc" id="L229">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">        if (sm == null) {</span>
<span class="nc" id="L231">            Object object = getMBeanServer().instantiate(className,</span>
                                                         loaderName);
<span class="nc" id="L233">            checkClassLoader(object);</span>
<span class="nc" id="L234">            return getMBeanServer().registerMBean(object, name);</span>
        } else {
<span class="nc" id="L236">            return getMBeanServer().createMBean(className, name, loaderName);</span>
        }
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ObjectInstance createMBean(String className,
                                      ObjectName name,
                                      ObjectName loaderName,
                                      Object params[],
                                      String signature[])
        throws
        ReflectionException,
        InstanceAlreadyExistsException,
        MBeanRegistrationException,
        MBeanException,
        NotCompliantMBeanException,
        InstanceNotFoundException {
<span class="nc" id="L256">        checkCreate(className);</span>
<span class="nc" id="L257">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (sm == null) {</span>
<span class="nc" id="L259">            Object object = getMBeanServer().instantiate(className,</span>
                                                         loaderName,
                                                         params,
                                                         signature);
<span class="nc" id="L263">            checkClassLoader(object);</span>
<span class="nc" id="L264">            return getMBeanServer().registerMBean(object, name);</span>
        } else {
<span class="nc" id="L266">            return getMBeanServer().createMBean(className, name, loaderName,</span>
                                                params, signature);
        }
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    @Deprecated
    public ObjectInputStream deserialize(ObjectName name, byte[] data)
        throws InstanceNotFoundException, OperationsException {
<span class="nc" id="L278">        checkRead();</span>
<span class="nc" id="L279">        return getMBeanServer().deserialize(name, data);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    @Deprecated
    public ObjectInputStream deserialize(String className, byte[] data)
        throws OperationsException, ReflectionException {
<span class="nc" id="L289">        checkRead();</span>
<span class="nc" id="L290">        return getMBeanServer().deserialize(className, data);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    @Deprecated
    public ObjectInputStream deserialize(String className,
                                         ObjectName loaderName,
                                         byte[] data)
        throws
        InstanceNotFoundException,
        OperationsException,
        ReflectionException {
<span class="nc" id="L305">        checkRead();</span>
<span class="nc" id="L306">        return getMBeanServer().deserialize(className, loaderName, data);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Object getAttribute(ObjectName name, String attribute)
        throws
        MBeanException,
        AttributeNotFoundException,
        InstanceNotFoundException,
        ReflectionException {
<span class="nc" id="L319">        checkRead();</span>
<span class="nc" id="L320">        return getMBeanServer().getAttribute(name, attribute);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public AttributeList getAttributes(ObjectName name, String[] attributes)
        throws InstanceNotFoundException, ReflectionException {
<span class="nc" id="L329">        checkRead();</span>
<span class="nc" id="L330">        return getMBeanServer().getAttributes(name, attributes);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ClassLoader getClassLoader(ObjectName loaderName)
        throws InstanceNotFoundException {
<span class="nc" id="L339">        checkRead();</span>
<span class="nc" id="L340">        return getMBeanServer().getClassLoader(loaderName);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ClassLoader getClassLoaderFor(ObjectName mbeanName)
        throws InstanceNotFoundException {
<span class="nc" id="L349">        checkRead();</span>
<span class="nc" id="L350">        return getMBeanServer().getClassLoaderFor(mbeanName);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ClassLoaderRepository getClassLoaderRepository() {
<span class="nc" id="L358">        checkRead();</span>
<span class="nc" id="L359">        return getMBeanServer().getClassLoaderRepository();</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public String getDefaultDomain() {
<span class="nc" id="L367">        checkRead();</span>
<span class="nc" id="L368">        return getMBeanServer().getDefaultDomain();</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public String[] getDomains() {
<span class="nc" id="L376">        checkRead();</span>
<span class="nc" id="L377">        return getMBeanServer().getDomains();</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Integer getMBeanCount() {
<span class="nc" id="L385">        checkRead();</span>
<span class="nc" id="L386">        return getMBeanServer().getMBeanCount();</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public MBeanInfo getMBeanInfo(ObjectName name)
        throws
        InstanceNotFoundException,
        IntrospectionException,
        ReflectionException {
<span class="nc" id="L398">        checkRead();</span>
<span class="nc" id="L399">        return getMBeanServer().getMBeanInfo(name);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ObjectInstance getObjectInstance(ObjectName name)
        throws InstanceNotFoundException {
<span class="nc" id="L408">        checkRead();</span>
<span class="nc" id="L409">        return getMBeanServer().getObjectInstance(name);</span>
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Object instantiate(String className)
        throws ReflectionException, MBeanException {
<span class="nc" id="L418">        checkCreate(className);</span>
<span class="nc" id="L419">        return getMBeanServer().instantiate(className);</span>
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Object instantiate(String className,
                              Object params[],
                              String signature[])
        throws ReflectionException, MBeanException {
<span class="nc" id="L430">        checkCreate(className);</span>
<span class="nc" id="L431">        return getMBeanServer().instantiate(className, params, signature);</span>
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Object instantiate(String className, ObjectName loaderName)
        throws ReflectionException, MBeanException, InstanceNotFoundException {
<span class="nc" id="L440">        checkCreate(className);</span>
<span class="nc" id="L441">        return getMBeanServer().instantiate(className, loaderName);</span>
    }

    /**
     * Call &lt;code&gt;checkCreate(className)&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Object instantiate(String className, ObjectName loaderName,
                              Object params[], String signature[])
        throws ReflectionException, MBeanException, InstanceNotFoundException {
<span class="nc" id="L451">        checkCreate(className);</span>
<span class="nc" id="L452">        return getMBeanServer().instantiate(className, loaderName,</span>
                                            params, signature);
    }

    /**
     * Call &lt;code&gt;checkWrite()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Object invoke(ObjectName name, String operationName,
                         Object params[], String signature[])
        throws
        InstanceNotFoundException,
        MBeanException,
        ReflectionException {
<span class="nc" id="L466">        checkWrite();</span>
<span class="nc" id="L467">        checkMLetMethods(name, operationName);</span>
<span class="nc" id="L468">        return getMBeanServer().invoke(name, operationName, params, signature);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public boolean isInstanceOf(ObjectName name, String className)
        throws InstanceNotFoundException {
<span class="nc" id="L477">        checkRead();</span>
<span class="nc" id="L478">        return getMBeanServer().isInstanceOf(name, className);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public boolean isRegistered(ObjectName name) {
<span class="nc" id="L486">        checkRead();</span>
<span class="nc" id="L487">        return getMBeanServer().isRegistered(name);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Set&lt;ObjectInstance&gt; queryMBeans(ObjectName name, QueryExp query) {
<span class="nc" id="L495">        checkRead();</span>
<span class="nc" id="L496">        return getMBeanServer().queryMBeans(name, query);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public Set&lt;ObjectName&gt; queryNames(ObjectName name, QueryExp query) {
<span class="nc" id="L504">        checkRead();</span>
<span class="nc" id="L505">        return getMBeanServer().queryNames(name, query);</span>
    }

    /**
     * Call &lt;code&gt;checkWrite()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public ObjectInstance registerMBean(Object object, ObjectName name)
        throws
        InstanceAlreadyExistsException,
        MBeanRegistrationException,
        NotCompliantMBeanException {
<span class="nc" id="L517">        checkWrite();</span>
<span class="nc" id="L518">        return getMBeanServer().registerMBean(object, name);</span>
    }

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void removeNotificationListener(ObjectName name,
                                           NotificationListener listener)
        throws InstanceNotFoundException, ListenerNotFoundException {
<span class="nc" id="L528">        checkRead();</span>
<span class="nc" id="L529">        getMBeanServer().removeNotificationListener(name, listener);</span>
<span class="nc" id="L530">    }</span>

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void removeNotificationListener(ObjectName name,
                                           NotificationListener listener,
                                           NotificationFilter filter,
                                           Object handback)
        throws InstanceNotFoundException, ListenerNotFoundException {
<span class="nc" id="L541">        checkRead();</span>
<span class="nc" id="L542">        getMBeanServer().removeNotificationListener(name, listener,</span>
                                                    filter, handback);
<span class="nc" id="L544">    }</span>

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void removeNotificationListener(ObjectName name,
                                           ObjectName listener)
        throws InstanceNotFoundException, ListenerNotFoundException {
<span class="nc" id="L553">        checkRead();</span>
<span class="nc" id="L554">        getMBeanServer().removeNotificationListener(name, listener);</span>
<span class="nc" id="L555">    }</span>

    /**
     * Call &lt;code&gt;checkRead()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void removeNotificationListener(ObjectName name,
                                           ObjectName listener,
                                           NotificationFilter filter,
                                           Object handback)
        throws InstanceNotFoundException, ListenerNotFoundException {
<span class="nc" id="L566">        checkRead();</span>
<span class="nc" id="L567">        getMBeanServer().removeNotificationListener(name, listener,</span>
                                                    filter, handback);
<span class="nc" id="L569">    }</span>

    /**
     * Call &lt;code&gt;checkWrite()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void setAttribute(ObjectName name, Attribute attribute)
        throws
        InstanceNotFoundException,
        AttributeNotFoundException,
        InvalidAttributeValueException,
        MBeanException,
        ReflectionException {
<span class="nc" id="L582">        checkWrite();</span>
<span class="nc" id="L583">        getMBeanServer().setAttribute(name, attribute);</span>
<span class="nc" id="L584">    }</span>

    /**
     * Call &lt;code&gt;checkWrite()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public AttributeList setAttributes(ObjectName name,
                                       AttributeList attributes)
        throws InstanceNotFoundException, ReflectionException {
<span class="nc" id="L593">        checkWrite();</span>
<span class="nc" id="L594">        return getMBeanServer().setAttributes(name, attributes);</span>
    }

    /**
     * Call &lt;code&gt;checkUnregister()&lt;/code&gt;, then forward this method to the
     * wrapped object.
     */
    public void unregisterMBean(ObjectName name)
        throws InstanceNotFoundException, MBeanRegistrationException {
<span class="nc" id="L603">        checkUnregister(name);</span>
<span class="nc" id="L604">        getMBeanServer().unregisterMBean(name);</span>
<span class="nc" id="L605">    }</span>

    //----------------
    // PRIVATE METHODS
    //----------------

    private void checkClassLoader(Object object) {
<span class="nc bnc" id="L612" title="All 2 branches missed.">        if (object instanceof ClassLoader)</span>
<span class="nc" id="L613">            throw new SecurityException(&quot;Access denied! Creating an &quot; +</span>
                                        &quot;MBean that is a ClassLoader &quot; +
                                        &quot;is forbidden unless a security &quot; +
                                        &quot;manager is installed.&quot;);
<span class="nc" id="L617">    }</span>

    private void checkMLetMethods(ObjectName name, String operation)
    throws InstanceNotFoundException {
        // Check if security manager installed
<span class="nc" id="L622">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L624">            return;</span>
        }
        // Check for addURL and getMBeansFromURL methods
<span class="nc bnc" id="L627" title="All 2 branches missed.">        if (!operation.equals(&quot;addURL&quot;) &amp;&amp;</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">                !operation.equals(&quot;getMBeansFromURL&quot;)) {</span>
<span class="nc" id="L629">            return;</span>
        }
        // Check if MBean is instance of MLet
<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (!getMBeanServer().isInstanceOf(name,</span>
                &quot;javax.management.loading.MLet&quot;)) {
<span class="nc" id="L634">            return;</span>
        }
        // Throw security exception
<span class="nc bnc" id="L637" title="All 2 branches missed.">        if (operation.equals(&quot;addURL&quot;)) { // addURL</span>
<span class="nc" id="L638">            throw new SecurityException(&quot;Access denied! MLet method addURL &quot; +</span>
                    &quot;cannot be invoked unless a security manager is installed.&quot;);
        } else { // getMBeansFromURL
            // Whether or not calling getMBeansFromURL is allowed is controlled
            // by the value of the &quot;jmx.remote.x.mlet.allow.getMBeansFromURL&quot;
            // system property. If the value of this property is true, calling
            // the MLet's getMBeansFromURL method is allowed. The default value
            // for this property is false.
            final String propName = &quot;jmx.remote.x.mlet.allow.getMBeansFromURL&quot;;
<span class="nc" id="L647">            GetPropertyAction propAction = new GetPropertyAction(propName);</span>
<span class="nc" id="L648">            String propValue = AccessController.doPrivileged(propAction);</span>
<span class="nc" id="L649">            boolean allowGetMBeansFromURL = &quot;true&quot;.equalsIgnoreCase(propValue);</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">            if (!allowGetMBeansFromURL) {</span>
<span class="nc" id="L651">                throw new SecurityException(&quot;Access denied! MLet method &quot; +</span>
                        &quot;getMBeansFromURL cannot be invoked unless a &quot; +
                        &quot;security manager is installed or the system property &quot; +
                        &quot;-Djmx.remote.x.mlet.allow.getMBeansFromURL=true &quot; +
                        &quot;is specified.&quot;);
            }
        }
<span class="nc" id="L658">    }</span>

    //------------------
    // PRIVATE VARIABLES
    //------------------

    private MBeanServer mbs;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>