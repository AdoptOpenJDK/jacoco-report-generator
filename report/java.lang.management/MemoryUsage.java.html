<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MemoryUsage.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">java.lang.management</a> &gt; <span class="el_source">MemoryUsage.java</span></div><h1>MemoryUsage.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.lang.management;

import javax.management.openmbean.CompositeData;
import sun.management.MemoryUsageCompositeData;

/**
 * A &lt;tt&gt;MemoryUsage&lt;/tt&gt; object represents a snapshot of memory usage.
 * Instances of the &lt;tt&gt;MemoryUsage&lt;/tt&gt; class are usually constructed
 * by methods that are used to obtain memory usage
 * information about individual memory pool of the Java virtual machine or
 * the heap or non-heap memory of the Java virtual machine as a whole.
 *
 * &lt;p&gt; A &lt;tt&gt;MemoryUsage&lt;/tt&gt; object contains four values:
 * &lt;table summary=&quot;Describes the MemoryUsage object content&quot;&gt;
 * &lt;tr&gt;
 * &lt;td valign=top&gt; &lt;tt&gt;init&lt;/tt&gt; &lt;/td&gt;
 * &lt;td valign=top&gt; represents the initial amount of memory (in bytes) that
 *      the Java virtual machine requests from the operating system
 *      for memory management during startup.  The Java virtual machine
 *      may request additional memory from the operating system and
 *      may also release memory to the system over time.
 *      The value of &lt;tt&gt;init&lt;/tt&gt; may be undefined.
 * &lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 * &lt;td valign=top&gt; &lt;tt&gt;used&lt;/tt&gt; &lt;/td&gt;
 * &lt;td valign=top&gt; represents the amount of memory currently used (in bytes).
 * &lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 * &lt;td valign=top&gt; &lt;tt&gt;committed&lt;/tt&gt; &lt;/td&gt;
 * &lt;td valign=top&gt; represents the amount of memory (in bytes) that is
 *      guaranteed to be available for use by the Java virtual machine.
 *      The amount of committed memory may change over time (increase
 *      or decrease).  The Java virtual machine may release memory to
 *      the system and &lt;tt&gt;committed&lt;/tt&gt; could be less than &lt;tt&gt;init&lt;/tt&gt;.
 *      &lt;tt&gt;committed&lt;/tt&gt; will always be greater than
 *      or equal to &lt;tt&gt;used&lt;/tt&gt;.
 * &lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 * &lt;td valign=top&gt; &lt;tt&gt;max&lt;/tt&gt; &lt;/td&gt;
 * &lt;td valign=top&gt; represents the maximum amount of memory (in bytes)
 *      that can be used for memory management. Its value may be undefined.
 *      The maximum amount of memory may change over time if defined.
 *      The amount of used and committed memory will always be less than
 *      or equal to &lt;tt&gt;max&lt;/tt&gt; if &lt;tt&gt;max&lt;/tt&gt; is defined.
 *      A memory allocation may fail if it attempts to increase the
 *      used memory such that &lt;tt&gt;used &amp;gt; committed&lt;/tt&gt; even
 *      if &lt;tt&gt;used &amp;lt;= max&lt;/tt&gt; would still be true (for example,
 *      when the system is low on virtual memory).
 * &lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;/table&gt;
 *
 * Below is a picture showing an example of a memory pool:
 *
 * &lt;pre&gt;
 *        +----------------------------------------------+
 *        +////////////////           |                  +
 *        +////////////////           |                  +
 *        +----------------------------------------------+
 *
 *        |--------|
 *           init
 *        |---------------|
 *               used
 *        |---------------------------|
 *                  committed
 *        |----------------------------------------------|
 *                            max
 * &lt;/pre&gt;
 *
 * &lt;h3&gt;MXBean Mapping&lt;/h3&gt;
 * &lt;tt&gt;MemoryUsage&lt;/tt&gt; is mapped to a {@link CompositeData CompositeData}
 * with attributes as specified in the {@link #from from} method.
 *
 * @author   Mandy Chung
 * @since   1.5
 */
public class MemoryUsage {
    private final long init;
    private final long used;
    private final long committed;
    private final long max;

    /**
     * Constructs a &lt;tt&gt;MemoryUsage&lt;/tt&gt; object.
     *
     * @param init      the initial amount of memory in bytes that
     *                  the Java virtual machine allocates;
     *                  or &lt;tt&gt;-1&lt;/tt&gt; if undefined.
     * @param used      the amount of used memory in bytes.
     * @param committed the amount of committed memory in bytes.
     * @param max       the maximum amount of memory in bytes that
     *                  can be used; or &lt;tt&gt;-1&lt;/tt&gt; if undefined.
     *
     * @throws IllegalArgumentException if
     * &lt;ul&gt;
     * &lt;li&gt; the value of &lt;tt&gt;init&lt;/tt&gt; or &lt;tt&gt;max&lt;/tt&gt; is negative
     *      but not &lt;tt&gt;-1&lt;/tt&gt;; or&lt;/li&gt;
     * &lt;li&gt; the value of &lt;tt&gt;used&lt;/tt&gt; or &lt;tt&gt;committed&lt;/tt&gt; is negative;
     *      or&lt;/li&gt;
     * &lt;li&gt; &lt;tt&gt;used&lt;/tt&gt; is greater than the value of &lt;tt&gt;committed&lt;/tt&gt;;
     *      or&lt;/li&gt;
     * &lt;li&gt; &lt;tt&gt;committed&lt;/tt&gt; is greater than the value of &lt;tt&gt;max&lt;/tt&gt;
     *      &lt;tt&gt;max&lt;/tt&gt; if defined.&lt;/li&gt;
     * &lt;/ul&gt;
     */
    public MemoryUsage(long init,
                       long used,
                       long committed,
<span class="fc" id="L138">                       long max) {</span>
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">        if (init &lt; -1) {</span>
<span class="nc" id="L140">            throw new IllegalArgumentException( &quot;init parameter = &quot; +</span>
                init + &quot; is negative but not -1.&quot;);
        }
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">        if (max &lt; -1) {</span>
<span class="nc" id="L144">            throw new IllegalArgumentException( &quot;max parameter = &quot; +</span>
                max + &quot; is negative but not -1.&quot;);
        }
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">        if (used &lt; 0) {</span>
<span class="nc" id="L148">            throw new IllegalArgumentException( &quot;used parameter = &quot; +</span>
                used + &quot; is negative.&quot;);
        }
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">        if (committed &lt; 0) {</span>
<span class="nc" id="L152">            throw new IllegalArgumentException( &quot;committed parameter = &quot; +</span>
                committed + &quot; is negative.&quot;);
        }
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">        if (used &gt; committed) {</span>
<span class="nc" id="L156">            throw new IllegalArgumentException( &quot;used = &quot; + used +</span>
                &quot; should be &lt;= committed = &quot; + committed);
        }
<span class="pc bpc" id="L159" title="2 of 4 branches missed.">        if (max &gt;= 0 &amp;&amp; committed &gt; max) {</span>
<span class="nc" id="L160">            throw new IllegalArgumentException( &quot;committed = &quot; + committed +</span>
                &quot; should be &lt; max = &quot; + max);
        }

<span class="fc" id="L164">        this.init = init;</span>
<span class="fc" id="L165">        this.used = used;</span>
<span class="fc" id="L166">        this.committed = committed;</span>
<span class="fc" id="L167">        this.max = max;</span>
<span class="fc" id="L168">    }</span>

    /**
     * Constructs a &lt;tt&gt;MemoryUsage&lt;/tt&gt; object from a
     * {@link CompositeData CompositeData}.
     */
<span class="nc" id="L174">    private MemoryUsage(CompositeData cd) {</span>
        // validate the input composite data
<span class="nc" id="L176">        MemoryUsageCompositeData.validateCompositeData(cd);</span>

<span class="nc" id="L178">        this.init = MemoryUsageCompositeData.getInit(cd);</span>
<span class="nc" id="L179">        this.used = MemoryUsageCompositeData.getUsed(cd);</span>
<span class="nc" id="L180">        this.committed = MemoryUsageCompositeData.getCommitted(cd);</span>
<span class="nc" id="L181">        this.max = MemoryUsageCompositeData.getMax(cd);</span>
<span class="nc" id="L182">    }</span>

    /**
     * Returns the amount of memory in bytes that the Java virtual machine
     * initially requests from the operating system for memory management.
     * This method returns &lt;tt&gt;-1&lt;/tt&gt; if the initial memory size is undefined.
     *
     * @return the initial size of memory in bytes;
     * &lt;tt&gt;-1&lt;/tt&gt; if undefined.
     */
    public long getInit() {
<span class="nc" id="L193">        return init;</span>
    }

    /**
     * Returns the amount of used memory in bytes.
     *
     * @return the amount of used memory in bytes.
     *
     */
    public long getUsed() {
<span class="fc" id="L203">        return used;</span>
    };

    /**
     * Returns the amount of memory in bytes that is committed for
     * the Java virtual machine to use.  This amount of memory is
     * guaranteed for the Java virtual machine to use.
     *
     * @return the amount of committed memory in bytes.
     *
     */
    public long getCommitted() {
<span class="nc" id="L215">        return committed;</span>
    };

    /**
     * Returns the maximum amount of memory in bytes that can be
     * used for memory management.  This method returns &lt;tt&gt;-1&lt;/tt&gt;
     * if the maximum memory size is undefined.
     *
     * &lt;p&gt; This amount of memory is not guaranteed to be available
     * for memory management if it is greater than the amount of
     * committed memory.  The Java virtual machine may fail to allocate
     * memory even if the amount of used memory does not exceed this
     * maximum size.
     *
     * @return the maximum amount of memory in bytes;
     * &lt;tt&gt;-1&lt;/tt&gt; if undefined.
     */
    public long getMax() {
<span class="nc" id="L233">        return max;</span>
    };

    /**
     * Returns a descriptive representation of this memory usage.
     */
    public String toString() {
<span class="nc" id="L240">        StringBuffer buf = new StringBuffer();</span>
<span class="nc" id="L241">        buf.append(&quot;init = &quot; + init + &quot;(&quot; + (init &gt;&gt; 10) + &quot;K) &quot;);</span>
<span class="nc" id="L242">        buf.append(&quot;used = &quot; + used + &quot;(&quot; + (used &gt;&gt; 10) + &quot;K) &quot;);</span>
<span class="nc" id="L243">        buf.append(&quot;committed = &quot; + committed + &quot;(&quot; +</span>
                   (committed &gt;&gt; 10) + &quot;K) &quot; );
<span class="nc" id="L245">        buf.append(&quot;max = &quot; + max + &quot;(&quot; + (max &gt;&gt; 10) + &quot;K)&quot;);</span>
<span class="nc" id="L246">        return buf.toString();</span>
    }

    /**
     * Returns a &lt;tt&gt;MemoryUsage&lt;/tt&gt; object represented by the
     * given &lt;tt&gt;CompositeData&lt;/tt&gt;. The given &lt;tt&gt;CompositeData&lt;/tt&gt;
     * must contain the following attributes:
     *
     * &lt;blockquote&gt;
     * &lt;table border summary=&quot;The attributes and the types the given CompositeData contains&quot;&gt;
     * &lt;tr&gt;
     *   &lt;th align=left&gt;Attribute Name&lt;/th&gt;
     *   &lt;th align=left&gt;Type&lt;/th&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     *   &lt;td&gt;init&lt;/td&gt;
     *   &lt;td&gt;&lt;tt&gt;java.lang.Long&lt;/tt&gt;&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     *   &lt;td&gt;used&lt;/td&gt;
     *   &lt;td&gt;&lt;tt&gt;java.lang.Long&lt;/tt&gt;&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     *   &lt;td&gt;committed&lt;/td&gt;
     *   &lt;td&gt;&lt;tt&gt;java.lang.Long&lt;/tt&gt;&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     *   &lt;td&gt;max&lt;/td&gt;
     *   &lt;td&gt;&lt;tt&gt;java.lang.Long&lt;/tt&gt;&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;/table&gt;
     * &lt;/blockquote&gt;
     *
     * @param cd &lt;tt&gt;CompositeData&lt;/tt&gt; representing a &lt;tt&gt;MemoryUsage&lt;/tt&gt;
     *
     * @throws IllegalArgumentException if &lt;tt&gt;cd&lt;/tt&gt; does not
     *   represent a &lt;tt&gt;MemoryUsage&lt;/tt&gt; with the attributes described
     *   above.
     *
     * @return a &lt;tt&gt;MemoryUsage&lt;/tt&gt; object represented by &lt;tt&gt;cd&lt;/tt&gt;
     *         if &lt;tt&gt;cd&lt;/tt&gt; is not &lt;tt&gt;null&lt;/tt&gt;;
     *         &lt;tt&gt;null&lt;/tt&gt; otherwise.
     */
    public static MemoryUsage from(CompositeData cd) {
<span class="nc bnc" id="L290" title="All 2 branches missed.">        if (cd == null) {</span>
<span class="nc" id="L291">            return null;</span>
        }

<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (cd instanceof MemoryUsageCompositeData) {</span>
<span class="nc" id="L295">            return ((MemoryUsageCompositeData) cd).getMemoryUsage();</span>
        } else {
<span class="nc" id="L297">            return new MemoryUsage(cd);</span>
        }

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>