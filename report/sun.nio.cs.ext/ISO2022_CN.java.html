<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>ISO2022_CN.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.nio.cs.ext</a> &gt; <span class="el_source">ISO2022_CN.java</span></div><h1>ISO2022_CN.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

/*
 */

package sun.nio.cs.ext;

import java.nio.ByteBuffer;
import java.nio.CharBuffer;
import java.nio.charset.Charset;
import java.nio.charset.CharsetDecoder;
import java.nio.charset.CharsetEncoder;
import java.nio.charset.CoderResult;
import java.nio.charset.CharacterCodingException;
import sun.nio.cs.HistoricallyNamedCharset;
import sun.nio.cs.US_ASCII;

public class ISO2022_CN
    extends Charset
    implements HistoricallyNamedCharset
{
    private static final byte ISO_ESC = 0x1b;
    private static final byte ISO_SI = 0x0f;
    private static final byte ISO_SO = 0x0e;
    private static final byte ISO_SS2_7 = 0x4e;
    private static final byte ISO_SS3_7 = 0x4f;
    private static final byte MSB = (byte)0x80;
    private static final char REPLACE_CHAR = '\uFFFD';

    private static final byte SODesigGB = 0;
    private static final byte SODesigCNS = 1;

    public ISO2022_CN() {
<span class="nc" id="L57">        super(&quot;ISO-2022-CN&quot;, ExtendedCharsets.aliasesFor(&quot;ISO-2022-CN&quot;));</span>
<span class="nc" id="L58">    }</span>

    public String historicalName() {
<span class="nc" id="L61">        return &quot;ISO2022CN&quot;;</span>
    }

    public boolean contains(Charset cs) {
<span class="nc bnc" id="L65" title="All 8 branches missed.">        return ((cs instanceof EUC_CN)     // GB2312-80 repertoire</span>
                || (cs instanceof US_ASCII)
                || (cs instanceof EUC_TW)  // CNS11643 repertoire
                || (cs instanceof ISO2022_CN));
    }

    public CharsetDecoder newDecoder() {
<span class="nc" id="L72">        return new Decoder(this);</span>
    }

    public CharsetEncoder newEncoder() {
<span class="nc" id="L76">        throw new UnsupportedOperationException();</span>
    }

    public boolean canEncode() {
<span class="nc" id="L80">        return false;</span>
    }

<span class="nc bnc" id="L83" title="All 2 branches missed.">    static class Decoder extends CharsetDecoder {</span>
        private boolean shiftOut;
        private byte currentSODesig;

<span class="nc" id="L87">        private static final Charset gb2312 = new EUC_CN();</span>
<span class="nc" id="L88">        private static final Charset cns = new EUC_TW();</span>
        private final DoubleByte.Decoder gb2312Decoder;
        private final EUC_TW.Decoder cnsDecoder;

        Decoder(Charset cs) {
<span class="nc" id="L93">            super(cs, 1.0f, 1.0f);</span>
<span class="nc" id="L94">            shiftOut = false;</span>
<span class="nc" id="L95">            currentSODesig = SODesigGB;</span>
<span class="nc" id="L96">            gb2312Decoder = (DoubleByte.Decoder)gb2312.newDecoder();</span>
<span class="nc" id="L97">            cnsDecoder = (EUC_TW.Decoder)cns.newDecoder();</span>
<span class="nc" id="L98">        }</span>

        protected void implReset() {
<span class="nc" id="L101">            shiftOut= false;</span>
<span class="nc" id="L102">            currentSODesig = SODesigGB;</span>
<span class="nc" id="L103">        }</span>

        private char cnsDecode(byte byte1, byte byte2, byte SS) {
<span class="nc" id="L106">            byte1 |= MSB;</span>
<span class="nc" id="L107">            byte2 |= MSB;</span>
<span class="nc" id="L108">            int p = 0;</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (SS == ISO_SS2_7)</span>
<span class="nc" id="L110">                p = 1;    //plane 2, index -- 1</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            else if (SS == ISO_SS3_7)</span>
<span class="nc" id="L112">                p = 2;    //plane 3, index -- 2</span>
            else
<span class="nc" id="L114">                return REPLACE_CHAR;  //never happen.</span>
<span class="nc" id="L115">            char[] ret = cnsDecoder.toUnicode(byte1 &amp; 0xff,</span>
                                              byte2 &amp; 0xff,
                                              p);
<span class="nc bnc" id="L118" title="All 4 branches missed.">            if (ret == null || ret.length == 2)</span>
<span class="nc" id="L119">                return REPLACE_CHAR;</span>
<span class="nc" id="L120">            return ret[0];</span>
        }

        private char SODecode(byte byte1, byte byte2, byte SOD) {
<span class="nc" id="L124">            byte1 |= MSB;</span>
<span class="nc" id="L125">            byte2 |= MSB;</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (SOD == SODesigGB) {</span>
<span class="nc" id="L127">                return gb2312Decoder.decodeDouble(byte1 &amp; 0xff,</span>
                                                  byte2 &amp; 0xff);
            } else {    // SOD == SODesigCNS
<span class="nc" id="L130">                char[] ret = cnsDecoder.toUnicode(byte1 &amp; 0xff,</span>
                                                  byte2 &amp; 0xff,
                                                  0);
<span class="nc bnc" id="L133" title="All 2 branches missed.">                if (ret == null)</span>
<span class="nc" id="L134">                    return REPLACE_CHAR;</span>
<span class="nc" id="L135">                return ret[0];</span>
            }
        }

        private CoderResult decodeBufferLoop(ByteBuffer src,
                                             CharBuffer dst)
        {
<span class="nc" id="L142">            int mark = src.position();</span>
<span class="nc" id="L143">            byte b1 = 0, b2 = 0, b3 = 0, b4 = 0;</span>
<span class="nc" id="L144">            int inputSize = 0;</span>
<span class="nc" id="L145">            char c = REPLACE_CHAR;</span>
            try {
<span class="nc bnc" id="L147" title="All 2 branches missed.">                while (src.hasRemaining()) {</span>
<span class="nc" id="L148">                    b1 = src.get();</span>
<span class="nc" id="L149">                    inputSize = 1;</span>

<span class="nc bnc" id="L151" title="All 6 branches missed.">                    while (b1 == ISO_ESC ||</span>
                           b1 == ISO_SO ||
                           b1 == ISO_SI) {
<span class="nc bnc" id="L154" title="All 2 branches missed.">                        if (b1 == ISO_ESC) {  // ESC</span>
<span class="nc" id="L155">                            currentSODesig = SODesigGB;</span>

<span class="nc bnc" id="L157" title="All 2 branches missed.">                            if (src.remaining() &lt; 1)</span>
<span class="nc" id="L158">                                return CoderResult.UNDERFLOW;</span>

<span class="nc" id="L160">                            b2 = src.get();</span>
<span class="nc" id="L161">                            inputSize++;</span>

<span class="nc bnc" id="L163" title="All 2 branches missed.">                            if ((b2 &amp; (byte)0x80) != 0)</span>
<span class="nc" id="L164">                                return CoderResult.malformedForLength(inputSize);</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">                            if (b2 == (byte)0x24) {</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                                if (src.remaining() &lt; 1)</span>
<span class="nc" id="L168">                                    return CoderResult.UNDERFLOW;</span>

<span class="nc" id="L170">                                b3 = src.get();</span>
<span class="nc" id="L171">                                inputSize++;</span>

<span class="nc bnc" id="L173" title="All 2 branches missed.">                                if ((b3 &amp; (byte)0x80) != 0)</span>
<span class="nc" id="L174">                                    return CoderResult.malformedForLength(inputSize);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">                                if (b3 == 'A'){              // &quot;$A&quot;</span>
<span class="nc" id="L176">                                    currentSODesig = SODesigGB;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                                } else if (b3 == ')') {</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">                                    if (src.remaining() &lt; 1)</span>
<span class="nc" id="L179">                                        return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L180">                                    b4 = src.get();</span>
<span class="nc" id="L181">                                    inputSize++;</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">                                    if (b4 == 'A'){          // &quot;$)A&quot;</span>
<span class="nc" id="L183">                                        currentSODesig = SODesigGB;</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">                                    } else if (b4 == 'G'){   // &quot;$)G&quot;</span>
<span class="nc" id="L185">                                        currentSODesig = SODesigCNS;</span>
                                    } else {
<span class="nc" id="L187">                                        return CoderResult.malformedForLength(inputSize);</span>
                                    }
<span class="nc bnc" id="L189" title="All 2 branches missed.">                                } else if (b3 == '*') {</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">                                    if (src.remaining() &lt; 1)</span>
<span class="nc" id="L191">                                        return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L192">                                    b4 = src.get();</span>
<span class="nc" id="L193">                                    inputSize++;</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">                                    if (b4 != 'H') {         // &quot;$*H&quot;</span>
                                        //SS2Desig -&gt; CNS-P1
<span class="nc" id="L196">                                        return CoderResult.malformedForLength(inputSize);</span>
                                    }
<span class="nc bnc" id="L198" title="All 2 branches missed.">                                } else if (b3 == '+') {</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">                                    if (src.remaining() &lt; 1)</span>
<span class="nc" id="L200">                                        return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L201">                                    b4 = src.get();</span>
<span class="nc" id="L202">                                    inputSize++;</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">                                    if (b4 != 'I'){          // &quot;$+I&quot;</span>
                                        //SS3Desig -&gt; CNS-P2.
<span class="nc" id="L205">                                        return CoderResult.malformedForLength(inputSize);</span>
                                    }
                                } else {
<span class="nc" id="L208">                                        return CoderResult.malformedForLength(inputSize);</span>
                                }
<span class="nc bnc" id="L210" title="All 4 branches missed.">                            } else if (b2 == ISO_SS2_7 || b2 == ISO_SS3_7) {</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">                                if (src.remaining() &lt; 2)</span>
<span class="nc" id="L212">                                    return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L213">                                b3 = src.get();</span>
<span class="nc" id="L214">                                b4 = src.get();</span>
<span class="nc" id="L215">                                inputSize += 2;</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">                                if (dst.remaining() &lt; 1)</span>
<span class="nc" id="L217">                                    return CoderResult.OVERFLOW;</span>
                                //SS2-&gt;CNS-P2, SS3-&gt;CNS-P3
<span class="nc" id="L219">                                c = cnsDecode(b3, b4, b2);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">                                if (c == REPLACE_CHAR)</span>
<span class="nc" id="L221">                                    return CoderResult.unmappableForLength(inputSize);</span>
<span class="nc" id="L222">                                dst.put(c);</span>
                            } else {
<span class="nc" id="L224">                                return CoderResult.malformedForLength(inputSize);</span>
                            }
<span class="nc bnc" id="L226" title="All 2 branches missed.">                        } else if (b1 == ISO_SO) {</span>
<span class="nc" id="L227">                            shiftOut = true;</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">                        } else if (b1 == ISO_SI) { // shift back in</span>
<span class="nc" id="L229">                            shiftOut = false;</span>
                        }
<span class="nc" id="L231">                        mark += inputSize;</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                        if (src.remaining() &lt; 1)</span>
<span class="nc" id="L233">                            return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L234">                        b1 = src.get();</span>
<span class="nc" id="L235">                        inputSize = 1;</span>
                    }

<span class="nc bnc" id="L238" title="All 2 branches missed.">                    if (dst.remaining() &lt; 1)</span>
<span class="nc" id="L239">                        return CoderResult.OVERFLOW;</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">                    if (!shiftOut) {</span>
<span class="nc" id="L242">                        dst.put((char)(b1 &amp; 0xff));  //clear the upper byte</span>
<span class="nc" id="L243">                        mark += inputSize;</span>
                    } else {
<span class="nc bnc" id="L245" title="All 2 branches missed.">                        if (src.remaining() &lt; 1)</span>
<span class="nc" id="L246">                            return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L247">                        b2 = src.get();</span>
<span class="nc" id="L248">                        inputSize++;</span>
<span class="nc" id="L249">                        c = SODecode(b1, b2, currentSODesig);</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">                        if (c == REPLACE_CHAR)</span>
<span class="nc" id="L251">                            return CoderResult.unmappableForLength(inputSize);</span>
<span class="nc" id="L252">                        dst.put(c);</span>
<span class="nc" id="L253">                        mark += inputSize;</span>
                    }
                }
<span class="nc" id="L256">                return CoderResult.UNDERFLOW;</span>
            } finally {
<span class="nc" id="L258">                src.position(mark);</span>
            }
        }

        private CoderResult decodeArrayLoop(ByteBuffer src,
                                            CharBuffer dst)
        {
<span class="nc" id="L265">            int inputSize = 0;</span>
<span class="nc" id="L266">            byte b1 = 0, b2 = 0, b3 = 0, b4 = 0;</span>
<span class="nc" id="L267">            char c = REPLACE_CHAR;</span>

<span class="nc" id="L269">            byte[] sa = src.array();</span>
<span class="nc" id="L270">            int sp = src.arrayOffset() + src.position();</span>
<span class="nc" id="L271">            int sl = src.arrayOffset() + src.limit();</span>
<span class="nc bnc" id="L272" title="All 4 branches missed.">            assert (sp &lt;= sl);</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            sp = (sp &lt;= sl ? sp : sl);</span>

<span class="nc" id="L275">            char[] da = dst.array();</span>
<span class="nc" id="L276">            int dp = dst.arrayOffset() + dst.position();</span>
<span class="nc" id="L277">            int dl = dst.arrayOffset() + dst.limit();</span>
<span class="nc bnc" id="L278" title="All 4 branches missed.">            assert (dp &lt;= dl);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">            dp = (dp &lt;= dl ? dp : dl);</span>

            try {
<span class="nc bnc" id="L282" title="All 2 branches missed.">                while (sp &lt; sl) {</span>
<span class="nc" id="L283">                    b1 = sa[sp];</span>
<span class="nc" id="L284">                    inputSize = 1;</span>

<span class="nc bnc" id="L286" title="All 6 branches missed.">                    while (b1 == ISO_ESC || b1 == ISO_SO || b1 == ISO_SI) {</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">                        if (b1 == ISO_ESC) {  // ESC</span>
<span class="nc" id="L288">                            currentSODesig = SODesigGB;</span>

<span class="nc bnc" id="L290" title="All 2 branches missed.">                            if (sp + 2 &gt; sl)</span>
<span class="nc" id="L291">                                return CoderResult.UNDERFLOW;</span>

<span class="nc" id="L293">                            b2 = sa[sp + 1];</span>
<span class="nc" id="L294">                            inputSize++;</span>

<span class="nc bnc" id="L296" title="All 2 branches missed.">                            if ((b2 &amp; (byte)0x80) != 0)</span>
<span class="nc" id="L297">                                return CoderResult.malformedForLength(inputSize);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">                            if (b2 == (byte)0x24) {</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">                                if (sp + 3 &gt; sl)</span>
<span class="nc" id="L300">                                    return CoderResult.UNDERFLOW;</span>

<span class="nc" id="L302">                                b3 = sa[sp + 2];</span>
<span class="nc" id="L303">                                inputSize++;</span>

<span class="nc bnc" id="L305" title="All 2 branches missed.">                                if ((b3 &amp; (byte)0x80) != 0)</span>
<span class="nc" id="L306">                                    return CoderResult.malformedForLength(inputSize);</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">                                if (b3 == 'A'){              // &quot;$A&quot;</span>
                                    /* &lt;ESC&gt;$A is not a legal designator sequence for
                                       ISO2022_CN, it is listed as an escape sequence
                                       for GB2312 in ISO2022-JP-2. Keep it here just for
                                       the sake of &quot;compatibility&quot;.
                                     */
<span class="nc" id="L313">                                    currentSODesig = SODesigGB;</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                                } else if (b3 == ')') {</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                                    if (sp + 4 &gt; sl)</span>
<span class="nc" id="L316">                                        return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L317">                                    b4 = sa[sp + 3];</span>
<span class="nc" id="L318">                                    inputSize++;</span>

<span class="nc bnc" id="L320" title="All 2 branches missed.">                                    if (b4 == 'A'){          // &quot;$)A&quot;</span>
<span class="nc" id="L321">                                        currentSODesig = SODesigGB;</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">                                    } else if (b4 == 'G'){   // &quot;$)G&quot;</span>
<span class="nc" id="L323">                                        currentSODesig = SODesigCNS;</span>
                                    } else {
<span class="nc" id="L325">                                        return CoderResult.malformedForLength(inputSize);</span>
                                    }
<span class="nc bnc" id="L327" title="All 2 branches missed.">                                } else if (b3 == '*') {</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">                                    if (sp + 4 &gt; sl)</span>
<span class="nc" id="L329">                                        return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L330">                                    b4 = sa[sp + 3];</span>
<span class="nc" id="L331">                                    inputSize++;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                                    if (b4 != 'H'){          // &quot;$*H&quot;</span>
<span class="nc" id="L333">                                        return CoderResult.malformedForLength(inputSize);</span>
                                    }
<span class="nc bnc" id="L335" title="All 2 branches missed.">                                } else if (b3 == '+') {</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">                                    if (sp + 4 &gt; sl)</span>
<span class="nc" id="L337">                                        return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L338">                                    b4 = sa[sp + 3];</span>
<span class="nc" id="L339">                                    inputSize++;</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">                                    if (b4 != 'I'){          // &quot;$+I&quot;</span>
<span class="nc" id="L341">                                        return CoderResult.malformedForLength(inputSize);</span>
                                    }
                                } else {
<span class="nc" id="L344">                                        return CoderResult.malformedForLength(inputSize);</span>
                                }
<span class="nc bnc" id="L346" title="All 4 branches missed.">                            } else if (b2 == ISO_SS2_7 || b2 == ISO_SS3_7) {</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">                                if (sp + 4 &gt; sl) {</span>
<span class="nc" id="L348">                                    return CoderResult.UNDERFLOW;</span>
                                }
<span class="nc" id="L350">                                b3 = sa[sp + 2];</span>
<span class="nc" id="L351">                                b4 = sa[sp + 3];</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                                if (dl - dp &lt; 1)  {</span>
<span class="nc" id="L353">                                    return CoderResult.OVERFLOW;</span>
                                }
<span class="nc" id="L355">                                inputSize += 2;</span>
<span class="nc" id="L356">                                c = cnsDecode(b3, b4, b2);</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                                if (c == REPLACE_CHAR)</span>
<span class="nc" id="L358">                                    return CoderResult.unmappableForLength(inputSize);</span>
<span class="nc" id="L359">                                da[dp++] = c;</span>
                            } else {
<span class="nc" id="L361">                                return CoderResult.malformedForLength(inputSize);</span>
                            }
<span class="nc bnc" id="L363" title="All 2 branches missed.">                        } else if (b1 == ISO_SO) {</span>
<span class="nc" id="L364">                            shiftOut = true;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">                        } else if (b1 == ISO_SI) { // shift back in</span>
<span class="nc" id="L366">                            shiftOut = false;</span>
                        }
<span class="nc" id="L368">                        sp += inputSize;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                        if (sp + 1 &gt; sl)</span>
<span class="nc" id="L370">                            return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L371">                        b1 = sa[sp];</span>
<span class="nc" id="L372">                        inputSize = 1;</span>
                    }

<span class="nc bnc" id="L375" title="All 2 branches missed.">                    if (dl - dp &lt; 1) {</span>
<span class="nc" id="L376">                        return CoderResult.OVERFLOW;</span>
                    }

<span class="nc bnc" id="L379" title="All 2 branches missed.">                    if (!shiftOut) {</span>
<span class="nc" id="L380">                        da[dp++] = (char)(b1 &amp; 0xff);  //clear the upper byte</span>
                    } else {
<span class="nc bnc" id="L382" title="All 2 branches missed.">                        if (sp + 2 &gt; sl)</span>
<span class="nc" id="L383">                            return CoderResult.UNDERFLOW;</span>
<span class="nc" id="L384">                        b2 = sa[sp + 1];</span>
<span class="nc" id="L385">                        inputSize++;</span>
<span class="nc" id="L386">                        c = SODecode(b1, b2, currentSODesig);</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">                        if (c == REPLACE_CHAR)</span>
<span class="nc" id="L388">                            return CoderResult.unmappableForLength(inputSize);</span>
<span class="nc" id="L389">                        da[dp++] = c;</span>
                    }
<span class="nc" id="L391">                    sp += inputSize;</span>
                }
<span class="nc" id="L393">                return CoderResult.UNDERFLOW;</span>
            } finally {
<span class="nc" id="L395">                src.position(sp - src.arrayOffset());</span>
<span class="nc" id="L396">                dst.position(dp - dst.arrayOffset());</span>
            }
        }

        protected CoderResult decodeLoop(ByteBuffer src,
                                         CharBuffer dst)
        {
<span class="nc bnc" id="L403" title="All 4 branches missed.">            if (src.hasArray() &amp;&amp; dst.hasArray())</span>
<span class="nc" id="L404">                return decodeArrayLoop(src, dst);</span>
            else
<span class="nc" id="L406">                return decodeBufferLoop(src, dst);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>