<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>LogStream.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">java.rmi.server</a> &gt; <span class="el_source">LogStream.java</span></div><h1>LogStream.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1996, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package java.rmi.server;

import java.io.*;
import java.util.*;

/**
 * &lt;code&gt;LogStream&lt;/code&gt; provides a mechanism for logging errors that are
 * of possible interest to those monitoring a system.
 *
 * @author  Ann Wollrath (lots of code stolen from Ken Arnold)
 * @since   JDK1.1
 * @deprecated no replacement
 */
@Deprecated
public class LogStream extends PrintStream {

    /** table mapping known log names to log stream objects */
<span class="fc" id="L42">    private static Map&lt;String,LogStream&gt; known = new HashMap&lt;&gt;(5);</span>
    /** default output stream for new logs */
<span class="fc" id="L44">    private static PrintStream  defaultStream = System.err;</span>

    /** log name for this log */
    private String name;

    /** stream where output of this log is sent to */
    private OutputStream logOut;

    /** string writer for writing message prefixes to log stream */
    private OutputStreamWriter logWriter;

    /** string buffer used for constructing log message prefixes */
<span class="fc" id="L56">    private StringBuffer buffer = new StringBuffer();</span>

    /** stream used for buffering lines */
    private ByteArrayOutputStream bufOut;

    /**
     * Create a new LogStream object.  Since this only constructor is
     * private, users must have a LogStream created through the &quot;log&quot;
     * method.
     * @param name string identifying messages from this log
     * @out output stream that log messages will be sent to
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    private LogStream(String name, OutputStream out)
    {
<span class="fc" id="L73">        super(new ByteArrayOutputStream());</span>
<span class="fc" id="L74">        bufOut = (ByteArrayOutputStream) super.out;</span>

<span class="fc" id="L76">        this.name = name;</span>
<span class="fc" id="L77">        setOutputStream(out);</span>
<span class="fc" id="L78">    }</span>

    /**
     * Return the LogStream identified by the given name.  If
     * a log corresponding to &quot;name&quot; does not exist, a log using
     * the default stream is created.
     * @param name name identifying the desired LogStream
     * @return log associated with given name
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public static LogStream log(String name) {
        LogStream stream;
<span class="fc" id="L92">        synchronized (known) {</span>
<span class="fc" id="L93">            stream = known.get(name);</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">            if (stream == null) {</span>
<span class="fc" id="L95">                stream = new LogStream(name, defaultStream);</span>
            }
<span class="fc" id="L97">            known.put(name, stream);</span>
<span class="pc" id="L98">        }</span>
<span class="fc" id="L99">        return stream;</span>
    }

    /**
     * Return the current default stream for new logs.
     * @return default log stream
     * @see #setDefaultStream
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public static synchronized PrintStream getDefaultStream() {
<span class="nc" id="L111">        return defaultStream;</span>
    }

    /**
     * Set the default stream for new logs.
     * @param newDefault new default log stream
     * @see #getDefaultStream
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public static synchronized void setDefaultStream(PrintStream newDefault) {
<span class="fc" id="L123">        SecurityManager sm = System.getSecurityManager();</span>

<span class="pc bpc" id="L125" title="1 of 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L126">            sm.checkPermission(</span>
                new java.util.logging.LoggingPermission(&quot;control&quot;, null));
        }

<span class="fc" id="L130">        defaultStream = newDefault;</span>
<span class="fc" id="L131">    }</span>

    /**
     * Return the current stream to which output from this log is sent.
     * @return output stream for this log
     * @see #setOutputStream
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public synchronized OutputStream getOutputStream()
    {
<span class="nc" id="L143">        return logOut;</span>
    }

    /**
     * Set the stream to which output from this log is sent.
     * @param out new output stream for this log
     * @see #getOutputStream
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public synchronized void setOutputStream(OutputStream out)
    {
<span class="fc" id="L156">        logOut = out;</span>
        // Maintain an OutputStreamWriter with default CharToByteConvertor
        // (just like new PrintStream) for writing log message prefixes.
<span class="fc" id="L159">        logWriter = new OutputStreamWriter(logOut);</span>
<span class="fc" id="L160">    }</span>

    /**
     * Write a byte of data to the stream.  If it is not a newline, then
     * the byte is appended to the internal buffer.  If it is a newline,
     * then the currently buffered line is sent to the log's output
     * stream, prefixed with the appropriate logging information.
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public void write(int b)
    {
<span class="fc bfc" id="L173" title="All 2 branches covered.">        if (b == '\n') {</span>
            // synchronize on &quot;this&quot; first to avoid potential deadlock
<span class="fc" id="L175">            synchronized (this) {</span>
<span class="fc" id="L176">                synchronized (logOut) {</span>
                    // construct prefix for log messages:
<span class="fc" id="L178">                    buffer.setLength(0);;</span>
<span class="fc" id="L179">                    buffer.append(              // date/time stamp...</span>
<span class="fc" id="L180">                        (new Date()).toString());</span>
<span class="fc" id="L181">                    buffer.append(':');</span>
<span class="fc" id="L182">                    buffer.append(name);        // ...log name...</span>
<span class="fc" id="L183">                    buffer.append(':');</span>
<span class="fc" id="L184">                    buffer.append(Thread.currentThread().getName());</span>
<span class="fc" id="L185">                    buffer.append(':'); // ...and thread name</span>

                    try {
                        // write prefix through to underlying byte stream
<span class="fc" id="L189">                        logWriter.write(buffer.toString());</span>
<span class="fc" id="L190">                        logWriter.flush();</span>

                        // finally, write the already converted bytes of
                        // the log message
<span class="fc" id="L194">                        bufOut.writeTo(logOut);</span>
<span class="fc" id="L195">                        logOut.write(b);</span>
<span class="fc" id="L196">                        logOut.flush();</span>
<span class="nc" id="L197">                    } catch (IOException e) {</span>
<span class="nc" id="L198">                        setError();</span>
                    } finally {
<span class="pc" id="L200">                        bufOut.reset();</span>
<span class="pc" id="L201">                    }</span>
<span class="pc" id="L202">                }</span>
<span class="pc" id="L203">            }</span>
        }
        else
<span class="fc" id="L206">            super.write(b);</span>
<span class="fc" id="L207">    }</span>

    /**
     * Write a subarray of bytes.  Pass each through write byte method.
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public void write(byte b[], int off, int len)
    {
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">        if (len &lt; 0)</span>
<span class="nc" id="L218">            throw new ArrayIndexOutOfBoundsException(len);</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++ i)</span>
<span class="fc" id="L220">            write(b[off + i]);</span>
<span class="fc" id="L221">    }</span>

    /**
     * Return log name as string representation.
     * @return log name
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public String toString()
    {
<span class="nc" id="L232">        return name;</span>
    }

    /** log level constant (no logging). */
    public static final int SILENT  = 0;
    /** log level constant (brief logging). */
    public static final int BRIEF   = 10;
    /** log level constant (verbose logging). */
    public static final int VERBOSE = 20;

    /**
     * Convert a string name of a logging level to its internal
     * integer representation.
     * @param s name of logging level (e.g., 'SILENT', 'BRIEF', 'VERBOSE')
     * @return corresponding integer log level
     * @since JDK1.1
     * @deprecated no replacement
     */
    @Deprecated
    public static int parseLevel(String s)
    {
<span class="pc bpc" id="L253" title="1 of 4 branches missed.">        if ((s == null) || (s.length() &lt; 1))</span>
<span class="fc" id="L254">            return -1;</span>

        try {
<span class="nc" id="L257">            return Integer.parseInt(s);</span>
<span class="fc" id="L258">        } catch (NumberFormatException e) {</span>
        }
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">        if (s.length() &lt; 1)</span>
<span class="nc" id="L261">            return -1;</span>

<span class="pc bpc" id="L263" title="1 of 2 branches missed.">        if (&quot;SILENT&quot;.startsWith(s.toUpperCase()))</span>
<span class="nc" id="L264">            return SILENT;</span>
<span class="pc bpc" id="L265" title="1 of 2 branches missed.">        else if (&quot;BRIEF&quot;.startsWith(s.toUpperCase()))</span>
<span class="nc" id="L266">            return BRIEF;</span>
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">        else if (&quot;VERBOSE&quot;.startsWith(s.toUpperCase()))</span>
<span class="fc" id="L268">            return VERBOSE;</span>

<span class="nc" id="L270">        return -1;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>