<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MetalInternalFrameTitlePane.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.metal</a> &gt; <span class="el_source">MetalInternalFrameTitlePane.java</span></div><h1>MetalInternalFrameTitlePane.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.metal;

import sun.swing.SwingUtilities2;
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.border.*;
import javax.swing.event.InternalFrameEvent;
import java.util.EventListener;
import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeEvent;
import javax.swing.plaf.basic.BasicInternalFrameTitlePane;


/**
 * Class that manages a JLF title bar
 * @author Steve Wilson
 * @author Brian Beck
 * @since 1.3
 */

public class MetalInternalFrameTitlePane  extends BasicInternalFrameTitlePane {

<span class="nc" id="L49">    protected boolean isPalette = false;</span>
    protected Icon paletteCloseIcon;
    protected int paletteTitleHeight;

<span class="nc" id="L53">    private static final Border handyEmptyBorder = new EmptyBorder(0,0,0,0);</span>

    /**
     * Key used to lookup Color from UIManager. If this is null,
     * &lt;code&gt;getWindowTitleBackground&lt;/code&gt; is used.
     */
    private String selectedBackgroundKey;
    /**
     * Key used to lookup Color from UIManager. If this is null,
     * &lt;code&gt;getWindowTitleForeground&lt;/code&gt; is used.
     */
    private String selectedForegroundKey;
    /**
     * Key used to lookup shadow color from UIManager. If this is null,
     * &lt;code&gt;getPrimaryControlDarkShadow&lt;/code&gt; is used.
     */
    private String selectedShadowKey;
    /**
     * Boolean indicating the state of the &lt;code&gt;JInternalFrame&lt;/code&gt;s
     * closable property at &lt;code&gt;updateUI&lt;/code&gt; time.
     */
    private boolean wasClosable;

<span class="nc" id="L76">    int buttonsWidth = 0;</span>

<span class="nc" id="L78">    MetalBumps activeBumps</span>
        = new MetalBumps( 0, 0,
<span class="nc" id="L80">                          MetalLookAndFeel.getPrimaryControlHighlight(),</span>
<span class="nc" id="L81">                          MetalLookAndFeel.getPrimaryControlDarkShadow(),</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">          (UIManager.get(&quot;InternalFrame.activeTitleGradient&quot;) != null) ? null :</span>
<span class="nc" id="L83">                          MetalLookAndFeel.getPrimaryControl() );</span>
<span class="nc" id="L84">    MetalBumps inactiveBumps</span>
        = new MetalBumps( 0, 0,
<span class="nc" id="L86">                          MetalLookAndFeel.getControlHighlight(),</span>
<span class="nc" id="L87">                          MetalLookAndFeel.getControlDarkShadow(),</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        (UIManager.get(&quot;InternalFrame.inactiveTitleGradient&quot;) != null) ? null :</span>
<span class="nc" id="L89">                          MetalLookAndFeel.getControl() );</span>
    MetalBumps paletteBumps;

<span class="nc" id="L92">    private Color activeBumpsHighlight = MetalLookAndFeel.</span>
<span class="nc" id="L93">                             getPrimaryControlHighlight();</span>
<span class="nc" id="L94">    private Color activeBumpsShadow = MetalLookAndFeel.</span>
<span class="nc" id="L95">                             getPrimaryControlDarkShadow();</span>

    public MetalInternalFrameTitlePane(JInternalFrame f) {
<span class="nc" id="L98">        super( f );</span>
<span class="nc" id="L99">    }</span>

    public void addNotify() {
<span class="nc" id="L102">        super.addNotify();</span>
        // This is done here instead of in installDefaults as I was worried
        // that the BasicInternalFrameUI might not be fully initialized, and
        // that if this resets the closable state the BasicInternalFrameUI
        // Listeners that get notified might be in an odd/uninitialized state.
<span class="nc" id="L107">        updateOptionPaneState();</span>
<span class="nc" id="L108">    }</span>

    protected void installDefaults() {
<span class="nc" id="L111">        super.installDefaults();</span>
<span class="nc" id="L112">        setFont( UIManager.getFont(&quot;InternalFrame.titleFont&quot;) );</span>
<span class="nc" id="L113">        paletteTitleHeight</span>
<span class="nc" id="L114">            = UIManager.getInt(&quot;InternalFrame.paletteTitleHeight&quot;);</span>
<span class="nc" id="L115">        paletteCloseIcon = UIManager.getIcon(&quot;InternalFrame.paletteCloseIcon&quot;);</span>
<span class="nc" id="L116">        wasClosable = frame.isClosable();</span>
<span class="nc" id="L117">        selectedForegroundKey = selectedBackgroundKey = null;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (MetalLookAndFeel.usingOcean()) {</span>
<span class="nc" id="L119">            setOpaque(true);</span>
        }
<span class="nc" id="L121">    }</span>

    protected void uninstallDefaults() {
<span class="nc" id="L124">        super.uninstallDefaults();</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (wasClosable != frame.isClosable()) {</span>
<span class="nc" id="L126">            frame.setClosable(wasClosable);</span>
        }
<span class="nc" id="L128">    }</span>

    protected void createButtons() {
<span class="nc" id="L131">        super.createButtons();</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">        Boolean paintActive = frame.isSelected() ? Boolean.TRUE:Boolean.FALSE;</span>
<span class="nc" id="L134">        iconButton.putClientProperty(&quot;paintActive&quot;, paintActive);</span>
<span class="nc" id="L135">        iconButton.setBorder(handyEmptyBorder);</span>

<span class="nc" id="L137">        maxButton.putClientProperty(&quot;paintActive&quot;, paintActive);</span>
<span class="nc" id="L138">        maxButton.setBorder(handyEmptyBorder);</span>

<span class="nc" id="L140">        closeButton.putClientProperty(&quot;paintActive&quot;, paintActive);</span>
<span class="nc" id="L141">        closeButton.setBorder(handyEmptyBorder);</span>

        // The palette close icon isn't opaque while the regular close icon is.
        // This makes sure palette close buttons have the right background.
<span class="nc" id="L145">        closeButton.setBackground(MetalLookAndFeel.getPrimaryControlShadow());</span>

<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (MetalLookAndFeel.usingOcean()) {</span>
<span class="nc" id="L148">            iconButton.setContentAreaFilled(false);</span>
<span class="nc" id="L149">            maxButton.setContentAreaFilled(false);</span>
<span class="nc" id="L150">            closeButton.setContentAreaFilled(false);</span>
        }
<span class="nc" id="L152">    }</span>

    /**
     * Override the parent's method to do nothing. Metal frames do not
     * have system menus.
     */
<span class="nc" id="L158">    protected void assembleSystemMenu() {}</span>

    /**
     * Override the parent's method to do nothing. Metal frames do not
     * have system menus.
     */
<span class="nc" id="L164">    protected void addSystemMenuItems(JMenu systemMenu) {}</span>

    /**
     * Override the parent's method to do nothing. Metal frames do not
     * have system menus.
     */
<span class="nc" id="L170">    protected void showSystemMenu() {}</span>

    /**
     * Override the parent's method avoid creating a menu bar. Metal frames
     * do not have system menus.
     */
    protected void addSubComponents() {
<span class="nc" id="L177">        add(iconButton);</span>
<span class="nc" id="L178">        add(maxButton);</span>
<span class="nc" id="L179">        add(closeButton);</span>
<span class="nc" id="L180">    }</span>

    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L183">        return new MetalPropertyChangeHandler();</span>
    }

    protected LayoutManager createLayout() {
<span class="nc" id="L187">        return new MetalTitlePaneLayout();</span>
    }

<span class="nc" id="L190">    class MetalPropertyChangeHandler</span>
        extends BasicInternalFrameTitlePane.PropertyChangeHandler
    {
        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L194">            String prop = evt.getPropertyName();</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">            if( prop.equals(JInternalFrame.IS_SELECTED_PROPERTY) ) {</span>
<span class="nc" id="L196">                Boolean b = (Boolean)evt.getNewValue();</span>
<span class="nc" id="L197">                iconButton.putClientProperty(&quot;paintActive&quot;, b);</span>
<span class="nc" id="L198">                closeButton.putClientProperty(&quot;paintActive&quot;, b);</span>
<span class="nc" id="L199">                maxButton.putClientProperty(&quot;paintActive&quot;, b);</span>
<span class="nc" id="L200">            }</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">            else if (&quot;JInternalFrame.messageType&quot;.equals(prop)) {</span>
<span class="nc" id="L202">                updateOptionPaneState();</span>
<span class="nc" id="L203">                frame.repaint();</span>
            }
<span class="nc" id="L205">            super.propertyChange(evt);</span>
<span class="nc" id="L206">        }</span>
    }

<span class="nc" id="L209">    class MetalTitlePaneLayout extends TitlePaneLayout {</span>
<span class="nc" id="L210">        public void addLayoutComponent(String name, Component c) {}</span>
<span class="nc" id="L211">        public void removeLayoutComponent(Component c) {}</span>
        public Dimension preferredLayoutSize(Container c)  {
<span class="nc" id="L213">            return minimumLayoutSize(c);</span>
        }

        public Dimension minimumLayoutSize(Container c) {
            // Compute width.
<span class="nc" id="L218">            int width = 30;</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">            if (frame.isClosable()) {</span>
<span class="nc" id="L220">                width += 21;</span>
            }
<span class="nc bnc" id="L222" title="All 2 branches missed.">            if (frame.isMaximizable()) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                width += 16 + (frame.isClosable() ? 10 : 4);</span>
            }
<span class="nc bnc" id="L225" title="All 2 branches missed.">            if (frame.isIconifiable()) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                width += 16 + (frame.isMaximizable() ? 2 :</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">                    (frame.isClosable() ? 10 : 4));</span>
            }
<span class="nc" id="L229">            FontMetrics fm = frame.getFontMetrics(getFont());</span>
<span class="nc" id="L230">            String frameTitle = frame.getTitle();</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">            int title_w = frameTitle != null ? SwingUtilities2.stringWidth(</span>
<span class="nc" id="L232">                               frame, fm, frameTitle) : 0;</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">            int title_length = frameTitle != null ? frameTitle.length() : 0;</span>

<span class="nc bnc" id="L235" title="All 2 branches missed.">            if (title_length &gt; 2) {</span>
<span class="nc" id="L236">                int subtitle_w = SwingUtilities2.stringWidth(frame, fm,</span>
<span class="nc" id="L237">                                     frame.getTitle().substring(0, 2) + &quot;...&quot;);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">                width += (title_w &lt; subtitle_w) ? title_w : subtitle_w;</span>
<span class="nc" id="L239">            }</span>
            else {
<span class="nc" id="L241">                width += title_w;</span>
            }

            // Compute height.
            int height;
<span class="nc bnc" id="L246" title="All 2 branches missed.">            if (isPalette) {</span>
<span class="nc" id="L247">                height = paletteTitleHeight;</span>
            } else {
<span class="nc" id="L249">                int fontHeight = fm.getHeight();</span>
<span class="nc" id="L250">                fontHeight += 7;</span>
<span class="nc" id="L251">                Icon icon = frame.getFrameIcon();</span>
<span class="nc" id="L252">                int iconHeight = 0;</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                if (icon != null) {</span>
                    // SystemMenuBar forces the icon to be 16x16 or less.
<span class="nc" id="L255">                    iconHeight = Math.min(icon.getIconHeight(), 16);</span>
                }
<span class="nc" id="L257">                iconHeight += 5;</span>
<span class="nc" id="L258">                height = Math.max(fontHeight, iconHeight);</span>
            }

<span class="nc" id="L261">            return new Dimension(width, height);</span>
        }

        public void layoutContainer(Container c) {
<span class="nc" id="L265">            boolean leftToRight = MetalUtils.isLeftToRight(frame);</span>

<span class="nc" id="L267">            int w = getWidth();</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">            int x = leftToRight ? w : 0;</span>
<span class="nc" id="L269">            int y = 2;</span>
            int spacing;

            // assumes all buttons have the same dimensions
            // these dimensions include the borders
<span class="nc" id="L274">            int buttonHeight = closeButton.getIcon().getIconHeight();</span>
<span class="nc" id="L275">            int buttonWidth = closeButton.getIcon().getIconWidth();</span>

<span class="nc bnc" id="L277" title="All 2 branches missed.">            if(frame.isClosable()) {</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">                if (isPalette) {</span>
<span class="nc" id="L279">                    spacing = 3;</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">                    x += leftToRight ? -spacing -(buttonWidth+2) : spacing;</span>
<span class="nc" id="L281">                    closeButton.setBounds(x, y, buttonWidth+2, getHeight()-4);</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">                    if( !leftToRight ) x += (buttonWidth+2);</span>
                } else {
<span class="nc" id="L284">                    spacing = 4;</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                    x += leftToRight ? -spacing -buttonWidth : spacing;</span>
<span class="nc" id="L286">                    closeButton.setBounds(x, y, buttonWidth, buttonHeight);</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">                    if( !leftToRight ) x += buttonWidth;</span>
                }
            }

<span class="nc bnc" id="L291" title="All 4 branches missed.">            if(frame.isMaximizable() &amp;&amp; !isPalette ) {</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">                spacing = frame.isClosable() ? 10 : 4;</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">                x += leftToRight ? -spacing -buttonWidth : spacing;</span>
<span class="nc" id="L294">                maxButton.setBounds(x, y, buttonWidth, buttonHeight);</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">                if( !leftToRight ) x += buttonWidth;</span>
            }

<span class="nc bnc" id="L298" title="All 4 branches missed.">            if(frame.isIconifiable() &amp;&amp; !isPalette ) {</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">                spacing = frame.isMaximizable() ? 2</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                          : (frame.isClosable() ? 10 : 4);</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">                x += leftToRight ? -spacing -buttonWidth : spacing;</span>
<span class="nc" id="L302">                iconButton.setBounds(x, y, buttonWidth, buttonHeight);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">                if( !leftToRight ) x += buttonWidth;</span>
            }

<span class="nc bnc" id="L306" title="All 2 branches missed.">            buttonsWidth = leftToRight ? w - x : x;</span>
<span class="nc" id="L307">        }</span>
    }

    public void paintPalette(Graphics g)  {
<span class="nc" id="L311">        boolean leftToRight = MetalUtils.isLeftToRight(frame);</span>

<span class="nc" id="L313">        int width = getWidth();</span>
<span class="nc" id="L314">        int height = getHeight();</span>

<span class="nc bnc" id="L316" title="All 2 branches missed.">        if (paletteBumps == null) {</span>
<span class="nc" id="L317">            paletteBumps</span>
                = new MetalBumps(0, 0,
<span class="nc" id="L319">                                 MetalLookAndFeel.getPrimaryControlHighlight(),</span>
<span class="nc" id="L320">                                 MetalLookAndFeel.getPrimaryControlInfo(),</span>
<span class="nc" id="L321">                                 MetalLookAndFeel.getPrimaryControlShadow() );</span>
        }

<span class="nc" id="L324">        Color background = MetalLookAndFeel.getPrimaryControlShadow();</span>
<span class="nc" id="L325">        Color darkShadow = MetalLookAndFeel.getPrimaryControlDarkShadow();</span>

<span class="nc" id="L327">        g.setColor(background);</span>
<span class="nc" id="L328">        g.fillRect(0, 0, width, height);</span>

<span class="nc" id="L330">        g.setColor( darkShadow );</span>
<span class="nc" id="L331">        g.drawLine ( 0, height - 1, width, height -1);</span>

<span class="nc bnc" id="L333" title="All 2 branches missed.">        int xOffset = leftToRight ? 4 : buttonsWidth + 4;</span>
<span class="nc" id="L334">        int bumpLength = width - buttonsWidth -2*4;</span>
<span class="nc" id="L335">        int bumpHeight = getHeight()  - 4;</span>
<span class="nc" id="L336">        paletteBumps.setBumpArea( bumpLength, bumpHeight );</span>
<span class="nc" id="L337">        paletteBumps.paintIcon( this, g, xOffset, 2);</span>
<span class="nc" id="L338">    }</span>

    public void paintComponent(Graphics g)  {
<span class="nc bnc" id="L341" title="All 2 branches missed.">        if(isPalette) {</span>
<span class="nc" id="L342">            paintPalette(g);</span>
<span class="nc" id="L343">            return;</span>
        }

<span class="nc" id="L346">        boolean leftToRight = MetalUtils.isLeftToRight(frame);</span>
<span class="nc" id="L347">        boolean isSelected = frame.isSelected();</span>

<span class="nc" id="L349">        int width = getWidth();</span>
<span class="nc" id="L350">        int height = getHeight();</span>

<span class="nc" id="L352">        Color background = null;</span>
<span class="nc" id="L353">        Color foreground = null;</span>
<span class="nc" id="L354">        Color shadow = null;</span>

        MetalBumps bumps;
        String gradientKey;

<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (isSelected) {</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">            if (!MetalLookAndFeel.usingOcean()) {</span>
<span class="nc" id="L361">                closeButton.setContentAreaFilled(true);</span>
<span class="nc" id="L362">                maxButton.setContentAreaFilled(true);</span>
<span class="nc" id="L363">                iconButton.setContentAreaFilled(true);</span>
            }
<span class="nc bnc" id="L365" title="All 2 branches missed.">            if (selectedBackgroundKey != null) {</span>
<span class="nc" id="L366">                background = UIManager.getColor(selectedBackgroundKey);</span>
            }
<span class="nc bnc" id="L368" title="All 2 branches missed.">            if (background == null) {</span>
<span class="nc" id="L369">                background = MetalLookAndFeel.getWindowTitleBackground();</span>
            }
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (selectedForegroundKey != null) {</span>
<span class="nc" id="L372">                foreground = UIManager.getColor(selectedForegroundKey);</span>
            }
<span class="nc bnc" id="L374" title="All 2 branches missed.">            if (selectedShadowKey != null) {</span>
<span class="nc" id="L375">                shadow = UIManager.getColor(selectedShadowKey);</span>
            }
<span class="nc bnc" id="L377" title="All 2 branches missed.">            if (shadow == null) {</span>
<span class="nc" id="L378">                shadow = MetalLookAndFeel.getPrimaryControlDarkShadow();</span>
            }
<span class="nc bnc" id="L380" title="All 2 branches missed.">            if (foreground == null) {</span>
<span class="nc" id="L381">                foreground = MetalLookAndFeel.getWindowTitleForeground();</span>
            }
<span class="nc" id="L383">            activeBumps.setBumpColors(activeBumpsHighlight, activeBumpsShadow,</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">                        UIManager.get(&quot;InternalFrame.activeTitleGradient&quot;) !=</span>
                                      null ? null : background);
<span class="nc" id="L386">            bumps = activeBumps;</span>
<span class="nc" id="L387">            gradientKey = &quot;InternalFrame.activeTitleGradient&quot;;</span>
        } else {
<span class="nc bnc" id="L389" title="All 2 branches missed.">            if (!MetalLookAndFeel.usingOcean()) {</span>
<span class="nc" id="L390">                closeButton.setContentAreaFilled(false);</span>
<span class="nc" id="L391">                maxButton.setContentAreaFilled(false);</span>
<span class="nc" id="L392">                iconButton.setContentAreaFilled(false);</span>
            }
<span class="nc" id="L394">            background = MetalLookAndFeel.getWindowTitleInactiveBackground();</span>
<span class="nc" id="L395">            foreground = MetalLookAndFeel.getWindowTitleInactiveForeground();</span>
<span class="nc" id="L396">            shadow = MetalLookAndFeel.getControlDarkShadow();</span>
<span class="nc" id="L397">            bumps = inactiveBumps;</span>
<span class="nc" id="L398">            gradientKey = &quot;InternalFrame.inactiveTitleGradient&quot;;</span>
        }

<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (!MetalUtils.drawGradient(this, g, gradientKey, 0, 0, width,</span>
                                     height, true)) {
<span class="nc" id="L403">            g.setColor(background);</span>
<span class="nc" id="L404">            g.fillRect(0, 0, width, height);</span>
        }

<span class="nc" id="L407">        g.setColor( shadow );</span>
<span class="nc" id="L408">        g.drawLine ( 0, height - 1, width, height -1);</span>
<span class="nc" id="L409">        g.drawLine ( 0, 0, 0 ,0);</span>
<span class="nc" id="L410">        g.drawLine ( width - 1, 0 , width -1, 0);</span>


        int titleLength;
<span class="nc bnc" id="L414" title="All 2 branches missed.">        int xOffset = leftToRight ? 5 : width - 5;</span>
<span class="nc" id="L415">        String frameTitle = frame.getTitle();</span>

<span class="nc" id="L417">        Icon icon = frame.getFrameIcon();</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">        if ( icon != null ) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">            if( !leftToRight )</span>
<span class="nc" id="L420">                xOffset -= icon.getIconWidth();</span>
<span class="nc" id="L421">            int iconY = ((height / 2) - (icon.getIconHeight() /2));</span>
<span class="nc" id="L422">            icon.paintIcon(frame, g, xOffset, iconY);</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">            xOffset += leftToRight ? icon.getIconWidth() + 5 : -5;</span>
        }

<span class="nc bnc" id="L426" title="All 2 branches missed.">        if(frameTitle != null) {</span>
<span class="nc" id="L427">            Font f = getFont();</span>
<span class="nc" id="L428">            g.setFont(f);</span>
<span class="nc" id="L429">            FontMetrics fm = SwingUtilities2.getFontMetrics(frame, g, f);</span>
<span class="nc" id="L430">            int fHeight = fm.getHeight();</span>

<span class="nc" id="L432">            g.setColor(foreground);</span>

<span class="nc" id="L434">            int yOffset = ( (height - fm.getHeight() ) / 2 ) + fm.getAscent();</span>

<span class="nc" id="L436">            Rectangle rect = new Rectangle(0, 0, 0, 0);</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">            if (frame.isIconifiable()) { rect = iconButton.getBounds(); }</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            else if (frame.isMaximizable()) { rect = maxButton.getBounds(); }</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">            else if (frame.isClosable()) { rect = closeButton.getBounds(); }</span>
            int titleW;

<span class="nc bnc" id="L442" title="All 2 branches missed.">            if( leftToRight ) {</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">              if (rect.x == 0) {</span>
<span class="nc" id="L444">                rect.x = frame.getWidth()-frame.getInsets().right-2;</span>
              }
<span class="nc" id="L446">              titleW = rect.x - xOffset - 4;</span>
<span class="nc" id="L447">              frameTitle = getTitle(frameTitle, fm, titleW);</span>
            } else {
<span class="nc" id="L449">              titleW = xOffset - rect.x - rect.width - 4;</span>
<span class="nc" id="L450">              frameTitle = getTitle(frameTitle, fm, titleW);</span>
<span class="nc" id="L451">              xOffset -= SwingUtilities2.stringWidth(frame, fm, frameTitle);</span>
            }

<span class="nc" id="L454">            titleLength = SwingUtilities2.stringWidth(frame, fm, frameTitle);</span>
<span class="nc" id="L455">            SwingUtilities2.drawString(frame, g, frameTitle, xOffset, yOffset);</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">            xOffset += leftToRight ? titleLength + 5  : -5;</span>
        }

        int bumpXOffset;
        int bumpLength;
<span class="nc bnc" id="L461" title="All 2 branches missed.">        if( leftToRight ) {</span>
<span class="nc" id="L462">            bumpLength = width - buttonsWidth - xOffset - 5;</span>
<span class="nc" id="L463">            bumpXOffset = xOffset;</span>
        } else {
<span class="nc" id="L465">            bumpLength = xOffset - buttonsWidth - 5;</span>
<span class="nc" id="L466">            bumpXOffset = buttonsWidth + 5;</span>
        }
<span class="nc" id="L468">        int bumpYOffset = 3;</span>
<span class="nc" id="L469">        int bumpHeight = getHeight() - (2 * bumpYOffset);</span>
<span class="nc" id="L470">        bumps.setBumpArea( bumpLength, bumpHeight );</span>
<span class="nc" id="L471">        bumps.paintIcon(this, g, bumpXOffset, bumpYOffset);</span>
<span class="nc" id="L472">    }</span>

    public void setPalette(boolean b) {
<span class="nc" id="L475">        isPalette = b;</span>

<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (isPalette) {</span>
<span class="nc" id="L478">            closeButton.setIcon(paletteCloseIcon);</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">         if( frame.isMaximizable() )</span>
<span class="nc" id="L480">                remove(maxButton);</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">            if( frame.isIconifiable() )</span>
<span class="nc" id="L482">                remove(iconButton);</span>
        } else {
<span class="nc" id="L484">            closeButton.setIcon(closeIcon);</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">            if( frame.isMaximizable() )</span>
<span class="nc" id="L486">                add(maxButton);</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">            if( frame.isIconifiable() )</span>
<span class="nc" id="L488">                add(iconButton);</span>
        }
<span class="nc" id="L490">        revalidate();</span>
<span class="nc" id="L491">        repaint();</span>
<span class="nc" id="L492">    }</span>

    /**
     * Updates any state dependant upon the JInternalFrame being shown in
     * a &lt;code&gt;JOptionPane&lt;/code&gt;.
     */
    private void updateOptionPaneState() {
<span class="nc" id="L499">        int type = -2;</span>
<span class="nc" id="L500">        boolean closable = wasClosable;</span>
<span class="nc" id="L501">        Object obj = frame.getClientProperty(&quot;JInternalFrame.messageType&quot;);</span>

<span class="nc bnc" id="L503" title="All 2 branches missed.">        if (obj == null) {</span>
            // Don't change the closable state unless in an JOptionPane.
<span class="nc" id="L505">            return;</span>
        }
<span class="nc bnc" id="L507" title="All 2 branches missed.">        if (obj instanceof Integer) {</span>
<span class="nc" id="L508">            type = ((Integer) obj).intValue();</span>
        }
<span class="nc bnc" id="L510" title="All 5 branches missed.">        switch (type) {</span>
        case JOptionPane.ERROR_MESSAGE:
<span class="nc" id="L512">            selectedBackgroundKey =</span>
                              &quot;OptionPane.errorDialog.titlePane.background&quot;;
<span class="nc" id="L514">            selectedForegroundKey =</span>
                              &quot;OptionPane.errorDialog.titlePane.foreground&quot;;
<span class="nc" id="L516">            selectedShadowKey = &quot;OptionPane.errorDialog.titlePane.shadow&quot;;</span>
<span class="nc" id="L517">            closable = false;</span>
<span class="nc" id="L518">            break;</span>
        case JOptionPane.QUESTION_MESSAGE:
<span class="nc" id="L520">            selectedBackgroundKey =</span>
                            &quot;OptionPane.questionDialog.titlePane.background&quot;;
<span class="nc" id="L522">            selectedForegroundKey =</span>
                    &quot;OptionPane.questionDialog.titlePane.foreground&quot;;
<span class="nc" id="L524">            selectedShadowKey =</span>
                          &quot;OptionPane.questionDialog.titlePane.shadow&quot;;
<span class="nc" id="L526">            closable = false;</span>
<span class="nc" id="L527">            break;</span>
        case JOptionPane.WARNING_MESSAGE:
<span class="nc" id="L529">            selectedBackgroundKey =</span>
                              &quot;OptionPane.warningDialog.titlePane.background&quot;;
<span class="nc" id="L531">            selectedForegroundKey =</span>
                              &quot;OptionPane.warningDialog.titlePane.foreground&quot;;
<span class="nc" id="L533">            selectedShadowKey = &quot;OptionPane.warningDialog.titlePane.shadow&quot;;</span>
<span class="nc" id="L534">            closable = false;</span>
<span class="nc" id="L535">            break;</span>
        case JOptionPane.INFORMATION_MESSAGE:
        case JOptionPane.PLAIN_MESSAGE:
<span class="nc" id="L538">            selectedBackgroundKey = selectedForegroundKey = selectedShadowKey =</span>
                                    null;
<span class="nc" id="L540">            closable = false;</span>
<span class="nc" id="L541">            break;</span>
        default:
<span class="nc" id="L543">            selectedBackgroundKey = selectedForegroundKey = selectedShadowKey =</span>
                                    null;
            break;
        }
<span class="nc bnc" id="L547" title="All 2 branches missed.">        if (closable != frame.isClosable()) {</span>
<span class="nc" id="L548">            frame.setClosable(closable);</span>
        }
<span class="nc" id="L550">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>