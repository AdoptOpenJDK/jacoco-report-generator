<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MetalFileChooserUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.metal</a> &gt; <span class="el_source">MetalFileChooserUI.java</span></div><h1>MetalFileChooserUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.metal;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import javax.swing.filechooser.*;
import javax.swing.event.*;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.*;
import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.*;
import java.security.AccessController;
import java.security.PrivilegedAction;
import javax.accessibility.*;

import sun.awt.shell.ShellFolder;
import sun.swing.*;

/**
 * Metal L&amp;amp;F implementation of a FileChooser.
 *
 * @author Jeff Dinkins
 */
public class MetalFileChooserUI extends BasicFileChooserUI {

    // Much of the Metal UI for JFilechooser is just a copy of
    // the windows implementation, but using Metal themed buttons, lists,
    // icons, etc. We are planning a complete rewrite, and hence we've
    // made most things in this class private.

    private JLabel lookInLabel;
    private JComboBox directoryComboBox;
    private DirectoryComboBoxModel directoryComboBoxModel;
<span class="nc" id="L63">    private Action directoryComboBoxAction = new DirectoryComboBoxAction();</span>

    private FilterComboBoxModel filterComboBoxModel;

    private JTextField fileNameTextField;

    private FilePane filePane;
    private JToggleButton listViewButton;
    private JToggleButton detailsViewButton;

    private JButton approveButton;
    private JButton cancelButton;

    private JPanel buttonPanel;
    private JPanel bottomPanel;

    private JComboBox filterComboBox;

<span class="nc" id="L81">    private static final Dimension hstrut5 = new Dimension(5, 1);</span>
<span class="nc" id="L82">    private static final Dimension hstrut11 = new Dimension(11, 1);</span>

<span class="nc" id="L84">    private static final Dimension vstrut5  = new Dimension(1, 5);</span>

<span class="nc" id="L86">    private static final Insets shrinkwrap = new Insets(0,0,0,0);</span>

    // Preferred and Minimum sizes for the dialog box
<span class="nc" id="L89">    private static int PREF_WIDTH = 500;</span>
<span class="nc" id="L90">    private static int PREF_HEIGHT = 326;</span>
<span class="nc" id="L91">    private static Dimension PREF_SIZE = new Dimension(PREF_WIDTH, PREF_HEIGHT);</span>

<span class="nc" id="L93">    private static int MIN_WIDTH = 500;</span>
<span class="nc" id="L94">    private static int MIN_HEIGHT = 326;</span>
<span class="nc" id="L95">    private static Dimension MIN_SIZE = new Dimension(MIN_WIDTH, MIN_HEIGHT);</span>

<span class="nc" id="L97">    private static int LIST_PREF_WIDTH = 405;</span>
<span class="nc" id="L98">    private static int LIST_PREF_HEIGHT = 135;</span>
<span class="nc" id="L99">    private static Dimension LIST_PREF_SIZE = new Dimension(LIST_PREF_WIDTH, LIST_PREF_HEIGHT);</span>

    // Labels, mnemonics, and tooltips (oh my!)
<span class="nc" id="L102">    private int    lookInLabelMnemonic = 0;</span>
<span class="nc" id="L103">    private String lookInLabelText = null;</span>
<span class="nc" id="L104">    private String saveInLabelText = null;</span>

<span class="nc" id="L106">    private int    fileNameLabelMnemonic = 0;</span>
<span class="nc" id="L107">    private String fileNameLabelText = null;</span>
<span class="nc" id="L108">    private int    folderNameLabelMnemonic = 0;</span>
<span class="nc" id="L109">    private String folderNameLabelText = null;</span>

<span class="nc" id="L111">    private int    filesOfTypeLabelMnemonic = 0;</span>
<span class="nc" id="L112">    private String filesOfTypeLabelText = null;</span>

<span class="nc" id="L114">    private String upFolderToolTipText = null;</span>
<span class="nc" id="L115">    private String upFolderAccessibleName = null;</span>

<span class="nc" id="L117">    private String homeFolderToolTipText = null;</span>
<span class="nc" id="L118">    private String homeFolderAccessibleName = null;</span>

<span class="nc" id="L120">    private String newFolderToolTipText = null;</span>
<span class="nc" id="L121">    private String newFolderAccessibleName = null;</span>

<span class="nc" id="L123">    private String listViewButtonToolTipText = null;</span>
<span class="nc" id="L124">    private String listViewButtonAccessibleName = null;</span>

<span class="nc" id="L126">    private String detailsViewButtonToolTipText = null;</span>
<span class="nc" id="L127">    private String detailsViewButtonAccessibleName = null;</span>

    private AlignedLabel fileNameLabel;

    private void populateFileNameLabel() {
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (getFileChooser().getFileSelectionMode() == JFileChooser.DIRECTORIES_ONLY) {</span>
<span class="nc" id="L133">            fileNameLabel.setText(folderNameLabelText);</span>
<span class="nc" id="L134">            fileNameLabel.setDisplayedMnemonic(folderNameLabelMnemonic);</span>
        } else {
<span class="nc" id="L136">            fileNameLabel.setText(fileNameLabelText);</span>
<span class="nc" id="L137">            fileNameLabel.setDisplayedMnemonic(fileNameLabelMnemonic);</span>
        }
<span class="nc" id="L139">    }</span>

    //
    // ComponentUI Interface Implementation methods
    //
    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L145">        return new MetalFileChooserUI((JFileChooser) c);</span>
    }

    public MetalFileChooserUI(JFileChooser filechooser) {
<span class="nc" id="L149">        super(filechooser);</span>
<span class="nc" id="L150">    }</span>

    public void installUI(JComponent c) {
<span class="nc" id="L153">        super.installUI(c);</span>
<span class="nc" id="L154">    }</span>

    public void uninstallComponents(JFileChooser fc) {
<span class="nc" id="L157">        fc.removeAll();</span>
<span class="nc" id="L158">        bottomPanel = null;</span>
<span class="nc" id="L159">        buttonPanel = null;</span>
<span class="nc" id="L160">    }</span>

<span class="nc" id="L162">    private class MetalFileChooserUIAccessor implements FilePane.FileChooserUIAccessor {</span>
        public JFileChooser getFileChooser() {
<span class="nc" id="L164">            return MetalFileChooserUI.this.getFileChooser();</span>
        }

        public BasicDirectoryModel getModel() {
<span class="nc" id="L168">            return MetalFileChooserUI.this.getModel();</span>
        }

        public JPanel createList() {
<span class="nc" id="L172">            return MetalFileChooserUI.this.createList(getFileChooser());</span>
        }

        public JPanel createDetailsView() {
<span class="nc" id="L176">            return MetalFileChooserUI.this.createDetailsView(getFileChooser());</span>
        }

        public boolean isDirectorySelected() {
<span class="nc" id="L180">            return MetalFileChooserUI.this.isDirectorySelected();</span>
        }

        public File getDirectory() {
<span class="nc" id="L184">            return MetalFileChooserUI.this.getDirectory();</span>
        }

        public Action getChangeToParentDirectoryAction() {
<span class="nc" id="L188">            return MetalFileChooserUI.this.getChangeToParentDirectoryAction();</span>
        }

        public Action getApproveSelectionAction() {
<span class="nc" id="L192">            return MetalFileChooserUI.this.getApproveSelectionAction();</span>
        }

        public Action getNewFolderAction() {
<span class="nc" id="L196">            return MetalFileChooserUI.this.getNewFolderAction();</span>
        }

        public MouseListener createDoubleClickListener(JList list) {
<span class="nc" id="L200">            return MetalFileChooserUI.this.createDoubleClickListener(getFileChooser(),</span>
                                                                     list);
        }

        public ListSelectionListener createListSelectionListener() {
<span class="nc" id="L205">            return MetalFileChooserUI.this.createListSelectionListener(getFileChooser());</span>
        }
    }

    public void installComponents(JFileChooser fc) {
<span class="nc" id="L210">        FileSystemView fsv = fc.getFileSystemView();</span>

<span class="nc" id="L212">        fc.setBorder(new EmptyBorder(12, 12, 11, 11));</span>
<span class="nc" id="L213">        fc.setLayout(new BorderLayout(0, 11));</span>

<span class="nc" id="L215">        filePane = new FilePane(new MetalFileChooserUIAccessor());</span>
<span class="nc" id="L216">        fc.addPropertyChangeListener(filePane);</span>

        // ********************************* //
        // **** Construct the top panel **** //
        // ********************************* //

        // Directory manipulation buttons
<span class="nc" id="L223">        JPanel topPanel = new JPanel(new BorderLayout(11, 0));</span>
<span class="nc" id="L224">        JPanel topButtonPanel = new JPanel();</span>
<span class="nc" id="L225">        topButtonPanel.setLayout(new BoxLayout(topButtonPanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L226">        topPanel.add(topButtonPanel, BorderLayout.AFTER_LINE_ENDS);</span>

        // Add the top panel to the fileChooser
<span class="nc" id="L229">        fc.add(topPanel, BorderLayout.NORTH);</span>

        // ComboBox Label
<span class="nc" id="L232">        lookInLabel = new JLabel(lookInLabelText);</span>
<span class="nc" id="L233">        lookInLabel.setDisplayedMnemonic(lookInLabelMnemonic);</span>
<span class="nc" id="L234">        topPanel.add(lookInLabel, BorderLayout.BEFORE_LINE_BEGINS);</span>

        // CurrentDir ComboBox
<span class="nc" id="L237">        directoryComboBox = new JComboBox() {</span>
            public Dimension getPreferredSize() {
<span class="nc" id="L239">                Dimension d = super.getPreferredSize();</span>
                // Must be small enough to not affect total width.
<span class="nc" id="L241">                d.width = 150;</span>
<span class="nc" id="L242">                return d;</span>
            }
        };
<span class="nc" id="L245">        directoryComboBox.putClientProperty(AccessibleContext.ACCESSIBLE_DESCRIPTION_PROPERTY,</span>
                                            lookInLabelText);
<span class="nc" id="L247">        directoryComboBox.putClientProperty( &quot;JComboBox.isTableCellEditor&quot;, Boolean.TRUE );</span>
<span class="nc" id="L248">        lookInLabel.setLabelFor(directoryComboBox);</span>
<span class="nc" id="L249">        directoryComboBoxModel = createDirectoryComboBoxModel(fc);</span>
<span class="nc" id="L250">        directoryComboBox.setModel(directoryComboBoxModel);</span>
<span class="nc" id="L251">        directoryComboBox.addActionListener(directoryComboBoxAction);</span>
<span class="nc" id="L252">        directoryComboBox.setRenderer(createDirectoryComboBoxRenderer(fc));</span>
<span class="nc" id="L253">        directoryComboBox.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L254">        directoryComboBox.setAlignmentY(JComponent.TOP_ALIGNMENT);</span>
<span class="nc" id="L255">        directoryComboBox.setMaximumRowCount(8);</span>

<span class="nc" id="L257">        topPanel.add(directoryComboBox, BorderLayout.CENTER);</span>

        // Up Button
<span class="nc" id="L260">        JButton upFolderButton = new JButton(getChangeToParentDirectoryAction());</span>
<span class="nc" id="L261">        upFolderButton.setText(null);</span>
<span class="nc" id="L262">        upFolderButton.setIcon(upFolderIcon);</span>
<span class="nc" id="L263">        upFolderButton.setToolTipText(upFolderToolTipText);</span>
<span class="nc" id="L264">        upFolderButton.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                         upFolderAccessibleName);
<span class="nc" id="L266">        upFolderButton.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L267">        upFolderButton.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L268">        upFolderButton.setMargin(shrinkwrap);</span>

<span class="nc" id="L270">        topButtonPanel.add(upFolderButton);</span>
<span class="nc" id="L271">        topButtonPanel.add(Box.createRigidArea(hstrut5));</span>

        // Home Button
<span class="nc" id="L274">        File homeDir = fsv.getHomeDirectory();</span>
<span class="nc" id="L275">        String toolTipText = homeFolderToolTipText;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">        if (fsv.isRoot(homeDir)) {</span>
<span class="nc" id="L277">            toolTipText = getFileView(fc).getName(homeDir); // Probably &quot;Desktop&quot;.</span>
        }




<span class="nc" id="L283">        JButton b = new JButton(homeFolderIcon);</span>
<span class="nc" id="L284">        b.setToolTipText(toolTipText);</span>
<span class="nc" id="L285">        b.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                            homeFolderAccessibleName);
<span class="nc" id="L287">        b.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L288">        b.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L289">        b.setMargin(shrinkwrap);</span>

<span class="nc" id="L291">        b.addActionListener(getGoHomeAction());</span>
<span class="nc" id="L292">        topButtonPanel.add(b);</span>
<span class="nc" id="L293">        topButtonPanel.add(Box.createRigidArea(hstrut5));</span>

        // New Directory Button
<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (!UIManager.getBoolean(&quot;FileChooser.readOnly&quot;)) {</span>
<span class="nc" id="L297">            b = new JButton(filePane.getNewFolderAction());</span>
<span class="nc" id="L298">            b.setText(null);</span>
<span class="nc" id="L299">            b.setIcon(newFolderIcon);</span>
<span class="nc" id="L300">            b.setToolTipText(newFolderToolTipText);</span>
<span class="nc" id="L301">            b.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                newFolderAccessibleName);
<span class="nc" id="L303">            b.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L304">            b.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L305">            b.setMargin(shrinkwrap);</span>
        }
<span class="nc" id="L307">        topButtonPanel.add(b);</span>
<span class="nc" id="L308">        topButtonPanel.add(Box.createRigidArea(hstrut5));</span>

        // View button group
<span class="nc" id="L311">        ButtonGroup viewButtonGroup = new ButtonGroup();</span>

        // List Button
<span class="nc" id="L314">        listViewButton = new JToggleButton(listViewIcon);</span>
<span class="nc" id="L315">        listViewButton.setToolTipText(listViewButtonToolTipText);</span>
<span class="nc" id="L316">        listViewButton.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                         listViewButtonAccessibleName);
<span class="nc" id="L318">        listViewButton.setSelected(true);</span>
<span class="nc" id="L319">        listViewButton.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L320">        listViewButton.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L321">        listViewButton.setMargin(shrinkwrap);</span>
<span class="nc" id="L322">        listViewButton.addActionListener(filePane.getViewTypeAction(FilePane.VIEWTYPE_LIST));</span>
<span class="nc" id="L323">        topButtonPanel.add(listViewButton);</span>
<span class="nc" id="L324">        viewButtonGroup.add(listViewButton);</span>

        // Details Button
<span class="nc" id="L327">        detailsViewButton = new JToggleButton(detailsViewIcon);</span>
<span class="nc" id="L328">        detailsViewButton.setToolTipText(detailsViewButtonToolTipText);</span>
<span class="nc" id="L329">        detailsViewButton.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                            detailsViewButtonAccessibleName);
<span class="nc" id="L331">        detailsViewButton.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L332">        detailsViewButton.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L333">        detailsViewButton.setMargin(shrinkwrap);</span>
<span class="nc" id="L334">        detailsViewButton.addActionListener(filePane.getViewTypeAction(FilePane.VIEWTYPE_DETAILS));</span>
<span class="nc" id="L335">        topButtonPanel.add(detailsViewButton);</span>
<span class="nc" id="L336">        viewButtonGroup.add(detailsViewButton);</span>

<span class="nc" id="L338">        filePane.addPropertyChangeListener(new PropertyChangeListener() {</span>
            public void propertyChange(PropertyChangeEvent e) {
<span class="nc bnc" id="L340" title="All 2 branches missed.">                if (&quot;viewType&quot;.equals(e.getPropertyName())) {</span>
<span class="nc" id="L341">                    int viewType = filePane.getViewType();</span>
<span class="nc bnc" id="L342" title="All 3 branches missed.">                    switch (viewType) {</span>
                      case FilePane.VIEWTYPE_LIST:
<span class="nc" id="L344">                        listViewButton.setSelected(true);</span>
<span class="nc" id="L345">                        break;</span>

                      case FilePane.VIEWTYPE_DETAILS:
<span class="nc" id="L348">                        detailsViewButton.setSelected(true);</span>
                        break;
                    }
                }
<span class="nc" id="L352">            }</span>
        });

        // ************************************** //
        // ******* Add the directory pane ******* //
        // ************************************** //
<span class="nc" id="L358">        fc.add(getAccessoryPanel(), BorderLayout.AFTER_LINE_ENDS);</span>
<span class="nc" id="L359">        JComponent accessory = fc.getAccessory();</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">        if(accessory != null) {</span>
<span class="nc" id="L361">            getAccessoryPanel().add(accessory);</span>
        }
<span class="nc" id="L363">        filePane.setPreferredSize(LIST_PREF_SIZE);</span>
<span class="nc" id="L364">        fc.add(filePane, BorderLayout.CENTER);</span>

        // ********************************** //
        // **** Construct the bottom panel ** //
        // ********************************** //
<span class="nc" id="L369">        JPanel bottomPanel = getBottomPanel();</span>
<span class="nc" id="L370">        bottomPanel.setLayout(new BoxLayout(bottomPanel, BoxLayout.Y_AXIS));</span>
<span class="nc" id="L371">        fc.add(bottomPanel, BorderLayout.SOUTH);</span>

        // FileName label and textfield
<span class="nc" id="L374">        JPanel fileNamePanel = new JPanel();</span>
<span class="nc" id="L375">        fileNamePanel.setLayout(new BoxLayout(fileNamePanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L376">        bottomPanel.add(fileNamePanel);</span>
<span class="nc" id="L377">        bottomPanel.add(Box.createRigidArea(vstrut5));</span>

<span class="nc" id="L379">        fileNameLabel = new AlignedLabel();</span>
<span class="nc" id="L380">        populateFileNameLabel();</span>
<span class="nc" id="L381">        fileNamePanel.add(fileNameLabel);</span>

<span class="nc" id="L383">        fileNameTextField = new JTextField(35) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L385">                return new Dimension(Short.MAX_VALUE, super.getPreferredSize().height);</span>
            }
        };
<span class="nc" id="L388">        fileNamePanel.add(fileNameTextField);</span>
<span class="nc" id="L389">        fileNameLabel.setLabelFor(fileNameTextField);</span>
<span class="nc" id="L390">        fileNameTextField.addFocusListener(</span>
<span class="nc" id="L391">            new FocusAdapter() {</span>
                public void focusGained(FocusEvent e) {
<span class="nc bnc" id="L393" title="All 2 branches missed.">                    if (!getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L394">                        filePane.clearSelection();</span>
                    }
<span class="nc" id="L396">                }</span>
            }
        );
<span class="nc bnc" id="L399" title="All 2 branches missed.">        if (fc.isMultiSelectionEnabled()) {</span>
<span class="nc" id="L400">            setFileName(fileNameString(fc.getSelectedFiles()));</span>
        } else {
<span class="nc" id="L402">            setFileName(fileNameString(fc.getSelectedFile()));</span>
        }


        // Filetype label and combobox
<span class="nc" id="L407">        JPanel filesOfTypePanel = new JPanel();</span>
<span class="nc" id="L408">        filesOfTypePanel.setLayout(new BoxLayout(filesOfTypePanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L409">        bottomPanel.add(filesOfTypePanel);</span>

<span class="nc" id="L411">        AlignedLabel filesOfTypeLabel = new AlignedLabel(filesOfTypeLabelText);</span>
<span class="nc" id="L412">        filesOfTypeLabel.setDisplayedMnemonic(filesOfTypeLabelMnemonic);</span>
<span class="nc" id="L413">        filesOfTypePanel.add(filesOfTypeLabel);</span>

<span class="nc" id="L415">        filterComboBoxModel = createFilterComboBoxModel();</span>
<span class="nc" id="L416">        fc.addPropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L417">        filterComboBox = new JComboBox(filterComboBoxModel);</span>
<span class="nc" id="L418">        filterComboBox.putClientProperty(AccessibleContext.ACCESSIBLE_DESCRIPTION_PROPERTY,</span>
                                         filesOfTypeLabelText);
<span class="nc" id="L420">        filesOfTypeLabel.setLabelFor(filterComboBox);</span>
<span class="nc" id="L421">        filterComboBox.setRenderer(createFilterComboBoxRenderer());</span>
<span class="nc" id="L422">        filesOfTypePanel.add(filterComboBox);</span>

        // buttons
<span class="nc" id="L425">        getButtonPanel().setLayout(new ButtonAreaLayout());</span>

<span class="nc" id="L427">        approveButton = new JButton(getApproveButtonText(fc));</span>
        // Note: Metal does not use mnemonics for approve and cancel
<span class="nc" id="L429">        approveButton.addActionListener(getApproveSelectionAction());</span>
<span class="nc" id="L430">        approveButton.setToolTipText(getApproveButtonToolTipText(fc));</span>
<span class="nc" id="L431">        getButtonPanel().add(approveButton);</span>

<span class="nc" id="L433">        cancelButton = new JButton(cancelButtonText);</span>
<span class="nc" id="L434">        cancelButton.setToolTipText(cancelButtonToolTipText);</span>
<span class="nc" id="L435">        cancelButton.addActionListener(getCancelSelectionAction());</span>
<span class="nc" id="L436">        getButtonPanel().add(cancelButton);</span>

<span class="nc bnc" id="L438" title="All 2 branches missed.">        if(fc.getControlButtonsAreShown()) {</span>
<span class="nc" id="L439">            addControlButtons();</span>
        }

<span class="nc" id="L442">        groupLabels(new AlignedLabel[] { fileNameLabel, filesOfTypeLabel });</span>
<span class="nc" id="L443">    }</span>

    protected JPanel getButtonPanel() {
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if (buttonPanel == null) {</span>
<span class="nc" id="L447">            buttonPanel = new JPanel();</span>
        }
<span class="nc" id="L449">        return buttonPanel;</span>
    }

    protected JPanel getBottomPanel() {
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if(bottomPanel == null) {</span>
<span class="nc" id="L454">            bottomPanel = new JPanel();</span>
        }
<span class="nc" id="L456">        return bottomPanel;</span>
    }

    protected void installStrings(JFileChooser fc) {
<span class="nc" id="L460">        super.installStrings(fc);</span>

<span class="nc" id="L462">        Locale l = fc.getLocale();</span>

<span class="nc" id="L464">        lookInLabelMnemonic = getMnemonic(&quot;FileChooser.lookInLabelMnemonic&quot;, l);</span>
<span class="nc" id="L465">        lookInLabelText = UIManager.getString(&quot;FileChooser.lookInLabelText&quot;,l);</span>
<span class="nc" id="L466">        saveInLabelText = UIManager.getString(&quot;FileChooser.saveInLabelText&quot;,l);</span>

<span class="nc" id="L468">        fileNameLabelMnemonic = getMnemonic(&quot;FileChooser.fileNameLabelMnemonic&quot;, l);</span>
<span class="nc" id="L469">        fileNameLabelText = UIManager.getString(&quot;FileChooser.fileNameLabelText&quot;,l);</span>
<span class="nc" id="L470">        folderNameLabelMnemonic = getMnemonic(&quot;FileChooser.folderNameLabelMnemonic&quot;, l);</span>
<span class="nc" id="L471">        folderNameLabelText = UIManager.getString(&quot;FileChooser.folderNameLabelText&quot;,l);</span>

<span class="nc" id="L473">        filesOfTypeLabelMnemonic = getMnemonic(&quot;FileChooser.filesOfTypeLabelMnemonic&quot;, l);</span>
<span class="nc" id="L474">        filesOfTypeLabelText = UIManager.getString(&quot;FileChooser.filesOfTypeLabelText&quot;,l);</span>

<span class="nc" id="L476">        upFolderToolTipText =  UIManager.getString(&quot;FileChooser.upFolderToolTipText&quot;,l);</span>
<span class="nc" id="L477">        upFolderAccessibleName = UIManager.getString(&quot;FileChooser.upFolderAccessibleName&quot;,l);</span>

<span class="nc" id="L479">        homeFolderToolTipText =  UIManager.getString(&quot;FileChooser.homeFolderToolTipText&quot;,l);</span>
<span class="nc" id="L480">        homeFolderAccessibleName = UIManager.getString(&quot;FileChooser.homeFolderAccessibleName&quot;,l);</span>

<span class="nc" id="L482">        newFolderToolTipText = UIManager.getString(&quot;FileChooser.newFolderToolTipText&quot;,l);</span>
<span class="nc" id="L483">        newFolderAccessibleName = UIManager.getString(&quot;FileChooser.newFolderAccessibleName&quot;,l);</span>

<span class="nc" id="L485">        listViewButtonToolTipText = UIManager.getString(&quot;FileChooser.listViewButtonToolTipText&quot;,l);</span>
<span class="nc" id="L486">        listViewButtonAccessibleName = UIManager.getString(&quot;FileChooser.listViewButtonAccessibleName&quot;,l);</span>

<span class="nc" id="L488">        detailsViewButtonToolTipText = UIManager.getString(&quot;FileChooser.detailsViewButtonToolTipText&quot;,l);</span>
<span class="nc" id="L489">        detailsViewButtonAccessibleName = UIManager.getString(&quot;FileChooser.detailsViewButtonAccessibleName&quot;,l);</span>
<span class="nc" id="L490">    }</span>

    private Integer getMnemonic(String key, Locale l) {
<span class="nc" id="L493">        return SwingUtilities2.getUIDefaultsInt(key, l);</span>
    }

    protected void installListeners(JFileChooser fc) {
<span class="nc" id="L497">        super.installListeners(fc);</span>
<span class="nc" id="L498">        ActionMap actionMap = getActionMap();</span>
<span class="nc" id="L499">        SwingUtilities.replaceUIActionMap(fc, actionMap);</span>
<span class="nc" id="L500">    }</span>

    protected ActionMap getActionMap() {
<span class="nc" id="L503">        return createActionMap();</span>
    }

    protected ActionMap createActionMap() {
<span class="nc" id="L507">        ActionMap map = new ActionMapUIResource();</span>
<span class="nc" id="L508">        FilePane.addActionsToMap(map, filePane.getActions());</span>
<span class="nc" id="L509">        return map;</span>
    }

    protected JPanel createList(JFileChooser fc) {
<span class="nc" id="L513">        return filePane.createList();</span>
    }

    protected JPanel createDetailsView(JFileChooser fc) {
<span class="nc" id="L517">        return filePane.createDetailsView();</span>
    }

    /**
     * Creates a selection listener for the list of files and directories.
     *
     * @param fc a &lt;code&gt;JFileChooser&lt;/code&gt;
     * @return a &lt;code&gt;ListSelectionListener&lt;/code&gt;
     */
    public ListSelectionListener createListSelectionListener(JFileChooser fc) {
<span class="nc" id="L527">        return super.createListSelectionListener(fc);</span>
    }

    // Obsolete class, not used in this version.
    protected class SingleClickListener extends MouseAdapter {
<span class="nc" id="L532">        public  SingleClickListener(JList list) {</span>
<span class="nc" id="L533">        }</span>
    }

    // Obsolete class, not used in this version.
<span class="nc" id="L537">    protected class FileRenderer extends DefaultListCellRenderer  {</span>
    }

    public void uninstallUI(JComponent c) {
        // Remove listeners
<span class="nc" id="L542">        c.removePropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L543">        c.removePropertyChangeListener(filePane);</span>
<span class="nc" id="L544">        cancelButton.removeActionListener(getCancelSelectionAction());</span>
<span class="nc" id="L545">        approveButton.removeActionListener(getApproveSelectionAction());</span>
<span class="nc" id="L546">        fileNameTextField.removeActionListener(getApproveSelectionAction());</span>

<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (filePane != null) {</span>
<span class="nc" id="L549">            filePane.uninstallUI();</span>
<span class="nc" id="L550">            filePane = null;</span>
        }

<span class="nc" id="L553">        super.uninstallUI(c);</span>
<span class="nc" id="L554">    }</span>

    /**
     * Returns the preferred size of the specified
     * &lt;code&gt;JFileChooser&lt;/code&gt;.
     * The preferred size is at least as large,
     * in both height and width,
     * as the preferred size recommended
     * by the file chooser's layout manager.
     *
     * @param c  a &lt;code&gt;JFileChooser&lt;/code&gt;
     * @return   a &lt;code&gt;Dimension&lt;/code&gt; specifying the preferred
     *           width and height of the file chooser
     */
    public Dimension getPreferredSize(JComponent c) {
<span class="nc" id="L569">        int prefWidth = PREF_SIZE.width;</span>
<span class="nc" id="L570">        Dimension d = c.getLayout().preferredLayoutSize(c);</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">        if (d != null) {</span>
<span class="nc bnc" id="L572" title="All 4 branches missed.">            return new Dimension(d.width &lt; prefWidth ? prefWidth : d.width,</span>
                                 d.height &lt; PREF_SIZE.height ? PREF_SIZE.height : d.height);
        } else {
<span class="nc" id="L575">            return new Dimension(prefWidth, PREF_SIZE.height);</span>
        }
    }

    /**
     * Returns the minimum size of the &lt;code&gt;JFileChooser&lt;/code&gt;.
     *
     * @param c  a &lt;code&gt;JFileChooser&lt;/code&gt;
     * @return   a &lt;code&gt;Dimension&lt;/code&gt; specifying the minimum
     *           width and height of the file chooser
     */
    public Dimension getMinimumSize(JComponent c) {
<span class="nc" id="L587">        return MIN_SIZE;</span>
    }

    /**
     * Returns the maximum size of the &lt;code&gt;JFileChooser&lt;/code&gt;.
     *
     * @param c  a &lt;code&gt;JFileChooser&lt;/code&gt;
     * @return   a &lt;code&gt;Dimension&lt;/code&gt; specifying the maximum
     *           width and height of the file chooser
     */
    public Dimension getMaximumSize(JComponent c) {
<span class="nc" id="L598">        return new Dimension(Integer.MAX_VALUE, Integer.MAX_VALUE);</span>
    }

    private String fileNameString(File file) {
<span class="nc bnc" id="L602" title="All 2 branches missed.">        if (file == null) {</span>
<span class="nc" id="L603">            return null;</span>
        } else {
<span class="nc" id="L605">            JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L606" title="All 4 branches missed.">            if ((fc.isDirectorySelectionEnabled() &amp;&amp; !fc.isFileSelectionEnabled()) ||</span>
<span class="nc bnc" id="L607" title="All 6 branches missed.">                (fc.isDirectorySelectionEnabled() &amp;&amp; fc.isFileSelectionEnabled() &amp;&amp; fc.getFileSystemView().isFileSystemRoot(file))) {</span>
<span class="nc" id="L608">                return file.getPath();</span>
            } else {
<span class="nc" id="L610">                return file.getName();</span>
            }
        }
    }

    private String fileNameString(File[] files) {
<span class="nc" id="L616">        StringBuffer buf = new StringBuffer();</span>
<span class="nc bnc" id="L617" title="All 4 branches missed.">        for (int i = 0; files != null &amp;&amp; i &lt; files.length; i++) {</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">            if (i &gt; 0) {</span>
<span class="nc" id="L619">                buf.append(&quot; &quot;);</span>
            }
<span class="nc bnc" id="L621" title="All 2 branches missed.">            if (files.length &gt; 1) {</span>
<span class="nc" id="L622">                buf.append(&quot;\&quot;&quot;);</span>
            }
<span class="nc" id="L624">            buf.append(fileNameString(files[i]));</span>
<span class="nc bnc" id="L625" title="All 2 branches missed.">            if (files.length &gt; 1) {</span>
<span class="nc" id="L626">                buf.append(&quot;\&quot;&quot;);</span>
            }
        }
<span class="nc" id="L629">        return buf.toString();</span>
    }

    /* The following methods are used by the PropertyChange Listener */

    private void doSelectedFileChanged(PropertyChangeEvent e) {
<span class="nc" id="L635">        File f = (File) e.getNewValue();</span>
<span class="nc" id="L636">        JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">        if (f != null</span>
<span class="nc bnc" id="L638" title="All 4 branches missed.">            &amp;&amp; ((fc.isFileSelectionEnabled() &amp;&amp; !f.isDirectory())</span>
<span class="nc bnc" id="L639" title="All 4 branches missed.">                || (f.isDirectory() &amp;&amp; fc.isDirectorySelectionEnabled()))) {</span>

<span class="nc" id="L641">            setFileName(fileNameString(f));</span>
        }
<span class="nc" id="L643">    }</span>

    private void doSelectedFilesChanged(PropertyChangeEvent e) {
<span class="nc" id="L646">        File[] files = (File[]) e.getNewValue();</span>
<span class="nc" id="L647">        JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L648" title="All 6 branches missed.">        if (files != null</span>
            &amp;&amp; files.length &gt; 0
<span class="nc bnc" id="L650" title="All 4 branches missed.">            &amp;&amp; (files.length &gt; 1 || fc.isDirectorySelectionEnabled() || !files[0].isDirectory())) {</span>
<span class="nc" id="L651">            setFileName(fileNameString(files));</span>
        }
<span class="nc" id="L653">    }</span>

    private void doDirectoryChanged(PropertyChangeEvent e) {
<span class="nc" id="L656">        JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L657">        FileSystemView fsv = fc.getFileSystemView();</span>

<span class="nc" id="L659">        clearIconCache();</span>
<span class="nc" id="L660">        File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">        if(currentDirectory != null) {</span>
<span class="nc" id="L662">            directoryComboBoxModel.addItem(currentDirectory);</span>

<span class="nc bnc" id="L664" title="All 4 branches missed.">            if (fc.isDirectorySelectionEnabled() &amp;&amp; !fc.isFileSelectionEnabled()) {</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">                if (fsv.isFileSystem(currentDirectory)) {</span>
<span class="nc" id="L666">                    setFileName(currentDirectory.getPath());</span>
                } else {
<span class="nc" id="L668">                    setFileName(null);</span>
                }
            }
        }
<span class="nc" id="L672">    }</span>

    private void doFilterChanged(PropertyChangeEvent e) {
<span class="nc" id="L675">        clearIconCache();</span>
<span class="nc" id="L676">    }</span>

    private void doFileSelectionModeChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L679" title="All 2 branches missed.">        if (fileNameLabel != null) {</span>
<span class="nc" id="L680">            populateFileNameLabel();</span>
        }
<span class="nc" id="L682">        clearIconCache();</span>

<span class="nc" id="L684">        JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L685">        File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc bnc" id="L686" title="All 2 branches missed.">        if (currentDirectory != null</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">            &amp;&amp; fc.isDirectorySelectionEnabled()</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">            &amp;&amp; !fc.isFileSelectionEnabled()</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">            &amp;&amp; fc.getFileSystemView().isFileSystem(currentDirectory)) {</span>

<span class="nc" id="L691">            setFileName(currentDirectory.getPath());</span>
        } else {
<span class="nc" id="L693">            setFileName(null);</span>
        }
<span class="nc" id="L695">    }</span>

    private void doAccessoryChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L698" title="All 2 branches missed.">        if(getAccessoryPanel() != null) {</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if(e.getOldValue() != null) {</span>
<span class="nc" id="L700">                getAccessoryPanel().remove((JComponent) e.getOldValue());</span>
            }
<span class="nc" id="L702">            JComponent accessory = (JComponent) e.getNewValue();</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">            if(accessory != null) {</span>
<span class="nc" id="L704">                getAccessoryPanel().add(accessory, BorderLayout.CENTER);</span>
            }
        }
<span class="nc" id="L707">    }</span>

    private void doApproveButtonTextChanged(PropertyChangeEvent e) {
<span class="nc" id="L710">        JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L711">        approveButton.setText(getApproveButtonText(chooser));</span>
<span class="nc" id="L712">        approveButton.setToolTipText(getApproveButtonToolTipText(chooser));</span>
<span class="nc" id="L713">    }</span>

    private void doDialogTypeChanged(PropertyChangeEvent e) {
<span class="nc" id="L716">        JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L717">        approveButton.setText(getApproveButtonText(chooser));</span>
<span class="nc" id="L718">        approveButton.setToolTipText(getApproveButtonToolTipText(chooser));</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if (chooser.getDialogType() == JFileChooser.SAVE_DIALOG) {</span>
<span class="nc" id="L720">            lookInLabel.setText(saveInLabelText);</span>
        } else {
<span class="nc" id="L722">            lookInLabel.setText(lookInLabelText);</span>
        }
<span class="nc" id="L724">    }</span>

    private void doApproveButtonMnemonicChanged(PropertyChangeEvent e) {
        // Note: Metal does not use mnemonics for approve and cancel
<span class="nc" id="L728">    }</span>

    private void doControlButtonsChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L731" title="All 2 branches missed.">        if(getFileChooser().getControlButtonsAreShown()) {</span>
<span class="nc" id="L732">            addControlButtons();</span>
        } else {
<span class="nc" id="L734">            removeControlButtons();</span>
        }
<span class="nc" id="L736">    }</span>

    /*
     * Listen for filechooser property changes, such as
     * the selected file changing, or the type of the dialog changing.
     */
    public PropertyChangeListener createPropertyChangeListener(JFileChooser fc) {
<span class="nc" id="L743">        return new PropertyChangeListener() {</span>
            public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L745">                String s = e.getPropertyName();</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">                if(s.equals(JFileChooser.SELECTED_FILE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L747">                    doSelectedFileChanged(e);</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">                } else if (s.equals(JFileChooser.SELECTED_FILES_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L749">                    doSelectedFilesChanged(e);</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.DIRECTORY_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L751">                    doDirectoryChanged(e);</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.FILE_FILTER_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L753">                    doFilterChanged(e);</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L755">                    doFileSelectionModeChanged(e);</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.ACCESSORY_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L757">                    doAccessoryChanged(e);</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">                } else if (s.equals(JFileChooser.APPROVE_BUTTON_TEXT_CHANGED_PROPERTY) ||</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">                           s.equals(JFileChooser.APPROVE_BUTTON_TOOL_TIP_TEXT_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L760">                    doApproveButtonTextChanged(e);</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.DIALOG_TYPE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L762">                    doDialogTypeChanged(e);</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.APPROVE_BUTTON_MNEMONIC_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L764">                    doApproveButtonMnemonicChanged(e);</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">                } else if(s.equals(JFileChooser.CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L766">                    doControlButtonsChanged(e);</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">                } else if (s.equals(&quot;componentOrientation&quot;)) {</span>
<span class="nc" id="L768">                    ComponentOrientation o = (ComponentOrientation)e.getNewValue();</span>
<span class="nc" id="L769">                    JFileChooser cc = (JFileChooser)e.getSource();</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">                    if (o != e.getOldValue()) {</span>
<span class="nc" id="L771">                        cc.applyComponentOrientation(o);</span>
                    }
<span class="nc bnc" id="L773" title="All 2 branches missed.">                } else if (s == &quot;FileChooser.useShellFolder&quot;) {</span>
<span class="nc" id="L774">                    doDirectoryChanged(e);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">                } else if (s.equals(&quot;ancestor&quot;)) {</span>
<span class="nc bnc" id="L776" title="All 4 branches missed.">                    if (e.getOldValue() == null &amp;&amp; e.getNewValue() != null) {</span>
                        // Ancestor was added, set initial focus
<span class="nc" id="L778">                        fileNameTextField.selectAll();</span>
<span class="nc" id="L779">                        fileNameTextField.requestFocus();</span>
                    }
                }
<span class="nc" id="L782">            }</span>
        };
    }


    protected void removeControlButtons() {
<span class="nc" id="L788">        getBottomPanel().remove(getButtonPanel());</span>
<span class="nc" id="L789">    }</span>

    protected void addControlButtons() {
<span class="nc" id="L792">        getBottomPanel().add(getButtonPanel());</span>
<span class="nc" id="L793">    }</span>

    public void ensureFileIsVisible(JFileChooser fc, File f) {
<span class="nc" id="L796">        filePane.ensureFileIsVisible(fc, f);</span>
<span class="nc" id="L797">    }</span>

    public void rescanCurrentDirectory(JFileChooser fc) {
<span class="nc" id="L800">        filePane.rescanCurrentDirectory();</span>
<span class="nc" id="L801">    }</span>

    public String getFileName() {
<span class="nc bnc" id="L804" title="All 2 branches missed.">        if (fileNameTextField != null) {</span>
<span class="nc" id="L805">            return fileNameTextField.getText();</span>
        } else {
<span class="nc" id="L807">            return null;</span>
        }
    }

    public void setFileName(String filename) {
<span class="nc bnc" id="L812" title="All 2 branches missed.">        if (fileNameTextField != null) {</span>
<span class="nc" id="L813">            fileNameTextField.setText(filename);</span>
        }
<span class="nc" id="L815">    }</span>

    /**
     * Property to remember whether a directory is currently selected in the UI.
     * This is normally called by the UI on a selection event.
     *
     * @param directorySelected if a directory is currently selected.
     * @since 1.4
     */
    protected void setDirectorySelected(boolean directorySelected) {
<span class="nc" id="L825">        super.setDirectorySelected(directorySelected);</span>
<span class="nc" id="L826">        JFileChooser chooser = getFileChooser();</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">        if(directorySelected) {</span>
<span class="nc bnc" id="L828" title="All 2 branches missed.">            if (approveButton != null) {</span>
<span class="nc" id="L829">                approveButton.setText(directoryOpenButtonText);</span>
<span class="nc" id="L830">                approveButton.setToolTipText(directoryOpenButtonToolTipText);</span>
            }
        } else {
<span class="nc bnc" id="L833" title="All 2 branches missed.">            if (approveButton != null) {</span>
<span class="nc" id="L834">                approveButton.setText(getApproveButtonText(chooser));</span>
<span class="nc" id="L835">                approveButton.setToolTipText(getApproveButtonToolTipText(chooser));</span>
            }
        }
<span class="nc" id="L838">    }</span>

    public String getDirectoryName() {
        // PENDING(jeff) - get the name from the directory combobox
<span class="nc" id="L842">        return null;</span>
    }

    public void setDirectoryName(String dirname) {
        // PENDING(jeff) - set the name in the directory combobox
<span class="nc" id="L847">    }</span>

    protected DirectoryComboBoxRenderer createDirectoryComboBoxRenderer(JFileChooser fc) {
<span class="nc" id="L850">        return new DirectoryComboBoxRenderer();</span>
    }

    //
    // Renderer for DirectoryComboBox
    //
<span class="nc" id="L856">    class DirectoryComboBoxRenderer extends DefaultListCellRenderer  {</span>
<span class="nc" id="L857">        IndentIcon ii = new IndentIcon();</span>
        public Component getListCellRendererComponent(JList list, Object value,
                                                      int index, boolean isSelected,
                                                      boolean cellHasFocus) {

<span class="nc" id="L862">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc bnc" id="L864" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L865">                setText(&quot;&quot;);</span>
<span class="nc" id="L866">                return this;</span>
            }
<span class="nc" id="L868">            File directory = (File)value;</span>
<span class="nc" id="L869">            setText(getFileChooser().getName(directory));</span>
<span class="nc" id="L870">            Icon icon = getFileChooser().getIcon(directory);</span>
<span class="nc" id="L871">            ii.icon = icon;</span>
<span class="nc" id="L872">            ii.depth = directoryComboBoxModel.getDepth(index);</span>
<span class="nc" id="L873">            setIcon(ii);</span>

<span class="nc" id="L875">            return this;</span>
        }
    }

    final static int space = 10;
<span class="nc" id="L880">    class IndentIcon implements Icon {</span>

<span class="nc" id="L882">        Icon icon = null;</span>
<span class="nc" id="L883">        int depth = 0;</span>

        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc bnc" id="L886" title="All 2 branches missed.">            if (c.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L887">                icon.paintIcon(c, g, x+depth*space, y);</span>
            } else {
<span class="nc" id="L889">                icon.paintIcon(c, g, x, y);</span>
            }
<span class="nc" id="L891">        }</span>

        public int getIconWidth() {
<span class="nc" id="L894">            return icon.getIconWidth() + depth*space;</span>
        }

        public int getIconHeight() {
<span class="nc" id="L898">            return icon.getIconHeight();</span>
        }

    }

    //
    // DataModel for DirectoryComboxbox
    //
    protected DirectoryComboBoxModel createDirectoryComboBoxModel(JFileChooser fc) {
<span class="nc" id="L907">        return new DirectoryComboBoxModel();</span>
    }

    /**
     * Data model for a type-face selection combo-box.
     */
    protected class DirectoryComboBoxModel extends AbstractListModel&lt;Object&gt; implements ComboBoxModel&lt;Object&gt; {
<span class="nc" id="L914">        Vector&lt;File&gt; directories = new Vector&lt;File&gt;();</span>
<span class="nc" id="L915">        int[] depths = null;</span>
<span class="nc" id="L916">        File selectedDirectory = null;</span>
<span class="nc" id="L917">        JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L918">        FileSystemView fsv = chooser.getFileSystemView();</span>

<span class="nc" id="L920">        public DirectoryComboBoxModel() {</span>
            // Add the current directory to the model, and make it the
            // selectedDirectory
<span class="nc" id="L923">            File dir = getFileChooser().getCurrentDirectory();</span>
<span class="nc bnc" id="L924" title="All 2 branches missed.">            if(dir != null) {</span>
<span class="nc" id="L925">                addItem(dir);</span>
            }
<span class="nc" id="L927">        }</span>

        /**
         * Adds the directory to the model and sets it to be selected,
         * additionally clears out the previous selected directory and
         * the paths leading up to it, if any.
         */
        private void addItem(File directory) {

<span class="nc bnc" id="L936" title="All 2 branches missed.">            if(directory == null) {</span>
<span class="nc" id="L937">                return;</span>
            }

<span class="nc" id="L940">            boolean useShellFolder = FilePane.usesShellFolder(chooser);</span>

<span class="nc" id="L942">            directories.clear();</span>

            File[] baseFolders;
<span class="nc bnc" id="L945" title="All 2 branches missed.">            if (useShellFolder) {</span>
<span class="nc" id="L946">                baseFolders = AccessController.doPrivileged(new PrivilegedAction&lt;File[]&gt;() {</span>
                    public File[] run() {
<span class="nc" id="L948">                        return (File[]) ShellFolder.get(&quot;fileChooserComboBoxFolders&quot;);</span>
                    }
                });
            } else {
<span class="nc" id="L952">                baseFolders = fsv.getRoots();</span>
            }
<span class="nc" id="L954">            directories.addAll(Arrays.asList(baseFolders));</span>

            // Get the canonical (full) path. This has the side
            // benefit of removing extraneous chars from the path,
            // for example /foo/bar/ becomes /foo/bar
            File canonical;
            try {
<span class="nc" id="L961">                canonical = ShellFolder.getNormalizedFile(directory);</span>
<span class="nc" id="L962">            } catch (IOException e) {</span>
                // Maybe drive is not ready. Can't abort here.
<span class="nc" id="L964">                canonical = directory;</span>
<span class="nc" id="L965">            }</span>

            // create File instances of each directory leading up to the top
            try {
<span class="nc bnc" id="L969" title="All 2 branches missed.">                File sf = useShellFolder ? ShellFolder.getShellFolder(canonical)</span>
                                         : canonical;
<span class="nc" id="L971">                File f = sf;</span>
<span class="nc" id="L972">                Vector&lt;File&gt; path = new Vector&lt;File&gt;(10);</span>
                do {
<span class="nc" id="L974">                    path.addElement(f);</span>
<span class="nc bnc" id="L975" title="All 2 branches missed.">                } while ((f = f.getParentFile()) != null);</span>

<span class="nc" id="L977">                int pathCount = path.size();</span>
                // Insert chain at appropriate place in vector
<span class="nc bnc" id="L979" title="All 2 branches missed.">                for (int i = 0; i &lt; pathCount; i++) {</span>
<span class="nc" id="L980">                    f = path.get(i);</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">                    if (directories.contains(f)) {</span>
<span class="nc" id="L982">                        int topIndex = directories.indexOf(f);</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">                        for (int j = i-1; j &gt;= 0; j--) {</span>
<span class="nc" id="L984">                            directories.insertElementAt(path.get(j), topIndex+i-j);</span>
                        }
<span class="nc" id="L986">                        break;</span>
                    }
                }
<span class="nc" id="L989">                calculateDepths();</span>
<span class="nc" id="L990">                setSelectedItem(sf);</span>
<span class="nc" id="L991">            } catch (FileNotFoundException ex) {</span>
<span class="nc" id="L992">                calculateDepths();</span>
<span class="nc" id="L993">            }</span>
<span class="nc" id="L994">        }</span>

        private void calculateDepths() {
<span class="nc" id="L997">            depths = new int[directories.size()];</span>
<span class="nc bnc" id="L998" title="All 2 branches missed.">            for (int i = 0; i &lt; depths.length; i++) {</span>
<span class="nc" id="L999">                File dir = directories.get(i);</span>
<span class="nc" id="L1000">                File parent = dir.getParentFile();</span>
<span class="nc" id="L1001">                depths[i] = 0;</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">                if (parent != null) {</span>
<span class="nc bnc" id="L1003" title="All 2 branches missed.">                    for (int j = i-1; j &gt;= 0; j--) {</span>
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                        if (parent.equals(directories.get(j))) {</span>
<span class="nc" id="L1005">                            depths[i] = depths[j] + 1;</span>
<span class="nc" id="L1006">                            break;</span>
                        }
                    }
                }
            }
<span class="nc" id="L1011">        }</span>

        public int getDepth(int i) {
<span class="nc bnc" id="L1014" title="All 6 branches missed.">            return (depths != null &amp;&amp; i &gt;= 0 &amp;&amp; i &lt; depths.length) ? depths[i] : 0;</span>
        }

        public void setSelectedItem(Object selectedDirectory) {
<span class="nc" id="L1018">            this.selectedDirectory = (File)selectedDirectory;</span>
<span class="nc" id="L1019">            fireContentsChanged(this, -1, -1);</span>
<span class="nc" id="L1020">        }</span>

        public Object getSelectedItem() {
<span class="nc" id="L1023">            return selectedDirectory;</span>
        }

        public int getSize() {
<span class="nc" id="L1027">            return directories.size();</span>
        }

        public Object getElementAt(int index) {
<span class="nc" id="L1031">            return directories.elementAt(index);</span>
        }
    }

    //
    // Renderer for Types ComboBox
    //
    protected FilterComboBoxRenderer createFilterComboBoxRenderer() {
<span class="nc" id="L1039">        return new FilterComboBoxRenderer();</span>
    }

    /**
     * Render different type sizes and styles.
     */
<span class="nc" id="L1045">    public class FilterComboBoxRenderer extends DefaultListCellRenderer {</span>
        public Component getListCellRendererComponent(JList list,
            Object value, int index, boolean isSelected,
            boolean cellHasFocus) {

<span class="nc" id="L1050">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc bnc" id="L1052" title="All 4 branches missed.">            if (value != null &amp;&amp; value instanceof FileFilter) {</span>
<span class="nc" id="L1053">                setText(((FileFilter)value).getDescription());</span>
            }

<span class="nc" id="L1056">            return this;</span>
        }
    }

    //
    // DataModel for Types Comboxbox
    //
    protected FilterComboBoxModel createFilterComboBoxModel() {
<span class="nc" id="L1064">        return new FilterComboBoxModel();</span>
    }

    /**
     * Data model for a type-face selection combo-box.
     */
<span class="nc" id="L1070">    protected class FilterComboBoxModel extends AbstractFilterComboBoxModel {</span>
        protected JFileChooser getFileChooser() {
<span class="nc" id="L1072">            return MetalFileChooserUI.this.getFileChooser();</span>
        }
    }

    public void valueChanged(ListSelectionEvent e) {
<span class="nc" id="L1077">        JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L1078">        File f = fc.getSelectedFile();</span>
<span class="nc bnc" id="L1079" title="All 6 branches missed.">        if (!e.getValueIsAdjusting() &amp;&amp; f != null &amp;&amp; !getFileChooser().isTraversable(f)) {</span>
<span class="nc" id="L1080">            setFileName(fileNameString(f));</span>
        }
<span class="nc" id="L1082">    }</span>

    /**
     * Acts when DirectoryComboBox has changed the selected item.
     */
    protected class DirectoryComboBoxAction extends AbstractAction {
<span class="nc" id="L1088">        protected DirectoryComboBoxAction() {</span>
<span class="nc" id="L1089">            super(&quot;DirectoryComboBoxAction&quot;);</span>
<span class="nc" id="L1090">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1093">            directoryComboBox.hidePopup();</span>
<span class="nc" id="L1094">            File f = (File)directoryComboBox.getSelectedItem();</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">            if (!getFileChooser().getCurrentDirectory().equals(f)) {</span>
<span class="nc" id="L1096">                getFileChooser().setCurrentDirectory(f);</span>
            }
<span class="nc" id="L1098">        }</span>
    }

    protected JButton getApproveButton(JFileChooser fc) {
<span class="nc" id="L1102">        return approveButton;</span>
    }


    /**
     * &lt;code&gt;ButtonAreaLayout&lt;/code&gt; behaves in a similar manner to
     * &lt;code&gt;FlowLayout&lt;/code&gt;. It lays out all components from left to
     * right, flushed right. The widths of all components will be set
     * to the largest preferred size width.
     */
<span class="nc" id="L1112">    private static class ButtonAreaLayout implements LayoutManager {</span>
<span class="nc" id="L1113">        private int hGap = 5;</span>
<span class="nc" id="L1114">        private int topMargin = 17;</span>

        public void addLayoutComponent(String string, Component comp) {
<span class="nc" id="L1117">        }</span>

        public void layoutContainer(Container container) {
<span class="nc" id="L1120">            Component[] children = container.getComponents();</span>

<span class="nc bnc" id="L1122" title="All 4 branches missed.">            if (children != null &amp;&amp; children.length &gt; 0) {</span>
<span class="nc" id="L1123">                int         numChildren = children.length;</span>
<span class="nc" id="L1124">                Dimension[] sizes = new Dimension[numChildren];</span>
<span class="nc" id="L1125">                Insets      insets = container.getInsets();</span>
<span class="nc" id="L1126">                int         yLocation = insets.top + topMargin;</span>
<span class="nc" id="L1127">                int         maxWidth = 0;</span>

<span class="nc bnc" id="L1129" title="All 2 branches missed.">                for (int counter = 0; counter &lt; numChildren; counter++) {</span>
<span class="nc" id="L1130">                    sizes[counter] = children[counter].getPreferredSize();</span>
<span class="nc" id="L1131">                    maxWidth = Math.max(maxWidth, sizes[counter].width);</span>
                }
                int xLocation, xOffset;
<span class="nc bnc" id="L1134" title="All 2 branches missed.">                if (container.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1135">                    xLocation = container.getSize().width - insets.left - maxWidth;</span>
<span class="nc" id="L1136">                    xOffset = hGap + maxWidth;</span>
                } else {
<span class="nc" id="L1138">                    xLocation = insets.left;</span>
<span class="nc" id="L1139">                    xOffset = -(hGap + maxWidth);</span>
                }
<span class="nc bnc" id="L1141" title="All 2 branches missed.">                for (int counter = numChildren - 1; counter &gt;= 0; counter--) {</span>
<span class="nc" id="L1142">                    children[counter].setBounds(xLocation, yLocation,</span>
                                                maxWidth, sizes[counter].height);
<span class="nc" id="L1144">                    xLocation -= xOffset;</span>
                }
            }
<span class="nc" id="L1147">        }</span>

        public Dimension minimumLayoutSize(Container c) {
<span class="nc bnc" id="L1150" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L1151">                Component[] children = c.getComponents();</span>

<span class="nc bnc" id="L1153" title="All 4 branches missed.">                if (children != null &amp;&amp; children.length &gt; 0) {</span>
<span class="nc" id="L1154">                    int       numChildren = children.length;</span>
<span class="nc" id="L1155">                    int       height = 0;</span>
<span class="nc" id="L1156">                    Insets    cInsets = c.getInsets();</span>
<span class="nc" id="L1157">                    int       extraHeight = topMargin + cInsets.top + cInsets.bottom;</span>
<span class="nc" id="L1158">                    int       extraWidth = cInsets.left + cInsets.right;</span>
<span class="nc" id="L1159">                    int       maxWidth = 0;</span>

<span class="nc bnc" id="L1161" title="All 2 branches missed.">                    for (int counter = 0; counter &lt; numChildren; counter++) {</span>
<span class="nc" id="L1162">                        Dimension aSize = children[counter].getPreferredSize();</span>
<span class="nc" id="L1163">                        height = Math.max(height, aSize.height);</span>
<span class="nc" id="L1164">                        maxWidth = Math.max(maxWidth, aSize.width);</span>
                    }
<span class="nc" id="L1166">                    return new Dimension(extraWidth + numChildren * maxWidth +</span>
                                         (numChildren - 1) * hGap,
                                         extraHeight + height);
                }
            }
<span class="nc" id="L1171">            return new Dimension(0, 0);</span>
        }

        public Dimension preferredLayoutSize(Container c) {
<span class="nc" id="L1175">            return minimumLayoutSize(c);</span>
        }

<span class="nc" id="L1178">        public void removeLayoutComponent(Component c) { }</span>
    }

    private static void groupLabels(AlignedLabel[] group) {
<span class="nc bnc" id="L1182" title="All 2 branches missed.">        for (int i = 0; i &lt; group.length; i++) {</span>
<span class="nc" id="L1183">            group[i].group = group;</span>
        }
<span class="nc" id="L1185">    }</span>

    private class AlignedLabel extends JLabel {
        private AlignedLabel[] group;
<span class="nc" id="L1189">        private int maxWidth = 0;</span>

<span class="nc" id="L1191">        AlignedLabel() {</span>
<span class="nc" id="L1192">            super();</span>
<span class="nc" id="L1193">            setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L1194">        }</span>


<span class="nc" id="L1197">        AlignedLabel(String text) {</span>
<span class="nc" id="L1198">            super(text);</span>
<span class="nc" id="L1199">            setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L1200">        }</span>

        public Dimension getPreferredSize() {
<span class="nc" id="L1203">            Dimension d = super.getPreferredSize();</span>
            // Align the width with all other labels in group.
<span class="nc" id="L1205">            return new Dimension(getMaxWidth() + 11, d.height);</span>
        }

        private int getMaxWidth() {
<span class="nc bnc" id="L1209" title="All 4 branches missed.">            if (maxWidth == 0 &amp;&amp; group != null) {</span>
<span class="nc" id="L1210">                int max = 0;</span>
<span class="nc bnc" id="L1211" title="All 2 branches missed.">                for (int i = 0; i &lt; group.length; i++) {</span>
<span class="nc" id="L1212">                    max = Math.max(group[i].getSuperPreferredWidth(), max);</span>
                }
<span class="nc bnc" id="L1214" title="All 2 branches missed.">                for (int i = 0; i &lt; group.length; i++) {</span>
<span class="nc" id="L1215">                    group[i].maxWidth = max;</span>
                }
            }
<span class="nc" id="L1218">            return maxWidth;</span>
        }

        private int getSuperPreferredWidth() {
<span class="nc" id="L1222">            return super.getPreferredSize().width;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>