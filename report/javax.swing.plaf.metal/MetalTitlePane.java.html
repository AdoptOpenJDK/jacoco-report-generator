<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MetalTitlePane.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.metal</a> &gt; <span class="el_source">MetalTitlePane.java</span></div><h1>MetalTitlePane.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.metal;

import sun.swing.SwingUtilities2;
import sun.awt.SunToolkit;
import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import javax.swing.*;
import javax.swing.border.*;
import javax.swing.event.InternalFrameEvent;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.*;
import java.util.Locale;
import javax.accessibility.*;


/**
 * Class that manages a JLF awt.Window-descendant class's title bar.
 * &lt;p&gt;
 * This class assumes it will be created with a particular window
 * decoration style, and that if the style changes, a new one will
 * be created.
 *
 * @author Terry Kellerman
 * @since 1.4
 */
<span class="nc bnc" id="L52" title="All 2 branches missed.">class MetalTitlePane extends JComponent {</span>
<span class="nc" id="L53">    private static final Border handyEmptyBorder = new EmptyBorder(0,0,0,0);</span>
    private static final int IMAGE_HEIGHT = 16;
    private static final int IMAGE_WIDTH = 16;

    /**
     * PropertyChangeListener added to the JRootPane.
     */
    private PropertyChangeListener propertyChangeListener;

    /**
     * JMenuBar, typically renders the system menu items.
     */
    private JMenuBar menuBar;
    /**
     * Action used to close the Window.
     */
    private Action closeAction;

    /**
     * Action used to iconify the Frame.
     */
    private Action iconifyAction;

    /**
     * Action to restore the Frame size.
     */
    private Action restoreAction;

    /**
     * Action to restore the Frame size.
     */
    private Action maximizeAction;

    /**
     * Button used to maximize or restore the Frame.
     */
    private JButton toggleButton;

    /**
     * Button used to maximize or restore the Frame.
     */
    private JButton iconifyButton;

    /**
     * Button used to maximize or restore the Frame.
     */
    private JButton closeButton;

    /**
     * Icon used for toggleButton when window is normal size.
     */
    private Icon maximizeIcon;

    /**
     * Icon used for toggleButton when window is maximized.
     */
    private Icon minimizeIcon;

    /**
     * Image used for the system menu icon
     */
    private Image systemIcon;

    /**
     * Listens for changes in the state of the Window listener to update
     * the state of the widgets.
     */
    private WindowListener windowListener;

    /**
     * Window we're currently in.
     */
    private Window window;

    /**
     * JRootPane rendering for.
     */
    private JRootPane rootPane;

    /**
     * Room remaining in title for bumps.
     */
    private int buttonsWidth;

    /**
     * Buffered Frame.state property. As state isn't bound, this is kept
     * to determine when to avoid updating widgets.
     */
    private int state;

    /**
     * MetalRootPaneUI that created us.
     */
    private MetalRootPaneUI rootPaneUI;


    // Colors
<span class="nc" id="L150">    private Color inactiveBackground = UIManager.getColor(&quot;inactiveCaption&quot;);</span>
<span class="nc" id="L151">    private Color inactiveForeground = UIManager.getColor(&quot;inactiveCaptionText&quot;);</span>
<span class="nc" id="L152">    private Color inactiveShadow = UIManager.getColor(&quot;inactiveCaptionBorder&quot;);</span>
<span class="nc" id="L153">    private Color activeBumpsHighlight = MetalLookAndFeel.getPrimaryControlHighlight();</span>
<span class="nc" id="L154">    private Color activeBumpsShadow = MetalLookAndFeel.getPrimaryControlDarkShadow();</span>
<span class="nc" id="L155">    private Color activeBackground = null;</span>
<span class="nc" id="L156">    private Color activeForeground = null;</span>
<span class="nc" id="L157">    private Color activeShadow = null;</span>

    // Bumps
<span class="nc" id="L160">    private MetalBumps activeBumps</span>
        = new MetalBumps( 0, 0,
                          activeBumpsHighlight,
                          activeBumpsShadow,
<span class="nc" id="L164">                          MetalLookAndFeel.getPrimaryControl() );</span>
<span class="nc" id="L165">    private MetalBumps inactiveBumps</span>
        = new MetalBumps( 0, 0,
<span class="nc" id="L167">                          MetalLookAndFeel.getControlHighlight(),</span>
<span class="nc" id="L168">                          MetalLookAndFeel.getControlDarkShadow(),</span>
<span class="nc" id="L169">                          MetalLookAndFeel.getControl() );</span>


<span class="nc" id="L172">    public MetalTitlePane(JRootPane root, MetalRootPaneUI ui) {</span>
<span class="nc" id="L173">        this.rootPane = root;</span>
<span class="nc" id="L174">        rootPaneUI = ui;</span>

<span class="nc" id="L176">        state = -1;</span>

<span class="nc" id="L178">        installSubcomponents();</span>
<span class="nc" id="L179">        determineColors();</span>
<span class="nc" id="L180">        installDefaults();</span>

<span class="nc" id="L182">        setLayout(createLayout());</span>
<span class="nc" id="L183">    }</span>

    /**
     * Uninstalls the necessary state.
     */
    private void uninstall() {
<span class="nc" id="L189">        uninstallListeners();</span>
<span class="nc" id="L190">        window = null;</span>
<span class="nc" id="L191">        removeAll();</span>
<span class="nc" id="L192">    }</span>

    /**
     * Installs the necessary listeners.
     */
    private void installListeners() {
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (window != null) {</span>
<span class="nc" id="L199">            windowListener = createWindowListener();</span>
<span class="nc" id="L200">            window.addWindowListener(windowListener);</span>
<span class="nc" id="L201">            propertyChangeListener = createWindowPropertyChangeListener();</span>
<span class="nc" id="L202">            window.addPropertyChangeListener(propertyChangeListener);</span>
        }
<span class="nc" id="L204">    }</span>

    /**
     * Uninstalls the necessary listeners.
     */
    private void uninstallListeners() {
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (window != null) {</span>
<span class="nc" id="L211">            window.removeWindowListener(windowListener);</span>
<span class="nc" id="L212">            window.removePropertyChangeListener(propertyChangeListener);</span>
        }
<span class="nc" id="L214">    }</span>

    /**
     * Returns the &lt;code&gt;WindowListener&lt;/code&gt; to add to the
     * &lt;code&gt;Window&lt;/code&gt;.
     */
    private WindowListener createWindowListener() {
<span class="nc" id="L221">        return new WindowHandler();</span>
    }

    /**
     * Returns the &lt;code&gt;PropertyChangeListener&lt;/code&gt; to install on
     * the &lt;code&gt;Window&lt;/code&gt;.
     */
    private PropertyChangeListener createWindowPropertyChangeListener() {
<span class="nc" id="L229">        return new PropertyChangeHandler();</span>
    }

    /**
     * Returns the &lt;code&gt;JRootPane&lt;/code&gt; this was created for.
     */
    public JRootPane getRootPane() {
<span class="nc" id="L236">        return rootPane;</span>
    }

    /**
     * Returns the decoration style of the &lt;code&gt;JRootPane&lt;/code&gt;.
     */
    private int getWindowDecorationStyle() {
<span class="nc" id="L243">        return getRootPane().getWindowDecorationStyle();</span>
    }

    public void addNotify() {
<span class="nc" id="L247">        super.addNotify();</span>

<span class="nc" id="L249">        uninstallListeners();</span>

<span class="nc" id="L251">        window = SwingUtilities.getWindowAncestor(this);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (window != null) {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">            if (window instanceof Frame) {</span>
<span class="nc" id="L254">                setState(((Frame)window).getExtendedState());</span>
            }
            else {
<span class="nc" id="L257">                setState(0);</span>
            }
<span class="nc" id="L259">            setActive(window.isActive());</span>
<span class="nc" id="L260">            installListeners();</span>
<span class="nc" id="L261">            updateSystemIcon();</span>
        }
<span class="nc" id="L263">    }</span>

    public void removeNotify() {
<span class="nc" id="L266">        super.removeNotify();</span>

<span class="nc" id="L268">        uninstallListeners();</span>
<span class="nc" id="L269">        window = null;</span>
<span class="nc" id="L270">    }</span>

    /**
     * Adds any sub-Components contained in the &lt;code&gt;MetalTitlePane&lt;/code&gt;.
     */
    private void installSubcomponents() {
<span class="nc" id="L276">        int decorationStyle = getWindowDecorationStyle();</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (decorationStyle == JRootPane.FRAME) {</span>
<span class="nc" id="L278">            createActions();</span>
<span class="nc" id="L279">            menuBar = createMenuBar();</span>
<span class="nc" id="L280">            add(menuBar);</span>
<span class="nc" id="L281">            createButtons();</span>
<span class="nc" id="L282">            add(iconifyButton);</span>
<span class="nc" id="L283">            add(toggleButton);</span>
<span class="nc" id="L284">            add(closeButton);</span>
<span class="nc bnc" id="L285" title="All 14 branches missed.">        } else if (decorationStyle == JRootPane.PLAIN_DIALOG ||</span>
                decorationStyle == JRootPane.INFORMATION_DIALOG ||
                decorationStyle == JRootPane.ERROR_DIALOG ||
                decorationStyle == JRootPane.COLOR_CHOOSER_DIALOG ||
                decorationStyle == JRootPane.FILE_CHOOSER_DIALOG ||
                decorationStyle == JRootPane.QUESTION_DIALOG ||
                decorationStyle == JRootPane.WARNING_DIALOG) {
<span class="nc" id="L292">            createActions();</span>
<span class="nc" id="L293">            createButtons();</span>
<span class="nc" id="L294">            add(closeButton);</span>
        }
<span class="nc" id="L296">    }</span>

    /**
     * Determines the Colors to draw with.
     */
    private void determineColors() {
<span class="nc bnc" id="L302" title="All 5 branches missed.">        switch (getWindowDecorationStyle()) {</span>
        case JRootPane.FRAME:
<span class="nc" id="L304">            activeBackground = UIManager.getColor(&quot;activeCaption&quot;);</span>
<span class="nc" id="L305">            activeForeground = UIManager.getColor(&quot;activeCaptionText&quot;);</span>
<span class="nc" id="L306">            activeShadow = UIManager.getColor(&quot;activeCaptionBorder&quot;);</span>
<span class="nc" id="L307">            break;</span>
        case JRootPane.ERROR_DIALOG:
<span class="nc" id="L309">            activeBackground = UIManager.getColor(</span>
                &quot;OptionPane.errorDialog.titlePane.background&quot;);
<span class="nc" id="L311">            activeForeground = UIManager.getColor(</span>
                &quot;OptionPane.errorDialog.titlePane.foreground&quot;);
<span class="nc" id="L313">            activeShadow = UIManager.getColor(</span>
                &quot;OptionPane.errorDialog.titlePane.shadow&quot;);
<span class="nc" id="L315">            break;</span>
        case JRootPane.QUESTION_DIALOG:
        case JRootPane.COLOR_CHOOSER_DIALOG:
        case JRootPane.FILE_CHOOSER_DIALOG:
<span class="nc" id="L319">            activeBackground = UIManager.getColor(</span>
                &quot;OptionPane.questionDialog.titlePane.background&quot;);
<span class="nc" id="L321">            activeForeground = UIManager.getColor(</span>
                &quot;OptionPane.questionDialog.titlePane.foreground&quot;);
<span class="nc" id="L323">            activeShadow = UIManager.getColor(</span>
                &quot;OptionPane.questionDialog.titlePane.shadow&quot;);
<span class="nc" id="L325">            break;</span>
        case JRootPane.WARNING_DIALOG:
<span class="nc" id="L327">            activeBackground = UIManager.getColor(</span>
                &quot;OptionPane.warningDialog.titlePane.background&quot;);
<span class="nc" id="L329">            activeForeground = UIManager.getColor(</span>
                &quot;OptionPane.warningDialog.titlePane.foreground&quot;);
<span class="nc" id="L331">            activeShadow = UIManager.getColor(</span>
                &quot;OptionPane.warningDialog.titlePane.shadow&quot;);
<span class="nc" id="L333">            break;</span>
        case JRootPane.PLAIN_DIALOG:
        case JRootPane.INFORMATION_DIALOG:
        default:
<span class="nc" id="L337">            activeBackground = UIManager.getColor(&quot;activeCaption&quot;);</span>
<span class="nc" id="L338">            activeForeground = UIManager.getColor(&quot;activeCaptionText&quot;);</span>
<span class="nc" id="L339">            activeShadow = UIManager.getColor(&quot;activeCaptionBorder&quot;);</span>
            break;
        }
<span class="nc" id="L342">        activeBumps.setBumpColors(activeBumpsHighlight, activeBumpsShadow,</span>
                                  activeBackground);
<span class="nc" id="L344">    }</span>

    /**
     * Installs the fonts and necessary properties on the MetalTitlePane.
     */
    private void installDefaults() {
<span class="nc" id="L350">        setFont(UIManager.getFont(&quot;InternalFrame.titleFont&quot;, getLocale()));</span>
<span class="nc" id="L351">    }</span>

    /**
     * Uninstalls any previously installed UI values.
     */
    private void uninstallDefaults() {
<span class="nc" id="L357">    }</span>

    /**
     * Returns the &lt;code&gt;JMenuBar&lt;/code&gt; displaying the appropriate
     * system menu items.
     */
    protected JMenuBar createMenuBar() {
<span class="nc" id="L364">        menuBar = new SystemMenuBar();</span>
<span class="nc" id="L365">        menuBar.setFocusable(false);</span>
<span class="nc" id="L366">        menuBar.setBorderPainted(true);</span>
<span class="nc" id="L367">        menuBar.add(createMenu());</span>
<span class="nc" id="L368">        return menuBar;</span>
    }

    /**
     * Closes the Window.
     */
    private void close() {
<span class="nc" id="L375">        Window window = getWindow();</span>

<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (window != null) {</span>
<span class="nc" id="L378">            window.dispatchEvent(new WindowEvent(</span>
                                 window, WindowEvent.WINDOW_CLOSING));
        }
<span class="nc" id="L381">    }</span>

    /**
     * Iconifies the Frame.
     */
    private void iconify() {
<span class="nc" id="L387">        Frame frame = getFrame();</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">        if (frame != null) {</span>
<span class="nc" id="L389">            frame.setExtendedState(state | Frame.ICONIFIED);</span>
        }
<span class="nc" id="L391">    }</span>

    /**
     * Maximizes the Frame.
     */
    private void maximize() {
<span class="nc" id="L397">        Frame frame = getFrame();</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">        if (frame != null) {</span>
<span class="nc" id="L399">            frame.setExtendedState(state | Frame.MAXIMIZED_BOTH);</span>
        }
<span class="nc" id="L401">    }</span>

    /**
     * Restores the Frame size.
     */
    private void restore() {
<span class="nc" id="L407">        Frame frame = getFrame();</span>

<span class="nc bnc" id="L409" title="All 2 branches missed.">        if (frame == null) {</span>
<span class="nc" id="L410">            return;</span>
        }

<span class="nc bnc" id="L413" title="All 2 branches missed.">        if ((state &amp; Frame.ICONIFIED) != 0) {</span>
<span class="nc" id="L414">            frame.setExtendedState(state &amp; ~Frame.ICONIFIED);</span>
        } else {
<span class="nc" id="L416">            frame.setExtendedState(state &amp; ~Frame.MAXIMIZED_BOTH);</span>
        }
<span class="nc" id="L418">    }</span>

    /**
     * Create the &lt;code&gt;Action&lt;/code&gt;s that get associated with the
     * buttons and menu items.
     */
    private void createActions() {
<span class="nc" id="L425">        closeAction = new CloseAction();</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">        if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc" id="L427">            iconifyAction = new IconifyAction();</span>
<span class="nc" id="L428">            restoreAction = new RestoreAction();</span>
<span class="nc" id="L429">            maximizeAction = new MaximizeAction();</span>
        }
<span class="nc" id="L431">    }</span>

    /**
     * Returns the &lt;code&gt;JMenu&lt;/code&gt; displaying the appropriate menu items
     * for manipulating the Frame.
     */
    private JMenu createMenu() {
<span class="nc" id="L438">        JMenu menu = new JMenu(&quot;&quot;);</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc" id="L440">            addMenuItems(menu);</span>
        }
<span class="nc" id="L442">        return menu;</span>
    }

    /**
     * Adds the necessary &lt;code&gt;JMenuItem&lt;/code&gt;s to the passed in menu.
     */
    private void addMenuItems(JMenu menu) {
<span class="nc" id="L449">        Locale locale = getRootPane().getLocale();</span>
<span class="nc" id="L450">        JMenuItem mi = menu.add(restoreAction);</span>
<span class="nc" id="L451">        int mnemonic = MetalUtils.getInt(&quot;MetalTitlePane.restoreMnemonic&quot;, -1);</span>

<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (mnemonic != -1) {</span>
<span class="nc" id="L454">            mi.setMnemonic(mnemonic);</span>
        }

<span class="nc" id="L457">        mi = menu.add(iconifyAction);</span>
<span class="nc" id="L458">        mnemonic = MetalUtils.getInt(&quot;MetalTitlePane.iconifyMnemonic&quot;, -1);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (mnemonic != -1) {</span>
<span class="nc" id="L460">            mi.setMnemonic(mnemonic);</span>
        }

<span class="nc bnc" id="L463" title="All 2 branches missed.">        if (Toolkit.getDefaultToolkit().isFrameStateSupported(</span>
                Frame.MAXIMIZED_BOTH)) {
<span class="nc" id="L465">            mi = menu.add(maximizeAction);</span>
<span class="nc" id="L466">            mnemonic =</span>
<span class="nc" id="L467">                MetalUtils.getInt(&quot;MetalTitlePane.maximizeMnemonic&quot;, -1);</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">            if (mnemonic != -1) {</span>
<span class="nc" id="L469">                mi.setMnemonic(mnemonic);</span>
            }
        }

<span class="nc" id="L473">        menu.add(new JSeparator());</span>

<span class="nc" id="L475">        mi = menu.add(closeAction);</span>
<span class="nc" id="L476">        mnemonic = MetalUtils.getInt(&quot;MetalTitlePane.closeMnemonic&quot;, -1);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (mnemonic != -1) {</span>
<span class="nc" id="L478">            mi.setMnemonic(mnemonic);</span>
        }
<span class="nc" id="L480">    }</span>

    /**
     * Returns a &lt;code&gt;JButton&lt;/code&gt; appropriate for placement on the
     * TitlePane.
     */
    private JButton createTitleButton() {
<span class="nc" id="L487">        JButton button = new JButton();</span>

<span class="nc" id="L489">        button.setFocusPainted(false);</span>
<span class="nc" id="L490">        button.setFocusable(false);</span>
<span class="nc" id="L491">        button.setOpaque(true);</span>
<span class="nc" id="L492">        return button;</span>
    }

    /**
     * Creates the Buttons that will be placed on the TitlePane.
     */
    private void createButtons() {
<span class="nc" id="L499">        closeButton = createTitleButton();</span>
<span class="nc" id="L500">        closeButton.setAction(closeAction);</span>
<span class="nc" id="L501">        closeButton.setText(null);</span>
<span class="nc" id="L502">        closeButton.putClientProperty(&quot;paintActive&quot;, Boolean.TRUE);</span>
<span class="nc" id="L503">        closeButton.setBorder(handyEmptyBorder);</span>
<span class="nc" id="L504">        closeButton.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                      &quot;Close&quot;);
<span class="nc" id="L506">        closeButton.setIcon(UIManager.getIcon(&quot;InternalFrame.closeIcon&quot;));</span>

<span class="nc bnc" id="L508" title="All 2 branches missed.">        if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc" id="L509">            maximizeIcon = UIManager.getIcon(&quot;InternalFrame.maximizeIcon&quot;);</span>
<span class="nc" id="L510">            minimizeIcon = UIManager.getIcon(&quot;InternalFrame.minimizeIcon&quot;);</span>

<span class="nc" id="L512">            iconifyButton = createTitleButton();</span>
<span class="nc" id="L513">            iconifyButton.setAction(iconifyAction);</span>
<span class="nc" id="L514">            iconifyButton.setText(null);</span>
<span class="nc" id="L515">            iconifyButton.putClientProperty(&quot;paintActive&quot;, Boolean.TRUE);</span>
<span class="nc" id="L516">            iconifyButton.setBorder(handyEmptyBorder);</span>
<span class="nc" id="L517">            iconifyButton.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                            &quot;Iconify&quot;);
<span class="nc" id="L519">            iconifyButton.setIcon(UIManager.getIcon(&quot;InternalFrame.iconifyIcon&quot;));</span>

<span class="nc" id="L521">            toggleButton = createTitleButton();</span>
<span class="nc" id="L522">            toggleButton.setAction(restoreAction);</span>
<span class="nc" id="L523">            toggleButton.putClientProperty(&quot;paintActive&quot;, Boolean.TRUE);</span>
<span class="nc" id="L524">            toggleButton.setBorder(handyEmptyBorder);</span>
<span class="nc" id="L525">            toggleButton.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY,</span>
                                           &quot;Maximize&quot;);
<span class="nc" id="L527">            toggleButton.setIcon(maximizeIcon);</span>
        }
<span class="nc" id="L529">    }</span>

    /**
     * Returns the &lt;code&gt;LayoutManager&lt;/code&gt; that should be installed on
     * the &lt;code&gt;MetalTitlePane&lt;/code&gt;.
     */
    private LayoutManager createLayout() {
<span class="nc" id="L536">        return new TitlePaneLayout();</span>
    }

    /**
     * Updates state dependant upon the Window's active state.
     */
    private void setActive(boolean isActive) {
<span class="nc bnc" id="L543" title="All 2 branches missed.">        Boolean activeB = isActive ? Boolean.TRUE : Boolean.FALSE;</span>

<span class="nc" id="L545">        closeButton.putClientProperty(&quot;paintActive&quot;, activeB);</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc" id="L547">            iconifyButton.putClientProperty(&quot;paintActive&quot;, activeB);</span>
<span class="nc" id="L548">            toggleButton.putClientProperty(&quot;paintActive&quot;, activeB);</span>
        }
        // Repaint the whole thing as the Borders that are used have
        // different colors for active vs inactive
<span class="nc" id="L552">        getRootPane().repaint();</span>
<span class="nc" id="L553">    }</span>

    /**
     * Sets the state of the Window.
     */
    private void setState(int state) {
<span class="nc" id="L559">        setState(state, false);</span>
<span class="nc" id="L560">    }</span>

    /**
     * Sets the state of the window. If &lt;code&gt;updateRegardless&lt;/code&gt; is
     * true and the state has not changed, this will update anyway.
     */
    private void setState(int state, boolean updateRegardless) {
<span class="nc" id="L567">        Window w = getWindow();</span>

<span class="nc bnc" id="L569" title="All 4 branches missed.">        if (w != null &amp;&amp; getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc bnc" id="L570" title="All 4 branches missed.">            if (this.state == state &amp;&amp; !updateRegardless) {</span>
<span class="nc" id="L571">                return;</span>
            }
<span class="nc" id="L573">            Frame frame = getFrame();</span>

<span class="nc bnc" id="L575" title="All 2 branches missed.">            if (frame != null) {</span>
<span class="nc" id="L576">                JRootPane rootPane = getRootPane();</span>

<span class="nc bnc" id="L578" title="All 2 branches missed.">                if (((state &amp; Frame.MAXIMIZED_BOTH) != 0) &amp;&amp;</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">                        (rootPane.getBorder() == null ||</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                        (rootPane.getBorder() instanceof UIResource)) &amp;&amp;</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">                            frame.isShowing()) {</span>
<span class="nc" id="L582">                    rootPane.setBorder(null);</span>
                }
<span class="nc bnc" id="L584" title="All 2 branches missed.">                else if ((state &amp; Frame.MAXIMIZED_BOTH) == 0) {</span>
                    // This is a croak, if state becomes bound, this can
                    // be nuked.
<span class="nc" id="L587">                    rootPaneUI.installBorder(rootPane);</span>
                }
<span class="nc bnc" id="L589" title="All 2 branches missed.">                if (frame.isResizable()) {</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                    if ((state &amp; Frame.MAXIMIZED_BOTH) != 0) {</span>
<span class="nc" id="L591">                        updateToggleButton(restoreAction, minimizeIcon);</span>
<span class="nc" id="L592">                        maximizeAction.setEnabled(false);</span>
<span class="nc" id="L593">                        restoreAction.setEnabled(true);</span>
                    }
                    else {
<span class="nc" id="L596">                        updateToggleButton(maximizeAction, maximizeIcon);</span>
<span class="nc" id="L597">                        maximizeAction.setEnabled(true);</span>
<span class="nc" id="L598">                        restoreAction.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L600" title="All 2 branches missed.">                    if (toggleButton.getParent() == null ||</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">                        iconifyButton.getParent() == null) {</span>
<span class="nc" id="L602">                        add(toggleButton);</span>
<span class="nc" id="L603">                        add(iconifyButton);</span>
<span class="nc" id="L604">                        revalidate();</span>
<span class="nc" id="L605">                        repaint();</span>
                    }
<span class="nc" id="L607">                    toggleButton.setText(null);</span>
                }
                else {
<span class="nc" id="L610">                    maximizeAction.setEnabled(false);</span>
<span class="nc" id="L611">                    restoreAction.setEnabled(false);</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">                    if (toggleButton.getParent() != null) {</span>
<span class="nc" id="L613">                        remove(toggleButton);</span>
<span class="nc" id="L614">                        revalidate();</span>
<span class="nc" id="L615">                        repaint();</span>
                    }
                }
<span class="nc" id="L618">            }</span>
            else {
                // Not contained in a Frame
<span class="nc" id="L621">                maximizeAction.setEnabled(false);</span>
<span class="nc" id="L622">                restoreAction.setEnabled(false);</span>
<span class="nc" id="L623">                iconifyAction.setEnabled(false);</span>
<span class="nc" id="L624">                remove(toggleButton);</span>
<span class="nc" id="L625">                remove(iconifyButton);</span>
<span class="nc" id="L626">                revalidate();</span>
<span class="nc" id="L627">                repaint();</span>
            }
<span class="nc" id="L629">            closeAction.setEnabled(true);</span>
<span class="nc" id="L630">            this.state = state;</span>
        }
<span class="nc" id="L632">    }</span>

    /**
     * Updates the toggle button to contain the Icon &lt;code&gt;icon&lt;/code&gt;, and
     * Action &lt;code&gt;action&lt;/code&gt;.
     */
    private void updateToggleButton(Action action, Icon icon) {
<span class="nc" id="L639">        toggleButton.setAction(action);</span>
<span class="nc" id="L640">        toggleButton.setIcon(icon);</span>
<span class="nc" id="L641">        toggleButton.setText(null);</span>
<span class="nc" id="L642">    }</span>

    /**
     * Returns the Frame rendering in. This will return null if the
     * &lt;code&gt;JRootPane&lt;/code&gt; is not contained in a &lt;code&gt;Frame&lt;/code&gt;.
     */
    private Frame getFrame() {
<span class="nc" id="L649">        Window window = getWindow();</span>

<span class="nc bnc" id="L651" title="All 2 branches missed.">        if (window instanceof Frame) {</span>
<span class="nc" id="L652">            return (Frame)window;</span>
        }
<span class="nc" id="L654">        return null;</span>
    }

    /**
     * Returns the &lt;code&gt;Window&lt;/code&gt; the &lt;code&gt;JRootPane&lt;/code&gt; is
     * contained in. This will return null if there is no parent ancestor
     * of the &lt;code&gt;JRootPane&lt;/code&gt;.
     */
    private Window getWindow() {
<span class="nc" id="L663">        return window;</span>
    }

    /**
     * Returns the String to display as the title.
     */
    private String getTitle() {
<span class="nc" id="L670">        Window w = getWindow();</span>

<span class="nc bnc" id="L672" title="All 2 branches missed.">        if (w instanceof Frame) {</span>
<span class="nc" id="L673">            return ((Frame)w).getTitle();</span>
        }
<span class="nc bnc" id="L675" title="All 2 branches missed.">        else if (w instanceof Dialog) {</span>
<span class="nc" id="L676">            return ((Dialog)w).getTitle();</span>
        }
<span class="nc" id="L678">        return null;</span>
    }

    /**
     * Renders the TitlePane.
     */
    public void paintComponent(Graphics g)  {
        // As state isn't bound, we need a convenience place to check
        // if it has changed. Changing the state typically changes the
<span class="nc bnc" id="L687" title="All 2 branches missed.">        if (getFrame() != null) {</span>
<span class="nc" id="L688">            setState(getFrame().getExtendedState());</span>
        }
<span class="nc" id="L690">        JRootPane rootPane = getRootPane();</span>
<span class="nc" id="L691">        Window window = getWindow();</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">        boolean leftToRight = (window == null) ?</span>
<span class="nc" id="L693">                               rootPane.getComponentOrientation().isLeftToRight() :</span>
<span class="nc" id="L694">                               window.getComponentOrientation().isLeftToRight();</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">        boolean isSelected = (window == null) ? true : window.isActive();</span>
<span class="nc" id="L696">        int width = getWidth();</span>
<span class="nc" id="L697">        int height = getHeight();</span>

        Color background;
        Color foreground;
        Color darkShadow;

        MetalBumps bumps;

<span class="nc bnc" id="L705" title="All 2 branches missed.">        if (isSelected) {</span>
<span class="nc" id="L706">            background = activeBackground;</span>
<span class="nc" id="L707">            foreground = activeForeground;</span>
<span class="nc" id="L708">            darkShadow = activeShadow;</span>
<span class="nc" id="L709">            bumps = activeBumps;</span>
        } else {
<span class="nc" id="L711">            background = inactiveBackground;</span>
<span class="nc" id="L712">            foreground = inactiveForeground;</span>
<span class="nc" id="L713">            darkShadow = inactiveShadow;</span>
<span class="nc" id="L714">            bumps = inactiveBumps;</span>
        }

<span class="nc" id="L717">        g.setColor(background);</span>
<span class="nc" id="L718">        g.fillRect(0, 0, width, height);</span>

<span class="nc" id="L720">        g.setColor( darkShadow );</span>
<span class="nc" id="L721">        g.drawLine ( 0, height - 1, width, height -1);</span>
<span class="nc" id="L722">        g.drawLine ( 0, 0, 0 ,0);</span>
<span class="nc" id="L723">        g.drawLine ( width - 1, 0 , width -1, 0);</span>

<span class="nc bnc" id="L725" title="All 2 branches missed.">        int xOffset = leftToRight ? 5 : width - 5;</span>

<span class="nc bnc" id="L727" title="All 2 branches missed.">        if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc bnc" id="L728" title="All 2 branches missed.">            xOffset += leftToRight ? IMAGE_WIDTH + 5 : - IMAGE_WIDTH - 5;</span>
        }

<span class="nc" id="L731">        String theTitle = getTitle();</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">        if (theTitle != null) {</span>
<span class="nc" id="L733">            FontMetrics fm = SwingUtilities2.getFontMetrics(rootPane, g);</span>

<span class="nc" id="L735">            g.setColor(foreground);</span>

<span class="nc" id="L737">            int yOffset = ( (height - fm.getHeight() ) / 2 ) + fm.getAscent();</span>

<span class="nc" id="L739">            Rectangle rect = new Rectangle(0, 0, 0, 0);</span>
<span class="nc bnc" id="L740" title="All 4 branches missed.">            if (iconifyButton != null &amp;&amp; iconifyButton.getParent() != null) {</span>
<span class="nc" id="L741">                rect = iconifyButton.getBounds();</span>
            }
            int titleW;

<span class="nc bnc" id="L745" title="All 2 branches missed.">            if( leftToRight ) {</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">                if (rect.x == 0) {</span>
<span class="nc" id="L747">                    rect.x = window.getWidth() - window.getInsets().right-2;</span>
                }
<span class="nc" id="L749">                titleW = rect.x - xOffset - 4;</span>
<span class="nc" id="L750">                theTitle = SwingUtilities2.clipStringIfNecessary(</span>
                                rootPane, fm, theTitle, titleW);
            } else {
<span class="nc" id="L753">                titleW = xOffset - rect.x - rect.width - 4;</span>
<span class="nc" id="L754">                theTitle = SwingUtilities2.clipStringIfNecessary(</span>
                                rootPane, fm, theTitle, titleW);
<span class="nc" id="L756">                xOffset -= SwingUtilities2.stringWidth(rootPane, fm,</span>
                                                       theTitle);
            }
<span class="nc" id="L759">            int titleLength = SwingUtilities2.stringWidth(rootPane, fm,</span>
                                                          theTitle);
<span class="nc" id="L761">            SwingUtilities2.drawString(rootPane, g, theTitle, xOffset,</span>
                                       yOffset );
<span class="nc bnc" id="L763" title="All 2 branches missed.">            xOffset += leftToRight ? titleLength + 5  : -5;</span>
        }

        int bumpXOffset;
        int bumpLength;
<span class="nc bnc" id="L768" title="All 2 branches missed.">        if( leftToRight ) {</span>
<span class="nc" id="L769">            bumpLength = width - buttonsWidth - xOffset - 5;</span>
<span class="nc" id="L770">            bumpXOffset = xOffset;</span>
        } else {
<span class="nc" id="L772">            bumpLength = xOffset - buttonsWidth - 5;</span>
<span class="nc" id="L773">            bumpXOffset = buttonsWidth + 5;</span>
        }
<span class="nc" id="L775">        int bumpYOffset = 3;</span>
<span class="nc" id="L776">        int bumpHeight = getHeight() - (2 * bumpYOffset);</span>
<span class="nc" id="L777">        bumps.setBumpArea( bumpLength, bumpHeight );</span>
<span class="nc" id="L778">        bumps.paintIcon(this, g, bumpXOffset, bumpYOffset);</span>
<span class="nc" id="L779">    }</span>

    /**
     * Actions used to &lt;code&gt;close&lt;/code&gt; the &lt;code&gt;Window&lt;/code&gt;.
     */
    private class CloseAction extends AbstractAction {
<span class="nc" id="L785">        public CloseAction() {</span>
<span class="nc" id="L786">            super(UIManager.getString(&quot;MetalTitlePane.closeTitle&quot;,</span>
<span class="nc" id="L787">                                      getLocale()));</span>
<span class="nc" id="L788">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L791">            close();</span>
<span class="nc" id="L792">        }</span>
    }


    /**
     * Actions used to &lt;code&gt;iconfiy&lt;/code&gt; the &lt;code&gt;Frame&lt;/code&gt;.
     */
    private class IconifyAction extends AbstractAction {
<span class="nc" id="L800">        public IconifyAction() {</span>
<span class="nc" id="L801">            super(UIManager.getString(&quot;MetalTitlePane.iconifyTitle&quot;,</span>
<span class="nc" id="L802">                                      getLocale()));</span>
<span class="nc" id="L803">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L806">            iconify();</span>
<span class="nc" id="L807">        }</span>
    }


    /**
     * Actions used to &lt;code&gt;restore&lt;/code&gt; the &lt;code&gt;Frame&lt;/code&gt;.
     */
    private class RestoreAction extends AbstractAction {
<span class="nc" id="L815">        public RestoreAction() {</span>
<span class="nc" id="L816">            super(UIManager.getString</span>
<span class="nc" id="L817">                  (&quot;MetalTitlePane.restoreTitle&quot;, getLocale()));</span>
<span class="nc" id="L818">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L821">            restore();</span>
<span class="nc" id="L822">        }</span>
    }


    /**
     * Actions used to &lt;code&gt;restore&lt;/code&gt; the &lt;code&gt;Frame&lt;/code&gt;.
     */
    private class MaximizeAction extends AbstractAction {
<span class="nc" id="L830">        public MaximizeAction() {</span>
<span class="nc" id="L831">            super(UIManager.getString(&quot;MetalTitlePane.maximizeTitle&quot;,</span>
<span class="nc" id="L832">                                      getLocale()));</span>
<span class="nc" id="L833">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L836">            maximize();</span>
<span class="nc" id="L837">        }</span>
    }


    /**
     * Class responsible for drawing the system menu. Looks up the
     * image to draw from the Frame associated with the
     * &lt;code&gt;JRootPane&lt;/code&gt;.
     */
<span class="nc" id="L846">    private class SystemMenuBar extends JMenuBar {</span>
        public void paint(Graphics g) {
<span class="nc bnc" id="L848" title="All 2 branches missed.">            if (isOpaque()) {</span>
<span class="nc" id="L849">                g.setColor(getBackground());</span>
<span class="nc" id="L850">                g.fillRect(0, 0, getWidth(), getHeight());</span>
            }

<span class="nc bnc" id="L853" title="All 2 branches missed.">            if (systemIcon != null) {</span>
<span class="nc" id="L854">                g.drawImage(systemIcon, 0, 0, IMAGE_WIDTH, IMAGE_HEIGHT, null);</span>
            } else {
<span class="nc" id="L856">                Icon icon = UIManager.getIcon(&quot;InternalFrame.icon&quot;);</span>

<span class="nc bnc" id="L858" title="All 2 branches missed.">                if (icon != null) {</span>
<span class="nc" id="L859">                    icon.paintIcon(this, g, 0, 0);</span>
                }
            }
<span class="nc" id="L862">        }</span>
        public Dimension getMinimumSize() {
<span class="nc" id="L864">            return getPreferredSize();</span>
        }
        public Dimension getPreferredSize() {
<span class="nc" id="L867">            Dimension size = super.getPreferredSize();</span>

<span class="nc" id="L869">            return new Dimension(Math.max(IMAGE_WIDTH, size.width),</span>
<span class="nc" id="L870">                                 Math.max(size.height, IMAGE_HEIGHT));</span>
        }
    }

<span class="nc" id="L874">    private class TitlePaneLayout implements LayoutManager {</span>
<span class="nc" id="L875">        public void addLayoutComponent(String name, Component c) {}</span>
<span class="nc" id="L876">        public void removeLayoutComponent(Component c) {}</span>
        public Dimension preferredLayoutSize(Container c)  {
<span class="nc" id="L878">            int height = computeHeight();</span>
<span class="nc" id="L879">            return new Dimension(height, height);</span>
        }

        public Dimension minimumLayoutSize(Container c) {
<span class="nc" id="L883">            return preferredLayoutSize(c);</span>
        }

        private int computeHeight() {
<span class="nc" id="L887">            FontMetrics fm = rootPane.getFontMetrics(getFont());</span>
<span class="nc" id="L888">            int fontHeight = fm.getHeight();</span>
<span class="nc" id="L889">            fontHeight += 7;</span>
<span class="nc" id="L890">            int iconHeight = 0;</span>
<span class="nc bnc" id="L891" title="All 2 branches missed.">            if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc" id="L892">                iconHeight = IMAGE_HEIGHT;</span>
            }

<span class="nc" id="L895">            int finalHeight = Math.max( fontHeight, iconHeight );</span>
<span class="nc" id="L896">            return finalHeight;</span>
        }

        public void layoutContainer(Container c) {
<span class="nc bnc" id="L900" title="All 2 branches missed.">            boolean leftToRight = (window == null) ?</span>
<span class="nc" id="L901">                getRootPane().getComponentOrientation().isLeftToRight() :</span>
<span class="nc" id="L902">                window.getComponentOrientation().isLeftToRight();</span>

<span class="nc" id="L904">            int w = getWidth();</span>
            int x;
<span class="nc" id="L906">            int y = 3;</span>
            int spacing;
            int buttonHeight;
            int buttonWidth;

<span class="nc bnc" id="L911" title="All 4 branches missed.">            if (closeButton != null &amp;&amp; closeButton.getIcon() != null) {</span>
<span class="nc" id="L912">                buttonHeight = closeButton.getIcon().getIconHeight();</span>
<span class="nc" id="L913">                buttonWidth = closeButton.getIcon().getIconWidth();</span>
            }
            else {
<span class="nc" id="L916">                buttonHeight = IMAGE_HEIGHT;</span>
<span class="nc" id="L917">                buttonWidth = IMAGE_WIDTH;</span>
            }

            // assumes all buttons have the same dimensions
            // these dimensions include the borders

<span class="nc bnc" id="L923" title="All 2 branches missed.">            x = leftToRight ? w : 0;</span>

<span class="nc" id="L925">            spacing = 5;</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">            x = leftToRight ? spacing : w - buttonWidth - spacing;</span>
<span class="nc bnc" id="L927" title="All 2 branches missed.">            if (menuBar != null) {</span>
<span class="nc" id="L928">                menuBar.setBounds(x, y, buttonWidth, buttonHeight);</span>
            }

<span class="nc bnc" id="L931" title="All 2 branches missed.">            x = leftToRight ? w : 0;</span>
<span class="nc" id="L932">            spacing = 4;</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">            x += leftToRight ? -spacing -buttonWidth : spacing;</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">            if (closeButton != null) {</span>
<span class="nc" id="L935">                closeButton.setBounds(x, y, buttonWidth, buttonHeight);</span>
            }

<span class="nc bnc" id="L938" title="All 2 branches missed.">            if( !leftToRight ) x += buttonWidth;</span>

<span class="nc bnc" id="L940" title="All 2 branches missed.">            if (getWindowDecorationStyle() == JRootPane.FRAME) {</span>
<span class="nc bnc" id="L941" title="All 2 branches missed.">                if (Toolkit.getDefaultToolkit().isFrameStateSupported(</span>
                        Frame.MAXIMIZED_BOTH)) {
<span class="nc bnc" id="L943" title="All 2 branches missed.">                    if (toggleButton.getParent() != null) {</span>
<span class="nc" id="L944">                        spacing = 10;</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">                        x += leftToRight ? -spacing -buttonWidth : spacing;</span>
<span class="nc" id="L946">                        toggleButton.setBounds(x, y, buttonWidth, buttonHeight);</span>
<span class="nc bnc" id="L947" title="All 2 branches missed.">                        if (!leftToRight) {</span>
<span class="nc" id="L948">                            x += buttonWidth;</span>
                        }
                    }
                }

<span class="nc bnc" id="L953" title="All 4 branches missed.">                if (iconifyButton != null &amp;&amp; iconifyButton.getParent() != null) {</span>
<span class="nc" id="L954">                    spacing = 2;</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">                    x += leftToRight ? -spacing -buttonWidth : spacing;</span>
<span class="nc" id="L956">                    iconifyButton.setBounds(x, y, buttonWidth, buttonHeight);</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">                    if (!leftToRight) {</span>
<span class="nc" id="L958">                        x += buttonWidth;</span>
                    }
                }
            }
<span class="nc bnc" id="L962" title="All 2 branches missed.">            buttonsWidth = leftToRight ? w - x : x;</span>
<span class="nc" id="L963">        }</span>
    }



    /**
     * PropertyChangeListener installed on the Window. Updates the necessary
     * state as the state of the Window changes.
     */
<span class="nc" id="L972">    private class PropertyChangeHandler implements PropertyChangeListener {</span>
        public void propertyChange(PropertyChangeEvent pce) {
<span class="nc" id="L974">            String name = pce.getPropertyName();</span>

            // Frame.state isn't currently bound.
<span class="nc bnc" id="L977" title="All 4 branches missed.">            if (&quot;resizable&quot;.equals(name) || &quot;state&quot;.equals(name)) {</span>
<span class="nc" id="L978">                Frame frame = getFrame();</span>

<span class="nc bnc" id="L980" title="All 2 branches missed.">                if (frame != null) {</span>
<span class="nc" id="L981">                    setState(frame.getExtendedState(), true);</span>
                }
<span class="nc bnc" id="L983" title="All 2 branches missed.">                if (&quot;resizable&quot;.equals(name)) {</span>
<span class="nc" id="L984">                    getRootPane().repaint();</span>
                }
<span class="nc" id="L986">            }</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">            else if (&quot;title&quot;.equals(name)) {</span>
<span class="nc" id="L988">                repaint();</span>
            }
<span class="nc bnc" id="L990" title="All 2 branches missed.">            else if (&quot;componentOrientation&quot; == name) {</span>
<span class="nc" id="L991">                revalidate();</span>
<span class="nc" id="L992">                repaint();</span>
            }
<span class="nc bnc" id="L994" title="All 2 branches missed.">            else if (&quot;iconImage&quot; == name) {</span>
<span class="nc" id="L995">                updateSystemIcon();</span>
<span class="nc" id="L996">                revalidate();</span>
<span class="nc" id="L997">                repaint();</span>
            }
<span class="nc" id="L999">        }</span>
    }

    /**
     * Update the image used for the system icon
     */
    private void updateSystemIcon() {
<span class="nc" id="L1006">        Window window = getWindow();</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L1008">            systemIcon = null;</span>
<span class="nc" id="L1009">            return;</span>
        }
<span class="nc" id="L1011">        java.util.List&lt;Image&gt; icons = window.getIconImages();</span>
<span class="nc bnc" id="L1012" title="All 4 branches missed.">        assert icons != null;</span>

<span class="nc bnc" id="L1014" title="All 2 branches missed.">        if (icons.size() == 0) {</span>
<span class="nc" id="L1015">            systemIcon = null;</span>
        }
<span class="nc bnc" id="L1017" title="All 2 branches missed.">        else if (icons.size() == 1) {</span>
<span class="nc" id="L1018">            systemIcon = icons.get(0);</span>
        }
        else {
<span class="nc" id="L1021">            systemIcon = SunToolkit.getScaledIconImage(icons,</span>
                                                       IMAGE_WIDTH,
                                                       IMAGE_HEIGHT);
        }
<span class="nc" id="L1025">    }</span>


    /**
     * WindowListener installed on the Window, updates the state as necessary.
     */
<span class="nc" id="L1031">    private class WindowHandler extends WindowAdapter {</span>
        public void windowActivated(WindowEvent ev) {
<span class="nc" id="L1033">            setActive(true);</span>
<span class="nc" id="L1034">        }</span>

        public void windowDeactivated(WindowEvent ev) {
<span class="nc" id="L1037">            setActive(false);</span>
<span class="nc" id="L1038">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>