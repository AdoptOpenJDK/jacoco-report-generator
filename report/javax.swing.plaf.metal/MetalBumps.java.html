<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MetalBumps.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.metal</a> &gt; <span class="el_source">MetalBumps.java</span></div><h1>MetalBumps.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2009, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.metal;

import java.awt.*;
import java.awt.image.*;
import javax.swing.*;
import java.util.ArrayList;
import java.util.List;
import sun.awt.AppContext;

/**
 * Implements the bumps used throughout the Metal Look and Feel.
 *
 * @author Tom Santos
 * @author Steve Wilson
 */


class MetalBumps implements Icon {

<span class="nc" id="L45">    static final Color ALPHA = new Color(0, 0, 0, 0);</span>

    protected int xBumps;
    protected int yBumps;
    protected Color topColor;
    protected Color shadowColor;
    protected Color backColor;

<span class="nc" id="L53">    private static final Object METAL_BUMPS = new Object();</span>
    protected BumpBuffer buffer;

    /**
     * Creates MetalBumps of the specified size with the specified colors.
     * If &lt;code&gt;newBackColor&lt;/code&gt; is null, the background will be
     * transparent.
     */
    public MetalBumps( int width, int height,
<span class="nc" id="L62">                       Color newTopColor, Color newShadowColor, Color newBackColor ) {</span>
<span class="nc" id="L63">        setBumpArea( width, height );</span>
<span class="nc" id="L64">        setBumpColors( newTopColor, newShadowColor, newBackColor );</span>
<span class="nc" id="L65">    }</span>

    private static BumpBuffer createBuffer(GraphicsConfiguration gc,
                                           Color topColor, Color shadowColor, Color backColor) {
<span class="nc" id="L69">        AppContext context = AppContext.getAppContext();</span>
<span class="nc" id="L70">        List&lt;BumpBuffer&gt; buffers = (List&lt;BumpBuffer&gt;) context.get(METAL_BUMPS);</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">        if (buffers == null) {</span>
<span class="nc" id="L72">            buffers = new ArrayList&lt;BumpBuffer&gt;();</span>
<span class="nc" id="L73">            context.put(METAL_BUMPS, buffers);</span>
        }
<span class="nc bnc" id="L75" title="All 2 branches missed.">        for (BumpBuffer buffer : buffers) {</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">            if (buffer.hasSameConfiguration(gc, topColor, shadowColor, backColor)) {</span>
<span class="nc" id="L77">                return buffer;</span>
            }
<span class="nc" id="L79">        }</span>
<span class="nc" id="L80">        BumpBuffer buffer = new BumpBuffer(gc, topColor, shadowColor, backColor);</span>
<span class="nc" id="L81">        buffers.add(buffer);</span>
<span class="nc" id="L82">        return buffer;</span>
    }

    public void setBumpArea( Dimension bumpArea ) {
<span class="nc" id="L86">        setBumpArea( bumpArea.width, bumpArea.height );</span>
<span class="nc" id="L87">    }</span>

    public void setBumpArea( int width, int height ) {
<span class="nc" id="L90">        xBumps = width / 2;</span>
<span class="nc" id="L91">        yBumps = height / 2;</span>
<span class="nc" id="L92">    }</span>

    public void setBumpColors( Color newTopColor, Color newShadowColor, Color newBackColor ) {
<span class="nc" id="L95">        topColor = newTopColor;</span>
<span class="nc" id="L96">        shadowColor = newShadowColor;</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (newBackColor == null) {</span>
<span class="nc" id="L98">            backColor = ALPHA;</span>
        }
        else {
<span class="nc" id="L101">            backColor = newBackColor;</span>
        }
<span class="nc" id="L103">    }</span>

    public void paintIcon( Component c, Graphics g, int x, int y ) {
<span class="nc bnc" id="L106" title="All 2 branches missed.">        GraphicsConfiguration gc = (g instanceof Graphics2D) ?</span>
<span class="nc" id="L107">                ((Graphics2D) g).getDeviceConfiguration() : null;</span>

<span class="nc bnc" id="L109" title="All 4 branches missed.">        if ((buffer == null) || !buffer.hasSameConfiguration(gc, topColor, shadowColor, backColor)) {</span>
<span class="nc" id="L110">            buffer = createBuffer(gc, topColor, shadowColor, backColor);</span>
        }

<span class="nc" id="L113">        int bufferWidth = BumpBuffer.IMAGE_SIZE;</span>
<span class="nc" id="L114">        int bufferHeight = BumpBuffer.IMAGE_SIZE;</span>
<span class="nc" id="L115">        int iconWidth = getIconWidth();</span>
<span class="nc" id="L116">        int iconHeight = getIconHeight();</span>
<span class="nc" id="L117">        int x2 = x + iconWidth;</span>
<span class="nc" id="L118">        int y2 = y + iconHeight;</span>
<span class="nc" id="L119">        int savex = x;</span>

<span class="nc bnc" id="L121" title="All 2 branches missed.">        while (y &lt; y2) {</span>
<span class="nc" id="L122">            int h = Math.min(y2 - y, bufferHeight);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">            for (x = savex; x &lt; x2; x += bufferWidth) {</span>
<span class="nc" id="L124">                int w = Math.min(x2 - x, bufferWidth);</span>
<span class="nc" id="L125">                g.drawImage(buffer.getImage(),</span>
                            x, y, x+w, y+h,
                            0, 0, w, h,
                            null);
            }
<span class="nc" id="L130">            y += bufferHeight;</span>
<span class="nc" id="L131">        }</span>
<span class="nc" id="L132">    }</span>

    public int getIconWidth() {
<span class="nc" id="L135">        return xBumps * 2;</span>
    }

    public int getIconHeight() {
<span class="nc" id="L139">        return yBumps * 2;</span>
    }
}


class BumpBuffer {

    static final int IMAGE_SIZE = 64;

    transient Image image;
    Color topColor;
    Color shadowColor;
    Color backColor;
    private GraphicsConfiguration gc;

    public BumpBuffer(GraphicsConfiguration gc, Color aTopColor,
<span class="nc" id="L155">                      Color aShadowColor, Color aBackColor) {</span>
<span class="nc" id="L156">        this.gc = gc;</span>
<span class="nc" id="L157">        topColor = aTopColor;</span>
<span class="nc" id="L158">        shadowColor = aShadowColor;</span>
<span class="nc" id="L159">        backColor = aBackColor;</span>
<span class="nc" id="L160">        createImage();</span>
<span class="nc" id="L161">        fillBumpBuffer();</span>
<span class="nc" id="L162">    }</span>

    public boolean hasSameConfiguration(GraphicsConfiguration gc,
                                        Color aTopColor, Color aShadowColor,
                                        Color aBackColor) {
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (this.gc != null) {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">            if (!this.gc.equals(gc)) {</span>
<span class="nc" id="L169">                return false;</span>
            }
        }
<span class="nc bnc" id="L172" title="All 2 branches missed.">        else if (gc != null) {</span>
<span class="nc" id="L173">            return false;</span>
        }
<span class="nc bnc" id="L175" title="All 2 branches missed.">        return topColor.equals( aTopColor )       &amp;&amp;</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">               shadowColor.equals( aShadowColor ) &amp;&amp;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">               backColor.equals( aBackColor );</span>
    }

    /**
     * Returns the Image containing the bumps appropriate for the passed in
     * &lt;code&gt;GraphicsConfiguration&lt;/code&gt;.
     */
    public Image getImage() {
<span class="nc" id="L185">        return image;</span>
    }

    /**
     * Paints the bumps into the current image.
     */
    private void fillBumpBuffer() {
<span class="nc" id="L192">        Graphics g = image.getGraphics();</span>

<span class="nc" id="L194">        g.setColor( backColor );</span>
<span class="nc" id="L195">        g.fillRect( 0, 0, IMAGE_SIZE, IMAGE_SIZE );</span>

<span class="nc" id="L197">        g.setColor(topColor);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">        for (int x = 0; x &lt; IMAGE_SIZE; x+=4) {</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            for (int y = 0; y &lt; IMAGE_SIZE; y+=4) {</span>
<span class="nc" id="L200">                g.drawLine( x, y, x, y );</span>
<span class="nc" id="L201">                g.drawLine( x+2, y+2, x+2, y+2);</span>
            }
        }

<span class="nc" id="L205">        g.setColor(shadowColor);</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        for (int x = 0; x &lt; IMAGE_SIZE; x+=4) {</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            for (int y = 0; y &lt; IMAGE_SIZE; y+=4) {</span>
<span class="nc" id="L208">                g.drawLine( x+1, y+1, x+1, y+1 );</span>
<span class="nc" id="L209">                g.drawLine( x+3, y+3, x+3, y+3);</span>
            }
        }
<span class="nc" id="L212">        g.dispose();</span>
<span class="nc" id="L213">    }</span>

    /**
     * Creates the image appropriate for the passed in
     * &lt;code&gt;GraphicsConfiguration&lt;/code&gt;, which may be null.
     */
    private void createImage() {
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (gc != null) {</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">            image = gc.createCompatibleImage(IMAGE_SIZE, IMAGE_SIZE,</span>
                       (backColor != MetalBumps.ALPHA) ? Transparency.OPAQUE :
                       Transparency.BITMASK);
        }
        else {
<span class="nc" id="L226">            int cmap[] = { backColor.getRGB(), topColor.getRGB(),</span>
<span class="nc" id="L227">                           shadowColor.getRGB() };</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">            IndexColorModel icm = new IndexColorModel(8, 3, cmap, 0, false,</span>
                      (backColor == MetalBumps.ALPHA) ? 0 : -1,
                      DataBuffer.TYPE_BYTE);
<span class="nc" id="L231">            image = new BufferedImage(IMAGE_SIZE, IMAGE_SIZE,</span>
                                      BufferedImage.TYPE_BYTE_INDEXED, icm);
        }
<span class="nc" id="L234">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>