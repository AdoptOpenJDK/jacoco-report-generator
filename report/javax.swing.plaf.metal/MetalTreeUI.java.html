<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MetalTreeUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.metal</a> &gt; <span class="el_source">MetalTreeUI.java</span></div><h1>MetalTreeUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.metal;

import javax.swing.*;
import javax.swing.event.*;
import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.io.*;
import java.util.*;
import javax.swing.plaf.*;
import javax.swing.tree.*;

import javax.swing.plaf.basic.*;

/**
 * The metal look and feel implementation of &lt;code&gt;TreeUI&lt;/code&gt;.
 * &lt;p&gt;
 * &lt;code&gt;MetalTreeUI&lt;/code&gt; allows for configuring how to
 * visually render the spacing and delineation between nodes. The following
 * hints are supported:
 *
 * &lt;table summary=&quot;Descriptions of supported hints: Angled, Horizontal, and None&quot;&gt;
 *  &lt;tr&gt;
 *    &lt;th&gt;&lt;p style=&quot;text-align:left&quot;&gt;Angled&lt;/p&gt;&lt;/th&gt;
 *    &lt;td&gt;A line is drawn connecting the child to the parent. For handling
 *          of the root node refer to
 *          {@link javax.swing.JTree#setRootVisible} and
 *          {@link javax.swing.JTree#setShowsRootHandles}.
 *    &lt;/td&gt;
 *  &lt;/tr&gt;
 *  &lt;tr&gt;
 *     &lt;th&gt;&lt;p style=&quot;text-align:left&quot;&gt;Horizontal&lt;/p&gt;&lt;/th&gt;
 *     &lt;td&gt;A horizontal line is drawn dividing the children of the root node.&lt;/td&gt;
 *  &lt;/tr&gt;
 *  &lt;tr&gt;
 *      &lt;th&gt;&lt;p style=&quot;text-align:left&quot;&gt;None&lt;/p&gt;&lt;/th&gt;
 *      &lt;td&gt;Do not draw any visual indication between nodes.&lt;/td&gt;
 *  &lt;/tr&gt;
 * &lt;/table&gt;
 *
 * &lt;p&gt;
 * As it is typically impractical to obtain the &lt;code&gt;TreeUI&lt;/code&gt; from
 * the &lt;code&gt;JTree&lt;/code&gt; and cast to an instance of &lt;code&gt;MetalTreeUI&lt;/code&gt;
 * you enable this property via the client property
 * &lt;code&gt;JTree.lineStyle&lt;/code&gt;. For example, to switch to
 * &lt;code&gt;Horizontal&lt;/code&gt; style you would do:
 * &lt;code&gt;tree.putClientProperty(&quot;JTree.lineStyle&quot;, &quot;Horizontal&quot;);&lt;/code&gt;
 * &lt;p&gt;
 * The default is &lt;code&gt;Angled&lt;/code&gt;.
 *
 * @author Tom Santos
 * @author Steve Wilson (value add stuff)
 */
public class MetalTreeUI extends BasicTreeUI {

    private static Color lineColor;

    private static final String LINE_STYLE = &quot;JTree.lineStyle&quot;;

    private static final String LEG_LINE_STYLE_STRING = &quot;Angled&quot;;
    private static final String HORIZ_STYLE_STRING = &quot;Horizontal&quot;;
    private static final String NO_STYLE_STRING = &quot;None&quot;;

    private static final int LEG_LINE_STYLE = 2;
    private static final int HORIZ_LINE_STYLE = 1;
    private static final int NO_LINE_STYLE = 0;

<span class="nc" id="L93">    private int lineStyle = LEG_LINE_STYLE;</span>
<span class="nc" id="L94">    private PropertyChangeListener lineStyleListener = new LineListener();</span>

    // Boilerplate
    public static ComponentUI createUI(JComponent x) {
<span class="nc" id="L98">        return new MetalTreeUI();</span>
    }

    public MetalTreeUI()
    {
<span class="nc" id="L103">        super();</span>
<span class="nc" id="L104">    }</span>

    protected int getHorizontalLegBuffer()
      {
<span class="nc" id="L108">          return 3;</span>
      }

    public void installUI( JComponent c ) {
<span class="nc" id="L112">        super.installUI( c );</span>
<span class="nc" id="L113">        lineColor = UIManager.getColor( &quot;Tree.line&quot; );</span>

<span class="nc" id="L115">        Object lineStyleFlag = c.getClientProperty( LINE_STYLE );</span>
<span class="nc" id="L116">        decodeLineStyle(lineStyleFlag);</span>
<span class="nc" id="L117">        c.addPropertyChangeListener(lineStyleListener);</span>

<span class="nc" id="L119">    }</span>

    public void uninstallUI( JComponent c) {
<span class="nc" id="L122">         c.removePropertyChangeListener(lineStyleListener);</span>
<span class="nc" id="L123">         super.uninstallUI(c);</span>
<span class="nc" id="L124">    }</span>

    /** this function converts between the string passed into the client property
      * and the internal representation (currently and int)
      *
      */
    protected void decodeLineStyle(Object lineStyleFlag) {
<span class="nc bnc" id="L131" title="All 2 branches missed.">      if ( lineStyleFlag == null ||</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">                    lineStyleFlag.equals(LEG_LINE_STYLE_STRING)){</span>
<span class="nc" id="L133">        lineStyle = LEG_LINE_STYLE; // default case</span>
      } else {
<span class="nc bnc" id="L135" title="All 2 branches missed.">          if ( lineStyleFlag.equals(NO_STYLE_STRING) ) {</span>
<span class="nc" id="L136">              lineStyle = NO_LINE_STYLE;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">          } else if ( lineStyleFlag.equals(HORIZ_STYLE_STRING) ) {</span>
<span class="nc" id="L138">              lineStyle = HORIZ_LINE_STYLE;</span>
          }
      }

<span class="nc" id="L142">    }</span>

    protected boolean isLocationInExpandControl(int row, int rowLevel,
                                                int mouseX, int mouseY) {
<span class="nc bnc" id="L146" title="All 4 branches missed.">        if(tree != null &amp;&amp; !isLeaf(row)) {</span>
            int                     boxWidth;

<span class="nc bnc" id="L149" title="All 2 branches missed.">            if(getExpandedIcon() != null)</span>
<span class="nc" id="L150">                boxWidth = getExpandedIcon().getIconWidth() + 6;</span>
            else
<span class="nc" id="L152">                boxWidth = 8;</span>

<span class="nc" id="L154">            Insets i = tree.getInsets();</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">            int    boxLeftX = (i != null) ? i.left : 0;</span>


<span class="nc" id="L158">            boxLeftX += (((rowLevel + depthOffset - 1) * totalChildIndent) +</span>
<span class="nc" id="L159">                        getLeftChildIndent()) - boxWidth/2;</span>

<span class="nc" id="L161">            int boxRightX = boxLeftX + boxWidth;</span>

<span class="nc bnc" id="L163" title="All 4 branches missed.">            return mouseX &gt;= boxLeftX &amp;&amp; mouseX &lt;= boxRightX;</span>
        }
<span class="nc" id="L165">        return false;</span>
    }

    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L169">        super.paint( g, c );</span>


        // Paint the lines
<span class="nc bnc" id="L173" title="All 4 branches missed.">        if (lineStyle == HORIZ_LINE_STYLE &amp;&amp; !largeModel) {</span>
<span class="nc" id="L174">            paintHorizontalSeparators(g,c);</span>
        }
<span class="nc" id="L176">    }</span>

    protected void paintHorizontalSeparators(Graphics g, JComponent c) {
<span class="nc" id="L179">        g.setColor( lineColor );</span>

<span class="nc" id="L181">        Rectangle clipBounds = g.getClipBounds();</span>

<span class="nc" id="L183">        int beginRow = getRowForPath(tree, getClosestPathForLocation</span>
<span class="nc" id="L184">                                     (tree, 0, clipBounds.y));</span>
<span class="nc" id="L185">        int endRow = getRowForPath(tree, getClosestPathForLocation</span>
<span class="nc" id="L186">                             (tree, 0, clipBounds.y + clipBounds.height - 1));</span>

<span class="nc bnc" id="L188" title="All 4 branches missed.">        if ( beginRow &lt;= -1 || endRow &lt;= -1 ) {</span>
<span class="nc" id="L189">            return;</span>
        }

<span class="nc bnc" id="L192" title="All 2 branches missed.">        for ( int i = beginRow; i &lt;= endRow; ++i ) {</span>
<span class="nc" id="L193">            TreePath        path = getPathForRow(tree, i);</span>

<span class="nc bnc" id="L195" title="All 4 branches missed.">            if(path != null &amp;&amp; path.getPathCount() == 2) {</span>
<span class="nc" id="L196">                Rectangle       rowBounds = getPathBounds(tree,getPathForRow</span>
<span class="nc" id="L197">                                                          (tree, i));</span>

                // Draw a line at the top
<span class="nc bnc" id="L200" title="All 2 branches missed.">                if(rowBounds != null)</span>
<span class="nc" id="L201">                    g.drawLine(clipBounds.x, rowBounds.y,</span>
                               clipBounds.x + clipBounds.width, rowBounds.y);
            }
        }

<span class="nc" id="L206">    }</span>

    protected void paintVerticalPartOfLeg(Graphics g, Rectangle clipBounds,
                                          Insets insets, TreePath path) {
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (lineStyle == LEG_LINE_STYLE) {</span>
<span class="nc" id="L211">            super.paintVerticalPartOfLeg(g, clipBounds, insets, path);</span>
        }
<span class="nc" id="L213">    }</span>

    protected void paintHorizontalPartOfLeg(Graphics g, Rectangle clipBounds,
                                            Insets insets, Rectangle bounds,
                                            TreePath path, int row,
                                            boolean isExpanded,
                                            boolean hasBeenExpanded, boolean
                                            isLeaf) {
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (lineStyle == LEG_LINE_STYLE) {</span>
<span class="nc" id="L222">            super.paintHorizontalPartOfLeg(g, clipBounds, insets, bounds,</span>
                                           path, row, isExpanded,
                                           hasBeenExpanded, isLeaf);
        }
<span class="nc" id="L226">    }</span>

    /** This class listens for changes in line style */
<span class="nc" id="L229">    class LineListener implements PropertyChangeListener {</span>
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L231">            String name = e.getPropertyName();</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">            if ( name.equals( LINE_STYLE ) ) {</span>
<span class="nc" id="L233">                decodeLineStyle(e.getNewValue());</span>
            }
<span class="nc" id="L235">        }</span>
    } // end class PaletteListener

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>