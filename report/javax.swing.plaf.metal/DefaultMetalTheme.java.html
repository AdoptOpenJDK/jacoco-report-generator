<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DefaultMetalTheme.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.metal</a> &gt; <span class="el_source">DefaultMetalTheme.java</span></div><h1>DefaultMetalTheme.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.metal;

import javax.swing.plaf.*;
import javax.swing.*;
import java.awt.*;

import sun.awt.AppContext;
import sun.security.action.GetPropertyAction;
import sun.swing.SwingUtilities2;

/**
 * A concrete implementation of {@code MetalTheme} providing
 * the original look of the Java Look and Feel, code-named &quot;Steel&quot;. Refer
 * to {@link MetalLookAndFeel#setCurrentTheme} for details on changing
 * the default theme.
 * &lt;p&gt;
 * All colors returned by {@code DefaultMetalTheme} are completely
 * opaque.
 *
 * &lt;h3&gt;&lt;a name=&quot;fontStyle&quot;&gt;&lt;/a&gt;Font Style&lt;/h3&gt;
 *
 * {@code DefaultMetalTheme} uses bold fonts for many controls.  To make all
 * controls (with the exception of the internal frame title bars and
 * client decorated frame title bars) use plain fonts you can do either of
 * the following:
 * &lt;ul&gt;
 * &lt;li&gt;Set the system property &lt;code&gt;swing.boldMetal&lt;/code&gt; to
 *     &lt;code&gt;false&lt;/code&gt;.  For example,
 *     &lt;code&gt;java&amp;nbsp;-Dswing.boldMetal=false&amp;nbsp;MyApp&lt;/code&gt;.
 * &lt;li&gt;Set the defaults property &lt;code&gt;swing.boldMetal&lt;/code&gt; to
 *     &lt;code&gt;Boolean.FALSE&lt;/code&gt;.  For example:
 *     &lt;code&gt;UIManager.put(&quot;swing.boldMetal&quot;,&amp;nbsp;Boolean.FALSE);&lt;/code&gt;
 * &lt;/ul&gt;
 * The defaults property &lt;code&gt;swing.boldMetal&lt;/code&gt;, if set,
 * takes precedence over the system property of the same name. After
 * setting this defaults property you need to re-install
 * &lt;code&gt;MetalLookAndFeel&lt;/code&gt;, as well as update the UI
 * of any previously created widgets. Otherwise the results are undefined.
 * The following illustrates how to do this:
 * &lt;pre&gt;
 *   // turn off bold fonts
 *   UIManager.put(&quot;swing.boldMetal&quot;, Boolean.FALSE);
 *
 *   // re-install the Metal Look and Feel
 *   UIManager.setLookAndFeel(new MetalLookAndFeel());
 *
 *   // Update the ComponentUIs for all Components. This
 *   // needs to be invoked for all windows.
 *   SwingUtilities.updateComponentTreeUI(rootComponent);
 * &lt;/pre&gt;
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases. The current serialization support is
 * appropriate for short term storage or RMI between applications running
 * the same version of Swing.  As of 1.4, support for long term storage
 * of all JavaBeans&amp;trade;
 * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
 * Please see {@link java.beans.XMLEncoder}.
 *
 * @see MetalLookAndFeel
 * @see MetalLookAndFeel#setCurrentTheme
 *
 * @author Steve Wilson
 */
public class DefaultMetalTheme extends MetalTheme {
    /**
     * Whether or not fonts should be plain.  This is only used if
     * the defaults property 'swing.boldMetal' == &quot;false&quot;.
     */
    private static final boolean PLAIN_FONTS;

    /**
     * Names of the fonts to use.
     */
<span class="fc" id="L101">    private static final String[] fontNames = {</span>
        Font.DIALOG,Font.DIALOG,Font.DIALOG,Font.DIALOG,Font.DIALOG,Font.DIALOG
    };
    /**
     * Styles for the fonts.  This is ignored if the defaults property
     * &lt;code&gt;swing.boldMetal&lt;/code&gt; is false, or PLAIN_FONTS is true.
     */
<span class="fc" id="L108">    private static final int[] fontStyles = {</span>
        Font.BOLD, Font.PLAIN, Font.PLAIN, Font.BOLD, Font.BOLD, Font.PLAIN
    };
    /**
     * Sizes for the fonts.
     */
<span class="fc" id="L114">    private static final int[] fontSizes = {</span>
        12, 12, 12, 12, 12, 10
    };

    // note the properties listed here can currently be used by people
    // providing runtimes to hint what fonts are good.  For example the bold
    // dialog font looks bad on a Mac, so Apple could use this property to
    // hint at a good font.
    //
    // However, we don't promise to support these forever.  We may move
    // to getting these from the swing.properties file, or elsewhere.
    /**
     * System property names used to look up fonts.
     */
<span class="fc" id="L128">    private static final String[] defaultNames = {</span>
        &quot;swing.plaf.metal.controlFont&quot;,
        &quot;swing.plaf.metal.systemFont&quot;,
        &quot;swing.plaf.metal.userFont&quot;,
        &quot;swing.plaf.metal.controlFont&quot;,
        &quot;swing.plaf.metal.controlFont&quot;,
        &quot;swing.plaf.metal.smallFont&quot;
    };

    /**
     * Returns the ideal font name for the font identified by key.
     */
    static String getDefaultFontName(int key) {
<span class="nc" id="L141">        return fontNames[key];</span>
    }

    /**
     * Returns the ideal font size for the font identified by key.
     */
    static int getDefaultFontSize(int key) {
<span class="nc" id="L148">        return fontSizes[key];</span>
    }

    /**
     * Returns the ideal font style for the font identified by key.
     */
    static int getDefaultFontStyle(int key) {
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (key != WINDOW_TITLE_FONT) {</span>
<span class="nc" id="L156">            Object boldMetal = null;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (AppContext.getAppContext().get(</span>
                    SwingUtilities2.LAF_STATE_KEY) != null) {
                // Only access the boldMetal key if a look and feel has
                // been loaded, otherwise we'll trigger loading the look
                // and feel.
<span class="nc" id="L162">                boldMetal = UIManager.get(&quot;swing.boldMetal&quot;);</span>
            }
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (boldMetal != null) {</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">                if (Boolean.FALSE.equals(boldMetal)) {</span>
<span class="nc" id="L166">                    return Font.PLAIN;</span>
                }
            }
<span class="nc bnc" id="L169" title="All 2 branches missed.">            else if (PLAIN_FONTS) {</span>
<span class="nc" id="L170">                return Font.PLAIN;</span>
            }
        }
<span class="nc" id="L173">        return fontStyles[key];</span>
    }

    /**
     * Returns the default used to look up the specified font.
     */
    static String getDefaultPropertyName(int key) {
<span class="nc" id="L180">        return defaultNames[key];</span>
    }

    static {
<span class="fc" id="L184">        Object boldProperty = java.security.AccessController.doPrivileged(</span>
            new GetPropertyAction(&quot;swing.boldMetal&quot;));
<span class="pc bpc" id="L186" title="3 of 4 branches missed.">        if (boldProperty == null || !&quot;false&quot;.equals(boldProperty)) {</span>
<span class="fc" id="L187">            PLAIN_FONTS = false;</span>
        }
        else {
<span class="nc" id="L190">            PLAIN_FONTS = true;</span>
        }
    }

<span class="fc" id="L194">    private static final ColorUIResource primary1 = new ColorUIResource(</span>
                              102, 102, 153);
<span class="fc" id="L196">    private static final ColorUIResource primary2 = new ColorUIResource(153,</span>
                              153, 204);
<span class="fc" id="L198">    private static final ColorUIResource primary3 = new ColorUIResource(</span>
                              204, 204, 255);
<span class="fc" id="L200">    private static final ColorUIResource secondary1 = new ColorUIResource(</span>
                              102, 102, 102);
<span class="fc" id="L202">    private static final ColorUIResource secondary2 = new ColorUIResource(</span>
                              153, 153, 153);
<span class="fc" id="L204">    private static final ColorUIResource secondary3 = new ColorUIResource(</span>
                              204, 204, 204);

    private FontDelegate fontDelegate;

    /**
     * Returns the name of this theme. This returns {@code &quot;Steel&quot;}.
     *
     * @return the name of this theme.
     */
<span class="nc" id="L214">    public String getName() { return &quot;Steel&quot;; }</span>

    /**
     * Creates and returns an instance of {@code DefaultMetalTheme}.
     */
<span class="fc" id="L219">    public DefaultMetalTheme() {</span>
<span class="fc" id="L220">        install();</span>
<span class="fc" id="L221">    }</span>

    /**
     * Returns the primary 1 color. This returns a color with rgb values
     * of 102, 102, and 153, respectively.
     *
     * @return the primary 1 color
     */
<span class="nc" id="L229">    protected ColorUIResource getPrimary1() { return primary1; }</span>

    /**
     * Returns the primary 2 color. This returns a color with rgb values
     * of 153, 153, 204, respectively.
     *
     * @return the primary 2 color
     */
<span class="nc" id="L237">    protected ColorUIResource getPrimary2() { return primary2; }</span>

    /**
     * Returns the primary 3 color. This returns a color with rgb values
     * 204, 204, 255, respectively.
     *
     * @return the primary 3 color
     */
<span class="nc" id="L245">    protected ColorUIResource getPrimary3() { return primary3; }</span>

    /**
     * Returns the secondary 1 color. This returns a color with rgb values
     * 102, 102, and 102, respectively.
     *
     * @return the secondary 1 color
     */
<span class="nc" id="L253">    protected ColorUIResource getSecondary1() { return secondary1; }</span>

    /**
     * Returns the secondary 2 color. This returns a color with rgb values
     * 153, 153, and 153, respectively.
     *
     * @return the secondary 2 color
     */
<span class="nc" id="L261">    protected ColorUIResource getSecondary2() { return secondary2; }</span>

    /**
     * Returns the secondary 3 color. This returns a color with rgb values
     * 204, 204, and 204, respectively.
     *
     * @return the secondary 3 color
     */
<span class="nc" id="L269">    protected ColorUIResource getSecondary3() { return secondary3; }</span>


    /**
     * Returns the control text font. This returns Dialog, 12pt. If
     * plain fonts have been enabled as described in &lt;a href=&quot;#fontStyle&quot;&gt;
     * font style&lt;/a&gt;, the font style is plain. Otherwise the font style is
     * bold.
     *
     * @return the control text font
     */
    public FontUIResource getControlTextFont() {
<span class="nc" id="L281">        return getFont(CONTROL_TEXT_FONT);</span>
    }

    /**
     * Returns the system text font. This returns Dialog, 12pt, plain.
     *
     * @return the system text font
     */
    public FontUIResource getSystemTextFont() {
<span class="nc" id="L290">        return getFont(SYSTEM_TEXT_FONT);</span>
    }

    /**
     * Returns the user text font. This returns Dialog, 12pt, plain.
     *
     * @return the user text font
     */
    public FontUIResource getUserTextFont() {
<span class="nc" id="L299">        return getFont(USER_TEXT_FONT);</span>
    }

    /**
     * Returns the menu text font. This returns Dialog, 12pt. If
     * plain fonts have been enabled as described in &lt;a href=&quot;#fontStyle&quot;&gt;
     * font style&lt;/a&gt;, the font style is plain. Otherwise the font style is
     * bold.
     *
     * @return the menu text font
     */
    public FontUIResource getMenuTextFont() {
<span class="nc" id="L311">        return getFont(MENU_TEXT_FONT);</span>
    }

    /**
     * Returns the window title font. This returns Dialog, 12pt, bold.
     *
     * @return the window title font
     */
    public FontUIResource getWindowTitleFont() {
<span class="nc" id="L320">        return getFont(WINDOW_TITLE_FONT);</span>
    }

    /**
     * Returns the sub-text font. This returns Dialog, 10pt, plain.
     *
     * @return the sub-text font
     */
    public FontUIResource getSubTextFont() {
<span class="nc" id="L329">        return getFont(SUB_TEXT_FONT);</span>
    }

    private FontUIResource getFont(int key) {
<span class="nc" id="L333">        return fontDelegate.getFont(key);</span>
    }

    void install() {
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">        if (MetalLookAndFeel.isWindows() &amp;&amp;</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">                             MetalLookAndFeel.useSystemFonts()) {</span>
<span class="nc" id="L339">            fontDelegate = new WindowsFontDelegate();</span>
        }
        else {
<span class="fc" id="L342">            fontDelegate = new FontDelegate();</span>
        }
<span class="fc" id="L344">    }</span>

    /**
     * Returns true if this is a theme provided by the core platform.
     */
    boolean isSystemTheme() {
<span class="nc bnc" id="L350" title="All 2 branches missed.">        return (getClass() == DefaultMetalTheme.class);</span>
    }

    /**
     * FontDelegates add an extra level of indirection to obtaining fonts.
     */
    private static class FontDelegate {
<span class="fc" id="L357">        private static int[] defaultMapping = {</span>
            CONTROL_TEXT_FONT, SYSTEM_TEXT_FONT,
            USER_TEXT_FONT, CONTROL_TEXT_FONT,
            CONTROL_TEXT_FONT, SUB_TEXT_FONT
        };
        FontUIResource fonts[];

        // menu and window are mapped to controlFont
<span class="fc" id="L365">        public FontDelegate() {</span>
<span class="fc" id="L366">            fonts = new FontUIResource[6];</span>
<span class="fc" id="L367">        }</span>

        public FontUIResource getFont(int type) {
<span class="nc" id="L370">            int mappedType = defaultMapping[type];</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">            if (fonts[type] == null) {</span>
<span class="nc" id="L372">                Font f = getPrivilegedFont(mappedType);</span>

<span class="nc bnc" id="L374" title="All 2 branches missed.">                if (f == null) {</span>
<span class="nc" id="L375">                    f = new Font(getDefaultFontName(type),</span>
<span class="nc" id="L376">                             getDefaultFontStyle(type),</span>
<span class="nc" id="L377">                             getDefaultFontSize(type));</span>
                }
<span class="nc" id="L379">                fonts[type] = new FontUIResource(f);</span>
            }
<span class="nc" id="L381">            return fonts[type];</span>
        }

        /**
         * This is the same as invoking
         * &lt;code&gt;Font.getFont(key)&lt;/code&gt;, with the exception
         * that it is wrapped inside a &lt;code&gt;doPrivileged&lt;/code&gt; call.
         */
        protected Font getPrivilegedFont(final int key) {
<span class="nc" id="L390">            return java.security.AccessController.doPrivileged(</span>
<span class="nc" id="L391">                new java.security.PrivilegedAction&lt;Font&gt;() {</span>
                    public Font run() {
<span class="nc" id="L393">                        return Font.getFont(getDefaultPropertyName(key));</span>
                    }
                }
                );
        }
    }

    /**
     * The WindowsFontDelegate uses DesktopProperties to obtain fonts.
     */
    private static class WindowsFontDelegate extends FontDelegate {
        private MetalFontDesktopProperty[] props;
        private boolean[] checkedPriviledged;

<span class="nc" id="L407">        public WindowsFontDelegate() {</span>
<span class="nc" id="L408">            props = new MetalFontDesktopProperty[6];</span>
<span class="nc" id="L409">            checkedPriviledged = new boolean[6];</span>
<span class="nc" id="L410">        }</span>

        public FontUIResource getFont(int type) {
<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (fonts[type] != null) {</span>
<span class="nc" id="L414">                return fonts[type];</span>
            }
<span class="nc bnc" id="L416" title="All 2 branches missed.">            if (!checkedPriviledged[type]) {</span>
<span class="nc" id="L417">                Font f = getPrivilegedFont(type);</span>

<span class="nc" id="L419">                checkedPriviledged[type] = true;</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">                if (f != null) {</span>
<span class="nc" id="L421">                    fonts[type] = new FontUIResource(f);</span>
<span class="nc" id="L422">                    return fonts[type];</span>
                }
            }
<span class="nc bnc" id="L425" title="All 2 branches missed.">            if (props[type] == null) {</span>
<span class="nc" id="L426">                props[type] = new MetalFontDesktopProperty(type);</span>
            }
            // While passing null may seem bad, we don't actually use
            // the table and looking it up is rather expensive.
<span class="nc" id="L430">            return (FontUIResource)props[type].createValue(null);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>