<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>SynthFileChooserUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.swing.plaf.synth</a> &gt; <span class="el_source">SynthFileChooserUI.java</span></div><h1>SynthFileChooserUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package sun.swing.plaf.synth;

import javax.swing.plaf.synth.*;
import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.io.File;
import java.util.regex.*;

import javax.swing.*;
import javax.swing.border.*;
import javax.swing.event.*;
import javax.swing.filechooser.*;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.BasicFileChooserUI;

/**
 * Synth FileChooserUI.
 *
 * Note: This class is abstract. It does not actually create the file chooser GUI.
 * &lt;p&gt;
 * Note that the classes in the com.sun.java.swing.plaf.synth
 * package are not
 * part of the core Java APIs. They are a part of Sun's JDK and JRE
 * distributions. Although other licensees may choose to distribute
 * these classes, developers cannot depend on their availability in
 * non-Sun implementations. Additionally this API may change in
 * incompatible ways between releases. While this class is public, it
 * shoud be considered an implementation detail, and subject to change.
 *
 * @author Leif Samuelsson
 * @author Jeff Dinkins
 */
public abstract class SynthFileChooserUI extends BasicFileChooserUI implements
                           SynthUI {
    private JButton approveButton, cancelButton;

    private SynthStyle style;

    // Some generic FileChooser functions
<span class="nc" id="L65">    private Action fileNameCompletionAction = new FileNameCompletionAction();</span>

<span class="nc" id="L67">    private FileFilter actualFileFilter = null;</span>
<span class="nc" id="L68">    private GlobFilter globFilter = null;</span>

    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L71">        return new SynthFileChooserUIImpl((JFileChooser)c);</span>
    }

    public SynthFileChooserUI(JFileChooser b) {
<span class="nc" id="L75">        super(b);</span>
<span class="nc" id="L76">    }</span>

    public SynthContext getContext(JComponent c) {
<span class="nc" id="L79">        return new SynthContext(c, Region.FILE_CHOOSER, style,</span>
<span class="nc" id="L80">                                getComponentState(c));</span>
    }

    protected SynthContext getContext(JComponent c, int state) {
<span class="nc" id="L84">        Region region = SynthLookAndFeel.getRegion(c);</span>
<span class="nc" id="L85">        return new SynthContext(c, Region.FILE_CHOOSER, style, state);</span>
    }

    private Region getRegion(JComponent c) {
<span class="nc" id="L89">        return SynthLookAndFeel.getRegion(c);</span>
    }

    private int getComponentState(JComponent c) {
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (c.isEnabled()) {</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">            if (c.isFocusOwner()) {</span>
<span class="nc" id="L95">                return ENABLED | FOCUSED;</span>
            }
<span class="nc" id="L97">            return ENABLED;</span>
        }
<span class="nc" id="L99">        return DISABLED;</span>
    }

    private void updateStyle(JComponent c) {
<span class="nc" id="L103">        SynthStyle newStyle = SynthLookAndFeel.getStyleFactory().getStyle(c,</span>
                                               Region.FILE_CHOOSER);
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (newStyle != style) {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">            if (style != null) {</span>
<span class="nc" id="L107">                style.uninstallDefaults(getContext(c, ENABLED));</span>
            }
<span class="nc" id="L109">            style = newStyle;</span>
<span class="nc" id="L110">            SynthContext context = getContext(c, ENABLED);</span>
<span class="nc" id="L111">            style.installDefaults(context);</span>
<span class="nc" id="L112">            Border border = c.getBorder();</span>
<span class="nc bnc" id="L113" title="All 4 branches missed.">            if (border == null || border instanceof UIResource) {</span>
<span class="nc" id="L114">                c.setBorder(new UIBorder(style.getInsets(context, null)));</span>
            }

<span class="nc" id="L117">            directoryIcon = style.getIcon(context, &quot;FileView.directoryIcon&quot;);</span>
<span class="nc" id="L118">            fileIcon = style.getIcon(context, &quot;FileView.fileIcon&quot;);</span>
<span class="nc" id="L119">            computerIcon = style.getIcon(context, &quot;FileView.computerIcon&quot;);</span>
<span class="nc" id="L120">            hardDriveIcon = style.getIcon(context, &quot;FileView.hardDriveIcon&quot;);</span>
<span class="nc" id="L121">            floppyDriveIcon = style.getIcon(context, &quot;FileView.floppyDriveIcon&quot;);</span>

<span class="nc" id="L123">            newFolderIcon    = style.getIcon(context, &quot;FileChooser.newFolderIcon&quot;);</span>
<span class="nc" id="L124">            upFolderIcon     = style.getIcon(context, &quot;FileChooser.upFolderIcon&quot;);</span>
<span class="nc" id="L125">            homeFolderIcon   = style.getIcon(context, &quot;FileChooser.homeFolderIcon&quot;);</span>
<span class="nc" id="L126">            detailsViewIcon  = style.getIcon(context, &quot;FileChooser.detailsViewIcon&quot;);</span>
<span class="nc" id="L127">            listViewIcon     = style.getIcon(context, &quot;FileChooser.listViewIcon&quot;);</span>
        }
<span class="nc" id="L129">    }</span>

    public void installUI(JComponent c) {
<span class="nc" id="L132">        super.installUI(c);</span>
<span class="nc" id="L133">        SwingUtilities.replaceUIActionMap(c, createActionMap());</span>
<span class="nc" id="L134">    }</span>

    public void installComponents(JFileChooser fc) {
<span class="nc" id="L137">        SynthContext context = getContext(fc, ENABLED);</span>

<span class="nc" id="L139">        cancelButton = new JButton(cancelButtonText);</span>
<span class="nc" id="L140">        cancelButton.setName(&quot;SynthFileChooser.cancelButton&quot;);</span>
<span class="nc" id="L141">        cancelButton.setIcon(context.getStyle().getIcon(context, &quot;FileChooser.cancelIcon&quot;));</span>
<span class="nc" id="L142">        cancelButton.setMnemonic(cancelButtonMnemonic);</span>
<span class="nc" id="L143">        cancelButton.setToolTipText(cancelButtonToolTipText);</span>
<span class="nc" id="L144">        cancelButton.addActionListener(getCancelSelectionAction());</span>

<span class="nc" id="L146">        approveButton = new JButton(getApproveButtonText(fc));</span>
<span class="nc" id="L147">        approveButton.setName(&quot;SynthFileChooser.approveButton&quot;);</span>
<span class="nc" id="L148">        approveButton.setIcon(context.getStyle().getIcon(context, &quot;FileChooser.okIcon&quot;));</span>
<span class="nc" id="L149">        approveButton.setMnemonic(getApproveButtonMnemonic(fc));</span>
<span class="nc" id="L150">        approveButton.setToolTipText(getApproveButtonToolTipText(fc));</span>
<span class="nc" id="L151">        approveButton.addActionListener(getApproveSelectionAction());</span>

<span class="nc" id="L153">    }</span>

    public void uninstallComponents(JFileChooser fc) {
<span class="nc" id="L156">        fc.removeAll();</span>
<span class="nc" id="L157">    }</span>

    protected void installListeners(JFileChooser fc) {
<span class="nc" id="L160">        super.installListeners(fc);</span>

<span class="nc" id="L162">        getModel().addListDataListener(new ListDataListener() {</span>
            public void contentsChanged(ListDataEvent e) {
                // Update the selection after JList has been updated
<span class="nc" id="L165">                new DelayedSelectionUpdater();</span>
<span class="nc" id="L166">            }</span>
            public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L168">                new DelayedSelectionUpdater();</span>
<span class="nc" id="L169">            }</span>
            public void intervalRemoved(ListDataEvent e) {
<span class="nc" id="L171">            }</span>
        });

<span class="nc" id="L174">    }</span>

    private class DelayedSelectionUpdater implements Runnable {
<span class="nc" id="L177">        DelayedSelectionUpdater() {</span>
<span class="nc" id="L178">            SwingUtilities.invokeLater(this);</span>
<span class="nc" id="L179">        }</span>

        public void run() {
<span class="nc" id="L182">            updateFileNameCompletion();</span>
<span class="nc" id="L183">        }</span>
    }

    protected abstract ActionMap createActionMap();


    protected void installDefaults(JFileChooser fc) {
<span class="nc" id="L190">        super.installDefaults(fc);</span>
<span class="nc" id="L191">        updateStyle(fc);</span>
<span class="nc" id="L192">    }</span>

    protected void uninstallDefaults(JFileChooser fc) {
<span class="nc" id="L195">        super.uninstallDefaults(fc);</span>

<span class="nc" id="L197">        SynthContext context = getContext(getFileChooser(), ENABLED);</span>
<span class="nc" id="L198">        style.uninstallDefaults(context);</span>
<span class="nc" id="L199">        style = null;</span>
<span class="nc" id="L200">    }</span>

    protected void installIcons(JFileChooser fc) {
        // The icons are installed in updateStyle, not here
<span class="nc" id="L204">    }</span>

    public void update(Graphics g, JComponent c) {
<span class="nc" id="L207">        SynthContext context = getContext(c);</span>

<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (c.isOpaque()) {</span>
<span class="nc" id="L210">            g.setColor(style.getColor(context, ColorType.BACKGROUND));</span>
<span class="nc" id="L211">            g.fillRect(0, 0, c.getWidth(), c.getHeight());</span>
        }

<span class="nc" id="L214">        style.getPainter(context).paintFileChooserBackground(context,</span>
<span class="nc" id="L215">                                    g, 0, 0, c.getWidth(), c.getHeight());</span>
<span class="nc" id="L216">        paint(context, g);</span>
<span class="nc" id="L217">    }</span>

    public void paintBorder(SynthContext context, Graphics g, int x, int y, int w, int h) {
<span class="nc" id="L220">    }</span>

    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L223">        SynthContext context = getContext(c);</span>

<span class="nc" id="L225">        paint(context, g);</span>
<span class="nc" id="L226">    }</span>

    protected void paint(SynthContext context, Graphics g) {
<span class="nc" id="L229">    }</span>

    abstract public void setFileName(String fileName);
    abstract public String getFileName();

    protected void doSelectedFileChanged(PropertyChangeEvent e) {
<span class="nc" id="L235">    }</span>

    protected void doSelectedFilesChanged(PropertyChangeEvent e) {
<span class="nc" id="L238">    }</span>

    protected void doDirectoryChanged(PropertyChangeEvent e) {
<span class="nc" id="L241">    }</span>

    protected void doAccessoryChanged(PropertyChangeEvent e) {
<span class="nc" id="L244">    }</span>

    protected void doFileSelectionModeChanged(PropertyChangeEvent e) {
<span class="nc" id="L247">    }</span>

    protected void doMultiSelectionChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (!getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L251">            getFileChooser().setSelectedFiles(null);</span>
        }
<span class="nc" id="L253">    }</span>

    protected void doControlButtonsChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (getFileChooser().getControlButtonsAreShown()) {</span>
<span class="nc" id="L257">            approveButton.setText(getApproveButtonText(getFileChooser()));</span>
<span class="nc" id="L258">            approveButton.setToolTipText(getApproveButtonToolTipText(getFileChooser()));</span>
<span class="nc" id="L259">            approveButton.setMnemonic(getApproveButtonMnemonic(getFileChooser()));</span>
        }
<span class="nc" id="L261">    }</span>

    protected void doAncestorChanged(PropertyChangeEvent e) {
<span class="nc" id="L264">    }</span>

    public PropertyChangeListener createPropertyChangeListener(JFileChooser fc) {
<span class="nc" id="L267">        return new SynthFCPropertyChangeListener();</span>
    }

<span class="nc" id="L270">    private class SynthFCPropertyChangeListener implements PropertyChangeListener {</span>
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L272">            String prop = e.getPropertyName();</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            if (prop.equals(JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L274">                doFileSelectionModeChanged(e);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">            } else if (prop.equals(JFileChooser.SELECTED_FILE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L276">                doSelectedFileChanged(e);</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">            } else if (prop.equals(JFileChooser.SELECTED_FILES_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L278">                doSelectedFilesChanged(e);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">            } else if (prop.equals(JFileChooser.DIRECTORY_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L280">                doDirectoryChanged(e);</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">            } else if (prop == JFileChooser.MULTI_SELECTION_ENABLED_CHANGED_PROPERTY) {</span>
<span class="nc" id="L282">                doMultiSelectionChanged(e);</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">            } else if (prop == JFileChooser.ACCESSORY_CHANGED_PROPERTY) {</span>
<span class="nc" id="L284">                doAccessoryChanged(e);</span>
<span class="nc bnc" id="L285" title="All 8 branches missed.">            } else if (prop == JFileChooser.APPROVE_BUTTON_TEXT_CHANGED_PROPERTY ||</span>
                       prop == JFileChooser.APPROVE_BUTTON_TOOL_TIP_TEXT_CHANGED_PROPERTY ||
                       prop == JFileChooser.DIALOG_TYPE_CHANGED_PROPERTY ||
                       prop == JFileChooser.CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY) {
<span class="nc" id="L289">                doControlButtonsChanged(e);</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">            } else if (prop.equals(&quot;componentOrientation&quot;)) {</span>
<span class="nc" id="L291">                ComponentOrientation o = (ComponentOrientation)e.getNewValue();</span>
<span class="nc" id="L292">                JFileChooser cc = (JFileChooser)e.getSource();</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">                if (o != (ComponentOrientation)e.getOldValue()) {</span>
<span class="nc" id="L294">                    cc.applyComponentOrientation(o);</span>
                }
<span class="nc bnc" id="L296" title="All 2 branches missed.">            } else if (prop.equals(&quot;ancestor&quot;)) {</span>
<span class="nc" id="L297">                doAncestorChanged(e);</span>
            }
<span class="nc" id="L299">        }</span>
    }


    /**
     * Responds to a File Name completion request (e.g. Tab)
     */
    private class FileNameCompletionAction extends AbstractAction {
<span class="nc" id="L307">        protected FileNameCompletionAction() {</span>
<span class="nc" id="L308">            super(&quot;fileNameCompletion&quot;);</span>
<span class="nc" id="L309">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L312">            JFileChooser chooser = getFileChooser();</span>

<span class="nc" id="L314">            String fileName = getFileName();</span>

<span class="nc bnc" id="L316" title="All 2 branches missed.">            if (fileName != null) {</span>
                // Remove whitespace from beginning and end of filename
<span class="nc" id="L318">                fileName = fileName.trim();</span>
            }

<span class="nc" id="L321">            resetGlobFilter();</span>

<span class="nc bnc" id="L323" title="All 4 branches missed.">            if (fileName == null || fileName.equals(&quot;&quot;) ||</span>
<span class="nc bnc" id="L324" title="All 4 branches missed.">                    (chooser.isMultiSelectionEnabled() &amp;&amp; fileName.startsWith(&quot;\&quot;&quot;))) {</span>
<span class="nc" id="L325">                return;</span>
            }

<span class="nc" id="L328">            FileFilter currentFilter = chooser.getFileFilter();</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">            if (globFilter == null) {</span>
<span class="nc" id="L330">                globFilter = new GlobFilter();</span>
            }
            try {
<span class="nc bnc" id="L333" title="All 2 branches missed.">                globFilter.setPattern(!isGlobPattern(fileName) ? fileName + &quot;*&quot; : fileName);</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">                if (!(currentFilter instanceof GlobFilter)) {</span>
<span class="nc" id="L335">                    actualFileFilter = currentFilter;</span>
                }
<span class="nc" id="L337">                chooser.setFileFilter(null);</span>
<span class="nc" id="L338">                chooser.setFileFilter(globFilter);</span>
<span class="nc" id="L339">                fileNameCompletionString = fileName;</span>
<span class="nc" id="L340">            } catch (PatternSyntaxException pse) {</span>
                // Not a valid glob pattern. Abandon filter.
<span class="nc" id="L342">            }</span>
<span class="nc" id="L343">        }</span>
    }

    private String fileNameCompletionString;

    private void updateFileNameCompletion() {
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (fileNameCompletionString != null) {</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">            if (fileNameCompletionString.equals(getFileName())) {</span>
<span class="nc" id="L351">                File[] files = getModel().getFiles().toArray(new File[0]);</span>
<span class="nc" id="L352">                String str = getCommonStartString(files);</span>
<span class="nc bnc" id="L353" title="All 4 branches missed.">                if (str != null &amp;&amp; str.startsWith(fileNameCompletionString)) {</span>
<span class="nc" id="L354">                    setFileName(str);</span>
                }
<span class="nc" id="L356">                fileNameCompletionString = null;</span>
            }
        }
<span class="nc" id="L359">    }</span>

    private String getCommonStartString(File[] files) {
<span class="nc" id="L362">        String str = null;</span>
<span class="nc" id="L363">        String str2 = null;</span>
<span class="nc" id="L364">        int i = 0;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">        if (files.length == 0) {</span>
<span class="nc" id="L366">            return null;</span>
        }
        while (true) {
<span class="nc bnc" id="L369" title="All 2 branches missed.">            for (int f = 0; f &lt; files.length; f++) {</span>
<span class="nc" id="L370">                String name = files[f].getName();</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">                if (f == 0) {</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">                    if (name.length() == i) {</span>
<span class="nc" id="L373">                        return str;</span>
                    }
<span class="nc" id="L375">                    str2 = name.substring(0, i+1);</span>
                }
<span class="nc bnc" id="L377" title="All 2 branches missed.">                if (!name.startsWith(str2)) {</span>
<span class="nc" id="L378">                    return str;</span>
                }
            }
<span class="nc" id="L381">            str = str2;</span>
<span class="nc" id="L382">            i++;</span>
        }
    }

    private void resetGlobFilter() {
<span class="nc bnc" id="L387" title="All 2 branches missed.">        if (actualFileFilter != null) {</span>
<span class="nc" id="L388">            JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L389">            FileFilter currentFilter = chooser.getFileFilter();</span>
<span class="nc bnc" id="L390" title="All 4 branches missed.">            if (currentFilter != null &amp;&amp; currentFilter.equals(globFilter)) {</span>
<span class="nc" id="L391">                chooser.setFileFilter(actualFileFilter);</span>
<span class="nc" id="L392">                chooser.removeChoosableFileFilter(globFilter);</span>
            }
<span class="nc" id="L394">            actualFileFilter = null;</span>
        }
<span class="nc" id="L396">    }</span>

    private static boolean isGlobPattern(String fileName) {
<span class="nc bnc" id="L399" title="All 6 branches missed.">        return ((File.separatorChar == '\\' &amp;&amp; fileName.indexOf('*') &gt;= 0)</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">                || (File.separatorChar == '/' &amp;&amp; (fileName.indexOf('*') &gt;= 0</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">                                                  || fileName.indexOf('?') &gt;= 0</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">                                                  || fileName.indexOf('[') &gt;= 0)));</span>
    }


    /* A file filter which accepts file patterns containing
     * the special wildcard '*' on windows, plus '?', and '[ ]' on Unix.
     */
<span class="nc" id="L409">    class GlobFilter extends FileFilter {</span>
        Pattern pattern;
        String globPattern;

        public void setPattern(String globPattern) {
<span class="nc" id="L414">            char[] gPat = globPattern.toCharArray();</span>
<span class="nc" id="L415">            char[] rPat = new char[gPat.length * 2];</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">            boolean isWin32 = (File.separatorChar == '\\');</span>
<span class="nc" id="L417">            boolean inBrackets = false;</span>
<span class="nc" id="L418">            int j = 0;</span>

<span class="nc" id="L420">            this.globPattern = globPattern;</span>

<span class="nc bnc" id="L422" title="All 2 branches missed.">            if (isWin32) {</span>
                // On windows, a pattern ending with *.* is equal to ending with *
<span class="nc" id="L424">                int len = gPat.length;</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">                if (globPattern.endsWith(&quot;*.*&quot;)) {</span>
<span class="nc" id="L426">                    len -= 2;</span>
                }
<span class="nc bnc" id="L428" title="All 2 branches missed.">                for (int i = 0; i &lt; len; i++) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">                    if (gPat[i] == '*') {</span>
<span class="nc" id="L430">                        rPat[j++] = '.';</span>
                    }
<span class="nc" id="L432">                    rPat[j++] = gPat[i];</span>
                }
<span class="nc" id="L434">            } else {</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">                for (int i = 0; i &lt; gPat.length; i++) {</span>
<span class="nc bnc" id="L436" title="All 6 branches missed.">                    switch(gPat[i]) {</span>
                      case '*':
<span class="nc bnc" id="L438" title="All 2 branches missed.">                        if (!inBrackets) {</span>
<span class="nc" id="L439">                            rPat[j++] = '.';</span>
                        }
<span class="nc" id="L441">                        rPat[j++] = '*';</span>
<span class="nc" id="L442">                        break;</span>

                      case '?':
<span class="nc bnc" id="L445" title="All 2 branches missed.">                        rPat[j++] = inBrackets ? '?' : '.';</span>
<span class="nc" id="L446">                        break;</span>

                      case '[':
<span class="nc" id="L449">                        inBrackets = true;</span>
<span class="nc" id="L450">                        rPat[j++] = gPat[i];</span>

<span class="nc bnc" id="L452" title="All 2 branches missed.">                        if (i &lt; gPat.length - 1) {</span>
<span class="nc bnc" id="L453" title="All 3 branches missed.">                            switch (gPat[i+1]) {</span>
                              case '!':
                              case '^':
<span class="nc" id="L456">                                rPat[j++] = '^';</span>
<span class="nc" id="L457">                                i++;</span>
<span class="nc" id="L458">                                break;</span>

                              case ']':
<span class="nc" id="L461">                                rPat[j++] = gPat[++i];</span>
<span class="nc" id="L462">                                break;</span>
                            }
                        }
                        break;

                      case ']':
<span class="nc" id="L468">                        rPat[j++] = gPat[i];</span>
<span class="nc" id="L469">                        inBrackets = false;</span>
<span class="nc" id="L470">                        break;</span>

                      case '\\':
<span class="nc bnc" id="L473" title="All 6 branches missed.">                        if (i == 0 &amp;&amp; gPat.length &gt; 1 &amp;&amp; gPat[1] == '~') {</span>
<span class="nc" id="L474">                            rPat[j++] = gPat[++i];</span>
                        } else {
<span class="nc" id="L476">                            rPat[j++] = '\\';</span>
<span class="nc bnc" id="L477" title="All 4 branches missed.">                            if (i &lt; gPat.length - 1 &amp;&amp; &quot;*?[]&quot;.indexOf(gPat[i+1]) &gt;= 0) {</span>
<span class="nc" id="L478">                                rPat[j++] = gPat[++i];</span>
                            } else {
<span class="nc" id="L480">                                rPat[j++] = '\\';</span>
                            }
                        }
<span class="nc" id="L483">                        break;</span>

                      default:
                        //if (&quot;+()|^$.{}&lt;&gt;&quot;.indexOf(gPat[i]) &gt;= 0) {
<span class="nc bnc" id="L487" title="All 2 branches missed.">                        if (!Character.isLetterOrDigit(gPat[i])) {</span>
<span class="nc" id="L488">                            rPat[j++] = '\\';</span>
                        }
<span class="nc" id="L490">                        rPat[j++] = gPat[i];</span>
                        break;
                    }
                }
            }
<span class="nc" id="L495">            this.pattern = Pattern.compile(new String(rPat, 0, j), Pattern.CASE_INSENSITIVE);</span>
<span class="nc" id="L496">        }</span>

        public boolean accept(File f) {
<span class="nc bnc" id="L499" title="All 2 branches missed.">            if (f == null) {</span>
<span class="nc" id="L500">                return false;</span>
            }
<span class="nc bnc" id="L502" title="All 2 branches missed.">            if (f.isDirectory()) {</span>
<span class="nc" id="L503">                return true;</span>
            }
<span class="nc" id="L505">            return pattern.matcher(f.getName()).matches();</span>
        }

        public String getDescription() {
<span class="nc" id="L509">            return globPattern;</span>
        }
    }


    // *******************************************************
    // ************ FileChooser UI PLAF methods **************
    // *******************************************************


    // *****************************
    // ***** Directory Actions *****
    // *****************************

    public Action getFileNameCompletionAction() {
<span class="nc" id="L524">        return fileNameCompletionAction;</span>
    }


    protected JButton getApproveButton(JFileChooser fc) {
<span class="nc" id="L529">        return approveButton;</span>
    }

    protected JButton getCancelButton(JFileChooser fc) {
<span class="nc" id="L533">        return cancelButton;</span>
    }


    // Overload to do nothing.   We don't have and icon cache.
<span class="nc" id="L538">    public void clearIconCache() { }</span>

    // Copied as SynthBorder is package private in synth
    private class UIBorder extends AbstractBorder implements UIResource {
        private Insets _insets;
<span class="nc" id="L543">        UIBorder(Insets insets) {</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">            if (insets != null) {</span>
<span class="nc" id="L545">                _insets = new Insets(insets.top, insets.left, insets.bottom,</span>
                                     insets.right);
            }
            else {
<span class="nc" id="L549">                _insets = null;</span>
            }
<span class="nc" id="L551">        }</span>

        public void paintBorder(Component c, Graphics g, int x, int y,
                                int width, int height) {
<span class="nc bnc" id="L555" title="All 2 branches missed.">            if (!(c instanceof JComponent)) {</span>
<span class="nc" id="L556">                return;</span>
            }
<span class="nc" id="L558">            JComponent jc = (JComponent)c;</span>
<span class="nc" id="L559">            SynthContext context = getContext(jc);</span>
<span class="nc" id="L560">            SynthStyle style = context.getStyle();</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">            if (style != null) {</span>
<span class="nc" id="L562">                style.getPainter(context).paintFileChooserBorder(</span>
                      context, g, x, y, width, height);
            }
<span class="nc" id="L565">        }</span>

        public Insets getBorderInsets(Component c, Insets insets) {
<span class="nc bnc" id="L568" title="All 2 branches missed.">            if (insets == null) {</span>
<span class="nc" id="L569">                insets = new Insets(0, 0, 0, 0);</span>
            }
<span class="nc bnc" id="L571" title="All 2 branches missed.">            if (_insets != null) {</span>
<span class="nc" id="L572">                insets.top = _insets.top;</span>
<span class="nc" id="L573">                insets.bottom = _insets.bottom;</span>
<span class="nc" id="L574">                insets.left = _insets.left;</span>
<span class="nc" id="L575">                insets.right = _insets.right;</span>
            }
            else {
<span class="nc" id="L578">                insets.top = insets.bottom = insets.right = insets.left = 0;</span>
            }
<span class="nc" id="L580">            return insets;</span>
        }
        public boolean isBorderOpaque() {
<span class="nc" id="L583">            return false;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>