<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SynthFileChooserUIImpl.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.swing.plaf.synth</a> &gt; <span class="el_source">SynthFileChooserUIImpl.java</span></div><h1>SynthFileChooserUIImpl.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package sun.swing.plaf.synth;

import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.io.*;
import java.util.*;
import java.security.AccessController;
import java.security.PrivilegedAction;

import javax.swing.*;
import javax.swing.event.*;
import javax.swing.filechooser.*;
import javax.swing.filechooser.FileFilter;
import javax.swing.plaf.basic.*;
import javax.swing.plaf.synth.*;
import javax.swing.plaf.ActionMapUIResource;

import sun.awt.shell.ShellFolder;
import sun.swing.*;

/**
 * Synth FileChooserUI implementation.
 * &lt;p&gt;
 * Note that the classes in the com.sun.java.swing.plaf.synth
 * package are not
 * part of the core Java APIs. They are a part of Sun's JDK and JRE
 * distributions. Although other licensees may choose to distribute
 * these classes, developers cannot depend on their availability in
 * non-Sun implementations. Additionally this API may change in
 * incompatible ways between releases. While this class is public, it
 * shoud be considered an implementation detail, and subject to change.
 *
 * @author Leif Samuelsson
 * @author Jeff Dinkins
 */
public class SynthFileChooserUIImpl extends SynthFileChooserUI {
    private JLabel lookInLabel;
    private JComboBox&lt;File&gt; directoryComboBox;
    private DirectoryComboBoxModel directoryComboBoxModel;
<span class="nc" id="L65">    private Action directoryComboBoxAction = new DirectoryComboBoxAction();</span>

    private FilterComboBoxModel filterComboBoxModel;

    private JTextField fileNameTextField;

    private FilePane filePane;
    private JToggleButton listViewButton;
    private JToggleButton detailsViewButton;

    private boolean readOnly;

    private JPanel buttonPanel;
    private JPanel bottomPanel;

    private JComboBox&lt;FileFilter&gt; filterComboBox;

<span class="nc" id="L82">    private static final Dimension hstrut5 = new Dimension(5, 1);</span>

<span class="nc" id="L84">    private static final Insets shrinkwrap = new Insets(0,0,0,0);</span>

    // Preferred and Minimum sizes for the dialog box
<span class="nc" id="L87">    private static Dimension LIST_PREF_SIZE = new Dimension(405, 135);</span>

    // Labels, mnemonics, and tooltips (oh my!)
<span class="nc" id="L90">    private int    lookInLabelMnemonic = 0;</span>
<span class="nc" id="L91">    private String lookInLabelText = null;</span>
<span class="nc" id="L92">    private String saveInLabelText = null;</span>

<span class="nc" id="L94">    private int    fileNameLabelMnemonic = 0;</span>
<span class="nc" id="L95">    private String fileNameLabelText = null;</span>
<span class="nc" id="L96">    private int    folderNameLabelMnemonic = 0;</span>
<span class="nc" id="L97">    private String folderNameLabelText = null;</span>

<span class="nc" id="L99">    private int    filesOfTypeLabelMnemonic = 0;</span>
<span class="nc" id="L100">    private String filesOfTypeLabelText = null;</span>

<span class="nc" id="L102">    private String upFolderToolTipText = null;</span>
<span class="nc" id="L103">    private String upFolderAccessibleName = null;</span>

<span class="nc" id="L105">    private String homeFolderToolTipText = null;</span>
<span class="nc" id="L106">    private String homeFolderAccessibleName = null;</span>

<span class="nc" id="L108">    private String newFolderToolTipText = null;</span>
<span class="nc" id="L109">    private String newFolderAccessibleName = null;</span>

<span class="nc" id="L111">    private String listViewButtonToolTipText = null;</span>
<span class="nc" id="L112">    private String listViewButtonAccessibleName = null;</span>

<span class="nc" id="L114">    private String detailsViewButtonToolTipText = null;</span>
<span class="nc" id="L115">    private String detailsViewButtonAccessibleName = null;</span>

    private AlignedLabel fileNameLabel;
<span class="nc" id="L118">    private final PropertyChangeListener modeListener = new PropertyChangeListener() {</span>
        public void propertyChange(PropertyChangeEvent event) {
<span class="nc bnc" id="L120" title="All 2 branches missed.">            if (fileNameLabel != null) {</span>
<span class="nc" id="L121">                populateFileNameLabel();</span>
            }
<span class="nc" id="L123">        }</span>
    };

    private void populateFileNameLabel() {
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (getFileChooser().getFileSelectionMode() == JFileChooser.DIRECTORIES_ONLY) {</span>
<span class="nc" id="L128">            fileNameLabel.setText(folderNameLabelText);</span>
<span class="nc" id="L129">            fileNameLabel.setDisplayedMnemonic(folderNameLabelMnemonic);</span>
        } else {
<span class="nc" id="L131">            fileNameLabel.setText(fileNameLabelText);</span>
<span class="nc" id="L132">            fileNameLabel.setDisplayedMnemonic(fileNameLabelMnemonic);</span>
        }
<span class="nc" id="L134">    }</span>

    public SynthFileChooserUIImpl(JFileChooser b) {
<span class="nc" id="L137">        super(b);</span>
<span class="nc" id="L138">    }</span>


<span class="nc" id="L141">    private class SynthFileChooserUIAccessor implements FilePane.FileChooserUIAccessor {</span>
        public JFileChooser getFileChooser() {
<span class="nc" id="L143">            return SynthFileChooserUIImpl.this.getFileChooser();</span>
        }

        public BasicDirectoryModel getModel() {
<span class="nc" id="L147">            return SynthFileChooserUIImpl.this.getModel();</span>
        }

        public JPanel createList() {
<span class="nc" id="L151">            return null;</span>
        }

        public JPanel createDetailsView() {
<span class="nc" id="L155">            return null;</span>
        }

        public boolean isDirectorySelected() {
<span class="nc" id="L159">            return SynthFileChooserUIImpl.this.isDirectorySelected();</span>
        }

        public File getDirectory() {
<span class="nc" id="L163">            return SynthFileChooserUIImpl.this.getDirectory();</span>
        }

        public Action getChangeToParentDirectoryAction() {
<span class="nc" id="L167">            return SynthFileChooserUIImpl.this.getChangeToParentDirectoryAction();</span>
        }

        public Action getApproveSelectionAction() {
<span class="nc" id="L171">            return SynthFileChooserUIImpl.this.getApproveSelectionAction();</span>
        }

        public Action getNewFolderAction() {
<span class="nc" id="L175">            return SynthFileChooserUIImpl.this.getNewFolderAction();</span>
        }

        public MouseListener createDoubleClickListener(JList list) {
<span class="nc" id="L179">            return SynthFileChooserUIImpl.this.createDoubleClickListener(getFileChooser(),</span>
                                                                     list);
        }

        public ListSelectionListener createListSelectionListener() {
<span class="nc" id="L184">            return SynthFileChooserUIImpl.this.createListSelectionListener(getFileChooser());</span>
        }
    }

    protected void installDefaults(JFileChooser fc) {
<span class="nc" id="L189">        super.installDefaults(fc);</span>
<span class="nc" id="L190">        readOnly = UIManager.getBoolean(&quot;FileChooser.readOnly&quot;);</span>
<span class="nc" id="L191">    }</span>

    public void installComponents(JFileChooser fc) {
<span class="nc" id="L194">        super.installComponents(fc);</span>

<span class="nc" id="L196">        SynthContext context = getContext(fc, ENABLED);</span>

<span class="nc" id="L198">        fc.setLayout(new BorderLayout(0, 11));</span>

        // ********************************* //
        // **** Construct the top panel **** //
        // ********************************* //

        // Directory manipulation buttons
<span class="nc" id="L205">        JPanel topPanel = new JPanel(new BorderLayout(11, 0));</span>
<span class="nc" id="L206">    JPanel topButtonPanel = new JPanel();</span>
<span class="nc" id="L207">    topButtonPanel.setLayout(new BoxLayout(topButtonPanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L208">    topPanel.add(topButtonPanel, BorderLayout.AFTER_LINE_ENDS);</span>

        // Add the top panel to the fileChooser
<span class="nc" id="L211">        fc.add(topPanel, BorderLayout.NORTH);</span>

        // ComboBox Label
<span class="nc" id="L214">        lookInLabel = new JLabel(lookInLabelText);</span>
<span class="nc" id="L215">        lookInLabel.setDisplayedMnemonic(lookInLabelMnemonic);</span>
<span class="nc" id="L216">        topPanel.add(lookInLabel, BorderLayout.BEFORE_LINE_BEGINS);</span>

        // CurrentDir ComboBox
<span class="nc" id="L219">        directoryComboBox = new JComboBox&lt;File&gt;();</span>
<span class="nc" id="L220">        directoryComboBox.getAccessibleContext().setAccessibleDescription(lookInLabelText);</span>
<span class="nc" id="L221">        directoryComboBox.putClientProperty( &quot;JComboBox.isTableCellEditor&quot;, Boolean.TRUE );</span>
<span class="nc" id="L222">        lookInLabel.setLabelFor(directoryComboBox);</span>
<span class="nc" id="L223">        directoryComboBoxModel = createDirectoryComboBoxModel(fc);</span>
<span class="nc" id="L224">        directoryComboBox.setModel(directoryComboBoxModel);</span>
<span class="nc" id="L225">        directoryComboBox.addActionListener(directoryComboBoxAction);</span>
<span class="nc" id="L226">        directoryComboBox.setRenderer(createDirectoryComboBoxRenderer(fc));</span>
<span class="nc" id="L227">        directoryComboBox.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L228">        directoryComboBox.setAlignmentY(JComponent.TOP_ALIGNMENT);</span>
<span class="nc" id="L229">        directoryComboBox.setMaximumRowCount(8);</span>
<span class="nc" id="L230">        topPanel.add(directoryComboBox, BorderLayout.CENTER);</span>

<span class="nc" id="L232">        filePane = new FilePane(new SynthFileChooserUIAccessor());</span>
<span class="nc" id="L233">        fc.addPropertyChangeListener(filePane);</span>

        // Add 'Go Up' to context menu, plus 'Go Home' if on Unix
<span class="nc" id="L236">        JPopupMenu contextMenu = filePane.getComponentPopupMenu();</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">        if (contextMenu != null) {</span>
<span class="nc" id="L238">            contextMenu.insert(getChangeToParentDirectoryAction(), 0);</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (File.separatorChar == '/') {</span>
<span class="nc" id="L240">                contextMenu.insert(getGoHomeAction(), 1);</span>
            }
        }

<span class="nc" id="L244">    FileSystemView fsv = fc.getFileSystemView();</span>

    // Up Button
<span class="nc" id="L247">    JButton upFolderButton = new JButton(getChangeToParentDirectoryAction());</span>
<span class="nc" id="L248">    upFolderButton.setText(null);</span>
<span class="nc" id="L249">    upFolderButton.setIcon(upFolderIcon);</span>
<span class="nc" id="L250">    upFolderButton.setToolTipText(upFolderToolTipText);</span>
<span class="nc" id="L251">    upFolderButton.getAccessibleContext().setAccessibleName(upFolderAccessibleName);</span>
<span class="nc" id="L252">    upFolderButton.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L253">    upFolderButton.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L254">    upFolderButton.setMargin(shrinkwrap);</span>

<span class="nc" id="L256">    topButtonPanel.add(upFolderButton);</span>
<span class="nc" id="L257">    topButtonPanel.add(Box.createRigidArea(hstrut5));</span>

    // Home Button
<span class="nc" id="L260">    File homeDir = fsv.getHomeDirectory();</span>
<span class="nc" id="L261">    String toolTipText = homeFolderToolTipText;</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">    if (fsv.isRoot(homeDir)) {</span>
<span class="nc" id="L263">        toolTipText = getFileView(fc).getName(homeDir); // Probably &quot;Desktop&quot;.</span>
    }

<span class="nc" id="L266">    JButton b = new JButton(homeFolderIcon);</span>
<span class="nc" id="L267">    b.setToolTipText(toolTipText);</span>
<span class="nc" id="L268">    b.getAccessibleContext().setAccessibleName(homeFolderAccessibleName);</span>
<span class="nc" id="L269">    b.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L270">    b.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L271">    b.setMargin(shrinkwrap);</span>

<span class="nc" id="L273">    b.addActionListener(getGoHomeAction());</span>
<span class="nc" id="L274">    topButtonPanel.add(b);</span>
<span class="nc" id="L275">    topButtonPanel.add(Box.createRigidArea(hstrut5));</span>

    // New Directory Button
<span class="nc bnc" id="L278" title="All 2 branches missed.">    if (!readOnly) {</span>
<span class="nc" id="L279">        b = new JButton(filePane.getNewFolderAction());</span>
<span class="nc" id="L280">        b.setText(null);</span>
<span class="nc" id="L281">        b.setIcon(newFolderIcon);</span>
<span class="nc" id="L282">        b.setToolTipText(newFolderToolTipText);</span>
<span class="nc" id="L283">        b.getAccessibleContext().setAccessibleName(newFolderAccessibleName);</span>
<span class="nc" id="L284">        b.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L285">        b.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L286">        b.setMargin(shrinkwrap);</span>
<span class="nc" id="L287">        topButtonPanel.add(b);</span>
<span class="nc" id="L288">        topButtonPanel.add(Box.createRigidArea(hstrut5));</span>
    }

    // View button group
<span class="nc" id="L292">    ButtonGroup viewButtonGroup = new ButtonGroup();</span>

    // List Button
<span class="nc" id="L295">    listViewButton = new JToggleButton(listViewIcon);</span>
<span class="nc" id="L296">    listViewButton.setToolTipText(listViewButtonToolTipText);</span>
<span class="nc" id="L297">    listViewButton.getAccessibleContext().setAccessibleName(listViewButtonAccessibleName);</span>
<span class="nc" id="L298">    listViewButton.setSelected(true);</span>
<span class="nc" id="L299">    listViewButton.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L300">    listViewButton.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L301">    listViewButton.setMargin(shrinkwrap);</span>
<span class="nc" id="L302">    listViewButton.addActionListener(filePane.getViewTypeAction(FilePane.VIEWTYPE_LIST));</span>
<span class="nc" id="L303">    topButtonPanel.add(listViewButton);</span>
<span class="nc" id="L304">    viewButtonGroup.add(listViewButton);</span>

    // Details Button
<span class="nc" id="L307">    detailsViewButton = new JToggleButton(detailsViewIcon);</span>
<span class="nc" id="L308">    detailsViewButton.setToolTipText(detailsViewButtonToolTipText);</span>
<span class="nc" id="L309">    detailsViewButton.getAccessibleContext().setAccessibleName(detailsViewButtonAccessibleName);</span>
<span class="nc" id="L310">    detailsViewButton.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L311">    detailsViewButton.setAlignmentY(JComponent.CENTER_ALIGNMENT);</span>
<span class="nc" id="L312">    detailsViewButton.setMargin(shrinkwrap);</span>
<span class="nc" id="L313">    detailsViewButton.addActionListener(filePane.getViewTypeAction(FilePane.VIEWTYPE_DETAILS));</span>
<span class="nc" id="L314">    topButtonPanel.add(detailsViewButton);</span>
<span class="nc" id="L315">    viewButtonGroup.add(detailsViewButton);</span>

<span class="nc" id="L317">    filePane.addPropertyChangeListener(new PropertyChangeListener() {</span>
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc bnc" id="L319" title="All 2 branches missed.">            if (&quot;viewType&quot;.equals(e.getPropertyName())) {</span>
<span class="nc" id="L320">                int viewType = filePane.getViewType();</span>
<span class="nc bnc" id="L321" title="All 3 branches missed.">                switch (viewType) {</span>
                    case FilePane.VIEWTYPE_LIST:
<span class="nc" id="L323">                        listViewButton.setSelected(true);</span>
<span class="nc" id="L324">                        break;</span>
                    case FilePane.VIEWTYPE_DETAILS:
<span class="nc" id="L326">                        detailsViewButton.setSelected(true);</span>
                        break;
                }
            }
<span class="nc" id="L330">        }</span>
    });

        // ************************************** //
        // ******* Add the directory pane ******* //
        // ************************************** //
<span class="nc" id="L336">        fc.add(getAccessoryPanel(), BorderLayout.AFTER_LINE_ENDS);</span>
<span class="nc" id="L337">        JComponent accessory = fc.getAccessory();</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">        if (accessory != null) {</span>
<span class="nc" id="L339">            getAccessoryPanel().add(accessory);</span>
        }
<span class="nc" id="L341">        filePane.setPreferredSize(LIST_PREF_SIZE);</span>
<span class="nc" id="L342">        fc.add(filePane, BorderLayout.CENTER);</span>


        // ********************************** //
        // **** Construct the bottom panel ** //
        // ********************************** //
<span class="nc" id="L348">        bottomPanel = new JPanel();</span>
<span class="nc" id="L349">        bottomPanel.setLayout(new BoxLayout(bottomPanel, BoxLayout.Y_AXIS));</span>
<span class="nc" id="L350">        fc.add(bottomPanel, BorderLayout.SOUTH);</span>

        // FileName label and textfield
<span class="nc" id="L353">        JPanel fileNamePanel = new JPanel();</span>
<span class="nc" id="L354">        fileNamePanel.setLayout(new BoxLayout(fileNamePanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L355">        bottomPanel.add(fileNamePanel);</span>
<span class="nc" id="L356">        bottomPanel.add(Box.createRigidArea(new Dimension(1, 5)));</span>

<span class="nc" id="L358">        fileNameLabel = new AlignedLabel();</span>
<span class="nc" id="L359">        populateFileNameLabel();</span>
<span class="nc" id="L360">        fileNamePanel.add(fileNameLabel);</span>

<span class="nc" id="L362">        fileNameTextField = new JTextField(35) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L364">                return new Dimension(Short.MAX_VALUE, super.getPreferredSize().height);</span>
            }
        };
<span class="nc" id="L367">        fileNamePanel.add(fileNameTextField);</span>
<span class="nc" id="L368">        fileNameLabel.setLabelFor(fileNameTextField);</span>
<span class="nc" id="L369">        fileNameTextField.addFocusListener(</span>
<span class="nc" id="L370">            new FocusAdapter() {</span>
                public void focusGained(FocusEvent e) {
<span class="nc bnc" id="L372" title="All 2 branches missed.">                    if (!getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L373">                        filePane.clearSelection();</span>
                    }
<span class="nc" id="L375">                }</span>
            }
        );
<span class="nc bnc" id="L378" title="All 2 branches missed.">        if (fc.isMultiSelectionEnabled()) {</span>
<span class="nc" id="L379">            setFileName(fileNameString(fc.getSelectedFiles()));</span>
        } else {
<span class="nc" id="L381">            setFileName(fileNameString(fc.getSelectedFile()));</span>
        }


        // Filetype label and combobox
<span class="nc" id="L386">        JPanel filesOfTypePanel = new JPanel();</span>
<span class="nc" id="L387">        filesOfTypePanel.setLayout(new BoxLayout(filesOfTypePanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L388">        bottomPanel.add(filesOfTypePanel);</span>

<span class="nc" id="L390">        AlignedLabel filesOfTypeLabel = new AlignedLabel(filesOfTypeLabelText);</span>
<span class="nc" id="L391">        filesOfTypeLabel.setDisplayedMnemonic(filesOfTypeLabelMnemonic);</span>
<span class="nc" id="L392">        filesOfTypePanel.add(filesOfTypeLabel);</span>

<span class="nc" id="L394">        filterComboBoxModel = createFilterComboBoxModel();</span>
<span class="nc" id="L395">        fc.addPropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L396">        filterComboBox = new JComboBox&lt;FileFilter&gt;(filterComboBoxModel);</span>
<span class="nc" id="L397">        filterComboBox.getAccessibleContext().setAccessibleDescription(filesOfTypeLabelText);</span>
<span class="nc" id="L398">        filesOfTypeLabel.setLabelFor(filterComboBox);</span>
<span class="nc" id="L399">        filterComboBox.setRenderer(createFilterComboBoxRenderer());</span>
<span class="nc" id="L400">        filesOfTypePanel.add(filterComboBox);</span>


        // buttons
<span class="nc" id="L404">        buttonPanel = new JPanel();</span>
<span class="nc" id="L405">        buttonPanel.setLayout(new ButtonAreaLayout());</span>

<span class="nc" id="L407">        buttonPanel.add(getApproveButton(fc));</span>
<span class="nc" id="L408">        buttonPanel.add(getCancelButton(fc));</span>

<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (fc.getControlButtonsAreShown()) {</span>
<span class="nc" id="L411">            addControlButtons();</span>
        }

<span class="nc" id="L414">        groupLabels(new AlignedLabel[] { fileNameLabel, filesOfTypeLabel });</span>
<span class="nc" id="L415">    }</span>

    protected void installListeners(JFileChooser fc) {
<span class="nc" id="L418">        super.installListeners(fc);</span>
<span class="nc" id="L419">        fc.addPropertyChangeListener(JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTY, modeListener);</span>
<span class="nc" id="L420">    }</span>

    protected void uninstallListeners(JFileChooser fc) {
<span class="nc" id="L423">        fc.removePropertyChangeListener(JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTY, modeListener);</span>
<span class="nc" id="L424">        super.uninstallListeners(fc);</span>
<span class="nc" id="L425">    }</span>

    private String fileNameString(File file) {
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (file == null) {</span>
<span class="nc" id="L429">            return null;</span>
        } else {
<span class="nc" id="L431">            JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L432" title="All 4 branches missed.">            if (fc.isDirectorySelectionEnabled() &amp;&amp; !fc.isFileSelectionEnabled()) {</span>
<span class="nc" id="L433">                return file.getPath();</span>
            } else {
<span class="nc" id="L435">                return file.getName();</span>
            }
        }
    }

    private String fileNameString(File[] files) {
<span class="nc" id="L441">        StringBuffer buf = new StringBuffer();</span>
<span class="nc bnc" id="L442" title="All 4 branches missed.">        for (int i = 0; files != null &amp;&amp; i &lt; files.length; i++) {</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">            if (i &gt; 0) {</span>
<span class="nc" id="L444">                buf.append(&quot; &quot;);</span>
            }
<span class="nc bnc" id="L446" title="All 2 branches missed.">            if (files.length &gt; 1) {</span>
<span class="nc" id="L447">                buf.append(&quot;\&quot;&quot;);</span>
            }
<span class="nc" id="L449">            buf.append(fileNameString(files[i]));</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">            if (files.length &gt; 1) {</span>
<span class="nc" id="L451">                buf.append(&quot;\&quot;&quot;);</span>
            }
        }
<span class="nc" id="L454">        return buf.toString();</span>
    }

    public void uninstallUI(JComponent c) {
        // Remove listeners
<span class="nc" id="L459">        c.removePropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L460">        c.removePropertyChangeListener(filePane);</span>

<span class="nc bnc" id="L462" title="All 2 branches missed.">        if (filePane != null) {</span>
<span class="nc" id="L463">            filePane.uninstallUI();</span>
<span class="nc" id="L464">            filePane = null;</span>
        }

<span class="nc" id="L467">        super.uninstallUI(c);</span>
<span class="nc" id="L468">    }</span>

    protected void installStrings(JFileChooser fc) {
<span class="nc" id="L471">        super.installStrings(fc);</span>

<span class="nc" id="L473">        Locale l = fc.getLocale();</span>

<span class="nc" id="L475">        lookInLabelMnemonic = getMnemonic(&quot;FileChooser.lookInLabelMnemonic&quot;, l);</span>
<span class="nc" id="L476">        lookInLabelText = UIManager.getString(&quot;FileChooser.lookInLabelText&quot;, l);</span>
<span class="nc" id="L477">        saveInLabelText = UIManager.getString(&quot;FileChooser.saveInLabelText&quot;, l);</span>

<span class="nc" id="L479">        fileNameLabelMnemonic = getMnemonic(&quot;FileChooser.fileNameLabelMnemonic&quot;, l);</span>
<span class="nc" id="L480">        fileNameLabelText = UIManager.getString(&quot;FileChooser.fileNameLabelText&quot;, l);</span>
<span class="nc" id="L481">        folderNameLabelMnemonic = getMnemonic(&quot;FileChooser.folderNameLabelMnemonic&quot;, l);</span>
<span class="nc" id="L482">        folderNameLabelText = UIManager.getString(&quot;FileChooser.folderNameLabelText&quot;, l);</span>

<span class="nc" id="L484">        filesOfTypeLabelMnemonic = getMnemonic(&quot;FileChooser.filesOfTypeLabelMnemonic&quot;, l);</span>
<span class="nc" id="L485">        filesOfTypeLabelText = UIManager.getString(&quot;FileChooser.filesOfTypeLabelText&quot;, l);</span>

<span class="nc" id="L487">    upFolderToolTipText =  UIManager.getString(&quot;FileChooser.upFolderToolTipText&quot;,l);</span>
<span class="nc" id="L488">    upFolderAccessibleName = UIManager.getString(&quot;FileChooser.upFolderAccessibleName&quot;,l);</span>

<span class="nc" id="L490">    homeFolderToolTipText =  UIManager.getString(&quot;FileChooser.homeFolderToolTipText&quot;,l);</span>
<span class="nc" id="L491">    homeFolderAccessibleName = UIManager.getString(&quot;FileChooser.homeFolderAccessibleName&quot;,l);</span>

<span class="nc" id="L493">    newFolderToolTipText = UIManager.getString(&quot;FileChooser.newFolderToolTipText&quot;,l);</span>
<span class="nc" id="L494">    newFolderAccessibleName = UIManager.getString(&quot;FileChooser.newFolderAccessibleName&quot;,l);</span>

<span class="nc" id="L496">    listViewButtonToolTipText = UIManager.getString(&quot;FileChooser.listViewButtonToolTipText&quot;,l);</span>
<span class="nc" id="L497">    listViewButtonAccessibleName = UIManager.getString(&quot;FileChooser.listViewButtonAccessibleName&quot;,l);</span>

<span class="nc" id="L499">    detailsViewButtonToolTipText = UIManager.getString(&quot;FileChooser.detailsViewButtonToolTipText&quot;,l);</span>
<span class="nc" id="L500">    detailsViewButtonAccessibleName = UIManager.getString(&quot;FileChooser.detailsViewButtonAccessibleName&quot;,l);</span>
<span class="nc" id="L501">    }</span>

    private int getMnemonic(String key, Locale l) {
<span class="nc" id="L504">        return SwingUtilities2.getUIDefaultsInt(key, l);</span>
    }


    public String getFileName() {
<span class="nc bnc" id="L509" title="All 2 branches missed.">        if (fileNameTextField != null) {</span>
<span class="nc" id="L510">            return fileNameTextField.getText();</span>
        } else {
<span class="nc" id="L512">            return null;</span>
        }
    }

    public void setFileName(String fileName) {
<span class="nc bnc" id="L517" title="All 2 branches missed.">        if (fileNameTextField != null) {</span>
<span class="nc" id="L518">            fileNameTextField.setText(fileName);</span>
        }
<span class="nc" id="L520">    }</span>

    @Override public void rescanCurrentDirectory(JFileChooser fc) {
<span class="nc" id="L523">        filePane.rescanCurrentDirectory();</span>
<span class="nc" id="L524">    }</span>

    protected void doSelectedFileChanged(PropertyChangeEvent e) {
<span class="nc" id="L527">        super.doSelectedFileChanged(e);</span>

<span class="nc" id="L529">        File f = (File) e.getNewValue();</span>
<span class="nc" id="L530">        JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">        if (f != null</span>
<span class="nc bnc" id="L532" title="All 4 branches missed.">            &amp;&amp; ((fc.isFileSelectionEnabled() &amp;&amp; !f.isDirectory())</span>
<span class="nc bnc" id="L533" title="All 4 branches missed.">                || (f.isDirectory() &amp;&amp; fc.isDirectorySelectionEnabled()))) {</span>

<span class="nc" id="L535">            setFileName(fileNameString(f));</span>
        }
<span class="nc" id="L537">    }</span>

    protected void doSelectedFilesChanged(PropertyChangeEvent e) {
<span class="nc" id="L540">        super.doSelectedFilesChanged(e);</span>

<span class="nc" id="L542">        File[] files = (File[]) e.getNewValue();</span>
<span class="nc" id="L543">        JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L544" title="All 6 branches missed.">        if (files != null</span>
            &amp;&amp; files.length &gt; 0
<span class="nc bnc" id="L546" title="All 4 branches missed.">            &amp;&amp; (files.length &gt; 1 || fc.isDirectorySelectionEnabled() || !files[0].isDirectory())) {</span>
<span class="nc" id="L547">            setFileName(fileNameString(files));</span>
        }
<span class="nc" id="L549">    }</span>

    protected void doDirectoryChanged(PropertyChangeEvent e) {
<span class="nc" id="L552">        super.doDirectoryChanged(e);</span>

<span class="nc" id="L554">        JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L555">        FileSystemView fsv = fc.getFileSystemView();</span>
<span class="nc" id="L556">        File currentDirectory = fc.getCurrentDirectory();</span>

<span class="nc bnc" id="L558" title="All 4 branches missed.">        if (!readOnly &amp;&amp; currentDirectory != null) {</span>
<span class="nc" id="L559">            getNewFolderAction().setEnabled(filePane.canWrite(currentDirectory));</span>
        }

<span class="nc bnc" id="L562" title="All 2 branches missed.">        if (currentDirectory != null) {</span>
<span class="nc" id="L563">            JComponent cb = getDirectoryComboBox();</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">            if (cb instanceof JComboBox) {</span>
<span class="nc" id="L565">                ComboBoxModel model = ((JComboBox)cb).getModel();</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">                if (model instanceof DirectoryComboBoxModel) {</span>
<span class="nc" id="L567">                    ((DirectoryComboBoxModel)model).addItem(currentDirectory);</span>
                }
            }

<span class="nc bnc" id="L571" title="All 4 branches missed.">            if (fc.isDirectorySelectionEnabled() &amp;&amp; !fc.isFileSelectionEnabled()) {</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">                if (fsv.isFileSystem(currentDirectory)) {</span>
<span class="nc" id="L573">                    setFileName(currentDirectory.getPath());</span>
                } else {
<span class="nc" id="L575">                    setFileName(null);</span>
                }
            }
        }
<span class="nc" id="L579">    }</span>


    protected void doFileSelectionModeChanged(PropertyChangeEvent e) {
<span class="nc" id="L583">        super.doFileSelectionModeChanged(e);</span>

<span class="nc" id="L585">        JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L586">        File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">        if (currentDirectory != null</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">            &amp;&amp; fc.isDirectorySelectionEnabled()</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">            &amp;&amp; !fc.isFileSelectionEnabled()</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">            &amp;&amp; fc.getFileSystemView().isFileSystem(currentDirectory)) {</span>

<span class="nc" id="L592">            setFileName(currentDirectory.getPath());</span>
        } else {
<span class="nc" id="L594">            setFileName(null);</span>
        }
<span class="nc" id="L596">    }</span>

    protected void doAccessoryChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L599" title="All 2 branches missed.">        if (getAccessoryPanel() != null) {</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">            if (e.getOldValue() != null) {</span>
<span class="nc" id="L601">                getAccessoryPanel().remove((JComponent)e.getOldValue());</span>
            }
<span class="nc" id="L603">            JComponent accessory = (JComponent)e.getNewValue();</span>
<span class="nc bnc" id="L604" title="All 2 branches missed.">            if (accessory != null) {</span>
<span class="nc" id="L605">                getAccessoryPanel().add(accessory, BorderLayout.CENTER);</span>
            }
        }
<span class="nc" id="L608">    }</span>

    protected void doControlButtonsChanged(PropertyChangeEvent e) {
<span class="nc" id="L611">        super.doControlButtonsChanged(e);</span>

<span class="nc bnc" id="L613" title="All 2 branches missed.">        if (getFileChooser().getControlButtonsAreShown()) {</span>
<span class="nc" id="L614">            addControlButtons();</span>
        } else {
<span class="nc" id="L616">            removeControlButtons();</span>
        }
<span class="nc" id="L618">    }</span>

    protected void addControlButtons() {
<span class="nc bnc" id="L621" title="All 2 branches missed.">        if (bottomPanel != null) {</span>
<span class="nc" id="L622">            bottomPanel.add(buttonPanel);</span>
        }
<span class="nc" id="L624">    }</span>

    protected void removeControlButtons() {
<span class="nc bnc" id="L627" title="All 2 branches missed.">        if (bottomPanel != null) {</span>
<span class="nc" id="L628">            bottomPanel.remove(buttonPanel);</span>
        }
<span class="nc" id="L630">    }</span>




    // *******************************************************
    // ************ FileChooser UI PLAF methods **************
    // *******************************************************

    protected ActionMap createActionMap() {
<span class="nc" id="L640">        ActionMap map = new ActionMapUIResource();</span>
        // add standard actions
<span class="nc" id="L642">        FilePane.addActionsToMap(map, filePane.getActions());</span>
        // add synth only actions
<span class="nc" id="L644">        map.put(&quot;fileNameCompletion&quot;, getFileNameCompletionAction());</span>
<span class="nc" id="L645">        return map;</span>
    }

    // *****************************
    // ***** Directory Actions *****
    // *****************************

    protected JComponent getDirectoryComboBox() {
<span class="nc" id="L653">        return directoryComboBox;</span>
    }

    protected Action getDirectoryComboBoxAction() {
<span class="nc" id="L657">        return directoryComboBoxAction;</span>
    }

    protected DirectoryComboBoxRenderer createDirectoryComboBoxRenderer(JFileChooser fc) {
<span class="nc" id="L661">        return new DirectoryComboBoxRenderer(directoryComboBox.getRenderer());</span>
    }

    //
    // Renderer for DirectoryComboBox
    //
    // Synth has some odd behavior with regards to renderers. Renderers are styled
    // in a specific manner by the SynthComboBoxUI. If we extend DefaultListCellRenderer
    // here, then we get none of those benefits or behaviors, leading to poor
    // looking combo boxes.
    // So what we do here is delegate most jobs to the &quot;real&quot; or original renderer,
    // and simply monkey with the icon and text of the renderer.
<span class="nc bnc" id="L673" title="All 2 branches missed.">    private class DirectoryComboBoxRenderer implements ListCellRenderer&lt;File&gt; {</span>
        private ListCellRenderer&lt;? super File&gt; delegate;
<span class="nc" id="L675">        IndentIcon ii = new IndentIcon();</span>

<span class="nc" id="L677">        private DirectoryComboBoxRenderer(ListCellRenderer&lt;? super File&gt; delegate) {</span>
<span class="nc" id="L678">            this.delegate = delegate;</span>
<span class="nc" id="L679">        }</span>

        @Override
        public Component getListCellRendererComponent(JList&lt;? extends File&gt; list, File value, int index, boolean isSelected, boolean cellHasFocus) {
<span class="nc" id="L683">            Component c = delegate.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc bnc" id="L685" title="All 4 branches missed.">            assert c instanceof JLabel;</span>
<span class="nc" id="L686">            JLabel label = (JLabel)c;</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L688">                label.setText(&quot;&quot;);</span>
<span class="nc" id="L689">                return label;</span>
            }
<span class="nc" id="L691">            label.setText(getFileChooser().getName(value));</span>
<span class="nc" id="L692">            Icon icon = getFileChooser().getIcon(value);</span>
<span class="nc" id="L693">            ii.icon = icon;</span>
<span class="nc" id="L694">            ii.depth = directoryComboBoxModel.getDepth(index);</span>
<span class="nc" id="L695">            label.setIcon(ii);</span>

<span class="nc" id="L697">            return label;</span>
        }
    }

    final static int space = 10;
<span class="nc" id="L702">    class IndentIcon implements Icon {</span>

<span class="nc" id="L704">        Icon icon = null;</span>
<span class="nc" id="L705">        int depth = 0;</span>

        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc bnc" id="L708" title="All 2 branches missed.">            if (icon != null) {</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">                if (c.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L710">                    icon.paintIcon(c, g, x+depth*space, y);</span>
                } else {
<span class="nc" id="L712">                    icon.paintIcon(c, g, x, y);</span>
                }
            }
<span class="nc" id="L715">        }</span>

        public int getIconWidth() {
<span class="nc bnc" id="L718" title="All 2 branches missed.">            return ((icon != null) ? icon.getIconWidth() : 0) + depth*space;</span>
        }

        public int getIconHeight() {
<span class="nc bnc" id="L722" title="All 2 branches missed.">            return (icon != null) ? icon.getIconHeight() : 0;</span>
        }

    }

    //
    // DataModel for DirectoryComboxbox
    //
    protected DirectoryComboBoxModel createDirectoryComboBoxModel(JFileChooser fc) {
<span class="nc" id="L731">        return new DirectoryComboBoxModel();</span>
    }

    /**
     * Data model for a type-face selection combo-box.
     */
    protected class DirectoryComboBoxModel extends AbstractListModel&lt;File&gt; implements ComboBoxModel&lt;File&gt; {
<span class="nc" id="L738">        Vector&lt;File&gt; directories = new Vector&lt;File&gt;();</span>
<span class="nc" id="L739">        int[] depths = null;</span>
<span class="nc" id="L740">        File selectedDirectory = null;</span>
<span class="nc" id="L741">        JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L742">        FileSystemView fsv = chooser.getFileSystemView();</span>

<span class="nc" id="L744">        public DirectoryComboBoxModel() {</span>
            // Add the current directory to the model, and make it the
            // selectedDirectory
<span class="nc" id="L747">            File dir = getFileChooser().getCurrentDirectory();</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">            if (dir != null) {</span>
<span class="nc" id="L749">                addItem(dir);</span>
            }
<span class="nc" id="L751">        }</span>

        /**
         * Adds the directory to the model and sets it to be selected,
         * additionally clears out the previous selected directory and
         * the paths leading up to it, if any.
         */
        public void addItem(File directory) {

<span class="nc bnc" id="L760" title="All 2 branches missed.">            if (directory == null) {</span>
<span class="nc" id="L761">                return;</span>
            }

<span class="nc" id="L764">            boolean useShellFolder = FilePane.usesShellFolder(chooser);</span>

<span class="nc" id="L766">            int oldSize = directories.size();</span>
<span class="nc" id="L767">            directories.clear();</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">            if (oldSize &gt; 0) {</span>
<span class="nc" id="L769">                fireIntervalRemoved(this, 0, oldSize);</span>
            }

            File[] baseFolders;
<span class="nc bnc" id="L773" title="All 2 branches missed.">            if (useShellFolder) {</span>
<span class="nc" id="L774">                baseFolders = AccessController.doPrivileged(new PrivilegedAction&lt;File[]&gt;() {</span>
                    public File[] run() {
<span class="nc" id="L776">                        return (File[]) ShellFolder.get(&quot;fileChooserComboBoxFolders&quot;);</span>
                    }
                });
            } else {
<span class="nc" id="L780">                baseFolders = fsv.getRoots();</span>
            }
<span class="nc" id="L782">            directories.addAll(Arrays.asList(baseFolders));</span>

            // Get the canonical (full) path. This has the side
            // benefit of removing extraneous chars from the path,
            // for example /foo/bar/ becomes /foo/bar
            File canonical;
            try {
<span class="nc" id="L789">                canonical = ShellFolder.getNormalizedFile(directory);</span>
<span class="nc" id="L790">            } catch (IOException e) {</span>
                // Maybe drive is not ready. Can't abort here.
<span class="nc" id="L792">                canonical = directory;</span>
<span class="nc" id="L793">            }</span>

            // create File instances of each directory leading up to the top
            try {
<span class="nc bnc" id="L797" title="All 2 branches missed.">                File sf = useShellFolder ? ShellFolder.getShellFolder(canonical)</span>
                                         : canonical;
<span class="nc" id="L799">                File f = sf;</span>
<span class="nc" id="L800">                Vector&lt;File&gt; path = new Vector&lt;File&gt;(10);</span>
                do {
<span class="nc" id="L802">                    path.addElement(f);</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">                } while ((f = f.getParentFile()) != null);</span>

<span class="nc" id="L805">                int pathCount = path.size();</span>
                // Insert chain at appropriate place in vector
<span class="nc bnc" id="L807" title="All 2 branches missed.">                for (int i = 0; i &lt; pathCount; i++) {</span>
<span class="nc" id="L808">                    f = path.get(i);</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">                    if (directories.contains(f)) {</span>
<span class="nc" id="L810">                        int topIndex = directories.indexOf(f);</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">                        for (int j = i-1; j &gt;= 0; j--) {</span>
<span class="nc" id="L812">                            directories.insertElementAt(path.get(j), topIndex+i-j);</span>
                        }
<span class="nc" id="L814">                        break;</span>
                    }
                }
<span class="nc" id="L817">                calculateDepths();</span>
<span class="nc" id="L818">                setSelectedItem(sf);</span>
<span class="nc" id="L819">            } catch (FileNotFoundException ex) {</span>
<span class="nc" id="L820">                calculateDepths();</span>
<span class="nc" id="L821">            }</span>
<span class="nc" id="L822">        }</span>

        private void calculateDepths() {
<span class="nc" id="L825">            depths = new int[directories.size()];</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">            for (int i = 0; i &lt; depths.length; i++) {</span>
<span class="nc" id="L827">                File dir = directories.get(i);</span>
<span class="nc" id="L828">                File parent = dir.getParentFile();</span>
<span class="nc" id="L829">                depths[i] = 0;</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">                if (parent != null) {</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">                    for (int j = i-1; j &gt;= 0; j--) {</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">                        if (parent.equals(directories.get(j))) {</span>
<span class="nc" id="L833">                            depths[i] = depths[j] + 1;</span>
<span class="nc" id="L834">                            break;</span>
                        }
                    }
                }
            }
<span class="nc" id="L839">        }</span>

        public int getDepth(int i) {
<span class="nc bnc" id="L842" title="All 6 branches missed.">            return (depths != null &amp;&amp; i &gt;= 0 &amp;&amp; i &lt; depths.length) ? depths[i] : 0;</span>
        }

        public void setSelectedItem(Object selectedDirectory) {
<span class="nc" id="L846">            this.selectedDirectory = (File)selectedDirectory;</span>
<span class="nc" id="L847">            fireContentsChanged(this, -1, -1);</span>
<span class="nc" id="L848">        }</span>

        public Object getSelectedItem() {
<span class="nc" id="L851">            return selectedDirectory;</span>
        }

        public int getSize() {
<span class="nc" id="L855">            return directories.size();</span>
        }

        public File getElementAt(int index) {
<span class="nc" id="L859">            return directories.elementAt(index);</span>
        }
    }

    /**
     * Acts when DirectoryComboBox has changed the selected item.
     */
    protected class DirectoryComboBoxAction extends AbstractAction {
<span class="nc" id="L867">        protected DirectoryComboBoxAction() {</span>
<span class="nc" id="L868">            super(&quot;DirectoryComboBoxAction&quot;);</span>
<span class="nc" id="L869">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L872">            directoryComboBox.hidePopup();</span>
<span class="nc" id="L873">            JComponent cb = getDirectoryComboBox();</span>
<span class="nc bnc" id="L874" title="All 2 branches missed.">            if (cb instanceof JComboBox) {</span>
<span class="nc" id="L875">                File f = (File)((JComboBox)cb).getSelectedItem();</span>
<span class="nc" id="L876">                getFileChooser().setCurrentDirectory(f);</span>
            }
<span class="nc" id="L878">        }</span>
    }

    //
    // Renderer for Types ComboBox
    //
    protected FilterComboBoxRenderer createFilterComboBoxRenderer() {
<span class="nc" id="L885">        return new FilterComboBoxRenderer(filterComboBox.getRenderer());</span>
    }

    /**
     * Render different type sizes and styles.
     */
<span class="nc bnc" id="L891" title="All 2 branches missed.">    public class FilterComboBoxRenderer implements ListCellRenderer&lt;FileFilter&gt; {</span>
        private ListCellRenderer&lt;? super FileFilter&gt; delegate;
<span class="nc" id="L893">        private FilterComboBoxRenderer(ListCellRenderer&lt;? super FileFilter&gt; delegate) {</span>
<span class="nc" id="L894">            this.delegate = delegate;</span>
<span class="nc" id="L895">        }</span>

        public Component getListCellRendererComponent(JList&lt;? extends FileFilter&gt; list, FileFilter value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {
<span class="nc" id="L899">            Component c = delegate.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc" id="L901">            String text = null;</span>
<span class="nc bnc" id="L902" title="All 2 branches missed.">            if (value != null) {</span>
<span class="nc" id="L903">                text = value.getDescription();</span>
            }

            //this should always be true, since SynthComboBoxUI's SynthComboBoxRenderer
            //extends JLabel
<span class="nc bnc" id="L908" title="All 4 branches missed.">            assert c instanceof JLabel;</span>
<span class="nc bnc" id="L909" title="All 2 branches missed.">            if (text != null) {</span>
<span class="nc" id="L910">                ((JLabel)c).setText(text);</span>
            }
<span class="nc" id="L912">            return c;</span>
        }
    }

    //
    // DataModel for Types Comboxbox
    //
    protected FilterComboBoxModel createFilterComboBoxModel() {
<span class="nc" id="L920">        return new FilterComboBoxModel();</span>
    }

    /**
     * Data model for a type-face selection combo-box.
     */
<span class="nc" id="L926">    protected class FilterComboBoxModel extends AbstractFilterComboBoxModel {</span>
        protected JFileChooser getFileChooser() {
<span class="nc" id="L928">            return SynthFileChooserUIImpl.this.getFileChooser();</span>
        }
    }



    /**
     * &lt;code&gt;ButtonAreaLayout&lt;/code&gt; behaves in a similar manner to
     * &lt;code&gt;FlowLayout&lt;/code&gt;. It lays out all components from left to
     * right, flushed right. The widths of all components will be set
     * to the largest preferred size width.
     */
<span class="nc" id="L940">    private static class ButtonAreaLayout implements LayoutManager {</span>
<span class="nc" id="L941">        private int hGap = 5;</span>
<span class="nc" id="L942">        private int topMargin = 17;</span>

        public void addLayoutComponent(String string, Component comp) {
<span class="nc" id="L945">        }</span>

        public void layoutContainer(Container container) {
<span class="nc" id="L948">            Component[] children = container.getComponents();</span>

<span class="nc bnc" id="L950" title="All 4 branches missed.">            if (children != null &amp;&amp; children.length &gt; 0) {</span>
<span class="nc" id="L951">                int         numChildren = children.length;</span>
<span class="nc" id="L952">                Dimension[] sizes = new Dimension[numChildren];</span>
<span class="nc" id="L953">                Insets      insets = container.getInsets();</span>
<span class="nc" id="L954">                int         yLocation = insets.top + topMargin;</span>
<span class="nc" id="L955">                int         maxWidth = 0;</span>

<span class="nc bnc" id="L957" title="All 2 branches missed.">                for (int counter = 0; counter &lt; numChildren; counter++) {</span>
<span class="nc" id="L958">                    sizes[counter] = children[counter].getPreferredSize();</span>
<span class="nc" id="L959">                    maxWidth = Math.max(maxWidth, sizes[counter].width);</span>
                }
                int xLocation, xOffset;
<span class="nc bnc" id="L962" title="All 2 branches missed.">                if (container.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L963">                    xLocation = container.getSize().width - insets.left - maxWidth;</span>
<span class="nc" id="L964">                    xOffset = hGap + maxWidth;</span>
                } else {
<span class="nc" id="L966">                    xLocation = insets.left;</span>
<span class="nc" id="L967">                    xOffset = -(hGap + maxWidth);</span>
                }
<span class="nc bnc" id="L969" title="All 2 branches missed.">                for (int counter = numChildren - 1; counter &gt;= 0; counter--) {</span>
<span class="nc" id="L970">                    children[counter].setBounds(xLocation, yLocation,</span>
                                                maxWidth, sizes[counter].height);
<span class="nc" id="L972">                    xLocation -= xOffset;</span>
                }
            }
<span class="nc" id="L975">        }</span>

        public Dimension minimumLayoutSize(Container c) {
<span class="nc bnc" id="L978" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L979">                Component[] children = c.getComponents();</span>

<span class="nc bnc" id="L981" title="All 4 branches missed.">                if (children != null &amp;&amp; children.length &gt; 0) {</span>
<span class="nc" id="L982">                    int       numChildren = children.length;</span>
<span class="nc" id="L983">                    int       height = 0;</span>
<span class="nc" id="L984">                    Insets    cInsets = c.getInsets();</span>
<span class="nc" id="L985">                    int       extraHeight = topMargin + cInsets.top + cInsets.bottom;</span>
<span class="nc" id="L986">                    int       extraWidth = cInsets.left + cInsets.right;</span>
<span class="nc" id="L987">                    int       maxWidth = 0;</span>

<span class="nc bnc" id="L989" title="All 2 branches missed.">                    for (int counter = 0; counter &lt; numChildren; counter++) {</span>
<span class="nc" id="L990">                        Dimension aSize = children[counter].getPreferredSize();</span>
<span class="nc" id="L991">                        height = Math.max(height, aSize.height);</span>
<span class="nc" id="L992">                        maxWidth = Math.max(maxWidth, aSize.width);</span>
                    }
<span class="nc" id="L994">                    return new Dimension(extraWidth + numChildren * maxWidth +</span>
                                         (numChildren - 1) * hGap,
                                         extraHeight + height);
                }
            }
<span class="nc" id="L999">            return new Dimension(0, 0);</span>
        }

        public Dimension preferredLayoutSize(Container c) {
<span class="nc" id="L1003">            return minimumLayoutSize(c);</span>
        }

<span class="nc" id="L1006">        public void removeLayoutComponent(Component c) { }</span>
    }

    private static void groupLabels(AlignedLabel[] group) {
<span class="nc bnc" id="L1010" title="All 2 branches missed.">        for (int i = 0; i &lt; group.length; i++) {</span>
<span class="nc" id="L1011">            group[i].group = group;</span>
        }
<span class="nc" id="L1013">    }</span>

    private class AlignedLabel extends JLabel {
        private AlignedLabel[] group;
<span class="nc" id="L1017">        private int maxWidth = 0;</span>

<span class="nc" id="L1019">        AlignedLabel() {</span>
<span class="nc" id="L1020">            super();</span>
<span class="nc" id="L1021">            setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L1022">        }</span>

<span class="nc" id="L1024">        AlignedLabel(String text) {</span>
<span class="nc" id="L1025">            super(text);</span>
<span class="nc" id="L1026">            setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L1027">        }</span>

        public Dimension getPreferredSize() {
<span class="nc" id="L1030">            Dimension d = super.getPreferredSize();</span>
            // Align the width with all other labels in group.
<span class="nc" id="L1032">            return new Dimension(getMaxWidth() + 11, d.height);</span>
        }

        private int getMaxWidth() {
<span class="nc bnc" id="L1036" title="All 4 branches missed.">            if (maxWidth == 0 &amp;&amp; group != null) {</span>
<span class="nc" id="L1037">                int max = 0;</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">                for (int i = 0; i &lt; group.length; i++) {</span>
<span class="nc" id="L1039">                    max = Math.max(group[i].getSuperPreferredWidth(), max);</span>
                }
<span class="nc bnc" id="L1041" title="All 2 branches missed.">                for (int i = 0; i &lt; group.length; i++) {</span>
<span class="nc" id="L1042">                    group[i].maxWidth = max;</span>
                }
            }
<span class="nc" id="L1045">            return maxWidth;</span>
        }

        private int getSuperPreferredWidth() {
<span class="nc" id="L1049">            return super.getPreferredSize().width;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>