<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SF2Instrument.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.media.sound</a> &gt; <span class="el_source">SF2Instrument.java</span></div><h1>SF2Instrument.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2007, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.media.sound;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.sound.midi.Patch;

/**
 * Soundfont instrument.
 *
 * @author Karl Helgason
 */
public final class SF2Instrument extends ModelInstrument {

<span class="nc" id="L41">    String name = &quot;&quot;;</span>
<span class="nc" id="L42">    int preset = 0;</span>
<span class="nc" id="L43">    int bank = 0;</span>
<span class="nc" id="L44">    long library = 0;</span>
<span class="nc" id="L45">    long genre = 0;</span>
<span class="nc" id="L46">    long morphology = 0;</span>
<span class="nc" id="L47">    SF2GlobalRegion globalregion = null;</span>
<span class="nc" id="L48">    List&lt;SF2InstrumentRegion&gt; regions</span>
            = new ArrayList&lt;SF2InstrumentRegion&gt;();

    public SF2Instrument() {
<span class="nc" id="L52">        super(null, null, null, null);</span>
<span class="nc" id="L53">    }</span>

    public SF2Instrument(SF2Soundbank soundbank) {
<span class="nc" id="L56">        super(soundbank, null, null, null);</span>
<span class="nc" id="L57">    }</span>

    public String getName() {
<span class="nc" id="L60">        return name;</span>
    }

    public void setName(String name) {
<span class="nc" id="L64">        this.name = name;</span>
<span class="nc" id="L65">    }</span>

    public Patch getPatch() {
<span class="nc bnc" id="L68" title="All 2 branches missed.">        if (bank == 128)</span>
<span class="nc" id="L69">            return new ModelPatch(0, preset, true);</span>
        else
<span class="nc" id="L71">            return new ModelPatch(bank &lt;&lt; 7, preset, false);</span>
    }

    public void setPatch(Patch patch) {
<span class="nc bnc" id="L75" title="All 4 branches missed.">        if (patch instanceof ModelPatch &amp;&amp; ((ModelPatch) patch).isPercussion()) {</span>
<span class="nc" id="L76">            bank = 128;</span>
<span class="nc" id="L77">            preset = patch.getProgram();</span>
        } else {
<span class="nc" id="L79">            bank = patch.getBank() &gt;&gt; 7;</span>
<span class="nc" id="L80">            preset = patch.getProgram();</span>
        }
<span class="nc" id="L82">    }</span>

    public Object getData() {
<span class="nc" id="L85">        return null;</span>
    }

    public long getGenre() {
<span class="nc" id="L89">        return genre;</span>
    }

    public void setGenre(long genre) {
<span class="nc" id="L93">        this.genre = genre;</span>
<span class="nc" id="L94">    }</span>

    public long getLibrary() {
<span class="nc" id="L97">        return library;</span>
    }

    public void setLibrary(long library) {
<span class="nc" id="L101">        this.library = library;</span>
<span class="nc" id="L102">    }</span>

    public long getMorphology() {
<span class="nc" id="L105">        return morphology;</span>
    }

    public void setMorphology(long morphology) {
<span class="nc" id="L109">        this.morphology = morphology;</span>
<span class="nc" id="L110">    }</span>

    public List&lt;SF2InstrumentRegion&gt; getRegions() {
<span class="nc" id="L113">        return regions;</span>
    }

    public SF2GlobalRegion getGlobalRegion() {
<span class="nc" id="L117">        return globalregion;</span>
    }

    public void setGlobalZone(SF2GlobalRegion zone) {
<span class="nc" id="L121">        globalregion = zone;</span>
<span class="nc" id="L122">    }</span>

    public String toString() {
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (bank == 128)</span>
<span class="nc" id="L126">            return &quot;Drumkit: &quot; + name + &quot; preset #&quot; + preset;</span>
        else
<span class="nc" id="L128">            return &quot;Instrument: &quot; + name + &quot; bank #&quot; + bank</span>
                    + &quot; preset #&quot; + preset;
    }

    public ModelPerformer[] getPerformers() {
<span class="nc" id="L133">        int performercount = 0;</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        for (SF2InstrumentRegion presetzone : regions)</span>
<span class="nc" id="L135">            performercount += presetzone.getLayer().getRegions().size();</span>
<span class="nc" id="L136">        ModelPerformer[] performers = new ModelPerformer[performercount];</span>
<span class="nc" id="L137">        int pi = 0;</span>

<span class="nc" id="L139">        SF2GlobalRegion presetglobal = globalregion;</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        for (SF2InstrumentRegion presetzone : regions) {</span>
<span class="nc" id="L141">            Map&lt;Integer, Short&gt; pgenerators = new HashMap&lt;Integer, Short&gt;();</span>
<span class="nc" id="L142">            pgenerators.putAll(presetzone.getGenerators());</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">            if (presetglobal != null)</span>
<span class="nc" id="L144">                pgenerators.putAll(presetglobal.getGenerators());</span>

<span class="nc" id="L146">            SF2Layer layer = presetzone.getLayer();</span>
<span class="nc" id="L147">            SF2GlobalRegion layerglobal = layer.getGlobalRegion();</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">            for (SF2LayerRegion layerzone : layer.getRegions()) {</span>
<span class="nc" id="L149">                ModelPerformer performer = new ModelPerformer();</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">                if (layerzone.getSample() != null)</span>
<span class="nc" id="L151">                    performer.setName(layerzone.getSample().getName());</span>
                else
<span class="nc" id="L153">                    performer.setName(layer.getName());</span>

<span class="nc" id="L155">                performers[pi++] = performer;</span>

<span class="nc" id="L157">                int keyfrom = 0;</span>
<span class="nc" id="L158">                int keyto = 127;</span>
<span class="nc" id="L159">                int velfrom = 0;</span>
<span class="nc" id="L160">                int velto = 127;</span>

<span class="nc bnc" id="L162" title="All 2 branches missed.">                if (layerzone.contains(SF2Region.GENERATOR_EXCLUSIVECLASS)) {</span>
<span class="nc" id="L163">                    performer.setExclusiveClass(layerzone.getInteger(</span>
                            SF2Region.GENERATOR_EXCLUSIVECLASS));
                }
<span class="nc bnc" id="L166" title="All 2 branches missed.">                if (layerzone.contains(SF2Region.GENERATOR_KEYRANGE)) {</span>
<span class="nc" id="L167">                    byte[] bytes = layerzone.getBytes(</span>
                            SF2Region.GENERATOR_KEYRANGE);
<span class="nc bnc" id="L169" title="All 2 branches missed.">                    if (bytes[0] &gt;= 0)</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">                        if (bytes[0] &gt; keyfrom)</span>
<span class="nc" id="L171">                            keyfrom = bytes[0];</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">                    if (bytes[1] &gt;= 0)</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">                        if (bytes[1] &lt; keyto)</span>
<span class="nc" id="L174">                            keyto = bytes[1];</span>
                }
<span class="nc bnc" id="L176" title="All 2 branches missed.">                if (layerzone.contains(SF2Region.GENERATOR_VELRANGE)) {</span>
<span class="nc" id="L177">                    byte[] bytes = layerzone.getBytes(</span>
                            SF2Region.GENERATOR_VELRANGE);
<span class="nc bnc" id="L179" title="All 2 branches missed.">                    if (bytes[0] &gt;= 0)</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">                        if (bytes[0] &gt; velfrom)</span>
<span class="nc" id="L181">                            velfrom = bytes[0];</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">                    if (bytes[1] &gt;= 0)</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">                        if (bytes[1] &lt; velto)</span>
<span class="nc" id="L184">                            velto = bytes[1];</span>
                }
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if (presetzone.contains(SF2Region.GENERATOR_KEYRANGE)) {</span>
<span class="nc" id="L187">                    byte[] bytes = presetzone.getBytes(</span>
                            SF2Region.GENERATOR_KEYRANGE);
<span class="nc bnc" id="L189" title="All 2 branches missed.">                    if (bytes[0] &gt; keyfrom)</span>
<span class="nc" id="L190">                        keyfrom = bytes[0];</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                    if (bytes[1] &lt; keyto)</span>
<span class="nc" id="L192">                        keyto = bytes[1];</span>
                }
<span class="nc bnc" id="L194" title="All 2 branches missed.">                if (presetzone.contains(SF2Region.GENERATOR_VELRANGE)) {</span>
<span class="nc" id="L195">                    byte[] bytes = presetzone.getBytes(</span>
                            SF2Region.GENERATOR_VELRANGE);
<span class="nc bnc" id="L197" title="All 2 branches missed.">                    if (bytes[0] &gt; velfrom)</span>
<span class="nc" id="L198">                        velfrom = bytes[0];</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">                    if (bytes[1] &lt; velto)</span>
<span class="nc" id="L200">                        velto = bytes[1];</span>
                }
<span class="nc" id="L202">                performer.setKeyFrom(keyfrom);</span>
<span class="nc" id="L203">                performer.setKeyTo(keyto);</span>
<span class="nc" id="L204">                performer.setVelFrom(velfrom);</span>
<span class="nc" id="L205">                performer.setVelTo(velto);</span>

<span class="nc" id="L207">                int startAddrsOffset = layerzone.getShort(</span>
                        SF2Region.GENERATOR_STARTADDRSOFFSET);
<span class="nc" id="L209">                int endAddrsOffset = layerzone.getShort(</span>
                        SF2Region.GENERATOR_ENDADDRSOFFSET);
<span class="nc" id="L211">                int startloopAddrsOffset = layerzone.getShort(</span>
                        SF2Region.GENERATOR_STARTLOOPADDRSOFFSET);
<span class="nc" id="L213">                int endloopAddrsOffset = layerzone.getShort(</span>
                        SF2Region.GENERATOR_ENDLOOPADDRSOFFSET);

<span class="nc" id="L216">                startAddrsOffset += layerzone.getShort(</span>
                        SF2Region.GENERATOR_STARTADDRSCOARSEOFFSET) * 32768;
<span class="nc" id="L218">                endAddrsOffset += layerzone.getShort(</span>
                        SF2Region.GENERATOR_ENDADDRSCOARSEOFFSET) * 32768;
<span class="nc" id="L220">                startloopAddrsOffset += layerzone.getShort(</span>
                        SF2Region.GENERATOR_STARTLOOPADDRSCOARSEOFFSET) * 32768;
<span class="nc" id="L222">                endloopAddrsOffset += layerzone.getShort(</span>
                        SF2Region.GENERATOR_ENDLOOPADDRSCOARSEOFFSET) * 32768;
<span class="nc" id="L224">                startloopAddrsOffset -= startAddrsOffset;</span>
<span class="nc" id="L225">                endloopAddrsOffset -= startAddrsOffset;</span>

<span class="nc" id="L227">                SF2Sample sample = layerzone.getSample();</span>
<span class="nc" id="L228">                int rootkey = sample.originalPitch;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                if (layerzone.getShort(SF2Region.GENERATOR_OVERRIDINGROOTKEY) != -1) {</span>
<span class="nc" id="L230">                    rootkey = layerzone.getShort(</span>
                            SF2Region.GENERATOR_OVERRIDINGROOTKEY);
                }
<span class="nc" id="L233">                float pitchcorrection = (-rootkey * 100) + sample.pitchCorrection;</span>
<span class="nc" id="L234">                ModelByteBuffer buff = sample.getDataBuffer();</span>
<span class="nc" id="L235">                ModelByteBuffer buff24 = sample.getData24Buffer();</span>

<span class="nc bnc" id="L237" title="All 4 branches missed.">                if (startAddrsOffset != 0 || endAddrsOffset != 0) {</span>
<span class="nc" id="L238">                    buff = buff.subbuffer(startAddrsOffset * 2,</span>
<span class="nc" id="L239">                            buff.capacity() + endAddrsOffset * 2);</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">                    if (buff24 != null) {</span>
<span class="nc" id="L241">                        buff24 = buff24.subbuffer(startAddrsOffset,</span>
<span class="nc" id="L242">                                buff24.capacity() + endAddrsOffset);</span>
                    }

                    /*
                    if (startAddrsOffset &lt; 0)
                        startAddrsOffset = 0;
                    if (endAddrsOffset &gt; (buff.capacity()/2-startAddrsOffset))
                        startAddrsOffset = (int)buff.capacity()/2-startAddrsOffset;
                    byte[] data = buff.array();
                    int off = (int)buff.arrayOffset() + startAddrsOffset*2;
                    int len = (int)buff.capacity() + endAddrsOffset*2;
                    if (off+len &gt; data.length)
                        len = data.length - off;
                    buff = new ModelByteBuffer(data, off, len);
                    if(buff24 != null) {
                        data = buff.array();
                        off = (int)buff.arrayOffset() + startAddrsOffset;
                        len = (int)buff.capacity() + endAddrsOffset;
                        buff24 = new ModelByteBuffer(data, off, len);
                    }
                    */
                }

<span class="nc" id="L265">                ModelByteBufferWavetable osc = new ModelByteBufferWavetable(</span>
<span class="nc" id="L266">                        buff, sample.getFormat(), pitchcorrection);</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                if (buff24 != null)</span>
<span class="nc" id="L268">                    osc.set8BitExtensionBuffer(buff24);</span>

<span class="nc" id="L270">                Map&lt;Integer, Short&gt; generators = new HashMap&lt;Integer, Short&gt;();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">                if (layerglobal != null)</span>
<span class="nc" id="L272">                    generators.putAll(layerglobal.getGenerators());</span>
<span class="nc" id="L273">                generators.putAll(layerzone.getGenerators());</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">                for (Map.Entry&lt;Integer, Short&gt; gen : pgenerators.entrySet()) {</span>
                    short val;
<span class="nc bnc" id="L276" title="All 2 branches missed.">                    if (!generators.containsKey(gen.getKey()))</span>
<span class="nc" id="L277">                        val = layerzone.getShort(gen.getKey());</span>
                    else
<span class="nc" id="L279">                        val = generators.get(gen.getKey());</span>
<span class="nc" id="L280">                    val += gen.getValue();</span>
<span class="nc" id="L281">                    generators.put(gen.getKey(), val);</span>
<span class="nc" id="L282">                }</span>

                // SampleMode:
                // 0 indicates a sound reproduced with no loop
                // 1 indicates a sound which loops continuously
                // 2 is unused but should be interpreted as indicating no loop
                // 3 indicates a sound which loops for the duration of key
                //   depression then proceeds to play the remainder of the sample.
<span class="nc" id="L290">                int sampleMode = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_SAMPLEMODES);
<span class="nc bnc" id="L292" title="All 4 branches missed.">                if ((sampleMode == 1) || (sampleMode == 3)) {</span>
<span class="nc bnc" id="L293" title="All 4 branches missed.">                    if (sample.startLoop &gt;= 0 &amp;&amp; sample.endLoop &gt; 0) {</span>
<span class="nc" id="L294">                        osc.setLoopStart((int)(sample.startLoop</span>
                                + startloopAddrsOffset));
<span class="nc" id="L296">                        osc.setLoopLength((int)(sample.endLoop - sample.startLoop</span>
                                + endloopAddrsOffset - startloopAddrsOffset));
<span class="nc bnc" id="L298" title="All 2 branches missed.">                        if (sampleMode == 1)</span>
<span class="nc" id="L299">                            osc.setLoopType(ModelWavetable.LOOP_TYPE_FORWARD);</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                        if (sampleMode == 3)</span>
<span class="nc" id="L301">                            osc.setLoopType(ModelWavetable.LOOP_TYPE_RELEASE);</span>
                    }
                }
<span class="nc" id="L304">                performer.getOscillators().add(osc);</span>


<span class="nc" id="L307">                short volDelay = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_DELAYVOLENV);
<span class="nc" id="L309">                short volAttack = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_ATTACKVOLENV);
<span class="nc" id="L311">                short volHold = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_HOLDVOLENV);
<span class="nc" id="L313">                short volDecay = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_DECAYVOLENV);
<span class="nc" id="L315">                short volSustain = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_SUSTAINVOLENV);
<span class="nc" id="L317">                short volRelease = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_RELEASEVOLENV);

<span class="nc bnc" id="L320" title="All 2 branches missed.">                if (volHold != -12000) {</span>
<span class="nc" id="L321">                    short volKeyNumToHold = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_KEYNUMTOVOLENVHOLD);
<span class="nc" id="L323">                    volHold += 60 * volKeyNumToHold;</span>
<span class="nc" id="L324">                    float fvalue = -volKeyNumToHold * 128;</span>
<span class="nc" id="L325">                    ModelIdentifier src = ModelSource.SOURCE_NOTEON_KEYNUMBER;</span>
<span class="nc" id="L326">                    ModelIdentifier dest = ModelDestination.DESTINATION_EG1_HOLD;</span>
<span class="nc" id="L327">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(new ModelSource(src), fvalue,
                            new ModelDestination(dest)));
                }
<span class="nc bnc" id="L331" title="All 2 branches missed.">                if (volDecay != -12000) {</span>
<span class="nc" id="L332">                    short volKeyNumToDecay = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_KEYNUMTOVOLENVDECAY);
<span class="nc" id="L334">                    volDecay += 60 * volKeyNumToDecay;</span>
<span class="nc" id="L335">                    float fvalue = -volKeyNumToDecay * 128;</span>
<span class="nc" id="L336">                    ModelIdentifier src = ModelSource.SOURCE_NOTEON_KEYNUMBER;</span>
<span class="nc" id="L337">                    ModelIdentifier dest = ModelDestination.DESTINATION_EG1_DECAY;</span>
<span class="nc" id="L338">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(new ModelSource(src), fvalue,
                            new ModelDestination(dest)));
                }

<span class="nc" id="L343">                addTimecentValue(performer,</span>
                        ModelDestination.DESTINATION_EG1_DELAY, volDelay);
<span class="nc" id="L345">                addTimecentValue(performer,</span>
                        ModelDestination.DESTINATION_EG1_ATTACK, volAttack);
<span class="nc" id="L347">                addTimecentValue(performer,</span>
                        ModelDestination.DESTINATION_EG1_HOLD, volHold);
<span class="nc" id="L349">                addTimecentValue(performer,</span>
                        ModelDestination.DESTINATION_EG1_DECAY, volDecay);
                //float fvolsustain = (960-volSustain)*(1000.0f/960.0f);

<span class="nc" id="L353">                volSustain = (short)(1000 - volSustain);</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                if (volSustain &lt; 0)</span>
<span class="nc" id="L355">                    volSustain = 0;</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">                if (volSustain &gt; 1000)</span>
<span class="nc" id="L357">                    volSustain = 1000;</span>

<span class="nc" id="L359">                addValue(performer,</span>
                        ModelDestination.DESTINATION_EG1_SUSTAIN, volSustain);
<span class="nc" id="L361">                addTimecentValue(performer,</span>
                        ModelDestination.DESTINATION_EG1_RELEASE, volRelease);

<span class="nc bnc" id="L364" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODENVTOFILTERFC) != 0
<span class="nc bnc" id="L366" title="All 2 branches missed.">                        || getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODENVTOPITCH) != 0) {
<span class="nc" id="L368">                    short modDelay = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_DELAYMODENV);
<span class="nc" id="L370">                    short modAttack = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_ATTACKMODENV);
<span class="nc" id="L372">                    short modHold = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_HOLDMODENV);
<span class="nc" id="L374">                    short modDecay = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_DECAYMODENV);
<span class="nc" id="L376">                    short modSustain = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_SUSTAINMODENV);
<span class="nc" id="L378">                    short modRelease = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_RELEASEMODENV);


<span class="nc bnc" id="L382" title="All 2 branches missed.">                    if (modHold != -12000) {</span>
<span class="nc" id="L383">                        short modKeyNumToHold = getGeneratorValue(generators,</span>
                                SF2Region.GENERATOR_KEYNUMTOMODENVHOLD);
<span class="nc" id="L385">                        modHold += 60 * modKeyNumToHold;</span>
<span class="nc" id="L386">                        float fvalue = -modKeyNumToHold * 128;</span>
<span class="nc" id="L387">                        ModelIdentifier src = ModelSource.SOURCE_NOTEON_KEYNUMBER;</span>
<span class="nc" id="L388">                        ModelIdentifier dest = ModelDestination.DESTINATION_EG2_HOLD;</span>
<span class="nc" id="L389">                        performer.getConnectionBlocks().add(</span>
                            new ModelConnectionBlock(new ModelSource(src),
                                fvalue, new ModelDestination(dest)));
                    }
<span class="nc bnc" id="L393" title="All 2 branches missed.">                    if (modDecay != -12000) {</span>
<span class="nc" id="L394">                        short modKeyNumToDecay = getGeneratorValue(generators,</span>
                                SF2Region.GENERATOR_KEYNUMTOMODENVDECAY);
<span class="nc" id="L396">                        modDecay += 60 * modKeyNumToDecay;</span>
<span class="nc" id="L397">                        float fvalue = -modKeyNumToDecay * 128;</span>
<span class="nc" id="L398">                        ModelIdentifier src = ModelSource.SOURCE_NOTEON_KEYNUMBER;</span>
<span class="nc" id="L399">                        ModelIdentifier dest = ModelDestination.DESTINATION_EG2_DECAY;</span>
<span class="nc" id="L400">                        performer.getConnectionBlocks().add(</span>
                            new ModelConnectionBlock(new ModelSource(src),
                                fvalue, new ModelDestination(dest)));
                    }

<span class="nc" id="L405">                    addTimecentValue(performer,</span>
                            ModelDestination.DESTINATION_EG2_DELAY, modDelay);
<span class="nc" id="L407">                    addTimecentValue(performer,</span>
                            ModelDestination.DESTINATION_EG2_ATTACK, modAttack);
<span class="nc" id="L409">                    addTimecentValue(performer,</span>
                            ModelDestination.DESTINATION_EG2_HOLD, modHold);
<span class="nc" id="L411">                    addTimecentValue(performer,</span>
                            ModelDestination.DESTINATION_EG2_DECAY, modDecay);
<span class="nc bnc" id="L413" title="All 2 branches missed.">                    if (modSustain &lt; 0)</span>
<span class="nc" id="L414">                        modSustain = 0;</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">                    if (modSustain &gt; 1000)</span>
<span class="nc" id="L416">                        modSustain = 1000;</span>
<span class="nc" id="L417">                    addValue(performer, ModelDestination.DESTINATION_EG2_SUSTAIN,</span>
                            1000 - modSustain);
<span class="nc" id="L419">                    addTimecentValue(performer,</span>
                            ModelDestination.DESTINATION_EG2_RELEASE, modRelease);

<span class="nc bnc" id="L422" title="All 2 branches missed.">                    if (getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODENVTOFILTERFC) != 0) {
<span class="nc" id="L424">                        double fvalue = getGeneratorValue(generators,</span>
                                SF2Region.GENERATOR_MODENVTOFILTERFC);
<span class="nc" id="L426">                        ModelIdentifier src = ModelSource.SOURCE_EG2;</span>
<span class="nc" id="L427">                        ModelIdentifier dest</span>
                                = ModelDestination.DESTINATION_FILTER_FREQ;
<span class="nc" id="L429">                        performer.getConnectionBlocks().add(</span>
                            new ModelConnectionBlock(new ModelSource(src),
                                fvalue, new ModelDestination(dest)));
                    }

<span class="nc bnc" id="L434" title="All 2 branches missed.">                    if (getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODENVTOPITCH) != 0) {
<span class="nc" id="L436">                        double fvalue = getGeneratorValue(generators,</span>
                                SF2Region.GENERATOR_MODENVTOPITCH);
<span class="nc" id="L438">                        ModelIdentifier src = ModelSource.SOURCE_EG2;</span>
<span class="nc" id="L439">                        ModelIdentifier dest = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L440">                        performer.getConnectionBlocks().add(</span>
                            new ModelConnectionBlock(new ModelSource(src),
                                fvalue, new ModelDestination(dest)));
                    }

                }

<span class="nc bnc" id="L447" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODLFOTOFILTERFC) != 0
<span class="nc bnc" id="L449" title="All 2 branches missed.">                        || getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODLFOTOPITCH) != 0
<span class="nc bnc" id="L451" title="All 2 branches missed.">                        || getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODLFOTOVOLUME) != 0) {
<span class="nc" id="L453">                    short lfo_freq = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_FREQMODLFO);
<span class="nc" id="L455">                    short lfo_delay = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_DELAYMODLFO);
<span class="nc" id="L457">                    addTimecentValue(performer,</span>
                            ModelDestination.DESTINATION_LFO1_DELAY, lfo_delay);
<span class="nc" id="L459">                    addValue(performer,</span>
                            ModelDestination.DESTINATION_LFO1_FREQ, lfo_freq);
                }

<span class="nc" id="L463">                short vib_freq = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_FREQVIBLFO);
<span class="nc" id="L465">                short vib_delay = getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_DELAYVIBLFO);
<span class="nc" id="L467">                addTimecentValue(performer,</span>
                        ModelDestination.DESTINATION_LFO2_DELAY, vib_delay);
<span class="nc" id="L469">                addValue(performer,</span>
                        ModelDestination.DESTINATION_LFO2_FREQ, vib_freq);


<span class="nc bnc" id="L473" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_VIBLFOTOPITCH) != 0) {
<span class="nc" id="L475">                    double fvalue = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_VIBLFOTOPITCH);
<span class="nc" id="L477">                    ModelIdentifier src = ModelSource.SOURCE_LFO2;</span>
<span class="nc" id="L478">                    ModelIdentifier dest = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L479">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(
                            new ModelSource(src,
                                ModelStandardTransform.DIRECTION_MIN2MAX,
                                ModelStandardTransform.POLARITY_BIPOLAR),
                            fvalue, new ModelDestination(dest)));
                }

<span class="nc bnc" id="L487" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_MODLFOTOFILTERFC) != 0) {
<span class="nc" id="L489">                    double fvalue = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODLFOTOFILTERFC);
<span class="nc" id="L491">                    ModelIdentifier src = ModelSource.SOURCE_LFO1;</span>
<span class="nc" id="L492">                    ModelIdentifier dest = ModelDestination.DESTINATION_FILTER_FREQ;</span>
<span class="nc" id="L493">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(
                            new ModelSource(src,
                                ModelStandardTransform.DIRECTION_MIN2MAX,
                                ModelStandardTransform.POLARITY_BIPOLAR),
                            fvalue, new ModelDestination(dest)));
                }

<span class="nc bnc" id="L501" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_MODLFOTOPITCH) != 0) {
<span class="nc" id="L503">                    double fvalue = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODLFOTOPITCH);
<span class="nc" id="L505">                    ModelIdentifier src = ModelSource.SOURCE_LFO1;</span>
<span class="nc" id="L506">                    ModelIdentifier dest = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L507">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(
                            new ModelSource(src,
                                ModelStandardTransform.DIRECTION_MIN2MAX,
                                ModelStandardTransform.POLARITY_BIPOLAR),
                            fvalue, new ModelDestination(dest)));
                }

<span class="nc bnc" id="L515" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_MODLFOTOVOLUME) != 0) {
<span class="nc" id="L517">                    double fvalue = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_MODLFOTOVOLUME);
<span class="nc" id="L519">                    ModelIdentifier src = ModelSource.SOURCE_LFO1;</span>
<span class="nc" id="L520">                    ModelIdentifier dest = ModelDestination.DESTINATION_GAIN;</span>
<span class="nc" id="L521">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(
                            new ModelSource(src,
                                ModelStandardTransform.DIRECTION_MIN2MAX,
                                ModelStandardTransform.POLARITY_BIPOLAR),
                            fvalue, new ModelDestination(dest)));
                }

<span class="nc bnc" id="L529" title="All 2 branches missed.">                if (layerzone.getShort(SF2Region.GENERATOR_KEYNUM) != -1) {</span>
<span class="nc" id="L530">                    double val = layerzone.getShort(SF2Region.GENERATOR_KEYNUM)/128.0;</span>
<span class="nc" id="L531">                    addValue(performer, ModelDestination.DESTINATION_KEYNUMBER, val);</span>
                }

<span class="nc bnc" id="L534" title="All 2 branches missed.">                if (layerzone.getShort(SF2Region.GENERATOR_VELOCITY) != -1) {</span>
<span class="nc" id="L535">                    double val = layerzone.getShort(SF2Region.GENERATOR_VELOCITY)</span>
                                 / 128.0;
<span class="nc" id="L537">                    addValue(performer, ModelDestination.DESTINATION_VELOCITY, val);</span>
                }

<span class="nc bnc" id="L540" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_INITIALFILTERFC) &lt; 13500) {
<span class="nc" id="L542">                    short filter_freq = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_INITIALFILTERFC);
<span class="nc" id="L544">                    short filter_q = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_INITIALFILTERQ);
<span class="nc" id="L546">                    addValue(performer,</span>
                            ModelDestination.DESTINATION_FILTER_FREQ, filter_freq);
<span class="nc" id="L548">                    addValue(performer,</span>
                            ModelDestination.DESTINATION_FILTER_Q, filter_q);
                }

<span class="nc" id="L552">                int tune = 100 * getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_COARSETUNE);
<span class="nc" id="L554">                tune += getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_FINETUNE);
<span class="nc bnc" id="L556" title="All 2 branches missed.">                if (tune != 0) {</span>
<span class="nc" id="L557">                    addValue(performer,</span>
                            ModelDestination.DESTINATION_PITCH, (short) tune);
                }
<span class="nc bnc" id="L560" title="All 2 branches missed.">                if (getGeneratorValue(generators, SF2Region.GENERATOR_PAN) != 0) {</span>
<span class="nc" id="L561">                    short val = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_PAN);
<span class="nc" id="L563">                    addValue(performer, ModelDestination.DESTINATION_PAN, val);</span>
                }
<span class="nc bnc" id="L565" title="All 2 branches missed.">                if (getGeneratorValue(generators, SF2Region.GENERATOR_INITIALATTENUATION) != 0) {</span>
<span class="nc" id="L566">                    short val = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_INITIALATTENUATION);
<span class="nc" id="L568">                    addValue(performer,</span>
                            ModelDestination.DESTINATION_GAIN, -0.376287f * val);
                }
<span class="nc bnc" id="L571" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_CHORUSEFFECTSSEND) != 0) {
<span class="nc" id="L573">                    short val = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_CHORUSEFFECTSSEND);
<span class="nc" id="L575">                    addValue(performer, ModelDestination.DESTINATION_CHORUS, val);</span>
                }
<span class="nc bnc" id="L577" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_REVERBEFFECTSSEND) != 0) {
<span class="nc" id="L579">                    short val = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_REVERBEFFECTSSEND);
<span class="nc" id="L581">                    addValue(performer, ModelDestination.DESTINATION_REVERB, val);</span>
                }
<span class="nc bnc" id="L583" title="All 2 branches missed.">                if (getGeneratorValue(generators,</span>
                        SF2Region.GENERATOR_SCALETUNING) != 100) {
<span class="nc" id="L585">                    short fvalue = getGeneratorValue(generators,</span>
                            SF2Region.GENERATOR_SCALETUNING);
<span class="nc bnc" id="L587" title="All 2 branches missed.">                    if (fvalue == 0) {</span>
<span class="nc" id="L588">                        ModelIdentifier dest = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L589">                        performer.getConnectionBlocks().add(</span>
                            new ModelConnectionBlock(null, rootkey * 100,
                                new ModelDestination(dest)));
<span class="nc" id="L592">                    } else {</span>
<span class="nc" id="L593">                        ModelIdentifier dest = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L594">                        performer.getConnectionBlocks().add(</span>
                            new ModelConnectionBlock(null, rootkey * (100 - fvalue),
                                new ModelDestination(dest)));
                    }

<span class="nc" id="L599">                    ModelIdentifier src = ModelSource.SOURCE_NOTEON_KEYNUMBER;</span>
<span class="nc" id="L600">                    ModelIdentifier dest = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L601">                    performer.getConnectionBlocks().add(</span>
                        new ModelConnectionBlock(new ModelSource(src),
                            128 * fvalue, new ModelDestination(dest)));

                }

<span class="nc" id="L607">                performer.getConnectionBlocks().add(</span>
                    new ModelConnectionBlock(
                        new ModelSource(ModelSource.SOURCE_NOTEON_VELOCITY,
<span class="nc" id="L610">                            new ModelTransform() {</span>
                                public double transform(double value) {
<span class="nc bnc" id="L612" title="All 2 branches missed.">                                    if (value &lt; 0.5)</span>
<span class="nc" id="L613">                                        return 1 - value * 2;</span>
                                    else
<span class="nc" id="L615">                                        return 0;</span>
                                }
                            }),
                        -2400,
                        new ModelDestination(
                            ModelDestination.DESTINATION_FILTER_FREQ)));


<span class="nc" id="L623">                performer.getConnectionBlocks().add(</span>
                    new ModelConnectionBlock(
                        new ModelSource(ModelSource.SOURCE_LFO2,
                            ModelStandardTransform.DIRECTION_MIN2MAX,
                            ModelStandardTransform.POLARITY_BIPOLAR,
                            ModelStandardTransform.TRANSFORM_LINEAR),
                        new ModelSource(new ModelIdentifier(&quot;midi_cc&quot;, &quot;1&quot;, 0),
                            ModelStandardTransform.DIRECTION_MIN2MAX,
                            ModelStandardTransform.POLARITY_UNIPOLAR,
                            ModelStandardTransform.TRANSFORM_LINEAR),
                        50, new ModelDestination(
                            ModelDestination.DESTINATION_PITCH)));

<span class="nc bnc" id="L636" title="All 2 branches missed.">                if (layer.getGlobalRegion() != null) {</span>
                    for (SF2Modulator modulator
<span class="nc bnc" id="L638" title="All 2 branches missed.">                            : layer.getGlobalRegion().getModulators()) {</span>
<span class="nc" id="L639">                        convertModulator(performer, modulator);</span>
<span class="nc" id="L640">                    }</span>
                }
<span class="nc bnc" id="L642" title="All 2 branches missed.">                for (SF2Modulator modulator : layerzone.getModulators())</span>
<span class="nc" id="L643">                    convertModulator(performer, modulator);</span>

<span class="nc bnc" id="L645" title="All 2 branches missed.">                if (presetglobal != null) {</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">                    for (SF2Modulator modulator : presetglobal.getModulators())</span>
<span class="nc" id="L647">                        convertModulator(performer, modulator);</span>
                }
<span class="nc bnc" id="L649" title="All 2 branches missed.">                for (SF2Modulator modulator : presetzone.getModulators())</span>
<span class="nc" id="L650">                    convertModulator(performer, modulator);</span>

<span class="nc" id="L652">            }</span>
<span class="nc" id="L653">        }</span>
<span class="nc" id="L654">        return performers;</span>
    }

    private void convertModulator(ModelPerformer performer,
            SF2Modulator modulator) {
<span class="nc" id="L659">        ModelSource src1 = convertSource(modulator.getSourceOperator());</span>
<span class="nc" id="L660">        ModelSource src2 = convertSource(modulator.getAmountSourceOperator());</span>
<span class="nc bnc" id="L661" title="All 4 branches missed.">        if (src1 == null &amp;&amp; modulator.getSourceOperator() != 0)</span>
<span class="nc" id="L662">            return;</span>
<span class="nc bnc" id="L663" title="All 4 branches missed.">        if (src2 == null &amp;&amp; modulator.getAmountSourceOperator() != 0)</span>
<span class="nc" id="L664">            return;</span>
<span class="nc" id="L665">        double amount = modulator.getAmount();</span>
<span class="nc" id="L666">        double[] amountcorrection = new double[1];</span>
<span class="nc" id="L667">        ModelSource[] extrasrc = new ModelSource[1];</span>
<span class="nc" id="L668">        amountcorrection[0] = 1;</span>
<span class="nc" id="L669">        ModelDestination dst = convertDestination(</span>
<span class="nc" id="L670">                modulator.getDestinationOperator(), amountcorrection, extrasrc);</span>
<span class="nc" id="L671">        amount *= amountcorrection[0];</span>
<span class="nc bnc" id="L672" title="All 2 branches missed.">        if (dst == null)</span>
<span class="nc" id="L673">            return;</span>
<span class="nc bnc" id="L674" title="All 2 branches missed.">        if (modulator.getTransportOperator() == SF2Modulator.TRANSFORM_ABSOLUTE) {</span>
<span class="nc" id="L675">            ((ModelStandardTransform)dst.getTransform()).setTransform(</span>
                    ModelStandardTransform.TRANSFORM_ABSOLUTE);
        }
<span class="nc" id="L678">        ModelConnectionBlock conn = new ModelConnectionBlock(src1, src2, amount, dst);</span>
<span class="nc bnc" id="L679" title="All 2 branches missed.">        if (extrasrc[0] != null)</span>
<span class="nc" id="L680">            conn.addSource(extrasrc[0]);</span>
<span class="nc" id="L681">        performer.getConnectionBlocks().add(conn);</span>

<span class="nc" id="L683">    }</span>

    private static ModelSource convertSource(int src) {
<span class="nc bnc" id="L686" title="All 2 branches missed.">        if (src == 0)</span>
<span class="nc" id="L687">            return null;</span>
<span class="nc" id="L688">        ModelIdentifier id = null;</span>
<span class="nc" id="L689">        int idsrc = src &amp; 0x7F;</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">        if ((src &amp; SF2Modulator.SOURCE_MIDI_CONTROL) != 0) {</span>
<span class="nc" id="L691">            id = new ModelIdentifier(&quot;midi_cc&quot;, Integer.toString(idsrc));</span>
        } else {
<span class="nc bnc" id="L693" title="All 2 branches missed.">            if (idsrc == SF2Modulator.SOURCE_NOTE_ON_VELOCITY)</span>
<span class="nc" id="L694">                id = ModelSource.SOURCE_NOTEON_VELOCITY;</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">            if (idsrc == SF2Modulator.SOURCE_NOTE_ON_KEYNUMBER)</span>
<span class="nc" id="L696">                id = ModelSource.SOURCE_NOTEON_KEYNUMBER;</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">            if (idsrc == SF2Modulator.SOURCE_POLY_PRESSURE)</span>
<span class="nc" id="L698">                id = ModelSource.SOURCE_MIDI_POLY_PRESSURE;</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if (idsrc == SF2Modulator.SOURCE_CHANNEL_PRESSURE)</span>
<span class="nc" id="L700">                id = ModelSource.SOURCE_MIDI_CHANNEL_PRESSURE;</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">            if (idsrc == SF2Modulator.SOURCE_PITCH_WHEEL)</span>
<span class="nc" id="L702">                id = ModelSource.SOURCE_MIDI_PITCH;</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">            if (idsrc == SF2Modulator.SOURCE_PITCH_SENSITIVITY)</span>
<span class="nc" id="L704">                id = new ModelIdentifier(&quot;midi_rpn&quot;, &quot;0&quot;);</span>
        }
<span class="nc bnc" id="L706" title="All 2 branches missed.">        if (id == null)</span>
<span class="nc" id="L707">            return null;</span>

<span class="nc" id="L709">        ModelSource msrc = new ModelSource(id);</span>
<span class="nc" id="L710">        ModelStandardTransform transform</span>
<span class="nc" id="L711">                = (ModelStandardTransform) msrc.getTransform();</span>

<span class="nc bnc" id="L713" title="All 2 branches missed.">        if ((SF2Modulator.SOURCE_DIRECTION_MAX_MIN &amp; src) != 0)</span>
<span class="nc" id="L714">            transform.setDirection(ModelStandardTransform.DIRECTION_MAX2MIN);</span>
        else
<span class="nc" id="L716">            transform.setDirection(ModelStandardTransform.DIRECTION_MIN2MAX);</span>

<span class="nc bnc" id="L718" title="All 2 branches missed.">        if ((SF2Modulator.SOURCE_POLARITY_BIPOLAR &amp; src) != 0)</span>
<span class="nc" id="L719">            transform.setPolarity(ModelStandardTransform.POLARITY_BIPOLAR);</span>
        else
<span class="nc" id="L721">            transform.setPolarity(ModelStandardTransform.POLARITY_UNIPOLAR);</span>

<span class="nc bnc" id="L723" title="All 2 branches missed.">        if ((SF2Modulator.SOURCE_TYPE_CONCAVE &amp; src) != 0)</span>
<span class="nc" id="L724">            transform.setTransform(ModelStandardTransform.TRANSFORM_CONCAVE);</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">        if ((SF2Modulator.SOURCE_TYPE_CONVEX &amp; src) != 0)</span>
<span class="nc" id="L726">            transform.setTransform(ModelStandardTransform.TRANSFORM_CONVEX);</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">        if ((SF2Modulator.SOURCE_TYPE_SWITCH &amp; src) != 0)</span>
<span class="nc" id="L728">            transform.setTransform(ModelStandardTransform.TRANSFORM_SWITCH);</span>

<span class="nc" id="L730">        return msrc;</span>
    }

    static ModelDestination convertDestination(int dst,
            double[] amountcorrection, ModelSource[] extrasrc) {
<span class="nc" id="L735">        ModelIdentifier id = null;</span>
<span class="nc bnc" id="L736" title="All 33 branches missed.">        switch (dst) {</span>
            case SF2Region.GENERATOR_INITIALFILTERFC:
<span class="nc" id="L738">                id = ModelDestination.DESTINATION_FILTER_FREQ;</span>
<span class="nc" id="L739">                break;</span>
            case SF2Region.GENERATOR_INITIALFILTERQ:
<span class="nc" id="L741">                id = ModelDestination.DESTINATION_FILTER_Q;</span>
<span class="nc" id="L742">                break;</span>
            case SF2Region.GENERATOR_CHORUSEFFECTSSEND:
<span class="nc" id="L744">                id = ModelDestination.DESTINATION_CHORUS;</span>
<span class="nc" id="L745">                break;</span>
            case SF2Region.GENERATOR_REVERBEFFECTSSEND:
<span class="nc" id="L747">                id = ModelDestination.DESTINATION_REVERB;</span>
<span class="nc" id="L748">                break;</span>
            case SF2Region.GENERATOR_PAN:
<span class="nc" id="L750">                id = ModelDestination.DESTINATION_PAN;</span>
<span class="nc" id="L751">                break;</span>
            case SF2Region.GENERATOR_DELAYMODLFO:
<span class="nc" id="L753">                id = ModelDestination.DESTINATION_LFO1_DELAY;</span>
<span class="nc" id="L754">                break;</span>
            case SF2Region.GENERATOR_FREQMODLFO:
<span class="nc" id="L756">                id = ModelDestination.DESTINATION_LFO1_FREQ;</span>
<span class="nc" id="L757">                break;</span>
            case SF2Region.GENERATOR_DELAYVIBLFO:
<span class="nc" id="L759">                id = ModelDestination.DESTINATION_LFO2_DELAY;</span>
<span class="nc" id="L760">                break;</span>
            case SF2Region.GENERATOR_FREQVIBLFO:
<span class="nc" id="L762">                id = ModelDestination.DESTINATION_LFO2_FREQ;</span>
<span class="nc" id="L763">                break;</span>

            case SF2Region.GENERATOR_DELAYMODENV:
<span class="nc" id="L766">                id = ModelDestination.DESTINATION_EG2_DELAY;</span>
<span class="nc" id="L767">                break;</span>
            case SF2Region.GENERATOR_ATTACKMODENV:
<span class="nc" id="L769">                id = ModelDestination.DESTINATION_EG2_ATTACK;</span>
<span class="nc" id="L770">                break;</span>
            case SF2Region.GENERATOR_HOLDMODENV:
<span class="nc" id="L772">                id = ModelDestination.DESTINATION_EG2_HOLD;</span>
<span class="nc" id="L773">                break;</span>
            case SF2Region.GENERATOR_DECAYMODENV:
<span class="nc" id="L775">                id = ModelDestination.DESTINATION_EG2_DECAY;</span>
<span class="nc" id="L776">                break;</span>
            case SF2Region.GENERATOR_SUSTAINMODENV:
<span class="nc" id="L778">                id = ModelDestination.DESTINATION_EG2_SUSTAIN;</span>
<span class="nc" id="L779">                amountcorrection[0] = -1;</span>
<span class="nc" id="L780">                break;</span>
            case SF2Region.GENERATOR_RELEASEMODENV:
<span class="nc" id="L782">                id = ModelDestination.DESTINATION_EG2_RELEASE;</span>
<span class="nc" id="L783">                break;</span>
            case SF2Region.GENERATOR_DELAYVOLENV:
<span class="nc" id="L785">                id = ModelDestination.DESTINATION_EG1_DELAY;</span>
<span class="nc" id="L786">                break;</span>
            case SF2Region.GENERATOR_ATTACKVOLENV:
<span class="nc" id="L788">                id = ModelDestination.DESTINATION_EG1_ATTACK;</span>
<span class="nc" id="L789">                break;</span>
            case SF2Region.GENERATOR_HOLDVOLENV:
<span class="nc" id="L791">                id = ModelDestination.DESTINATION_EG1_HOLD;</span>
<span class="nc" id="L792">                break;</span>
            case SF2Region.GENERATOR_DECAYVOLENV:
<span class="nc" id="L794">                id = ModelDestination.DESTINATION_EG1_DECAY;</span>
<span class="nc" id="L795">                break;</span>
            case SF2Region.GENERATOR_SUSTAINVOLENV:
<span class="nc" id="L797">                id = ModelDestination.DESTINATION_EG1_SUSTAIN;</span>
<span class="nc" id="L798">                amountcorrection[0] = -1;</span>
<span class="nc" id="L799">                break;</span>
            case SF2Region.GENERATOR_RELEASEVOLENV:
<span class="nc" id="L801">                id = ModelDestination.DESTINATION_EG1_RELEASE;</span>
<span class="nc" id="L802">                break;</span>
            case SF2Region.GENERATOR_KEYNUM:
<span class="nc" id="L804">                id = ModelDestination.DESTINATION_KEYNUMBER;</span>
<span class="nc" id="L805">                break;</span>
            case SF2Region.GENERATOR_VELOCITY:
<span class="nc" id="L807">                id = ModelDestination.DESTINATION_VELOCITY;</span>
<span class="nc" id="L808">                break;</span>

            case SF2Region.GENERATOR_COARSETUNE:
<span class="nc" id="L811">                amountcorrection[0] = 100;</span>
<span class="nc" id="L812">                id = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L813">                break;</span>

            case SF2Region.GENERATOR_FINETUNE:
<span class="nc" id="L816">                id = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L817">                break;</span>

            case SF2Region.GENERATOR_INITIALATTENUATION:
<span class="nc" id="L820">                id = ModelDestination.DESTINATION_GAIN;</span>
<span class="nc" id="L821">                amountcorrection[0] = -0.376287f;</span>
<span class="nc" id="L822">                break;</span>

            case SF2Region.GENERATOR_VIBLFOTOPITCH:
<span class="nc" id="L825">                id = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L826">                extrasrc[0] = new ModelSource(</span>
                        ModelSource.SOURCE_LFO2,
                        ModelStandardTransform.DIRECTION_MIN2MAX,
                        ModelStandardTransform.POLARITY_BIPOLAR);
<span class="nc" id="L830">                break;</span>

            case SF2Region.GENERATOR_MODLFOTOPITCH:
<span class="nc" id="L833">                id = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L834">                extrasrc[0] = new ModelSource(</span>
                        ModelSource.SOURCE_LFO1,
                        ModelStandardTransform.DIRECTION_MIN2MAX,
                        ModelStandardTransform.POLARITY_BIPOLAR);
<span class="nc" id="L838">                break;</span>

            case SF2Region.GENERATOR_MODLFOTOFILTERFC:
<span class="nc" id="L841">                id = ModelDestination.DESTINATION_FILTER_FREQ;</span>
<span class="nc" id="L842">                extrasrc[0] = new ModelSource(</span>
                        ModelSource.SOURCE_LFO1,
                        ModelStandardTransform.DIRECTION_MIN2MAX,
                        ModelStandardTransform.POLARITY_BIPOLAR);
<span class="nc" id="L846">                break;</span>

            case SF2Region.GENERATOR_MODLFOTOVOLUME:
<span class="nc" id="L849">                id = ModelDestination.DESTINATION_GAIN;</span>
<span class="nc" id="L850">                amountcorrection[0] = -0.376287f;</span>
<span class="nc" id="L851">                extrasrc[0] = new ModelSource(</span>
                        ModelSource.SOURCE_LFO1,
                        ModelStandardTransform.DIRECTION_MIN2MAX,
                        ModelStandardTransform.POLARITY_BIPOLAR);
<span class="nc" id="L855">                break;</span>

            case SF2Region.GENERATOR_MODENVTOPITCH:
<span class="nc" id="L858">                id = ModelDestination.DESTINATION_PITCH;</span>
<span class="nc" id="L859">                extrasrc[0] = new ModelSource(</span>
                        ModelSource.SOURCE_EG2,
                        ModelStandardTransform.DIRECTION_MIN2MAX,
                        ModelStandardTransform.POLARITY_BIPOLAR);
<span class="nc" id="L863">                break;</span>

            case SF2Region.GENERATOR_MODENVTOFILTERFC:
<span class="nc" id="L866">                id = ModelDestination.DESTINATION_FILTER_FREQ;</span>
<span class="nc" id="L867">                extrasrc[0] = new ModelSource(</span>
                        ModelSource.SOURCE_EG2,
                        ModelStandardTransform.DIRECTION_MIN2MAX,
                        ModelStandardTransform.POLARITY_BIPOLAR);
<span class="nc" id="L871">                break;</span>

            default:
                break;
        }
<span class="nc bnc" id="L876" title="All 2 branches missed.">        if (id != null)</span>
<span class="nc" id="L877">            return new ModelDestination(id);</span>
<span class="nc" id="L878">        return null;</span>
    }

    private void addTimecentValue(ModelPerformer performer,
            ModelIdentifier dest, short value) {
        double fvalue;
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if (value == -12000)</span>
<span class="nc" id="L885">            fvalue = Double.NEGATIVE_INFINITY;</span>
        else
<span class="nc" id="L887">            fvalue = value;</span>
<span class="nc" id="L888">        performer.getConnectionBlocks().add(</span>
                new ModelConnectionBlock(fvalue, new ModelDestination(dest)));
<span class="nc" id="L890">    }</span>

    private void addValue(ModelPerformer performer,
            ModelIdentifier dest, short value) {
<span class="nc" id="L894">        double fvalue = value;</span>
<span class="nc" id="L895">        performer.getConnectionBlocks().add(</span>
                new ModelConnectionBlock(fvalue, new ModelDestination(dest)));
<span class="nc" id="L897">    }</span>

    private void addValue(ModelPerformer performer,
            ModelIdentifier dest, double value) {
<span class="nc" id="L901">        double fvalue = value;</span>
<span class="nc" id="L902">        performer.getConnectionBlocks().add(</span>
                new ModelConnectionBlock(fvalue, new ModelDestination(dest)));
<span class="nc" id="L904">    }</span>

    private short getGeneratorValue(Map&lt;Integer, Short&gt; generators, int gen) {
<span class="nc bnc" id="L907" title="All 2 branches missed.">        if (generators.containsKey(gen))</span>
<span class="nc" id="L908">            return generators.get(gen);</span>
<span class="nc" id="L909">        return SF2Region.getDefaultValue(gen);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>