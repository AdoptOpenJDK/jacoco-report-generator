<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>RoleList.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.management.relation</a> &gt; <span class="el_source">RoleList.java</span></div><h1>RoleList.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management.relation;

import com.sun.jmx.mbeanserver.Util;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

/**
 * A RoleList represents a list of roles (Role objects). It is used as
 * parameter when creating a relation, and when trying to set several roles in
 * a relation (via 'setRoles()' method). It is returned as part of a
 * RoleResult, to provide roles successfully retrieved.
 *
 * @since 1.5
 */
/* We cannot extend ArrayList&lt;Role&gt; because our legacy
   add(Role) method would then override add(E) in ArrayList&lt;E&gt;,
   and our return value is void whereas ArrayList.add(E)'s is boolean.
   Likewise for set(int,Role).  Grrr.  We cannot use covariance
   to override the most important methods and have them return
   Role, either, because that would break subclasses that
   override those methods in turn (using the original return type
   of Object).  Finally, we cannot implement Iterable&lt;Role&gt;
   so you could write
       for (Role r : roleList)
   because ArrayList&lt;&gt; implements Iterable&lt;&gt; and the same class cannot
   implement two versions of a generic interface.  Instead we provide
   the asList() method so you can write
       for (Role r : roleList.asList())
*/
public class RoleList extends ArrayList&lt;Object&gt; {

    private transient boolean typeSafe;
    private transient boolean tainted;

    /* Serial version */
    private static final long serialVersionUID = 5568344346499649313L;

    //
    // Constructors
    //

    /**
     * Constructs an empty RoleList.
     */
    public RoleList() {
<span class="nc" id="L72">        super();</span>
<span class="nc" id="L73">    }</span>

    /**
     * Constructs an empty RoleList with the initial capacity
     * specified.
     *
     * @param initialCapacity  initial capacity
     */
    public RoleList(int initialCapacity) {
<span class="nc" id="L82">        super(initialCapacity);</span>
<span class="nc" id="L83">    }</span>

    /**
     * Constructs a {@code RoleList} containing the elements of the
     * {@code List} specified, in the order in which they are returned by
     * the {@code List}'s iterator. The {@code RoleList} instance has
     * an initial capacity of 110% of the size of the {@code List}
     * specified.
     *
     * @param list the {@code List} that defines the initial contents of
     * the new {@code RoleList}.
     *
     * @exception IllegalArgumentException if the {@code list} parameter
     * is {@code null} or if the {@code list} parameter contains any
     * non-Role objects.
     *
     * @see ArrayList#ArrayList(java.util.Collection)
     */
<span class="nc" id="L101">    public RoleList(List&lt;Role&gt; list) throws IllegalArgumentException {</span>
        // Check for null parameter
        //
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (list == null)</span>
<span class="nc" id="L105">            throw new IllegalArgumentException(&quot;Null parameter&quot;);</span>

        // Check for non-Role objects
        //
<span class="nc" id="L109">        checkTypeSafe(list);</span>

        // Build the List&lt;Role&gt;
        //
<span class="nc" id="L113">        super.addAll(list);</span>
<span class="nc" id="L114">    }</span>

    /**
     * Return a view of this list as a {@code List&lt;Role&gt;}.
     * Changes to the returned value are reflected by changes
     * to the original {@code RoleList} and vice versa.
     *
     * @return a {@code List&lt;Role&gt;} whose contents
     * reflect the contents of this {@code RoleList}.
     *
     * &lt;p&gt;If this method has ever been called on a given
     * {@code RoleList} instance, a subsequent attempt to add
     * an object to that instance which is not a {@code Role}
     * will fail with an {@code IllegalArgumentException}. For compatibility
     * reasons, a {@code RoleList} on which this method has never
     * been called does allow objects other than {@code Role}s to
     * be added.&lt;/p&gt;
     *
     * @throws IllegalArgumentException if this {@code RoleList} contains
     * an element that is not a {@code Role}.
     *
     * @since 1.6
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public List&lt;Role&gt; asList() {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (!typeSafe) {</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">            if (tainted)</span>
<span class="nc" id="L141">                checkTypeSafe(this);</span>
<span class="nc" id="L142">            typeSafe = true;</span>
        }
<span class="nc" id="L144">        return Util.cast(this);</span>
    }

    //
    // Accessors
    //

    /**
     * Adds the Role specified as the last element of the list.
     *
     * @param role  the role to be added.
     *
     * @exception IllegalArgumentException  if the role is null.
     */
    public void add(Role role)
        throws IllegalArgumentException {

<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (role == null) {</span>
<span class="nc" id="L162">            String excMsg = &quot;Invalid parameter&quot;;</span>
<span class="nc" id="L163">            throw new IllegalArgumentException(excMsg);</span>
        }
<span class="nc" id="L165">        super.add(role);</span>
<span class="nc" id="L166">    }</span>

    /**
     * Inserts the role specified as an element at the position specified.
     * Elements with an index greater than or equal to the current position are
     * shifted up.
     *
     * @param index  The position in the list where the new Role
     * object is to be inserted.
     * @param role  The Role object to be inserted.
     *
     * @exception IllegalArgumentException  if the role is null.
     * @exception IndexOutOfBoundsException  if accessing with an index
     * outside of the list.
     */
    public void add(int index,
                    Role role)
        throws IllegalArgumentException,
               IndexOutOfBoundsException {

<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (role == null) {</span>
<span class="nc" id="L187">            String excMsg = &quot;Invalid parameter&quot;;</span>
<span class="nc" id="L188">            throw new IllegalArgumentException(excMsg);</span>
        }

<span class="nc" id="L191">        super.add(index, role);</span>
<span class="nc" id="L192">    }</span>

    /**
     * Sets the element at the position specified to be the role
     * specified.
     * The previous element at that position is discarded.
     *
     * @param index  The position specified.
     * @param role  The value to which the role element should be set.
     *
     * @exception IllegalArgumentException  if the role is null.
     * @exception IndexOutOfBoundsException  if accessing with an index
     * outside of the list.
     */
     public void set(int index,
                     Role role)
         throws IllegalArgumentException,
                IndexOutOfBoundsException {

<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (role == null) {</span>
            // Revisit [cebro] Localize message
<span class="nc" id="L213">            String excMsg = &quot;Invalid parameter.&quot;;</span>
<span class="nc" id="L214">            throw new IllegalArgumentException(excMsg);</span>
        }

<span class="nc" id="L217">        super.set(index, role);</span>
<span class="nc" id="L218">     }</span>

    /**
     * Appends all the elements in the RoleList specified to the end
     * of the list, in the order in which they are returned by the Iterator of
     * the RoleList specified.
     *
     * @param roleList  Elements to be inserted into the list (can be null)
     *
     * @return true if this list changed as a result of the call.
     *
     * @exception IndexOutOfBoundsException  if accessing with an index
     * outside of the list.
     *
     * @see ArrayList#addAll(Collection)
     */
    public boolean addAll(RoleList roleList)
        throws IndexOutOfBoundsException {

<span class="nc bnc" id="L237" title="All 2 branches missed.">        if (roleList == null) {</span>
<span class="nc" id="L238">            return true;</span>
        }

<span class="nc" id="L241">        return (super.addAll(roleList));</span>
    }

    /**
     * Inserts all of the elements in the RoleList specified into this
     * list, starting at the specified position, in the order in which they are
     * returned by the Iterator of the RoleList specified.
     *
     * @param index  Position at which to insert the first element from the
     * RoleList specified.
     * @param roleList  Elements to be inserted into the list.
     *
     * @return true if this list changed as a result of the call.
     *
     * @exception IllegalArgumentException  if the role is null.
     * @exception IndexOutOfBoundsException  if accessing with an index
     * outside of the list.
     *
     * @see ArrayList#addAll(int, Collection)
     */
    public boolean addAll(int index,
                          RoleList roleList)
        throws IllegalArgumentException,
               IndexOutOfBoundsException {

<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (roleList == null) {</span>
            // Revisit [cebro] Localize message
<span class="nc" id="L268">            String excMsg = &quot;Invalid parameter.&quot;;</span>
<span class="nc" id="L269">            throw new IllegalArgumentException(excMsg);</span>
        }

<span class="nc" id="L272">        return (super.addAll(index, roleList));</span>
    }

    /*
     * Override all of the methods from ArrayList&lt;Object&gt; that might add
     * a non-Role to the List, and disallow that if asList has ever
     * been called on this instance.
     */

    @Override
    public boolean add(Object o) {
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (!tainted)</span>
<span class="nc" id="L284">            tainted = isTainted(o);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">        if (typeSafe)</span>
<span class="nc" id="L286">            checkTypeSafe(o);</span>
<span class="nc" id="L287">        return super.add(o);</span>
    }

    @Override
    public void add(int index, Object element) {
<span class="nc bnc" id="L292" title="All 2 branches missed.">        if (!tainted)</span>
<span class="nc" id="L293">            tainted = isTainted(element);</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (typeSafe)</span>
<span class="nc" id="L295">            checkTypeSafe(element);</span>
<span class="nc" id="L296">        super.add(index, element);</span>
<span class="nc" id="L297">    }</span>

    @Override
    public boolean addAll(Collection&lt;?&gt; c) {
<span class="nc bnc" id="L301" title="All 2 branches missed.">        if (!tainted)</span>
<span class="nc" id="L302">            tainted = isTainted(c);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if (typeSafe)</span>
<span class="nc" id="L304">            checkTypeSafe(c);</span>
<span class="nc" id="L305">        return super.addAll(c);</span>
    }

    @Override
    public boolean addAll(int index, Collection&lt;?&gt; c) {
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (!tainted)</span>
<span class="nc" id="L311">            tainted = isTainted(c);</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">        if (typeSafe)</span>
<span class="nc" id="L313">            checkTypeSafe(c);</span>
<span class="nc" id="L314">        return super.addAll(index, c);</span>
    }

    @Override
    public Object set(int index, Object element) {
<span class="nc bnc" id="L319" title="All 2 branches missed.">        if (!tainted)</span>
<span class="nc" id="L320">            tainted = isTainted(element);</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (typeSafe)</span>
<span class="nc" id="L322">            checkTypeSafe(element);</span>
<span class="nc" id="L323">        return super.set(index, element);</span>
    }

    /**
     * IllegalArgumentException if o is a non-Role object.
     */
    private static void checkTypeSafe(Object o) {
        try {
<span class="nc" id="L331">            o = (Role) o;</span>
<span class="nc" id="L332">        } catch (ClassCastException e) {</span>
<span class="nc" id="L333">            throw new IllegalArgumentException(e);</span>
<span class="nc" id="L334">        }</span>
<span class="nc" id="L335">    }</span>

    /**
     * IllegalArgumentException if c contains any non-Role objects.
     */
    private static void checkTypeSafe(Collection&lt;?&gt; c) {
        try {
            Role r;
<span class="nc bnc" id="L343" title="All 2 branches missed.">            for (Object o : c)</span>
<span class="nc" id="L344">                r = (Role) o;</span>
<span class="nc" id="L345">        } catch (ClassCastException e) {</span>
<span class="nc" id="L346">            throw new IllegalArgumentException(e);</span>
<span class="nc" id="L347">        }</span>
<span class="nc" id="L348">    }</span>

    /**
     * Returns true if o is a non-Role object.
     */
    private static boolean isTainted(Object o) {
        try {
<span class="nc" id="L355">            checkTypeSafe(o);</span>
<span class="nc" id="L356">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L357">            return true;</span>
<span class="nc" id="L358">        }</span>
<span class="nc" id="L359">        return false;</span>
    }

    /**
     * Returns true if c contains any non-Role objects.
     */
    private static boolean isTainted(Collection&lt;?&gt; c) {
        try {
<span class="nc" id="L367">            checkTypeSafe(c);</span>
<span class="nc" id="L368">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L369">            return true;</span>
<span class="nc" id="L370">        }</span>
<span class="nc" id="L371">        return false;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>