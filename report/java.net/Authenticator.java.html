<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>Authenticator.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">java.net</a> &gt; <span class="el_source">Authenticator.java</span></div><h1>Authenticator.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.net;

/**
 * The class Authenticator represents an object that knows how to obtain
 * authentication for a network connection.  Usually, it will do this
 * by prompting the user for information.
 * &lt;p&gt;
 * Applications use this class by overriding {@link
 * #getPasswordAuthentication()} in a sub-class. This method will
 * typically use the various getXXX() accessor methods to get information
 * about the entity requesting authentication. It must then acquire a
 * username and password either by interacting with the user or through
 * some other non-interactive means. The credentials are then returned
 * as a {@link PasswordAuthentication} return value.
 * &lt;p&gt;
 * An instance of this concrete sub-class is then registered
 * with the system by calling {@link #setDefault(Authenticator)}.
 * When authentication is required, the system will invoke one of the
 * requestPasswordAuthentication() methods which in turn will call the
 * getPasswordAuthentication() method of the registered object.
 * &lt;p&gt;
 * All methods that request authentication have a default implementation
 * that fails.
 *
 * @see java.net.Authenticator#setDefault(java.net.Authenticator)
 * @see java.net.Authenticator#getPasswordAuthentication()
 *
 * @author  Bill JDKte
 * @since   1.2
 */

// There are no abstract methods, but to be useful the user must
// subclass.
public abstract
<span class="fc" id="L60">class Authenticator {</span>

    // The system-wide authenticator object.  See setDefault().
    private static Authenticator theAuthenticator;

    private String requestingHost;
    private InetAddress requestingSite;
    private int requestingPort;
    private String requestingProtocol;
    private String requestingPrompt;
    private String requestingScheme;
    private URL requestingURL;
    private RequestorType requestingAuthType;

    /**
     * The type of the entity requesting authentication.
     *
     * @since 1.5
     */
<span class="pc" id="L79">    public enum RequestorType {</span>
        /**
         * Entity requesting authentication is a HTTP proxy server.
         */
<span class="fc" id="L83">        PROXY,</span>
        /**
         * Entity requesting authentication is a HTTP origin server.
         */
<span class="fc" id="L87">        SERVER</span>
    }

    private void reset() {
<span class="fc" id="L91">        requestingHost = null;</span>
<span class="fc" id="L92">        requestingSite = null;</span>
<span class="fc" id="L93">        requestingPort = -1;</span>
<span class="fc" id="L94">        requestingProtocol = null;</span>
<span class="fc" id="L95">        requestingPrompt = null;</span>
<span class="fc" id="L96">        requestingScheme = null;</span>
<span class="fc" id="L97">        requestingURL = null;</span>
<span class="fc" id="L98">        requestingAuthType = RequestorType.SERVER;</span>
<span class="fc" id="L99">    }</span>


    /**
     * Sets the authenticator that will be used by the networking code
     * when a proxy or an HTTP server asks for authentication.
     * &lt;p&gt;
     * First, if there is a security manager, its {@code checkPermission}
     * method is called with a
     * {@code NetPermission(&quot;setDefaultAuthenticator&quot;)} permission.
     * This may result in a java.lang.SecurityException.
     *
     * @param   a       The authenticator to be set. If a is {@code null} then
     *                  any previously set authenticator is removed.
     *
     * @throws SecurityException
     *        if a security manager exists and its
     *        {@code checkPermission} method doesn't allow
     *        setting the default authenticator.
     *
     * @see SecurityManager#checkPermission
     * @see java.net.NetPermission
     */
    public synchronized static void setDefault(Authenticator a) {
<span class="fc" id="L123">        SecurityManager sm = System.getSecurityManager();</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">        if (sm != null) {</span>
<span class="fc" id="L125">            NetPermission setDefaultPermission</span>
                = new NetPermission(&quot;setDefaultAuthenticator&quot;);
<span class="fc" id="L127">            sm.checkPermission(setDefaultPermission);</span>
        }

<span class="fc" id="L130">        theAuthenticator = a;</span>
<span class="fc" id="L131">    }</span>

    /**
     * Ask the authenticator that has been registered with the system
     * for a password.
     * &lt;p&gt;
     * First, if there is a security manager, its {@code checkPermission}
     * method is called with a
     * {@code NetPermission(&quot;requestPasswordAuthentication&quot;)} permission.
     * This may result in a java.lang.SecurityException.
     *
     * @param addr The InetAddress of the site requesting authorization,
     *             or null if not known.
     * @param port the port for the requested connection
     * @param protocol The protocol that's requesting the connection
     *          ({@link java.net.Authenticator#getRequestingProtocol()})
     * @param prompt A prompt string for the user
     * @param scheme The authentication scheme
     *
     * @return The username/password, or null if one can't be gotten.
     *
     * @throws SecurityException
     *        if a security manager exists and its
     *        {@code checkPermission} method doesn't allow
     *        the password authentication request.
     *
     * @see SecurityManager#checkPermission
     * @see java.net.NetPermission
     */
    public static PasswordAuthentication requestPasswordAuthentication(
                                            InetAddress addr,
                                            int port,
                                            String protocol,
                                            String prompt,
                                            String scheme) {

<span class="nc" id="L167">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L169">            NetPermission requestPermission</span>
                = new NetPermission(&quot;requestPasswordAuthentication&quot;);
<span class="nc" id="L171">            sm.checkPermission(requestPermission);</span>
        }

<span class="nc" id="L174">        Authenticator a = theAuthenticator;</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (a == null) {</span>
<span class="nc" id="L176">            return null;</span>
        } else {
<span class="nc" id="L178">            synchronized(a) {</span>
<span class="nc" id="L179">                a.reset();</span>
<span class="nc" id="L180">                a.requestingSite = addr;</span>
<span class="nc" id="L181">                a.requestingPort = port;</span>
<span class="nc" id="L182">                a.requestingProtocol = protocol;</span>
<span class="nc" id="L183">                a.requestingPrompt = prompt;</span>
<span class="nc" id="L184">                a.requestingScheme = scheme;</span>
<span class="nc" id="L185">                return a.getPasswordAuthentication();</span>
<span class="nc" id="L186">            }</span>
        }
    }

    /**
     * Ask the authenticator that has been registered with the system
     * for a password. This is the preferred method for requesting a password
     * because the hostname can be provided in cases where the InetAddress
     * is not available.
     * &lt;p&gt;
     * First, if there is a security manager, its {@code checkPermission}
     * method is called with a
     * {@code NetPermission(&quot;requestPasswordAuthentication&quot;)} permission.
     * This may result in a java.lang.SecurityException.
     *
     * @param host The hostname of the site requesting authentication.
     * @param addr The InetAddress of the site requesting authentication,
     *             or null if not known.
     * @param port the port for the requested connection.
     * @param protocol The protocol that's requesting the connection
     *          ({@link java.net.Authenticator#getRequestingProtocol()})
     * @param prompt A prompt string for the user which identifies the authentication realm.
     * @param scheme The authentication scheme
     *
     * @return The username/password, or null if one can't be gotten.
     *
     * @throws SecurityException
     *        if a security manager exists and its
     *        {@code checkPermission} method doesn't allow
     *        the password authentication request.
     *
     * @see SecurityManager#checkPermission
     * @see java.net.NetPermission
     * @since 1.4
     */
    public static PasswordAuthentication requestPasswordAuthentication(
                                            String host,
                                            InetAddress addr,
                                            int port,
                                            String protocol,
                                            String prompt,
                                            String scheme) {

<span class="nc" id="L229">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L231">            NetPermission requestPermission</span>
                = new NetPermission(&quot;requestPasswordAuthentication&quot;);
<span class="nc" id="L233">            sm.checkPermission(requestPermission);</span>
        }

<span class="nc" id="L236">        Authenticator a = theAuthenticator;</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">        if (a == null) {</span>
<span class="nc" id="L238">            return null;</span>
        } else {
<span class="nc" id="L240">            synchronized(a) {</span>
<span class="nc" id="L241">                a.reset();</span>
<span class="nc" id="L242">                a.requestingHost = host;</span>
<span class="nc" id="L243">                a.requestingSite = addr;</span>
<span class="nc" id="L244">                a.requestingPort = port;</span>
<span class="nc" id="L245">                a.requestingProtocol = protocol;</span>
<span class="nc" id="L246">                a.requestingPrompt = prompt;</span>
<span class="nc" id="L247">                a.requestingScheme = scheme;</span>
<span class="nc" id="L248">                return a.getPasswordAuthentication();</span>
<span class="nc" id="L249">            }</span>
        }
    }

    /**
     * Ask the authenticator that has been registered with the system
     * for a password.
     * &lt;p&gt;
     * First, if there is a security manager, its {@code checkPermission}
     * method is called with a
     * {@code NetPermission(&quot;requestPasswordAuthentication&quot;)} permission.
     * This may result in a java.lang.SecurityException.
     *
     * @param host The hostname of the site requesting authentication.
     * @param addr The InetAddress of the site requesting authorization,
     *             or null if not known.
     * @param port the port for the requested connection
     * @param protocol The protocol that's requesting the connection
     *          ({@link java.net.Authenticator#getRequestingProtocol()})
     * @param prompt A prompt string for the user
     * @param scheme The authentication scheme
     * @param url The requesting URL that caused the authentication
     * @param reqType The type (server or proxy) of the entity requesting
     *              authentication.
     *
     * @return The username/password, or null if one can't be gotten.
     *
     * @throws SecurityException
     *        if a security manager exists and its
     *        {@code checkPermission} method doesn't allow
     *        the password authentication request.
     *
     * @see SecurityManager#checkPermission
     * @see java.net.NetPermission
     *
     * @since 1.5
     */
    public static PasswordAuthentication requestPasswordAuthentication(
                                    String host,
                                    InetAddress addr,
                                    int port,
                                    String protocol,
                                    String prompt,
                                    String scheme,
                                    URL url,
                                    RequestorType reqType) {

<span class="fc" id="L296">        SecurityManager sm = System.getSecurityManager();</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">        if (sm != null) {</span>
<span class="fc" id="L298">            NetPermission requestPermission</span>
                = new NetPermission(&quot;requestPasswordAuthentication&quot;);
<span class="fc" id="L300">            sm.checkPermission(requestPermission);</span>
        }

<span class="fc" id="L303">        Authenticator a = theAuthenticator;</span>
<span class="pc bpc" id="L304" title="1 of 2 branches missed.">        if (a == null) {</span>
<span class="nc" id="L305">            return null;</span>
        } else {
<span class="fc" id="L307">            synchronized(a) {</span>
<span class="fc" id="L308">                a.reset();</span>
<span class="fc" id="L309">                a.requestingHost = host;</span>
<span class="fc" id="L310">                a.requestingSite = addr;</span>
<span class="fc" id="L311">                a.requestingPort = port;</span>
<span class="fc" id="L312">                a.requestingProtocol = protocol;</span>
<span class="fc" id="L313">                a.requestingPrompt = prompt;</span>
<span class="fc" id="L314">                a.requestingScheme = scheme;</span>
<span class="fc" id="L315">                a.requestingURL = url;</span>
<span class="fc" id="L316">                a.requestingAuthType = reqType;</span>
<span class="fc" id="L317">                return a.getPasswordAuthentication();</span>
<span class="nc" id="L318">            }</span>
        }
    }

    /**
     * Gets the {@code hostname} of the
     * site or proxy requesting authentication, or {@code null}
     * if not available.
     *
     * @return the hostname of the connection requiring authentication, or null
     *          if it's not available.
     * @since 1.4
     */
    protected final String getRequestingHost() {
<span class="nc" id="L332">        return requestingHost;</span>
    }

    /**
     * Gets the {@code InetAddress} of the
     * site requesting authorization, or {@code null}
     * if not available.
     *
     * @return the InetAddress of the site requesting authorization, or null
     *          if it's not available.
     */
    protected final InetAddress getRequestingSite() {
<span class="nc" id="L344">        return requestingSite;</span>
    }

    /**
     * Gets the port number for the requested connection.
     * @return an {@code int} indicating the
     * port for the requested connection.
     */
    protected final int getRequestingPort() {
<span class="nc" id="L353">        return requestingPort;</span>
    }

    /**
     * Give the protocol that's requesting the connection.  Often this
     * will be based on a URL, but in a future JDK it could be, for
     * example, &quot;SOCKS&quot; for a password-protected SOCKS5 firewall.
     *
     * @return the protocol, optionally followed by &quot;/version&quot;, where
     *          version is a version number.
     *
     * @see java.net.URL#getProtocol()
     */
    protected final String getRequestingProtocol() {
<span class="nc" id="L367">        return requestingProtocol;</span>
    }

    /**
     * Gets the prompt string given by the requestor.
     *
     * @return the prompt string given by the requestor (realm for
     *          http requests)
     */
    protected final String getRequestingPrompt() {
<span class="fc" id="L377">        return requestingPrompt;</span>
    }

    /**
     * Gets the scheme of the requestor (the HTTP scheme
     * for an HTTP firewall, for example).
     *
     * @return the scheme of the requestor
     *
     */
    protected final String getRequestingScheme() {
<span class="fc" id="L388">        return requestingScheme;</span>
    }

    /**
     * Called when password authorization is needed.  Subclasses should
     * override the default implementation, which returns null.
     * @return The PasswordAuthentication collected from the
     *          user, or null if none is provided.
     */
    protected PasswordAuthentication getPasswordAuthentication() {
<span class="nc" id="L398">        return null;</span>
    }

    /**
     * Returns the URL that resulted in this
     * request for authentication.
     *
     * @since 1.5
     *
     * @return the requesting URL
     *
     */
    protected URL getRequestingURL () {
<span class="fc" id="L411">        return requestingURL;</span>
    }

    /**
     * Returns whether the requestor is a Proxy or a Server.
     *
     * @since 1.5
     *
     * @return the authentication type of the requestor
     *
     */
    protected RequestorType getRequestorType () {
<span class="fc" id="L423">        return requestingAuthType;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>