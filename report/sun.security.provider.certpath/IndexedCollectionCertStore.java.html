<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>IndexedCollectionCertStore.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.security.provider.certpath</a> &gt; <span class="el_source">IndexedCollectionCertStore.java</span></div><h1>IndexedCollectionCertStore.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.security.provider.certpath;

import java.util.*;

import java.security.InvalidAlgorithmParameterException;
import java.security.cert.*;

import javax.security.auth.x500.X500Principal;

/**
 * A &lt;code&gt;CertStore&lt;/code&gt; that retrieves &lt;code&gt;Certificates&lt;/code&gt; and
 * &lt;code&gt;CRL&lt;/code&gt;s from a &lt;code&gt;Collection&lt;/code&gt;.
 * &lt;p&gt;
 * This implementation is functionally equivalent to CollectionCertStore
 * with two differences:
 * &lt;ol&gt;
 * &lt;li&gt;Upon construction, the elements in the specified Collection are
 * partially indexed. X509Certificates are indexed by subject, X509CRLs
 * by issuer, non-X509 Certificates and CRLs are copied without indexing,
 * other objects are ignored. This increases CertStore construction time
 * but allows significant speedups for searches which specify the indexed
 * attributes, in particular for large Collections (reduction from linear
 * time to effectively constant time). Searches for non-indexed queries
 * are as fast (or marginally faster) than for the standard
 * CollectionCertStore. Certificate subjects and CRL issuers
 * were found to be specified in most searches used internally by the
 * CertPath provider. Additional attributes could indexed if there are
 * queries that justify the effort.
 *
 * &lt;li&gt;Changes to the specified Collection after construction time are
 * not detected and ignored. This is because there is no way to efficiently
 * detect if a Collection has been modified, a full traversal would be
 * required. That would degrade lookup performance to linear time and
 * eliminated the benefit of indexing. We may fix this via the introduction
 * of new public APIs in the future.
 * &lt;/ol&gt;
 * &lt;p&gt;
 * Before calling the {@link #engineGetCertificates engineGetCertificates} or
 * {@link #engineGetCRLs engineGetCRLs} methods, the
 * {@link #CollectionCertStore(CertStoreParameters)
 * CollectionCertStore(CertStoreParameters)} constructor is called to
 * create the &lt;code&gt;CertStore&lt;/code&gt; and establish the
 * &lt;code&gt;Collection&lt;/code&gt; from which &lt;code&gt;Certificate&lt;/code&gt;s and
 * &lt;code&gt;CRL&lt;/code&gt;s will be retrieved. If the specified
 * &lt;code&gt;Collection&lt;/code&gt; contains an object that is not a
 * &lt;code&gt;Certificate&lt;/code&gt; or &lt;code&gt;CRL&lt;/code&gt;, that object will be
 * ignored.
 * &lt;p&gt;
 * &lt;b&gt;Concurrent Access&lt;/b&gt;
 * &lt;p&gt;
 * As described in the javadoc for &lt;code&gt;CertStoreSpi&lt;/code&gt;, the
 * &lt;code&gt;engineGetCertificates&lt;/code&gt; and &lt;code&gt;engineGetCRLs&lt;/code&gt; methods
 * must be thread-safe. That is, multiple threads may concurrently
 * invoke these methods on a single &lt;code&gt;CollectionCertStore&lt;/code&gt;
 * object (or more than one) with no ill effects.
 * &lt;p&gt;
 * This is achieved by requiring that the &lt;code&gt;Collection&lt;/code&gt; passed to
 * the {@link #CollectionCertStore(CertStoreParameters)
 * CollectionCertStore(CertStoreParameters)} constructor (via the
 * &lt;code&gt;CollectionCertStoreParameters&lt;/code&gt; object) must have fail-fast
 * iterators. Simultaneous modifications to the &lt;code&gt;Collection&lt;/code&gt; can thus be
 * detected and certificate or CRL retrieval can be retried. The fact that
 * &lt;code&gt;Certificate&lt;/code&gt;s and &lt;code&gt;CRL&lt;/code&gt;s must be thread-safe is also
 * essential.
 *
 * @see java.security.cert.CertStore
 * @see CollectionCertStore
 *
 * @author Andreas Sterbenz
 */
public class IndexedCollectionCertStore extends CertStoreSpi {

    /**
     * Map X500Principal(subject) -&gt; X509Certificate | List of X509Certificate
     */
    private Map&lt;X500Principal, Object&gt; certSubjects;
    /**
     * Map X500Principal(issuer) -&gt; X509CRL | List of X509CRL
     */
    private Map&lt;X500Principal, Object&gt; crlIssuers;
    /**
     * Sets of non-X509 certificates and CRLs
     */
    private Set&lt;Certificate&gt; otherCertificates;
    private Set&lt;CRL&gt; otherCRLs;

    /**
     * Creates a &lt;code&gt;CertStore&lt;/code&gt; with the specified parameters.
     * For this class, the parameters object must be an instance of
     * &lt;code&gt;CollectionCertStoreParameters&lt;/code&gt;.
     *
     * @param params the algorithm parameters
     * @exception InvalidAlgorithmParameterException if params is not an
     *   instance of &lt;code&gt;CollectionCertStoreParameters&lt;/code&gt;
     */
    public IndexedCollectionCertStore(CertStoreParameters params)
            throws InvalidAlgorithmParameterException {
<span class="nc" id="L123">        super(params);</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (!(params instanceof CollectionCertStoreParameters)) {</span>
<span class="nc" id="L125">            throw new InvalidAlgorithmParameterException(</span>
                &quot;parameters must be CollectionCertStoreParameters&quot;);
        }
<span class="nc" id="L128">        Collection&lt;?&gt; coll = ((CollectionCertStoreParameters)params).getCollection();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (coll == null) {</span>
<span class="nc" id="L130">            throw new InvalidAlgorithmParameterException</span>
                                        (&quot;Collection must not be null&quot;);
        }
<span class="nc" id="L133">        buildIndex(coll);</span>
<span class="nc" id="L134">    }</span>

    /**
     * Index the specified Collection copying all references to Certificates
     * and CRLs.
     */
    private void buildIndex(Collection&lt;?&gt; coll) {
<span class="nc" id="L141">        certSubjects = new HashMap&lt;X500Principal, Object&gt;();</span>
<span class="nc" id="L142">        crlIssuers = new HashMap&lt;X500Principal, Object&gt;();</span>
<span class="nc" id="L143">        otherCertificates = null;</span>
<span class="nc" id="L144">        otherCRLs = null;</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">        for (Object obj : coll) {</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (obj instanceof X509Certificate) {</span>
<span class="nc" id="L147">                indexCertificate((X509Certificate)obj);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">            } else if (obj instanceof X509CRL) {</span>
<span class="nc" id="L149">                indexCRL((X509CRL)obj);</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">            } else if (obj instanceof Certificate) {</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">                if (otherCertificates == null) {</span>
<span class="nc" id="L152">                    otherCertificates = new HashSet&lt;Certificate&gt;();</span>
                }
<span class="nc" id="L154">                otherCertificates.add((Certificate)obj);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">            } else if (obj instanceof CRL) {</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">                if (otherCRLs == null) {</span>
<span class="nc" id="L157">                    otherCRLs = new HashSet&lt;CRL&gt;();</span>
                }
<span class="nc" id="L159">                otherCRLs.add((CRL)obj);</span>
            } else {
                // ignore
            }
<span class="nc" id="L163">        }</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (otherCertificates == null) {</span>
<span class="nc" id="L165">            otherCertificates = Collections.&lt;Certificate&gt;emptySet();</span>
        }
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (otherCRLs == null) {</span>
<span class="nc" id="L168">            otherCRLs = Collections.&lt;CRL&gt;emptySet();</span>
        }
<span class="nc" id="L170">    }</span>

    /**
     * Add an X509Certificate to the index.
     */
    private void indexCertificate(X509Certificate cert) {
<span class="nc" id="L176">        X500Principal subject = cert.getSubjectX500Principal();</span>
<span class="nc" id="L177">        Object oldEntry = certSubjects.put(subject, cert);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (oldEntry != null) { // assume this is unlikely</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">            if (oldEntry instanceof X509Certificate) {</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">                if (cert.equals(oldEntry)) {</span>
<span class="nc" id="L181">                    return;</span>
                }
<span class="nc" id="L183">                List&lt;X509Certificate&gt; list = new ArrayList&lt;&gt;(2);</span>
<span class="nc" id="L184">                list.add(cert);</span>
<span class="nc" id="L185">                list.add((X509Certificate)oldEntry);</span>
<span class="nc" id="L186">                certSubjects.put(subject, list);</span>
<span class="nc" id="L187">            } else {</span>
                @SuppressWarnings(&quot;unchecked&quot;) // See certSubjects javadoc.
<span class="nc" id="L189">                List&lt;X509Certificate&gt; list = (List&lt;X509Certificate&gt;)oldEntry;</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">                if (list.contains(cert) == false) {</span>
<span class="nc" id="L191">                    list.add(cert);</span>
                }
<span class="nc" id="L193">                certSubjects.put(subject, list);</span>
            }
        }
<span class="nc" id="L196">    }</span>

    /**
     * Add an X509CRL to the index.
     */
    private void indexCRL(X509CRL crl) {
<span class="nc" id="L202">        X500Principal issuer = crl.getIssuerX500Principal();</span>
<span class="nc" id="L203">        Object oldEntry = crlIssuers.put(issuer, crl);</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">        if (oldEntry != null) { // assume this is unlikely</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">            if (oldEntry instanceof X509CRL) {</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">                if (crl.equals(oldEntry)) {</span>
<span class="nc" id="L207">                    return;</span>
                }
<span class="nc" id="L209">                List&lt;X509CRL&gt; list = new ArrayList&lt;&gt;(2);</span>
<span class="nc" id="L210">                list.add(crl);</span>
<span class="nc" id="L211">                list.add((X509CRL)oldEntry);</span>
<span class="nc" id="L212">                crlIssuers.put(issuer, list);</span>
<span class="nc" id="L213">            } else {</span>
                // See crlIssuers javadoc.
                @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L216">                List&lt;X509CRL&gt; list = (List&lt;X509CRL&gt;)oldEntry;</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">                if (list.contains(crl) == false) {</span>
<span class="nc" id="L218">                    list.add(crl);</span>
                }
<span class="nc" id="L220">                crlIssuers.put(issuer, list);</span>
            }
        }
<span class="nc" id="L223">    }</span>

    /**
     * Returns a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;Certificate&lt;/code&gt;s that
     * match the specified selector. If no &lt;code&gt;Certificate&lt;/code&gt;s
     * match the selector, an empty &lt;code&gt;Collection&lt;/code&gt; will be returned.
     *
     * @param selector a &lt;code&gt;CertSelector&lt;/code&gt; used to select which
     *  &lt;code&gt;Certificate&lt;/code&gt;s should be returned. Specify &lt;code&gt;null&lt;/code&gt;
     *  to return all &lt;code&gt;Certificate&lt;/code&gt;s.
     * @return a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;Certificate&lt;/code&gt;s that
     *         match the specified selector
     * @throws CertStoreException if an exception occurs
     */
    @Override
    public Collection&lt;? extends Certificate&gt; engineGetCertificates(CertSelector selector)
            throws CertStoreException {

        // no selector means match all
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (selector == null) {</span>
<span class="nc" id="L243">            Set&lt;Certificate&gt; matches = new HashSet&lt;&gt;();</span>
<span class="nc" id="L244">            matchX509Certs(new X509CertSelector(), matches);</span>
<span class="nc" id="L245">            matches.addAll(otherCertificates);</span>
<span class="nc" id="L246">            return matches;</span>
        }

<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (selector instanceof X509CertSelector == false) {</span>
<span class="nc" id="L250">            Set&lt;Certificate&gt; matches = new HashSet&lt;&gt;();</span>
<span class="nc" id="L251">            matchX509Certs(selector, matches);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">            for (Certificate cert : otherCertificates) {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                if (selector.match(cert)) {</span>
<span class="nc" id="L254">                    matches.add(cert);</span>
                }
<span class="nc" id="L256">            }</span>
<span class="nc" id="L257">            return matches;</span>
        }

<span class="nc bnc" id="L260" title="All 2 branches missed.">        if (certSubjects.isEmpty()) {</span>
<span class="nc" id="L261">            return Collections.&lt;X509Certificate&gt;emptySet();</span>
        }
<span class="nc" id="L263">        X509CertSelector x509Selector = (X509CertSelector)selector;</span>
        // see if the subject is specified
        X500Principal subject;
<span class="nc" id="L266">        X509Certificate matchCert = x509Selector.getCertificate();</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (matchCert != null) {</span>
<span class="nc" id="L268">            subject = matchCert.getSubjectX500Principal();</span>
        } else {
<span class="nc" id="L270">            subject = x509Selector.getSubject();</span>
        }
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (subject != null) {</span>
            // yes, narrow down candidates to indexed possibilities
<span class="nc" id="L274">            Object entry = certSubjects.get(subject);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">            if (entry == null) {</span>
<span class="nc" id="L276">                return Collections.&lt;X509Certificate&gt;emptySet();</span>
            }
<span class="nc bnc" id="L278" title="All 2 branches missed.">            if (entry instanceof X509Certificate) {</span>
<span class="nc" id="L279">                X509Certificate x509Entry = (X509Certificate)entry;</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">                if (x509Selector.match(x509Entry)) {</span>
<span class="nc" id="L281">                    return Collections.singleton(x509Entry);</span>
                } else {
<span class="nc" id="L283">                    return Collections.&lt;X509Certificate&gt;emptySet();</span>
                }
            } else {
                // See certSubjects javadoc.
                @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L288">                List&lt;X509Certificate&gt; list = (List&lt;X509Certificate&gt;)entry;</span>
<span class="nc" id="L289">                Set&lt;X509Certificate&gt; matches = new HashSet&lt;&gt;(16);</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                for (X509Certificate cert : list) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">                    if (x509Selector.match(cert)) {</span>
<span class="nc" id="L292">                        matches.add(cert);</span>
                    }
<span class="nc" id="L294">                }</span>
<span class="nc" id="L295">                return matches;</span>
            }
        }
        // cannot use index, iterate all
<span class="nc" id="L299">        Set&lt;Certificate&gt; matches = new HashSet&lt;&gt;(16);</span>
<span class="nc" id="L300">        matchX509Certs(x509Selector, matches);</span>
<span class="nc" id="L301">        return matches;</span>
    }

    /**
     * Iterate through all the X509Certificates and add matches to the
     * collection.
     */
    private void matchX509Certs(CertSelector selector,
        Collection&lt;Certificate&gt; matches) {

<span class="nc bnc" id="L311" title="All 2 branches missed.">        for (Object obj : certSubjects.values()) {</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">            if (obj instanceof X509Certificate) {</span>
<span class="nc" id="L313">                X509Certificate cert = (X509Certificate)obj;</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                if (selector.match(cert)) {</span>
<span class="nc" id="L315">                    matches.add(cert);</span>
                }
<span class="nc" id="L317">            } else {</span>
                // See certSubjects javadoc.
                @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L320">                List&lt;X509Certificate&gt; list = (List&lt;X509Certificate&gt;)obj;</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                for (X509Certificate cert : list) {</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">                    if (selector.match(cert)) {</span>
<span class="nc" id="L323">                        matches.add(cert);</span>
                    }
<span class="nc" id="L325">                }</span>
            }
<span class="nc" id="L327">        }</span>
<span class="nc" id="L328">    }</span>

    /**
     * Returns a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;CRL&lt;/code&gt;s that
     * match the specified selector. If no &lt;code&gt;CRL&lt;/code&gt;s
     * match the selector, an empty &lt;code&gt;Collection&lt;/code&gt; will be returned.
     *
     * @param selector a &lt;code&gt;CRLSelector&lt;/code&gt; used to select which
     *  &lt;code&gt;CRL&lt;/code&gt;s should be returned. Specify &lt;code&gt;null&lt;/code&gt;
     *  to return all &lt;code&gt;CRL&lt;/code&gt;s.
     * @return a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;CRL&lt;/code&gt;s that
     *         match the specified selector
     * @throws CertStoreException if an exception occurs
     */
    @Override
    public Collection&lt;CRL&gt; engineGetCRLs(CRLSelector selector)
            throws CertStoreException {

<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (selector == null) {</span>
<span class="nc" id="L347">            Set&lt;CRL&gt; matches = new HashSet&lt;&gt;();</span>
<span class="nc" id="L348">            matchX509CRLs(new X509CRLSelector(), matches);</span>
<span class="nc" id="L349">            matches.addAll(otherCRLs);</span>
<span class="nc" id="L350">            return matches;</span>
        }

<span class="nc bnc" id="L353" title="All 2 branches missed.">        if (selector instanceof X509CRLSelector == false) {</span>
<span class="nc" id="L354">            Set&lt;CRL&gt; matches = new HashSet&lt;&gt;();</span>
<span class="nc" id="L355">            matchX509CRLs(selector, matches);</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">            for (CRL crl : otherCRLs) {</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                if (selector.match(crl)) {</span>
<span class="nc" id="L358">                    matches.add(crl);</span>
                }
<span class="nc" id="L360">            }</span>
<span class="nc" id="L361">            return matches;</span>
        }

<span class="nc bnc" id="L364" title="All 2 branches missed.">        if (crlIssuers.isEmpty()) {</span>
<span class="nc" id="L365">            return Collections.&lt;CRL&gt;emptySet();</span>
        }
<span class="nc" id="L367">        X509CRLSelector x509Selector = (X509CRLSelector)selector;</span>
        // see if the issuer is specified
<span class="nc" id="L369">        Collection&lt;X500Principal&gt; issuers = x509Selector.getIssuers();</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (issuers != null) {</span>
<span class="nc" id="L371">            HashSet&lt;CRL&gt; matches = new HashSet&lt;&gt;(16);</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">            for (X500Principal issuer : issuers) {</span>
<span class="nc" id="L373">                Object entry = crlIssuers.get(issuer);</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">                if (entry == null) {</span>
                    // empty
<span class="nc bnc" id="L376" title="All 2 branches missed.">                } else if (entry instanceof X509CRL) {</span>
<span class="nc" id="L377">                    X509CRL crl = (X509CRL)entry;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">                    if (x509Selector.match(crl)) {</span>
<span class="nc" id="L379">                        matches.add(crl);</span>
                    }
<span class="nc" id="L381">                } else { // List</span>
                    // See crlIssuers javadoc.
                    @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L384">                    List&lt;X509CRL&gt; list = (List&lt;X509CRL&gt;)entry;</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">                    for (X509CRL crl : list) {</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">                        if (x509Selector.match(crl)) {</span>
<span class="nc" id="L387">                            matches.add(crl);</span>
                        }
<span class="nc" id="L389">                    }</span>
                }
<span class="nc" id="L391">            }</span>
<span class="nc" id="L392">            return matches;</span>
        }
        // cannot use index, iterate all
<span class="nc" id="L395">        Set&lt;CRL&gt; matches = new HashSet&lt;&gt;(16);</span>
<span class="nc" id="L396">        matchX509CRLs(x509Selector, matches);</span>
<span class="nc" id="L397">        return matches;</span>
    }

    /**
     * Iterate through all the X509CRLs and add matches to the
     * collection.
     */
    private void matchX509CRLs(CRLSelector selector, Collection&lt;CRL&gt; matches) {
<span class="nc bnc" id="L405" title="All 2 branches missed.">        for (Object obj : crlIssuers.values()) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">            if (obj instanceof X509CRL) {</span>
<span class="nc" id="L407">                X509CRL crl = (X509CRL)obj;</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">                if (selector.match(crl)) {</span>
<span class="nc" id="L409">                    matches.add(crl);</span>
                }
<span class="nc" id="L411">            } else {</span>
                // See crlIssuers javadoc.
                @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L414">                List&lt;X509CRL&gt; list = (List&lt;X509CRL&gt;)obj;</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">                for (X509CRL crl : list) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">                    if (selector.match(crl)) {</span>
<span class="nc" id="L417">                        matches.add(crl);</span>
                    }
<span class="nc" id="L419">                }</span>
            }
<span class="nc" id="L421">        }</span>
<span class="nc" id="L422">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>