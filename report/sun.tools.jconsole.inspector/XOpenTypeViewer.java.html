<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>XOpenTypeViewer.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.tools.jconsole.inspector</a> &gt; <span class="el_source">XOpenTypeViewer.java</span></div><h1>XOpenTypeViewer.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2004, 2012, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.tools.jconsole.inspector;

import javax.swing.*;
import javax.swing.event.*;
import javax.swing.table.*;
import java.awt.BorderLayout;
import java.awt.FlowLayout;
import java.awt.Component;
import java.awt.Color;
import java.awt.Font;
import java.awt.event.*;
import java.awt.Dimension;
import java.util.*;
import java.lang.reflect.Array;

import javax.management.openmbean.*;

import sun.tools.jconsole.JConsole;
import sun.tools.jconsole.Messages;
import sun.tools.jconsole.Resources;

@SuppressWarnings(&quot;serial&quot;)
public class XOpenTypeViewer extends JPanel implements ActionListener {
    JButton prev, incr, decr, tabularPrev, tabularNext;
    JLabel compositeLabel, tabularLabel;
    JScrollPane container;
    XOpenTypeData current;
<span class="nc" id="L53">    XOpenTypeDataListener listener = new XOpenTypeDataListener();</span>

<span class="nc" id="L55">    private static final String compositeNavigationSingle =</span>
            Messages.MBEANS_TAB_COMPOSITE_NAVIGATION_SINGLE;
<span class="nc" id="L57">    private static final String tabularNavigationSingle =</span>
            Messages.MBEANS_TAB_TABULAR_NAVIGATION_SINGLE;

<span class="nc" id="L60">    private static TableCellEditor editor =</span>
            new Utils.ReadOnlyTableCellEditor(new JTextField());

    class XOpenTypeDataListener extends MouseAdapter {
<span class="nc" id="L64">        XOpenTypeDataListener() {</span>
<span class="nc" id="L65">        }</span>

        public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L68" title="All 2 branches missed.">            if(e.getButton() == MouseEvent.BUTTON1) {</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">                if(e.getClickCount() &gt;= 2) {</span>
<span class="nc" id="L70">                    XOpenTypeData elem = getSelectedViewedOpenType();</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">                    if(elem != null) {</span>
                        try {
<span class="nc" id="L73">                            elem.viewed(XOpenTypeViewer.this);</span>
<span class="nc" id="L74">                        }catch(Exception ex) {</span>
                            //Nothing to change, the element
                            //can't be displayed
<span class="nc" id="L77">                        }</span>
                    }
                }
            }
<span class="nc" id="L81">        }</span>

        private XOpenTypeData getSelectedViewedOpenType() {
<span class="nc" id="L84">            int row = XOpenTypeViewer.this.current.getSelectedRow();</span>
<span class="nc" id="L85">            int col = XOpenTypeViewer.this.current.getSelectedColumn();</span>
<span class="nc" id="L86">            Object elem =</span>
<span class="nc" id="L87">                    XOpenTypeViewer.this.current.getModel().getValueAt(row, col);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">            if(elem instanceof XOpenTypeData)</span>
<span class="nc" id="L89">                return (XOpenTypeData) elem;</span>
            else
<span class="nc" id="L91">                return null;</span>
        }
    }

    static interface Navigatable {
        public void incrElement();
        public void decrElement();
        public boolean canDecrement();
        public boolean canIncrement();
        public int getElementCount();
        public int getSelectedElementIndex();
    }

    static interface XViewedTabularData extends Navigatable {
    }

    static interface XViewedArrayData extends Navigatable {
    }

    static abstract class XOpenTypeData extends JTable {
        XOpenTypeData parent;
<span class="nc" id="L112">        protected int col1Width = -1;</span>
<span class="nc" id="L113">        protected int col2Width = -1;</span>
        private boolean init;
        private Font normalFont, boldFont;
<span class="nc" id="L116">        protected XOpenTypeData(XOpenTypeData parent) {</span>
<span class="nc" id="L117">            this.parent = parent;</span>
<span class="nc" id="L118">        }</span>

        public XOpenTypeData getViewedParent() {
<span class="nc" id="L121">            return parent;</span>
        }

        public String getToolTip(int row, int col) {
<span class="nc bnc" id="L125" title="All 2 branches missed.">            if(col == 1) {</span>
<span class="nc" id="L126">                Object value = getModel().getValueAt(row, col);</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">                if (value != null) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                    if(isClickableElement(value))</span>
<span class="nc" id="L129">                        return Messages.DOUBLE_CLICK_TO_VISUALIZE</span>
<span class="nc" id="L130">                        + &quot;. &quot; + value.toString();</span>
                    else
<span class="nc" id="L132">                        return value.toString();</span>
                }
            }
<span class="nc" id="L135">            return null;</span>
        }

        public TableCellRenderer getCellRenderer(int row, int column) {
<span class="nc" id="L139">            DefaultTableCellRenderer tcr =</span>
<span class="nc" id="L140">                    (DefaultTableCellRenderer)super.getCellRenderer(row,column);</span>
<span class="nc" id="L141">            tcr.setToolTipText(getToolTip(row,column));</span>
<span class="nc" id="L142">            return tcr;</span>
        }

        public void renderKey(String key,  Component comp) {
<span class="nc" id="L146">            comp.setFont(normalFont);</span>
<span class="nc" id="L147">        }</span>

        public Component prepareRenderer(TableCellRenderer renderer,
                int row, int column) {
<span class="nc" id="L151">            Component comp = super.prepareRenderer(renderer, row, column);</span>

<span class="nc bnc" id="L153" title="All 2 branches missed.">            if (normalFont == null) {</span>
<span class="nc" id="L154">                normalFont = comp.getFont();</span>
<span class="nc" id="L155">                boldFont = normalFont.deriveFont(Font.BOLD);</span>
            }

<span class="nc" id="L158">            Object o = ((DefaultTableModel) getModel()).getValueAt(row, column);</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">            if (column == 0) {</span>
<span class="nc" id="L160">                String key = o.toString();</span>
<span class="nc" id="L161">                renderKey(key, comp);</span>
<span class="nc" id="L162">            } else {</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">                if (isClickableElement(o)) {</span>
<span class="nc" id="L164">                    comp.setFont(boldFont);</span>
                } else {
<span class="nc" id="L166">                    comp.setFont(normalFont);</span>
                }
            }

<span class="nc" id="L170">            return comp;</span>
        }

        protected boolean isClickableElement(Object obj) {
<span class="nc bnc" id="L174" title="All 2 branches missed.">            if (obj instanceof XOpenTypeData) {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">                if (obj instanceof Navigatable) {</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">                    return (((Navigatable) obj).getElementCount() != 0);</span>
                } else {
<span class="nc" id="L178">                    return (obj instanceof XCompositeData);</span>
                }
            }
<span class="nc" id="L181">            return false;</span>
        }

        protected void updateColumnWidth() {
<span class="nc bnc" id="L185" title="All 2 branches missed.">            if (!init) {</span>
<span class="nc" id="L186">                TableColumnModel colModel = getColumnModel();</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">                if (col2Width == -1) {</span>
<span class="nc" id="L188">                    col1Width = col1Width * 7;</span>
<span class="nc" id="L189">                    if (col1Width &lt;</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">                            getPreferredScrollableViewportSize().getWidth()) {</span>
<span class="nc" id="L191">                        col1Width = (int)</span>
<span class="nc" id="L192">                        getPreferredScrollableViewportSize().getWidth();</span>
                    }
<span class="nc" id="L194">                    colModel.getColumn(0).setPreferredWidth(col1Width);</span>
<span class="nc" id="L195">                    init = true;</span>
<span class="nc" id="L196">                    return;</span>
                }
<span class="nc" id="L198">                col1Width = (col1Width * 7) + 7;</span>
<span class="nc" id="L199">                col1Width = Math.max(col1Width, 70);</span>
<span class="nc" id="L200">                col2Width = (col2Width * 7) + 7;</span>
<span class="nc" id="L201">                if (col1Width + col2Width &lt;</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                        getPreferredScrollableViewportSize().getWidth()) {</span>
<span class="nc" id="L203">                    col2Width = (int)</span>
<span class="nc" id="L204">                    getPreferredScrollableViewportSize().getWidth() -</span>
                            col1Width;
                }
<span class="nc" id="L207">                colModel.getColumn(0).setPreferredWidth(col1Width);</span>
<span class="nc" id="L208">                colModel.getColumn(1).setPreferredWidth(col2Width);</span>
<span class="nc" id="L209">                init = true;</span>
            }
<span class="nc" id="L211">        }</span>

        public abstract void viewed(XOpenTypeViewer viewer) throws Exception;

        protected void initTable(String[] columnNames) {
<span class="nc" id="L216">            setRowSelectionAllowed(false);</span>
<span class="nc" id="L217">            setColumnSelectionAllowed(false);</span>
<span class="nc" id="L218">            getTableHeader().setReorderingAllowed(false);</span>
<span class="nc" id="L219">            ((DefaultTableModel) getModel()).setColumnIdentifiers(columnNames);</span>
<span class="nc" id="L220">            for (Enumeration&lt;TableColumn&gt; e = getColumnModel().getColumns();</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">            e.hasMoreElements();) {</span>
<span class="nc" id="L222">                TableColumn tc = e.nextElement();</span>
<span class="nc" id="L223">                tc.setCellEditor(editor);</span>
<span class="nc" id="L224">            }</span>
<span class="nc" id="L225">            addKeyListener(new Utils.CopyKeyAdapter());</span>
<span class="nc" id="L226">            setAutoResizeMode(JTable.AUTO_RESIZE_SUBSEQUENT_COLUMNS);</span>
<span class="nc" id="L227">            setPreferredScrollableViewportSize(new Dimension(350, 200));</span>
<span class="nc" id="L228">        }</span>

        protected void emptyTable() {
<span class="nc" id="L231">            invalidate();</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">            while (getModel().getRowCount()&gt;0)</span>
<span class="nc" id="L233">                ((DefaultTableModel) getModel()).removeRow(0);</span>
<span class="nc" id="L234">            validate();</span>
<span class="nc" id="L235">        }</span>

        public void setValueAt(Object value, int row, int col) {
<span class="nc" id="L238">        }</span>
    }

    static class TabularDataComparator implements Comparator&lt;CompositeData&gt; {

        private final List&lt;String&gt; indexNames;

<span class="nc" id="L245">        public TabularDataComparator(TabularType type) {</span>
<span class="nc" id="L246">            indexNames = type.getIndexNames();</span>
<span class="nc" id="L247">        }</span>

        @SuppressWarnings(&quot;unchecked&quot;)
        public int compare(CompositeData o1, CompositeData o2) {
<span class="nc bnc" id="L251" title="All 2 branches missed.">            for (String key : indexNames) {</span>
<span class="nc" id="L252">                Object c1 = o1.get(key);</span>
<span class="nc" id="L253">                Object c2 = o2.get(key);</span>
<span class="nc bnc" id="L254" title="All 4 branches missed.">                if (c1 instanceof Comparable &amp;&amp; c2 instanceof Comparable) {</span>
<span class="nc" id="L255">                    int result = ((Comparable&lt;Object&gt;) c1).compareTo(c2);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">                    if (result != 0)</span>
<span class="nc" id="L257">                        return result;</span>
                }
<span class="nc" id="L259">            }</span>
<span class="nc" id="L260">            return 0;</span>
        }
    }

    static class XTabularData extends XCompositeData
            implements XViewedTabularData {

        final TabularData tabular;
        final TabularType type;
<span class="nc" id="L269">        int currentIndex = 0;</span>
        final Object[] elements;
        final int size;
        private Font normalFont, italicFont;

        @SuppressWarnings(&quot;unchecked&quot;)
        public XTabularData(XOpenTypeData parent, TabularData tabular) {
<span class="nc" id="L276">            super(parent, accessFirstElement(tabular));</span>
<span class="nc" id="L277">            this.tabular = tabular;</span>
<span class="nc" id="L278">            type = tabular.getTabularType();</span>
<span class="nc" id="L279">            size = tabular.values().size();</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">            if (size &gt; 0) {</span>
                // Order tabular data elements using index names
<span class="nc" id="L282">                List&lt;CompositeData&gt; data = new ArrayList&lt;CompositeData&gt;(</span>
<span class="nc" id="L283">                        (Collection&lt;CompositeData&gt;) tabular.values());</span>
<span class="nc" id="L284">                Collections.sort(data, new TabularDataComparator(type));</span>
<span class="nc" id="L285">                elements = data.toArray();</span>
<span class="nc" id="L286">                loadCompositeData((CompositeData) elements[0]);</span>
<span class="nc" id="L287">            } else {</span>
<span class="nc" id="L288">                elements = new Object[0];</span>
            }
<span class="nc" id="L290">        }</span>

        private static CompositeData accessFirstElement(TabularData tabular) {
<span class="nc bnc" id="L293" title="All 2 branches missed.">            if(tabular.values().size() == 0) return null;</span>
<span class="nc" id="L294">            return (CompositeData) tabular.values().toArray()[0];</span>
        }

        public void renderKey(String key,  Component comp) {
<span class="nc bnc" id="L298" title="All 2 branches missed.">            if (normalFont == null) {</span>
<span class="nc" id="L299">                normalFont = comp.getFont();</span>
<span class="nc" id="L300">                italicFont = normalFont.deriveFont(Font.ITALIC);</span>
            }
<span class="nc bnc" id="L302" title="All 2 branches missed.">            for(Object k : type.getIndexNames()) {</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">                if(key.equals(k))</span>
<span class="nc" id="L304">                    comp.setFont(italicFont);</span>
<span class="nc" id="L305">            }</span>
<span class="nc" id="L306">        }</span>

        public int getElementCount() {
<span class="nc" id="L309">            return size;</span>
        }

        public int getSelectedElementIndex() {
<span class="nc" id="L313">            return currentIndex;</span>
        }

        public void incrElement() {
<span class="nc" id="L317">            currentIndex++;</span>
<span class="nc" id="L318">            loadCompositeData((CompositeData)elements[currentIndex]);</span>
<span class="nc" id="L319">        }</span>

        public void decrElement() {
<span class="nc" id="L322">            currentIndex--;</span>
<span class="nc" id="L323">            loadCompositeData((CompositeData)elements[currentIndex]);</span>
<span class="nc" id="L324">        }</span>

        public boolean canDecrement() {
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if(currentIndex == 0)</span>
<span class="nc" id="L328">                return false;</span>
            else
<span class="nc" id="L330">                return true;</span>
        }

        public boolean canIncrement(){
<span class="nc bnc" id="L334" title="All 4 branches missed.">            if(size == 0 ||</span>
                    currentIndex == size -1)
<span class="nc" id="L336">                return false;</span>
            else
<span class="nc" id="L338">                return true;</span>
        }

        public String toString() {
<span class="nc bnc" id="L342" title="All 2 branches missed.">            return type == null ? &quot;&quot; : type.getDescription();</span>
        }
    }

    static class XCompositeData extends XOpenTypeData {
<span class="nc" id="L347">        protected final String[] columnNames = {</span>
            Messages.NAME, Messages.VALUE
        };
        CompositeData composite;

        public XCompositeData() {
<span class="nc" id="L353">            super(null);</span>
<span class="nc" id="L354">            initTable(columnNames);</span>
<span class="nc" id="L355">        }</span>

        //In sync with array, no init table.
        public XCompositeData(XOpenTypeData parent) {
<span class="nc" id="L359">            super(parent);</span>
<span class="nc" id="L360">        }</span>

        public XCompositeData(XOpenTypeData parent,
                CompositeData composite) {
<span class="nc" id="L364">            super(parent);</span>
<span class="nc" id="L365">            initTable(columnNames);</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">            if(composite != null) {</span>
<span class="nc" id="L367">                this.composite = composite;</span>
<span class="nc" id="L368">                loadCompositeData(composite);</span>
            }
<span class="nc" id="L370">        }</span>

        public void viewed(XOpenTypeViewer viewer) throws Exception {
<span class="nc" id="L373">            viewer.setOpenType(this);</span>
<span class="nc" id="L374">            updateColumnWidth();</span>
<span class="nc" id="L375">        }</span>

        public String toString() {
<span class="nc bnc" id="L378" title="All 2 branches missed.">            return composite == null ? &quot;&quot; :</span>
<span class="nc" id="L379">                composite.getCompositeType().getTypeName();</span>
        }

        protected Object formatKey(String key) {
<span class="nc" id="L383">            return key;</span>
        }

        private void load(CompositeData data) {
<span class="nc" id="L387">            CompositeType type = data.getCompositeType();</span>
<span class="nc" id="L388">            Set&lt;String&gt; keys = type.keySet();</span>
<span class="nc" id="L389">            Iterator&lt;String&gt; it = keys.iterator();</span>
<span class="nc" id="L390">            Object[] rowData = new Object[2];</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">            while (it.hasNext()) {</span>
<span class="nc" id="L392">                String key = (String) it.next();</span>
<span class="nc" id="L393">                Object val = data.get(key);</span>
<span class="nc" id="L394">                rowData[0] = formatKey(key);</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (val == null) {</span>
<span class="nc" id="L396">                    rowData[1] = &quot;&quot;;</span>
                } else {
<span class="nc" id="L398">                    OpenType&lt;?&gt; openType = type.getType(key);</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">                    if (openType instanceof CompositeType) {</span>
<span class="nc" id="L400">                        rowData[1] =</span>
                                new XCompositeData(this, (CompositeData) val);
<span class="nc bnc" id="L402" title="All 2 branches missed.">                    } else if (openType instanceof ArrayType) {</span>
<span class="nc" id="L403">                        rowData[1] =</span>
                                new XArrayData(this, (ArrayType&lt;?&gt;) openType, val);
<span class="nc bnc" id="L405" title="All 2 branches missed.">                    } else if (openType instanceof SimpleType) {</span>
<span class="nc" id="L406">                        rowData[1] = val;</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                    } else if (openType instanceof TabularType) {</span>
<span class="nc" id="L408">                        rowData[1] = new XTabularData(this, (TabularData) val);</span>
                    }
                }
                // Update column width
<span class="nc" id="L412">                String str = null;</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">                if (rowData[0] != null) {</span>
<span class="nc" id="L414">                    str = rowData[0].toString();</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">                    if (str.length() &gt; col1Width) {</span>
<span class="nc" id="L416">                        col1Width = str.length();</span>
                    }
                }
<span class="nc bnc" id="L419" title="All 2 branches missed.">                if (rowData[1] != null) {</span>
<span class="nc" id="L420">                    str = rowData[1].toString();</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">                    if (str.length() &gt; col2Width) {</span>
<span class="nc" id="L422">                        col2Width = str.length();</span>
                    }
                }
<span class="nc" id="L425">                ((DefaultTableModel) getModel()).addRow(rowData);</span>
<span class="nc" id="L426">            }</span>
<span class="nc" id="L427">        }</span>

        protected void loadCompositeData(CompositeData data) {
<span class="nc" id="L430">            composite = data;</span>
<span class="nc" id="L431">            emptyTable();</span>
<span class="nc" id="L432">            load(data);</span>
<span class="nc" id="L433">            DefaultTableModel tableModel = (DefaultTableModel) getModel();</span>
<span class="nc" id="L434">            tableModel.newDataAvailable(new TableModelEvent(tableModel));</span>
<span class="nc" id="L435">        }</span>
    }

    static class XArrayData extends XCompositeData
            implements XViewedArrayData {

        private int dimension;
        private int size;
        private OpenType&lt;?&gt; elemType;
        private Object val;
        private boolean isCompositeType;
        private boolean isTabularType;
        private int currentIndex;
        private CompositeData[] elements;
<span class="nc" id="L449">        private final String[] arrayColumns = {Messages.VALUE};</span>
        private Font normalFont, boldFont;

        XArrayData(XOpenTypeData parent, ArrayType&lt;?&gt; type, Object val) {
<span class="nc" id="L453">            this(parent, type.getDimension(), type.getElementOpenType(), val);</span>
<span class="nc" id="L454">        }</span>

        XArrayData(XOpenTypeData parent, int dimension,
                OpenType&lt;?&gt; elemType, Object val) {
<span class="nc" id="L458">            super(parent);</span>
<span class="nc" id="L459">            this.dimension = dimension;</span>
<span class="nc" id="L460">            this.elemType = elemType;</span>
<span class="nc" id="L461">            this.val = val;</span>
<span class="nc" id="L462">            String[] columns = null;</span>

<span class="nc bnc" id="L464" title="All 2 branches missed.">            if (dimension &gt; 1) return;</span>

<span class="nc" id="L466">            isCompositeType = (elemType instanceof CompositeType);</span>
<span class="nc" id="L467">            isTabularType = (elemType instanceof TabularType);</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">            columns = isCompositeType ? columnNames : arrayColumns;</span>

<span class="nc" id="L470">            initTable(columns);</span>
<span class="nc" id="L471">            loadArray();</span>
<span class="nc" id="L472">        }</span>

        public void viewed(XOpenTypeViewer viewer) throws Exception {
<span class="nc bnc" id="L475" title="All 2 branches missed.">            if (size == 0)</span>
<span class="nc" id="L476">                throw new Exception(Messages.EMPTY_ARRAY);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">            if (dimension &gt; 1)</span>
<span class="nc" id="L478">                throw new Exception(Messages.DIMENSION_IS_NOT_SUPPORTED_COLON +</span>
                        dimension);
<span class="nc" id="L480">            super.viewed(viewer);</span>
<span class="nc" id="L481">        }</span>

        public int getElementCount() {
<span class="nc" id="L484">            return size;</span>
        }

        public int getSelectedElementIndex() {
<span class="nc" id="L488">            return currentIndex;</span>
        }

        public void renderKey(String key,  Component comp) {
<span class="nc bnc" id="L492" title="All 2 branches missed.">            if (normalFont == null) {</span>
<span class="nc" id="L493">                normalFont = comp.getFont();</span>
<span class="nc" id="L494">                boldFont = normalFont.deriveFont(Font.BOLD);</span>
            }
<span class="nc bnc" id="L496" title="All 2 branches missed.">            if (isTabularType) {</span>
<span class="nc" id="L497">                comp.setFont(boldFont);</span>
            }
<span class="nc" id="L499">        }</span>

        public void incrElement() {
<span class="nc" id="L502">            currentIndex++;</span>
<span class="nc" id="L503">            loadCompositeData(elements[currentIndex]);</span>
<span class="nc" id="L504">        }</span>

        public void decrElement() {
<span class="nc" id="L507">            currentIndex--;</span>
<span class="nc" id="L508">            loadCompositeData(elements[currentIndex]);</span>
<span class="nc" id="L509">        }</span>

        public boolean canDecrement() {
<span class="nc bnc" id="L512" title="All 4 branches missed.">            if (isCompositeType &amp;&amp; currentIndex &gt; 0) {</span>
<span class="nc" id="L513">                return true;</span>
            }
<span class="nc" id="L515">            return false;</span>
        }

        public boolean canIncrement() {
<span class="nc bnc" id="L519" title="All 4 branches missed.">            if (isCompositeType &amp;&amp; currentIndex &lt; size - 1) {</span>
<span class="nc" id="L520">                return true;</span>
            }
<span class="nc" id="L522">            return false;</span>
        }

        private void loadArray() {
<span class="nc bnc" id="L526" title="All 2 branches missed.">            if (isCompositeType) {</span>
<span class="nc" id="L527">                elements = (CompositeData[]) val;</span>
<span class="nc" id="L528">                size = elements.length;</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">                if (size != 0) {</span>
<span class="nc" id="L530">                    loadCompositeData(elements[0]);</span>
                }
            } else {
<span class="nc" id="L533">                load();</span>
            }
<span class="nc" id="L535">        }</span>

        private void load() {
<span class="nc" id="L538">            Object[] rowData = new Object[1];</span>
<span class="nc" id="L539">            size = Array.getLength(val);</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">            for (int i = 0; i &lt; size; i++) {</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">                rowData[0] = isTabularType ?</span>
<span class="nc" id="L542">                    new XTabularData(this, (TabularData) Array.get(val, i)) :</span>
<span class="nc" id="L543">                    Array.get(val, i);</span>
<span class="nc" id="L544">                String str = rowData[0].toString();</span>
<span class="nc bnc" id="L545" title="All 2 branches missed.">                if (str.length() &gt; col1Width) {</span>
<span class="nc" id="L546">                    col1Width = str.length();</span>
                }
<span class="nc" id="L548">                ((DefaultTableModel) getModel()).addRow(rowData);</span>
            }
<span class="nc" id="L550">        }</span>

        public String toString() {
<span class="nc bnc" id="L553" title="All 2 branches missed.">            if (dimension &gt; 1) {</span>
<span class="nc" id="L554">                return Messages.DIMENSION_IS_NOT_SUPPORTED_COLON +</span>
                        dimension;
            } else {
<span class="nc" id="L557">                return elemType.getTypeName() + &quot;[&quot; + size + &quot;]&quot;;</span>
            }
        }
    }

    /**
     * The supplied value is viewable iff:
     * - it's a CompositeData/TabularData, or
     * - it's a non-empty array of CompositeData/TabularData, or
     * - it's a non-empty Collection of CompositeData/TabularData.
     */
    public static boolean isViewableValue(Object value) {
        // Check for CompositeData/TabularData
        //
<span class="nc bnc" id="L571" title="All 4 branches missed.">        if (value instanceof CompositeData || value instanceof TabularData) {</span>
<span class="nc" id="L572">            return true;</span>
        }
        // Check for non-empty array of CompositeData/TabularData
        //
<span class="nc bnc" id="L576" title="All 4 branches missed.">        if (value instanceof CompositeData[] || value instanceof TabularData[]) {</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">            return Array.getLength(value) &gt; 0;</span>
        }
        // Check for non-empty Collection of CompositeData/TabularData
        //
<span class="nc bnc" id="L581" title="All 2 branches missed.">        if (value instanceof Collection) {</span>
<span class="nc" id="L582">            Collection&lt;?&gt; c = (Collection&lt;?&gt;) value;</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">            if (c.isEmpty()) {</span>
                // Empty Collections are not viewable
                //
<span class="nc" id="L586">                return false;</span>
            } else {
                // Only Collections of CompositeData/TabularData are viewable
                //
<span class="nc bnc" id="L590" title="All 2 branches missed.">                return Utils.isUniformCollection(c, CompositeData.class) ||</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">                        Utils.isUniformCollection(c, TabularData.class);</span>
            }
        }
<span class="nc" id="L594">        return false;</span>
    }

    public static Component loadOpenType(Object value) {
<span class="nc" id="L598">        Component comp = null;</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">        if(isViewableValue(value)) {</span>
<span class="nc" id="L600">            XOpenTypeViewer open =</span>
                    new XOpenTypeViewer(value);
<span class="nc" id="L602">            comp = open;</span>
        }
<span class="nc" id="L604">        return comp;</span>
    }

<span class="nc" id="L607">    private XOpenTypeViewer(Object value) {</span>
<span class="nc" id="L608">        XOpenTypeData comp = null;</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">        if (value instanceof CompositeData) {</span>
<span class="nc" id="L610">            comp = new XCompositeData(null, (CompositeData) value);</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">        } else if (value instanceof TabularData) {</span>
<span class="nc" id="L612">            comp = new XTabularData(null, (TabularData) value);</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">        } else if (value instanceof CompositeData[]) {</span>
<span class="nc" id="L614">            CompositeData cda[] = (CompositeData[]) value;</span>
<span class="nc" id="L615">            CompositeType ct = cda[0].getCompositeType();</span>
<span class="nc" id="L616">            comp = new XArrayData(null, 1, ct, cda);</span>
<span class="nc bnc" id="L617" title="All 2 branches missed.">        } else if (value instanceof TabularData[]) {</span>
<span class="nc" id="L618">            TabularData tda[] = (TabularData[]) value;</span>
<span class="nc" id="L619">            TabularType tt = tda[0].getTabularType();</span>
<span class="nc" id="L620">            comp = new XArrayData(null, 1, tt, tda);</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">        } else if (value instanceof Collection) {</span>
            // At this point we know 'value' is a uniform collection, either
            // Collection&lt;CompositeData&gt; or Collection&lt;TabularData&gt;, because
            // isViewableValue() has been called before calling the private
            // XOpenTypeViewer() constructor.
            //
<span class="nc" id="L627">            Object e = ((Collection&lt;?&gt;) value).iterator().next();</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">            if (e instanceof CompositeData) {</span>
<span class="nc" id="L629">                Collection&lt;?&gt; cdc = (Collection&lt;?&gt;) value;</span>
<span class="nc" id="L630">                CompositeData cda[] = cdc.toArray(new CompositeData[0]);</span>
<span class="nc" id="L631">                CompositeType ct = cda[0].getCompositeType();</span>
<span class="nc" id="L632">                comp = new XArrayData(null, 1, ct, cda);</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">            } else if (e instanceof TabularData) {</span>
<span class="nc" id="L634">                Collection&lt;?&gt; tdc = (Collection&lt;?&gt;) value;</span>
<span class="nc" id="L635">                TabularData tda[] = tdc.toArray(new TabularData[0]);</span>
<span class="nc" id="L636">                TabularType tt = tda[0].getTabularType();</span>
<span class="nc" id="L637">                comp = new XArrayData(null, 1, tt, tda);</span>
            }
        }
<span class="nc" id="L640">        setupDisplay(comp);</span>
        try {
<span class="nc" id="L642">            comp.viewed(this);</span>
<span class="nc" id="L643">        } catch (Exception e) {</span>
            // Nothing to change, the element can't be displayed
<span class="nc bnc" id="L645" title="All 2 branches missed.">            if (JConsole.isDebug()) {</span>
<span class="nc" id="L646">                System.out.println(&quot;Exception viewing openType : &quot; + e);</span>
<span class="nc" id="L647">                e.printStackTrace();</span>
            }
<span class="nc" id="L649">        }</span>
<span class="nc" id="L650">    }</span>

    void setOpenType(XOpenTypeData data) {
<span class="nc bnc" id="L653" title="All 2 branches missed.">        if (current != null) {</span>
<span class="nc" id="L654">            current.removeMouseListener(listener);</span>
        }

<span class="nc" id="L657">        current = data;</span>

        // Enable/Disable the previous (&lt;&lt;) button
<span class="nc bnc" id="L660" title="All 2 branches missed.">        if (current.getViewedParent() == null) {</span>
<span class="nc" id="L661">            prev.setEnabled(false);</span>
        } else {
<span class="nc" id="L663">            prev.setEnabled(true);</span>
        }

        // Set the listener to handle double-click mouse events
<span class="nc" id="L667">        current.addMouseListener(listener);</span>

        // Enable/Disable the tabular buttons
<span class="nc bnc" id="L670" title="All 2 branches missed.">        if (!(data instanceof XViewedTabularData)) {</span>
<span class="nc" id="L671">            tabularPrev.setEnabled(false);</span>
<span class="nc" id="L672">            tabularNext.setEnabled(false);</span>
<span class="nc" id="L673">            tabularLabel.setText(tabularNavigationSingle);</span>
<span class="nc" id="L674">            tabularLabel.setEnabled(false);</span>
        } else {
<span class="nc" id="L676">            XViewedTabularData tabular = (XViewedTabularData) data;</span>
<span class="nc" id="L677">            tabularNext.setEnabled(tabular.canIncrement());</span>
<span class="nc" id="L678">            tabularPrev.setEnabled(tabular.canDecrement());</span>
<span class="nc" id="L679">            boolean hasMoreThanOneElement =</span>
<span class="nc bnc" id="L680" title="All 4 branches missed.">                    tabular.canIncrement() || tabular.canDecrement();</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">            if (hasMoreThanOneElement) {</span>
<span class="nc" id="L682">                tabularLabel.setText(</span>
<span class="nc" id="L683">                        Resources.format(Messages.MBEANS_TAB_TABULAR_NAVIGATION_MULTIPLE,</span>
<span class="nc" id="L684">                        String.format(&quot;%d&quot;, tabular.getSelectedElementIndex() + 1),</span>
<span class="nc" id="L685">                        String.format(&quot;%d&quot;, tabular.getElementCount())));</span>
            } else {
<span class="nc" id="L687">                tabularLabel.setText(tabularNavigationSingle);</span>
            }
<span class="nc" id="L689">            tabularLabel.setEnabled(hasMoreThanOneElement);</span>
        }

        // Enable/Disable the composite buttons
<span class="nc bnc" id="L693" title="All 2 branches missed.">        if (!(data instanceof XViewedArrayData)) {</span>
<span class="nc" id="L694">            incr.setEnabled(false);</span>
<span class="nc" id="L695">            decr.setEnabled(false);</span>
<span class="nc" id="L696">            compositeLabel.setText(compositeNavigationSingle);</span>
<span class="nc" id="L697">            compositeLabel.setEnabled(false);</span>
        } else {
<span class="nc" id="L699">            XViewedArrayData array = (XViewedArrayData) data;</span>
<span class="nc" id="L700">            incr.setEnabled(array.canIncrement());</span>
<span class="nc" id="L701">            decr.setEnabled(array.canDecrement());</span>
<span class="nc" id="L702">            boolean hasMoreThanOneElement =</span>
<span class="nc bnc" id="L703" title="All 4 branches missed.">                    array.canIncrement() || array.canDecrement();</span>
<span class="nc bnc" id="L704" title="All 2 branches missed.">            if (hasMoreThanOneElement) {</span>
<span class="nc" id="L705">                compositeLabel.setText(</span>
<span class="nc" id="L706">                        Resources.format(Messages.MBEANS_TAB_COMPOSITE_NAVIGATION_MULTIPLE,</span>
<span class="nc" id="L707">                        String.format(&quot;%d&quot;, array.getSelectedElementIndex() + 1),</span>
<span class="nc" id="L708">                        String.format(&quot;%d&quot;, array.getElementCount())));</span>
            } else {
<span class="nc" id="L710">                compositeLabel.setText(compositeNavigationSingle);</span>
            }
<span class="nc" id="L712">            compositeLabel.setEnabled(hasMoreThanOneElement);</span>
        }

<span class="nc" id="L715">        container.invalidate();</span>
<span class="nc" id="L716">        container.setViewportView(current);</span>
<span class="nc" id="L717">        container.validate();</span>
<span class="nc" id="L718">    }</span>

    public void actionPerformed(ActionEvent event) {
<span class="nc bnc" id="L721" title="All 2 branches missed.">        if (event.getSource() instanceof JButton) {</span>
<span class="nc" id="L722">            JButton b = (JButton) event.getSource();</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">            if (b == prev) {</span>
<span class="nc" id="L724">                XOpenTypeData parent = current.getViewedParent();</span>
                try {
<span class="nc" id="L726">                    parent.viewed(this);</span>
<span class="nc" id="L727">                } catch (Exception e) {</span>
                    //Nothing to change, the element can't be displayed
<span class="nc" id="L729">                }</span>
<span class="nc bnc" id="L730" title="All 2 branches missed.">            } else if (b == incr) {</span>
<span class="nc" id="L731">                ((XViewedArrayData) current).incrElement();</span>
                try {
<span class="nc" id="L733">                    current.viewed(this);</span>
<span class="nc" id="L734">                } catch (Exception e) {</span>
                    //Nothing to change, the element can't be displayed
<span class="nc" id="L736">                }</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">            } else if (b == decr) {</span>
<span class="nc" id="L738">                ((XViewedArrayData) current).decrElement();</span>
                try {
<span class="nc" id="L740">                    current.viewed(this);</span>
<span class="nc" id="L741">                } catch (Exception e) {</span>
                    //Nothing to change, the element can't be displayed
<span class="nc" id="L743">                }</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">            } else if (b == tabularNext) {</span>
<span class="nc" id="L745">                ((XViewedTabularData) current).incrElement();</span>
                try {
<span class="nc" id="L747">                    current.viewed(this);</span>
<span class="nc" id="L748">                } catch (Exception e) {</span>
                    //Nothing to change, the element can't be displayed
<span class="nc" id="L750">                }</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">            } else if (b == tabularPrev) {</span>
<span class="nc" id="L752">                ((XViewedTabularData) current).decrElement();</span>
                try {
<span class="nc" id="L754">                    current.viewed(this);</span>
<span class="nc" id="L755">                } catch (Exception e) {</span>
                    //Nothing to change, the element can't be displayed
<span class="nc" id="L757">                }</span>
            }
        }
<span class="nc" id="L760">    }</span>

    private void setupDisplay(XOpenTypeData data) {
<span class="nc" id="L763">        setBackground(Color.white);</span>
<span class="nc" id="L764">        container =</span>
                new JScrollPane(data,
                JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,
                JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);

<span class="nc" id="L769">        JPanel buttons = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L770">        tabularPrev = new JButton(Messages.LESS_THAN);</span>
<span class="nc" id="L771">        tabularNext = new JButton(Messages.GREATER_THAN);</span>
<span class="nc" id="L772">        JPanel tabularButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L773">        tabularButtons.add(tabularPrev);</span>
<span class="nc" id="L774">        tabularPrev.addActionListener(this);</span>
<span class="nc" id="L775">        tabularLabel = new JLabel(tabularNavigationSingle);</span>
<span class="nc" id="L776">        tabularLabel.setEnabled(false);</span>
<span class="nc" id="L777">        tabularButtons.add(tabularLabel);</span>
<span class="nc" id="L778">        tabularButtons.add(tabularNext);</span>
<span class="nc" id="L779">        tabularNext.addActionListener(this);</span>
<span class="nc" id="L780">        tabularButtons.setBackground(Color.white);</span>

<span class="nc" id="L782">        prev = new JButton(Messages.A_LOT_LESS_THAN);</span>
<span class="nc" id="L783">        prev.addActionListener(this);</span>
<span class="nc" id="L784">        buttons.add(prev);</span>

<span class="nc" id="L786">        incr = new JButton(Messages.GREATER_THAN);</span>
<span class="nc" id="L787">        incr.addActionListener(this);</span>
<span class="nc" id="L788">        decr = new JButton(Messages.LESS_THAN);</span>
<span class="nc" id="L789">        decr.addActionListener(this);</span>

<span class="nc" id="L791">        JPanel array = new JPanel();</span>
<span class="nc" id="L792">        array.setBackground(Color.white);</span>
<span class="nc" id="L793">        array.add(decr);</span>
<span class="nc" id="L794">        compositeLabel = new JLabel(compositeNavigationSingle);</span>
<span class="nc" id="L795">        compositeLabel.setEnabled(false);</span>
<span class="nc" id="L796">        array.add(compositeLabel);</span>
<span class="nc" id="L797">        array.add(incr);</span>

<span class="nc" id="L799">        buttons.add(array);</span>
<span class="nc" id="L800">        setLayout(new BorderLayout());</span>
<span class="nc" id="L801">        buttons.setBackground(Color.white);</span>

<span class="nc" id="L803">        JPanel navigationPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L804">        navigationPanel.setBackground(Color.white);</span>
<span class="nc" id="L805">        navigationPanel.add(tabularButtons, BorderLayout.NORTH);</span>
<span class="nc" id="L806">        navigationPanel.add(buttons, BorderLayout.WEST);</span>
<span class="nc" id="L807">        add(navigationPanel, BorderLayout.NORTH);</span>

<span class="nc" id="L809">        add(container, BorderLayout.CENTER);</span>
<span class="nc" id="L810">        Dimension d = new Dimension((int)container.getPreferredSize().</span>
<span class="nc" id="L811">                getWidth() + 20,</span>
<span class="nc" id="L812">                (int)container.getPreferredSize().</span>
<span class="nc" id="L813">                getHeight() + 20);</span>
<span class="nc" id="L814">        setPreferredSize(d);</span>
<span class="nc" id="L815">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>