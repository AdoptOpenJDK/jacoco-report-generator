<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>AbstractAction.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing</a> &gt; <span class="el_source">AbstractAction.java</span></div><h1>AbstractAction.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2007, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing;

import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.util.Hashtable;
import java.util.Enumeration;
import java.io.Serializable;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.security.AccessController;
import javax.swing.event.SwingPropertyChangeSupport;
import sun.security.action.GetPropertyAction;

/**
 * This class provides default implementations for the JFC &lt;code&gt;Action&lt;/code&gt;
 * interface. Standard behaviors like the get and set methods for
 * &lt;code&gt;Action&lt;/code&gt; object properties (icon, text, and enabled) are defined
 * here. The developer need only subclass this abstract class and
 * define the &lt;code&gt;actionPerformed&lt;/code&gt; method.
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases. The current serialization support is
 * appropriate for short term storage or RMI between applications running
 * the same version of Swing.  As of 1.4, support for long term storage
 * of all JavaBeans&amp;trade;
 * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
 * Please see {@link java.beans.XMLEncoder}.
 *
 * @author Georges Saab
 * @see Action
 */
public abstract class AbstractAction implements Action, Cloneable, Serializable
{
    /**
     * Whether or not actions should reconfigure all properties on null.
     */
    private static Boolean RECONFIGURE_ON_NULL;

    /**
     * Specifies whether action is enabled; the default is true.
     */
<span class="nc" id="L69">    protected boolean enabled = true;</span>


    /**
     * Contains the array of key bindings.
     */
    private transient ArrayTable arrayTable;

    /**
     * Whether or not to reconfigure all action properties from the
     * specified event.
     */
    static boolean shouldReconfigure(PropertyChangeEvent e) {
<span class="nc bnc" id="L82" title="All 2 branches missed.">        if (e.getPropertyName() == null) {</span>
<span class="nc" id="L83">            synchronized(AbstractAction.class) {</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">                if (RECONFIGURE_ON_NULL == null) {</span>
<span class="nc" id="L85">                    RECONFIGURE_ON_NULL = Boolean.valueOf(</span>
<span class="nc" id="L86">                        AccessController.doPrivileged(new GetPropertyAction(</span>
                        &quot;swing.actions.reconfigureOnNull&quot;, &quot;false&quot;)));
                }
<span class="nc" id="L89">                return RECONFIGURE_ON_NULL;</span>
<span class="nc" id="L90">            }</span>
        }
<span class="nc" id="L92">        return false;</span>
    }

    /**
     * Sets the enabled state of a component from an Action.
     *
     * @param c the Component to set the enabled state on
     * @param a the Action to set the enabled state from, may be null
     */
    static void setEnabledFromAction(JComponent c, Action a) {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        c.setEnabled((a != null) ? a.isEnabled() : true);</span>
<span class="nc" id="L103">    }</span>

    /**
     * Sets the tooltip text of a component from an Action.
     *
     * @param c the Component to set the tooltip text on
     * @param a the Action to set the tooltip text from, may be null
     */
    static void setToolTipTextFromAction(JComponent c, Action a) {
<span class="nc bnc" id="L112" title="All 2 branches missed.">        c.setToolTipText(a != null ?</span>
<span class="nc" id="L113">                         (String)a.getValue(Action.SHORT_DESCRIPTION) : null);</span>
<span class="nc" id="L114">    }</span>

    static boolean hasSelectedKey(Action a) {
<span class="nc bnc" id="L117" title="All 4 branches missed.">        return (a != null &amp;&amp; a.getValue(Action.SELECTED_KEY) != null);</span>
    }

    static boolean isSelected(Action a) {
<span class="nc" id="L121">        return Boolean.TRUE.equals(a.getValue(Action.SELECTED_KEY));</span>
    }



    /**
     * Creates an {@code Action}.
     */
<span class="nc" id="L129">    public AbstractAction() {</span>
<span class="nc" id="L130">    }</span>

    /**
     * Creates an {@code Action} with the specified name.
     *
     * @param name the name ({@code Action.NAME}) for the action; a
     *        value of {@code null} is ignored
     */
<span class="nc" id="L138">    public AbstractAction(String name) {</span>
<span class="nc" id="L139">        putValue(Action.NAME, name);</span>
<span class="nc" id="L140">    }</span>

    /**
     * Creates an {@code Action} with the specified name and small icon.
     *
     * @param name the name ({@code Action.NAME}) for the action; a
     *        value of {@code null} is ignored
     * @param icon the small icon ({@code Action.SMALL_ICON}) for the action; a
     *        value of {@code null} is ignored
     */
    public AbstractAction(String name, Icon icon) {
<span class="nc" id="L151">        this(name);</span>
<span class="nc" id="L152">        putValue(Action.SMALL_ICON, icon);</span>
<span class="nc" id="L153">    }</span>

    /**
     * Gets the &lt;code&gt;Object&lt;/code&gt; associated with the specified key.
     *
     * @param key a string containing the specified &lt;code&gt;key&lt;/code&gt;
     * @return the binding &lt;code&gt;Object&lt;/code&gt; stored with this key; if there
     *          are no keys, it will return &lt;code&gt;null&lt;/code&gt;
     * @see Action#getValue
     */
    public Object getValue(String key) {
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (key == &quot;enabled&quot;) {</span>
<span class="nc" id="L165">            return enabled;</span>
        }
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if (arrayTable == null) {</span>
<span class="nc" id="L168">            return null;</span>
        }
<span class="nc" id="L170">        return arrayTable.get(key);</span>
    }

    /**
     * Sets the &lt;code&gt;Value&lt;/code&gt; associated with the specified key.
     *
     * @param key  the &lt;code&gt;String&lt;/code&gt; that identifies the stored object
     * @param newValue the &lt;code&gt;Object&lt;/code&gt; to store using this key
     * @see Action#putValue
     */
    public void putValue(String key, Object newValue) {
<span class="nc" id="L181">        Object oldValue = null;</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (key == &quot;enabled&quot;) {</span>
            // Treat putValue(&quot;enabled&quot;) the same way as a call to setEnabled.
            // If we don't do this it means the two may get out of sync, and a
            // bogus property change notification would be sent.
            //
            // To avoid dependencies between putValue &amp; setEnabled this
            // directly changes enabled. If we instead called setEnabled
            // to change enabled, it would be possible for stack
            // overflow in the case where a developer implemented setEnabled
            // in terms of putValue.
<span class="nc bnc" id="L192" title="All 4 branches missed.">            if (newValue == null || !(newValue instanceof Boolean)) {</span>
<span class="nc" id="L193">                newValue = false;</span>
            }
<span class="nc" id="L195">            oldValue = enabled;</span>
<span class="nc" id="L196">            enabled = (Boolean)newValue;</span>
        } else {
<span class="nc bnc" id="L198" title="All 2 branches missed.">            if (arrayTable == null) {</span>
<span class="nc" id="L199">                arrayTable = new ArrayTable();</span>
            }
<span class="nc bnc" id="L201" title="All 2 branches missed.">            if (arrayTable.containsKey(key))</span>
<span class="nc" id="L202">                oldValue = arrayTable.get(key);</span>
            // Remove the entry for key if newValue is null
            // else put in the newValue for key.
<span class="nc bnc" id="L205" title="All 2 branches missed.">            if (newValue == null) {</span>
<span class="nc" id="L206">                arrayTable.remove(key);</span>
            } else {
<span class="nc" id="L208">                arrayTable.put(key,newValue);</span>
            }
        }
<span class="nc" id="L211">        firePropertyChange(key, oldValue, newValue);</span>
<span class="nc" id="L212">    }</span>

    /**
     * Returns true if the action is enabled.
     *
     * @return true if the action is enabled, false otherwise
     * @see Action#isEnabled
     */
    public boolean isEnabled() {
<span class="nc" id="L221">        return enabled;</span>
    }

    /**
     * Sets whether the {@code Action} is enabled. The default is {@code true}.
     *
     * @param newValue  {@code true} to enable the action, {@code false} to
     *                  disable it
     * @see Action#setEnabled
     */
    public void setEnabled(boolean newValue) {
<span class="nc" id="L232">        boolean oldValue = this.enabled;</span>

<span class="nc bnc" id="L234" title="All 2 branches missed.">        if (oldValue != newValue) {</span>
<span class="nc" id="L235">            this.enabled = newValue;</span>
<span class="nc" id="L236">            firePropertyChange(&quot;enabled&quot;,</span>
<span class="nc" id="L237">                               Boolean.valueOf(oldValue), Boolean.valueOf(newValue));</span>
        }
<span class="nc" id="L239">    }</span>


    /**
     * Returns an array of &lt;code&gt;Object&lt;/code&gt;s which are keys for
     * which values have been set for this &lt;code&gt;AbstractAction&lt;/code&gt;,
     * or &lt;code&gt;null&lt;/code&gt; if no keys have values set.
     * @return an array of key objects, or &lt;code&gt;null&lt;/code&gt; if no
     *                  keys have values set
     * @since 1.3
     */
    public Object[] getKeys() {
<span class="nc bnc" id="L251" title="All 2 branches missed.">        if (arrayTable == null) {</span>
<span class="nc" id="L252">            return null;</span>
        }
<span class="nc" id="L254">        Object[] keys = new Object[arrayTable.size()];</span>
<span class="nc" id="L255">        arrayTable.getKeys(keys);</span>
<span class="nc" id="L256">        return keys;</span>
    }

    /**
     * If any &lt;code&gt;PropertyChangeListeners&lt;/code&gt; have been registered, the
     * &lt;code&gt;changeSupport&lt;/code&gt; field describes them.
     */
    protected SwingPropertyChangeSupport changeSupport;

    /**
     * Supports reporting bound property changes.  This method can be called
     * when a bound property has changed and it will send the appropriate
     * &lt;code&gt;PropertyChangeEvent&lt;/code&gt; to any registered
     * &lt;code&gt;PropertyChangeListeners&lt;/code&gt;.
     */
    protected void firePropertyChange(String propertyName, Object oldValue, Object newValue) {
<span class="nc bnc" id="L272" title="All 6 branches missed.">        if (changeSupport == null ||</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            (oldValue != null &amp;&amp; newValue != null &amp;&amp; oldValue.equals(newValue))) {</span>
<span class="nc" id="L274">            return;</span>
        }
<span class="nc" id="L276">        changeSupport.firePropertyChange(propertyName, oldValue, newValue);</span>
<span class="nc" id="L277">    }</span>


    /**
     * Adds a &lt;code&gt;PropertyChangeListener&lt;/code&gt; to the listener list.
     * The listener is registered for all properties.
     * &lt;p&gt;
     * A &lt;code&gt;PropertyChangeEvent&lt;/code&gt; will get fired in response to setting
     * a bound property, e.g. &lt;code&gt;setFont&lt;/code&gt;, &lt;code&gt;setBackground&lt;/code&gt;,
     * or &lt;code&gt;setForeground&lt;/code&gt;.
     * Note that if the current component is inheriting its foreground,
     * background, or font from its container, then no event will be
     * fired in response to a change in the inherited property.
     *
     * @param listener  The &lt;code&gt;PropertyChangeListener&lt;/code&gt; to be added
     *
     * @see Action#addPropertyChangeListener
     */
    public synchronized void addPropertyChangeListener(PropertyChangeListener listener) {
<span class="nc bnc" id="L296" title="All 2 branches missed.">        if (changeSupport == null) {</span>
<span class="nc" id="L297">            changeSupport = new SwingPropertyChangeSupport(this);</span>
        }
<span class="nc" id="L299">        changeSupport.addPropertyChangeListener(listener);</span>
<span class="nc" id="L300">    }</span>


    /**
     * Removes a &lt;code&gt;PropertyChangeListener&lt;/code&gt; from the listener list.
     * This removes a &lt;code&gt;PropertyChangeListener&lt;/code&gt; that was registered
     * for all properties.
     *
     * @param listener  the &lt;code&gt;PropertyChangeListener&lt;/code&gt; to be removed
     *
     * @see Action#removePropertyChangeListener
     */
    public synchronized void removePropertyChangeListener(PropertyChangeListener listener) {
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (changeSupport == null) {</span>
<span class="nc" id="L314">            return;</span>
        }
<span class="nc" id="L316">        changeSupport.removePropertyChangeListener(listener);</span>
<span class="nc" id="L317">    }</span>


    /**
     * Returns an array of all the &lt;code&gt;PropertyChangeListener&lt;/code&gt;s added
     * to this AbstractAction with addPropertyChangeListener().
     *
     * @return all of the &lt;code&gt;PropertyChangeListener&lt;/code&gt;s added or an empty
     *         array if no listeners have been added
     * @since 1.4
     */
    public synchronized PropertyChangeListener[] getPropertyChangeListeners() {
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (changeSupport == null) {</span>
<span class="nc" id="L330">            return new PropertyChangeListener[0];</span>
        }
<span class="nc" id="L332">        return changeSupport.getPropertyChangeListeners();</span>
    }


    /**
     * Clones the abstract action. This gives the clone
     * its own copy of the key/value list,
     * which is not handled for you by &lt;code&gt;Object.clone()&lt;/code&gt;.
     **/

    protected Object clone() throws CloneNotSupportedException {
<span class="nc" id="L343">        AbstractAction newAction = (AbstractAction)super.clone();</span>
<span class="nc" id="L344">        synchronized(this) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">            if (arrayTable != null) {</span>
<span class="nc" id="L346">                newAction.arrayTable = (ArrayTable)arrayTable.clone();</span>
            }
<span class="nc" id="L348">        }</span>
<span class="nc" id="L349">        return newAction;</span>
    }

    private void writeObject(ObjectOutputStream s) throws IOException {
        // Store the default fields
<span class="nc" id="L354">        s.defaultWriteObject();</span>

        // And the keys
<span class="nc" id="L357">        ArrayTable.writeArrayTable(s, arrayTable);</span>
<span class="nc" id="L358">    }</span>

    private void readObject(ObjectInputStream s) throws ClassNotFoundException,
        IOException {
<span class="nc" id="L362">        s.defaultReadObject();</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">        for (int counter = s.readInt() - 1; counter &gt;= 0; counter--) {</span>
<span class="nc" id="L364">            putValue((String)s.readObject(), s.readObject());</span>
        }
<span class="nc" id="L366">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>