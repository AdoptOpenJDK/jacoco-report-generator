<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>JFileChooser.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing</a> &gt; <span class="el_source">JFileChooser.java</span></div><h1>JFileChooser.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing;

import javax.swing.event.*;
import javax.swing.filechooser.*;
import javax.swing.plaf.FileChooserUI;

import javax.accessibility.*;

import java.io.File;
import java.io.ObjectOutputStream;
import java.io.IOException;

import java.util.Vector;
import java.awt.AWTEvent;
import java.awt.Component;
import java.awt.Container;
import java.awt.BorderLayout;
import java.awt.Window;
import java.awt.Dialog;
import java.awt.Frame;
import java.awt.GraphicsEnvironment;
import java.awt.HeadlessException;
import java.awt.EventQueue;
import java.awt.Toolkit;
import java.awt.event.*;
import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeEvent;
import java.lang.ref.WeakReference;

/**
 * &lt;code&gt;JFileChooser&lt;/code&gt; provides a simple mechanism for the user to
 * choose a file.
 * For information about using &lt;code&gt;JFileChooser&lt;/code&gt;, see
 * &lt;a
 href=&quot;http://docs.oracle.com/javase/tutorial/uiswing/components/filechooser.html&quot;&gt;How to Use File Choosers&lt;/a&gt;,
 * a section in &lt;em&gt;The Java Tutorial&lt;/em&gt;.
 *
 * &lt;p&gt;
 *
 * The following code pops up a file chooser for the user's home directory that
 * sees only .jpg and .gif images:
 * &lt;pre&gt;
 *    JFileChooser chooser = new JFileChooser();
 *    FileNameExtensionFilter filter = new FileNameExtensionFilter(
 *        &quot;JPG &amp;amp; GIF Images&quot;, &quot;jpg&quot;, &quot;gif&quot;);
 *    chooser.setFileFilter(filter);
 *    int returnVal = chooser.showOpenDialog(parent);
 *    if(returnVal == JFileChooser.APPROVE_OPTION) {
 *       System.out.println(&quot;You chose to open this file: &quot; +
 *            chooser.getSelectedFile().getName());
 *    }
 * &lt;/pre&gt;
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt; Swing is not thread safe. For more
 * information see &lt;a
 * href=&quot;package-summary.html#threading&quot;&gt;Swing's Threading
 * Policy&lt;/a&gt;.
 *
 * @beaninfo
 *   attribute: isContainer false
 * description: A component which allows for the interactive selection of a file.
 *
 * @author Jeff Dinkins
 *
 */
public class JFileChooser extends JComponent implements Accessible {

    /**
     * @see #getUIClassID
     * @see #readObject
     */
    private static final String uiClassID = &quot;FileChooserUI&quot;;

    // ************************
    // ***** Dialog Types *****
    // ************************

    /**
     * Type value indicating that the &lt;code&gt;JFileChooser&lt;/code&gt; supports an
     * &quot;Open&quot; file operation.
     */
    public static final int OPEN_DIALOG = 0;

    /**
     * Type value indicating that the &lt;code&gt;JFileChooser&lt;/code&gt; supports a
     * &quot;Save&quot; file operation.
     */
    public static final int SAVE_DIALOG = 1;

    /**
     * Type value indicating that the &lt;code&gt;JFileChooser&lt;/code&gt; supports a
     * developer-specified file operation.
     */
    public static final int CUSTOM_DIALOG = 2;


    // ********************************
    // ***** Dialog Return Values *****
    // ********************************

    /**
     * Return value if cancel is chosen.
     */
    public static final int CANCEL_OPTION = 1;

    /**
     * Return value if approve (yes, ok) is chosen.
     */
    public static final int APPROVE_OPTION = 0;

    /**
     * Return value if an error occurred.
     */
    public static final int ERROR_OPTION = -1;


    // **********************************
    // ***** JFileChooser properties *****
    // **********************************


    /** Instruction to display only files. */
    public static final int FILES_ONLY = 0;

    /** Instruction to display only directories. */
    public static final int DIRECTORIES_ONLY = 1;

    /** Instruction to display both files and directories. */
    public static final int FILES_AND_DIRECTORIES = 2;

    /** Instruction to cancel the current selection. */
    public static final String CANCEL_SELECTION = &quot;CancelSelection&quot;;

    /**
     * Instruction to approve the current selection
     * (same as pressing yes or ok).
     */
    public static final String APPROVE_SELECTION = &quot;ApproveSelection&quot;;

    /** Identifies change in the text on the approve (yes, ok) button. */
    public static final String APPROVE_BUTTON_TEXT_CHANGED_PROPERTY = &quot;ApproveButtonTextChangedProperty&quot;;

    /**
     * Identifies change in the tooltip text for the approve (yes, ok)
     * button.
     */
    public static final String APPROVE_BUTTON_TOOL_TIP_TEXT_CHANGED_PROPERTY = &quot;ApproveButtonToolTipTextChangedProperty&quot;;

    /** Identifies change in the mnemonic for the approve (yes, ok) button. */
    public static final String APPROVE_BUTTON_MNEMONIC_CHANGED_PROPERTY = &quot;ApproveButtonMnemonicChangedProperty&quot;;

    /** Instruction to display the control buttons. */
    public static final String CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY = &quot;ControlButtonsAreShownChangedProperty&quot;;

    /** Identifies user's directory change. */
    public static final String DIRECTORY_CHANGED_PROPERTY = &quot;directoryChanged&quot;;

    /** Identifies change in user's single-file selection. */
    public static final String SELECTED_FILE_CHANGED_PROPERTY = &quot;SelectedFileChangedProperty&quot;;

    /** Identifies change in user's multiple-file selection. */
    public static final String SELECTED_FILES_CHANGED_PROPERTY = &quot;SelectedFilesChangedProperty&quot;;

    /** Enables multiple-file selections. */
    public static final String MULTI_SELECTION_ENABLED_CHANGED_PROPERTY = &quot;MultiSelectionEnabledChangedProperty&quot;;

    /**
     * Says that a different object is being used to find available drives
     * on the system.
     */
    public static final String FILE_SYSTEM_VIEW_CHANGED_PROPERTY = &quot;FileSystemViewChanged&quot;;

    /**
     * Says that a different object is being used to retrieve file
     * information.
     */
    public static final String FILE_VIEW_CHANGED_PROPERTY = &quot;fileViewChanged&quot;;

    /** Identifies a change in the display-hidden-files property. */
    public static final String FILE_HIDING_CHANGED_PROPERTY = &quot;FileHidingChanged&quot;;

    /** User changed the kind of files to display. */
    public static final String FILE_FILTER_CHANGED_PROPERTY = &quot;fileFilterChanged&quot;;

    /**
     * Identifies a change in the kind of selection (single,
     * multiple, etc.).
     */
    public static final String FILE_SELECTION_MODE_CHANGED_PROPERTY = &quot;fileSelectionChanged&quot;;

    /**
     * Says that a different accessory component is in use
     * (for example, to preview files).
     */
    public static final String ACCESSORY_CHANGED_PROPERTY = &quot;AccessoryChangedProperty&quot;;

    /**
     * Identifies whether a the AcceptAllFileFilter is used or not.
     */
    public static final String ACCEPT_ALL_FILE_FILTER_USED_CHANGED_PROPERTY = &quot;acceptAllFileFilterUsedChanged&quot;;

    /** Identifies a change in the dialog title. */
    public static final String DIALOG_TITLE_CHANGED_PROPERTY = &quot;DialogTitleChangedProperty&quot;;

    /**
     * Identifies a change in the type of files displayed (files only,
     * directories only, or both files and directories).
     */
    public static final String DIALOG_TYPE_CHANGED_PROPERTY = &quot;DialogTypeChangedProperty&quot;;

    /**
     * Identifies a change in the list of predefined file filters
     * the user can choose from.
     */
    public static final String CHOOSABLE_FILE_FILTER_CHANGED_PROPERTY = &quot;ChoosableFileFilterChangedProperty&quot;;

    // ******************************
    // ***** instance variables *****
    // ******************************

<span class="nc" id="L246">    private String dialogTitle = null;</span>
<span class="nc" id="L247">    private String approveButtonText = null;</span>
<span class="nc" id="L248">    private String approveButtonToolTipText = null;</span>
<span class="nc" id="L249">    private int approveButtonMnemonic = 0;</span>

<span class="nc" id="L251">    private Vector&lt;FileFilter&gt; filters = new Vector&lt;FileFilter&gt;(5);</span>
<span class="nc" id="L252">    private JDialog dialog = null;</span>
<span class="nc" id="L253">    private int dialogType = OPEN_DIALOG;</span>
<span class="nc" id="L254">    private int returnValue = ERROR_OPTION;</span>
<span class="nc" id="L255">    private JComponent accessory = null;</span>

<span class="nc" id="L257">    private FileView fileView = null;</span>

<span class="nc" id="L259">    private boolean controlsShown = true;</span>

<span class="nc" id="L261">    private boolean useFileHiding = true;</span>
    private static final String SHOW_HIDDEN_PROP = &quot;awt.file.showHiddenFiles&quot;;

    // Listens to changes in the native setting for showing hidden files.
    // The Listener is removed and the native setting is ignored if
    // setFileHidingEnabled() is ever called.
<span class="nc" id="L267">    private transient PropertyChangeListener showFilesListener = null;</span>

<span class="nc" id="L269">    private int fileSelectionMode = FILES_ONLY;</span>

<span class="nc" id="L271">    private boolean multiSelectionEnabled = false;</span>

<span class="nc" id="L273">    private boolean useAcceptAllFileFilter = true;</span>

<span class="nc" id="L275">    private boolean dragEnabled = false;</span>

<span class="nc" id="L277">    private FileFilter fileFilter = null;</span>

<span class="nc" id="L279">    private FileSystemView fileSystemView = null;</span>

<span class="nc" id="L281">    private File currentDirectory = null;</span>
<span class="nc" id="L282">    private File selectedFile = null;</span>
    private File[] selectedFiles;

    // *************************************
    // ***** JFileChooser Constructors *****
    // *************************************

    /**
     * Constructs a &lt;code&gt;JFileChooser&lt;/code&gt; pointing to the user's
     * default directory. This default depends on the operating system.
     * It is typically the &quot;My Documents&quot; folder on Windows, and the
     * user's home directory on Unix.
     */
    public JFileChooser() {
<span class="nc" id="L296">        this((File) null, (FileSystemView) null);</span>
<span class="nc" id="L297">    }</span>

    /**
     * Constructs a &lt;code&gt;JFileChooser&lt;/code&gt; using the given path.
     * Passing in a &lt;code&gt;null&lt;/code&gt;
     * string causes the file chooser to point to the user's default directory.
     * This default depends on the operating system. It is
     * typically the &quot;My Documents&quot; folder on Windows, and the user's
     * home directory on Unix.
     *
     * @param currentDirectoryPath  a &lt;code&gt;String&lt;/code&gt; giving the path
     *                          to a file or directory
     */
    public JFileChooser(String currentDirectoryPath) {
<span class="nc" id="L311">        this(currentDirectoryPath, (FileSystemView) null);</span>
<span class="nc" id="L312">    }</span>

    /**
     * Constructs a &lt;code&gt;JFileChooser&lt;/code&gt; using the given &lt;code&gt;File&lt;/code&gt;
     * as the path. Passing in a &lt;code&gt;null&lt;/code&gt; file
     * causes the file chooser to point to the user's default directory.
     * This default depends on the operating system. It is
     * typically the &quot;My Documents&quot; folder on Windows, and the user's
     * home directory on Unix.
     *
     * @param currentDirectory  a &lt;code&gt;File&lt;/code&gt; object specifying
     *                          the path to a file or directory
     */
    public JFileChooser(File currentDirectory) {
<span class="nc" id="L326">        this(currentDirectory, (FileSystemView) null);</span>
<span class="nc" id="L327">    }</span>

    /**
     * Constructs a &lt;code&gt;JFileChooser&lt;/code&gt; using the given
     * &lt;code&gt;FileSystemView&lt;/code&gt;.
     */
    public JFileChooser(FileSystemView fsv) {
<span class="nc" id="L334">        this((File) null, fsv);</span>
<span class="nc" id="L335">    }</span>


    /**
     * Constructs a &lt;code&gt;JFileChooser&lt;/code&gt; using the given current directory
     * and &lt;code&gt;FileSystemView&lt;/code&gt;.
     */
<span class="nc" id="L342">    public JFileChooser(File currentDirectory, FileSystemView fsv) {</span>
<span class="nc" id="L343">        setup(fsv);</span>
<span class="nc" id="L344">        setCurrentDirectory(currentDirectory);</span>
<span class="nc" id="L345">    }</span>

    /**
     * Constructs a &lt;code&gt;JFileChooser&lt;/code&gt; using the given current directory
     * path and &lt;code&gt;FileSystemView&lt;/code&gt;.
     */
<span class="nc" id="L351">    public JFileChooser(String currentDirectoryPath, FileSystemView fsv) {</span>
<span class="nc" id="L352">        setup(fsv);</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">        if(currentDirectoryPath == null) {</span>
<span class="nc" id="L354">            setCurrentDirectory(null);</span>
        } else {
<span class="nc" id="L356">            setCurrentDirectory(fileSystemView.createFileObject(currentDirectoryPath));</span>
        }
<span class="nc" id="L358">    }</span>

    /**
     * Performs common constructor initialization and setup.
     */
    protected void setup(FileSystemView view) {
<span class="nc" id="L364">        installShowFilesListener();</span>
<span class="nc" id="L365">        installHierarchyListener();</span>

<span class="nc bnc" id="L367" title="All 2 branches missed.">        if(view == null) {</span>
<span class="nc" id="L368">            view = FileSystemView.getFileSystemView();</span>
        }
<span class="nc" id="L370">        setFileSystemView(view);</span>
<span class="nc" id="L371">        updateUI();</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if(isAcceptAllFileFilterUsed()) {</span>
<span class="nc" id="L373">            setFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc" id="L375">        enableEvents(AWTEvent.MOUSE_EVENT_MASK);</span>
<span class="nc" id="L376">    }</span>

    private void installHierarchyListener() {
<span class="nc" id="L379">        addHierarchyListener(new HierarchyListener() {</span>
            @Override
            public void hierarchyChanged(HierarchyEvent e) {
<span class="nc bnc" id="L382" title="All 2 branches missed.">                if ((e.getChangeFlags() &amp; HierarchyEvent.PARENT_CHANGED)</span>
                        == HierarchyEvent.PARENT_CHANGED) {
<span class="nc" id="L384">                    JFileChooser fc = JFileChooser.this;</span>
<span class="nc" id="L385">                    JRootPane rootPane = SwingUtilities.getRootPane(fc);</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">                    if (rootPane != null) {</span>
<span class="nc" id="L387">                        rootPane.setDefaultButton(fc.getUI().getDefaultButton(fc));</span>
                    }
                }
<span class="nc" id="L390">            }</span>
        });
<span class="nc" id="L392">    }</span>

    private void installShowFilesListener() {
        // Track native setting for showing hidden files
<span class="nc" id="L396">        Toolkit tk = Toolkit.getDefaultToolkit();</span>
<span class="nc" id="L397">        Object showHiddenProperty = tk.getDesktopProperty(SHOW_HIDDEN_PROP);</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">        if (showHiddenProperty instanceof Boolean) {</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">            useFileHiding = !((Boolean)showHiddenProperty).booleanValue();</span>
<span class="nc" id="L400">            showFilesListener = new WeakPCL(this);</span>
<span class="nc" id="L401">            tk.addPropertyChangeListener(SHOW_HIDDEN_PROP, showFilesListener);</span>
        }
<span class="nc" id="L403">    }</span>

    /**
     * Sets the &lt;code&gt;dragEnabled&lt;/code&gt; property,
     * which must be &lt;code&gt;true&lt;/code&gt; to enable
     * automatic drag handling (the first part of drag and drop)
     * on this component.
     * The &lt;code&gt;transferHandler&lt;/code&gt; property needs to be set
     * to a non-&lt;code&gt;null&lt;/code&gt; value for the drag to do
     * anything.  The default value of the &lt;code&gt;dragEnabled&lt;/code&gt;
     * property
     * is &lt;code&gt;false&lt;/code&gt;.
     *
     * &lt;p&gt;
     *
     * When automatic drag handling is enabled,
     * most look and feels begin a drag-and-drop operation
     * whenever the user presses the mouse button over an item
     * and then moves the mouse a few pixels.
     * Setting this property to &lt;code&gt;true&lt;/code&gt;
     * can therefore have a subtle effect on
     * how selections behave.
     *
     * &lt;p&gt;
     *
     * Some look and feels might not support automatic drag and drop;
     * they will ignore this property.  You can work around such
     * look and feels by modifying the component
     * to directly call the &lt;code&gt;exportAsDrag&lt;/code&gt; method of a
     * &lt;code&gt;TransferHandler&lt;/code&gt;.
     *
     * @param b the value to set the &lt;code&gt;dragEnabled&lt;/code&gt; property to
     * @exception HeadlessException if
     *            &lt;code&gt;b&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt; and
     *            &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt;
     *            returns &lt;code&gt;true&lt;/code&gt;
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see #getDragEnabled
     * @see #setTransferHandler
     * @see TransferHandler
     * @since 1.4
     *
     * @beaninfo
     *  description: determines whether automatic drag handling is enabled
     *        bound: false
     */
    public void setDragEnabled(boolean b) {
<span class="nc bnc" id="L450" title="All 4 branches missed.">        if (b &amp;&amp; GraphicsEnvironment.isHeadless()) {</span>
<span class="nc" id="L451">            throw new HeadlessException();</span>
        }
<span class="nc" id="L453">        dragEnabled = b;</span>
<span class="nc" id="L454">    }</span>

    /**
     * Gets the value of the &lt;code&gt;dragEnabled&lt;/code&gt; property.
     *
     * @return  the value of the &lt;code&gt;dragEnabled&lt;/code&gt; property
     * @see #setDragEnabled
     * @since 1.4
     */
    public boolean getDragEnabled() {
<span class="nc" id="L464">        return dragEnabled;</span>
    }

    // *****************************
    // ****** File Operations ******
    // *****************************

    /**
     * Returns the selected file. This can be set either by the
     * programmer via &lt;code&gt;setSelectedFile&lt;/code&gt; or by a user action, such as
     * either typing the filename into the UI or selecting the
     * file from a list in the UI.
     *
     * @see #setSelectedFile
     * @return the selected file
     */
    public File getSelectedFile() {
<span class="nc" id="L481">        return selectedFile;</span>
    }

    /**
     * Sets the selected file. If the file's parent directory is
     * not the current directory, changes the current directory
     * to be the file's parent directory.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     *
     * @see #getSelectedFile
     *
     * @param file the selected file
     */
    public void setSelectedFile(File file) {
<span class="nc" id="L498">        File oldValue = selectedFile;</span>
<span class="nc" id="L499">        selectedFile = file;</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">        if(selectedFile != null) {</span>
<span class="nc bnc" id="L501" title="All 4 branches missed.">            if (file.isAbsolute() &amp;&amp; !getFileSystemView().isParent(getCurrentDirectory(), selectedFile)) {</span>
<span class="nc" id="L502">                setCurrentDirectory(selectedFile.getParentFile());</span>
            }
<span class="nc bnc" id="L504" title="All 6 branches missed.">            if (!isMultiSelectionEnabled() || selectedFiles == null || selectedFiles.length == 1) {</span>
<span class="nc" id="L505">                ensureFileIsVisible(selectedFile);</span>
            }
        }
<span class="nc" id="L508">        firePropertyChange(SELECTED_FILE_CHANGED_PROPERTY, oldValue, selectedFile);</span>
<span class="nc" id="L509">    }</span>

    /**
     * Returns a list of selected files if the file chooser is
     * set to allow multiple selection.
     */
    public File[] getSelectedFiles() {
<span class="nc bnc" id="L516" title="All 2 branches missed.">        if(selectedFiles == null) {</span>
<span class="nc" id="L517">            return new File[0];</span>
        } else {
<span class="nc" id="L519">            return selectedFiles.clone();</span>
        }
    }

    /**
     * Sets the list of selected files if the file chooser is
     * set to allow multiple selection.
     *
     * @beaninfo
     *       bound: true
     * description: The list of selected files if the chooser is in multiple selection mode.
     */
    public void setSelectedFiles(File[] selectedFiles) {
<span class="nc" id="L532">        File[] oldValue = this.selectedFiles;</span>
<span class="nc bnc" id="L533" title="All 4 branches missed.">        if (selectedFiles == null || selectedFiles.length == 0) {</span>
<span class="nc" id="L534">            selectedFiles = null;</span>
<span class="nc" id="L535">            this.selectedFiles = null;</span>
<span class="nc" id="L536">            setSelectedFile(null);</span>
        } else {
<span class="nc" id="L538">            this.selectedFiles = selectedFiles.clone();</span>
<span class="nc" id="L539">            setSelectedFile(this.selectedFiles[0]);</span>
        }
<span class="nc" id="L541">        firePropertyChange(SELECTED_FILES_CHANGED_PROPERTY, oldValue, selectedFiles);</span>
<span class="nc" id="L542">    }</span>

    /**
     * Returns the current directory.
     *
     * @return the current directory
     * @see #setCurrentDirectory
     */
    public File getCurrentDirectory() {
<span class="nc" id="L551">        return currentDirectory;</span>
    }

    /**
     * Sets the current directory. Passing in &lt;code&gt;null&lt;/code&gt; sets the
     * file chooser to point to the user's default directory.
     * This default depends on the operating system. It is
     * typically the &quot;My Documents&quot; folder on Windows, and the user's
     * home directory on Unix.
     *
     * If the file passed in as &lt;code&gt;currentDirectory&lt;/code&gt; is not a
     * directory, the parent of the file will be used as the currentDirectory.
     * If the parent is not traversable, then it will walk up the parent tree
     * until it finds a traversable directory, or hits the root of the
     * file system.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: The directory that the JFileChooser is showing files of.
     *
     * @param dir the current directory to point to
     * @see #getCurrentDirectory
     */
    public void setCurrentDirectory(File dir) {
<span class="nc" id="L576">        File oldValue = currentDirectory;</span>

<span class="nc bnc" id="L578" title="All 4 branches missed.">        if (dir != null &amp;&amp; !dir.exists()) {</span>
<span class="nc" id="L579">            dir = currentDirectory;</span>
        }
<span class="nc bnc" id="L581" title="All 2 branches missed.">        if (dir == null) {</span>
<span class="nc" id="L582">            dir = getFileSystemView().getDefaultDirectory();</span>
        }
<span class="nc bnc" id="L584" title="All 2 branches missed.">        if (currentDirectory != null) {</span>
            /* Verify the toString of object */
<span class="nc bnc" id="L586" title="All 2 branches missed.">            if (this.currentDirectory.equals(dir)) {</span>
<span class="nc" id="L587">                return;</span>
            }
        }

<span class="nc" id="L591">        File prev = null;</span>
<span class="nc bnc" id="L592" title="All 4 branches missed.">        while (!isTraversable(dir) &amp;&amp; prev != dir) {</span>
<span class="nc" id="L593">            prev = dir;</span>
<span class="nc" id="L594">            dir = getFileSystemView().getParentDirectory(dir);</span>
        }
<span class="nc" id="L596">        currentDirectory = dir;</span>

<span class="nc" id="L598">        firePropertyChange(DIRECTORY_CHANGED_PROPERTY, oldValue, currentDirectory);</span>
<span class="nc" id="L599">    }</span>

    /**
     * Changes the directory to be set to the parent of the
     * current directory.
     *
     * @see #getCurrentDirectory
     */
    public void changeToParentDirectory() {
<span class="nc" id="L608">        selectedFile = null;</span>
<span class="nc" id="L609">        File oldValue = getCurrentDirectory();</span>
<span class="nc" id="L610">        setCurrentDirectory(getFileSystemView().getParentDirectory(oldValue));</span>
<span class="nc" id="L611">    }</span>

    /**
     * Tells the UI to rescan its files list from the current directory.
     */
    public void rescanCurrentDirectory() {
<span class="nc" id="L617">        getUI().rescanCurrentDirectory(this);</span>
<span class="nc" id="L618">    }</span>

    /**
     * Makes sure that the specified file is viewable, and
     * not hidden.
     *
     * @param f  a File object
     */
    public void ensureFileIsVisible(File f) {
<span class="nc" id="L627">        getUI().ensureFileIsVisible(this, f);</span>
<span class="nc" id="L628">    }</span>

    // **************************************
    // ***** JFileChooser Dialog methods *****
    // **************************************

    /**
     * Pops up an &quot;Open File&quot; file chooser dialog. Note that the
     * text that appears in the approve button is determined by
     * the L&amp;amp;F.
     *
     * @param    parent  the parent component of the dialog,
     *                  can be &lt;code&gt;null&lt;/code&gt;;
     *                  see &lt;code&gt;showDialog&lt;/code&gt; for details
     * @return   the return state of the file chooser on popdown:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.CANCEL_OPTION
     * &lt;li&gt;JFileChooser.APPROVE_OPTION
     * &lt;li&gt;JFileChooser.ERROR_OPTION if an error occurs or the
     *                  dialog is dismissed
     * &lt;/ul&gt;
     * @exception HeadlessException if GraphicsEnvironment.isHeadless()
     * returns true.
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see #showDialog
     */
    public int showOpenDialog(Component parent) throws HeadlessException {
<span class="nc" id="L655">        setDialogType(OPEN_DIALOG);</span>
<span class="nc" id="L656">        return showDialog(parent, null);</span>
    }

    /**
     * Pops up a &quot;Save File&quot; file chooser dialog. Note that the
     * text that appears in the approve button is determined by
     * the L&amp;amp;F.
     *
     * @param    parent  the parent component of the dialog,
     *                  can be &lt;code&gt;null&lt;/code&gt;;
     *                  see &lt;code&gt;showDialog&lt;/code&gt; for details
     * @return   the return state of the file chooser on popdown:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.CANCEL_OPTION
     * &lt;li&gt;JFileChooser.APPROVE_OPTION
     * &lt;li&gt;JFileChooser.ERROR_OPTION if an error occurs or the
     *                  dialog is dismissed
     * &lt;/ul&gt;
     * @exception HeadlessException if GraphicsEnvironment.isHeadless()
     * returns true.
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see #showDialog
     */
    public int showSaveDialog(Component parent) throws HeadlessException {
<span class="nc" id="L680">        setDialogType(SAVE_DIALOG);</span>
<span class="nc" id="L681">        return showDialog(parent, null);</span>
    }

    /**
     * Pops a custom file chooser dialog with a custom approve button.
     * For example, the following code
     * pops up a file chooser with a &quot;Run Application&quot; button
     * (instead of the normal &quot;Save&quot; or &quot;Open&quot; button):
     * &lt;pre&gt;
     * filechooser.showDialog(parentFrame, &quot;Run Application&quot;);
     * &lt;/pre&gt;
     *
     * Alternatively, the following code does the same thing:
     * &lt;pre&gt;
     *    JFileChooser chooser = new JFileChooser(null);
     *    chooser.setApproveButtonText(&quot;Run Application&quot;);
     *    chooser.showDialog(parentFrame, null);
     * &lt;/pre&gt;
     *
     * &lt;!--PENDING(jeff) - the following method should be added to the api:
     *      showDialog(Component parent);--&gt;
     * &lt;!--PENDING(kwalrath) - should specify modality and what
     *      &quot;depends&quot; means.--&gt;
     *
     * &lt;p&gt;
     *
     * The &lt;code&gt;parent&lt;/code&gt; argument determines two things:
     * the frame on which the open dialog depends and
     * the component whose position the look and feel
     * should consider when placing the dialog.  If the parent
     * is a &lt;code&gt;Frame&lt;/code&gt; object (such as a &lt;code&gt;JFrame&lt;/code&gt;)
     * then the dialog depends on the frame and
     * the look and feel positions the dialog
     * relative to the frame (for example, centered over the frame).
     * If the parent is a component, then the dialog
     * depends on the frame containing the component,
     * and is positioned relative to the component
     * (for example, centered over the component).
     * If the parent is &lt;code&gt;null&lt;/code&gt;, then the dialog depends on
     * no visible window, and it's placed in a
     * look-and-feel-dependent position
     * such as the center of the screen.
     *
     * @param   parent  the parent component of the dialog;
     *                  can be &lt;code&gt;null&lt;/code&gt;
     * @param   approveButtonText the text of the &lt;code&gt;ApproveButton&lt;/code&gt;
     * @return  the return state of the file chooser on popdown:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.CANCEL_OPTION
     * &lt;li&gt;JFileChooser.APPROVE_OPTION
     * &lt;li&gt;JFileChooser.ERROR_OPTION if an error occurs or the
     *                  dialog is dismissed
     * &lt;/ul&gt;
     * @exception HeadlessException if GraphicsEnvironment.isHeadless()
     * returns true.
     * @see java.awt.GraphicsEnvironment#isHeadless
     */
    public int showDialog(Component parent, String approveButtonText)
        throws HeadlessException {
<span class="nc bnc" id="L740" title="All 2 branches missed.">        if (dialog != null) {</span>
            // Prevent to show second instance of dialog if the previous one still exists
<span class="nc" id="L742">            return JFileChooser.ERROR_OPTION;</span>
        }

<span class="nc bnc" id="L745" title="All 2 branches missed.">        if(approveButtonText != null) {</span>
<span class="nc" id="L746">            setApproveButtonText(approveButtonText);</span>
<span class="nc" id="L747">            setDialogType(CUSTOM_DIALOG);</span>
        }
<span class="nc" id="L749">        dialog = createDialog(parent);</span>
<span class="nc" id="L750">        dialog.addWindowListener(new WindowAdapter() {</span>
            public void windowClosing(WindowEvent e) {
<span class="nc" id="L752">                returnValue = CANCEL_OPTION;</span>
<span class="nc" id="L753">            }</span>
        });
<span class="nc" id="L755">        returnValue = ERROR_OPTION;</span>
<span class="nc" id="L756">        rescanCurrentDirectory();</span>

<span class="nc" id="L758">        dialog.show();</span>
<span class="nc" id="L759">        firePropertyChange(&quot;JFileChooserDialogIsClosingProperty&quot;, dialog, null);</span>

        // Remove all components from dialog. The MetalFileChooserUI.installUI() method (and other LAFs)
        // registers AWT listener for dialogs and produces memory leaks. It happens when
        // installUI invoked after the showDialog method.
<span class="nc" id="L764">        dialog.getContentPane().removeAll();</span>
<span class="nc" id="L765">        dialog.dispose();</span>
<span class="nc" id="L766">        dialog = null;</span>
<span class="nc" id="L767">        return returnValue;</span>
    }

    /**
     * Creates and returns a new &lt;code&gt;JDialog&lt;/code&gt; wrapping
     * &lt;code&gt;this&lt;/code&gt; centered on the &lt;code&gt;parent&lt;/code&gt;
     * in the &lt;code&gt;parent&lt;/code&gt;'s frame.
     * This method can be overriden to further manipulate the dialog,
     * to disable resizing, set the location, etc. Example:
     * &lt;pre&gt;
     *     class MyFileChooser extends JFileChooser {
     *         protected JDialog createDialog(Component parent) throws HeadlessException {
     *             JDialog dialog = super.createDialog(parent);
     *             dialog.setLocation(300, 200);
     *             dialog.setResizable(false);
     *             return dialog;
     *         }
     *     }
     * &lt;/pre&gt;
     *
     * @param   parent  the parent component of the dialog;
     *                  can be &lt;code&gt;null&lt;/code&gt;
     * @return a new &lt;code&gt;JDialog&lt;/code&gt; containing this instance
     * @exception HeadlessException if GraphicsEnvironment.isHeadless()
     * returns true.
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @since 1.4
     */
    protected JDialog createDialog(Component parent) throws HeadlessException {
<span class="nc" id="L796">        FileChooserUI ui = getUI();</span>
<span class="nc" id="L797">        String title = ui.getDialogTitle(this);</span>
<span class="nc" id="L798">        putClientProperty(AccessibleContext.ACCESSIBLE_DESCRIPTION_PROPERTY,</span>
                          title);

        JDialog dialog;
<span class="nc" id="L802">        Window window = JOptionPane.getWindowForComponent(parent);</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">        if (window instanceof Frame) {</span>
<span class="nc" id="L804">            dialog = new JDialog((Frame)window, title, true);</span>
        } else {
<span class="nc" id="L806">            dialog = new JDialog((Dialog)window, title, true);</span>
        }
<span class="nc" id="L808">        dialog.setComponentOrientation(this.getComponentOrientation());</span>

<span class="nc" id="L810">        Container contentPane = dialog.getContentPane();</span>
<span class="nc" id="L811">        contentPane.setLayout(new BorderLayout());</span>
<span class="nc" id="L812">        contentPane.add(this, BorderLayout.CENTER);</span>

<span class="nc bnc" id="L814" title="All 2 branches missed.">        if (JDialog.isDefaultLookAndFeelDecorated()) {</span>
            boolean supportsWindowDecorations =
<span class="nc" id="L816">            UIManager.getLookAndFeel().getSupportsWindowDecorations();</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">            if (supportsWindowDecorations) {</span>
<span class="nc" id="L818">                dialog.getRootPane().setWindowDecorationStyle(JRootPane.FILE_CHOOSER_DIALOG);</span>
            }
        }
<span class="nc" id="L821">        dialog.pack();</span>
<span class="nc" id="L822">        dialog.setLocationRelativeTo(parent);</span>

<span class="nc" id="L824">        return dialog;</span>
    }

    // **************************
    // ***** Dialog Options *****
    // **************************

    /**
     * Returns the value of the &lt;code&gt;controlButtonsAreShown&lt;/code&gt;
     * property.
     *
     * @return   the value of the &lt;code&gt;controlButtonsAreShown&lt;/code&gt;
     *     property
     *
     * @see #setControlButtonsAreShown
     * @since 1.3
     */
    public boolean getControlButtonsAreShown() {
<span class="nc" id="L842">        return controlsShown;</span>
    }


    /**
     * Sets the property
     * that indicates whether the &lt;i&gt;approve&lt;/i&gt; and &lt;i&gt;cancel&lt;/i&gt;
     * buttons are shown in the file chooser.  This property
     * is &lt;code&gt;true&lt;/code&gt; by default.  Look and feels
     * that always show these buttons will ignore the value
     * of this property.
     * This method fires a property-changed event,
     * using the string value of
     * &lt;code&gt;CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY&lt;/code&gt;
     * as the name of the property.
     *
     * @param b &lt;code&gt;false&lt;/code&gt; if control buttons should not be
     *    shown; otherwise, &lt;code&gt;true&lt;/code&gt;
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Sets whether the approve &amp;amp; cancel buttons are shown.
     *
     * @see #getControlButtonsAreShown
     * @see #CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY
     * @since 1.3
     */
    public void setControlButtonsAreShown(boolean b) {
<span class="nc bnc" id="L871" title="All 2 branches missed.">        if(controlsShown == b) {</span>
<span class="nc" id="L872">            return;</span>
        }
<span class="nc" id="L874">        boolean oldValue = controlsShown;</span>
<span class="nc" id="L875">        controlsShown = b;</span>
<span class="nc" id="L876">        firePropertyChange(CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY, oldValue, controlsShown);</span>
<span class="nc" id="L877">    }</span>

    /**
     * Returns the type of this dialog.  The default is
     * &lt;code&gt;JFileChooser.OPEN_DIALOG&lt;/code&gt;.
     *
     * @return   the type of dialog to be displayed:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.OPEN_DIALOG
     * &lt;li&gt;JFileChooser.SAVE_DIALOG
     * &lt;li&gt;JFileChooser.CUSTOM_DIALOG
     * &lt;/ul&gt;
     *
     * @see #setDialogType
     */
    public int getDialogType() {
<span class="nc" id="L893">        return dialogType;</span>
    }

    /**
     * Sets the type of this dialog. Use &lt;code&gt;OPEN_DIALOG&lt;/code&gt; when you
     * want to bring up a file chooser that the user can use to open a file.
     * Likewise, use &lt;code&gt;SAVE_DIALOG&lt;/code&gt; for letting the user choose
     * a file for saving.
     * Use &lt;code&gt;CUSTOM_DIALOG&lt;/code&gt; when you want to use the file
     * chooser in a context other than &quot;Open&quot; or &quot;Save&quot;.
     * For instance, you might want to bring up a file chooser that allows
     * the user to choose a file to execute. Note that you normally would not
     * need to set the &lt;code&gt;JFileChooser&lt;/code&gt; to use
     * &lt;code&gt;CUSTOM_DIALOG&lt;/code&gt;
     * since a call to &lt;code&gt;setApproveButtonText&lt;/code&gt; does this for you.
     * The default dialog type is &lt;code&gt;JFileChooser.OPEN_DIALOG&lt;/code&gt;.
     *
     * @param dialogType the type of dialog to be displayed:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.OPEN_DIALOG
     * &lt;li&gt;JFileChooser.SAVE_DIALOG
     * &lt;li&gt;JFileChooser.CUSTOM_DIALOG
     * &lt;/ul&gt;
     *
     * @exception IllegalArgumentException if &lt;code&gt;dialogType&lt;/code&gt; is
     *                          not legal
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: The type (open, save, custom) of the JFileChooser.
     *        enum:
     *              OPEN_DIALOG JFileChooser.OPEN_DIALOG
     *              SAVE_DIALOG JFileChooser.SAVE_DIALOG
     *              CUSTOM_DIALOG JFileChooser.CUSTOM_DIALOG
     *
     * @see #getDialogType
     * @see #setApproveButtonText
     */
    // PENDING(jeff) - fire button text change property
    public void setDialogType(int dialogType) {
<span class="nc bnc" id="L933" title="All 2 branches missed.">        if(this.dialogType == dialogType) {</span>
<span class="nc" id="L934">            return;</span>
        }
<span class="nc bnc" id="L936" title="All 6 branches missed.">        if(!(dialogType == OPEN_DIALOG || dialogType == SAVE_DIALOG || dialogType == CUSTOM_DIALOG)) {</span>
<span class="nc" id="L937">            throw new IllegalArgumentException(&quot;Incorrect Dialog Type: &quot; + dialogType);</span>
        }
<span class="nc" id="L939">        int oldValue = this.dialogType;</span>
<span class="nc" id="L940">        this.dialogType = dialogType;</span>
<span class="nc bnc" id="L941" title="All 4 branches missed.">        if(dialogType == OPEN_DIALOG || dialogType == SAVE_DIALOG) {</span>
<span class="nc" id="L942">            setApproveButtonText(null);</span>
        }
<span class="nc" id="L944">        firePropertyChange(DIALOG_TYPE_CHANGED_PROPERTY, oldValue, dialogType);</span>
<span class="nc" id="L945">    }</span>

    /**
     * Sets the string that goes in the &lt;code&gt;JFileChooser&lt;/code&gt; window's
     * title bar.
     *
     * @param dialogTitle the new &lt;code&gt;String&lt;/code&gt; for the title bar
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: The title of the JFileChooser dialog window.
     *
     * @see #getDialogTitle
     *
     */
    public void setDialogTitle(String dialogTitle) {
<span class="nc" id="L962">        String oldValue = this.dialogTitle;</span>
<span class="nc" id="L963">        this.dialogTitle = dialogTitle;</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">        if(dialog != null) {</span>
<span class="nc" id="L965">            dialog.setTitle(dialogTitle);</span>
        }
<span class="nc" id="L967">        firePropertyChange(DIALOG_TITLE_CHANGED_PROPERTY, oldValue, dialogTitle);</span>
<span class="nc" id="L968">    }</span>

    /**
     * Gets the string that goes in the &lt;code&gt;JFileChooser&lt;/code&gt;'s titlebar.
     *
     * @see #setDialogTitle
     */
    public String getDialogTitle() {
<span class="nc" id="L976">        return dialogTitle;</span>
    }

    // ************************************
    // ***** JFileChooser View Options *****
    // ************************************



    /**
     * Sets the tooltip text used in the &lt;code&gt;ApproveButton&lt;/code&gt;.
     * If &lt;code&gt;null&lt;/code&gt;, the UI object will determine the button's text.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: The tooltip text for the ApproveButton.
     *
     * @param toolTipText the tooltip text for the approve button
     * @see #setApproveButtonText
     * @see #setDialogType
     * @see #showDialog
     */
    public void setApproveButtonToolTipText(String toolTipText) {
<span class="nc bnc" id="L1000" title="All 2 branches missed.">        if(approveButtonToolTipText == toolTipText) {</span>
<span class="nc" id="L1001">            return;</span>
        }
<span class="nc" id="L1003">        String oldValue = approveButtonToolTipText;</span>
<span class="nc" id="L1004">        approveButtonToolTipText = toolTipText;</span>
<span class="nc" id="L1005">        firePropertyChange(APPROVE_BUTTON_TOOL_TIP_TEXT_CHANGED_PROPERTY, oldValue, approveButtonToolTipText);</span>
<span class="nc" id="L1006">    }</span>


    /**
     * Returns the tooltip text used in the &lt;code&gt;ApproveButton&lt;/code&gt;.
     * If &lt;code&gt;null&lt;/code&gt;, the UI object will determine the button's text.
     *
     * @return the tooltip text used for the approve button
     *
     * @see #setApproveButtonText
     * @see #setDialogType
     * @see #showDialog
     */
    public String getApproveButtonToolTipText() {
<span class="nc" id="L1020">        return approveButtonToolTipText;</span>
    }

    /**
     * Returns the approve button's mnemonic.
     * @return an integer value for the mnemonic key
     *
     * @see #setApproveButtonMnemonic
     */
    public int getApproveButtonMnemonic() {
<span class="nc" id="L1030">        return approveButtonMnemonic;</span>
    }

    /**
     * Sets the approve button's mnemonic using a numeric keycode.
     *
     * @param mnemonic  an integer value for the mnemonic key
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: The mnemonic key accelerator for the ApproveButton.
     *
     * @see #getApproveButtonMnemonic
     */
    public void setApproveButtonMnemonic(int mnemonic) {
<span class="nc bnc" id="L1046" title="All 2 branches missed.">        if(approveButtonMnemonic == mnemonic) {</span>
<span class="nc" id="L1047">           return;</span>
        }
<span class="nc" id="L1049">        int oldValue = approveButtonMnemonic;</span>
<span class="nc" id="L1050">        approveButtonMnemonic = mnemonic;</span>
<span class="nc" id="L1051">        firePropertyChange(APPROVE_BUTTON_MNEMONIC_CHANGED_PROPERTY, oldValue, approveButtonMnemonic);</span>
<span class="nc" id="L1052">    }</span>

    /**
     * Sets the approve button's mnemonic using a character.
     * @param mnemonic  a character value for the mnemonic key
     *
     * @see #getApproveButtonMnemonic
     */
    public void setApproveButtonMnemonic(char mnemonic) {
<span class="nc" id="L1061">        int vk = (int) mnemonic;</span>
<span class="nc bnc" id="L1062" title="All 4 branches missed.">        if(vk &gt;= 'a' &amp;&amp; vk &lt;='z') {</span>
<span class="nc" id="L1063">            vk -= ('a' - 'A');</span>
        }
<span class="nc" id="L1065">        setApproveButtonMnemonic(vk);</span>
<span class="nc" id="L1066">    }</span>


    /**
     * Sets the text used in the &lt;code&gt;ApproveButton&lt;/code&gt; in the
     * &lt;code&gt;FileChooserUI&lt;/code&gt;.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: The text that goes in the ApproveButton.
     *
     * @param approveButtonText the text used in the &lt;code&gt;ApproveButton&lt;/code&gt;
     *
     * @see #getApproveButtonText
     * @see #setDialogType
     * @see #showDialog
     */
    // PENDING(jeff) - have ui set this on dialog type change
    public void setApproveButtonText(String approveButtonText) {
<span class="nc bnc" id="L1086" title="All 2 branches missed.">        if(this.approveButtonText == approveButtonText) {</span>
<span class="nc" id="L1087">            return;</span>
        }
<span class="nc" id="L1089">        String oldValue = this.approveButtonText;</span>
<span class="nc" id="L1090">        this.approveButtonText = approveButtonText;</span>
<span class="nc" id="L1091">        firePropertyChange(APPROVE_BUTTON_TEXT_CHANGED_PROPERTY, oldValue, approveButtonText);</span>
<span class="nc" id="L1092">    }</span>

    /**
     * Returns the text used in the &lt;code&gt;ApproveButton&lt;/code&gt; in the
     * &lt;code&gt;FileChooserUI&lt;/code&gt;.
     * If &lt;code&gt;null&lt;/code&gt;, the UI object will determine the button's text.
     *
     * Typically, this would be &quot;Open&quot; or &quot;Save&quot;.
     *
     * @return the text used in the &lt;code&gt;ApproveButton&lt;/code&gt;
     *
     * @see #setApproveButtonText
     * @see #setDialogType
     * @see #showDialog
     */
    public String getApproveButtonText() {
<span class="nc" id="L1108">        return approveButtonText;</span>
    }

    /**
     * Gets the list of user choosable file filters.
     *
     * @return a &lt;code&gt;FileFilter&lt;/code&gt; array containing all the choosable
     *         file filters
     *
     * @see #addChoosableFileFilter
     * @see #removeChoosableFileFilter
     * @see #resetChoosableFileFilters
     */
    public FileFilter[] getChoosableFileFilters() {
<span class="nc" id="L1122">        FileFilter[] filterArray = new FileFilter[filters.size()];</span>
<span class="nc" id="L1123">        filters.copyInto(filterArray);</span>
<span class="nc" id="L1124">        return filterArray;</span>
    }

    /**
     * Adds a filter to the list of user choosable file filters.
     * For information on setting the file selection mode, see
     * {@link #setFileSelectionMode setFileSelectionMode}.
     *
     * @param filter the &lt;code&gt;FileFilter&lt;/code&gt; to add to the choosable file
     *               filter list
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Adds a filter to the list of user choosable file filters.
     *
     * @see #getChoosableFileFilters
     * @see #removeChoosableFileFilter
     * @see #resetChoosableFileFilters
     * @see #setFileSelectionMode
     */
    public void addChoosableFileFilter(FileFilter filter) {
<span class="nc bnc" id="L1146" title="All 4 branches missed.">        if(filter != null &amp;&amp; !filters.contains(filter)) {</span>
<span class="nc" id="L1147">            FileFilter[] oldValue = getChoosableFileFilters();</span>
<span class="nc" id="L1148">            filters.addElement(filter);</span>
<span class="nc" id="L1149">            firePropertyChange(CHOOSABLE_FILE_FILTER_CHANGED_PROPERTY, oldValue, getChoosableFileFilters());</span>
<span class="nc bnc" id="L1150" title="All 4 branches missed.">            if (fileFilter == null &amp;&amp; filters.size() == 1) {</span>
<span class="nc" id="L1151">                setFileFilter(filter);</span>
            }
        }
<span class="nc" id="L1154">    }</span>

    /**
     * Removes a filter from the list of user choosable file filters. Returns
     * true if the file filter was removed.
     *
     * @see #addChoosableFileFilter
     * @see #getChoosableFileFilters
     * @see #resetChoosableFileFilters
     */
    public boolean removeChoosableFileFilter(FileFilter f) {
<span class="nc" id="L1165">        int index = filters.indexOf(f);</span>
<span class="nc bnc" id="L1166" title="All 2 branches missed.">        if (index &gt;= 0) {</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">            if(getFileFilter() == f) {</span>
<span class="nc" id="L1168">                FileFilter aaff = getAcceptAllFileFilter();</span>
<span class="nc bnc" id="L1169" title="All 4 branches missed.">                if (isAcceptAllFileFilterUsed() &amp;&amp; (aaff != f)) {</span>
                    // choose default filter if it is used
<span class="nc" id="L1171">                    setFileFilter(aaff);</span>
                }
<span class="nc bnc" id="L1173" title="All 2 branches missed.">                else if (index &gt; 0) {</span>
                    // choose the first filter, because it is not removed
<span class="nc" id="L1175">                    setFileFilter(filters.get(0));</span>
                }
<span class="nc bnc" id="L1177" title="All 2 branches missed.">                else if (filters.size() &gt; 1) {</span>
                    // choose the second filter, because the first one is removed
<span class="nc" id="L1179">                    setFileFilter(filters.get(1));</span>
                }
                else {
                    // no more filters
<span class="nc" id="L1183">                    setFileFilter(null);</span>
                }
            }
<span class="nc" id="L1186">            FileFilter[] oldValue = getChoosableFileFilters();</span>
<span class="nc" id="L1187">            filters.removeElement(f);</span>
<span class="nc" id="L1188">            firePropertyChange(CHOOSABLE_FILE_FILTER_CHANGED_PROPERTY, oldValue, getChoosableFileFilters());</span>
<span class="nc" id="L1189">            return true;</span>
        } else {
<span class="nc" id="L1191">            return false;</span>
        }
    }

    /**
     * Resets the choosable file filter list to its starting state. Normally,
     * this removes all added file filters while leaving the
     * &lt;code&gt;AcceptAll&lt;/code&gt; file filter.
     *
     * @see #addChoosableFileFilter
     * @see #getChoosableFileFilters
     * @see #removeChoosableFileFilter
     */
    public void resetChoosableFileFilters() {
<span class="nc" id="L1205">        FileFilter[] oldValue = getChoosableFileFilters();</span>
<span class="nc" id="L1206">        setFileFilter(null);</span>
<span class="nc" id="L1207">        filters.removeAllElements();</span>
<span class="nc bnc" id="L1208" title="All 2 branches missed.">        if(isAcceptAllFileFilterUsed()) {</span>
<span class="nc" id="L1209">           addChoosableFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc" id="L1211">        firePropertyChange(CHOOSABLE_FILE_FILTER_CHANGED_PROPERTY, oldValue, getChoosableFileFilters());</span>
<span class="nc" id="L1212">    }</span>

    /**
     * Returns the &lt;code&gt;AcceptAll&lt;/code&gt; file filter.
     * For example, on Microsoft Windows this would be All Files (*.*).
     */
    public FileFilter getAcceptAllFileFilter() {
<span class="nc" id="L1219">        FileFilter filter = null;</span>
<span class="nc bnc" id="L1220" title="All 2 branches missed.">        if(getUI() != null) {</span>
<span class="nc" id="L1221">            filter = getUI().getAcceptAllFileFilter(this);</span>
        }
<span class="nc" id="L1223">        return filter;</span>
    }

   /**
    * Returns whether the &lt;code&gt;AcceptAll FileFilter&lt;/code&gt; is used.
    * @return true if the &lt;code&gt;AcceptAll FileFilter&lt;/code&gt; is used
    * @see #setAcceptAllFileFilterUsed
    * @since 1.3
    */
    public boolean isAcceptAllFileFilterUsed() {
<span class="nc" id="L1233">        return useAcceptAllFileFilter;</span>
    }

   /**
    * Determines whether the &lt;code&gt;AcceptAll FileFilter&lt;/code&gt; is used
    * as an available choice in the choosable filter list.
    * If false, the &lt;code&gt;AcceptAll&lt;/code&gt; file filter is removed from
    * the list of available file filters.
    * If true, the &lt;code&gt;AcceptAll&lt;/code&gt; file filter will become the
    * the actively used file filter.
    *
    * @beaninfo
    *   preferred: true
    *       bound: true
    * description: Sets whether the AcceptAll FileFilter is used as an available choice in the choosable filter list.
    *
    * @see #isAcceptAllFileFilterUsed
    * @see #getAcceptAllFileFilter
    * @see #setFileFilter
    * @since 1.3
    */
    public void setAcceptAllFileFilterUsed(boolean b) {
<span class="nc" id="L1255">        boolean oldValue = useAcceptAllFileFilter;</span>
<span class="nc" id="L1256">        useAcceptAllFileFilter = b;</span>
<span class="nc bnc" id="L1257" title="All 2 branches missed.">        if(!b) {</span>
<span class="nc" id="L1258">            removeChoosableFileFilter(getAcceptAllFileFilter());</span>
        } else {
<span class="nc" id="L1260">            removeChoosableFileFilter(getAcceptAllFileFilter());</span>
<span class="nc" id="L1261">            addChoosableFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc" id="L1263">        firePropertyChange(ACCEPT_ALL_FILE_FILTER_USED_CHANGED_PROPERTY, oldValue, useAcceptAllFileFilter);</span>
<span class="nc" id="L1264">    }</span>

    /**
     * Returns the accessory component.
     *
     * @return this JFileChooser's accessory component, or null
     * @see #setAccessory
     */
    public JComponent getAccessory() {
<span class="nc" id="L1273">        return accessory;</span>
    }

    /**
     * Sets the accessory component. An accessory is often used to show a
     * preview image of the selected file; however, it can be used for anything
     * that the programmer wishes, such as extra custom file chooser controls.
     *
     * &lt;p&gt;
     * Note: if there was a previous accessory, you should unregister
     * any listeners that the accessory might have registered with the
     * file chooser.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Sets the accessory component on the JFileChooser.
     */
    public void setAccessory(JComponent newAccessory) {
<span class="nc" id="L1292">        JComponent oldValue = accessory;</span>
<span class="nc" id="L1293">        accessory = newAccessory;</span>
<span class="nc" id="L1294">        firePropertyChange(ACCESSORY_CHANGED_PROPERTY, oldValue, accessory);</span>
<span class="nc" id="L1295">    }</span>

    /**
     * Sets the &lt;code&gt;JFileChooser&lt;/code&gt; to allow the user to just
     * select files, just select
     * directories, or select both files and directories.  The default is
     * &lt;code&gt;JFilesChooser.FILES_ONLY&lt;/code&gt;.
     *
     * @param mode the type of files to be displayed:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.FILES_ONLY
     * &lt;li&gt;JFileChooser.DIRECTORIES_ONLY
     * &lt;li&gt;JFileChooser.FILES_AND_DIRECTORIES
     * &lt;/ul&gt;
     *
     * @exception IllegalArgumentException  if &lt;code&gt;mode&lt;/code&gt; is an
     *                          illegal file selection mode
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Sets the types of files that the JFileChooser can choose.
     *        enum: FILES_ONLY JFileChooser.FILES_ONLY
     *              DIRECTORIES_ONLY JFileChooser.DIRECTORIES_ONLY
     *              FILES_AND_DIRECTORIES JFileChooser.FILES_AND_DIRECTORIES
     *
     *
     * @see #getFileSelectionMode
     */
    public void setFileSelectionMode(int mode) {
<span class="nc bnc" id="L1324" title="All 2 branches missed.">        if(fileSelectionMode == mode) {</span>
<span class="nc" id="L1325">            return;</span>
        }

<span class="nc bnc" id="L1328" title="All 6 branches missed.">        if ((mode == FILES_ONLY) || (mode == DIRECTORIES_ONLY) || (mode == FILES_AND_DIRECTORIES)) {</span>
<span class="nc" id="L1329">           int oldValue = fileSelectionMode;</span>
<span class="nc" id="L1330">           fileSelectionMode = mode;</span>
<span class="nc" id="L1331">           firePropertyChange(FILE_SELECTION_MODE_CHANGED_PROPERTY, oldValue, fileSelectionMode);</span>
<span class="nc" id="L1332">        } else {</span>
<span class="nc" id="L1333">           throw new IllegalArgumentException(&quot;Incorrect Mode for file selection: &quot; + mode);</span>
        }
<span class="nc" id="L1335">    }</span>

    /**
     * Returns the current file-selection mode.  The default is
     * &lt;code&gt;JFilesChooser.FILES_ONLY&lt;/code&gt;.
     *
     * @return the type of files to be displayed, one of the following:
     * &lt;ul&gt;
     * &lt;li&gt;JFileChooser.FILES_ONLY
     * &lt;li&gt;JFileChooser.DIRECTORIES_ONLY
     * &lt;li&gt;JFileChooser.FILES_AND_DIRECTORIES
     * &lt;/ul&gt;
     * @see #setFileSelectionMode
     */
    public int getFileSelectionMode() {
<span class="nc" id="L1350">        return fileSelectionMode;</span>
    }

    /**
     * Convenience call that determines if files are selectable based on the
     * current file selection mode.
     *
     * @see #setFileSelectionMode
     * @see #getFileSelectionMode
     */
    public boolean isFileSelectionEnabled() {
<span class="nc bnc" id="L1361" title="All 4 branches missed.">        return ((fileSelectionMode == FILES_ONLY) || (fileSelectionMode == FILES_AND_DIRECTORIES));</span>
    }

    /**
     * Convenience call that determines if directories are selectable based
     * on the current file selection mode.
     *
     * @see #setFileSelectionMode
     * @see #getFileSelectionMode
     */
    public boolean isDirectorySelectionEnabled() {
<span class="nc bnc" id="L1372" title="All 4 branches missed.">        return ((fileSelectionMode == DIRECTORIES_ONLY) || (fileSelectionMode == FILES_AND_DIRECTORIES));</span>
    }

    /**
     * Sets the file chooser to allow multiple file selections.
     *
     * @param b true if multiple files may be selected
     * @beaninfo
     *       bound: true
     * description: Sets multiple file selection mode.
     *
     * @see #isMultiSelectionEnabled
     */
    public void setMultiSelectionEnabled(boolean b) {
<span class="nc bnc" id="L1386" title="All 2 branches missed.">        if(multiSelectionEnabled == b) {</span>
<span class="nc" id="L1387">            return;</span>
        }
<span class="nc" id="L1389">        boolean oldValue = multiSelectionEnabled;</span>
<span class="nc" id="L1390">        multiSelectionEnabled = b;</span>
<span class="nc" id="L1391">        firePropertyChange(MULTI_SELECTION_ENABLED_CHANGED_PROPERTY, oldValue, multiSelectionEnabled);</span>
<span class="nc" id="L1392">    }</span>

    /**
     * Returns true if multiple files can be selected.
     * @return true if multiple files can be selected
     * @see #setMultiSelectionEnabled
     */
    public boolean isMultiSelectionEnabled() {
<span class="nc" id="L1400">        return multiSelectionEnabled;</span>
    }


    /**
     * Returns true if hidden files are not shown in the file chooser;
     * otherwise, returns false.
     *
     * @return the status of the file hiding property
     * @see #setFileHidingEnabled
     */
    public boolean isFileHidingEnabled() {
<span class="nc" id="L1412">        return useFileHiding;</span>
    }

    /**
     * Sets file hiding on or off. If true, hidden files are not shown
     * in the file chooser. The job of determining which files are
     * shown is done by the &lt;code&gt;FileView&lt;/code&gt;.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Sets file hiding on or off.
     *
     * @param b the boolean value that determines whether file hiding is
     *          turned on
     * @see #isFileHidingEnabled
     */
    public void setFileHidingEnabled(boolean b) {
        // Dump showFilesListener since we'll ignore it from now on
<span class="nc bnc" id="L1431" title="All 2 branches missed.">        if (showFilesListener != null) {</span>
<span class="nc" id="L1432">            Toolkit.getDefaultToolkit().removePropertyChangeListener(SHOW_HIDDEN_PROP, showFilesListener);</span>
<span class="nc" id="L1433">            showFilesListener = null;</span>
        }
<span class="nc" id="L1435">        boolean oldValue = useFileHiding;</span>
<span class="nc" id="L1436">        useFileHiding = b;</span>
<span class="nc" id="L1437">        firePropertyChange(FILE_HIDING_CHANGED_PROPERTY, oldValue, useFileHiding);</span>
<span class="nc" id="L1438">    }</span>

    /**
     * Sets the current file filter. The file filter is used by the
     * file chooser to filter out files from the user's view.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Sets the File Filter used to filter out files of type.
     *
     * @param filter the new current file filter to use
     * @see #getFileFilter
     */
    public void setFileFilter(FileFilter filter) {
<span class="nc" id="L1453">        FileFilter oldValue = fileFilter;</span>
<span class="nc" id="L1454">        fileFilter = filter;</span>
<span class="nc bnc" id="L1455" title="All 2 branches missed.">        if (filter != null) {</span>
<span class="nc bnc" id="L1456" title="All 6 branches missed.">            if (isMultiSelectionEnabled() &amp;&amp; selectedFiles != null &amp;&amp; selectedFiles.length &gt; 0) {</span>
<span class="nc" id="L1457">                Vector&lt;File&gt; fList = new Vector&lt;File&gt;();</span>
<span class="nc" id="L1458">                boolean failed = false;</span>
<span class="nc bnc" id="L1459" title="All 2 branches missed.">                for (File file : selectedFiles) {</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">                    if (filter.accept(file)) {</span>
<span class="nc" id="L1461">                        fList.add(file);</span>
                    } else {
<span class="nc" id="L1463">                        failed = true;</span>
                    }
                }
<span class="nc bnc" id="L1466" title="All 2 branches missed.">                if (failed) {</span>
<span class="nc bnc" id="L1467" title="All 2 branches missed.">                    setSelectedFiles((fList.size() == 0) ? null : fList.toArray(new File[fList.size()]));</span>
                }
<span class="nc bnc" id="L1469" title="All 4 branches missed.">            } else if (selectedFile != null &amp;&amp; !filter.accept(selectedFile)) {</span>
<span class="nc" id="L1470">                setSelectedFile(null);</span>
            }
        }
<span class="nc" id="L1473">        firePropertyChange(FILE_FILTER_CHANGED_PROPERTY, oldValue, fileFilter);</span>
<span class="nc" id="L1474">    }</span>


    /**
     * Returns the currently selected file filter.
     *
     * @return the current file filter
     * @see #setFileFilter
     * @see #addChoosableFileFilter
     */
    public FileFilter getFileFilter() {
<span class="nc" id="L1485">        return fileFilter;</span>
    }

    /**
     * Sets the file view to used to retrieve UI information, such as
     * the icon that represents a file or the type description of a file.
     *
     * @beaninfo
     *   preferred: true
     *       bound: true
     * description: Sets the File View used to get file type information.
     *
     * @see #getFileView
     */
    public void setFileView(FileView fileView) {
<span class="nc" id="L1500">        FileView oldValue = this.fileView;</span>
<span class="nc" id="L1501">        this.fileView = fileView;</span>
<span class="nc" id="L1502">        firePropertyChange(FILE_VIEW_CHANGED_PROPERTY, oldValue, fileView);</span>
<span class="nc" id="L1503">    }</span>

    /**
     * Returns the current file view.
     *
     * @see #setFileView
     */
    public FileView getFileView() {
<span class="nc" id="L1511">        return fileView;</span>
    }

    // ******************************
    // *****FileView delegation *****
    // ******************************

    // NOTE: all of the following methods attempt to delegate
    // first to the client set fileView, and if &lt;code&gt;null&lt;/code&gt; is returned
    // (or there is now client defined fileView) then calls the
    // UI's default fileView.

    /**
     * Returns the filename.
     * @param f the &lt;code&gt;File&lt;/code&gt;
     * @return the &lt;code&gt;String&lt;/code&gt; containing the filename for
     *          &lt;code&gt;f&lt;/code&gt;
     * @see FileView#getName
     */
    public String getName(File f) {
<span class="nc" id="L1531">        String filename = null;</span>
<span class="nc bnc" id="L1532" title="All 2 branches missed.">        if(f != null) {</span>
<span class="nc bnc" id="L1533" title="All 2 branches missed.">            if(getFileView() != null) {</span>
<span class="nc" id="L1534">                filename = getFileView().getName(f);</span>
            }

<span class="nc" id="L1537">            FileView uiFileView = getUI().getFileView(this);</span>

<span class="nc bnc" id="L1539" title="All 4 branches missed.">            if(filename == null &amp;&amp; uiFileView != null) {</span>
<span class="nc" id="L1540">                filename = uiFileView.getName(f);</span>
            }
        }
<span class="nc" id="L1543">        return filename;</span>
    }

    /**
     * Returns the file description.
     * @param f the &lt;code&gt;File&lt;/code&gt;
     * @return the &lt;code&gt;String&lt;/code&gt; containing the file description for
     *          &lt;code&gt;f&lt;/code&gt;
     * @see FileView#getDescription
     */
    public String getDescription(File f) {
<span class="nc" id="L1554">        String description = null;</span>
<span class="nc bnc" id="L1555" title="All 2 branches missed.">        if(f != null) {</span>
<span class="nc bnc" id="L1556" title="All 2 branches missed.">            if(getFileView() != null) {</span>
<span class="nc" id="L1557">                description = getFileView().getDescription(f);</span>
            }

<span class="nc" id="L1560">            FileView uiFileView = getUI().getFileView(this);</span>

<span class="nc bnc" id="L1562" title="All 4 branches missed.">            if(description == null &amp;&amp; uiFileView != null) {</span>
<span class="nc" id="L1563">                description = uiFileView.getDescription(f);</span>
            }
        }
<span class="nc" id="L1566">        return description;</span>
    }

    /**
     * Returns the file type.
     * @param f the &lt;code&gt;File&lt;/code&gt;
     * @return the &lt;code&gt;String&lt;/code&gt; containing the file type description for
     *          &lt;code&gt;f&lt;/code&gt;
     * @see FileView#getTypeDescription
     */
    public String getTypeDescription(File f) {
<span class="nc" id="L1577">        String typeDescription = null;</span>
<span class="nc bnc" id="L1578" title="All 2 branches missed.">        if(f != null) {</span>
<span class="nc bnc" id="L1579" title="All 2 branches missed.">            if(getFileView() != null) {</span>
<span class="nc" id="L1580">                typeDescription = getFileView().getTypeDescription(f);</span>
            }

<span class="nc" id="L1583">            FileView uiFileView = getUI().getFileView(this);</span>

<span class="nc bnc" id="L1585" title="All 4 branches missed.">            if(typeDescription == null &amp;&amp; uiFileView != null) {</span>
<span class="nc" id="L1586">                typeDescription = uiFileView.getTypeDescription(f);</span>
            }
        }
<span class="nc" id="L1589">        return typeDescription;</span>
    }

    /**
     * Returns the icon for this file or type of file, depending
     * on the system.
     * @param f the &lt;code&gt;File&lt;/code&gt;
     * @return the &lt;code&gt;Icon&lt;/code&gt; for this file, or type of file
     * @see FileView#getIcon
     */
    public Icon getIcon(File f) {
<span class="nc" id="L1600">        Icon icon = null;</span>
<span class="nc bnc" id="L1601" title="All 2 branches missed.">        if (f != null) {</span>
<span class="nc bnc" id="L1602" title="All 2 branches missed.">            if(getFileView() != null) {</span>
<span class="nc" id="L1603">                icon = getFileView().getIcon(f);</span>
            }

<span class="nc" id="L1606">            FileView uiFileView = getUI().getFileView(this);</span>

<span class="nc bnc" id="L1608" title="All 4 branches missed.">            if(icon == null &amp;&amp; uiFileView != null) {</span>
<span class="nc" id="L1609">                icon = uiFileView.getIcon(f);</span>
            }
        }
<span class="nc" id="L1612">        return icon;</span>
    }

    /**
     * Returns true if the file (directory) can be visited.
     * Returns false if the directory cannot be traversed.
     * @param f the &lt;code&gt;File&lt;/code&gt;
     * @return true if the file/directory can be traversed, otherwise false
     * @see FileView#isTraversable
     */
    public boolean isTraversable(File f) {
<span class="nc" id="L1623">        Boolean traversable = null;</span>
<span class="nc bnc" id="L1624" title="All 2 branches missed.">        if (f != null) {</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">            if (getFileView() != null) {</span>
<span class="nc" id="L1626">                traversable = getFileView().isTraversable(f);</span>
            }

<span class="nc" id="L1629">            FileView uiFileView = getUI().getFileView(this);</span>

<span class="nc bnc" id="L1631" title="All 4 branches missed.">            if (traversable == null &amp;&amp; uiFileView != null) {</span>
<span class="nc" id="L1632">                traversable = uiFileView.isTraversable(f);</span>
            }
<span class="nc bnc" id="L1634" title="All 2 branches missed.">            if (traversable == null) {</span>
<span class="nc" id="L1635">                traversable = getFileSystemView().isTraversable(f);</span>
            }
        }
<span class="nc bnc" id="L1638" title="All 4 branches missed.">        return (traversable != null &amp;&amp; traversable.booleanValue());</span>
    }

    /**
     * Returns true if the file should be displayed.
     * @param f the &lt;code&gt;File&lt;/code&gt;
     * @return true if the file should be displayed, otherwise false
     * @see FileFilter#accept
     */
    public boolean accept(File f) {
<span class="nc" id="L1648">        boolean shown = true;</span>
<span class="nc bnc" id="L1649" title="All 4 branches missed.">        if(f != null &amp;&amp; fileFilter != null) {</span>
<span class="nc" id="L1650">            shown = fileFilter.accept(f);</span>
        }
<span class="nc" id="L1652">        return shown;</span>
    }

    /**
     * Sets the file system view that the &lt;code&gt;JFileChooser&lt;/code&gt; uses for
     * accessing and creating file system resources, such as finding
     * the floppy drive and getting a list of root drives.
     * @param fsv  the new &lt;code&gt;FileSystemView&lt;/code&gt;
     *
     * @beaninfo
     *      expert: true
     *       bound: true
     * description: Sets the FileSytemView used to get filesystem information.
     *
     * @see FileSystemView
     */
    public void setFileSystemView(FileSystemView fsv) {
<span class="nc" id="L1669">        FileSystemView oldValue = fileSystemView;</span>
<span class="nc" id="L1670">        fileSystemView = fsv;</span>
<span class="nc" id="L1671">        firePropertyChange(FILE_SYSTEM_VIEW_CHANGED_PROPERTY, oldValue, fileSystemView);</span>
<span class="nc" id="L1672">    }</span>

    /**
     * Returns the file system view.
     * @return the &lt;code&gt;FileSystemView&lt;/code&gt; object
     * @see #setFileSystemView
     */
    public FileSystemView getFileSystemView() {
<span class="nc" id="L1680">        return fileSystemView;</span>
    }

    // **************************
    // ***** Event Handling *****
    // **************************

    /**
     * Called by the UI when the user hits the Approve button
     * (labeled &quot;Open&quot; or &quot;Save&quot;, by default). This can also be
     * called by the programmer.
     * This method causes an action event to fire
     * with the command string equal to
     * &lt;code&gt;APPROVE_SELECTION&lt;/code&gt;.
     *
     * @see #APPROVE_SELECTION
     */
    public void approveSelection() {
<span class="nc" id="L1698">        returnValue = APPROVE_OPTION;</span>
<span class="nc bnc" id="L1699" title="All 2 branches missed.">        if(dialog != null) {</span>
<span class="nc" id="L1700">            dialog.setVisible(false);</span>
        }
<span class="nc" id="L1702">        fireActionPerformed(APPROVE_SELECTION);</span>
<span class="nc" id="L1703">    }</span>

    /**
     * Called by the UI when the user chooses the Cancel button.
     * This can also be called by the programmer.
     * This method causes an action event to fire
     * with the command string equal to
     * &lt;code&gt;CANCEL_SELECTION&lt;/code&gt;.
     *
     * @see #CANCEL_SELECTION
     */
    public void cancelSelection() {
<span class="nc" id="L1715">        returnValue = CANCEL_OPTION;</span>
<span class="nc bnc" id="L1716" title="All 2 branches missed.">        if(dialog != null) {</span>
<span class="nc" id="L1717">            dialog.setVisible(false);</span>
        }
<span class="nc" id="L1719">        fireActionPerformed(CANCEL_SELECTION);</span>
<span class="nc" id="L1720">    }</span>

    /**
     * Adds an &lt;code&gt;ActionListener&lt;/code&gt; to the file chooser.
     *
     * @param l  the listener to be added
     *
     * @see #approveSelection
     * @see #cancelSelection
     */
    public void addActionListener(ActionListener l) {
<span class="nc" id="L1731">        listenerList.add(ActionListener.class, l);</span>
<span class="nc" id="L1732">    }</span>

    /**
     * Removes an &lt;code&gt;ActionListener&lt;/code&gt; from the file chooser.
     *
     * @param l  the listener to be removed
     *
     * @see #addActionListener
     */
    public void removeActionListener(ActionListener l) {
<span class="nc" id="L1742">        listenerList.remove(ActionListener.class, l);</span>
<span class="nc" id="L1743">    }</span>

    /**
     * Returns an array of all the action listeners
     * registered on this file chooser.
     *
     * @return all of this file chooser's &lt;code&gt;ActionListener&lt;/code&gt;s
     *         or an empty
     *         array if no action listeners are currently registered
     *
     * @see #addActionListener
     * @see #removeActionListener
     *
     * @since 1.4
     */
    public ActionListener[] getActionListeners() {
<span class="nc" id="L1759">        return listenerList.getListeners(ActionListener.class);</span>
    }

    /**
     * Notifies all listeners that have registered interest for
     * notification on this event type. The event instance
     * is lazily created using the &lt;code&gt;command&lt;/code&gt; parameter.
     *
     * @see EventListenerList
     */
    protected void fireActionPerformed(String command) {
        // Guaranteed to return a non-null array
<span class="nc" id="L1771">        Object[] listeners = listenerList.getListenerList();</span>
<span class="nc" id="L1772">        long mostRecentEventTime = EventQueue.getMostRecentEventTime();</span>
<span class="nc" id="L1773">        int modifiers = 0;</span>
<span class="nc" id="L1774">        AWTEvent currentEvent = EventQueue.getCurrentEvent();</span>
<span class="nc bnc" id="L1775" title="All 2 branches missed.">        if (currentEvent instanceof InputEvent) {</span>
<span class="nc" id="L1776">            modifiers = ((InputEvent)currentEvent).getModifiers();</span>
<span class="nc bnc" id="L1777" title="All 2 branches missed.">        } else if (currentEvent instanceof ActionEvent) {</span>
<span class="nc" id="L1778">            modifiers = ((ActionEvent)currentEvent).getModifiers();</span>
        }
<span class="nc" id="L1780">        ActionEvent e = null;</span>
        // Process the listeners last to first, notifying
        // those that are interested in this event
<span class="nc bnc" id="L1783" title="All 2 branches missed.">        for (int i = listeners.length-2; i&gt;=0; i-=2) {</span>
<span class="nc bnc" id="L1784" title="All 2 branches missed.">            if (listeners[i]==ActionListener.class) {</span>
                // Lazily create the event:
<span class="nc bnc" id="L1786" title="All 2 branches missed.">                if (e == null) {</span>
<span class="nc" id="L1787">                    e = new ActionEvent(this, ActionEvent.ACTION_PERFORMED,</span>
                                        command, mostRecentEventTime,
                                        modifiers);
                }
<span class="nc" id="L1791">                ((ActionListener)listeners[i+1]).actionPerformed(e);</span>
            }
        }
<span class="nc" id="L1794">    }</span>

<span class="nc bnc" id="L1796" title="All 2 branches missed.">    private static class WeakPCL implements PropertyChangeListener {</span>
        WeakReference&lt;JFileChooser&gt; jfcRef;

<span class="nc" id="L1799">        public WeakPCL(JFileChooser jfc) {</span>
<span class="nc" id="L1800">            jfcRef = new WeakReference&lt;JFileChooser&gt;(jfc);</span>
<span class="nc" id="L1801">        }</span>
        public void propertyChange(PropertyChangeEvent ev) {
<span class="nc bnc" id="L1803" title="All 4 branches missed.">            assert ev.getPropertyName().equals(SHOW_HIDDEN_PROP);</span>
<span class="nc" id="L1804">            JFileChooser jfc = jfcRef.get();</span>
<span class="nc bnc" id="L1805" title="All 2 branches missed.">            if (jfc == null) {</span>
                // Our JFileChooser is no longer around, so we no longer need to
                // listen for PropertyChangeEvents.
<span class="nc" id="L1808">                Toolkit.getDefaultToolkit().removePropertyChangeListener(SHOW_HIDDEN_PROP, this);</span>
            }
            else {
<span class="nc" id="L1811">                boolean oldValue = jfc.useFileHiding;</span>
<span class="nc bnc" id="L1812" title="All 2 branches missed.">                jfc.useFileHiding = !((Boolean)ev.getNewValue()).booleanValue();</span>
<span class="nc" id="L1813">                jfc.firePropertyChange(FILE_HIDING_CHANGED_PROPERTY, oldValue, jfc.useFileHiding);</span>
            }
<span class="nc" id="L1815">        }</span>
    }

    // *********************************
    // ***** Pluggable L&amp;F methods *****
    // *********************************

    /**
     * Resets the UI property to a value from the current look and feel.
     *
     * @see JComponent#updateUI
     */
    public void updateUI() {
<span class="nc bnc" id="L1828" title="All 2 branches missed.">        if (isAcceptAllFileFilterUsed()) {</span>
<span class="nc" id="L1829">            removeChoosableFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc" id="L1831">        FileChooserUI ui = ((FileChooserUI)UIManager.getUI(this));</span>
<span class="nc bnc" id="L1832" title="All 2 branches missed.">        if (fileSystemView == null) {</span>
            // We were probably deserialized
<span class="nc" id="L1834">            setFileSystemView(FileSystemView.getFileSystemView());</span>
        }
<span class="nc" id="L1836">        setUI(ui);</span>

<span class="nc bnc" id="L1838" title="All 2 branches missed.">        if(isAcceptAllFileFilterUsed()) {</span>
<span class="nc" id="L1839">            addChoosableFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc" id="L1841">    }</span>

    /**
     * Returns a string that specifies the name of the L&amp;amp;F class
     * that renders this component.
     *
     * @return the string &quot;FileChooserUI&quot;
     * @see JComponent#getUIClassID
     * @see UIDefaults#getUI
     * @beaninfo
     *        expert: true
     *   description: A string that specifies the name of the L&amp;amp;F class.
     */
    public String getUIClassID() {
<span class="nc" id="L1855">        return uiClassID;</span>
    }

    /**
     * Gets the UI object which implements the L&amp;amp;F for this component.
     *
     * @return the FileChooserUI object that implements the FileChooserUI L&amp;amp;F
     */
    public FileChooserUI getUI() {
<span class="nc" id="L1864">        return (FileChooserUI) ui;</span>
    }

    /**
     * See &lt;code&gt;readObject&lt;/code&gt; and &lt;code&gt;writeObject&lt;/code&gt; in
     * &lt;code&gt;JComponent&lt;/code&gt; for more
     * information about serialization in Swing.
     */
    private void readObject(java.io.ObjectInputStream in)
            throws IOException, ClassNotFoundException {
<span class="nc" id="L1874">        in.defaultReadObject();</span>
<span class="nc" id="L1875">        installShowFilesListener();</span>
<span class="nc" id="L1876">    }</span>

    /**
     * See &lt;code&gt;readObject&lt;/code&gt; and &lt;code&gt;writeObject&lt;/code&gt; in
     * &lt;code&gt;JComponent&lt;/code&gt; for more
     * information about serialization in Swing.
     */
    private void writeObject(ObjectOutputStream s) throws IOException {
<span class="nc" id="L1884">        FileSystemView fsv = null;</span>

<span class="nc bnc" id="L1886" title="All 2 branches missed.">        if (isAcceptAllFileFilterUsed()) {</span>
            //The AcceptAllFileFilter is UI specific, it will be reset by
            //updateUI() after deserialization
<span class="nc" id="L1889">            removeChoosableFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc bnc" id="L1891" title="All 2 branches missed.">        if (fileSystemView.equals(FileSystemView.getFileSystemView())) {</span>
            //The default FileSystemView is platform specific, it will be
            //reset by updateUI() after deserialization
<span class="nc" id="L1894">            fsv = fileSystemView;</span>
<span class="nc" id="L1895">            fileSystemView = null;</span>
        }
<span class="nc" id="L1897">        s.defaultWriteObject();</span>
<span class="nc bnc" id="L1898" title="All 2 branches missed.">        if (fsv != null) {</span>
<span class="nc" id="L1899">            fileSystemView = fsv;</span>
        }
<span class="nc bnc" id="L1901" title="All 2 branches missed.">        if (isAcceptAllFileFilterUsed()) {</span>
<span class="nc" id="L1902">            addChoosableFileFilter(getAcceptAllFileFilter());</span>
        }
<span class="nc bnc" id="L1904" title="All 2 branches missed.">        if (getUIClassID().equals(uiClassID)) {</span>
<span class="nc" id="L1905">            byte count = JComponent.getWriteObjCounter(this);</span>
<span class="nc" id="L1906">            JComponent.setWriteObjCounter(this, --count);</span>
<span class="nc bnc" id="L1907" title="All 4 branches missed.">            if (count == 0 &amp;&amp; ui != null) {</span>
<span class="nc" id="L1908">                ui.installUI(this);</span>
            }
        }
<span class="nc" id="L1911">    }</span>


    /**
     * Returns a string representation of this &lt;code&gt;JFileChooser&lt;/code&gt;.
     * This method
     * is intended to be used only for debugging purposes, and the
     * content and format of the returned string may vary between
     * implementations. The returned string may be empty but may not
     * be &lt;code&gt;null&lt;/code&gt;.
     *
     * @return  a string representation of this &lt;code&gt;JFileChooser&lt;/code&gt;
     */
    protected String paramString() {
<span class="nc bnc" id="L1925" title="All 2 branches missed.">        String approveButtonTextString = (approveButtonText != null ?</span>
                                          approveButtonText: &quot;&quot;);
<span class="nc bnc" id="L1927" title="All 2 branches missed.">        String dialogTitleString = (dialogTitle != null ?</span>
                                    dialogTitle: &quot;&quot;);
        String dialogTypeString;
<span class="nc bnc" id="L1930" title="All 2 branches missed.">        if (dialogType == OPEN_DIALOG) {</span>
<span class="nc" id="L1931">            dialogTypeString = &quot;OPEN_DIALOG&quot;;</span>
<span class="nc bnc" id="L1932" title="All 2 branches missed.">        } else if (dialogType == SAVE_DIALOG) {</span>
<span class="nc" id="L1933">            dialogTypeString = &quot;SAVE_DIALOG&quot;;</span>
<span class="nc bnc" id="L1934" title="All 2 branches missed.">        } else if (dialogType == CUSTOM_DIALOG) {</span>
<span class="nc" id="L1935">            dialogTypeString = &quot;CUSTOM_DIALOG&quot;;</span>
<span class="nc" id="L1936">        } else dialogTypeString = &quot;&quot;;</span>
        String returnValueString;
<span class="nc bnc" id="L1938" title="All 2 branches missed.">        if (returnValue == CANCEL_OPTION) {</span>
<span class="nc" id="L1939">            returnValueString = &quot;CANCEL_OPTION&quot;;</span>
<span class="nc bnc" id="L1940" title="All 2 branches missed.">        } else if (returnValue == APPROVE_OPTION) {</span>
<span class="nc" id="L1941">            returnValueString = &quot;APPROVE_OPTION&quot;;</span>
<span class="nc bnc" id="L1942" title="All 2 branches missed.">        } else if (returnValue == ERROR_OPTION) {</span>
<span class="nc" id="L1943">            returnValueString = &quot;ERROR_OPTION&quot;;</span>
<span class="nc" id="L1944">        } else returnValueString = &quot;&quot;;</span>
<span class="nc bnc" id="L1945" title="All 2 branches missed.">        String useFileHidingString = (useFileHiding ?</span>
                                    &quot;true&quot; : &quot;false&quot;);
        String fileSelectionModeString;
<span class="nc bnc" id="L1948" title="All 2 branches missed.">        if (fileSelectionMode == FILES_ONLY) {</span>
<span class="nc" id="L1949">            fileSelectionModeString = &quot;FILES_ONLY&quot;;</span>
<span class="nc bnc" id="L1950" title="All 2 branches missed.">        } else if (fileSelectionMode == DIRECTORIES_ONLY) {</span>
<span class="nc" id="L1951">            fileSelectionModeString = &quot;DIRECTORIES_ONLY&quot;;</span>
<span class="nc bnc" id="L1952" title="All 2 branches missed.">        } else if (fileSelectionMode == FILES_AND_DIRECTORIES) {</span>
<span class="nc" id="L1953">            fileSelectionModeString = &quot;FILES_AND_DIRECTORIES&quot;;</span>
<span class="nc" id="L1954">        } else fileSelectionModeString = &quot;&quot;;</span>
<span class="nc bnc" id="L1955" title="All 2 branches missed.">        String currentDirectoryString = (currentDirectory != null ?</span>
<span class="nc" id="L1956">                                         currentDirectory.toString() : &quot;&quot;);</span>
<span class="nc bnc" id="L1957" title="All 2 branches missed.">        String selectedFileString = (selectedFile != null ?</span>
<span class="nc" id="L1958">                                     selectedFile.toString() : &quot;&quot;);</span>

<span class="nc" id="L1960">        return super.paramString() +</span>
        &quot;,approveButtonText=&quot; + approveButtonTextString +
        &quot;,currentDirectory=&quot; + currentDirectoryString +
        &quot;,dialogTitle=&quot; + dialogTitleString +
        &quot;,dialogType=&quot; + dialogTypeString +
        &quot;,fileSelectionMode=&quot; + fileSelectionModeString +
        &quot;,returnValue=&quot; + returnValueString +
        &quot;,selectedFile=&quot; + selectedFileString +
        &quot;,useFileHiding=&quot; + useFileHidingString;
    }

/////////////////
// Accessibility support
////////////////

<span class="nc" id="L1975">    protected AccessibleContext accessibleContext = null;</span>

    /**
     * Gets the AccessibleContext associated with this JFileChooser.
     * For file choosers, the AccessibleContext takes the form of an
     * AccessibleJFileChooser.
     * A new AccessibleJFileChooser instance is created if necessary.
     *
     * @return an AccessibleJFileChooser that serves as the
     *         AccessibleContext of this JFileChooser
     */
    public AccessibleContext getAccessibleContext() {
<span class="nc bnc" id="L1987" title="All 2 branches missed.">        if (accessibleContext == null) {</span>
<span class="nc" id="L1988">            accessibleContext = new AccessibleJFileChooser();</span>
        }
<span class="nc" id="L1990">        return accessibleContext;</span>
    }

    /**
     * This class implements accessibility support for the
     * &lt;code&gt;JFileChooser&lt;/code&gt; class.  It provides an implementation of the
     * Java Accessibility API appropriate to file chooser user-interface
     * elements.
     */
<span class="nc" id="L1999">    protected class AccessibleJFileChooser extends AccessibleJComponent {</span>

        /**
         * Gets the role of this object.
         *
         * @return an instance of AccessibleRole describing the role of the
         * object
         * @see AccessibleRole
         */
        public AccessibleRole getAccessibleRole() {
<span class="nc" id="L2009">            return AccessibleRole.FILE_CHOOSER;</span>
        }

    } // inner class AccessibleJFileChooser

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>