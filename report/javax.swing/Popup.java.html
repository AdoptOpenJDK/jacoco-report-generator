<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>Popup.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing</a> &gt; <span class="el_source">Popup.java</span></div><h1>Popup.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing;

import java.awt.*;

import sun.awt.ModalExclude;
import sun.awt.SunToolkit;

/**
 * Popups are used to display a &lt;code&gt;Component&lt;/code&gt; to the user, typically
 * on top of all the other &lt;code&gt;Component&lt;/code&gt;s in a particular containment
 * hierarchy. &lt;code&gt;Popup&lt;/code&gt;s have a very small life cycle. Once you
 * have obtained a &lt;code&gt;Popup&lt;/code&gt;, and hidden it (invoked the
 * &lt;code&gt;hide&lt;/code&gt; method), you should no longer
 * invoke any methods on it. This allows the &lt;code&gt;PopupFactory&lt;/code&gt; to cache
 * &lt;code&gt;Popup&lt;/code&gt;s for later use.
 * &lt;p&gt;
 * The general contract is that if you need to change the size of the
 * &lt;code&gt;Component&lt;/code&gt;, or location of the &lt;code&gt;Popup&lt;/code&gt;, you should
 * obtain a new &lt;code&gt;Popup&lt;/code&gt;.
 * &lt;p&gt;
 * &lt;code&gt;Popup&lt;/code&gt; does not descend from &lt;code&gt;Component&lt;/code&gt;, rather
 * implementations of &lt;code&gt;Popup&lt;/code&gt; are responsible for creating
 * and maintaining their own &lt;code&gt;Component&lt;/code&gt;s to render the
 * requested &lt;code&gt;Component&lt;/code&gt; to the user.
 * &lt;p&gt;
 * You typically do not explicitly create an instance of &lt;code&gt;Popup&lt;/code&gt;,
 * instead obtain one from a &lt;code&gt;PopupFactory&lt;/code&gt;.
 *
 * @see PopupFactory
 *
 * @since 1.4
 */
public class Popup {
    /**
     * The Component representing the Popup.
     */
    private Component component;

    /**
     * Creates a &lt;code&gt;Popup&lt;/code&gt; for the Component &lt;code&gt;owner&lt;/code&gt;
     * containing the Component &lt;code&gt;contents&lt;/code&gt;. &lt;code&gt;owner&lt;/code&gt;
     * is used to determine which &lt;code&gt;Window&lt;/code&gt; the new
     * &lt;code&gt;Popup&lt;/code&gt; will parent the &lt;code&gt;Component&lt;/code&gt; the
     * &lt;code&gt;Popup&lt;/code&gt; creates to.
     * A null &lt;code&gt;owner&lt;/code&gt; implies there is no valid parent.
     * &lt;code&gt;x&lt;/code&gt; and
     * &lt;code&gt;y&lt;/code&gt; specify the preferred initial location to place
     * the &lt;code&gt;Popup&lt;/code&gt; at. Based on screen size, or other paramaters,
     * the &lt;code&gt;Popup&lt;/code&gt; may not display at &lt;code&gt;x&lt;/code&gt; and
     * &lt;code&gt;y&lt;/code&gt;.
     *
     * @param owner    Component mouse coordinates are relative to, may be null
     * @param contents Contents of the Popup
     * @param x        Initial x screen coordinate
     * @param y        Initial y screen coordinate
     * @exception IllegalArgumentException if contents is null
     */
    protected Popup(Component owner, Component contents, int x, int y) {
<span class="nc" id="L84">        this();</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (contents == null) {</span>
<span class="nc" id="L86">            throw new IllegalArgumentException(&quot;Contents must be non-null&quot;);</span>
        }
<span class="nc" id="L88">        reset(owner, contents, x, y);</span>
<span class="nc" id="L89">    }</span>

    /**
     * Creates a &lt;code&gt;Popup&lt;/code&gt;. This is provided for subclasses.
     */
<span class="nc" id="L94">    protected Popup() {</span>
<span class="nc" id="L95">    }</span>

    /**
     * Makes the &lt;code&gt;Popup&lt;/code&gt; visible. If the &lt;code&gt;Popup&lt;/code&gt; is
     * currently visible, this has no effect.
     */

    @SuppressWarnings(&quot;deprecation&quot;)
    public void show() {
<span class="nc" id="L104">        Component component = getComponent();</span>

<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (component != null) {</span>
<span class="nc" id="L107">            component.show();</span>
        }
<span class="nc" id="L109">    }</span>

    /**
     * Hides and disposes of the &lt;code&gt;Popup&lt;/code&gt;. Once a &lt;code&gt;Popup&lt;/code&gt;
     * has been disposed you should no longer invoke methods on it. A
     * &lt;code&gt;dispose&lt;/code&gt;d &lt;code&gt;Popup&lt;/code&gt; may be reclaimed and later used
     * based on the &lt;code&gt;PopupFactory&lt;/code&gt;. As such, if you invoke methods
     * on a &lt;code&gt;disposed&lt;/code&gt; &lt;code&gt;Popup&lt;/code&gt;, indeterminate
     * behavior will result.
     */

    @SuppressWarnings(&quot;deprecation&quot;)
    public void hide() {
<span class="nc" id="L122">        Component component = getComponent();</span>

<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (component instanceof JWindow) {</span>
<span class="nc" id="L125">            component.hide();</span>
<span class="nc" id="L126">            ((JWindow)component).getContentPane().removeAll();</span>
        }
<span class="nc" id="L128">        dispose();</span>
<span class="nc" id="L129">    }</span>

    /**
     * Frees any resources the &lt;code&gt;Popup&lt;/code&gt; may be holding onto.
     */
    void dispose() {
<span class="nc" id="L135">        Component component = getComponent();</span>
<span class="nc" id="L136">        Window window = SwingUtilities.getWindowAncestor(component);</span>

<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (component instanceof JWindow) {</span>
<span class="nc" id="L139">            ((Window)component).dispose();</span>
<span class="nc" id="L140">            component = null;</span>
        }
        // If our parent is a DefaultFrame, we need to dispose it, too.
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (window instanceof DefaultFrame) {</span>
<span class="nc" id="L144">            window.dispose();</span>
        }
<span class="nc" id="L146">    }</span>

    /**
     * Resets the &lt;code&gt;Popup&lt;/code&gt; to an initial state.
     */
    void reset(Component owner, Component contents, int ownerX, int ownerY) {
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (getComponent() == null) {</span>
<span class="nc" id="L153">            component = createComponent(owner);</span>
        }

<span class="nc" id="L156">        Component c = getComponent();</span>

<span class="nc bnc" id="L158" title="All 2 branches missed.">        if (c instanceof JWindow) {</span>
<span class="nc" id="L159">            JWindow component = (JWindow)getComponent();</span>

<span class="nc" id="L161">            component.setLocation(ownerX, ownerY);</span>
<span class="nc" id="L162">            component.getContentPane().add(contents, BorderLayout.CENTER);</span>
<span class="nc" id="L163">            component.invalidate();</span>
<span class="nc" id="L164">            component.validate();</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">            if(component.isVisible()) {</span>
                // Do not call pack() if window is not visible to
                // avoid early native peer creation
<span class="nc" id="L168">                pack();</span>
            }
        }
<span class="nc" id="L171">    }</span>


    /**
     * Causes the &lt;code&gt;Popup&lt;/code&gt; to be sized to fit the preferred size
     * of the &lt;code&gt;Component&lt;/code&gt; it contains.
     */
    void pack() {
<span class="nc" id="L179">        Component component = getComponent();</span>

<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (component instanceof Window) {</span>
<span class="nc" id="L182">            ((Window)component).pack();</span>
        }
<span class="nc" id="L184">    }</span>

    /**
     * Returns the &lt;code&gt;Window&lt;/code&gt; to use as the parent of the
     * &lt;code&gt;Window&lt;/code&gt; created for the &lt;code&gt;Popup&lt;/code&gt;. This creates
     * a new &lt;code&gt;DefaultFrame&lt;/code&gt;, if necessary.
     */
    private Window getParentWindow(Component owner) {
<span class="nc" id="L192">        Window window = null;</span>

<span class="nc bnc" id="L194" title="All 2 branches missed.">        if (owner instanceof Window) {</span>
<span class="nc" id="L195">            window = (Window)owner;</span>
        }
<span class="nc bnc" id="L197" title="All 2 branches missed.">        else if (owner != null) {</span>
<span class="nc" id="L198">            window = SwingUtilities.getWindowAncestor(owner);</span>
        }
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (window == null) {</span>
<span class="nc" id="L201">            window = new DefaultFrame();</span>
        }
<span class="nc" id="L203">        return window;</span>
    }

    /**
     * Creates the Component to use as the parent of the &lt;code&gt;Popup&lt;/code&gt;.
     * The default implementation creates a &lt;code&gt;Window&lt;/code&gt;, subclasses
     * should override.
     */
    Component createComponent(Component owner) {
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (GraphicsEnvironment.isHeadless()) {</span>
            // Generally not useful, bail.
<span class="nc" id="L214">            return null;</span>
        }
<span class="nc" id="L216">        return new HeavyWeightWindow(getParentWindow(owner));</span>
    }

    /**
     * Returns the &lt;code&gt;Component&lt;/code&gt; returned from
     * &lt;code&gt;createComponent&lt;/code&gt; that will hold the &lt;code&gt;Popup&lt;/code&gt;.
     */
    Component getComponent() {
<span class="nc" id="L224">        return component;</span>
    }


    /**
     * Component used to house window.
     */
    static class HeavyWeightWindow extends JWindow implements ModalExclude {
        HeavyWeightWindow(Window parent) {
<span class="nc" id="L233">            super(parent);</span>
<span class="nc" id="L234">            setFocusableWindowState(false);</span>
<span class="nc" id="L235">            setType(Window.Type.POPUP);</span>

            // Popups are typically transient and most likely won't benefit
            // from true double buffering.  Turn it off here.
<span class="nc" id="L239">            getRootPane().setUseTrueDoubleBuffering(false);</span>
            // Try to set &quot;always-on-top&quot; for the popup window.
            // Applets usually don't have sufficient permissions to do it.
            // In this case simply ignore the exception.
            try {
<span class="nc" id="L244">                setAlwaysOnTop(true);</span>
<span class="nc" id="L245">            } catch (SecurityException se) {</span>
                // setAlwaysOnTop is restricted,
                // the exception is ignored
<span class="nc" id="L248">            }</span>
<span class="nc" id="L249">        }</span>

        public void update(Graphics g) {
<span class="nc" id="L252">            paint(g);</span>
<span class="nc" id="L253">        }</span>

        public void show() {
<span class="nc" id="L256">            this.pack();</span>
<span class="nc bnc" id="L257" title="All 4 branches missed.">            if (getWidth() &gt; 0 &amp;&amp; getHeight() &gt; 0) {</span>
<span class="nc" id="L258">                super.show();</span>
            }
<span class="nc" id="L260">        }</span>
    }


    /**
     * Used if no valid Window ancestor of the supplied owner is found.
     * &lt;p&gt;
     * PopupFactory uses this as a way to know when the Popup shouldn't
     * be cached based on the Window.
     */
<span class="nc" id="L270">    static class DefaultFrame extends Frame {</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>