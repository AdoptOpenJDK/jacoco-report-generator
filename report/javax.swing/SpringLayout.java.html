<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>SpringLayout.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing</a> &gt; <span class="el_source">SpringLayout.java</span></div><h1>SpringLayout.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2001, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing;

import java.awt.Component;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.FontMetrics;
import java.awt.Insets;
import java.awt.LayoutManager2;
import java.awt.Rectangle;
import java.util.*;

/**
 * A &lt;code&gt;SpringLayout&lt;/code&gt; lays out the children of its associated container
 * according to a set of constraints.
 * See &lt;a href=&quot;http://docs.oracle.com/javase/tutorial/uiswing/layout/spring.html&quot;&gt;How to Use SpringLayout&lt;/a&gt;
 * in &lt;em&gt;The Java Tutorial&lt;/em&gt; for examples of using
 * &lt;code&gt;SpringLayout&lt;/code&gt;.
 *
 * &lt;p&gt;
 * Each constraint,
 * represented by a &lt;code&gt;Spring&lt;/code&gt; object,
 * controls the vertical or horizontal distance
 * between two component edges.
 * The edges can belong to
 * any child of the container,
 * or to the container itself.
 * For example,
 * the allowable width of a component
 * can be expressed using a constraint
 * that controls the distance between the west (left) and east (right)
 * edges of the component.
 * The allowable &lt;em&gt;y&lt;/em&gt; coordinates for a component
 * can be expressed by constraining the distance between
 * the north (top) edge of the component
 * and the north edge of its container.
 *
 * &lt;P&gt;
 * Every child of a &lt;code&gt;SpringLayout&lt;/code&gt;-controlled container,
 * as well as the container itself,
 * has exactly one set of constraints
 * associated with it.
 * These constraints are represented by
 * a &lt;code&gt;SpringLayout.Constraints&lt;/code&gt; object.
 * By default,
 * &lt;code&gt;SpringLayout&lt;/code&gt; creates constraints
 * that make their associated component
 * have the minimum, preferred, and maximum sizes
 * returned by the component's
 * {@link java.awt.Component#getMinimumSize},
 * {@link java.awt.Component#getPreferredSize}, and
 * {@link java.awt.Component#getMaximumSize}
 * methods. The &lt;em&gt;x&lt;/em&gt; and &lt;em&gt;y&lt;/em&gt; positions are initially not
 * constrained, so that until you constrain them the &lt;code&gt;Component&lt;/code&gt;
 * will be positioned at 0,0 relative to the &lt;code&gt;Insets&lt;/code&gt; of the
 * parent &lt;code&gt;Container&lt;/code&gt;.
 *
 * &lt;p&gt;
 * You can change
 * a component's constraints in several ways.
 * You can
 * use one of the
 * {@link #putConstraint putConstraint}
 * methods
 * to establish a spring
 * linking the edges of two components within the same container.
 * Or you can get the appropriate &lt;code&gt;SpringLayout.Constraints&lt;/code&gt;
 * object using
 * {@link #getConstraints getConstraints}
 * and then modify one or more of its springs.
 * Or you can get the spring for a particular edge of a component
 * using {@link #getConstraint getConstraint},
 * and modify it.
 * You can also associate
 * your own &lt;code&gt;SpringLayout.Constraints&lt;/code&gt; object
 * with a component by specifying the constraints object
 * when you add the component to its container
 * (using
 * {@link Container#add(Component, Object)}).
 *
 * &lt;p&gt;
 * The &lt;code&gt;Spring&lt;/code&gt; object representing each constraint
 * has a minimum, preferred, maximum, and current value.
 * The current value of the spring
 * is somewhere between the minimum and maximum values,
 * according to the formula given in the
 * {@link Spring#sum} method description.
 * When the minimum, preferred, and maximum values are the same,
 * the current value is always equal to them;
 * this inflexible spring is called a &lt;em&gt;strut&lt;/em&gt;.
 * You can create struts using the factory method
 * {@link Spring#constant(int)}.
 * The &lt;code&gt;Spring&lt;/code&gt; class also provides factory methods
 * for creating other kinds of springs,
 * including springs that depend on other springs.
 *
 * &lt;p&gt;
 * In a &lt;code&gt;SpringLayout&lt;/code&gt;, the position of each edge is dependent on
 * the position of just one other edge. If a constraint is subsequently added
 * to create a new binding for an edge, the previous binding is discarded
 * and the edge remains dependent on a single edge.
 * Springs should only be attached
 * between edges of the container and its immediate children; the behavior
 * of the &lt;code&gt;SpringLayout&lt;/code&gt; when presented with constraints linking
 * the edges of components from different containers (either internal or
 * external) is undefined.
 *
 * &lt;h3&gt;
 * SpringLayout vs. Other Layout Managers
 * &lt;/h3&gt;
 *
 * &lt;blockquote&gt;
 * &lt;hr&gt;
 * &lt;strong&gt;Note:&lt;/strong&gt;
 * Unlike many layout managers,
 * &lt;code&gt;SpringLayout&lt;/code&gt; doesn't automatically set the location of
 * the components it manages.
 * If you hand-code a GUI that uses &lt;code&gt;SpringLayout&lt;/code&gt;,
 * remember to initialize component locations by constraining the west/east
 * and north/south locations.
 * &lt;p&gt;
 * Depending on the constraints you use,
 * you may also need to set the size of the container explicitly.
 * &lt;hr&gt;
 * &lt;/blockquote&gt;
 *
 * &lt;p&gt;
 * Despite the simplicity of &lt;code&gt;SpringLayout&lt;/code&gt;,
 * it can emulate the behavior of most other layout managers.
 * For some features,
 * such as the line breaking provided by &lt;code&gt;FlowLayout&lt;/code&gt;,
 * you'll need to
 * create a special-purpose subclass of the &lt;code&gt;Spring&lt;/code&gt; class.
 *
 * &lt;p&gt;
 * &lt;code&gt;SpringLayout&lt;/code&gt; also provides a way to solve
 * many of the difficult layout
 * problems that cannot be solved by nesting combinations
 * of &lt;code&gt;Box&lt;/code&gt;es. That said, &lt;code&gt;SpringLayout&lt;/code&gt; honors the
 * &lt;code&gt;LayoutManager2&lt;/code&gt; contract correctly and so can be nested with
 * other layout managers -- a technique that can be preferable to
 * creating the constraints implied by the other layout managers.
 * &lt;p&gt;
 * The asymptotic complexity of the layout operation of a &lt;code&gt;SpringLayout&lt;/code&gt;
 * is linear in the number of constraints (and/or components).
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases. The current serialization support is
 * appropriate for short term storage or RMI between applications running
 * the same version of Swing.  As of 1.4, support for long term storage
 * of all JavaBeans&amp;trade;
 * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
 * Please see {@link java.beans.XMLEncoder}.
 *
 * @see Spring
 * @see SpringLayout.Constraints
 *
 * @author      Philip Milne
 * @author      Scott Violet
 * @author      Joe Winchester
 * @since       1.4
 */
public class SpringLayout implements LayoutManager2 {
<span class="nc" id="L188">    private Map&lt;Component, Constraints&gt; componentConstraints = new HashMap&lt;Component, Constraints&gt;();</span>

<span class="nc" id="L190">    private Spring cyclicReference = Spring.constant(Spring.UNSET);</span>
    private Set&lt;Spring&gt; cyclicSprings;
    private Set&lt;Spring&gt; acyclicSprings;


    /**
     * Specifies the top edge of a component's bounding rectangle.
     */
    public static final String NORTH  = &quot;North&quot;;

    /**
     * Specifies the bottom edge of a component's bounding rectangle.
     */
    public static final String SOUTH  = &quot;South&quot;;

    /**
     * Specifies the right edge of a component's bounding rectangle.
     */
    public static final String EAST   = &quot;East&quot;;

    /**
     * Specifies the left edge of a component's bounding rectangle.
     */
    public static final String WEST   = &quot;West&quot;;

    /**
     * Specifies the horizontal center of a component's bounding rectangle.
     *
     * @since 1.6
     */
    public static final String HORIZONTAL_CENTER   = &quot;HorizontalCenter&quot;;

    /**
     * Specifies the vertical center of a component's bounding rectangle.
     *
     * @since 1.6
     */
    public static final String VERTICAL_CENTER   = &quot;VerticalCenter&quot;;

    /**
     * Specifies the baseline of a component.
     *
     * @since 1.6
     */
    public static final String BASELINE   = &quot;Baseline&quot;;

    /**
     * Specifies the width of a component's bounding rectangle.
     *
     * @since 1.6
     */
    public static final String WIDTH = &quot;Width&quot;;

    /**
     * Specifies the height of a component's bounding rectangle.
     *
     * @since 1.6
     */
    public static final String HEIGHT = &quot;Height&quot;;

<span class="nc" id="L250">    private static String[] ALL_HORIZONTAL = {WEST, WIDTH, EAST, HORIZONTAL_CENTER};</span>

<span class="nc" id="L252">    private static String[] ALL_VERTICAL = {NORTH, HEIGHT, SOUTH, VERTICAL_CENTER, BASELINE};</span>

    /**
     * A &lt;code&gt;Constraints&lt;/code&gt; object holds the
     * constraints that govern the way a component's size and position
     * change in a container controlled by a &lt;code&gt;SpringLayout&lt;/code&gt;.
     * A &lt;code&gt;Constraints&lt;/code&gt; object is
     * like a &lt;code&gt;Rectangle&lt;/code&gt;, in that it
     * has &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;y&lt;/code&gt;,
     * &lt;code&gt;width&lt;/code&gt;, and &lt;code&gt;height&lt;/code&gt; properties.
     * In the &lt;code&gt;Constraints&lt;/code&gt; object, however,
     * these properties have
     * &lt;code&gt;Spring&lt;/code&gt; values instead of integers.
     * In addition,
     * a &lt;code&gt;Constraints&lt;/code&gt; object
     * can be manipulated as four edges
     * -- north, south, east, and west --
     * using the &lt;code&gt;constraint&lt;/code&gt; property.
     *
     * &lt;p&gt;
     * The following formulas are always true
     * for a &lt;code&gt;Constraints&lt;/code&gt; object (here WEST and &lt;code&gt;x&lt;/code&gt; are synonyms, as are and NORTH and &lt;code&gt;y&lt;/code&gt;):
     *
     * &lt;pre&gt;
     *               EAST = WEST + WIDTH
     *              SOUTH = NORTH + HEIGHT
     *  HORIZONTAL_CENTER = WEST + WIDTH/2
     *    VERTICAL_CENTER = NORTH + HEIGHT/2
     *  ABSOLUTE_BASELINE = NORTH + RELATIVE_BASELINE*
     * &lt;/pre&gt;
     * &lt;p&gt;
     * For example, if you have specified the WIDTH and WEST (X) location
     * the EAST is calculated as WEST + WIDTH.  If you instead specified
     * the WIDTH and EAST locations the WEST (X) location is then calculated
     * as EAST - WIDTH.
     * &lt;p&gt;
     * [RELATIVE_BASELINE is a private constraint that is set automatically when
     * the SpringLayout.Constraints(Component) constructor is called or when
     * a constraints object is registered with a SpringLayout object.]
     * &lt;p&gt;
     * &lt;b&gt;Note&lt;/b&gt;: In this document,
     * operators represent methods
     * in the &lt;code&gt;Spring&lt;/code&gt; class.
     * For example, &quot;a + b&quot; is equal to
     * &lt;code&gt;Spring.sum(a, b)&lt;/code&gt;,
     * and &quot;a - b&quot; is equal to
     * &lt;code&gt;Spring.sum(a, Spring.minus(b))&lt;/code&gt;.
     * See the
     * {@link Spring &lt;code&gt;Spring&lt;/code&gt; API documentation}
     * for further details
     * of spring arithmetic.
     *
     * &lt;p&gt;
     *
     * Because a &lt;code&gt;Constraints&lt;/code&gt; object's properties --
     * representing its edges, size, and location -- can all be set
     * independently and yet are interrelated,
     * a &lt;code&gt;Constraints&lt;/code&gt; object can become &lt;em&gt;over-constrained&lt;/em&gt;.
     * For example, if the &lt;code&gt;WEST&lt;/code&gt;, &lt;code&gt;WIDTH&lt;/code&gt; and
     * &lt;code&gt;EAST&lt;/code&gt; edges are all set, steps must be taken to ensure that
     * the first of the formulas above holds.  To do this, the
     * &lt;code&gt;Constraints&lt;/code&gt;
     * object throws away the &lt;em&gt;least recently set&lt;/em&gt;
     * constraint so as to make the formulas hold.
     * @since 1.4
     */
    public static class Constraints {
       private Spring x;
       private Spring y;
       private Spring width;
       private Spring height;
       private Spring east;
       private Spring south;
        private Spring horizontalCenter;
        private Spring verticalCenter;
        private Spring baseline;

<span class="nc" id="L329">        private List&lt;String&gt; horizontalHistory = new ArrayList&lt;String&gt;(2);</span>
<span class="nc" id="L330">        private List&lt;String&gt; verticalHistory = new ArrayList&lt;String&gt;(2);</span>

        // Used for baseline calculations
        private Component c;

       /**
        * Creates an empty &lt;code&gt;Constraints&lt;/code&gt; object.
        */
<span class="nc" id="L338">       public Constraints() {</span>
<span class="nc" id="L339">       }</span>

       /**
        * Creates a &lt;code&gt;Constraints&lt;/code&gt; object with the
        * specified values for its
        * &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt; properties.
        * The &lt;code&gt;height&lt;/code&gt; and &lt;code&gt;width&lt;/code&gt; springs
        * have &lt;code&gt;null&lt;/code&gt; values.
        *
        * @param x  the spring controlling the component's &lt;em&gt;x&lt;/em&gt; value
        * @param y  the spring controlling the component's &lt;em&gt;y&lt;/em&gt; value
        */
<span class="nc" id="L351">       public Constraints(Spring x, Spring y) {</span>
<span class="nc" id="L352">           setX(x);</span>
<span class="nc" id="L353">           setY(y);</span>
<span class="nc" id="L354">       }</span>

       /**
        * Creates a &lt;code&gt;Constraints&lt;/code&gt; object with the
        * specified values for its
        * &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;y&lt;/code&gt;, &lt;code&gt;width&lt;/code&gt;,
        * and &lt;code&gt;height&lt;/code&gt; properties.
        * Note: If the &lt;code&gt;SpringLayout&lt;/code&gt; class
        * encounters &lt;code&gt;null&lt;/code&gt; values in the
        * &lt;code&gt;Constraints&lt;/code&gt; object of a given component,
        * it replaces them with suitable defaults.
        *
        * @param x  the spring value for the &lt;code&gt;x&lt;/code&gt; property
        * @param y  the spring value for the &lt;code&gt;y&lt;/code&gt; property
        * @param width  the spring value for the &lt;code&gt;width&lt;/code&gt; property
        * @param height  the spring value for the &lt;code&gt;height&lt;/code&gt; property
        */
<span class="nc" id="L371">       public Constraints(Spring x, Spring y, Spring width, Spring height) {</span>
<span class="nc" id="L372">           setX(x);</span>
<span class="nc" id="L373">           setY(y);</span>
<span class="nc" id="L374">           setWidth(width);</span>
<span class="nc" id="L375">           setHeight(height);</span>
<span class="nc" id="L376">       }</span>

        /**
         * Creates a &lt;code&gt;Constraints&lt;/code&gt; object with
         * suitable &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;y&lt;/code&gt;, &lt;code&gt;width&lt;/code&gt; and
         * &lt;code&gt;height&lt;/code&gt; springs for component, &lt;code&gt;c&lt;/code&gt;.
         * The &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;y&lt;/code&gt; springs are constant
         * springs  initialised with the component's location at
         * the time this method is called. The &lt;code&gt;width&lt;/code&gt; and
         * &lt;code&gt;height&lt;/code&gt; springs are special springs, created by
         * the &lt;code&gt;Spring.width()&lt;/code&gt; and &lt;code&gt;Spring.height()&lt;/code&gt;
         * methods, which track the size characteristics of the component
         * when they change.
         *
         * @param c  the component whose characteristics will be reflected by this Constraints object
         * @throws NullPointerException if &lt;code&gt;c&lt;/code&gt; is null.
         * @since 1.5
         */
<span class="nc" id="L394">        public Constraints(Component c) {</span>
<span class="nc" id="L395">            this.c = c;</span>
<span class="nc" id="L396">            setX(Spring.constant(c.getX()));</span>
<span class="nc" id="L397">            setY(Spring.constant(c.getY()));</span>
<span class="nc" id="L398">            setWidth(Spring.width(c));</span>
<span class="nc" id="L399">            setHeight(Spring.height(c));</span>
<span class="nc" id="L400">        }</span>

        private void pushConstraint(String name, Spring value, boolean horizontal) {
<span class="nc" id="L403">            boolean valid = true;</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">            List&lt;String&gt; history = horizontal ? horizontalHistory :</span>
                                                verticalHistory;
<span class="nc bnc" id="L406" title="All 2 branches missed.">            if (history.contains(name)) {</span>
<span class="nc" id="L407">                history.remove(name);</span>
<span class="nc" id="L408">                valid = false;</span>
<span class="nc bnc" id="L409" title="All 4 branches missed.">            } else if (history.size() == 2 &amp;&amp; value != null) {</span>
<span class="nc" id="L410">                history.remove(0);</span>
<span class="nc" id="L411">                valid = false;</span>
            }
<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (value != null) {</span>
<span class="nc" id="L414">                history.add(name);</span>
            }
<span class="nc bnc" id="L416" title="All 2 branches missed.">            if (!valid) {</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">                String[] all = horizontal ? ALL_HORIZONTAL : ALL_VERTICAL;</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">                for (String s : all) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">                    if (!history.contains(s)) {</span>
<span class="nc" id="L420">                        setConstraint(s, null);</span>
                    }
                }
            }
<span class="nc" id="L424">        }</span>

       private Spring sum(Spring s1, Spring s2) {
<span class="nc bnc" id="L427" title="All 4 branches missed.">           return (s1 == null || s2 == null) ? null : Spring.sum(s1, s2);</span>
       }

       private Spring difference(Spring s1, Spring s2) {
<span class="nc bnc" id="L431" title="All 4 branches missed.">           return (s1 == null || s2 == null) ? null : Spring.difference(s1, s2);</span>
       }

        private Spring scale(Spring s, float factor) {
<span class="nc bnc" id="L435" title="All 2 branches missed.">            return (s == null) ? null : Spring.scale(s, factor);</span>
        }

        private int getBaselineFromHeight(int height) {
<span class="nc bnc" id="L439" title="All 2 branches missed.">            if (height &lt; 0) {</span>
                // Bad Scott, Bad Scott!
<span class="nc" id="L441">                return -c.getBaseline(c.getPreferredSize().width,</span>
                                      -height);
            }
<span class="nc" id="L444">            return c.getBaseline(c.getPreferredSize().width, height);</span>
        }

        private int getHeightFromBaseLine(int baseline) {
<span class="nc" id="L448">            Dimension prefSize = c.getPreferredSize();</span>
<span class="nc" id="L449">            int prefHeight = prefSize.height;</span>
<span class="nc" id="L450">            int prefBaseline = c.getBaseline(prefSize.width, prefHeight);</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">            if (prefBaseline == baseline) {</span>
                // If prefBaseline &lt; 0, then no baseline, assume preferred
                // height.
                // If prefBaseline == baseline, then specified baseline
                // matches preferred baseline, return preferred height
<span class="nc" id="L456">                return prefHeight;</span>
            }
            // Valid baseline
<span class="nc bnc" id="L459" title="All 3 branches missed.">            switch(c.getBaselineResizeBehavior()) {</span>
            case CONSTANT_DESCENT:
<span class="nc" id="L461">                return prefHeight + (baseline - prefBaseline);</span>
            case CENTER_OFFSET:
<span class="nc" id="L463">                return prefHeight + 2 * (baseline - prefBaseline);</span>
            case CONSTANT_ASCENT:
                // Component baseline and specified baseline will NEVER
                // match, fall through to default
            default: // OTHER
                // No way to map from baseline to height.
            }
<span class="nc" id="L470">            return Integer.MIN_VALUE;</span>
        }

         private Spring heightToRelativeBaseline(Spring s) {
<span class="nc" id="L474">            return new Spring.SpringMap(s) {</span>
                 protected int map(int i) {
<span class="nc" id="L476">                    return getBaselineFromHeight(i);</span>
                 }

                 protected int inv(int i) {
<span class="nc" id="L480">                     return getHeightFromBaseLine(i);</span>
                 }
            };
        }

        private Spring relativeBaselineToHeight(Spring s) {
<span class="nc" id="L486">            return new Spring.SpringMap(s) {</span>
                protected int map(int i) {
<span class="nc" id="L488">                    return getHeightFromBaseLine(i);</span>
                 }

                 protected int inv(int i) {
<span class="nc" id="L492">                    return getBaselineFromHeight(i);</span>
                 }
            };
        }

        private boolean defined(List history, String s1, String s2) {
<span class="nc bnc" id="L498" title="All 4 branches missed.">            return history.contains(s1) &amp;&amp; history.contains(s2);</span>
        }

       /**
        * Sets the &lt;code&gt;x&lt;/code&gt; property,
        * which controls the &lt;code&gt;x&lt;/code&gt; value
        * of a component's location.
        *
        * @param x the spring controlling the &lt;code&gt;x&lt;/code&gt; value
        *          of a component's location
        *
        * @see #getX
        * @see SpringLayout.Constraints
        */
       public void setX(Spring x) {
<span class="nc" id="L513">           this.x = x;</span>
<span class="nc" id="L514">           pushConstraint(WEST, x, true);</span>
<span class="nc" id="L515">       }</span>

       /**
        * Returns the value of the &lt;code&gt;x&lt;/code&gt; property.
        *
        * @return the spring controlling the &lt;code&gt;x&lt;/code&gt; value
        *         of a component's location
        *
        * @see #setX
        * @see SpringLayout.Constraints
        */
       public Spring getX() {
<span class="nc bnc" id="L527" title="All 2 branches missed.">           if (x == null) {</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">               if (defined(horizontalHistory, EAST, WIDTH)) {</span>
<span class="nc" id="L529">                   x = difference(east, width);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">               } else if (defined(horizontalHistory, HORIZONTAL_CENTER, WIDTH)) {</span>
<span class="nc" id="L531">                   x = difference(horizontalCenter, scale(width, 0.5f));</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">               } else if (defined(horizontalHistory, HORIZONTAL_CENTER, EAST)) {</span>
<span class="nc" id="L533">                   x = difference(scale(horizontalCenter, 2f), east);</span>
               }
           }
<span class="nc" id="L536">           return x;</span>
       }

       /**
        * Sets the &lt;code&gt;y&lt;/code&gt; property,
        * which controls the &lt;code&gt;y&lt;/code&gt; value
        * of a component's location.
        *
        * @param y the spring controlling the &lt;code&gt;y&lt;/code&gt; value
        *          of a component's location
        *
        * @see #getY
        * @see SpringLayout.Constraints
        */
       public void setY(Spring y) {
<span class="nc" id="L551">           this.y = y;</span>
<span class="nc" id="L552">           pushConstraint(NORTH, y, false);</span>
<span class="nc" id="L553">       }</span>

       /**
        * Returns the value of the &lt;code&gt;y&lt;/code&gt; property.
        *
        * @return the spring controlling the &lt;code&gt;y&lt;/code&gt; value
        *         of a component's location
        *
        * @see #setY
        * @see SpringLayout.Constraints
        */
       public Spring getY() {
<span class="nc bnc" id="L565" title="All 2 branches missed.">           if (y == null) {</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">               if (defined(verticalHistory, SOUTH, HEIGHT)) {</span>
<span class="nc" id="L567">                   y = difference(south, height);</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">               } else if (defined(verticalHistory, VERTICAL_CENTER, HEIGHT)) {</span>
<span class="nc" id="L569">                   y = difference(verticalCenter, scale(height, 0.5f));</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">               } else if (defined(verticalHistory, VERTICAL_CENTER, SOUTH)) {</span>
<span class="nc" id="L571">                   y = difference(scale(verticalCenter, 2f), south);</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">               } else if (defined(verticalHistory, BASELINE, HEIGHT)) {</span>
<span class="nc" id="L573">                   y = difference(baseline, heightToRelativeBaseline(height));</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">               } else if (defined(verticalHistory, BASELINE, SOUTH)) {</span>
<span class="nc" id="L575">                   y = scale(difference(baseline, heightToRelativeBaseline(south)), 2f);</span>
/*
               } else if (defined(verticalHistory, BASELINE, VERTICAL_CENTER)) {
                   y = scale(difference(baseline, heightToRelativeBaseline(scale(verticalCenter, 2))), 1f/(1-2*0.5f));
*/
               }
           }
<span class="nc" id="L582">           return y;</span>
       }

       /**
        * Sets the &lt;code&gt;width&lt;/code&gt; property,
        * which controls the width of a component.
        *
        * @param width the spring controlling the width of this
        * &lt;code&gt;Constraints&lt;/code&gt; object
        *
        * @see #getWidth
        * @see SpringLayout.Constraints
        */
       public void setWidth(Spring width) {
<span class="nc" id="L596">           this.width = width;</span>
<span class="nc" id="L597">           pushConstraint(WIDTH, width, true);</span>
<span class="nc" id="L598">       }</span>

       /**
        * Returns the value of the &lt;code&gt;width&lt;/code&gt; property.
        *
        * @return the spring controlling the width of a component
        *
        * @see #setWidth
        * @see SpringLayout.Constraints
        */
       public Spring getWidth() {
<span class="nc bnc" id="L609" title="All 2 branches missed.">           if (width == null) {</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">               if (horizontalHistory.contains(EAST)) {</span>
<span class="nc" id="L611">                   width = difference(east, getX());</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">               } else if (horizontalHistory.contains(HORIZONTAL_CENTER)) {</span>
<span class="nc" id="L613">                   width = scale(difference(horizontalCenter, getX()), 2f);</span>
               }
           }
<span class="nc" id="L616">           return width;</span>
       }

       /**
        * Sets the &lt;code&gt;height&lt;/code&gt; property,
        * which controls the height of a component.
        *
        * @param height the spring controlling the height of this &lt;code&gt;Constraints&lt;/code&gt;
        * object
        *
        * @see #getHeight
        * @see SpringLayout.Constraints
        */
       public void setHeight(Spring height) {
<span class="nc" id="L630">           this.height = height;</span>
<span class="nc" id="L631">           pushConstraint(HEIGHT, height, false);</span>
<span class="nc" id="L632">       }</span>

       /**
        * Returns the value of the &lt;code&gt;height&lt;/code&gt; property.
        *
        * @return the spring controlling the height of a component
        *
        * @see #setHeight
        * @see SpringLayout.Constraints
        */
       public Spring getHeight() {
<span class="nc bnc" id="L643" title="All 2 branches missed.">           if (height == null) {</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">               if (verticalHistory.contains(SOUTH)) {</span>
<span class="nc" id="L645">                   height = difference(south, getY());</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">               } else if (verticalHistory.contains(VERTICAL_CENTER)) {</span>
<span class="nc" id="L647">                   height = scale(difference(verticalCenter, getY()), 2f);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">               } else if (verticalHistory.contains(BASELINE)) {</span>
<span class="nc" id="L649">                   height = relativeBaselineToHeight(difference(baseline, getY()));</span>
               }
           }
<span class="nc" id="L652">           return height;</span>
       }

       private void setEast(Spring east) {
<span class="nc" id="L656">           this.east = east;</span>
<span class="nc" id="L657">           pushConstraint(EAST, east, true);</span>
<span class="nc" id="L658">       }</span>

       private Spring getEast() {
<span class="nc bnc" id="L661" title="All 2 branches missed.">           if (east == null) {</span>
<span class="nc" id="L662">               east = sum(getX(), getWidth());</span>
           }
<span class="nc" id="L664">           return east;</span>
       }

       private void setSouth(Spring south) {
<span class="nc" id="L668">           this.south = south;</span>
<span class="nc" id="L669">           pushConstraint(SOUTH, south, false);</span>
<span class="nc" id="L670">       }</span>

       private Spring getSouth() {
<span class="nc bnc" id="L673" title="All 2 branches missed.">           if (south == null) {</span>
<span class="nc" id="L674">               south = sum(getY(), getHeight());</span>
           }
<span class="nc" id="L676">           return south;</span>
       }

        private Spring getHorizontalCenter() {
<span class="nc bnc" id="L680" title="All 2 branches missed.">            if (horizontalCenter == null) {</span>
<span class="nc" id="L681">                horizontalCenter = sum(getX(), scale(getWidth(), 0.5f));</span>
            }
<span class="nc" id="L683">            return horizontalCenter;</span>
        }

        private void setHorizontalCenter(Spring horizontalCenter) {
<span class="nc" id="L687">            this.horizontalCenter = horizontalCenter;</span>
<span class="nc" id="L688">            pushConstraint(HORIZONTAL_CENTER, horizontalCenter, true);</span>
<span class="nc" id="L689">        }</span>

        private Spring getVerticalCenter() {
<span class="nc bnc" id="L692" title="All 2 branches missed.">            if (verticalCenter == null) {</span>
<span class="nc" id="L693">                verticalCenter = sum(getY(), scale(getHeight(), 0.5f));</span>
            }
<span class="nc" id="L695">            return verticalCenter;</span>
        }

        private void setVerticalCenter(Spring verticalCenter) {
<span class="nc" id="L699">            this.verticalCenter = verticalCenter;</span>
<span class="nc" id="L700">            pushConstraint(VERTICAL_CENTER, verticalCenter, false);</span>
<span class="nc" id="L701">        }</span>

        private Spring getBaseline() {
<span class="nc bnc" id="L704" title="All 2 branches missed.">            if (baseline == null) {</span>
<span class="nc" id="L705">                baseline = sum(getY(), heightToRelativeBaseline(getHeight()));</span>
            }
<span class="nc" id="L707">            return baseline;</span>
        }

        private void setBaseline(Spring baseline) {
<span class="nc" id="L711">            this.baseline = baseline;</span>
<span class="nc" id="L712">            pushConstraint(BASELINE, baseline, false);</span>
<span class="nc" id="L713">        }</span>

       /**
        * Sets the spring controlling the specified edge.
        * The edge must have one of the following values:
        * &lt;code&gt;SpringLayout.NORTH&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.SOUTH&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.EAST&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.WEST&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.HORIZONTAL_CENTER&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.VERTICAL_CENTER&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.BASELINE&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.WIDTH&lt;/code&gt; or
        * &lt;code&gt;SpringLayout.HEIGHT&lt;/code&gt;.
        * For any other &lt;code&gt;String&lt;/code&gt; value passed as the edge,
        * no action is taken. For a &lt;code&gt;null&lt;/code&gt; edge, a
        * &lt;code&gt;NullPointerException&lt;/code&gt; is thrown.
        * &lt;p&gt;
        * &lt;b&gt;Note:&lt;/b&gt; This method can affect {@code x} and {@code y} values
        * previously set for this {@code Constraints}.
        *
        * @param edgeName the edge to be set
        * @param s the spring controlling the specified edge
        *
        * @throws NullPointerException if &lt;code&gt;edgeName&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
        *
        * @see #getConstraint
        * @see #NORTH
        * @see #SOUTH
        * @see #EAST
        * @see #WEST
        * @see #HORIZONTAL_CENTER
        * @see #VERTICAL_CENTER
        * @see #BASELINE
        * @see #WIDTH
        * @see #HEIGHT
        * @see SpringLayout.Constraints
        */
       public void setConstraint(String edgeName, Spring s) {
<span class="nc" id="L752">           edgeName = edgeName.intern();</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">           if (edgeName == WEST) {</span>
<span class="nc" id="L754">               setX(s);</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">           } else if (edgeName == NORTH) {</span>
<span class="nc" id="L756">               setY(s);</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">           } else if (edgeName == EAST) {</span>
<span class="nc" id="L758">               setEast(s);</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">           } else if (edgeName == SOUTH) {</span>
<span class="nc" id="L760">               setSouth(s);</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">           } else if (edgeName == HORIZONTAL_CENTER) {</span>
<span class="nc" id="L762">               setHorizontalCenter(s);</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">           } else if (edgeName == WIDTH) {</span>
<span class="nc" id="L764">               setWidth(s);</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">           } else if (edgeName == HEIGHT) {</span>
<span class="nc" id="L766">               setHeight(s);</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">           } else if (edgeName == VERTICAL_CENTER) {</span>
<span class="nc" id="L768">               setVerticalCenter(s);</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">           } else if (edgeName == BASELINE) {</span>
<span class="nc" id="L770">               setBaseline(s);</span>
           }
<span class="nc" id="L772">       }</span>

       /**
        * Returns the value of the specified edge, which may be
        * a derived value, or even &lt;code&gt;null&lt;/code&gt;.
        * The edge must have one of the following values:
        * &lt;code&gt;SpringLayout.NORTH&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.SOUTH&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.EAST&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.WEST&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.HORIZONTAL_CENTER&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.VERTICAL_CENTER&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.BASELINE&lt;/code&gt;,
        * &lt;code&gt;SpringLayout.WIDTH&lt;/code&gt; or
        * &lt;code&gt;SpringLayout.HEIGHT&lt;/code&gt;.
        * For any other &lt;code&gt;String&lt;/code&gt; value passed as the edge,
        * &lt;code&gt;null&lt;/code&gt; will be returned. Throws
        * &lt;code&gt;NullPointerException&lt;/code&gt; for a &lt;code&gt;null&lt;/code&gt; edge.
        *
        * @param edgeName the edge whose value
        *                 is to be returned
        *
        * @return the spring controlling the specified edge, may be &lt;code&gt;null&lt;/code&gt;
        *
        * @throws NullPointerException if &lt;code&gt;edgeName&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
        *
        * @see #setConstraint
        * @see #NORTH
        * @see #SOUTH
        * @see #EAST
        * @see #WEST
        * @see #HORIZONTAL_CENTER
        * @see #VERTICAL_CENTER
        * @see #BASELINE
        * @see #WIDTH
        * @see #HEIGHT
        * @see SpringLayout.Constraints
        */
       public Spring getConstraint(String edgeName) {
<span class="nc" id="L811">           edgeName = edgeName.intern();</span>
<span class="nc bnc" id="L812" title="All 4 branches missed.">           return (edgeName == WEST)  ? getX() :</span>
<span class="nc bnc" id="L813" title="All 2 branches missed.">                   (edgeName == NORTH) ? getY() :</span>
<span class="nc bnc" id="L814" title="All 2 branches missed.">                   (edgeName == EAST)  ? getEast() :</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">                   (edgeName == SOUTH) ? getSouth() :</span>
<span class="nc bnc" id="L816" title="All 2 branches missed.">                   (edgeName == WIDTH)  ? getWidth() :</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">                   (edgeName == HEIGHT) ? getHeight() :</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">                   (edgeName == HORIZONTAL_CENTER) ? getHorizontalCenter() :</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">                   (edgeName == VERTICAL_CENTER)  ? getVerticalCenter() :</span>
<span class="nc" id="L820">                   (edgeName == BASELINE) ? getBaseline() :</span>
                  null;
       }

       /*pp*/ void reset() {
<span class="nc" id="L825">           Spring[] allSprings = {x, y, width, height, east, south,</span>
               horizontalCenter, verticalCenter, baseline};
<span class="nc bnc" id="L827" title="All 2 branches missed.">           for (Spring s : allSprings) {</span>
<span class="nc bnc" id="L828" title="All 2 branches missed.">               if (s != null) {</span>
<span class="nc" id="L829">                   s.setValue(Spring.UNSET);</span>
               }
           }
<span class="nc" id="L832">       }</span>
   }

   private static class SpringProxy extends Spring {
       private String edgeName;
       private Component c;
       private SpringLayout l;

<span class="nc" id="L840">       public SpringProxy(String edgeName, Component c, SpringLayout l) {</span>
<span class="nc" id="L841">           this.edgeName = edgeName;</span>
<span class="nc" id="L842">           this.c = c;</span>
<span class="nc" id="L843">           this.l = l;</span>
<span class="nc" id="L844">       }</span>

       private Spring getConstraint() {
<span class="nc" id="L847">           return l.getConstraints(c).getConstraint(edgeName);</span>
       }

       public int getMinimumValue() {
<span class="nc" id="L851">           return getConstraint().getMinimumValue();</span>
       }

       public int getPreferredValue() {
<span class="nc" id="L855">           return getConstraint().getPreferredValue();</span>
       }

       public int getMaximumValue() {
<span class="nc" id="L859">           return getConstraint().getMaximumValue();</span>
       }

       public int getValue() {
<span class="nc" id="L863">           return getConstraint().getValue();</span>
       }

       public void setValue(int size) {
<span class="nc" id="L867">           getConstraint().setValue(size);</span>
<span class="nc" id="L868">       }</span>

       /*pp*/ boolean isCyclic(SpringLayout l) {
<span class="nc" id="L871">           return l.isCyclic(getConstraint());</span>
       }

       public String toString() {
<span class="nc" id="L875">           return &quot;SpringProxy for &quot; + edgeName + &quot; edge of &quot; + c.getName() + &quot;.&quot;;</span>
       }
    }

    /**
     * Constructs a new &lt;code&gt;SpringLayout&lt;/code&gt;.
     */
<span class="nc" id="L882">    public SpringLayout() {}</span>

    private void resetCyclicStatuses() {
<span class="nc" id="L885">        cyclicSprings = new HashSet&lt;Spring&gt;();</span>
<span class="nc" id="L886">        acyclicSprings = new HashSet&lt;Spring&gt;();</span>
<span class="nc" id="L887">    }</span>

    private void setParent(Container p) {
<span class="nc" id="L890">        resetCyclicStatuses();</span>
<span class="nc" id="L891">        Constraints pc = getConstraints(p);</span>

<span class="nc" id="L893">        pc.setX(Spring.constant(0));</span>
<span class="nc" id="L894">        pc.setY(Spring.constant(0));</span>
        // The applyDefaults() method automatically adds width and
        // height springs that delegate their calculations to the
        // getMinimumSize(), getPreferredSize() and getMaximumSize()
        // methods of the relevant component. In the case of the
        // parent this will cause an infinite loop since these
        // methods, in turn, delegate their calculations to the
        // layout manager. Check for this case and replace the
        // the springs that would cause this problem with a
        // constant springs that supply default values.
<span class="nc" id="L904">        Spring width = pc.getWidth();</span>
<span class="nc bnc" id="L905" title="All 4 branches missed.">        if (width instanceof Spring.WidthSpring &amp;&amp; ((Spring.WidthSpring)width).c == p) {</span>
<span class="nc" id="L906">            pc.setWidth(Spring.constant(0, 0, Integer.MAX_VALUE));</span>
        }
<span class="nc" id="L908">        Spring height = pc.getHeight();</span>
<span class="nc bnc" id="L909" title="All 4 branches missed.">        if (height instanceof Spring.HeightSpring &amp;&amp; ((Spring.HeightSpring)height).c == p) {</span>
<span class="nc" id="L910">            pc.setHeight(Spring.constant(0, 0, Integer.MAX_VALUE));</span>
        }
<span class="nc" id="L912">    }</span>

    /*pp*/ boolean isCyclic(Spring s) {
<span class="nc bnc" id="L915" title="All 2 branches missed.">        if (s == null) {</span>
<span class="nc" id="L916">            return false;</span>
        }
<span class="nc bnc" id="L918" title="All 2 branches missed.">        if (cyclicSprings.contains(s)) {</span>
<span class="nc" id="L919">            return true;</span>
        }
<span class="nc bnc" id="L921" title="All 2 branches missed.">        if (acyclicSprings.contains(s)) {</span>
<span class="nc" id="L922">            return false;</span>
        }
<span class="nc" id="L924">        cyclicSprings.add(s);</span>
<span class="nc" id="L925">        boolean result = s.isCyclic(this);</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">        if (!result) {</span>
<span class="nc" id="L927">            acyclicSprings.add(s);</span>
<span class="nc" id="L928">            cyclicSprings.remove(s);</span>
        }
        else {
<span class="nc" id="L931">            System.err.println(s + &quot; is cyclic. &quot;);</span>
        }
<span class="nc" id="L933">        return result;</span>
    }

    private Spring abandonCycles(Spring s) {
<span class="nc bnc" id="L937" title="All 2 branches missed.">        return isCyclic(s) ? cyclicReference : s;</span>
    }

    // LayoutManager methods.

    /**
     * Has no effect,
     * since this layout manager does not
     * use a per-component string.
     */
<span class="nc" id="L947">    public void addLayoutComponent(String name, Component c) {}</span>

    /**
     * Removes the constraints associated with the specified component.
     *
     * @param c the component being removed from the container
     */
    public void removeLayoutComponent(Component c) {
<span class="nc" id="L955">        componentConstraints.remove(c);</span>
<span class="nc" id="L956">    }</span>

    private static Dimension addInsets(int width, int height, Container p) {
<span class="nc" id="L959">        Insets i = p.getInsets();</span>
<span class="nc" id="L960">        return new Dimension(width + i.left + i.right, height + i.top + i.bottom);</span>
    }

    public Dimension minimumLayoutSize(Container parent) {
<span class="nc" id="L964">        setParent(parent);</span>
<span class="nc" id="L965">        Constraints pc = getConstraints(parent);</span>
<span class="nc" id="L966">        return addInsets(abandonCycles(pc.getWidth()).getMinimumValue(),</span>
<span class="nc" id="L967">                         abandonCycles(pc.getHeight()).getMinimumValue(),</span>
                         parent);
    }

    public Dimension preferredLayoutSize(Container parent) {
<span class="nc" id="L972">        setParent(parent);</span>
<span class="nc" id="L973">        Constraints pc = getConstraints(parent);</span>
<span class="nc" id="L974">        return addInsets(abandonCycles(pc.getWidth()).getPreferredValue(),</span>
<span class="nc" id="L975">                         abandonCycles(pc.getHeight()).getPreferredValue(),</span>
                         parent);
    }

    // LayoutManager2 methods.

    public Dimension maximumLayoutSize(Container parent) {
<span class="nc" id="L982">        setParent(parent);</span>
<span class="nc" id="L983">        Constraints pc = getConstraints(parent);</span>
<span class="nc" id="L984">        return addInsets(abandonCycles(pc.getWidth()).getMaximumValue(),</span>
<span class="nc" id="L985">                         abandonCycles(pc.getHeight()).getMaximumValue(),</span>
                         parent);
    }

    /**
     * If &lt;code&gt;constraints&lt;/code&gt; is an instance of
     * &lt;code&gt;SpringLayout.Constraints&lt;/code&gt;,
     * associates the constraints with the specified component.
     * &lt;p&gt;
     * @param   component the component being added
     * @param   constraints the component's constraints
     *
     * @see SpringLayout.Constraints
     */
    public void addLayoutComponent(Component component, Object constraints) {
<span class="nc bnc" id="L1000" title="All 2 branches missed.">        if (constraints instanceof Constraints) {</span>
<span class="nc" id="L1001">            putConstraints(component, (Constraints)constraints);</span>
        }
<span class="nc" id="L1003">    }</span>

    /**
     * Returns 0.5f (centered).
     */
    public float getLayoutAlignmentX(Container p) {
<span class="nc" id="L1009">        return 0.5f;</span>
    }

    /**
     * Returns 0.5f (centered).
     */
    public float getLayoutAlignmentY(Container p) {
<span class="nc" id="L1016">        return 0.5f;</span>
    }

<span class="nc" id="L1019">    public void invalidateLayout(Container p) {}</span>

    // End of LayoutManger2 methods

   /**
     * Links edge &lt;code&gt;e1&lt;/code&gt; of component &lt;code&gt;c1&lt;/code&gt; to
     * edge &lt;code&gt;e2&lt;/code&gt; of component &lt;code&gt;c2&lt;/code&gt;,
     * with a fixed distance between the edges. This
     * constraint will cause the assignment
     * &lt;pre&gt;
     *     value(e1, c1) = value(e2, c2) + pad&lt;/pre&gt;
     * to take place during all subsequent layout operations.
     * &lt;p&gt;
     * @param   e1 the edge of the dependent
     * @param   c1 the component of the dependent
     * @param   pad the fixed distance between dependent and anchor
     * @param   e2 the edge of the anchor
     * @param   c2 the component of the anchor
     *
     * @see #putConstraint(String, Component, Spring, String, Component)
     */
    public void putConstraint(String e1, Component c1, int pad, String e2, Component c2) {
<span class="nc" id="L1041">        putConstraint(e1, c1, Spring.constant(pad), e2, c2);</span>
<span class="nc" id="L1042">    }</span>

    /**
     * Links edge &lt;code&gt;e1&lt;/code&gt; of component &lt;code&gt;c1&lt;/code&gt; to
     * edge &lt;code&gt;e2&lt;/code&gt; of component &lt;code&gt;c2&lt;/code&gt;. As edge
     * &lt;code&gt;(e2, c2)&lt;/code&gt; changes value, edge &lt;code&gt;(e1, c1)&lt;/code&gt; will
     * be calculated by taking the (spring) sum of &lt;code&gt;(e2, c2)&lt;/code&gt;
     * and &lt;code&gt;s&lt;/code&gt;.
     * Each edge must have one of the following values:
     * &lt;code&gt;SpringLayout.NORTH&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.SOUTH&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.EAST&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.WEST&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.VERTICAL_CENTER&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.HORIZONTAL_CENTER&lt;/code&gt; or
     * &lt;code&gt;SpringLayout.BASELINE&lt;/code&gt;.
     * &lt;p&gt;
     * @param   e1 the edge of the dependent
     * @param   c1 the component of the dependent
     * @param   s the spring linking dependent and anchor
     * @param   e2 the edge of the anchor
     * @param   c2 the component of the anchor
     *
     * @see #putConstraint(String, Component, int, String, Component)
     * @see #NORTH
     * @see #SOUTH
     * @see #EAST
     * @see #WEST
     * @see #VERTICAL_CENTER
     * @see #HORIZONTAL_CENTER
     * @see #BASELINE
     */
    public void putConstraint(String e1, Component c1, Spring s, String e2, Component c2) {
<span class="nc" id="L1075">        putConstraint(e1, c1, Spring.sum(s, getConstraint(e2, c2)));</span>
<span class="nc" id="L1076">    }</span>

    private void putConstraint(String e, Component c, Spring s) {
<span class="nc bnc" id="L1079" title="All 2 branches missed.">        if (s != null) {</span>
<span class="nc" id="L1080">            getConstraints(c).setConstraint(e, s);</span>
        }
<span class="nc" id="L1082">     }</span>

    private Constraints applyDefaults(Component c, Constraints constraints) {
<span class="nc bnc" id="L1085" title="All 2 branches missed.">        if (constraints == null) {</span>
<span class="nc" id="L1086">            constraints = new Constraints();</span>
        }
<span class="nc bnc" id="L1088" title="All 2 branches missed.">        if (constraints.c == null) {</span>
<span class="nc" id="L1089">            constraints.c = c;</span>
        }
<span class="nc bnc" id="L1091" title="All 2 branches missed.">        if (constraints.horizontalHistory.size() &lt; 2) {</span>
<span class="nc" id="L1092">            applyDefaults(constraints, WEST, Spring.constant(0), WIDTH,</span>
<span class="nc" id="L1093">                          Spring.width(c), constraints.horizontalHistory);</span>
        }
<span class="nc bnc" id="L1095" title="All 2 branches missed.">        if (constraints.verticalHistory.size() &lt; 2) {</span>
<span class="nc" id="L1096">            applyDefaults(constraints, NORTH, Spring.constant(0), HEIGHT,</span>
<span class="nc" id="L1097">                          Spring.height(c), constraints.verticalHistory);</span>
        }
<span class="nc" id="L1099">        return constraints;</span>
    }

    private void applyDefaults(Constraints constraints, String name1,
                               Spring spring1, String name2, Spring spring2,
                               List&lt;String&gt; history) {
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        if (history.size() == 0) {</span>
<span class="nc" id="L1106">            constraints.setConstraint(name1, spring1);</span>
<span class="nc" id="L1107">            constraints.setConstraint(name2, spring2);</span>
        } else {
            // At this point there must be exactly one constraint defined already.
            // Check width/height first.
<span class="nc bnc" id="L1111" title="All 2 branches missed.">            if (constraints.getConstraint(name2) == null) {</span>
<span class="nc" id="L1112">                constraints.setConstraint(name2, spring2);</span>
            } else {
                // If width/height is already defined, install a default for x/y.
<span class="nc" id="L1115">                constraints.setConstraint(name1, spring1);</span>
            }
            // Either way, leave the user's constraint topmost on the stack.
<span class="nc" id="L1118">            Collections.rotate(history, 1);</span>
        }
<span class="nc" id="L1120">    }</span>

    private void putConstraints(Component component, Constraints constraints) {
<span class="nc" id="L1123">        componentConstraints.put(component, applyDefaults(component, constraints));</span>
<span class="nc" id="L1124">    }</span>

    /**
     * Returns the constraints for the specified component.
     * Note that,
     * unlike the &lt;code&gt;GridBagLayout&lt;/code&gt;
     * &lt;code&gt;getConstraints&lt;/code&gt; method,
     * this method does not clone constraints.
     * If no constraints
     * have been associated with this component,
     * this method
     * returns a default constraints object positioned at
     * 0,0 relative to the parent's Insets and its width/height
     * constrained to the minimum, maximum, and preferred sizes of the
     * component. The size characteristics
     * are not frozen at the time this method is called;
     * instead this method returns a constraints object
     * whose characteristics track the characteristics
     * of the component as they change.
     *
     * @param       c the component whose constraints will be returned
     *
     * @return      the constraints for the specified component
     */
    public Constraints getConstraints(Component c) {
<span class="nc" id="L1149">       Constraints result = componentConstraints.get(c);</span>
<span class="nc bnc" id="L1150" title="All 2 branches missed.">       if (result == null) {</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">           if (c instanceof javax.swing.JComponent) {</span>
<span class="nc" id="L1152">                Object cp = ((javax.swing.JComponent)c).getClientProperty(SpringLayout.class);</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">                if (cp instanceof Constraints) {</span>
<span class="nc" id="L1154">                    return applyDefaults(c, (Constraints)cp);</span>
                }
            }
<span class="nc" id="L1157">            result = new Constraints();</span>
<span class="nc" id="L1158">            putConstraints(c, result);</span>
       }
<span class="nc" id="L1160">       return result;</span>
    }

    /**
     * Returns the spring controlling the distance between
     * the specified edge of
     * the component and the top or left edge of its parent. This
     * method, instead of returning the current binding for the
     * edge, returns a proxy that tracks the characteristics
     * of the edge even if the edge is subsequently rebound.
     * Proxies are intended to be used in builder environments
     * where it is useful to allow the user to define the
     * constraints for a layout in any order. Proxies do, however,
     * provide the means to create cyclic dependencies amongst
     * the constraints of a layout. Such cycles are detected
     * internally by &lt;code&gt;SpringLayout&lt;/code&gt; so that
     * the layout operation always terminates.
     *
     * @param edgeName must be one of
     * &lt;code&gt;SpringLayout.NORTH&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.SOUTH&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.EAST&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.WEST&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.VERTICAL_CENTER&lt;/code&gt;,
     * &lt;code&gt;SpringLayout.HORIZONTAL_CENTER&lt;/code&gt; or
     * &lt;code&gt;SpringLayout.BASELINE&lt;/code&gt;
     * @param c the component whose edge spring is desired
     *
     * @return a proxy for the spring controlling the distance between the
     *         specified edge and the top or left edge of its parent
     *
     * @see #NORTH
     * @see #SOUTH
     * @see #EAST
     * @see #WEST
     * @see #VERTICAL_CENTER
     * @see #HORIZONTAL_CENTER
     * @see #BASELINE
     */
    public Spring getConstraint(String edgeName, Component c) {
        // The interning here is unnecessary; it was added for efficiency.
<span class="nc" id="L1201">        edgeName = edgeName.intern();</span>
<span class="nc" id="L1202">        return new SpringProxy(edgeName, c, this);</span>
    }

    public void layoutContainer(Container parent) {
<span class="nc" id="L1206">        setParent(parent);</span>

<span class="nc" id="L1208">        int n = parent.getComponentCount();</span>
<span class="nc" id="L1209">        getConstraints(parent).reset();</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">        for (int i = 0 ; i &lt; n ; i++) {</span>
<span class="nc" id="L1211">            getConstraints(parent.getComponent(i)).reset();</span>
        }

<span class="nc" id="L1214">        Insets insets = parent.getInsets();</span>
<span class="nc" id="L1215">        Constraints pc = getConstraints(parent);</span>
<span class="nc" id="L1216">        abandonCycles(pc.getX()).setValue(0);</span>
<span class="nc" id="L1217">        abandonCycles(pc.getY()).setValue(0);</span>
<span class="nc" id="L1218">        abandonCycles(pc.getWidth()).setValue(parent.getWidth() -</span>
                                              insets.left - insets.right);
<span class="nc" id="L1220">        abandonCycles(pc.getHeight()).setValue(parent.getHeight() -</span>
                                               insets.top - insets.bottom);

<span class="nc bnc" id="L1223" title="All 2 branches missed.">        for (int i = 0 ; i &lt; n ; i++) {</span>
<span class="nc" id="L1224">            Component c = parent.getComponent(i);</span>
<span class="nc" id="L1225">            Constraints cc = getConstraints(c);</span>
<span class="nc" id="L1226">            int x = abandonCycles(cc.getX()).getValue();</span>
<span class="nc" id="L1227">            int y = abandonCycles(cc.getY()).getValue();</span>
<span class="nc" id="L1228">            int width = abandonCycles(cc.getWidth()).getValue();</span>
<span class="nc" id="L1229">            int height = abandonCycles(cc.getHeight()).getValue();</span>
<span class="nc" id="L1230">            c.setBounds(insets.left + x, insets.top + y, width, height);</span>
        }
<span class="nc" id="L1232">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>