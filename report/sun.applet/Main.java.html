<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.applet</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.applet;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.lang.reflect.Method;
import java.lang.reflect.InvocationTargetException;
import java.net.URL;
import java.net.MalformedURLException;
import java.util.Enumeration;
import java.util.Properties;
import java.util.Vector;
import sun.net.www.ParseUtil;

/**
 * The main entry point into AppletViewer.
 */
<span class="nc" id="L45">public class Main {</span>
    /**
     * The file which contains all of the AppletViewer specific properties.
     */
    static File theUserPropertiesFile;

    /**
     * The default key/value pairs for the required user-specific properties.
     */
<span class="nc" id="L54">    static final String [][] avDefaultUserProps = {</span>
        // There's a bootstrapping problem here.  If we don't have a proxyHost,
        // then we will not be able to connect to a URL outside the firewall;
        // however, there's no way for us to set the proxyHost without starting
        // AppletViewer.  This problem existed before the re-write.
        {&quot;http.proxyHost&quot;, &quot;&quot;},
        {&quot;http.proxyPort&quot;, &quot;80&quot;},
        {&quot;package.restrict.access.sun&quot;, &quot;true&quot;}
    };

    static {
<span class="nc" id="L65">        File userHome = new File(System.getProperty(&quot;user.home&quot;));</span>
        // make sure we can write to this location
<span class="nc" id="L67">        userHome.canWrite();</span>

<span class="nc" id="L69">        theUserPropertiesFile = new File(userHome, &quot;.appletviewer&quot;);</span>
    }

    // i18n
<span class="nc" id="L73">    private static AppletMessageHandler amh = new AppletMessageHandler(&quot;appletviewer&quot;);</span>

    /**
     * Member variables set according to options passed in to AppletViewer.
     */
<span class="nc" id="L78">    private boolean debugFlag = false;</span>
<span class="nc" id="L79">    private boolean helpFlag  = false;</span>
<span class="nc" id="L80">    private String  encoding  = null;</span>
<span class="nc" id="L81">    private boolean noSecurityFlag  = false;</span>
<span class="nc" id="L82">    private static boolean cmdLineTestFlag = false;</span>

    /**
     * The list of valid URLs passed in to AppletViewer.
     */
<span class="nc" id="L87">    private static Vector urlList = new Vector(1);</span>

    // This is used in init().  Getting rid of this is desirable but depends
    // on whether the property that uses it is necessary/standard.
<span class="nc" id="L91">    public static final String theVersion = System.getProperty(&quot;java.version&quot;);</span>

    /**
     * The main entry point into AppletViewer.
     */
    public static void main(String [] args) {
<span class="nc" id="L97">        Main m = new Main();</span>
<span class="nc" id="L98">        int ret = m.run(args);</span>

        // Exit immediately if we got some sort of error along the way.
        // For debugging purposes, if we have passed in &quot;-XcmdLineTest&quot; we
        // force a premature exit.
<span class="nc bnc" id="L103" title="All 4 branches missed.">        if ((ret != 0) || (cmdLineTestFlag))</span>
<span class="nc" id="L104">            System.exit(ret);</span>
<span class="nc" id="L105">    }</span>

    private int run(String [] args) {
        // DECODE ARGS
        try {
<span class="nc bnc" id="L110" title="All 2 branches missed.">            if (args.length == 0) {</span>
<span class="nc" id="L111">                usage();</span>
<span class="nc" id="L112">                return 0;</span>
            }
<span class="nc bnc" id="L114" title="All 2 branches missed.">            for (int i = 0; i &lt; args.length; ) {</span>
<span class="nc" id="L115">                int j = decodeArg(args, i);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">                if (j == 0) {</span>
<span class="nc" id="L117">                    throw new ParseException(lookup(&quot;main.err.unrecognizedarg&quot;,</span>
                                                    args[i]));
                }
<span class="nc" id="L120">                i += j;</span>
<span class="nc" id="L121">            }</span>
<span class="nc" id="L122">        } catch (ParseException e) {</span>
<span class="nc" id="L123">            System.err.println(e.getMessage());</span>
<span class="nc" id="L124">            return 1;</span>
<span class="nc" id="L125">        }</span>

        // CHECK ARGUMENTS
<span class="nc bnc" id="L128" title="All 2 branches missed.">        if (helpFlag) {</span>
<span class="nc" id="L129">            usage();</span>
<span class="nc" id="L130">            return 0;</span>
        }

<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (urlList.size() == 0) {</span>
<span class="nc" id="L134">            System.err.println(lookup(&quot;main.err.inputfile&quot;));</span>
<span class="nc" id="L135">            return 1;</span>
        }

<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (debugFlag) {</span>
            // START A DEBUG SESSION
            // Given the current architecture, we will end up decoding the
            // arguments again, but at least we are guaranteed to have
            // arguments which are valid.
<span class="nc" id="L143">            return invokeDebugger(args);</span>
        }

        // INSTALL THE SECURITY MANAGER (if necessary)
<span class="nc bnc" id="L147" title="All 4 branches missed.">        if (!noSecurityFlag &amp;&amp; (System.getSecurityManager() == null))</span>
<span class="nc" id="L148">            init();</span>

        // LAUNCH APPLETVIEWER FOR EACH URL
<span class="nc bnc" id="L151" title="All 2 branches missed.">        for (int i = 0; i &lt; urlList.size(); i++) {</span>
            try {
                // XXX 5/17 this parsing method should be changed/fixed so that
                // it doesn't do both parsing of the html file and launching of
                // the AppletPanel
<span class="nc" id="L156">                AppletViewer.parse((URL) urlList.elementAt(i), encoding);</span>
<span class="nc" id="L157">            } catch (IOException e) {</span>
<span class="nc" id="L158">                System.err.println(lookup(&quot;main.err.io&quot;, e.getMessage()));</span>
<span class="nc" id="L159">                return 1;</span>
<span class="nc" id="L160">            }</span>
        }
<span class="nc" id="L162">        return 0;</span>
    }

    private static void usage() {
<span class="nc" id="L166">        System.out.println(lookup(&quot;usage&quot;));</span>
<span class="nc" id="L167">    }</span>

    /**
     * Decode a single argument in an array and return the number of elements
     * used.
     *
     * @param args The array of arguments.
     * @param i    The argument to decode.
     * @return     The number of array elements used when the argument was
     *             decoded.
     * @exception ParseException
     *             Thrown when there is a problem with something in the
     *             argument array.
     */
    private int decodeArg(String [] args, int i) throws ParseException {
<span class="nc" id="L182">        String arg = args[i];</span>
<span class="nc" id="L183">        int argc = args.length;</span>

<span class="nc bnc" id="L185" title="All 4 branches missed.">        if (&quot;-help&quot;.equalsIgnoreCase(arg) || &quot;-?&quot;.equals(arg)) {</span>
<span class="nc" id="L186">            helpFlag = true;</span>
<span class="nc" id="L187">            return 1;</span>
<span class="nc bnc" id="L188" title="All 4 branches missed.">        } else if (&quot;-encoding&quot;.equals(arg) &amp;&amp; (i &lt; argc - 1)) {</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">            if (encoding != null)</span>
<span class="nc" id="L190">                throw new ParseException(lookup(&quot;main.err.dupoption&quot;, arg));</span>
<span class="nc" id="L191">            encoding = args[++i];</span>
<span class="nc" id="L192">            return 2;</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        } else if (&quot;-debug&quot;.equals(arg)) {</span>
<span class="nc" id="L194">            debugFlag = true;</span>
<span class="nc" id="L195">            return 1;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">        } else if (&quot;-Xnosecurity&quot;.equals(arg)) {</span>
            // This is an undocumented (and, in the future, unsupported)
            // flag which prevents AppletViewer from installing its own
            // SecurityManager.

<span class="nc" id="L201">            System.err.println();</span>
<span class="nc" id="L202">            System.err.println(lookup(&quot;main.warn.nosecmgr&quot;));</span>
<span class="nc" id="L203">            System.err.println();</span>

<span class="nc" id="L205">            noSecurityFlag = true;</span>
<span class="nc" id="L206">            return 1;</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        } else if (&quot;-XcmdLineTest&quot;.equals(arg)) {</span>
            // This is an internal flag which should be used for command-line
            // testing.  It instructs AppletViewer to force a premature exit
            // immediately after the applet has been launched.
<span class="nc" id="L211">            cmdLineTestFlag = true;</span>
<span class="nc" id="L212">            return 1;</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">        } else if (arg.startsWith(&quot;-&quot;)) {</span>
<span class="nc" id="L214">            throw new ParseException(lookup(&quot;main.err.unsupportedopt&quot;, arg));</span>
        } else {
            // we found what we hope is a url
<span class="nc" id="L217">            URL url = parseURL(arg);</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">            if (url != null) {</span>
<span class="nc" id="L219">                urlList.addElement(url);</span>
<span class="nc" id="L220">                return 1;</span>
            }
        }
<span class="nc" id="L223">        return 0;</span>
    }

    /**
     * Following the relevant RFC, construct a valid URL based on the passed in
     * string.
     *
     * @param url  a string which represents either a relative or absolute URL.
     * @return     a URL when the passed in string can be interpreted according
     *             to the RFC, &lt;code&gt;null&lt;/code&gt; otherwise.
     * @exception  ParseException
     *             Thrown when we are unable to construct a proper URL from the
     *             passed in string.
     */
    private URL parseURL(String url) throws ParseException {
<span class="nc" id="L238">        URL u = null;</span>
        // prefix of the urls with 'file' scheme
<span class="nc" id="L240">        String prefix = &quot;file:&quot;;</span>

        try {
<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (url.indexOf(':') &lt;= 1)</span>
            {
                // appletviewer accepts only unencoded filesystem paths
<span class="nc" id="L246">                u = ParseUtil.fileToEncodedURL(new File(url));</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">            } else if (url.startsWith(prefix) &amp;&amp;</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">                       url.length() != prefix.length() &amp;&amp;</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">                       !(new File(url.substring(prefix.length())).isAbsolute()))</span>
            {
                // relative file URL, like this &quot;file:index.html&quot;
                // ensure that this file URL is absolute
                // ParseUtil.fileToEncodedURL should be done last (see 6329251)
<span class="nc" id="L254">                String path = ParseUtil.fileToEncodedURL(new File(System.getProperty(&quot;user.dir&quot;))).getPath() +</span>
<span class="nc" id="L255">                    url.substring(prefix.length());</span>
<span class="nc" id="L256">                u = new URL(&quot;file&quot;, &quot;&quot;, path);</span>
<span class="nc" id="L257">            } else {</span>
                // appletviewer accepts only encoded urls
<span class="nc" id="L259">                u = new URL(url);</span>
            }
<span class="nc" id="L261">        } catch (MalformedURLException e) {</span>
<span class="nc" id="L262">            throw new ParseException(lookup(&quot;main.err.badurl&quot;,</span>
<span class="nc" id="L263">                                            url, e.getMessage()));</span>
<span class="nc" id="L264">        }</span>

<span class="nc" id="L266">        return u;</span>
    }

    /**
     * Invoke the debugger with the arguments passed in to appletviewer.
     *
     * @param args The arguments passed into the debugger.
     * @return     &lt;code&gt;0&lt;/code&gt; if the debugger is invoked successfully,
     *             &lt;code&gt;1&lt;/code&gt; otherwise.
     */
    private int invokeDebugger(String [] args) {
        // CONSTRUCT THE COMMAND LINE
<span class="nc" id="L278">        String [] newArgs = new String[args.length + 1];</span>
<span class="nc" id="L279">        int current = 0;</span>

        // Add a -classpath argument that prevents
        // the debugger from launching appletviewer with the default of
        // &quot;.&quot;. appletviewer's classpath should never contain valid
        // classes since they will result in security exceptions.
        // Ideally, the classpath should be set to &quot;&quot;, but the VM won't
        // allow an empty classpath, so a phony directory name is used.
<span class="nc" id="L287">        String phonyDir = System.getProperty(&quot;java.home&quot;) +</span>
                          File.separator + &quot;phony&quot;;
<span class="nc" id="L289">        newArgs[current++] = &quot;-Djava.class.path=&quot; + phonyDir;</span>

        // Appletviewer's main class is the debuggee
<span class="nc" id="L292">        newArgs[current++] = &quot;sun.applet.Main&quot;;</span>

        // Append all the of the original appletviewer arguments,
        // leaving out the &quot;-debug&quot; option.
<span class="nc bnc" id="L296" title="All 2 branches missed.">        for (int i = 0; i &lt; args.length; i++) {</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">            if (!(&quot;-debug&quot;.equals(args[i]))) {</span>
<span class="nc" id="L298">                newArgs[current++] = args[i];</span>
            }
        }

        // LAUNCH THE DEBUGGER
        // Reflection is used for two reasons:
        // 1) The debugger classes are on classpath and thus must be loaded
        // by the application class loader. (Currently, appletviewer are
        // loaded through the boot class path out of rt.jar.)
        // 2) Reflection removes any build dependency between appletviewer
        // and jdb.
        try {
<span class="nc" id="L310">            Class c = Class.forName(&quot;com.sun.tools.example.debug.tty.TTY&quot;, true,</span>
<span class="nc" id="L311">                                    ClassLoader.getSystemClassLoader());</span>
<span class="nc" id="L312">            Method m = c.getDeclaredMethod(&quot;main&quot;,</span>
                                           new Class[] { String[].class });
<span class="nc" id="L314">            m.invoke(null, new Object[] { newArgs });</span>
<span class="nc" id="L315">        } catch (ClassNotFoundException cnfe) {</span>
<span class="nc" id="L316">            System.err.println(lookup(&quot;main.debug.cantfinddebug&quot;));</span>
<span class="nc" id="L317">            return 1;</span>
<span class="nc" id="L318">        } catch (NoSuchMethodException nsme) {</span>
<span class="nc" id="L319">            System.err.println(lookup(&quot;main.debug.cantfindmain&quot;));</span>
<span class="nc" id="L320">            return 1;</span>
<span class="nc" id="L321">        } catch (InvocationTargetException ite) {</span>
<span class="nc" id="L322">            System.err.println(lookup(&quot;main.debug.exceptionindebug&quot;));</span>
<span class="nc" id="L323">            return 1;</span>
<span class="nc" id="L324">        } catch (IllegalAccessException iae) {</span>
<span class="nc" id="L325">            System.err.println(lookup(&quot;main.debug.cantaccess&quot;));</span>
<span class="nc" id="L326">            return 1;</span>
<span class="nc" id="L327">        }</span>
<span class="nc" id="L328">        return 0;</span>
    }

    private void init() {
        // GET APPLETVIEWER USER-SPECIFIC PROPERTIES
<span class="nc" id="L333">        Properties avProps = getAVProps();</span>

        // ADD OTHER RANDOM PROPERTIES
        // XXX 5/18 need to revisit why these are here, is there some
        // standard for what is available?

        // Standard browser properties
<span class="nc" id="L340">        avProps.put(&quot;browser&quot;, &quot;sun.applet.AppletViewer&quot;);</span>
<span class="nc" id="L341">        avProps.put(&quot;browser.version&quot;, &quot;1.06&quot;);</span>
<span class="nc" id="L342">        avProps.put(&quot;browser.vendor&quot;, &quot;Oracle Corporation&quot;);</span>
<span class="nc" id="L343">        avProps.put(&quot;http.agent&quot;, &quot;Java(tm) 2 SDK, Standard Edition v&quot; + theVersion);</span>

        // Define which packages can be extended by applets
        // XXX 5/19 probably not needed, not checked in AppletSecurity
<span class="nc" id="L347">        avProps.put(&quot;package.restrict.definition.java&quot;, &quot;true&quot;);</span>
<span class="nc" id="L348">        avProps.put(&quot;package.restrict.definition.sun&quot;, &quot;true&quot;);</span>

        // Define which properties can be read by applets.
        // A property named by &quot;key&quot; can be read only when its twin
        // property &quot;key.applet&quot; is true.  The following ten properties
        // are open by default.  Any other property can be explicitly
        // opened up by the browser user by calling appletviewer with
        // -J-Dkey.applet=true
<span class="nc" id="L356">        avProps.put(&quot;java.version.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L357">        avProps.put(&quot;java.vendor.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L358">        avProps.put(&quot;java.vendor.url.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L359">        avProps.put(&quot;java.class.version.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L360">        avProps.put(&quot;os.name.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L361">        avProps.put(&quot;os.version.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L362">        avProps.put(&quot;os.arch.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L363">        avProps.put(&quot;file.separator.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L364">        avProps.put(&quot;path.separator.applet&quot;, &quot;true&quot;);</span>
<span class="nc" id="L365">        avProps.put(&quot;line.separator.applet&quot;, &quot;true&quot;);</span>

        // Read in the System properties.  If something is going to be
        // over-written, warn about it.
<span class="nc" id="L369">        Properties sysProps = System.getProperties();</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">        for (Enumeration e = sysProps.propertyNames(); e.hasMoreElements(); ) {</span>
<span class="nc" id="L371">            String key = (String) e.nextElement();</span>
<span class="nc" id="L372">            String val = (String) sysProps.getProperty(key);</span>
            String oldVal;
<span class="nc bnc" id="L374" title="All 2 branches missed.">            if ((oldVal = (String) avProps.setProperty(key, val)) != null)</span>
<span class="nc" id="L375">                System.err.println(lookup(&quot;main.warn.prop.overwrite&quot;, key,</span>
                                          oldVal, val));
<span class="nc" id="L377">        }</span>

        // INSTALL THE PROPERTY LIST
<span class="nc" id="L380">        System.setProperties(avProps);</span>

        // Create and install the security manager
<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (!noSecurityFlag) {</span>
<span class="nc" id="L384">            System.setSecurityManager(new AppletSecurity());</span>
        } else {
<span class="nc" id="L386">            System.err.println(lookup(&quot;main.nosecmgr&quot;));</span>
        }

        // REMIND: Create and install a socket factory!
<span class="nc" id="L390">    }</span>

    /**
     * Read the AppletViewer user-specific properties.  Typically, these
     * properties should reside in the file $USER/.appletviewer.  If this file
     * does not exist, one will be created.  Information for this file will
     * be gleaned from $USER/.hotjava/properties.  If that file does not exist,
     * then default values will be used.
     *
     * @return     A Properties object containing all of the AppletViewer
     *             user-specific properties.
     */
    private Properties getAVProps() {
<span class="nc" id="L403">        Properties avProps = new Properties();</span>

<span class="nc" id="L405">        File dotAV = theUserPropertiesFile;</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">        if (dotAV.exists()) {</span>
            // we must have already done the conversion
<span class="nc bnc" id="L408" title="All 2 branches missed.">            if (dotAV.canRead()) {</span>
                // just read the file
<span class="nc" id="L410">                avProps = getAVProps(dotAV);</span>
            } else {
                // send out warning and use defaults
<span class="nc" id="L413">                System.err.println(lookup(&quot;main.warn.cantreadprops&quot;,</span>
<span class="nc" id="L414">                                          dotAV.toString()));</span>
<span class="nc" id="L415">                avProps = setDefaultAVProps();</span>
            }
        } else {
            // create the $USER/.appletviewer file

            // see if $USER/.hotjava/properties exists
<span class="nc" id="L421">            File userHome = new File(System.getProperty(&quot;user.home&quot;));</span>
<span class="nc" id="L422">            File dotHJ = new File(userHome, &quot;.hotjava&quot;);</span>
<span class="nc" id="L423">            dotHJ = new File(dotHJ, &quot;properties&quot;);</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">            if (dotHJ.exists()) {</span>
                // just read the file
<span class="nc" id="L426">                avProps = getAVProps(dotHJ);</span>
            } else {
                // send out warning and use defaults
<span class="nc" id="L429">                System.err.println(lookup(&quot;main.warn.cantreadprops&quot;,</span>
<span class="nc" id="L430">                                          dotHJ.toString()));</span>
<span class="nc" id="L431">                avProps = setDefaultAVProps();</span>
            }

            // SAVE THE FILE
            try {
<span class="nc" id="L436">                FileOutputStream out = new FileOutputStream(dotAV);</span>
<span class="nc" id="L437">                avProps.store(out, lookup(&quot;main.prop.store&quot;));</span>
<span class="nc" id="L438">                out.close();</span>
<span class="nc" id="L439">            } catch (IOException e) {</span>
<span class="nc" id="L440">                System.err.println(lookup(&quot;main.err.prop.cantsave&quot;,</span>
<span class="nc" id="L441">                                          dotAV.toString()));</span>
<span class="nc" id="L442">            }</span>
        }
<span class="nc" id="L444">        return avProps;</span>
    }

    /**
     * Set the AppletViewer user-specific properties to be the default values.
     *
     * @return     A Properties object containing all of the AppletViewer
     *             user-specific properties, set to the default values.
     */
    private Properties setDefaultAVProps() {
<span class="nc" id="L454">        Properties avProps = new Properties();</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">        for (int i = 0; i &lt; avDefaultUserProps.length; i++) {</span>
<span class="nc" id="L456">            avProps.setProperty(avDefaultUserProps[i][0],</span>
                                avDefaultUserProps[i][1]);
        }
<span class="nc" id="L459">        return avProps;</span>
    }

    /**
     * Given a file, find only the properties that are setable by AppletViewer.
     *
     * @param inFile A Properties file from which we select the properties of
     *             interest.
     * @return     A Properties object containing all of the AppletViewer
     *             user-specific properties.
     */
    private Properties getAVProps(File inFile) {
<span class="nc" id="L471">        Properties avProps  = new Properties();</span>

        // read the file
<span class="nc" id="L474">        Properties tmpProps = new Properties();</span>
        try {
<span class="nc" id="L476">            FileInputStream in = new FileInputStream(inFile);</span>
<span class="nc" id="L477">            tmpProps.load(new BufferedInputStream(in));</span>
<span class="nc" id="L478">            in.close();</span>
<span class="nc" id="L479">        } catch (IOException e) {</span>
<span class="nc" id="L480">            System.err.println(lookup(&quot;main.err.prop.cantread&quot;,</span>
<span class="nc" id="L481">                                      inFile.toString()));</span>
<span class="nc" id="L482">        }</span>

        // pick off the properties we care about
<span class="nc bnc" id="L485" title="All 2 branches missed.">        for (int i = 0; i &lt; avDefaultUserProps.length; i++) {</span>
<span class="nc" id="L486">            String value = tmpProps.getProperty(avDefaultUserProps[i][0]);</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">            if (value != null) {</span>
                // the property exists in the file, so replace the default
<span class="nc" id="L489">                avProps.setProperty(avDefaultUserProps[i][0], value);</span>
            } else {
                // just use the default
<span class="nc" id="L492">                avProps.setProperty(avDefaultUserProps[i][0],</span>
                                    avDefaultUserProps[i][1]);
            }
        }
<span class="nc" id="L496">        return avProps;</span>
    }

    /**
     * Methods for easier i18n handling.
     */

    private static String lookup(String key) {
<span class="nc" id="L504">        return amh.getMessage(key);</span>
    }

    private static String lookup(String key, String arg0) {
<span class="nc" id="L508">        return amh.getMessage(key, arg0);</span>
    }

    private static String lookup(String key, String arg0, String arg1) {
<span class="nc" id="L512">        return amh.getMessage(key, arg0, arg1);</span>
    }

    private static String lookup(String key, String arg0, String arg1,
                                 String arg2) {
<span class="nc" id="L517">        return amh.getMessage(key, arg0, arg1, arg2);</span>
    }

<span class="nc" id="L520">    class ParseException extends RuntimeException</span>
    {
<span class="nc" id="L522">        public ParseException(String msg) {</span>
<span class="nc" id="L523">            super(msg);</span>
<span class="nc" id="L524">        }</span>

<span class="nc" id="L526">        public ParseException(Throwable t) {</span>
<span class="nc" id="L527">            super(t.getMessage());</span>
<span class="nc" id="L528">            this.t = t;</span>
<span class="nc" id="L529">        }</span>

<span class="nc" id="L531">        Throwable t = null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>