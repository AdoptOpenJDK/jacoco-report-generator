<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MessageDigestAlgorithm.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.org.apache.xml.internal.security.algorithms</a> &gt; <span class="el_source">MessageDigestAlgorithm.java</span></div><h1>MessageDigestAlgorithm.java</h1><pre class="source lang-java linenums">/*
 * reserved comment block
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
package com.sun.org.apache.xml.internal.security.algorithms;

import java.security.MessageDigest;
import java.security.NoSuchProviderException;

import com.sun.org.apache.xml.internal.security.signature.XMLSignatureException;
import com.sun.org.apache.xml.internal.security.utils.Constants;
import com.sun.org.apache.xml.internal.security.utils.EncryptionConstants;
import org.w3c.dom.Document;

/**
 * Digest Message wrapper &amp; selector class.
 *
 * &lt;pre&gt;
 * MessageDigestAlgorithm.getInstance()
 * &lt;/pre&gt;
 */
public class MessageDigestAlgorithm extends Algorithm {

    /** Message Digest - NOT RECOMMENDED MD5*/
    public static final String ALGO_ID_DIGEST_NOT_RECOMMENDED_MD5 =
        Constants.MoreAlgorithmsSpecNS + &quot;md5&quot;;
    /** Digest - Required SHA1*/
    public static final String ALGO_ID_DIGEST_SHA1 = Constants.SignatureSpecNS + &quot;sha1&quot;;
    /** Message Digest - RECOMMENDED SHA256*/
    public static final String ALGO_ID_DIGEST_SHA256 =
        EncryptionConstants.EncryptionSpecNS + &quot;sha256&quot;;
    /** Message Digest - OPTIONAL SHA384*/
    public static final String ALGO_ID_DIGEST_SHA384 =
        Constants.MoreAlgorithmsSpecNS + &quot;sha384&quot;;
    /** Message Digest - OPTIONAL SHA512*/
    public static final String ALGO_ID_DIGEST_SHA512 =
        EncryptionConstants.EncryptionSpecNS + &quot;sha512&quot;;
    /** Message Digest - OPTIONAL RIPEMD-160*/
    public static final String ALGO_ID_DIGEST_RIPEMD160 =
        EncryptionConstants.EncryptionSpecNS + &quot;ripemd160&quot;;

    /** Field algorithm stores the actual {@link java.security.MessageDigest} */
    private final MessageDigest algorithm;

    /**
     * Constructor for the brave who pass their own message digest algorithms and the
     * corresponding URI.
     * @param doc
     * @param algorithmURI
     */
    private MessageDigestAlgorithm(Document doc, String algorithmURI)
        throws XMLSignatureException {
<span class="nc" id="L71">        super(doc, algorithmURI);</span>

<span class="nc" id="L73">        algorithm = getDigestInstance(algorithmURI);</span>
<span class="nc" id="L74">    }</span>

    /**
     * Factory method for constructing a message digest algorithm by name.
     *
     * @param doc
     * @param algorithmURI
     * @return The MessageDigestAlgorithm element to attach in document and to digest
     * @throws XMLSignatureException
     */
    public static MessageDigestAlgorithm getInstance(
        Document doc, String algorithmURI
    ) throws XMLSignatureException {
<span class="nc" id="L87">        return new MessageDigestAlgorithm(doc, algorithmURI);</span>
    }

    private static MessageDigest getDigestInstance(String algorithmURI) throws XMLSignatureException {
<span class="nc" id="L91">        String algorithmID = JCEMapper.translateURItoJCEID(algorithmURI);</span>

<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (algorithmID == null) {</span>
<span class="nc" id="L94">            Object[] exArgs = { algorithmURI };</span>
<span class="nc" id="L95">            throw new XMLSignatureException(&quot;algorithms.NoSuchMap&quot;, exArgs);</span>
        }

        MessageDigest md;
<span class="nc" id="L99">        String provider = JCEMapper.getProviderId();</span>
        try {
<span class="nc bnc" id="L101" title="All 2 branches missed.">            if (provider == null) {</span>
<span class="nc" id="L102">                md = MessageDigest.getInstance(algorithmID);</span>
            } else {
<span class="nc" id="L104">                md = MessageDigest.getInstance(algorithmID, provider);</span>
            }
<span class="nc" id="L106">        } catch (java.security.NoSuchAlgorithmException ex) {</span>
<span class="nc" id="L107">            Object[] exArgs = { algorithmID, ex.getLocalizedMessage() };</span>

<span class="nc" id="L109">            throw new XMLSignatureException(&quot;algorithms.NoSuchAlgorithm&quot;, exArgs);</span>
<span class="nc" id="L110">        } catch (NoSuchProviderException ex) {</span>
<span class="nc" id="L111">            Object[] exArgs = { algorithmID, ex.getLocalizedMessage() };</span>

<span class="nc" id="L113">            throw new XMLSignatureException(&quot;algorithms.NoSuchAlgorithm&quot;, exArgs);</span>
<span class="nc" id="L114">        }</span>

<span class="nc" id="L116">        return md;</span>
    }

    /**
     * Returns the actual {@link java.security.MessageDigest} algorithm object
     *
     * @return the actual {@link java.security.MessageDigest} algorithm object
     */
    public java.security.MessageDigest getAlgorithm() {
<span class="nc" id="L125">        return algorithm;</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#isEqual}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @param digesta
     * @param digestb
     * @return the result of the {@link java.security.MessageDigest#isEqual} method
     */
    public static boolean isEqual(byte[] digesta, byte[] digestb) {
<span class="nc" id="L137">        return java.security.MessageDigest.isEqual(digesta, digestb);</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#digest()}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @return the result of the {@link java.security.MessageDigest#digest()} method
     */
    public byte[] digest() {
<span class="nc" id="L147">        return algorithm.digest();</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#digest(byte[])}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @param input
     * @return the result of the {@link java.security.MessageDigest#digest(byte[])} method
     */
    public byte[] digest(byte input[]) {
<span class="nc" id="L158">        return algorithm.digest(input);</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#digest(byte[], int, int)}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @param buf
     * @param offset
     * @param len
     * @return the result of the {@link java.security.MessageDigest#digest(byte[], int, int)} method
     * @throws java.security.DigestException
     */
    public int digest(byte buf[], int offset, int len) throws java.security.DigestException {
<span class="nc" id="L172">        return algorithm.digest(buf, offset, len);</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#getAlgorithm}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @return the result of the {@link java.security.MessageDigest#getAlgorithm} method
     */
    public String getJCEAlgorithmString() {
<span class="nc" id="L182">        return algorithm.getAlgorithm();</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#getProvider}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @return the result of the {@link java.security.MessageDigest#getProvider} method
     */
    public java.security.Provider getJCEProvider() {
<span class="nc" id="L192">        return algorithm.getProvider();</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#getDigestLength}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @return the result of the {@link java.security.MessageDigest#getDigestLength} method
     */
    public int getDigestLength() {
<span class="nc" id="L202">        return algorithm.getDigestLength();</span>
    }

    /**
     * Proxy method for {@link java.security.MessageDigest#reset}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     */
    public void reset() {
<span class="nc" id="L211">        algorithm.reset();</span>
<span class="nc" id="L212">    }</span>

    /**
     * Proxy method for {@link java.security.MessageDigest#update(byte[])}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @param input
     */
    public void update(byte[] input) {
<span class="nc" id="L221">        algorithm.update(input);</span>
<span class="nc" id="L222">    }</span>

    /**
     * Proxy method for {@link java.security.MessageDigest#update(byte)}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @param input
     */
    public void update(byte input) {
<span class="nc" id="L231">        algorithm.update(input);</span>
<span class="nc" id="L232">    }</span>

    /**
     * Proxy method for {@link java.security.MessageDigest#update(byte[], int, int)}
     * which is executed on the internal {@link java.security.MessageDigest} object.
     *
     * @param buf
     * @param offset
     * @param len
     */
    public void update(byte buf[], int offset, int len) {
<span class="nc" id="L243">        algorithm.update(buf, offset, len);</span>
<span class="nc" id="L244">    }</span>

    /** @inheritDoc */
    public String getBaseNamespace() {
<span class="nc" id="L248">        return Constants.SignatureSpecNS;</span>
    }

    /** @inheritDoc */
    public String getBaseLocalName() {
<span class="nc" id="L253">        return Constants._TAG_DIGESTMETHOD;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>