<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SynthTableUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.synth</a> &gt; <span class="el_source">SynthTableUI.java</span></div><h1>SynthTableUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.synth;

import java.awt.Color;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Point;
import java.awt.Rectangle;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.text.DateFormat;
import java.text.Format;
import java.text.NumberFormat;
import java.util.Date;
import javax.swing.Icon;
import javax.swing.ImageIcon;
import javax.swing.JCheckBox;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JTable;
import javax.swing.LookAndFeel;
import javax.swing.border.Border;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.BasicTableUI;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.JTableHeader;
import javax.swing.table.TableCellRenderer;
import javax.swing.table.TableColumn;
import javax.swing.table.TableColumnModel;

/**
 * Provides the Synth L&amp;amp;F UI delegate for
 * {@link javax.swing.JTable}.
 *
 * @author Philip Milne
 * @since 1.7
 */
<span class="nc" id="L63">public class SynthTableUI extends BasicTableUI</span>
                          implements SynthUI, PropertyChangeListener {
//
// Instance Variables
//

    private SynthStyle style;

    private boolean useTableColors;
    private boolean useUIBorder;
    private Color alternateColor; //the background color to use for cells for alternate cells

    // TableCellRenderer installed on the JTable at the time we're installed,
    // cached so that we can reinstall them at uninstallUI time.
    private TableCellRenderer dateRenderer;
    private TableCellRenderer numberRenderer;
    private TableCellRenderer doubleRender;
    private TableCellRenderer floatRenderer;
    private TableCellRenderer iconRenderer;
    private TableCellRenderer imageIconRenderer;
    private TableCellRenderer booleanRenderer;
    private TableCellRenderer objectRenderer;

//
//  The installation/uninstall procedures and support
//

    /**
     * Creates a new UI object for the given component.
     *
     * @param c component to create UI object for
     * @return the UI object
     */
    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L97">        return new SynthTableUI();</span>
    }

    /**
     * Initializes JTable properties, such as font, foreground, and background.
     * The font, foreground, and background properties are only set if their
     * current value is either null or a UIResource, other properties are set
     * if the current value is null.
     *
     * @see #installUI
     */
    @Override
    protected void installDefaults() {
<span class="nc" id="L110">        dateRenderer = installRendererIfPossible(Date.class, null);</span>
<span class="nc" id="L111">        numberRenderer = installRendererIfPossible(Number.class, null);</span>
<span class="nc" id="L112">        doubleRender = installRendererIfPossible(Double.class, null);</span>
<span class="nc" id="L113">        floatRenderer = installRendererIfPossible(Float.class, null);</span>
<span class="nc" id="L114">        iconRenderer = installRendererIfPossible(Icon.class, null);</span>
<span class="nc" id="L115">        imageIconRenderer = installRendererIfPossible(ImageIcon.class, null);</span>
<span class="nc" id="L116">        booleanRenderer = installRendererIfPossible(Boolean.class,</span>
                                 new SynthBooleanTableCellRenderer());
<span class="nc" id="L118">        objectRenderer = installRendererIfPossible(Object.class,</span>
                                        new SynthTableCellRenderer());
<span class="nc" id="L120">        updateStyle(table);</span>
<span class="nc" id="L121">    }</span>

    private TableCellRenderer installRendererIfPossible(Class objectClass,
                                     TableCellRenderer renderer) {
<span class="nc" id="L125">        TableCellRenderer currentRenderer = table.getDefaultRenderer(</span>
                                 objectClass);
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (currentRenderer instanceof UIResource) {</span>
<span class="nc" id="L128">            table.setDefaultRenderer(objectClass, renderer);</span>
        }
<span class="nc" id="L130">        return currentRenderer;</span>
    }

    private void updateStyle(JTable c) {
<span class="nc" id="L134">        SynthContext context = getContext(c, ENABLED);</span>
<span class="nc" id="L135">        SynthStyle oldStyle = style;</span>
<span class="nc" id="L136">        style = SynthLookAndFeel.updateStyle(context, this);</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (style != oldStyle) {</span>
<span class="nc" id="L138">            context.setComponentState(ENABLED | SELECTED);</span>

<span class="nc" id="L140">            Color sbg = table.getSelectionBackground();</span>
<span class="nc bnc" id="L141" title="All 4 branches missed.">            if (sbg == null || sbg instanceof UIResource) {</span>
<span class="nc" id="L142">                table.setSelectionBackground(style.getColor(</span>
                                        context, ColorType.TEXT_BACKGROUND));
            }

<span class="nc" id="L146">            Color sfg = table.getSelectionForeground();</span>
<span class="nc bnc" id="L147" title="All 4 branches missed.">            if (sfg == null || sfg instanceof UIResource) {</span>
<span class="nc" id="L148">                table.setSelectionForeground(style.getColor(</span>
                                  context, ColorType.TEXT_FOREGROUND));
            }

<span class="nc" id="L152">            context.setComponentState(ENABLED);</span>

<span class="nc" id="L154">            Color gridColor = table.getGridColor();</span>
<span class="nc bnc" id="L155" title="All 4 branches missed.">            if (gridColor == null || gridColor instanceof UIResource) {</span>
<span class="nc" id="L156">                gridColor = (Color)style.get(context, &quot;Table.gridColor&quot;);</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                if (gridColor == null) {</span>
<span class="nc" id="L158">                    gridColor = style.getColor(context, ColorType.FOREGROUND);</span>
                }
<span class="nc bnc" id="L160" title="All 2 branches missed.">                table.setGridColor(gridColor == null ? new ColorUIResource(Color.GRAY) : gridColor);</span>
            }

<span class="nc" id="L163">            useTableColors = style.getBoolean(context,</span>
                                  &quot;Table.rendererUseTableColors&quot;, true);
<span class="nc" id="L165">            useUIBorder = style.getBoolean(context,</span>
                                  &quot;Table.rendererUseUIBorder&quot;, true);

<span class="nc" id="L168">            Object rowHeight = style.get(context, &quot;Table.rowHeight&quot;);</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (rowHeight != null) {</span>
<span class="nc" id="L170">                LookAndFeel.installProperty(table, &quot;rowHeight&quot;, rowHeight);</span>
            }
<span class="nc" id="L172">            boolean showGrid = style.getBoolean(context, &quot;Table.showGrid&quot;, true);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (!showGrid) {</span>
<span class="nc" id="L174">                table.setShowGrid(false);</span>
            }
<span class="nc" id="L176">            Dimension d = table.getIntercellSpacing();</span>
//            if (d == null || d instanceof UIResource) {
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (d != null) {</span>
<span class="nc" id="L179">                d = (Dimension)style.get(context, &quot;Table.intercellSpacing&quot;);</span>
            }
<span class="nc" id="L181">            alternateColor = (Color)style.get(context, &quot;Table.alternateRowColor&quot;);</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (d != null) {</span>
<span class="nc" id="L183">                table.setIntercellSpacing(d);</span>
            }


<span class="nc bnc" id="L187" title="All 2 branches missed.">            if (oldStyle != null) {</span>
<span class="nc" id="L188">                uninstallKeyboardActions();</span>
<span class="nc" id="L189">                installKeyboardActions();</span>
            }
        }
<span class="nc" id="L192">        context.dispose();</span>
<span class="nc" id="L193">    }</span>

    /**
     * Attaches listeners to the JTable.
     */
    @Override
    protected void installListeners() {
<span class="nc" id="L200">        super.installListeners();</span>
<span class="nc" id="L201">        table.addPropertyChangeListener(this);</span>
<span class="nc" id="L202">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void uninstallDefaults() {
<span class="nc" id="L209">        table.setDefaultRenderer(Date.class, dateRenderer);</span>
<span class="nc" id="L210">        table.setDefaultRenderer(Number.class, numberRenderer);</span>
<span class="nc" id="L211">        table.setDefaultRenderer(Double.class, doubleRender);</span>
<span class="nc" id="L212">        table.setDefaultRenderer(Float.class, floatRenderer);</span>
<span class="nc" id="L213">        table.setDefaultRenderer(Icon.class, iconRenderer);</span>
<span class="nc" id="L214">        table.setDefaultRenderer(ImageIcon.class, imageIconRenderer);</span>
<span class="nc" id="L215">        table.setDefaultRenderer(Boolean.class, booleanRenderer);</span>
<span class="nc" id="L216">        table.setDefaultRenderer(Object.class, objectRenderer);</span>

<span class="nc bnc" id="L218" title="All 2 branches missed.">        if (table.getTransferHandler() instanceof UIResource) {</span>
<span class="nc" id="L219">            table.setTransferHandler(null);</span>
        }
<span class="nc" id="L221">        SynthContext context = getContext(table, ENABLED);</span>
<span class="nc" id="L222">        style.uninstallDefaults(context);</span>
<span class="nc" id="L223">        context.dispose();</span>
<span class="nc" id="L224">        style = null;</span>
<span class="nc" id="L225">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void uninstallListeners() {
<span class="nc" id="L232">        table.removePropertyChangeListener(this);</span>
<span class="nc" id="L233">        super.uninstallListeners();</span>
<span class="nc" id="L234">    }</span>

    //
    // SynthUI
    //

    /**
     * {@inheritDoc}
     */
    @Override
    public SynthContext getContext(JComponent c) {
<span class="nc" id="L245">        return getContext(c, SynthLookAndFeel.getComponentState(c));</span>
    }

    private SynthContext getContext(JComponent c, int state) {
<span class="nc" id="L249">        return SynthContext.getContext(SynthContext.class, c,</span>
<span class="nc" id="L250">                    SynthLookAndFeel.getRegion(c), style, state);</span>
    }

//
//  Paint methods and support
//

    /**
     * Notifies this UI delegate to repaint the specified component.
     * This method paints the component background, then calls
     * the {@link #paint(SynthContext,Graphics)} method.
     *
     * &lt;p&gt;In general, this method does not need to be overridden by subclasses.
     * All Look and Feel rendering code should reside in the {@code paint} method.
     *
     * @param g the {@code Graphics} object used for painting
     * @param c the component being painted
     * @see #paint(SynthContext,Graphics)
     */
    @Override
    public void update(Graphics g, JComponent c) {
<span class="nc" id="L271">        SynthContext context = getContext(c);</span>

<span class="nc" id="L273">        SynthLookAndFeel.update(context, g);</span>
<span class="nc" id="L274">        context.getPainter().paintTableBackground(context,</span>
<span class="nc" id="L275">                          g, 0, 0, c.getWidth(), c.getHeight());</span>
<span class="nc" id="L276">        paint(context, g);</span>
<span class="nc" id="L277">        context.dispose();</span>
<span class="nc" id="L278">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void paintBorder(SynthContext context, Graphics g, int x,
                            int y, int w, int h) {
<span class="nc" id="L286">        context.getPainter().paintTableBorder(context, g, x, y, w, h);</span>
<span class="nc" id="L287">    }</span>

    /**
     * Paints the specified component according to the Look and Feel.
     * &lt;p&gt;This method is not used by Synth Look and Feel.
     * Painting is handled by the {@link #paint(SynthContext,Graphics)} method.
     *
     * @param g the {@code Graphics} object used for painting
     * @param c the component being painted
     * @see #paint(SynthContext,Graphics)
     */
    @Override
    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L300">        SynthContext context = getContext(c);</span>

<span class="nc" id="L302">        paint(context, g);</span>
<span class="nc" id="L303">        context.dispose();</span>
<span class="nc" id="L304">    }</span>

    /**
     * Paints the specified component.
     *
     * @param context context for the component being painted
     * @param g the {@code Graphics} object used for painting
     * @see #update(Graphics,JComponent)
     */
    protected void paint(SynthContext context, Graphics g) {
<span class="nc" id="L314">        Rectangle clip = g.getClipBounds();</span>

<span class="nc" id="L316">        Rectangle bounds = table.getBounds();</span>
        // account for the fact that the graphics has already been translated
        // into the table's bounds
<span class="nc" id="L319">        bounds.x = bounds.y = 0;</span>

<span class="nc bnc" id="L321" title="All 4 branches missed.">        if (table.getRowCount() &lt;= 0 || table.getColumnCount() &lt;= 0 ||</span>
                // this check prevents us from painting the entire table
                // when the clip doesn't intersect our bounds at all
<span class="nc bnc" id="L324" title="All 2 branches missed.">                !bounds.intersects(clip)) {</span>

<span class="nc" id="L326">            paintDropLines(context, g);</span>
<span class="nc" id="L327">            return;</span>
        }

<span class="nc" id="L330">        boolean ltr = table.getComponentOrientation().isLeftToRight();</span>

<span class="nc" id="L332">        Point upperLeft = clip.getLocation();</span>

<span class="nc" id="L334">        Point lowerRight = new Point(clip.x + clip.width - 1,</span>
                                     clip.y + clip.height - 1);

<span class="nc" id="L337">        int rMin = table.rowAtPoint(upperLeft);</span>
<span class="nc" id="L338">        int rMax = table.rowAtPoint(lowerRight);</span>
        // This should never happen (as long as our bounds intersect the clip,
        // which is why we bail above if that is the case).
<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (rMin == -1) {</span>
<span class="nc" id="L342">            rMin = 0;</span>
        }
        // If the table does not have enough rows to fill the view we'll get -1.
        // (We could also get -1 if our bounds don't intersect the clip,
        // which is why we bail above if that is the case).
        // Replace this with the index of the last row.
<span class="nc bnc" id="L348" title="All 2 branches missed.">        if (rMax == -1) {</span>
<span class="nc" id="L349">            rMax = table.getRowCount()-1;</span>
        }

<span class="nc bnc" id="L352" title="All 2 branches missed.">        int cMin = table.columnAtPoint(ltr ? upperLeft : lowerRight);</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">        int cMax = table.columnAtPoint(ltr ? lowerRight : upperLeft);</span>
        // This should never happen.
<span class="nc bnc" id="L355" title="All 2 branches missed.">        if (cMin == -1) {</span>
<span class="nc" id="L356">            cMin = 0;</span>
        }
        // If the table does not have enough columns to fill the view we'll get -1.
        // Replace this with the index of the last column.
<span class="nc bnc" id="L360" title="All 2 branches missed.">        if (cMax == -1) {</span>
<span class="nc" id="L361">            cMax = table.getColumnCount()-1;</span>
        }

        // Paint the cells.
<span class="nc" id="L365">        paintCells(context, g, rMin, rMax, cMin, cMax);</span>

        // Paint the grid.
        // it is important to paint the grid after the cells, otherwise the grid will be overpainted
        // because in Synth cell renderers are likely to be opaque
<span class="nc" id="L370">        paintGrid(context, g, rMin, rMax, cMin, cMax);</span>

<span class="nc" id="L372">        paintDropLines(context, g);</span>
<span class="nc" id="L373">    }</span>

    private void paintDropLines(SynthContext context, Graphics g) {
<span class="nc" id="L376">        JTable.DropLocation loc = table.getDropLocation();</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (loc == null) {</span>
<span class="nc" id="L378">            return;</span>
        }

<span class="nc" id="L381">        Color color = (Color)style.get(context, &quot;Table.dropLineColor&quot;);</span>
<span class="nc" id="L382">        Color shortColor = (Color)style.get(context, &quot;Table.dropLineShortColor&quot;);</span>
<span class="nc bnc" id="L383" title="All 4 branches missed.">        if (color == null &amp;&amp; shortColor == null) {</span>
<span class="nc" id="L384">            return;</span>
        }

        Rectangle rect;

<span class="nc" id="L389">        rect = getHDropLineRect(loc);</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">        if (rect != null) {</span>
<span class="nc" id="L391">            int x = rect.x;</span>
<span class="nc" id="L392">            int w = rect.width;</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">            if (color != null) {</span>
<span class="nc" id="L394">                extendRect(rect, true);</span>
<span class="nc" id="L395">                g.setColor(color);</span>
<span class="nc" id="L396">                g.fillRect(rect.x, rect.y, rect.width, rect.height);</span>
            }
<span class="nc bnc" id="L398" title="All 4 branches missed.">            if (!loc.isInsertColumn() &amp;&amp; shortColor != null) {</span>
<span class="nc" id="L399">                g.setColor(shortColor);</span>
<span class="nc" id="L400">                g.fillRect(x, rect.y, w, rect.height);</span>
            }
        }

<span class="nc" id="L404">        rect = getVDropLineRect(loc);</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (rect != null) {</span>
<span class="nc" id="L406">            int y = rect.y;</span>
<span class="nc" id="L407">            int h = rect.height;</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">            if (color != null) {</span>
<span class="nc" id="L409">                extendRect(rect, false);</span>
<span class="nc" id="L410">                g.setColor(color);</span>
<span class="nc" id="L411">                g.fillRect(rect.x, rect.y, rect.width, rect.height);</span>
            }
<span class="nc bnc" id="L413" title="All 4 branches missed.">            if (!loc.isInsertRow() &amp;&amp; shortColor != null) {</span>
<span class="nc" id="L414">                g.setColor(shortColor);</span>
<span class="nc" id="L415">                g.fillRect(rect.x, y, rect.width, h);</span>
            }
        }
<span class="nc" id="L418">    }</span>

    private Rectangle getHDropLineRect(JTable.DropLocation loc) {
<span class="nc bnc" id="L421" title="All 2 branches missed.">        if (!loc.isInsertRow()) {</span>
<span class="nc" id="L422">            return null;</span>
        }

<span class="nc" id="L425">        int row = loc.getRow();</span>
<span class="nc" id="L426">        int col = loc.getColumn();</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">        if (col &gt;= table.getColumnCount()) {</span>
<span class="nc" id="L428">            col--;</span>
        }

<span class="nc" id="L431">        Rectangle rect = table.getCellRect(row, col, true);</span>

<span class="nc bnc" id="L433" title="All 2 branches missed.">        if (row &gt;= table.getRowCount()) {</span>
<span class="nc" id="L434">            row--;</span>
<span class="nc" id="L435">            Rectangle prevRect = table.getCellRect(row, col, true);</span>
<span class="nc" id="L436">            rect.y = prevRect.y + prevRect.height;</span>
        }

<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (rect.y == 0) {</span>
<span class="nc" id="L440">            rect.y = -1;</span>
        } else {
<span class="nc" id="L442">            rect.y -= 2;</span>
        }

<span class="nc" id="L445">        rect.height = 3;</span>

<span class="nc" id="L447">        return rect;</span>
    }

    private Rectangle getVDropLineRect(JTable.DropLocation loc) {
<span class="nc bnc" id="L451" title="All 2 branches missed.">        if (!loc.isInsertColumn()) {</span>
<span class="nc" id="L452">            return null;</span>
        }

<span class="nc" id="L455">        boolean ltr = table.getComponentOrientation().isLeftToRight();</span>
<span class="nc" id="L456">        int col = loc.getColumn();</span>
<span class="nc" id="L457">        Rectangle rect = table.getCellRect(loc.getRow(), col, true);</span>

<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (col &gt;= table.getColumnCount()) {</span>
<span class="nc" id="L460">            col--;</span>
<span class="nc" id="L461">            rect = table.getCellRect(loc.getRow(), col, true);</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">            if (ltr) {</span>
<span class="nc" id="L463">                rect.x = rect.x + rect.width;</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">        } else if (!ltr) {</span>
<span class="nc" id="L466">            rect.x = rect.x + rect.width;</span>
        }

<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (rect.x == 0) {</span>
<span class="nc" id="L470">            rect.x = -1;</span>
        } else {
<span class="nc" id="L472">            rect.x -= 2;</span>
        }

<span class="nc" id="L475">        rect.width = 3;</span>

<span class="nc" id="L477">        return rect;</span>
    }

    private Rectangle extendRect(Rectangle rect, boolean horizontal) {
<span class="nc bnc" id="L481" title="All 2 branches missed.">        if (rect == null) {</span>
<span class="nc" id="L482">            return rect;</span>
        }

<span class="nc bnc" id="L485" title="All 2 branches missed.">        if (horizontal) {</span>
<span class="nc" id="L486">            rect.x = 0;</span>
<span class="nc" id="L487">            rect.width = table.getWidth();</span>
        } else {
<span class="nc" id="L489">            rect.y = 0;</span>

<span class="nc bnc" id="L491" title="All 2 branches missed.">            if (table.getRowCount() != 0) {</span>
<span class="nc" id="L492">                Rectangle lastRect = table.getCellRect(table.getRowCount() - 1, 0, true);</span>
<span class="nc" id="L493">                rect.height = lastRect.y + lastRect.height;</span>
<span class="nc" id="L494">            } else {</span>
<span class="nc" id="L495">                rect.height = table.getHeight();</span>
            }
        }

<span class="nc" id="L499">        return rect;</span>
    }

    /*
     * Paints the grid lines within &lt;I&gt;aRect&lt;/I&gt;, using the grid
     * color set with &lt;I&gt;setGridColor&lt;/I&gt;. Paints vertical lines
     * if &lt;code&gt;getShowVerticalLines()&lt;/code&gt; returns true and paints
     * horizontal lines if &lt;code&gt;getShowHorizontalLines()&lt;/code&gt;
     * returns true.
     */
    private void paintGrid(SynthContext context, Graphics g, int rMin,
                           int rMax, int cMin, int cMax) {
<span class="nc" id="L511">        g.setColor(table.getGridColor());</span>

<span class="nc" id="L513">        Rectangle minCell = table.getCellRect(rMin, cMin, true);</span>
<span class="nc" id="L514">        Rectangle maxCell = table.getCellRect(rMax, cMax, true);</span>
<span class="nc" id="L515">        Rectangle damagedArea = minCell.union( maxCell );</span>
<span class="nc" id="L516">        SynthGraphicsUtils synthG = context.getStyle().getGraphicsUtils(</span>
                     context);

<span class="nc bnc" id="L519" title="All 2 branches missed.">        if (table.getShowHorizontalLines()) {</span>
<span class="nc" id="L520">            int tableWidth = damagedArea.x + damagedArea.width;</span>
<span class="nc" id="L521">            int y = damagedArea.y;</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">            for (int row = rMin; row &lt;= rMax; row++) {</span>
<span class="nc" id="L523">                y += table.getRowHeight(row);</span>
<span class="nc" id="L524">                synthG.drawLine(context, &quot;Table.grid&quot;,</span>
                                g, damagedArea.x, y - 1, tableWidth - 1,y - 1);
            }
        }
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (table.getShowVerticalLines()) {</span>
<span class="nc" id="L529">            TableColumnModel cm = table.getColumnModel();</span>
<span class="nc" id="L530">            int tableHeight = damagedArea.y + damagedArea.height;</span>
            int x;
<span class="nc bnc" id="L532" title="All 2 branches missed.">            if (table.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L533">                x = damagedArea.x;</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">                for (int column = cMin; column &lt;= cMax; column++) {</span>
<span class="nc" id="L535">                    int w = cm.getColumn(column).getWidth();</span>
<span class="nc" id="L536">                    x += w;</span>
<span class="nc" id="L537">                    synthG.drawLine(context, &quot;Table.grid&quot;, g, x - 1, 0,</span>
                                    x - 1, tableHeight - 1);
                }
            } else {
<span class="nc" id="L541">                x = damagedArea.x;</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">                for (int column = cMax; column &gt;= cMin; column--) {</span>
<span class="nc" id="L543">                    int w = cm.getColumn(column).getWidth();</span>
<span class="nc" id="L544">                    x += w;</span>
<span class="nc" id="L545">                    synthG.drawLine(context, &quot;Table.grid&quot;, g, x - 1, 0, x - 1,</span>
                                    tableHeight - 1);
                }
            }
        }
<span class="nc" id="L550">    }</span>

    private int viewIndexForColumn(TableColumn aColumn) {
<span class="nc" id="L553">        TableColumnModel cm = table.getColumnModel();</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        for (int column = 0; column &lt; cm.getColumnCount(); column++) {</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">            if (cm.getColumn(column) == aColumn) {</span>
<span class="nc" id="L556">                return column;</span>
            }
        }
<span class="nc" id="L559">        return -1;</span>
    }

    private void paintCells(SynthContext context, Graphics g, int rMin,
                            int rMax, int cMin, int cMax) {
<span class="nc" id="L564">        JTableHeader header = table.getTableHeader();</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">        TableColumn draggedColumn = (header == null) ? null : header.getDraggedColumn();</span>

<span class="nc" id="L567">        TableColumnModel cm = table.getColumnModel();</span>
<span class="nc" id="L568">        int columnMargin = cm.getColumnMargin();</span>

        Rectangle cellRect;
        TableColumn aColumn;
        int columnWidth;
<span class="nc bnc" id="L573" title="All 2 branches missed.">        if (table.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">            for(int row = rMin; row &lt;= rMax; row++) {</span>
<span class="nc" id="L575">                cellRect = table.getCellRect(row, cMin, false);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">                for(int column = cMin; column &lt;= cMax; column++) {</span>
<span class="nc" id="L577">                    aColumn = cm.getColumn(column);</span>
<span class="nc" id="L578">                    columnWidth = aColumn.getWidth();</span>
<span class="nc" id="L579">                    cellRect.width = columnWidth - columnMargin;</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                    if (aColumn != draggedColumn) {</span>
<span class="nc" id="L581">                        paintCell(context, g, cellRect, row, column);</span>
                    }
<span class="nc" id="L583">                    cellRect.x += columnWidth;</span>
                }
            }
        } else {
<span class="nc bnc" id="L587" title="All 2 branches missed.">            for(int row = rMin; row &lt;= rMax; row++) {</span>
<span class="nc" id="L588">                cellRect = table.getCellRect(row, cMin, false);</span>
<span class="nc" id="L589">                aColumn = cm.getColumn(cMin);</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                if (aColumn != draggedColumn) {</span>
<span class="nc" id="L591">                    columnWidth = aColumn.getWidth();</span>
<span class="nc" id="L592">                    cellRect.width = columnWidth - columnMargin;</span>
<span class="nc" id="L593">                    paintCell(context, g, cellRect, row, cMin);</span>
                }
<span class="nc bnc" id="L595" title="All 2 branches missed.">                for(int column = cMin+1; column &lt;= cMax; column++) {</span>
<span class="nc" id="L596">                    aColumn = cm.getColumn(column);</span>
<span class="nc" id="L597">                    columnWidth = aColumn.getWidth();</span>
<span class="nc" id="L598">                    cellRect.width = columnWidth - columnMargin;</span>
<span class="nc" id="L599">                    cellRect.x -= columnWidth;</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">                    if (aColumn != draggedColumn) {</span>
<span class="nc" id="L601">                        paintCell(context, g, cellRect, row, column);</span>
                    }
                }
            }
        }

        // Paint the dragged column if we are dragging.
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (draggedColumn != null) {</span>
<span class="nc" id="L609">            paintDraggedArea(context, g, rMin, rMax, draggedColumn, header.getDraggedDistance());</span>
        }

        // Remove any renderers that may be left in the rendererPane.
<span class="nc" id="L613">        rendererPane.removeAll();</span>
<span class="nc" id="L614">    }</span>

    private void paintDraggedArea(SynthContext context, Graphics g, int rMin, int rMax, TableColumn draggedColumn, int distance) {
<span class="nc" id="L617">        int draggedColumnIndex = viewIndexForColumn(draggedColumn);</span>

<span class="nc" id="L619">        Rectangle minCell = table.getCellRect(rMin, draggedColumnIndex, true);</span>
<span class="nc" id="L620">        Rectangle maxCell = table.getCellRect(rMax, draggedColumnIndex, true);</span>

<span class="nc" id="L622">        Rectangle vacatedColumnRect = minCell.union(maxCell);</span>

        // Paint a gray well in place of the moving column.
<span class="nc" id="L625">        g.setColor(table.getParent().getBackground());</span>
<span class="nc" id="L626">        g.fillRect(vacatedColumnRect.x, vacatedColumnRect.y,</span>
                   vacatedColumnRect.width, vacatedColumnRect.height);

        // Move to the where the cell has been dragged.
<span class="nc" id="L630">        vacatedColumnRect.x += distance;</span>

        // Fill the background.
<span class="nc" id="L633">        g.setColor(context.getStyle().getColor(context, ColorType.BACKGROUND));</span>
<span class="nc" id="L634">        g.fillRect(vacatedColumnRect.x, vacatedColumnRect.y,</span>
                   vacatedColumnRect.width, vacatedColumnRect.height);

<span class="nc" id="L637">        SynthGraphicsUtils synthG = context.getStyle().getGraphicsUtils(</span>
                                            context);


        // Paint the vertical grid lines if necessary.
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if (table.getShowVerticalLines()) {</span>
<span class="nc" id="L643">            g.setColor(table.getGridColor());</span>
<span class="nc" id="L644">            int x1 = vacatedColumnRect.x;</span>
<span class="nc" id="L645">            int y1 = vacatedColumnRect.y;</span>
<span class="nc" id="L646">            int x2 = x1 + vacatedColumnRect.width - 1;</span>
<span class="nc" id="L647">            int y2 = y1 + vacatedColumnRect.height - 1;</span>
            // Left
<span class="nc" id="L649">            synthG.drawLine(context, &quot;Table.grid&quot;, g, x1-1, y1, x1-1, y2);</span>
            // Right
<span class="nc" id="L651">            synthG.drawLine(context, &quot;Table.grid&quot;, g, x2, y1, x2, y2);</span>
        }

<span class="nc bnc" id="L654" title="All 2 branches missed.">        for(int row = rMin; row &lt;= rMax; row++) {</span>
            // Render the cell value
<span class="nc" id="L656">            Rectangle r = table.getCellRect(row, draggedColumnIndex, false);</span>
<span class="nc" id="L657">            r.x += distance;</span>
<span class="nc" id="L658">            paintCell(context, g, r, row, draggedColumnIndex);</span>

            // Paint the (lower) horizontal grid line if necessary.
<span class="nc bnc" id="L661" title="All 2 branches missed.">            if (table.getShowHorizontalLines()) {</span>
<span class="nc" id="L662">                g.setColor(table.getGridColor());</span>
<span class="nc" id="L663">                Rectangle rcr = table.getCellRect(row, draggedColumnIndex, true);</span>
<span class="nc" id="L664">                rcr.x += distance;</span>
<span class="nc" id="L665">                int x1 = rcr.x;</span>
<span class="nc" id="L666">                int y1 = rcr.y;</span>
<span class="nc" id="L667">                int x2 = x1 + rcr.width - 1;</span>
<span class="nc" id="L668">                int y2 = y1 + rcr.height - 1;</span>
<span class="nc" id="L669">                synthG.drawLine(context, &quot;Table.grid&quot;, g, x1, y2, x2, y2);</span>
            }
        }
<span class="nc" id="L672">    }</span>

    private void paintCell(SynthContext context, Graphics g,
            Rectangle cellRect, int row, int column) {
<span class="nc bnc" id="L676" title="All 4 branches missed.">        if (table.isEditing() &amp;&amp; table.getEditingRow()==row &amp;&amp;</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">                                 table.getEditingColumn()==column) {</span>
<span class="nc" id="L678">            Component component = table.getEditorComponent();</span>
<span class="nc" id="L679">            component.setBounds(cellRect);</span>
<span class="nc" id="L680">            component.validate();</span>
<span class="nc" id="L681">        }</span>
        else {
<span class="nc" id="L683">            TableCellRenderer renderer = table.getCellRenderer(row, column);</span>
<span class="nc" id="L684">            Component component = table.prepareRenderer(renderer, row, column);</span>
<span class="nc" id="L685">            Color b = component.getBackground();</span>
<span class="nc bnc" id="L686" title="All 6 branches missed.">            if ((b == null || b instanceof UIResource</span>
                    || component instanceof SynthBooleanTableCellRenderer)
<span class="nc bnc" id="L688" title="All 2 branches missed.">                    &amp;&amp; !table.isCellSelected(row, column)) {</span>
<span class="nc bnc" id="L689" title="All 4 branches missed.">                if (alternateColor != null &amp;&amp; row % 2 != 0) {</span>
<span class="nc" id="L690">                    component.setBackground(alternateColor);</span>
                }
            }
<span class="nc" id="L693">            rendererPane.paintComponent(g, component, table, cellRect.x,</span>
                    cellRect.y, cellRect.width, cellRect.height, true);
        }
<span class="nc" id="L696">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void propertyChange(PropertyChangeEvent event) {
<span class="nc bnc" id="L703" title="All 2 branches missed.">        if (SynthLookAndFeel.shouldUpdateStyle(event)) {</span>
<span class="nc" id="L704">            updateStyle((JTable)event.getSource());</span>
        }
<span class="nc" id="L706">    }</span>


    private class SynthBooleanTableCellRenderer extends JCheckBox implements
                      TableCellRenderer {
        private boolean isRowSelected;

<span class="nc" id="L713">        public SynthBooleanTableCellRenderer() {</span>
<span class="nc" id="L714">            setHorizontalAlignment(JLabel.CENTER);</span>
<span class="nc" id="L715">            setName(&quot;Table.cellRenderer&quot;);</span>
<span class="nc" id="L716">        }</span>

        public Component getTableCellRendererComponent(
                            JTable table, Object value, boolean isSelected,
                            boolean hasFocus, int row, int column) {
<span class="nc" id="L721">            isRowSelected = isSelected;</span>

<span class="nc bnc" id="L723" title="All 2 branches missed.">            if (isSelected) {</span>
<span class="nc" id="L724">                setForeground(unwrap(table.getSelectionForeground()));</span>
<span class="nc" id="L725">                setBackground(unwrap(table.getSelectionBackground()));</span>
            } else {
<span class="nc" id="L727">                setForeground(unwrap(table.getForeground()));</span>
<span class="nc" id="L728">                setBackground(unwrap(table.getBackground()));</span>
            }

<span class="nc bnc" id="L731" title="All 4 branches missed.">            setSelected((value != null &amp;&amp; ((Boolean)value).booleanValue()));</span>
<span class="nc" id="L732">            return this;</span>
        }

        private Color unwrap(Color c) {
<span class="nc bnc" id="L736" title="All 2 branches missed.">            if (c instanceof UIResource) {</span>
<span class="nc" id="L737">                return new Color(c.getRGB());</span>
            }
<span class="nc" id="L739">            return c;</span>
        }

        public boolean isOpaque() {
<span class="nc bnc" id="L743" title="All 2 branches missed.">            return isRowSelected ? true : super.isOpaque();</span>
        }
    }

<span class="nc" id="L747">    private class SynthTableCellRenderer extends DefaultTableCellRenderer {</span>
        private Object numberFormat;
        private Object dateFormat;
        private boolean opaque;

        public void setOpaque(boolean isOpaque) {
<span class="nc" id="L753">            opaque = isOpaque;</span>
<span class="nc" id="L754">        }</span>

        public boolean isOpaque() {
<span class="nc" id="L757">            return opaque;</span>
        }

        public String getName() {
<span class="nc" id="L761">            String name = super.getName();</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">            if (name == null) {</span>
<span class="nc" id="L763">                return &quot;Table.cellRenderer&quot;;</span>
            }
<span class="nc" id="L765">            return name;</span>
        }

        public void setBorder(Border b) {
<span class="nc bnc" id="L769" title="All 4 branches missed.">            if (useUIBorder || b instanceof SynthBorder) {</span>
<span class="nc" id="L770">                super.setBorder(b);</span>
            }
<span class="nc" id="L772">        }</span>

        public Component getTableCellRendererComponent(
                  JTable table, Object value, boolean isSelected,
                  boolean hasFocus, int row, int column) {
<span class="nc bnc" id="L777" title="All 6 branches missed.">            if (!useTableColors &amp;&amp; (isSelected || hasFocus)) {</span>
<span class="nc" id="L778">                SynthLookAndFeel.setSelectedUI((SynthLabelUI)SynthLookAndFeel.</span>
<span class="nc" id="L779">                             getUIOfType(getUI(), SynthLabelUI.class),</span>
<span class="nc" id="L780">                                   isSelected, hasFocus, table.isEnabled(), false);</span>
            }
            else {
<span class="nc" id="L783">                SynthLookAndFeel.resetSelectedUI();</span>
            }
<span class="nc" id="L785">            super.getTableCellRendererComponent(table, value, isSelected,</span>
                                                hasFocus, row, column);

<span class="nc" id="L788">            setIcon(null);</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">            if (table != null) {</span>
<span class="nc" id="L790">                configureValue(value, table.getColumnClass(column));</span>
            }
<span class="nc" id="L792">            return this;</span>
        }

        private void configureValue(Object value, Class columnClass) {
<span class="nc bnc" id="L796" title="All 4 branches missed.">            if (columnClass == Object.class || columnClass == null) {</span>
<span class="nc" id="L797">                setHorizontalAlignment(JLabel.LEADING);</span>
<span class="nc bnc" id="L798" title="All 4 branches missed.">            } else if (columnClass == Float.class || columnClass == Double.class) {</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">                if (numberFormat == null) {</span>
<span class="nc" id="L800">                    numberFormat = NumberFormat.getInstance();</span>
                }
<span class="nc" id="L802">                setHorizontalAlignment(JLabel.TRAILING);</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">                setText((value == null) ? &quot;&quot; : ((NumberFormat)numberFormat).format(value));</span>
            }
<span class="nc bnc" id="L805" title="All 2 branches missed.">            else if (columnClass == Number.class) {</span>
<span class="nc" id="L806">                setHorizontalAlignment(JLabel.TRAILING);</span>
                // Super will have set value.
            }
<span class="nc bnc" id="L809" title="All 4 branches missed.">            else if (columnClass == Icon.class || columnClass == ImageIcon.class) {</span>
<span class="nc" id="L810">                setHorizontalAlignment(JLabel.CENTER);</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">                setIcon((value instanceof Icon) ? (Icon)value : null);</span>
<span class="nc" id="L812">                setText(&quot;&quot;);</span>
            }
<span class="nc bnc" id="L814" title="All 2 branches missed.">            else if (columnClass == Date.class) {</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">                if (dateFormat == null) {</span>
<span class="nc" id="L816">                    dateFormat = DateFormat.getDateInstance();</span>
                }
<span class="nc" id="L818">                setHorizontalAlignment(JLabel.LEADING);</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">                setText((value == null) ? &quot;&quot; : ((Format)dateFormat).format(value));</span>
            }
            else {
<span class="nc" id="L822">                configureValue(value, columnClass.getSuperclass());</span>
            }
<span class="nc" id="L824">        }</span>

        public void paint(Graphics g) {
<span class="nc" id="L827">            super.paint(g);</span>
<span class="nc" id="L828">            SynthLookAndFeel.resetSelectedUI();</span>
<span class="nc" id="L829">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>