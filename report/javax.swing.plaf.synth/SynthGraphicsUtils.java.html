<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SynthGraphicsUtils.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.synth</a> &gt; <span class="el_source">SynthGraphicsUtils.java</span></div><h1>SynthGraphicsUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.plaf.synth;

import sun.swing.SwingUtilities2;
import sun.swing.MenuItemLayoutHelper;

import java.awt.*;
import javax.swing.*;
import javax.swing.plaf.basic.BasicHTML;
import javax.swing.text.*;
import sun.swing.plaf.synth.*;

/**
 * Wrapper for primitive graphics calls.
 *
 * @since 1.5
 * @author Scott Violet
 */
public class SynthGraphicsUtils {
    // These are used in the text painting code to avoid allocating a bunch of
    // garbage.
<span class="nc" id="L45">    private Rectangle paintIconR = new Rectangle();</span>
<span class="nc" id="L46">    private Rectangle paintTextR = new Rectangle();</span>
<span class="nc" id="L47">    private Rectangle paintViewR = new Rectangle();</span>
<span class="nc" id="L48">    private Insets paintInsets = new Insets(0, 0, 0, 0);</span>

    // These Rectangles/Insets are used in the text size calculation to avoid a
    // a bunch of garbage.
<span class="nc" id="L52">    private Rectangle iconR = new Rectangle();</span>
<span class="nc" id="L53">    private Rectangle textR = new Rectangle();</span>
<span class="nc" id="L54">    private Rectangle viewR = new Rectangle();</span>
<span class="nc" id="L55">    private Insets viewSizingInsets = new Insets(0, 0, 0, 0);</span>

    /**
     * Creates a &lt;code&gt;SynthGraphicsUtils&lt;/code&gt;.
     */
<span class="nc" id="L60">    public SynthGraphicsUtils() {</span>
<span class="nc" id="L61">    }</span>

    /**
     * Draws a line between the two end points.
     *
     * @param context Identifies hosting region.
     * @param paintKey Identifies the portion of the component being asked
     *                 to paint, may be null.
     * @param g Graphics object to paint to
     * @param x1 x origin
     * @param y1 y origin
     * @param x2 x destination
     * @param y2 y destination
     */
    public void drawLine(SynthContext context, Object paintKey,
                         Graphics g, int x1, int y1, int x2, int y2) {
<span class="nc" id="L77">        g.drawLine(x1, y1, x2, y2);</span>
<span class="nc" id="L78">    }</span>

    /**
     * Draws a line between the two end points.
     * &lt;p&gt;This implementation supports only one line style key,
     * &lt;code&gt;&quot;dashed&quot;&lt;/code&gt;. The &lt;code&gt;&quot;dashed&quot;&lt;/code&gt; line style is applied
     * only to vertical and horizontal lines.
     * &lt;p&gt;Specifying &lt;code&gt;null&lt;/code&gt; or any key different from
     * &lt;code&gt;&quot;dashed&quot;&lt;/code&gt; will draw solid lines.
     *
     * @param context identifies hosting region
     * @param paintKey identifies the portion of the component being asked
     *                 to paint, may be null
     * @param g Graphics object to paint to
     * @param x1 x origin
     * @param y1 y origin
     * @param x2 x destination
     * @param y2 y destination
     * @param styleKey identifies the requested style of the line (e.g. &quot;dashed&quot;)
     * @since 1.6
     */
    public void drawLine(SynthContext context, Object paintKey,
                         Graphics g, int x1, int y1, int x2, int y2,
                         Object styleKey) {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (&quot;dashed&quot;.equals(styleKey)) {</span>
            // draw vertical line
<span class="nc bnc" id="L104" title="All 2 branches missed.">            if (x1 == x2) {</span>
<span class="nc" id="L105">                y1 += (y1 % 2);</span>

<span class="nc bnc" id="L107" title="All 2 branches missed.">                for (int y = y1; y &lt;= y2; y+=2) {</span>
<span class="nc" id="L108">                    g.drawLine(x1, y, x2, y);</span>
                }
            // draw horizontal line
<span class="nc bnc" id="L111" title="All 2 branches missed.">            } else if (y1 == y2) {</span>
<span class="nc" id="L112">                x1 += (x1 % 2);</span>

<span class="nc bnc" id="L114" title="All 2 branches missed.">                for (int x = x1; x &lt;= x2; x+=2) {</span>
<span class="nc" id="L115">                    g.drawLine(x, y1, x, y2);</span>
                }
            // oblique lines are not supported
            }
        } else {
<span class="nc" id="L120">            drawLine(context, paintKey, g, x1, y1, x2, y2);</span>
        }
<span class="nc" id="L122">    }</span>

    /**
     * Lays out text and an icon returning, by reference, the location to
     * place the icon and text.
     *
     * @param ss SynthContext
     * @param fm FontMetrics for the Font to use, this may be ignored
     * @param text Text to layout
     * @param icon Icon to layout
     * @param hAlign horizontal alignment
     * @param vAlign vertical alignment
     * @param hTextPosition horizontal text position
     * @param vTextPosition vertical text position
     * @param viewR Rectangle to layout text and icon in.
     * @param iconR Rectangle to place icon bounds in
     * @param textR Rectangle to place text in
     * @param iconTextGap gap between icon and text
     */
    public String layoutText(SynthContext ss, FontMetrics fm,
                         String text, Icon icon, int hAlign,
                         int vAlign, int hTextPosition,
                         int vTextPosition, Rectangle viewR,
                         Rectangle iconR, Rectangle textR, int iconTextGap) {
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (icon instanceof SynthIcon) {</span>
<span class="nc" id="L147">            SynthIconWrapper wrapper = SynthIconWrapper.get((SynthIcon)icon,</span>
                                                            ss);
<span class="nc" id="L149">            String formattedText = SwingUtilities.layoutCompoundLabel(</span>
<span class="nc" id="L150">                      ss.getComponent(), fm, text, wrapper, vAlign, hAlign,</span>
                      vTextPosition, hTextPosition, viewR, iconR, textR,
                      iconTextGap);
<span class="nc" id="L153">            SynthIconWrapper.release(wrapper);</span>
<span class="nc" id="L154">            return formattedText;</span>
        }
<span class="nc" id="L156">        return SwingUtilities.layoutCompoundLabel(</span>
<span class="nc" id="L157">                      ss.getComponent(), fm, text, icon, vAlign, hAlign,</span>
                      vTextPosition, hTextPosition, viewR, iconR, textR,
                      iconTextGap);
    }

    /**
     * Returns the size of the passed in string.
     *
     * @param ss SynthContext
     * @param font Font to use
     * @param metrics FontMetrics, may be ignored
     * @param text Text to get size of.
     */
    public int computeStringWidth(SynthContext ss, Font font,
                                  FontMetrics metrics, String text) {
<span class="nc" id="L172">        return SwingUtilities2.stringWidth(ss.getComponent(), metrics,</span>
                                          text);
    }

    /**
     * Returns the minimum size needed to properly render an icon and text.
     *
     * @param ss SynthContext
     * @param font Font to use
     * @param text Text to layout
     * @param icon Icon to layout
     * @param hAlign horizontal alignment
     * @param vAlign vertical alignment
     * @param hTextPosition horizontal text position
     * @param vTextPosition vertical text position
     * @param iconTextGap gap between icon and text
     * @param mnemonicIndex Index into text to render the mnemonic at, -1
     *        indicates no mnemonic.
     */
    public Dimension getMinimumSize(SynthContext ss, Font font, String text,
                      Icon icon, int hAlign, int vAlign, int hTextPosition,
                      int vTextPosition, int iconTextGap, int mnemonicIndex) {
<span class="nc" id="L194">        JComponent c = ss.getComponent();</span>
<span class="nc" id="L195">        Dimension size = getPreferredSize(ss, font, text, icon, hAlign,</span>
                                          vAlign, hTextPosition, vTextPosition,
                                          iconTextGap, mnemonicIndex);
<span class="nc" id="L198">        View v = (View) c.getClientProperty(BasicHTML.propertyKey);</span>

<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (v != null) {</span>
<span class="nc" id="L201">            size.width -= v.getPreferredSpan(View.X_AXIS) -</span>
<span class="nc" id="L202">                          v.getMinimumSpan(View.X_AXIS);</span>
        }
<span class="nc" id="L204">        return size;</span>
    }

    /**
     * Returns the maximum size needed to properly render an icon and text.
     *
     * @param ss SynthContext
     * @param font Font to use
     * @param text Text to layout
     * @param icon Icon to layout
     * @param hAlign horizontal alignment
     * @param vAlign vertical alignment
     * @param hTextPosition horizontal text position
     * @param vTextPosition vertical text position
     * @param iconTextGap gap between icon and text
     * @param mnemonicIndex Index into text to render the mnemonic at, -1
     *        indicates no mnemonic.
     */
    public Dimension getMaximumSize(SynthContext ss, Font font, String text,
                      Icon icon, int hAlign, int vAlign, int hTextPosition,
                      int vTextPosition, int iconTextGap, int mnemonicIndex) {
<span class="nc" id="L225">        JComponent c = ss.getComponent();</span>
<span class="nc" id="L226">        Dimension size = getPreferredSize(ss, font, text, icon, hAlign,</span>
                                          vAlign, hTextPosition, vTextPosition,
                                          iconTextGap, mnemonicIndex);
<span class="nc" id="L229">        View v = (View) c.getClientProperty(BasicHTML.propertyKey);</span>

<span class="nc bnc" id="L231" title="All 2 branches missed.">        if (v != null) {</span>
<span class="nc" id="L232">            size.width += v.getMaximumSpan(View.X_AXIS) -</span>
<span class="nc" id="L233">                          v.getPreferredSpan(View.X_AXIS);</span>
        }
<span class="nc" id="L235">        return size;</span>
    }

    /**
     * Returns the maximum height of the the Font from the passed in
     * SynthContext.
     *
     * @param context SynthContext used to determine font.
     * @return maximum height of the characters for the font from the passed
     *         in context.
     */
    public int getMaximumCharHeight(SynthContext context) {
<span class="nc" id="L247">        FontMetrics fm = context.getComponent().getFontMetrics(</span>
<span class="nc" id="L248">            context.getStyle().getFont(context));</span>
<span class="nc" id="L249">        return (fm.getAscent() + fm.getDescent());</span>
    }

    /**
     * Returns the preferred size needed to properly render an icon and text.
     *
     * @param ss SynthContext
     * @param font Font to use
     * @param text Text to layout
     * @param icon Icon to layout
     * @param hAlign horizontal alignment
     * @param vAlign vertical alignment
     * @param hTextPosition horizontal text position
     * @param vTextPosition vertical text position
     * @param iconTextGap gap between icon and text
     * @param mnemonicIndex Index into text to render the mnemonic at, -1
     *        indicates no mnemonic.
     */
    public Dimension getPreferredSize(SynthContext ss, Font font, String text,
                      Icon icon, int hAlign, int vAlign, int hTextPosition,
                      int vTextPosition, int iconTextGap, int mnemonicIndex) {
<span class="nc" id="L270">        JComponent c = ss.getComponent();</span>
<span class="nc" id="L271">        Insets insets = c.getInsets(viewSizingInsets);</span>
<span class="nc" id="L272">        int dx = insets.left + insets.right;</span>
<span class="nc" id="L273">        int dy = insets.top + insets.bottom;</span>

<span class="nc bnc" id="L275" title="All 6 branches missed.">        if (icon == null &amp;&amp; (text == null || font == null)) {</span>
<span class="nc" id="L276">            return new Dimension(dx, dy);</span>
        }
<span class="nc bnc" id="L278" title="All 6 branches missed.">        else if ((text == null) || ((icon != null) &amp;&amp; (font == null))) {</span>
<span class="nc" id="L279">            return new Dimension(SynthIcon.getIconWidth(icon, ss) + dx,</span>
<span class="nc" id="L280">                                 SynthIcon.getIconHeight(icon, ss) + dy);</span>
        }
        else {
<span class="nc" id="L283">            FontMetrics fm = c.getFontMetrics(font);</span>

<span class="nc" id="L285">            iconR.x = iconR.y = iconR.width = iconR.height = 0;</span>
<span class="nc" id="L286">            textR.x = textR.y = textR.width = textR.height = 0;</span>
<span class="nc" id="L287">            viewR.x = dx;</span>
<span class="nc" id="L288">            viewR.y = dy;</span>
<span class="nc" id="L289">            viewR.width = viewR.height = Short.MAX_VALUE;</span>

<span class="nc" id="L291">            layoutText(ss, fm, text, icon, hAlign, vAlign,</span>
                   hTextPosition, vTextPosition, viewR, iconR, textR,
                   iconTextGap);
<span class="nc" id="L294">            int x1 = Math.min(iconR.x, textR.x);</span>
<span class="nc" id="L295">            int x2 = Math.max(iconR.x + iconR.width, textR.x + textR.width);</span>
<span class="nc" id="L296">            int y1 = Math.min(iconR.y, textR.y);</span>
<span class="nc" id="L297">            int y2 = Math.max(iconR.y + iconR.height, textR.y + textR.height);</span>
<span class="nc" id="L298">            Dimension rv = new Dimension(x2 - x1, y2 - y1);</span>

<span class="nc" id="L300">            rv.width += dx;</span>
<span class="nc" id="L301">            rv.height += dy;</span>
<span class="nc" id="L302">            return rv;</span>
        }
    }

    /**
     * Paints text at the specified location. This will not attempt to
     * render the text as html nor will it offset by the insets of the
     * component.
     *
     * @param ss SynthContext
     * @param g Graphics used to render string in.
     * @param text Text to render
     * @param bounds Bounds of the text to be drawn.
     * @param mnemonicIndex Index to draw string at.
     */
    public void paintText(SynthContext ss, Graphics g, String text,
                          Rectangle bounds, int mnemonicIndex) {
<span class="nc" id="L319">        paintText(ss, g, text, bounds.x, bounds.y, mnemonicIndex);</span>
<span class="nc" id="L320">    }</span>

    /**
     * Paints text at the specified location. This will not attempt to
     * render the text as html nor will it offset by the insets of the
     * component.
     *
     * @param ss SynthContext
     * @param g Graphics used to render string in.
     * @param text Text to render
     * @param x X location to draw text at.
     * @param y Upper left corner to draw text at.
     * @param mnemonicIndex Index to draw string at.
     */
    public void paintText(SynthContext ss, Graphics g, String text,
                          int x, int y, int mnemonicIndex) {
<span class="nc bnc" id="L336" title="All 2 branches missed.">        if (text != null) {</span>
<span class="nc" id="L337">            JComponent c = ss.getComponent();</span>
<span class="nc" id="L338">            FontMetrics fm = SwingUtilities2.getFontMetrics(c, g);</span>
<span class="nc" id="L339">            y += fm.getAscent();</span>
<span class="nc" id="L340">            SwingUtilities2.drawStringUnderlineCharAt(c, g, text,</span>
                                                      mnemonicIndex, x, y);
        }
<span class="nc" id="L343">    }</span>

    /**
     * Paints an icon and text. This will render the text as html, if
     * necessary, and offset the location by the insets of the component.
     *
     * @param ss SynthContext
     * @param g Graphics to render string and icon into
     * @param text Text to layout
     * @param icon Icon to layout
     * @param hAlign horizontal alignment
     * @param vAlign vertical alignment
     * @param hTextPosition horizontal text position
     * @param vTextPosition vertical text position
     * @param iconTextGap gap between icon and text
     * @param mnemonicIndex Index into text to render the mnemonic at, -1
     *        indicates no mnemonic.
     * @param textOffset Amount to offset the text when painting
     */
    public void paintText(SynthContext ss, Graphics g, String text,
                      Icon icon, int hAlign, int vAlign, int hTextPosition,
                      int vTextPosition, int iconTextGap, int mnemonicIndex,
                      int textOffset) {
<span class="nc bnc" id="L366" title="All 4 branches missed.">        if ((icon == null) &amp;&amp; (text == null)) {</span>
<span class="nc" id="L367">            return;</span>
        }
<span class="nc" id="L369">        JComponent c = ss.getComponent();</span>
<span class="nc" id="L370">        FontMetrics fm = SwingUtilities2.getFontMetrics(c, g);</span>
<span class="nc" id="L371">        Insets insets = SynthLookAndFeel.getPaintingInsets(ss, paintInsets);</span>

<span class="nc" id="L373">        paintViewR.x = insets.left;</span>
<span class="nc" id="L374">        paintViewR.y = insets.top;</span>
<span class="nc" id="L375">        paintViewR.width = c.getWidth() - (insets.left + insets.right);</span>
<span class="nc" id="L376">        paintViewR.height = c.getHeight() - (insets.top + insets.bottom);</span>

<span class="nc" id="L378">        paintIconR.x = paintIconR.y = paintIconR.width = paintIconR.height = 0;</span>
<span class="nc" id="L379">        paintTextR.x = paintTextR.y = paintTextR.width = paintTextR.height = 0;</span>

<span class="nc" id="L381">        String clippedText =</span>
<span class="nc" id="L382">            layoutText(ss, fm, text, icon, hAlign, vAlign,</span>
                   hTextPosition, vTextPosition, paintViewR, paintIconR,
                   paintTextR, iconTextGap);

<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (icon != null) {</span>
<span class="nc" id="L387">            Color color = g.getColor();</span>

<span class="nc bnc" id="L389" title="All 2 branches missed.">            if (ss.getStyle().getBoolean(ss, &quot;TableHeader.alignSorterArrow&quot;, false) &amp;&amp;</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">                &quot;TableHeader.renderer&quot;.equals(c.getName())) {</span>
<span class="nc" id="L391">                paintIconR.x = paintViewR.width - paintIconR.width;</span>
            } else {
<span class="nc" id="L393">                paintIconR.x += textOffset;</span>
            }
<span class="nc" id="L395">            paintIconR.y += textOffset;</span>
<span class="nc" id="L396">            SynthIcon.paintIcon(icon, ss, g, paintIconR.x, paintIconR.y,</span>
                                paintIconR.width, paintIconR.height);
<span class="nc" id="L398">            g.setColor(color);</span>
        }

<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (text != null) {</span>
<span class="nc" id="L402">            View v = (View) c.getClientProperty(BasicHTML.propertyKey);</span>

<span class="nc bnc" id="L404" title="All 2 branches missed.">            if (v != null) {</span>
<span class="nc" id="L405">                v.paint(g, paintTextR);</span>
            } else {
<span class="nc" id="L407">                paintTextR.x += textOffset;</span>
<span class="nc" id="L408">                paintTextR.y += textOffset;</span>

<span class="nc" id="L410">                paintText(ss, g, clippedText, paintTextR, mnemonicIndex);</span>
            }
        }
<span class="nc" id="L413">    }</span>


     /**
      * A quick note about how preferred sizes are calculated... Generally
      * speaking, SynthPopupMenuUI will run through the list of its children
      * (from top to bottom) and ask each for its preferred size.  Each menu
      * item will add up the max width of each element (icons, text,
      * accelerator spacing, accelerator text or arrow icon) encountered thus
      * far, so by the time all menu items have been calculated, we will
      * know the maximum (preferred) menu item size for that popup menu.
      * Later when it comes time to paint each menu item, we can use those
      * same accumulated max element sizes in order to layout the item.
      */
    static Dimension getPreferredMenuItemSize(SynthContext context,
           SynthContext accContext, JComponent c,
           Icon checkIcon, Icon arrowIcon, int defaultTextIconGap,
           String acceleratorDelimiter, boolean useCheckAndArrow,
           String propertyPrefix) {

<span class="nc" id="L433">         JMenuItem mi = (JMenuItem) c;</span>
<span class="nc" id="L434">         SynthMenuItemLayoutHelper lh = new SynthMenuItemLayoutHelper(</span>
                 context, accContext, mi, checkIcon, arrowIcon,
<span class="nc" id="L436">                 MenuItemLayoutHelper.createMaxRect(), defaultTextIconGap,</span>
<span class="nc" id="L437">                 acceleratorDelimiter, SynthLookAndFeel.isLeftToRight(mi),</span>
                 useCheckAndArrow, propertyPrefix);

<span class="nc" id="L440">         Dimension result = new Dimension();</span>

         // Calculate the result width
<span class="nc" id="L443">         int gap = lh.getGap();</span>
<span class="nc" id="L444">         result.width = 0;</span>
<span class="nc" id="L445">         MenuItemLayoutHelper.addMaxWidth(lh.getCheckSize(), gap, result);</span>
<span class="nc" id="L446">         MenuItemLayoutHelper.addMaxWidth(lh.getLabelSize(), gap, result);</span>
<span class="nc" id="L447">         MenuItemLayoutHelper.addWidth(lh.getMaxAccOrArrowWidth(), 5 * gap, result);</span>
         // The last gap is unnecessary
<span class="nc" id="L449">         result.width -= gap;</span>

         // Calculate the result height
<span class="nc" id="L452">         result.height = MenuItemLayoutHelper.max(lh.getCheckSize().getHeight(),</span>
<span class="nc" id="L453">                 lh.getLabelSize().getHeight(), lh.getAccSize().getHeight(),</span>
<span class="nc" id="L454">                 lh.getArrowSize().getHeight());</span>

         // Take into account menu item insets
<span class="nc" id="L457">         Insets insets = lh.getMenuItem().getInsets();</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">         if (insets != null) {</span>
<span class="nc" id="L459">             result.width += insets.left + insets.right;</span>
<span class="nc" id="L460">             result.height += insets.top + insets.bottom;</span>
         }

         // if the width is even, bump it up one. This is critical
         // for the focus dash lhne to draw properly
<span class="nc bnc" id="L465" title="All 2 branches missed.">         if (result.width % 2 == 0) {</span>
<span class="nc" id="L466">             result.width++;</span>
         }

         // if the height is even, bump it up one. This is critical
         // for the text to center properly
<span class="nc bnc" id="L471" title="All 2 branches missed.">         if (result.height % 2 == 0) {</span>
<span class="nc" id="L472">             result.height++;</span>
         }

<span class="nc" id="L475">         return result;</span>
     }

    static void applyInsets(Rectangle rect, Insets insets, boolean leftToRight) {
<span class="nc bnc" id="L479" title="All 2 branches missed.">        if (insets != null) {</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            rect.x += (leftToRight ? insets.left : insets.right);</span>
<span class="nc" id="L481">            rect.y += insets.top;</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">            rect.width -= (leftToRight ? insets.right : insets.left) + rect.x;</span>
<span class="nc" id="L483">            rect.height -= (insets.bottom + rect.y);</span>
        }
<span class="nc" id="L485">    }</span>

    static void paint(SynthContext context, SynthContext accContext, Graphics g,
               Icon checkIcon, Icon arrowIcon, String acceleratorDelimiter,
               int defaultTextIconGap, String propertyPrefix) {
<span class="nc" id="L490">        JMenuItem mi = (JMenuItem) context.getComponent();</span>
<span class="nc" id="L491">        SynthStyle style = context.getStyle();</span>
<span class="nc" id="L492">        g.setFont(style.getFont(context));</span>

<span class="nc" id="L494">        Rectangle viewRect = new Rectangle(0, 0, mi.getWidth(), mi.getHeight());</span>
<span class="nc" id="L495">        boolean leftToRight = SynthLookAndFeel.isLeftToRight(mi);</span>
<span class="nc" id="L496">        applyInsets(viewRect, mi.getInsets(), leftToRight);</span>

<span class="nc" id="L498">        SynthMenuItemLayoutHelper lh = new SynthMenuItemLayoutHelper(</span>
                context, accContext, mi, checkIcon, arrowIcon, viewRect,
                defaultTextIconGap, acceleratorDelimiter, leftToRight,
<span class="nc" id="L501">                MenuItemLayoutHelper.useCheckAndArrow(mi), propertyPrefix);</span>
<span class="nc" id="L502">        MenuItemLayoutHelper.LayoutResult lr = lh.layoutMenuItem();</span>

<span class="nc" id="L504">        paintMenuItem(g, lh, lr);</span>
<span class="nc" id="L505">    }</span>

    static void paintMenuItem(Graphics g, SynthMenuItemLayoutHelper lh,
                              MenuItemLayoutHelper.LayoutResult lr) {
        // Save original graphics font and color
<span class="nc" id="L510">        Font holdf = g.getFont();</span>
<span class="nc" id="L511">        Color holdc = g.getColor();</span>

<span class="nc" id="L513">        paintCheckIcon(g, lh, lr);</span>
<span class="nc" id="L514">        paintIcon(g, lh, lr);</span>
<span class="nc" id="L515">        paintText(g, lh, lr);</span>
<span class="nc" id="L516">        paintAccText(g, lh, lr);</span>
<span class="nc" id="L517">        paintArrowIcon(g, lh, lr);</span>

        // Restore original graphics font and color
<span class="nc" id="L520">        g.setColor(holdc);</span>
<span class="nc" id="L521">        g.setFont(holdf);</span>
<span class="nc" id="L522">    }</span>

    static void paintBackground(Graphics g, SynthMenuItemLayoutHelper lh) {
<span class="nc" id="L525">        paintBackground(lh.getContext(), g, lh.getMenuItem());</span>
<span class="nc" id="L526">    }</span>

    static void paintBackground(SynthContext context, Graphics g, JComponent c) {
<span class="nc" id="L529">        context.getPainter().paintMenuItemBackground(context, g, 0, 0,</span>
<span class="nc" id="L530">                c.getWidth(), c.getHeight());</span>
<span class="nc" id="L531">    }</span>

    static void paintIcon(Graphics g, SynthMenuItemLayoutHelper lh,
                          MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc bnc" id="L535" title="All 2 branches missed.">        if (lh.getIcon() != null) {</span>
            Icon icon;
<span class="nc" id="L537">            JMenuItem mi = lh.getMenuItem();</span>
<span class="nc" id="L538">            ButtonModel model = mi.getModel();</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">            if (!model.isEnabled()) {</span>
<span class="nc" id="L540">                icon = mi.getDisabledIcon();</span>
<span class="nc bnc" id="L541" title="All 4 branches missed.">            } else if (model.isPressed() &amp;&amp; model.isArmed()) {</span>
<span class="nc" id="L542">                icon = mi.getPressedIcon();</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">                if (icon == null) {</span>
                    // Use default icon
<span class="nc" id="L545">                    icon = mi.getIcon();</span>
                }
            } else {
<span class="nc" id="L548">                icon = mi.getIcon();</span>
            }

<span class="nc bnc" id="L551" title="All 2 branches missed.">            if (icon != null) {</span>
<span class="nc" id="L552">                Rectangle iconRect = lr.getIconRect();</span>
<span class="nc" id="L553">                SynthIcon.paintIcon(icon, lh.getContext(), g, iconRect.x,</span>
                        iconRect.y, iconRect.width, iconRect.height);
            }
        }
<span class="nc" id="L557">    }</span>

    static void paintCheckIcon(Graphics g, SynthMenuItemLayoutHelper lh,
                               MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc bnc" id="L561" title="All 2 branches missed.">        if (lh.getCheckIcon() != null) {</span>
<span class="nc" id="L562">            Rectangle checkRect = lr.getCheckRect();</span>
<span class="nc" id="L563">            SynthIcon.paintIcon(lh.getCheckIcon(), lh.getContext(), g,</span>
                    checkRect.x, checkRect.y, checkRect.width, checkRect.height);
        }
<span class="nc" id="L566">    }</span>

    static void paintAccText(Graphics g, SynthMenuItemLayoutHelper lh,
                             MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc" id="L570">        String accText = lh.getAccText();</span>
<span class="nc bnc" id="L571" title="All 4 branches missed.">        if (accText != null &amp;&amp; !accText.equals(&quot;&quot;)) {</span>
<span class="nc" id="L572">            g.setColor(lh.getAccStyle().getColor(lh.getAccContext(),</span>
                    ColorType.TEXT_FOREGROUND));
<span class="nc" id="L574">            g.setFont(lh.getAccStyle().getFont(lh.getAccContext()));</span>
<span class="nc" id="L575">            lh.getAccGraphicsUtils().paintText(lh.getAccContext(), g, accText,</span>
<span class="nc" id="L576">                    lr.getAccRect().x, lr.getAccRect().y, -1);</span>
        }
<span class="nc" id="L578">    }</span>

    static void paintText(Graphics g, SynthMenuItemLayoutHelper lh,
                          MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc bnc" id="L582" title="All 2 branches missed.">        if (!lh.getText().equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">            if (lh.getHtmlView() != null) {</span>
                // Text is HTML
<span class="nc" id="L585">                lh.getHtmlView().paint(g, lr.getTextRect());</span>
            } else {
                // Text isn't HTML
<span class="nc" id="L588">                g.setColor(lh.getStyle().getColor(</span>
<span class="nc" id="L589">                        lh.getContext(), ColorType.TEXT_FOREGROUND));</span>
<span class="nc" id="L590">                g.setFont(lh.getStyle().getFont(lh.getContext()));</span>
<span class="nc" id="L591">                lh.getGraphicsUtils().paintText(lh.getContext(), g, lh.getText(),</span>
<span class="nc" id="L592">                        lr.getTextRect().x, lr.getTextRect().y,</span>
<span class="nc" id="L593">                        lh.getMenuItem().getDisplayedMnemonicIndex());</span>
            }
        }
<span class="nc" id="L596">    }</span>

    static void paintArrowIcon(Graphics g, SynthMenuItemLayoutHelper lh,
                               MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc bnc" id="L600" title="All 2 branches missed.">        if (lh.getArrowIcon() != null) {</span>
<span class="nc" id="L601">            Rectangle arrowRect = lr.getArrowRect();</span>
<span class="nc" id="L602">            SynthIcon.paintIcon(lh.getArrowIcon(), lh.getContext(), g,</span>
                    arrowRect.x, arrowRect.y, arrowRect.width, arrowRect.height);
        }
<span class="nc" id="L605">    }</span>

    /**
     * Wraps a SynthIcon around the Icon interface, forwarding calls to
     * the SynthIcon with a given SynthContext.
     */
    private static class SynthIconWrapper implements Icon {
<span class="nc" id="L612">        private static final java.util.List&lt;SynthIconWrapper&gt; CACHE = new java.util.ArrayList&lt;SynthIconWrapper&gt;(1);</span>

        private SynthIcon synthIcon;
        private SynthContext context;

        static SynthIconWrapper get(SynthIcon icon, SynthContext context) {
<span class="nc" id="L618">            synchronized(CACHE) {</span>
<span class="nc" id="L619">                int size = CACHE.size();</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">                if (size &gt; 0) {</span>
<span class="nc" id="L621">                    SynthIconWrapper wrapper = CACHE.remove(size - 1);</span>
<span class="nc" id="L622">                    wrapper.reset(icon, context);</span>
<span class="nc" id="L623">                    return wrapper;</span>
                }
<span class="nc" id="L625">            }</span>
<span class="nc" id="L626">            return new SynthIconWrapper(icon, context);</span>
        }

        static void release(SynthIconWrapper wrapper) {
<span class="nc" id="L630">            wrapper.reset(null, null);</span>
<span class="nc" id="L631">            synchronized(CACHE) {</span>
<span class="nc" id="L632">                CACHE.add(wrapper);</span>
<span class="nc" id="L633">            }</span>
<span class="nc" id="L634">        }</span>

<span class="nc" id="L636">        SynthIconWrapper(SynthIcon icon, SynthContext context) {</span>
<span class="nc" id="L637">            reset(icon, context);</span>
<span class="nc" id="L638">        }</span>

        void reset(SynthIcon icon, SynthContext context) {
<span class="nc" id="L641">            synthIcon = icon;</span>
<span class="nc" id="L642">            this.context = context;</span>
<span class="nc" id="L643">        }</span>

        public void paintIcon(Component c, Graphics g, int x, int y) {
            // This is a noop as this should only be for sizing calls.
<span class="nc" id="L647">        }</span>

        public int getIconWidth() {
<span class="nc" id="L650">            return synthIcon.getIconWidth(context);</span>
        }

        public int getIconHeight() {
<span class="nc" id="L654">            return synthIcon.getIconHeight(context);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>