<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>SynthTreeUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.synth</a> &gt; <span class="el_source">SynthTreeUI.java</span></div><h1>SynthTreeUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.plaf.synth;

import java.awt.Color;
import java.awt.Component;
import java.awt.Graphics;
import java.awt.Insets;
import java.awt.Rectangle;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.util.Enumeration;
import javax.swing.DefaultCellEditor;
import javax.swing.Icon;
import javax.swing.JComponent;
import javax.swing.JTextField;
import javax.swing.JTree;
import javax.swing.LookAndFeel;
import javax.swing.plaf.ComponentUI;
import javax.swing.plaf.UIResource;
import javax.swing.plaf.basic.BasicTreeUI;
import javax.swing.tree.DefaultTreeCellEditor;
import javax.swing.tree.DefaultTreeCellRenderer;
import javax.swing.tree.TreeCellEditor;
import javax.swing.tree.TreeCellRenderer;
import javax.swing.tree.TreeModel;
import javax.swing.tree.TreePath;
import sun.swing.plaf.synth.SynthIcon;

/**
 * Provides the Synth L&amp;amp;F UI delegate for
 * {@link javax.swing.JTree}.
 *
 * @author Scott Violet
 * @since 1.7
 */
<span class="nc" id="L59">public class SynthTreeUI extends BasicTreeUI</span>
                         implements PropertyChangeListener, SynthUI {
    private SynthStyle style;
    private SynthStyle cellStyle;

    private SynthContext paintContext;

    private boolean drawHorizontalLines;
    private boolean drawVerticalLines;

    private Object linesStyle;

    private int padding;

    private boolean useTreeColors;

<span class="nc" id="L75">    private Icon expandedIconWrapper = new ExpandedIconWrapper();</span>

    /**
     * Creates a new UI object for the given component.
     *
     * @param x component to create UI object for
     * @return the UI object
     */
    public static ComponentUI createUI(JComponent x) {
<span class="nc" id="L84">        return new SynthTreeUI();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public Icon getExpandedIcon() {
<span class="nc" id="L92">        return expandedIconWrapper;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected void installDefaults() {
<span class="nc" id="L100">        updateStyle(tree);</span>
<span class="nc" id="L101">    }</span>

    private void updateStyle(JTree tree) {
<span class="nc" id="L104">        SynthContext context = getContext(tree, ENABLED);</span>
<span class="nc" id="L105">        SynthStyle oldStyle = style;</span>

<span class="nc" id="L107">        style = SynthLookAndFeel.updateStyle(context, this);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (style != oldStyle) {</span>
            Object value;

<span class="nc" id="L111">            setExpandedIcon(style.getIcon(context, &quot;Tree.expandedIcon&quot;));</span>
<span class="nc" id="L112">            setCollapsedIcon(style.getIcon(context, &quot;Tree.collapsedIcon&quot;));</span>

<span class="nc" id="L114">            setLeftChildIndent(style.getInt(context, &quot;Tree.leftChildIndent&quot;,</span>
                                            0));
<span class="nc" id="L116">            setRightChildIndent(style.getInt(context, &quot;Tree.rightChildIndent&quot;,</span>
                                             0));

<span class="nc" id="L119">            drawHorizontalLines = style.getBoolean(</span>
                          context, &quot;Tree.drawHorizontalLines&quot;,true);
<span class="nc" id="L121">            drawVerticalLines = style.getBoolean(</span>
                        context, &quot;Tree.drawVerticalLines&quot;, true);
<span class="nc" id="L123">            linesStyle = style.get(context, &quot;Tree.linesStyle&quot;);</span>

<span class="nc" id="L125">                value = style.get(context, &quot;Tree.rowHeight&quot;);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">                if (value != null) {</span>
<span class="nc" id="L127">                    LookAndFeel.installProperty(tree, &quot;rowHeight&quot;, value);</span>
                }

<span class="nc" id="L130">                value = style.get(context, &quot;Tree.scrollsOnExpand&quot;);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">                LookAndFeel.installProperty(tree, &quot;scrollsOnExpand&quot;,</span>
                                                    value != null? value : Boolean.TRUE);

<span class="nc" id="L134">            padding = style.getInt(context, &quot;Tree.padding&quot;, 0);</span>

<span class="nc bnc" id="L136" title="All 4 branches missed.">            largeModel = (tree.isLargeModel() &amp;&amp; tree.getRowHeight() &gt; 0);</span>

<span class="nc" id="L138">            useTreeColors = style.getBoolean(context,</span>
                                  &quot;Tree.rendererUseTreeColors&quot;, true);

<span class="nc" id="L141">            Boolean showsRootHandles = style.getBoolean(</span>
<span class="nc" id="L142">                    context, &quot;Tree.showsRootHandles&quot;, Boolean.TRUE);</span>
<span class="nc" id="L143">            LookAndFeel.installProperty(</span>
                    tree, JTree.SHOWS_ROOT_HANDLES_PROPERTY, showsRootHandles);

<span class="nc bnc" id="L146" title="All 2 branches missed.">            if (oldStyle != null) {</span>
<span class="nc" id="L147">                uninstallKeyboardActions();</span>
<span class="nc" id="L148">                installKeyboardActions();</span>
            }
        }
<span class="nc" id="L151">        context.dispose();</span>

<span class="nc" id="L153">        context = getContext(tree, Region.TREE_CELL, ENABLED);</span>
<span class="nc" id="L154">        cellStyle = SynthLookAndFeel.updateStyle(context, this);</span>
<span class="nc" id="L155">        context.dispose();</span>
<span class="nc" id="L156">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void installListeners() {
<span class="nc" id="L163">        super.installListeners();</span>
<span class="nc" id="L164">        tree.addPropertyChangeListener(this);</span>
<span class="nc" id="L165">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public SynthContext getContext(JComponent c) {
<span class="nc" id="L172">        return getContext(c, SynthLookAndFeel.getComponentState(c));</span>
    }

    private SynthContext getContext(JComponent c, int state) {
<span class="nc" id="L176">        return SynthContext.getContext(SynthContext.class, c,</span>
<span class="nc" id="L177">                    SynthLookAndFeel.getRegion(c), style, state);</span>
    }

    private SynthContext getContext(JComponent c, Region region) {
<span class="nc" id="L181">        return getContext(c, region, getComponentState(c, region));</span>
    }

    private SynthContext getContext(JComponent c, Region region, int state) {
<span class="nc" id="L185">        return SynthContext.getContext(SynthContext.class, c,</span>
                                       region, cellStyle, state);
    }

    private int getComponentState(JComponent c, Region region) {
        // Always treat the cell as selected, will be adjusted appropriately
        // when painted.
<span class="nc" id="L192">        return ENABLED | SELECTED;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected TreeCellEditor createDefaultCellEditor() {
<span class="nc" id="L200">        TreeCellRenderer renderer = tree.getCellRenderer();</span>
        DefaultTreeCellEditor editor;

<span class="nc bnc" id="L203" title="All 4 branches missed.">        if(renderer != null &amp;&amp; (renderer instanceof DefaultTreeCellRenderer)) {</span>
<span class="nc" id="L204">            editor = new SynthTreeCellEditor(tree, (DefaultTreeCellRenderer)</span>
                                             renderer);
        }
        else {
<span class="nc" id="L208">            editor = new SynthTreeCellEditor(tree, null);</span>
        }
<span class="nc" id="L210">        return editor;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected TreeCellRenderer createDefaultCellRenderer() {
<span class="nc" id="L218">        return new SynthTreeCellRenderer();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected void uninstallDefaults() {
<span class="nc" id="L226">        SynthContext context = getContext(tree, ENABLED);</span>

<span class="nc" id="L228">        style.uninstallDefaults(context);</span>
<span class="nc" id="L229">        context.dispose();</span>
<span class="nc" id="L230">        style = null;</span>

<span class="nc" id="L232">        context = getContext(tree, Region.TREE_CELL, ENABLED);</span>
<span class="nc" id="L233">        cellStyle.uninstallDefaults(context);</span>
<span class="nc" id="L234">        context.dispose();</span>
<span class="nc" id="L235">        cellStyle = null;</span>


<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (tree.getTransferHandler() instanceof UIResource) {</span>
<span class="nc" id="L239">            tree.setTransferHandler(null);</span>
        }
<span class="nc" id="L241">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void uninstallListeners() {
<span class="nc" id="L248">        super.uninstallListeners();</span>
<span class="nc" id="L249">        tree.removePropertyChangeListener(this);</span>
<span class="nc" id="L250">    }</span>

    /**
     * Notifies this UI delegate to repaint the specified component.
     * This method paints the component background, then calls
     * the {@link #paint(SynthContext,Graphics)} method.
     *
     * &lt;p&gt;In general, this method does not need to be overridden by subclasses.
     * All Look and Feel rendering code should reside in the {@code paint} method.
     *
     * @param g the {@code Graphics} object used for painting
     * @param c the component being painted
     * @see #paint(SynthContext,Graphics)
     */
    @Override
    public void update(Graphics g, JComponent c) {
<span class="nc" id="L266">        SynthContext context = getContext(c);</span>

<span class="nc" id="L268">        SynthLookAndFeel.update(context, g);</span>
<span class="nc" id="L269">        context.getPainter().paintTreeBackground(context,</span>
<span class="nc" id="L270">                          g, 0, 0, c.getWidth(), c.getHeight());</span>
<span class="nc" id="L271">        paint(context, g);</span>
<span class="nc" id="L272">        context.dispose();</span>
<span class="nc" id="L273">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void paintBorder(SynthContext context, Graphics g, int x,
                            int y, int w, int h) {
<span class="nc" id="L281">        context.getPainter().paintTreeBorder(context, g, x, y, w, h);</span>
<span class="nc" id="L282">    }</span>

    /**
     * Paints the specified component according to the Look and Feel.
     * &lt;p&gt;This method is not used by Synth Look and Feel.
     * Painting is handled by the {@link #paint(SynthContext,Graphics)} method.
     *
     * @param g the {@code Graphics} object used for painting
     * @param c the component being painted
     * @see #paint(SynthContext,Graphics)
     */
    @Override
    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L295">        SynthContext context = getContext(c);</span>

<span class="nc" id="L297">        paint(context, g);</span>
<span class="nc" id="L298">        context.dispose();</span>
<span class="nc" id="L299">    }</span>

    /**
     * Paints the specified component.
     *
     * @param context context for the component being painted
     * @param g the {@code Graphics} object used for painting
     * @see #update(Graphics,JComponent)
     */
    protected void paint(SynthContext context, Graphics g) {
<span class="nc" id="L309">        paintContext = context;</span>

<span class="nc" id="L311">        updateLeadSelectionRow();</span>

<span class="nc" id="L313">        Rectangle paintBounds = g.getClipBounds();</span>
<span class="nc" id="L314">        Insets insets = tree.getInsets();</span>
<span class="nc" id="L315">        TreePath initialPath = getClosestPathForLocation(tree, 0,</span>
                                                         paintBounds.y);
<span class="nc" id="L317">        Enumeration paintingEnumerator = treeState.getVisiblePathsFrom</span>
<span class="nc" id="L318">                                              (initialPath);</span>
<span class="nc" id="L319">        int row = treeState.getRowForPath(initialPath);</span>
<span class="nc" id="L320">        int endY = paintBounds.y + paintBounds.height;</span>
<span class="nc" id="L321">        TreeModel treeModel = tree.getModel();</span>
<span class="nc" id="L322">        SynthContext cellContext = getContext(tree, Region.TREE_CELL);</span>

<span class="nc" id="L324">        drawingCache.clear();</span>

<span class="nc" id="L326">        setHashColor(context.getStyle().getColor(context,</span>
                                                ColorType.FOREGROUND));

<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (paintingEnumerator != null) {</span>
            // First pass, draw the rows

<span class="nc" id="L332">            boolean done = false;</span>
            boolean isExpanded;
            boolean hasBeenExpanded;
            boolean isLeaf;
<span class="nc" id="L336">            Rectangle rowBounds = new Rectangle(0, 0, tree.getWidth(),0);</span>
            Rectangle bounds;
            TreePath path;
<span class="nc" id="L339">            TreeCellRenderer renderer = tree.getCellRenderer();</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">            DefaultTreeCellRenderer dtcr = (renderer instanceof</span>
                       DefaultTreeCellRenderer) ? (DefaultTreeCellRenderer)
                       renderer : null;

<span class="nc" id="L344">            configureRenderer(cellContext);</span>
<span class="nc bnc" id="L345" title="All 4 branches missed.">            while (!done &amp;&amp; paintingEnumerator.hasMoreElements()) {</span>
<span class="nc" id="L346">                path = (TreePath)paintingEnumerator.nextElement();</span>
<span class="nc" id="L347">                bounds = getPathBounds(tree, path);</span>
<span class="nc bnc" id="L348" title="All 4 branches missed.">                if ((path != null) &amp;&amp; (bounds != null)) {</span>
<span class="nc" id="L349">                    isLeaf = treeModel.isLeaf(path.getLastPathComponent());</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">                    if (isLeaf) {</span>
<span class="nc" id="L351">                        isExpanded = hasBeenExpanded = false;</span>
                    }
                    else {
<span class="nc" id="L354">                        isExpanded = treeState.getExpandedState(path);</span>
<span class="nc" id="L355">                        hasBeenExpanded = tree.hasBeenExpanded(path);</span>
                    }
<span class="nc" id="L357">                    rowBounds.y = bounds.y;</span>
<span class="nc" id="L358">                    rowBounds.height = bounds.height;</span>
<span class="nc" id="L359">                    paintRow(renderer, dtcr, context, cellContext, g,</span>
                             paintBounds, insets, bounds, rowBounds, path,
                             row, isExpanded, hasBeenExpanded, isLeaf);
<span class="nc bnc" id="L362" title="All 2 branches missed.">                    if ((bounds.y + bounds.height) &gt;= endY) {</span>
<span class="nc" id="L363">                        done = true;</span>
                    }
                }
                else {
<span class="nc" id="L367">                    done = true;</span>
                }
<span class="nc" id="L369">                row++;</span>
            }

            // Draw the connecting lines and controls.
            // Find each parent and have them draw a line to their last child
<span class="nc" id="L374">            boolean rootVisible = tree.isRootVisible();</span>
<span class="nc" id="L375">            TreePath parentPath = initialPath;</span>
<span class="nc" id="L376">            parentPath = parentPath.getParentPath();</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">            while (parentPath != null) {</span>
<span class="nc" id="L378">                paintVerticalPartOfLeg(g, paintBounds, insets, parentPath);</span>
<span class="nc" id="L379">                drawingCache.put(parentPath, Boolean.TRUE);</span>
<span class="nc" id="L380">                parentPath = parentPath.getParentPath();</span>
            }
<span class="nc" id="L382">            done = false;</span>
<span class="nc" id="L383">            paintingEnumerator = treeState.getVisiblePathsFrom(initialPath);</span>
<span class="nc bnc" id="L384" title="All 4 branches missed.">            while (!done &amp;&amp; paintingEnumerator.hasMoreElements()) {</span>
<span class="nc" id="L385">                path = (TreePath)paintingEnumerator.nextElement();</span>
<span class="nc" id="L386">                bounds = getPathBounds(tree, path);</span>
<span class="nc bnc" id="L387" title="All 4 branches missed.">                if ((path != null) &amp;&amp; (bounds != null)) {</span>
<span class="nc" id="L388">                    isLeaf = treeModel.isLeaf(path.getLastPathComponent());</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">                    if (isLeaf) {</span>
<span class="nc" id="L390">                        isExpanded = hasBeenExpanded = false;</span>
                    }
                    else {
<span class="nc" id="L393">                        isExpanded = treeState.getExpandedState(path);</span>
<span class="nc" id="L394">                        hasBeenExpanded = tree.hasBeenExpanded(path);</span>
                    }
                    // See if the vertical line to the parent has been drawn.
<span class="nc" id="L397">                    parentPath = path.getParentPath();</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">                    if (parentPath != null) {</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">                        if (drawingCache.get(parentPath) == null) {</span>
<span class="nc" id="L400">                            paintVerticalPartOfLeg(g, paintBounds, insets,</span>
                                                   parentPath);
<span class="nc" id="L402">                            drawingCache.put(parentPath, Boolean.TRUE);</span>
                        }
<span class="nc" id="L404">                        paintHorizontalPartOfLeg(g,</span>
                                                 paintBounds, insets, bounds,
                                                 path, row, isExpanded,
                                                 hasBeenExpanded, isLeaf);
                    }
<span class="nc bnc" id="L409" title="All 4 branches missed.">                    else if (rootVisible &amp;&amp; row == 0) {</span>
<span class="nc" id="L410">                        paintHorizontalPartOfLeg(g,</span>
                                                 paintBounds, insets, bounds,
                                                 path, row, isExpanded,
                                                 hasBeenExpanded, isLeaf);
                    }
<span class="nc bnc" id="L415" title="All 2 branches missed.">                    if (shouldPaintExpandControl(path, row, isExpanded,</span>
                                                 hasBeenExpanded, isLeaf)) {
<span class="nc" id="L417">                        paintExpandControl(g, paintBounds,</span>
                                           insets, bounds, path, row,
                                           isExpanded, hasBeenExpanded,isLeaf);
                    }
<span class="nc bnc" id="L421" title="All 2 branches missed.">                    if ((bounds.y + bounds.height) &gt;= endY) {</span>
<span class="nc" id="L422">                        done = true;</span>
                    }
                }
                else {
<span class="nc" id="L426">                    done = true;</span>
                }
<span class="nc" id="L428">                row++;</span>
            }
        }
<span class="nc" id="L431">        cellContext.dispose();</span>

<span class="nc" id="L433">        paintDropLine(g);</span>

        // Empty out the renderer pane, allowing renderers to be gc'ed.
<span class="nc" id="L436">        rendererPane.removeAll();</span>

<span class="nc" id="L438">        paintContext = null;</span>
<span class="nc" id="L439">    }</span>

    private void configureRenderer(SynthContext context) {
<span class="nc" id="L442">        TreeCellRenderer renderer = tree.getCellRenderer();</span>

<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (renderer instanceof DefaultTreeCellRenderer) {</span>
<span class="nc" id="L445">            DefaultTreeCellRenderer r = (DefaultTreeCellRenderer)renderer;</span>
<span class="nc" id="L446">            SynthStyle style = context.getStyle();</span>

<span class="nc" id="L448">            context.setComponentState(ENABLED | SELECTED);</span>
<span class="nc" id="L449">            Color color = r.getTextSelectionColor();</span>
<span class="nc bnc" id="L450" title="All 4 branches missed.">            if (color == null || (color instanceof UIResource)) {</span>
<span class="nc" id="L451">                r.setTextSelectionColor(style.getColor(</span>
                                     context, ColorType.TEXT_FOREGROUND));
            }
<span class="nc" id="L454">            color = r.getBackgroundSelectionColor();</span>
<span class="nc bnc" id="L455" title="All 4 branches missed.">            if (color == null || (color instanceof UIResource)) {</span>
<span class="nc" id="L456">                r.setBackgroundSelectionColor(style.getColor(</span>
                                        context, ColorType.TEXT_BACKGROUND));
            }

<span class="nc" id="L460">            context.setComponentState(ENABLED);</span>
<span class="nc" id="L461">            color = r.getTextNonSelectionColor();</span>
<span class="nc bnc" id="L462" title="All 4 branches missed.">            if (color == null || color instanceof UIResource) {</span>
<span class="nc" id="L463">                r.setTextNonSelectionColor(style.getColorForState(</span>
                                        context, ColorType.TEXT_FOREGROUND));
            }
<span class="nc" id="L466">            color = r.getBackgroundNonSelectionColor();</span>
<span class="nc bnc" id="L467" title="All 4 branches missed.">            if (color == null || color instanceof UIResource) {</span>
<span class="nc" id="L468">                r.setBackgroundNonSelectionColor(style.getColorForState(</span>
                                  context, ColorType.TEXT_BACKGROUND));
            }
        }
<span class="nc" id="L472">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void paintHorizontalPartOfLeg(Graphics g, Rectangle clipBounds,
                                            Insets insets, Rectangle bounds,
                                            TreePath path, int row,
                                            boolean isExpanded,
                                            boolean hasBeenExpanded, boolean
                                            isLeaf) {
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (drawHorizontalLines) {</span>
<span class="nc" id="L485">            super.paintHorizontalPartOfLeg(g, clipBounds, insets, bounds,</span>
                                           path, row, isExpanded,
                                           hasBeenExpanded, isLeaf);
        }
<span class="nc" id="L489">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void paintHorizontalLine(Graphics g, JComponent c, int y,
                                      int left, int right) {
<span class="nc" id="L497">        paintContext.getStyle().getGraphicsUtils(paintContext).drawLine(</span>
            paintContext, &quot;Tree.horizontalLine&quot;, g, left, y, right, y, linesStyle);
<span class="nc" id="L499">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void paintVerticalPartOfLeg(Graphics g,
                                          Rectangle clipBounds, Insets insets,
                                          TreePath path) {
<span class="nc bnc" id="L508" title="All 2 branches missed.">        if (drawVerticalLines) {</span>
<span class="nc" id="L509">            super.paintVerticalPartOfLeg(g, clipBounds, insets, path);</span>
        }
<span class="nc" id="L511">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void paintVerticalLine(Graphics g, JComponent c, int x, int top,
                                    int bottom) {
<span class="nc" id="L519">        paintContext.getStyle().getGraphicsUtils(paintContext).drawLine(</span>
            paintContext, &quot;Tree.verticalLine&quot;, g, x, top, x, bottom, linesStyle);
<span class="nc" id="L521">    }</span>

    private void paintRow(TreeCellRenderer renderer,
               DefaultTreeCellRenderer dtcr, SynthContext treeContext,
               SynthContext cellContext, Graphics g, Rectangle clipBounds,
               Insets insets, Rectangle bounds, Rectangle rowBounds,
               TreePath path, int row, boolean isExpanded,
               boolean hasBeenExpanded, boolean isLeaf) {
        // Don't paint the renderer if editing this row.
<span class="nc" id="L530">        boolean selected = tree.isRowSelected(row);</span>

<span class="nc" id="L532">        JTree.DropLocation dropLocation = tree.getDropLocation();</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">        boolean isDrop = dropLocation != null</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">                         &amp;&amp; dropLocation.getChildIndex() == -1</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">                         &amp;&amp; path == dropLocation.getPath();</span>

<span class="nc" id="L537">        int state = ENABLED;</span>
<span class="nc bnc" id="L538" title="All 4 branches missed.">        if (selected || isDrop) {</span>
<span class="nc" id="L539">            state |= SELECTED;</span>
        }

<span class="nc bnc" id="L542" title="All 4 branches missed.">        if (tree.isFocusOwner() &amp;&amp; row == getLeadSelectionRow()) {</span>
<span class="nc" id="L543">            state |= FOCUSED;</span>
        }

<span class="nc" id="L546">        cellContext.setComponentState(state);</span>

<span class="nc bnc" id="L548" title="All 4 branches missed.">        if (dtcr != null &amp;&amp; (dtcr.getBorderSelectionColor() instanceof</span>
                             UIResource)) {
<span class="nc" id="L550">            dtcr.setBorderSelectionColor(style.getColor(</span>
                                             cellContext, ColorType.FOCUS));
        }
<span class="nc" id="L553">        SynthLookAndFeel.updateSubregion(cellContext, g, rowBounds);</span>
<span class="nc" id="L554">        cellContext.getPainter().paintTreeCellBackground(cellContext, g,</span>
                    rowBounds.x, rowBounds.y, rowBounds.width,
                    rowBounds.height);
<span class="nc" id="L557">        cellContext.getPainter().paintTreeCellBorder(cellContext, g,</span>
                    rowBounds.x, rowBounds.y, rowBounds.width,
                    rowBounds.height);
<span class="nc bnc" id="L560" title="All 4 branches missed.">        if (editingComponent != null &amp;&amp; editingRow == row) {</span>
<span class="nc" id="L561">            return;</span>
        }

        int leadIndex;

<span class="nc bnc" id="L566" title="All 2 branches missed.">        if (tree.hasFocus()) {</span>
<span class="nc" id="L567">            leadIndex = getLeadSelectionRow();</span>
        }
        else {
<span class="nc" id="L570">            leadIndex = -1;</span>
        }

<span class="nc" id="L573">        Component component = renderer.getTreeCellRendererComponent(</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                         tree, path.getLastPathComponent(),</span>
                         selected, isExpanded, isLeaf, row,
                         (leadIndex == row));

<span class="nc" id="L578">        rendererPane.paintComponent(g, component, tree, bounds.x, bounds.y,</span>
                                    bounds.width, bounds.height, true);
<span class="nc" id="L580">    }</span>

    private int findCenteredX(int x, int iconWidth) {
<span class="nc bnc" id="L583" title="All 2 branches missed.">        return tree.getComponentOrientation().isLeftToRight()</span>
<span class="nc" id="L584">               ? x - (int)Math.ceil(iconWidth / 2.0)</span>
<span class="nc" id="L585">               : x - (int)Math.floor(iconWidth / 2.0);</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected void paintExpandControl(Graphics g, Rectangle clipBounds,
            Insets insets, Rectangle bounds, TreePath path, int row,
            boolean isExpanded, boolean hasBeenExpanded, boolean isLeaf) {
        //modify the paintContext's state to match the state for the row
        //this is a hack in that it requires knowledge of the subsequent
        //method calls. The point is, the context used in drawCentered
        //should reflect the state of the row, not of the tree.
<span class="nc" id="L599">        boolean isSelected = tree.getSelectionModel().isPathSelected(path);</span>
<span class="nc" id="L600">        int state = paintContext.getComponentState();</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">        if (isSelected) {</span>
<span class="nc" id="L602">            paintContext.setComponentState(state | SynthConstants.SELECTED);</span>
        }
<span class="nc" id="L604">        super.paintExpandControl(g, clipBounds, insets, bounds, path, row,</span>
                isExpanded, hasBeenExpanded, isLeaf);
<span class="nc" id="L606">        paintContext.setComponentState(state);</span>
<span class="nc" id="L607">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void drawCentered(Component c, Graphics graphics, Icon icon,
                                int x, int y) {
<span class="nc" id="L615">        int w = SynthIcon.getIconWidth(icon, paintContext);</span>
<span class="nc" id="L616">        int h = SynthIcon.getIconHeight(icon, paintContext);</span>

<span class="nc" id="L618">        SynthIcon.paintIcon(icon, paintContext, graphics,</span>
<span class="nc" id="L619">                            findCenteredX(x, w),</span>
                            y - h/2, w, h);
<span class="nc" id="L621">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void propertyChange(PropertyChangeEvent event) {
<span class="nc bnc" id="L628" title="All 2 branches missed.">        if (SynthLookAndFeel.shouldUpdateStyle(event)) {</span>
<span class="nc" id="L629">            updateStyle((JTree)event.getSource());</span>
        }

<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (&quot;dropLocation&quot; == event.getPropertyName()) {</span>
<span class="nc" id="L633">            JTree.DropLocation oldValue = (JTree.DropLocation)event.getOldValue();</span>
<span class="nc" id="L634">            repaintDropLocation(oldValue);</span>
<span class="nc" id="L635">            repaintDropLocation(tree.getDropLocation());</span>
        }
<span class="nc" id="L637">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected void paintDropLine(Graphics g) {
<span class="nc" id="L644">        JTree.DropLocation loc = tree.getDropLocation();</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">        if (!isDropLine(loc)) {</span>
<span class="nc" id="L646">            return;</span>
        }

<span class="nc" id="L649">        Color c = (Color)style.get(paintContext, &quot;Tree.dropLineColor&quot;);</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">        if (c != null) {</span>
<span class="nc" id="L651">            g.setColor(c);</span>
<span class="nc" id="L652">            Rectangle rect = getDropLineRect(loc);</span>
<span class="nc" id="L653">            g.fillRect(rect.x, rect.y, rect.width, rect.height);</span>
        }
<span class="nc" id="L655">    }</span>

    private void repaintDropLocation(JTree.DropLocation loc) {
<span class="nc bnc" id="L658" title="All 2 branches missed.">        if (loc == null) {</span>
<span class="nc" id="L659">            return;</span>
        }

        Rectangle r;

<span class="nc bnc" id="L664" title="All 2 branches missed.">        if (isDropLine(loc)) {</span>
<span class="nc" id="L665">            r = getDropLineRect(loc);</span>
        } else {
<span class="nc" id="L667">            r = tree.getPathBounds(loc.getPath());</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">            if (r != null) {</span>
<span class="nc" id="L669">                r.x = 0;</span>
<span class="nc" id="L670">                r.width = tree.getWidth();</span>
            }
        }

<span class="nc bnc" id="L674" title="All 2 branches missed.">        if (r != null) {</span>
<span class="nc" id="L675">            tree.repaint(r);</span>
        }
<span class="nc" id="L677">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    protected int getRowX(int row, int depth) {
<span class="nc" id="L684">        return super.getRowX(row, depth) + padding;</span>
    }


<span class="nc bnc" id="L688" title="All 2 branches missed.">    private class SynthTreeCellRenderer extends DefaultTreeCellRenderer</span>
                               implements UIResource {
<span class="nc" id="L690">        SynthTreeCellRenderer() {</span>
<span class="nc" id="L691">        }</span>

        @Override
        public String getName() {
<span class="nc" id="L695">            return &quot;Tree.cellRenderer&quot;;</span>
        }

        @Override
        public Component getTreeCellRendererComponent(JTree tree, Object value,
                                                      boolean sel,
                                                      boolean expanded,
                                                      boolean leaf, int row,
                                                      boolean hasFocus) {
<span class="nc bnc" id="L704" title="All 6 branches missed.">            if (!useTreeColors &amp;&amp; (sel || hasFocus)) {</span>
<span class="nc" id="L705">                SynthLookAndFeel.setSelectedUI((SynthLabelUI)SynthLookAndFeel.</span>
<span class="nc" id="L706">                             getUIOfType(getUI(), SynthLabelUI.class),</span>
<span class="nc" id="L707">                                   sel, hasFocus, tree.isEnabled(), false);</span>
            }
            else {
<span class="nc" id="L710">                SynthLookAndFeel.resetSelectedUI();</span>
            }
<span class="nc" id="L712">            return super.getTreeCellRendererComponent(tree, value, sel,</span>
                                                      expanded, leaf, row, hasFocus);
        }

        @Override
        public void paint(Graphics g) {
<span class="nc" id="L718">            paintComponent(g);</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">            if (hasFocus) {</span>
<span class="nc" id="L720">                SynthContext context = getContext(tree, Region.TREE_CELL);</span>

<span class="nc bnc" id="L722" title="All 2 branches missed.">                if (context.getStyle() == null) {</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">                    assert false: &quot;SynthTreeCellRenderer is being used &quot; +</span>
                        &quot;outside of UI that created it&quot;;
<span class="nc" id="L725">                    return;</span>
                }
<span class="nc" id="L727">                int imageOffset = 0;</span>
<span class="nc" id="L728">                Icon currentI = getIcon();</span>

<span class="nc bnc" id="L730" title="All 4 branches missed.">                if(currentI != null &amp;&amp; getText() != null) {</span>
<span class="nc" id="L731">                    imageOffset = currentI.getIconWidth() +</span>
<span class="nc" id="L732">                                          Math.max(0, getIconTextGap() - 1);</span>
                }
<span class="nc bnc" id="L734" title="All 2 branches missed.">                if (selected) {</span>
<span class="nc" id="L735">                    context.setComponentState(ENABLED | SELECTED);</span>
                }
                else {
<span class="nc" id="L738">                    context.setComponentState(ENABLED);</span>
                }
<span class="nc bnc" id="L740" title="All 2 branches missed.">                if(getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L741">                    context.getPainter().paintTreeCellFocus(context, g,</span>
<span class="nc" id="L742">                            imageOffset, 0, getWidth() - imageOffset,</span>
<span class="nc" id="L743">                            getHeight());</span>
                }
                else {
<span class="nc" id="L746">                    context.getPainter().paintTreeCellFocus(context, g,</span>
<span class="nc" id="L747">                            0, 0, getWidth() - imageOffset, getHeight());</span>
                }
<span class="nc" id="L749">                context.dispose();</span>
            }
<span class="nc" id="L751">            SynthLookAndFeel.resetSelectedUI();</span>
<span class="nc" id="L752">        }</span>
    }


    private static class SynthTreeCellEditor extends DefaultTreeCellEditor {
        public SynthTreeCellEditor(JTree tree,
                                   DefaultTreeCellRenderer renderer) {
<span class="nc" id="L759">            super(tree, renderer);</span>
<span class="nc" id="L760">            setBorderSelectionColor(null);</span>
<span class="nc" id="L761">        }</span>

        @Override
        protected TreeCellEditor createTreeCellEditor() {
<span class="nc" id="L765">            JTextField tf = new JTextField() {</span>
                @Override
                public String getName() {
<span class="nc" id="L768">                    return &quot;Tree.cellEditor&quot;;</span>
                }
            };
<span class="nc" id="L771">            DefaultCellEditor editor = new DefaultCellEditor(tf);</span>

            // One click to edit.
<span class="nc" id="L774">            editor.setClickCountToStart(1);</span>
<span class="nc" id="L775">            return editor;</span>
        }
    }

    //
    // BasicTreeUI directly uses expandIcon outside of the Synth methods.
    // To get the correct context we return an instance of this that fetches
    // the SynthContext as needed.
    //
<span class="nc" id="L784">    private class ExpandedIconWrapper extends SynthIcon {</span>
        public void paintIcon(SynthContext context, Graphics g, int x,
                              int y, int w, int h) {
<span class="nc bnc" id="L787" title="All 2 branches missed.">            if (context == null) {</span>
<span class="nc" id="L788">                context = getContext(tree);</span>
<span class="nc" id="L789">                SynthIcon.paintIcon(expandedIcon, context, g, x, y, w, h);</span>
<span class="nc" id="L790">                context.dispose();</span>
            }
            else {
<span class="nc" id="L793">                SynthIcon.paintIcon(expandedIcon, context, g, x, y, w, h);</span>
            }
<span class="nc" id="L795">        }</span>

        public int getIconWidth(SynthContext context) {
            int width;
<span class="nc bnc" id="L799" title="All 2 branches missed.">            if (context == null) {</span>
<span class="nc" id="L800">                context = getContext(tree);</span>
<span class="nc" id="L801">                width = SynthIcon.getIconWidth(expandedIcon, context);</span>
<span class="nc" id="L802">                context.dispose();</span>
            }
            else {
<span class="nc" id="L805">                width = SynthIcon.getIconWidth(expandedIcon, context);</span>
            }
<span class="nc" id="L807">            return width;</span>
        }

        public int getIconHeight(SynthContext context) {
            int height;
<span class="nc bnc" id="L812" title="All 2 branches missed.">            if (context == null) {</span>
<span class="nc" id="L813">                context = getContext(tree);</span>
<span class="nc" id="L814">                height = SynthIcon.getIconHeight(expandedIcon, context);</span>
<span class="nc" id="L815">                context.dispose();</span>
            }
            else {
<span class="nc" id="L818">                height = SynthIcon.getIconHeight(expandedIcon, context);</span>
            }
<span class="nc" id="L820">            return height;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>