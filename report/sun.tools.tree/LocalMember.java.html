<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>LocalMember.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.tools.tree</a> &gt; <span class="el_source">LocalMember.java</span></div><h1>LocalMember.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1994, 2003, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.tools.tree;

import sun.tools.java.*;
import sun.tools.tree.*;
import java.util.Vector;

/**
 * A local Field
 *
 * WARNING: The contents of this source file are not part of any
 * supported API.  Code that depends on them does so at its own risk:
 * they are subject to change or removal without notice.
 */

public
class LocalMember extends MemberDefinition {
    /**
     * The number of the variable
     */
<span class="nc" id="L45">    int number = -1;</span>

    /**
     * Some statistics
     */
    int readcount;
    int writecount;

    /**
     * An indication of which block the variable comes from.
     * Helps identify uplevel references.
     */
    int scopeNumber;

    /**
     * Return current nesting level, i.e., the value of 'scopeNumber'.
     * Made public for the benefit of 'ClassDefinition.resolveName'.
     */
    public int getScopeNumber() {
<span class="nc" id="L64">        return scopeNumber;</span>
    }

    /**
     * Used by copyInline to record the original of this copy.
     */
    LocalMember originalOfCopy;

    /**
     * The previous local variable, this list is used to build a nested
     * context of local variables.
     */
    LocalMember prev;

    /**
     * Constructor
     */
    public LocalMember(long where, ClassDefinition clazz, int modifiers, Type type,
                      Identifier name) {
<span class="nc" id="L83">        super(where, clazz, modifiers, type, name, null, null);</span>
<span class="nc" id="L84">    }</span>

    /**
     * Constructor for a block-inner class.
     */
    public LocalMember(ClassDefinition innerClass) {
<span class="nc" id="L90">        super(innerClass);</span>

        // The class's &quot;real&quot; name is something like &quot;foo$1$bar&quot;, but locally:
<span class="nc" id="L93">        name = innerClass.getLocalName();</span>
<span class="nc" id="L94">    }</span>

    /**
     * Constructor for a proxy to an instance or class variable.
     */
    LocalMember(MemberDefinition field) {
<span class="nc" id="L100">        this(0, null, 0, field.getType(), idClass);</span>
        // use this random slot to store the info:
<span class="nc" id="L102">        accessPeer = field;</span>
<span class="nc" id="L103">    }</span>

    /**
     * Is this a proxy for the given field?
     */
    final MemberDefinition getMember() {
<span class="nc bnc" id="L109" title="All 2 branches missed.">        return (name == idClass) ? accessPeer : null;</span>
    }

    /**
     * Special checks
     */
    public boolean isLocal() {
<span class="nc" id="L116">        return true;</span>
    }

    /**
     * Make a copy of this field, which is an argument to a method
     * or constructor.  Arrange so that when occurrences of the field
     * are encountered in an immediately following copyInline() operation,
     * the expression nodes will replace the original argument by the
     * fresh copy.
     */
    public LocalMember copyInline(Context ctx) {
<span class="nc" id="L127">        LocalMember copy = new LocalMember(where, clazz, modifiers, type, name);</span>
<span class="nc" id="L128">        copy.readcount = this.readcount;</span>
<span class="nc" id="L129">        copy.writecount = this.writecount;</span>

<span class="nc" id="L131">        copy.originalOfCopy = this;</span>

        // Make a temporary link from the original.
        // It only stays valid through the next call to copyInline().
        // (This means that recursive inlining won't work.)
        // To stay honest, we mark these inline copies:
<span class="nc" id="L137">        copy.addModifiers(M_LOCAL);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (this.accessPeer != null</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            &amp;&amp; (this.accessPeer.getModifiers() &amp; M_LOCAL) == 0) {</span>
<span class="nc" id="L140">            throw new CompilerError(&quot;local copyInline&quot;);</span>
        }
<span class="nc" id="L142">        this.accessPeer = copy;</span>

<span class="nc" id="L144">        return copy;</span>
    }

    /**
     * Returns the previous result of copyInline(ctx).
     * Must be called in the course of an Expression.copyInline()
     * operation that immediately follows the LocalMember.copyInline().
     * Return &quot;this&quot; if there is no such copy.
     */
    public LocalMember getCurrentInlineCopy(Context ctx) {
<span class="nc" id="L154">        MemberDefinition accessPeer = this.accessPeer;</span>
<span class="nc bnc" id="L155" title="All 4 branches missed.">        if (accessPeer != null &amp;&amp; (accessPeer.getModifiers() &amp; M_LOCAL) != 0) {</span>
<span class="nc" id="L156">            LocalMember copy = (LocalMember)accessPeer;</span>
<span class="nc" id="L157">            return copy;</span>
        }
<span class="nc" id="L159">        return this;</span>
    }

    /**
     * May inline copies of all the arguments of the given method.
     */
    static public LocalMember[] copyArguments(Context ctx, MemberDefinition field) {
<span class="nc" id="L166">        Vector v = field.getArguments();</span>
<span class="nc" id="L167">        LocalMember res[] = new LocalMember[v.size()];</span>
<span class="nc" id="L168">        v.copyInto(res);</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">        for (int i = 0; i &lt; res.length; i++) {</span>
<span class="nc" id="L170">            res[i] = res[i].copyInline(ctx);</span>
        }
<span class="nc" id="L172">        return res;</span>
    }

    /**
     * Call this when finished with the result of a copyArguments() call.
     */
    static public void doneWithArguments(Context ctx, LocalMember res[]) {
<span class="nc bnc" id="L179" title="All 2 branches missed.">        for (int i = 0; i &lt; res.length; i++) {</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">            if (res[i].originalOfCopy.accessPeer == res[i]) {</span>
<span class="nc" id="L181">                res[i].originalOfCopy.accessPeer = null;</span>
            }
        }
<span class="nc" id="L184">    }</span>

    /**
     * Is this local variable's value stable and simple enough to be directly
     * substituted for occurrences of the variable itself?
     * (This decision is made by VarDeclarationStatement.inline().)
     */
    public boolean isInlineable(Environment env, boolean fromFinal) {
<span class="nc bnc" id="L192" title="All 2 branches missed.">        return (getModifiers() &amp; M_INLINEABLE) != 0;</span>
    }

    /**
     * Check if used
     */
    public boolean isUsed() {
<span class="nc bnc" id="L199" title="All 4 branches missed.">        return (readcount != 0) || (writecount != 0);</span>
    }

    // Used by class Context, only on members of MemberDefinition.available:
    LocalMember getAccessVar() {
<span class="nc" id="L204">        return (LocalMember)accessPeer;</span>
    }
    void setAccessVar(LocalMember f) {
<span class="nc" id="L207">        accessPeer = f;</span>
<span class="nc" id="L208">    }</span>
    // Used by class Context, only on &quot;AccessVar&quot; constructor args
    MemberDefinition getAccessVarMember() {
<span class="nc" id="L211">        return accessPeer;</span>
    }
    void setAccessVarMember(MemberDefinition f) {
<span class="nc" id="L214">        accessPeer = f;</span>
<span class="nc" id="L215">    }</span>


    /**
     * Return value
     */
    public Node getValue(Environment env) {
<span class="nc" id="L222">        return (Expression)getValue();</span>
    }

    /**
     * Value number for vsets, or -1 if none.
     */
    public int getNumber(Context ctx) {
<span class="nc" id="L229">        return number;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>