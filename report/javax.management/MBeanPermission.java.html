<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MBeanPermission.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.management</a> &gt; <span class="el_source">MBeanPermission.java</span></div><h1>MBeanPermission.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.security.Permission;

/**
 * &lt;p&gt;Permission controlling access to MBeanServer operations.  If a
 * security manager has been set using {@link
 * System#setSecurityManager}, most operations on the MBean Server
 * require that the caller's permissions imply an MBeanPermission
 * appropriate for the operation.  This is described in detail in the
 * documentation for the {@link MBeanServer} interface.&lt;/p&gt;
 *
 * &lt;p&gt;As with other {@link Permission} objects, an MBeanPermission can
 * represent either a permission that you &lt;em&gt;have&lt;/em&gt; or a
 * permission that you &lt;em&gt;need&lt;/em&gt;.  When a sensitive operation is
 * being checked for permission, an MBeanPermission is constructed
 * representing the permission you need.  The operation is only
 * allowed if the permissions you have {@linkplain #implies imply} the
 * permission you need.&lt;/p&gt;
 *
 * &lt;p&gt;An MBeanPermission contains four items of information:&lt;/p&gt;
 *
 * &lt;ul&gt;
 *
 * &lt;li&gt;&lt;p&gt;The &lt;em&gt;action&lt;/em&gt;.  For a permission you need,
 * this is one of the actions in the list &lt;a
 * href=&quot;#action-list&quot;&gt;below&lt;/a&gt;.  For a permission you have, this is
 * a comma-separated list of those actions, or &lt;code&gt;*&lt;/code&gt;,
 * representing all actions.&lt;/p&gt;
 *
 * &lt;p&gt;The action is returned by {@link #getActions()}.&lt;/p&gt;
 *
 * &lt;li&gt;&lt;p&gt;The &lt;em&gt;class name&lt;/em&gt;.&lt;/p&gt;
 *
 * &lt;p&gt;For a permission you need, this is the class name of an MBean
 * you are accessing, as returned by {@link
 * MBeanServer#getMBeanInfo(ObjectName)
 * MBeanServer.getMBeanInfo(name)}.{@link MBeanInfo#getClassName()
 * getClassName()}.  Certain operations do not reference a class name,
 * in which case the class name is null.&lt;/p&gt;
 *
 * &lt;p&gt;For a permission you have, this is either empty or a &lt;em&gt;class
 * name pattern&lt;/em&gt;.  A class name pattern is a string following the
 * Java conventions for dot-separated class names.  It may end with
 * &quot;&lt;code&gt;.*&lt;/code&gt;&quot; meaning that the permission grants access to any
 * class that begins with the string preceding &quot;&lt;code&gt;.*&lt;/code&gt;&quot;.  For
 * instance, &quot;&lt;code&gt;javax.management.*&lt;/code&gt;&quot; grants access to
 * &lt;code&gt;javax.management.MBeanServerDelegate&lt;/code&gt; and
 * &lt;code&gt;javax.management.timer.Timer&lt;/code&gt;, among other classes.&lt;/p&gt;
 *
 * &lt;p&gt;A class name pattern can also be empty or the single character
 * &quot;&lt;code&gt;*&lt;/code&gt;&quot;, both of which grant access to any class.&lt;/p&gt;
 *
 * &lt;li&gt;&lt;p&gt;The &lt;em&gt;member&lt;/em&gt;.&lt;/p&gt;
 *
 * &lt;p&gt;For a permission you need, this is the name of the attribute or
 * operation you are accessing.  For operations that do not reference
 * an attribute or operation, the member is null.&lt;/p&gt;
 *
 * &lt;p&gt;For a permission you have, this is either the name of an attribute
 * or operation you can access, or it is empty or the single character
 * &quot;&lt;code&gt;*&lt;/code&gt;&quot;, both of which grant access to any member.&lt;/p&gt;
 *
 * &lt;li id=&quot;MBeanName&quot;&gt;&lt;p&gt;The &lt;em&gt;object name&lt;/em&gt;.&lt;/p&gt;
 *
 * &lt;p&gt;For a permission you need, this is the {@link ObjectName} of the
 * MBean you are accessing.  For operations that do not reference a
 * single MBean, it is null.  It is never an object name pattern.&lt;/p&gt;
 *
 * &lt;p&gt;For a permission you have, this is the {@link ObjectName} of the
 * MBean or MBeans you can access.  It may be an object name pattern
 * to grant access to all MBeans whose names match the pattern.  It
 * may also be empty, which grants access to all MBeans whatever their
 * name.&lt;/p&gt;
 *
 * &lt;/ul&gt;
 *
 * &lt;p&gt;If you have an MBeanPermission, it allows operations only if all
 * four of the items match.&lt;/p&gt;
 *
 * &lt;p&gt;The class name, member, and object name can be written together
 * as a single string, which is the &lt;em&gt;name&lt;/em&gt; of this permission.
 * The name of the permission is the string returned by {@link
 * Permission#getName() getName()}.  The format of the string is:&lt;/p&gt;
 *
 * &lt;blockquote&gt;
 * &lt;code&gt;className#member[objectName]&lt;/code&gt;
 * &lt;/blockquote&gt;
 *
 * &lt;p&gt;The object name is written using the usual syntax for {@link
 * ObjectName}.  It may contain any legal characters, including
 * &lt;code&gt;]&lt;/code&gt;.  It is terminated by a &lt;code&gt;]&lt;/code&gt; character
 * that is the last character in the string.&lt;/p&gt;
 *
 * &lt;p&gt;One or more of the &lt;code&gt;className&lt;/code&gt;, &lt;code&gt;member&lt;/code&gt;,
 * or &lt;code&gt;objectName&lt;/code&gt; may be omitted.  If the
 * &lt;code&gt;member&lt;/code&gt; is omitted, the &lt;code&gt;#&lt;/code&gt; may be too (but
 * does not have to be).  If the &lt;code&gt;objectName&lt;/code&gt; is omitted,
 * the &lt;code&gt;[]&lt;/code&gt; may be too (but does not have to be).  It is
 * not legal to omit all three items, that is to have a &lt;em&gt;name&lt;/em&gt;
 * that is the empty string.&lt;/p&gt;
 *
 * &lt;p&gt;One or more of the &lt;code&gt;className&lt;/code&gt;, &lt;code&gt;member&lt;/code&gt;,
 * or &lt;code&gt;objectName&lt;/code&gt; may be the character &quot;&lt;code&gt;-&lt;/code&gt;&quot;,
 * which is equivalent to a null value.  A null value is implied by
 * any value (including another null value) but does not imply any
 * other value.&lt;/p&gt;
 *
 * &lt;p&gt;&lt;a name=&quot;action-list&quot;&gt;The possible actions are these:&lt;/a&gt;&lt;/p&gt;
 *
 * &lt;ul&gt;
 * &lt;li&gt;addNotificationListener&lt;/li&gt;
 * &lt;li&gt;getAttribute&lt;/li&gt;
 * &lt;li&gt;getClassLoader&lt;/li&gt;
 * &lt;li&gt;getClassLoaderFor&lt;/li&gt;
 * &lt;li&gt;getClassLoaderRepository&lt;/li&gt;
 * &lt;li&gt;getDomains&lt;/li&gt;
 * &lt;li&gt;getMBeanInfo&lt;/li&gt;
 * &lt;li&gt;getObjectInstance&lt;/li&gt;
 * &lt;li&gt;instantiate&lt;/li&gt;
 * &lt;li&gt;invoke&lt;/li&gt;
 * &lt;li&gt;isInstanceOf&lt;/li&gt;
 * &lt;li&gt;queryMBeans&lt;/li&gt;
 * &lt;li&gt;queryNames&lt;/li&gt;
 * &lt;li&gt;registerMBean&lt;/li&gt;
 * &lt;li&gt;removeNotificationListener&lt;/li&gt;
 * &lt;li&gt;setAttribute&lt;/li&gt;
 * &lt;li&gt;unregisterMBean&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;p&gt;In a comma-separated list of actions, spaces are allowed before
 * and after each action.&lt;/p&gt;
 *
 * @since 1.5
 */
public class MBeanPermission extends Permission {

    private static final long serialVersionUID = -2416928705275160661L;

    /**
     * Actions list.
     */
    private static final int AddNotificationListener    = 0x00001;
    private static final int GetAttribute               = 0x00002;
    private static final int GetClassLoader             = 0x00004;
    private static final int GetClassLoaderFor          = 0x00008;
    private static final int GetClassLoaderRepository   = 0x00010;
    private static final int GetDomains                 = 0x00020;
    private static final int GetMBeanInfo               = 0x00040;
    private static final int GetObjectInstance          = 0x00080;
    private static final int Instantiate                = 0x00100;
    private static final int Invoke                     = 0x00200;
    private static final int IsInstanceOf               = 0x00400;
    private static final int QueryMBeans                = 0x00800;
    private static final int QueryNames                 = 0x01000;
    private static final int RegisterMBean              = 0x02000;
    private static final int RemoveNotificationListener = 0x04000;
    private static final int SetAttribute               = 0x08000;
    private static final int UnregisterMBean            = 0x10000;

    /**
     * No actions.
     */
    private static final int NONE = 0x00000;

    /**
     * All actions.
     */
    private static final int ALL =
        AddNotificationListener    |
        GetAttribute               |
        GetClassLoader             |
        GetClassLoaderFor          |
        GetClassLoaderRepository   |
        GetDomains                 |
        GetMBeanInfo               |
        GetObjectInstance          |
        Instantiate                |
        Invoke                     |
        IsInstanceOf               |
        QueryMBeans                |
        QueryNames                 |
        RegisterMBean              |
        RemoveNotificationListener |
        SetAttribute               |
        UnregisterMBean;

    /**
     * The actions string.
     */
    private String actions;

    /**
     * The actions mask.
     */
    private transient int mask;

    /**
     * The classname prefix that must match.  If null, is implied by any
     * classNamePrefix but does not imply any non-null classNamePrefix.
     */
    private transient String classNamePrefix;

    /**
     * True if classNamePrefix must match exactly.  Otherwise, the
     * className being matched must start with classNamePrefix.
     */
    private transient boolean classNameExactMatch;

    /**
     * The member that must match.  If null, is implied by any member
     * but does not imply any non-null member.
     */
    private transient String member;

    /**
     * The objectName that must match.  If null, is implied by any
     * objectName but does not imply any non-null objectName.
     */
    private transient ObjectName objectName;

    /**
     * Parse &lt;code&gt;actions&lt;/code&gt; parameter.
     */
    private void parseActions() {

        int mask;

<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (actions == null)</span>
<span class="nc" id="L257">            throw new IllegalArgumentException(&quot;MBeanPermission: &quot; +</span>
                                               &quot;actions can't be null&quot;);
<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (actions.equals(&quot;&quot;))</span>
<span class="nc" id="L260">            throw new IllegalArgumentException(&quot;MBeanPermission: &quot; +</span>
                                               &quot;actions can't be empty&quot;);

<span class="nc" id="L263">        mask = getMask(actions);</span>

<span class="nc bnc" id="L265" title="All 2 branches missed.">        if ((mask &amp; ALL) != mask)</span>
<span class="nc" id="L266">            throw new IllegalArgumentException(&quot;Invalid actions mask&quot;);</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (mask == NONE)</span>
<span class="nc" id="L268">            throw new IllegalArgumentException(&quot;Invalid actions mask&quot;);</span>
<span class="nc" id="L269">        this.mask = mask;</span>
<span class="nc" id="L270">    }</span>

    /**
     * Parse &lt;code&gt;name&lt;/code&gt; parameter.
     */
    private void parseName() {
<span class="nc" id="L276">        String name = getName();</span>

<span class="nc bnc" id="L278" title="All 2 branches missed.">        if (name == null)</span>
<span class="nc" id="L279">            throw new IllegalArgumentException(&quot;MBeanPermission name &quot; +</span>
                                               &quot;cannot be null&quot;);

<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (name.equals(&quot;&quot;))</span>
<span class="nc" id="L283">            throw new IllegalArgumentException(&quot;MBeanPermission name &quot; +</span>
                                               &quot;cannot be empty&quot;);

        /* The name looks like &quot;class#member[objectname]&quot;.  We subtract
           elements from the right as we parse, so after parsing the
           objectname we have &quot;class#member&quot; and after parsing the
           member we have &quot;class&quot;.  Each element is optional.  */

        // Parse ObjectName

<span class="nc" id="L293">        int openingBracket = name.indexOf(&quot;[&quot;);</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (openingBracket == -1) {</span>
            // If &quot;[on]&quot; missing then ObjectName(&quot;*:*&quot;)
            //
<span class="nc" id="L297">            objectName = ObjectName.WILDCARD;</span>
        } else {
<span class="nc bnc" id="L299" title="All 2 branches missed.">            if (!name.endsWith(&quot;]&quot;)) {</span>
<span class="nc" id="L300">                throw new IllegalArgumentException(&quot;MBeanPermission: &quot; +</span>
                                                   &quot;The ObjectName in the &quot; +
                                                   &quot;target name must be &quot; +
                                                   &quot;included in square &quot; +
                                                   &quot;brackets&quot;);
            } else {
                // Create ObjectName
                //
                try {
                    // If &quot;[]&quot; then ObjectName(&quot;*:*&quot;)
                    //
<span class="nc" id="L311">                    String on = name.substring(openingBracket + 1,</span>
<span class="nc" id="L312">                                               name.length() - 1);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                    if (on.equals(&quot;&quot;))</span>
<span class="nc" id="L314">                        objectName = ObjectName.WILDCARD;</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                    else if (on.equals(&quot;-&quot;))</span>
<span class="nc" id="L316">                        objectName = null;</span>
                    else
<span class="nc" id="L318">                        objectName = new ObjectName(on);</span>
<span class="nc" id="L319">                } catch (MalformedObjectNameException e) {</span>
<span class="nc" id="L320">                    throw new IllegalArgumentException(&quot;MBeanPermission: &quot; +</span>
                                                       &quot;The target name does &quot; +
                                                       &quot;not specify a valid &quot; +
                                                       &quot;ObjectName&quot;, e);
<span class="nc" id="L324">                }</span>
            }

<span class="nc" id="L327">            name = name.substring(0, openingBracket);</span>
        }

        // Parse member

<span class="nc" id="L332">        int poundSign = name.indexOf(&quot;#&quot;);</span>

<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (poundSign == -1)</span>
<span class="nc" id="L335">            setMember(&quot;*&quot;);</span>
        else {
<span class="nc" id="L337">            String memberName = name.substring(poundSign + 1);</span>
<span class="nc" id="L338">            setMember(memberName);</span>
<span class="nc" id="L339">            name = name.substring(0, poundSign);</span>
        }

        // Parse className

<span class="nc" id="L344">        setClassName(name);</span>
<span class="nc" id="L345">    }</span>

    /**
     * Assign fields based on className, member, and objectName
     * parameters.
     */
    private void initName(String className, String member,
                          ObjectName objectName) {
<span class="nc" id="L353">        setClassName(className);</span>
<span class="nc" id="L354">        setMember(member);</span>
<span class="nc" id="L355">        this.objectName = objectName;</span>
<span class="nc" id="L356">    }</span>

    private void setClassName(String className) {
<span class="nc bnc" id="L359" title="All 4 branches missed.">        if (className == null || className.equals(&quot;-&quot;)) {</span>
<span class="nc" id="L360">            classNamePrefix = null;</span>
<span class="nc" id="L361">            classNameExactMatch = false;</span>
<span class="nc bnc" id="L362" title="All 4 branches missed.">        } else if (className.equals(&quot;&quot;) || className.equals(&quot;*&quot;)) {</span>
<span class="nc" id="L363">            classNamePrefix = &quot;&quot;;</span>
<span class="nc" id="L364">            classNameExactMatch = false;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">        } else if (className.endsWith(&quot;.*&quot;)) {</span>
            // Note that we include the &quot;.&quot; in the required prefix
<span class="nc" id="L367">            classNamePrefix = className.substring(0, className.length() - 1);</span>
<span class="nc" id="L368">            classNameExactMatch = false;</span>
        } else {
<span class="nc" id="L370">            classNamePrefix = className;</span>
<span class="nc" id="L371">            classNameExactMatch = true;</span>
        }
<span class="nc" id="L373">    }</span>

    private void setMember(String member) {
<span class="nc bnc" id="L376" title="All 4 branches missed.">        if (member == null || member.equals(&quot;-&quot;))</span>
<span class="nc" id="L377">            this.member = null;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">        else if (member.equals(&quot;&quot;))</span>
<span class="nc" id="L379">            this.member = &quot;*&quot;;</span>
        else
<span class="nc" id="L381">            this.member = member;</span>
<span class="nc" id="L382">    }</span>

    /**
     * &lt;p&gt;Create a new MBeanPermission object with the specified target name
     * and actions.&lt;/p&gt;
     *
     * &lt;p&gt;The target name is of the form
     * &quot;&lt;code&gt;className#member[objectName]&lt;/code&gt;&quot; where each part is
     * optional.  It must not be empty or null.&lt;/p&gt;
     *
     * &lt;p&gt;The actions parameter contains a comma-separated list of the
     * desired actions granted on the target name.  It must not be
     * empty or null.&lt;/p&gt;
     *
     * @param name the triplet &quot;className#member[objectName]&quot;.
     * @param actions the action string.
     *
     * @exception IllegalArgumentException if the &lt;code&gt;name&lt;/code&gt; or
     * &lt;code&gt;actions&lt;/code&gt; is invalid.
     */
    public MBeanPermission(String name, String actions) {
<span class="nc" id="L403">        super(name);</span>

<span class="nc" id="L405">        parseName();</span>

<span class="nc" id="L407">        this.actions = actions;</span>
<span class="nc" id="L408">        parseActions();</span>
<span class="nc" id="L409">    }</span>

    /**
     * &lt;p&gt;Create a new MBeanPermission object with the specified target name
     * (class name, member, object name) and actions.&lt;/p&gt;
     *
     * &lt;p&gt;The class name, member and object name parameters define a
     * target name of the form
     * &quot;&lt;code&gt;className#member[objectName]&lt;/code&gt;&quot; where each part is
     * optional.  This will be the result of {@link #getName()} on the
     * resultant MBeanPermission.&lt;/p&gt;
     *
     * &lt;p&gt;The actions parameter contains a comma-separated list of the
     * desired actions granted on the target name.  It must not be
     * empty or null.&lt;/p&gt;
     *
     * @param className the class name to which this permission applies.
     * May be null or &lt;code&gt;&quot;-&quot;&lt;/code&gt;, which represents a class name
     * that is implied by any class name but does not imply any other
     * class name.
     * @param member the member to which this permission applies.  May
     * be null or &lt;code&gt;&quot;-&quot;&lt;/code&gt;, which represents a member that is
     * implied by any member but does not imply any other member.
     * @param objectName the object name to which this permission
     * applies.  May be null, which represents an object name that is
     * implied by any object name but does not imply any other object
     * name.
     * @param actions the action string.
     */
    public MBeanPermission(String className,
                           String member,
                           ObjectName objectName,
                           String actions) {

<span class="nc" id="L443">        super(makeName(className, member, objectName));</span>
<span class="nc" id="L444">        initName(className, member, objectName);</span>

<span class="nc" id="L446">        this.actions = actions;</span>
<span class="nc" id="L447">        parseActions();</span>
<span class="nc" id="L448">    }</span>

    private static String makeName(String className, String member,
                                   ObjectName objectName) {
<span class="nc" id="L452">        final StringBuilder name = new StringBuilder();</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (className == null)</span>
<span class="nc" id="L454">            className = &quot;-&quot;;</span>
<span class="nc" id="L455">        name.append(className);</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">        if (member == null)</span>
<span class="nc" id="L457">            member = &quot;-&quot;;</span>
<span class="nc" id="L458">        name.append(&quot;#&quot; + member);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (objectName == null)</span>
<span class="nc" id="L460">            name.append(&quot;[-]&quot;);</span>
        else
<span class="nc" id="L462">            name.append(&quot;[&quot;).append(objectName.getCanonicalName()).append(&quot;]&quot;);</span>

        /* In the interests of legibility for Permission.toString(), we
           transform the empty string into &quot;*&quot;.  */
<span class="nc bnc" id="L466" title="All 2 branches missed.">        if (name.length() == 0)</span>
<span class="nc" id="L467">            return &quot;*&quot;;</span>
        else
<span class="nc" id="L469">            return name.toString();</span>
    }

    /**
     * Returns the &quot;canonical string representation&quot; of the actions. That is,
     * this method always returns present actions in alphabetical order.
     *
     * @return the canonical string representation of the actions.
     */
    public String getActions() {

<span class="nc bnc" id="L480" title="All 2 branches missed.">        if (actions == null)</span>
<span class="nc" id="L481">            actions = getActions(this.mask);</span>

<span class="nc" id="L483">        return actions;</span>
    }

    /**
     * Returns the &quot;canonical string representation&quot;
     * of the actions from the mask.
     */
    private static String getActions(int mask) {
<span class="nc" id="L491">        final StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L492">        boolean comma = false;</span>

<span class="nc bnc" id="L494" title="All 2 branches missed.">        if ((mask &amp; AddNotificationListener) == AddNotificationListener) {</span>
<span class="nc" id="L495">            comma = true;</span>
<span class="nc" id="L496">            sb.append(&quot;addNotificationListener&quot;);</span>
        }

<span class="nc bnc" id="L499" title="All 2 branches missed.">        if ((mask &amp; GetAttribute) == GetAttribute) {</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L501">            else comma = true;</span>
<span class="nc" id="L502">            sb.append(&quot;getAttribute&quot;);</span>
        }

<span class="nc bnc" id="L505" title="All 2 branches missed.">        if ((mask &amp; GetClassLoader) == GetClassLoader) {</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L507">            else comma = true;</span>
<span class="nc" id="L508">            sb.append(&quot;getClassLoader&quot;);</span>
        }

<span class="nc bnc" id="L511" title="All 2 branches missed.">        if ((mask &amp; GetClassLoaderFor) == GetClassLoaderFor) {</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L513">            else comma = true;</span>
<span class="nc" id="L514">            sb.append(&quot;getClassLoaderFor&quot;);</span>
        }

<span class="nc bnc" id="L517" title="All 2 branches missed.">        if ((mask &amp; GetClassLoaderRepository) == GetClassLoaderRepository) {</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L519">            else comma = true;</span>
<span class="nc" id="L520">            sb.append(&quot;getClassLoaderRepository&quot;);</span>
        }

<span class="nc bnc" id="L523" title="All 2 branches missed.">        if ((mask &amp; GetDomains) == GetDomains) {</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L525">            else comma = true;</span>
<span class="nc" id="L526">            sb.append(&quot;getDomains&quot;);</span>
        }

<span class="nc bnc" id="L529" title="All 2 branches missed.">        if ((mask &amp; GetMBeanInfo) == GetMBeanInfo) {</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L531">            else comma = true;</span>
<span class="nc" id="L532">            sb.append(&quot;getMBeanInfo&quot;);</span>
        }

<span class="nc bnc" id="L535" title="All 2 branches missed.">        if ((mask &amp; GetObjectInstance) == GetObjectInstance) {</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L537">            else comma = true;</span>
<span class="nc" id="L538">            sb.append(&quot;getObjectInstance&quot;);</span>
        }

<span class="nc bnc" id="L541" title="All 2 branches missed.">        if ((mask &amp; Instantiate) == Instantiate) {</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L543">            else comma = true;</span>
<span class="nc" id="L544">            sb.append(&quot;instantiate&quot;);</span>
        }

<span class="nc bnc" id="L547" title="All 2 branches missed.">        if ((mask &amp; Invoke) == Invoke) {</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L549">            else comma = true;</span>
<span class="nc" id="L550">            sb.append(&quot;invoke&quot;);</span>
        }

<span class="nc bnc" id="L553" title="All 2 branches missed.">        if ((mask &amp; IsInstanceOf) == IsInstanceOf) {</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L555">            else comma = true;</span>
<span class="nc" id="L556">            sb.append(&quot;isInstanceOf&quot;);</span>
        }

<span class="nc bnc" id="L559" title="All 2 branches missed.">        if ((mask &amp; QueryMBeans) == QueryMBeans) {</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L561">            else comma = true;</span>
<span class="nc" id="L562">            sb.append(&quot;queryMBeans&quot;);</span>
        }

<span class="nc bnc" id="L565" title="All 2 branches missed.">        if ((mask &amp; QueryNames) == QueryNames) {</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L567">            else comma = true;</span>
<span class="nc" id="L568">            sb.append(&quot;queryNames&quot;);</span>
        }

<span class="nc bnc" id="L571" title="All 2 branches missed.">        if ((mask &amp; RegisterMBean) == RegisterMBean) {</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L573">            else comma = true;</span>
<span class="nc" id="L574">            sb.append(&quot;registerMBean&quot;);</span>
        }

<span class="nc bnc" id="L577" title="All 2 branches missed.">        if ((mask &amp; RemoveNotificationListener) == RemoveNotificationListener) {</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L579">            else comma = true;</span>
<span class="nc" id="L580">            sb.append(&quot;removeNotificationListener&quot;);</span>
        }

<span class="nc bnc" id="L583" title="All 2 branches missed.">        if ((mask &amp; SetAttribute) == SetAttribute) {</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L585">            else comma = true;</span>
<span class="nc" id="L586">            sb.append(&quot;setAttribute&quot;);</span>
        }

<span class="nc bnc" id="L589" title="All 2 branches missed.">        if ((mask &amp; UnregisterMBean) == UnregisterMBean) {</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">            if (comma) sb.append(',');</span>
<span class="nc" id="L591">            else comma = true;</span>
<span class="nc" id="L592">            sb.append(&quot;unregisterMBean&quot;);</span>
        }

<span class="nc" id="L595">        return sb.toString();</span>
    }

    /**
     * Returns the hash code value for this object.
     *
     * @return a hash code value for this object.
     */
    public int hashCode() {
<span class="nc" id="L604">        return this.getName().hashCode() + this.getActions().hashCode();</span>
    }

    /**
     * Converts an action String to an integer action mask.
     *
     * @param action the action string.
     * @return the action mask.
     */
    private static int getMask(String action) {

        /*
         * BE CAREFUL HERE! PARSING ORDER IS IMPORTANT IN THIS ALGORITHM.
         *
         * The 'string length' test must be performed for the lengthiest
         * strings first.
         *
         * In this permission if the &quot;unregisterMBean&quot; string length test is
         * performed after the &quot;registerMBean&quot; string length test the algorithm
         * considers the 'unregisterMBean' action as being the 'registerMBean'
         * action and a parsing error is returned.
         */

<span class="nc" id="L627">        int mask = NONE;</span>

<span class="nc bnc" id="L629" title="All 2 branches missed.">        if (action == null) {</span>
<span class="nc" id="L630">            return mask;</span>
        }

<span class="nc bnc" id="L633" title="All 2 branches missed.">        if (action.equals(&quot;*&quot;)) {</span>
<span class="nc" id="L634">            return ALL;</span>
        }

<span class="nc" id="L637">        char[] a = action.toCharArray();</span>

<span class="nc" id="L639">        int i = a.length - 1;</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">        if (i &lt; 0)</span>
<span class="nc" id="L641">            return mask;</span>

<span class="nc bnc" id="L643" title="All 2 branches missed.">        while (i != -1) {</span>
            char c;

            // skip whitespace
<span class="nc bnc" id="L647" title="All 12 branches missed.">            while ((i!=-1) &amp;&amp; ((c = a[i]) == ' ' ||</span>
                               c == '\r' ||
                               c == '\n' ||
                               c == '\f' ||
                               c == '\t'))
<span class="nc" id="L652">                i--;</span>

            // check for the known strings
            int matchlen;

<span class="nc bnc" id="L657" title="All 54 branches missed.">            if (i &gt;= 25 &amp;&amp; /* removeNotificationListener */</span>
                (a[i-25] == 'r') &amp;&amp;
                (a[i-24] == 'e') &amp;&amp;
                (a[i-23] == 'm') &amp;&amp;
                (a[i-22] == 'o') &amp;&amp;
                (a[i-21] == 'v') &amp;&amp;
                (a[i-20] == 'e') &amp;&amp;
                (a[i-19] == 'N') &amp;&amp;
                (a[i-18] == 'o') &amp;&amp;
                (a[i-17] == 't') &amp;&amp;
                (a[i-16] == 'i') &amp;&amp;
                (a[i-15] == 'f') &amp;&amp;
                (a[i-14] == 'i') &amp;&amp;
                (a[i-13] == 'c') &amp;&amp;
                (a[i-12] == 'a') &amp;&amp;
                (a[i-11] == 't') &amp;&amp;
                (a[i-10] == 'i') &amp;&amp;
                (a[i-9] == 'o') &amp;&amp;
                (a[i-8] == 'n') &amp;&amp;
                (a[i-7] == 'L') &amp;&amp;
                (a[i-6] == 'i') &amp;&amp;
                (a[i-5] == 's') &amp;&amp;
                (a[i-4] == 't') &amp;&amp;
                (a[i-3] == 'e') &amp;&amp;
                (a[i-2] == 'n') &amp;&amp;
                (a[i-1] == 'e') &amp;&amp;
                (a[i] == 'r')) {
<span class="nc" id="L684">                matchlen = 26;</span>
<span class="nc" id="L685">                mask |= RemoveNotificationListener;</span>
<span class="nc bnc" id="L686" title="All 50 branches missed.">            } else if (i &gt;= 23 &amp;&amp; /* getClassLoaderRepository */</span>
                       (a[i-23] == 'g') &amp;&amp;
                       (a[i-22] == 'e') &amp;&amp;
                       (a[i-21] == 't') &amp;&amp;
                       (a[i-20] == 'C') &amp;&amp;
                       (a[i-19] == 'l') &amp;&amp;
                       (a[i-18] == 'a') &amp;&amp;
                       (a[i-17] == 's') &amp;&amp;
                       (a[i-16] == 's') &amp;&amp;
                       (a[i-15] == 'L') &amp;&amp;
                       (a[i-14] == 'o') &amp;&amp;
                       (a[i-13] == 'a') &amp;&amp;
                       (a[i-12] == 'd') &amp;&amp;
                       (a[i-11] == 'e') &amp;&amp;
                       (a[i-10] == 'r') &amp;&amp;
                       (a[i-9] == 'R') &amp;&amp;
                       (a[i-8] == 'e') &amp;&amp;
                       (a[i-7] == 'p') &amp;&amp;
                       (a[i-6] == 'o') &amp;&amp;
                       (a[i-5] == 's') &amp;&amp;
                       (a[i-4] == 'i') &amp;&amp;
                       (a[i-3] == 't') &amp;&amp;
                       (a[i-2] == 'o') &amp;&amp;
                       (a[i-1] == 'r') &amp;&amp;
                       (a[i] == 'y')) {
<span class="nc" id="L711">                matchlen = 24;</span>
<span class="nc" id="L712">                mask |= GetClassLoaderRepository;</span>
<span class="nc bnc" id="L713" title="All 48 branches missed.">            } else if (i &gt;= 22 &amp;&amp; /* addNotificationListener */</span>
                       (a[i-22] == 'a') &amp;&amp;
                       (a[i-21] == 'd') &amp;&amp;
                       (a[i-20] == 'd') &amp;&amp;
                       (a[i-19] == 'N') &amp;&amp;
                       (a[i-18] == 'o') &amp;&amp;
                       (a[i-17] == 't') &amp;&amp;
                       (a[i-16] == 'i') &amp;&amp;
                       (a[i-15] == 'f') &amp;&amp;
                       (a[i-14] == 'i') &amp;&amp;
                       (a[i-13] == 'c') &amp;&amp;
                       (a[i-12] == 'a') &amp;&amp;
                       (a[i-11] == 't') &amp;&amp;
                       (a[i-10] == 'i') &amp;&amp;
                       (a[i-9] == 'o') &amp;&amp;
                       (a[i-8] == 'n') &amp;&amp;
                       (a[i-7] == 'L') &amp;&amp;
                       (a[i-6] == 'i') &amp;&amp;
                       (a[i-5] == 's') &amp;&amp;
                       (a[i-4] == 't') &amp;&amp;
                       (a[i-3] == 'e') &amp;&amp;
                       (a[i-2] == 'n') &amp;&amp;
                       (a[i-1] == 'e') &amp;&amp;
                       (a[i] == 'r')) {
<span class="nc" id="L737">                matchlen = 23;</span>
<span class="nc" id="L738">                mask |= AddNotificationListener;</span>
<span class="nc bnc" id="L739" title="All 36 branches missed.">            } else if (i &gt;= 16 &amp;&amp; /* getClassLoaderFor */</span>
                       (a[i-16] == 'g') &amp;&amp;
                       (a[i-15] == 'e') &amp;&amp;
                       (a[i-14] == 't') &amp;&amp;
                       (a[i-13] == 'C') &amp;&amp;
                       (a[i-12] == 'l') &amp;&amp;
                       (a[i-11] == 'a') &amp;&amp;
                       (a[i-10] == 's') &amp;&amp;
                       (a[i-9] == 's') &amp;&amp;
                       (a[i-8] == 'L') &amp;&amp;
                       (a[i-7] == 'o') &amp;&amp;
                       (a[i-6] == 'a') &amp;&amp;
                       (a[i-5] == 'd') &amp;&amp;
                       (a[i-4] == 'e') &amp;&amp;
                       (a[i-3] == 'r') &amp;&amp;
                       (a[i-2] == 'F') &amp;&amp;
                       (a[i-1] == 'o') &amp;&amp;
                       (a[i] == 'r')) {
<span class="nc" id="L757">                matchlen = 17;</span>
<span class="nc" id="L758">                mask |= GetClassLoaderFor;</span>
<span class="nc bnc" id="L759" title="All 36 branches missed.">            } else if (i &gt;= 16 &amp;&amp; /* getObjectInstance */</span>
                       (a[i-16] == 'g') &amp;&amp;
                       (a[i-15] == 'e') &amp;&amp;
                       (a[i-14] == 't') &amp;&amp;
                       (a[i-13] == 'O') &amp;&amp;
                       (a[i-12] == 'b') &amp;&amp;
                       (a[i-11] == 'j') &amp;&amp;
                       (a[i-10] == 'e') &amp;&amp;
                       (a[i-9] == 'c') &amp;&amp;
                       (a[i-8] == 't') &amp;&amp;
                       (a[i-7] == 'I') &amp;&amp;
                       (a[i-6] == 'n') &amp;&amp;
                       (a[i-5] == 's') &amp;&amp;
                       (a[i-4] == 't') &amp;&amp;
                       (a[i-3] == 'a') &amp;&amp;
                       (a[i-2] == 'n') &amp;&amp;
                       (a[i-1] == 'c') &amp;&amp;
                       (a[i] == 'e')) {
<span class="nc" id="L777">                matchlen = 17;</span>
<span class="nc" id="L778">                mask |= GetObjectInstance;</span>
<span class="nc bnc" id="L779" title="All 32 branches missed.">            } else if (i &gt;= 14 &amp;&amp; /* unregisterMBean */</span>
                       (a[i-14] == 'u') &amp;&amp;
                       (a[i-13] == 'n') &amp;&amp;
                       (a[i-12] == 'r') &amp;&amp;
                       (a[i-11] == 'e') &amp;&amp;
                       (a[i-10] == 'g') &amp;&amp;
                       (a[i-9] == 'i') &amp;&amp;
                       (a[i-8] == 's') &amp;&amp;
                       (a[i-7] == 't') &amp;&amp;
                       (a[i-6] == 'e') &amp;&amp;
                       (a[i-5] == 'r') &amp;&amp;
                       (a[i-4] == 'M') &amp;&amp;
                       (a[i-3] == 'B') &amp;&amp;
                       (a[i-2] == 'e') &amp;&amp;
                       (a[i-1] == 'a') &amp;&amp;
                       (a[i] == 'n')) {
<span class="nc" id="L795">                matchlen = 15;</span>
<span class="nc" id="L796">                mask |= UnregisterMBean;</span>
<span class="nc bnc" id="L797" title="All 30 branches missed.">            } else if (i &gt;= 13 &amp;&amp; /* getClassLoader */</span>
                       (a[i-13] == 'g') &amp;&amp;
                       (a[i-12] == 'e') &amp;&amp;
                       (a[i-11] == 't') &amp;&amp;
                       (a[i-10] == 'C') &amp;&amp;
                       (a[i-9] == 'l') &amp;&amp;
                       (a[i-8] == 'a') &amp;&amp;
                       (a[i-7] == 's') &amp;&amp;
                       (a[i-6] == 's') &amp;&amp;
                       (a[i-5] == 'L') &amp;&amp;
                       (a[i-4] == 'o') &amp;&amp;
                       (a[i-3] == 'a') &amp;&amp;
                       (a[i-2] == 'd') &amp;&amp;
                       (a[i-1] == 'e') &amp;&amp;
                       (a[i] == 'r')) {
<span class="nc" id="L812">                matchlen = 14;</span>
<span class="nc" id="L813">                mask |= GetClassLoader;</span>
<span class="nc bnc" id="L814" title="All 28 branches missed.">            } else if (i &gt;= 12 &amp;&amp; /* registerMBean */</span>
                       (a[i-12] == 'r') &amp;&amp;
                       (a[i-11] == 'e') &amp;&amp;
                       (a[i-10] == 'g') &amp;&amp;
                       (a[i-9] == 'i') &amp;&amp;
                       (a[i-8] == 's') &amp;&amp;
                       (a[i-7] == 't') &amp;&amp;
                       (a[i-6] == 'e') &amp;&amp;
                       (a[i-5] == 'r') &amp;&amp;
                       (a[i-4] == 'M') &amp;&amp;
                       (a[i-3] == 'B') &amp;&amp;
                       (a[i-2] == 'e') &amp;&amp;
                       (a[i-1] == 'a') &amp;&amp;
                       (a[i] == 'n')) {
<span class="nc" id="L828">                matchlen = 13;</span>
<span class="nc" id="L829">                mask |= RegisterMBean;</span>
<span class="nc bnc" id="L830" title="All 26 branches missed.">            } else if (i &gt;= 11 &amp;&amp; /* getAttribute */</span>
                       (a[i-11] == 'g') &amp;&amp;
                       (a[i-10] == 'e') &amp;&amp;
                       (a[i-9] == 't') &amp;&amp;
                       (a[i-8] == 'A') &amp;&amp;
                       (a[i-7] == 't') &amp;&amp;
                       (a[i-6] == 't') &amp;&amp;
                       (a[i-5] == 'r') &amp;&amp;
                       (a[i-4] == 'i') &amp;&amp;
                       (a[i-3] == 'b') &amp;&amp;
                       (a[i-2] == 'u') &amp;&amp;
                       (a[i-1] == 't') &amp;&amp;
                       (a[i] == 'e')) {
<span class="nc" id="L843">                matchlen = 12;</span>
<span class="nc" id="L844">                mask |= GetAttribute;</span>
<span class="nc bnc" id="L845" title="All 26 branches missed.">            } else if (i &gt;= 11 &amp;&amp; /* getMBeanInfo */</span>
                       (a[i-11] == 'g') &amp;&amp;
                       (a[i-10] == 'e') &amp;&amp;
                       (a[i-9] == 't') &amp;&amp;
                       (a[i-8] == 'M') &amp;&amp;
                       (a[i-7] == 'B') &amp;&amp;
                       (a[i-6] == 'e') &amp;&amp;
                       (a[i-5] == 'a') &amp;&amp;
                       (a[i-4] == 'n') &amp;&amp;
                       (a[i-3] == 'I') &amp;&amp;
                       (a[i-2] == 'n') &amp;&amp;
                       (a[i-1] == 'f') &amp;&amp;
                       (a[i] == 'o')) {
<span class="nc" id="L858">                matchlen = 12;</span>
<span class="nc" id="L859">                mask |= GetMBeanInfo;</span>
<span class="nc bnc" id="L860" title="All 26 branches missed.">            } else if (i &gt;= 11 &amp;&amp; /* isInstanceOf */</span>
                       (a[i-11] == 'i') &amp;&amp;
                       (a[i-10] == 's') &amp;&amp;
                       (a[i-9] == 'I') &amp;&amp;
                       (a[i-8] == 'n') &amp;&amp;
                       (a[i-7] == 's') &amp;&amp;
                       (a[i-6] == 't') &amp;&amp;
                       (a[i-5] == 'a') &amp;&amp;
                       (a[i-4] == 'n') &amp;&amp;
                       (a[i-3] == 'c') &amp;&amp;
                       (a[i-2] == 'e') &amp;&amp;
                       (a[i-1] == 'O') &amp;&amp;
                       (a[i] == 'f')) {
<span class="nc" id="L873">                matchlen = 12;</span>
<span class="nc" id="L874">                mask |= IsInstanceOf;</span>
<span class="nc bnc" id="L875" title="All 26 branches missed.">            } else if (i &gt;= 11 &amp;&amp; /* setAttribute */</span>
                       (a[i-11] == 's') &amp;&amp;
                       (a[i-10] == 'e') &amp;&amp;
                       (a[i-9] == 't') &amp;&amp;
                       (a[i-8] == 'A') &amp;&amp;
                       (a[i-7] == 't') &amp;&amp;
                       (a[i-6] == 't') &amp;&amp;
                       (a[i-5] == 'r') &amp;&amp;
                       (a[i-4] == 'i') &amp;&amp;
                       (a[i-3] == 'b') &amp;&amp;
                       (a[i-2] == 'u') &amp;&amp;
                       (a[i-1] == 't') &amp;&amp;
                       (a[i] == 'e')) {
<span class="nc" id="L888">                matchlen = 12;</span>
<span class="nc" id="L889">                mask |= SetAttribute;</span>
<span class="nc bnc" id="L890" title="All 24 branches missed.">            } else if (i &gt;= 10 &amp;&amp; /* instantiate */</span>
                       (a[i-10] == 'i') &amp;&amp;
                       (a[i-9] == 'n') &amp;&amp;
                       (a[i-8] == 's') &amp;&amp;
                       (a[i-7] == 't') &amp;&amp;
                       (a[i-6] == 'a') &amp;&amp;
                       (a[i-5] == 'n') &amp;&amp;
                       (a[i-4] == 't') &amp;&amp;
                       (a[i-3] == 'i') &amp;&amp;
                       (a[i-2] == 'a') &amp;&amp;
                       (a[i-1] == 't') &amp;&amp;
                       (a[i] == 'e')) {
<span class="nc" id="L902">                matchlen = 11;</span>
<span class="nc" id="L903">                mask |= Instantiate;</span>
<span class="nc bnc" id="L904" title="All 24 branches missed.">            } else if (i &gt;= 10 &amp;&amp; /* queryMBeans */</span>
                       (a[i-10] == 'q') &amp;&amp;
                       (a[i-9] == 'u') &amp;&amp;
                       (a[i-8] == 'e') &amp;&amp;
                       (a[i-7] == 'r') &amp;&amp;
                       (a[i-6] == 'y') &amp;&amp;
                       (a[i-5] == 'M') &amp;&amp;
                       (a[i-4] == 'B') &amp;&amp;
                       (a[i-3] == 'e') &amp;&amp;
                       (a[i-2] == 'a') &amp;&amp;
                       (a[i-1] == 'n') &amp;&amp;
                       (a[i] == 's')) {
<span class="nc" id="L916">                matchlen = 11;</span>
<span class="nc" id="L917">                mask |= QueryMBeans;</span>
<span class="nc bnc" id="L918" title="All 22 branches missed.">            } else if (i &gt;= 9 &amp;&amp; /* getDomains */</span>
                       (a[i-9] == 'g') &amp;&amp;
                       (a[i-8] == 'e') &amp;&amp;
                       (a[i-7] == 't') &amp;&amp;
                       (a[i-6] == 'D') &amp;&amp;
                       (a[i-5] == 'o') &amp;&amp;
                       (a[i-4] == 'm') &amp;&amp;
                       (a[i-3] == 'a') &amp;&amp;
                       (a[i-2] == 'i') &amp;&amp;
                       (a[i-1] == 'n') &amp;&amp;
                       (a[i] == 's')) {
<span class="nc" id="L929">                matchlen = 10;</span>
<span class="nc" id="L930">                mask |= GetDomains;</span>
<span class="nc bnc" id="L931" title="All 22 branches missed.">            } else if (i &gt;= 9 &amp;&amp; /* queryNames */</span>
                       (a[i-9] == 'q') &amp;&amp;
                       (a[i-8] == 'u') &amp;&amp;
                       (a[i-7] == 'e') &amp;&amp;
                       (a[i-6] == 'r') &amp;&amp;
                       (a[i-5] == 'y') &amp;&amp;
                       (a[i-4] == 'N') &amp;&amp;
                       (a[i-3] == 'a') &amp;&amp;
                       (a[i-2] == 'm') &amp;&amp;
                       (a[i-1] == 'e') &amp;&amp;
                       (a[i] == 's')) {
<span class="nc" id="L942">                matchlen = 10;</span>
<span class="nc" id="L943">                mask |= QueryNames;</span>
<span class="nc bnc" id="L944" title="All 14 branches missed.">            } else if (i &gt;= 5 &amp;&amp; /* invoke */</span>
                       (a[i-5] == 'i') &amp;&amp;
                       (a[i-4] == 'n') &amp;&amp;
                       (a[i-3] == 'v') &amp;&amp;
                       (a[i-2] == 'o') &amp;&amp;
                       (a[i-1] == 'k') &amp;&amp;
                       (a[i] == 'e')) {
<span class="nc" id="L951">                matchlen = 6;</span>
<span class="nc" id="L952">                mask |= Invoke;</span>
            } else {
                // parse error
<span class="nc" id="L955">                throw new IllegalArgumentException(&quot;Invalid permission: &quot; +</span>
                                                   action);
            }

            // make sure we didn't just match the tail of a word
            // like &quot;ackbarfaccept&quot;.  Also, skip to the comma.
<span class="nc" id="L961">            boolean seencomma = false;</span>
<span class="nc bnc" id="L962" title="All 4 branches missed.">            while (i &gt;= matchlen &amp;&amp; !seencomma) {</span>
<span class="nc bnc" id="L963" title="All 3 branches missed.">                switch(a[i-matchlen]) {</span>
                case ',':
<span class="nc" id="L965">                    seencomma = true;</span>
<span class="nc" id="L966">                    break;</span>
                case ' ': case '\r': case '\n':
                case '\f': case '\t':
<span class="nc" id="L969">                    break;</span>
                default:
<span class="nc" id="L971">                    throw new IllegalArgumentException(&quot;Invalid permission: &quot; +</span>
                                                       action);
                }
<span class="nc" id="L974">                i--;</span>
            }

            // point i at the location of the comma minus one (or -1).
<span class="nc" id="L978">            i -= matchlen;</span>
<span class="nc" id="L979">        }</span>

<span class="nc" id="L981">        return mask;</span>
    }

    /**
     * &lt;p&gt;Checks if this MBeanPermission object &quot;implies&quot; the
     * specified permission.&lt;/p&gt;
     *
     * &lt;p&gt;More specifically, this method returns true if:&lt;/p&gt;
     *
     * &lt;ul&gt;
     *
     * &lt;li&gt; &lt;i&gt;p&lt;/i&gt; is an instance of MBeanPermission; and&lt;/li&gt;
     *
     * &lt;li&gt; &lt;i&gt;p&lt;/i&gt; has a null className or &lt;i&gt;p&lt;/i&gt;'s className
     * matches this object's className; and&lt;/li&gt;
     *
     * &lt;li&gt; &lt;i&gt;p&lt;/i&gt; has a null member or &lt;i&gt;p&lt;/i&gt;'s member matches this
     * object's member; and&lt;/li&gt;
     *
     * &lt;li&gt; &lt;i&gt;p&lt;/i&gt; has a null object name or &lt;i&gt;p&lt;/i&gt;'s
     * object name matches this object's object name; and&lt;/li&gt;
     *
     * &lt;li&gt; &lt;i&gt;p&lt;/i&gt;'s actions are a subset of this object's actions&lt;/li&gt;
     *
     * &lt;/ul&gt;
     *
     * &lt;p&gt;If this object's className is &quot;&lt;code&gt;*&lt;/code&gt;&quot;, &lt;i&gt;p&lt;/i&gt;'s
     * className always matches it.  If it is &quot;&lt;code&gt;a.*&lt;/code&gt;&quot;, &lt;i&gt;p&lt;/i&gt;'s
     * className matches it if it begins with &quot;&lt;code&gt;a.&lt;/code&gt;&quot;.&lt;/p&gt;
     *
     * &lt;p&gt;If this object's member is &quot;&lt;code&gt;*&lt;/code&gt;&quot;, &lt;i&gt;p&lt;/i&gt;'s
     * member always matches it.&lt;/p&gt;
     *
     * &lt;p&gt;If this object's objectName &lt;i&gt;n1&lt;/i&gt; is an object name pattern,
     * &lt;i&gt;p&lt;/i&gt;'s objectName &lt;i&gt;n2&lt;/i&gt; matches it if
     * {@link ObjectName#equals &lt;i&gt;n1&lt;/i&gt;.equals(&lt;i&gt;n2&lt;/i&gt;)} or if
     * {@link ObjectName#apply &lt;i&gt;n1&lt;/i&gt;.apply(&lt;i&gt;n2&lt;/i&gt;)}.&lt;/p&gt;
     *
     * &lt;p&gt;A permission that includes the &lt;code&gt;queryMBeans&lt;/code&gt; action
     * is considered to include &lt;code&gt;queryNames&lt;/code&gt; as well.&lt;/p&gt;
     *
     * @param p the permission to check against.
     * @return true if the specified permission is implied by this object,
     * false if not.
     */
    public boolean implies(Permission p) {
<span class="nc bnc" id="L1027" title="All 2 branches missed.">        if (!(p instanceof MBeanPermission))</span>
<span class="nc" id="L1028">            return false;</span>

<span class="nc" id="L1030">        MBeanPermission that = (MBeanPermission) p;</span>

        // Actions
        //
        // The actions in 'this' permission must be a
        // superset of the actions in 'that' permission
        //

        /* &quot;queryMBeans&quot; implies &quot;queryNames&quot; */
<span class="nc bnc" id="L1039" title="All 2 branches missed.">        if ((this.mask &amp; QueryMBeans) == QueryMBeans) {</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">            if (((this.mask | QueryNames) &amp; that.mask) != that.mask) {</span>
                //System.out.println(&quot;action [with QueryNames] does not imply&quot;);
<span class="nc" id="L1042">                return false;</span>
            }
        } else {
<span class="nc bnc" id="L1045" title="All 2 branches missed.">            if ((this.mask &amp; that.mask) != that.mask) {</span>
                //System.out.println(&quot;action does not imply&quot;);
<span class="nc" id="L1047">                return false;</span>
            }
        }

        // Target name
        //
        // The 'className' check is true iff:
        // 1) the className in 'this' permission is omitted or &quot;*&quot;, or
        // 2) the className in 'that' permission is omitted or &quot;*&quot;, or
        // 3) the className in 'this' permission does pattern
        //    matching with the className in 'that' permission.
        //
        // The 'member' check is true iff:
        // 1) the member in 'this' permission is omitted or &quot;*&quot;, or
        // 2) the member in 'that' permission is omitted or &quot;*&quot;, or
        // 3) the member in 'this' permission equals the member in
        //    'that' permission.
        //
        // The 'object name' check is true iff:
        // 1) the object name in 'this' permission is omitted or &quot;*:*&quot;, or
        // 2) the object name in 'that' permission is omitted or &quot;*:*&quot;, or
        // 3) the object name in 'this' permission does pattern
        //    matching with the object name in 'that' permission.
        //

        /* Check if this.className implies that.className.

           If that.classNamePrefix is empty that means the className is
           irrelevant for this permission check.  Otherwise, we do not
           expect that &quot;that&quot; contains a wildcard, since it is a
           needed permission.  So we assume that.classNameExactMatch.  */

<span class="nc bnc" id="L1079" title="All 2 branches missed.">        if (that.classNamePrefix == null) {</span>
            // bottom is implied
<span class="nc bnc" id="L1081" title="All 2 branches missed.">        } else if (this.classNamePrefix == null) {</span>
            // bottom implies nothing but itself
<span class="nc" id="L1083">            return false;</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">        } else if (this.classNameExactMatch) {</span>
<span class="nc bnc" id="L1085" title="All 2 branches missed.">            if (!that.classNameExactMatch)</span>
<span class="nc" id="L1086">                return false; // exact never implies wildcard</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">            if (!that.classNamePrefix.equals(this.classNamePrefix))</span>
<span class="nc" id="L1088">                return false; // exact match fails</span>
        } else {
            // prefix match, works even if &quot;that&quot; is also a wildcard
            // e.g. a.* implies a.* and a.b.*
<span class="nc bnc" id="L1092" title="All 2 branches missed.">            if (!that.classNamePrefix.startsWith(this.classNamePrefix))</span>
<span class="nc" id="L1093">                return false;</span>
        }

        /* Check if this.member implies that.member */

<span class="nc bnc" id="L1098" title="All 2 branches missed.">        if (that.member == null) {</span>
            // bottom is implied
<span class="nc bnc" id="L1100" title="All 2 branches missed.">        } else if (this.member == null) {</span>
            // bottom implies nothing but itself
<span class="nc" id="L1102">            return false;</span>
<span class="nc bnc" id="L1103" title="All 2 branches missed.">        } else if (this.member.equals(&quot;*&quot;)) {</span>
            // wildcard implies everything (including itself)
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        } else if (!this.member.equals(that.member)) {</span>
<span class="nc" id="L1106">            return false;</span>
        }

        /* Check if this.objectName implies that.objectName */

<span class="nc bnc" id="L1111" title="All 2 branches missed.">        if (that.objectName == null) {</span>
            // bottom is implied
<span class="nc bnc" id="L1113" title="All 2 branches missed.">        } else if (this.objectName == null) {</span>
            // bottom implies nothing but itself
<span class="nc" id="L1115">            return false;</span>
<span class="nc bnc" id="L1116" title="All 2 branches missed.">        } else if (!this.objectName.apply(that.objectName)) {</span>
            /* ObjectName.apply returns false if that.objectName is a
               wildcard so we also allow equals for that case.  This
               never happens during real permission checks, but means
               the implies relation is reflexive.  */
<span class="nc bnc" id="L1121" title="All 2 branches missed.">            if (!this.objectName.equals(that.objectName))</span>
<span class="nc" id="L1122">                return false;</span>
        }

<span class="nc" id="L1125">        return true;</span>
    }

    /**
     * Checks two MBeanPermission objects for equality. Checks
     * that &lt;i&gt;obj&lt;/i&gt; is an MBeanPermission, and has the same
     * name and actions as this object.
     * &lt;P&gt;
     * @param obj the object we are testing for equality with this object.
     * @return true if obj is an MBeanPermission, and has the
     * same name and actions as this MBeanPermission object.
     */
    public boolean equals(Object obj) {
<span class="nc bnc" id="L1138" title="All 2 branches missed.">        if (obj == this)</span>
<span class="nc" id="L1139">            return true;</span>

<span class="nc bnc" id="L1141" title="All 2 branches missed.">        if (! (obj instanceof MBeanPermission))</span>
<span class="nc" id="L1142">            return false;</span>

<span class="nc" id="L1144">        MBeanPermission that = (MBeanPermission) obj;</span>

<span class="nc bnc" id="L1146" title="All 2 branches missed.">        return (this.mask == that.mask) &amp;&amp;</span>
<span class="nc bnc" id="L1147" title="All 2 branches missed.">            (this.getName().equals(that.getName()));</span>
    }

    /**
     * Deserialize this object based on its name and actions.
     */
    private void readObject(ObjectInputStream in)
            throws IOException, ClassNotFoundException {
<span class="nc" id="L1155">        in.defaultReadObject();</span>
<span class="nc" id="L1156">        parseName();</span>
<span class="nc" id="L1157">        parseActions();</span>
<span class="nc" id="L1158">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>