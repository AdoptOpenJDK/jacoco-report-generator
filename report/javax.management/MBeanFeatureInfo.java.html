<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MBeanFeatureInfo.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.management</a> &gt; <span class="el_source">MBeanFeatureInfo.java</span></div><h1>MBeanFeatureInfo.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.Serializable;
import java.io.StreamCorruptedException;
import java.util.Objects;

/**
 * &lt;p&gt;Provides general information for an MBean descriptor object.
 * The feature described can be an attribute, an operation, a
 * parameter, or a notification.  Instances of this class are
 * immutable.  Subclasses may be mutable but this is not
 * recommended.&lt;/p&gt;
 *
 * @since 1.5
 */
public class MBeanFeatureInfo implements Serializable, DescriptorRead {


    /* Serial version */
    static final long serialVersionUID = 3952882688968447265L;

    /**
     * The name of the feature.  It is recommended that subclasses call
     * {@link #getName} rather than reading this field, and that they
     * not change it.
     *
     * @serial The name of the feature.
     */
    protected String name;

    /**
     * The human-readable description of the feature.  It is
     * recommended that subclasses call {@link #getDescription} rather
     * than reading this field, and that they not change it.
     *
     * @serial The human-readable description of the feature.
     */
    protected String description;

    /**
     * @serial The Descriptor for this MBeanFeatureInfo.  This field
     * can be null, which is equivalent to an empty Descriptor.
     */
    private transient Descriptor descriptor;


    /**
     * Constructs an &lt;CODE&gt;MBeanFeatureInfo&lt;/CODE&gt; object.  This
     * constructor is equivalent to {@code MBeanFeatureInfo(name,
     * description, (Descriptor) null}.
     *
     * @param name The name of the feature.
     * @param description A human readable description of the feature.
     */
    public MBeanFeatureInfo(String name, String description) {
<span class="nc" id="L84">        this(name, description, null);</span>
<span class="nc" id="L85">    }</span>

    /**
     * Constructs an &lt;CODE&gt;MBeanFeatureInfo&lt;/CODE&gt; object.
     *
     * @param name The name of the feature.
     * @param description A human readable description of the feature.
     * @param descriptor The descriptor for the feature.  This may be null
     * which is equivalent to an empty descriptor.
     *
     * @since 1.6
     */
    public MBeanFeatureInfo(String name, String description,
<span class="nc" id="L98">                            Descriptor descriptor) {</span>
<span class="nc" id="L99">        this.name = name;</span>
<span class="nc" id="L100">        this.description = description;</span>
<span class="nc" id="L101">        this.descriptor = descriptor;</span>
<span class="nc" id="L102">    }</span>

    /**
     * Returns the name of the feature.
     *
     * @return the name of the feature.
     */
    public String getName() {
<span class="nc" id="L110">        return name;</span>
    }

    /**
     * Returns the human-readable description of the feature.
     *
     * @return the human-readable description of the feature.
     */
    public String getDescription() {
<span class="nc" id="L119">        return description;</span>
    }

    /**
     * Returns the descriptor for the feature.  Changing the returned value
     * will have no affect on the original descriptor.
     *
     * @return a descriptor that is either immutable or a copy of the original.
     *
     * @since 1.6
     */
    public Descriptor getDescriptor() {
<span class="nc" id="L131">        return (Descriptor) ImmutableDescriptor.nonNullDescriptor(descriptor).clone();</span>
    }

    /**
     * Compare this MBeanFeatureInfo to another.
     *
     * @param o the object to compare to.
     *
     * @return true if and only if &lt;code&gt;o&lt;/code&gt; is an MBeanFeatureInfo such
     * that its {@link #getName()}, {@link #getDescription()}, and
     * {@link #getDescriptor()}
     * values are equal (not necessarily identical) to those of this
     * MBeanFeatureInfo.
     */
    public boolean equals(Object o) {
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (o == this)</span>
<span class="nc" id="L147">            return true;</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (!(o instanceof MBeanFeatureInfo))</span>
<span class="nc" id="L149">            return false;</span>
<span class="nc" id="L150">        MBeanFeatureInfo p = (MBeanFeatureInfo) o;</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">        return (Objects.equals(p.getName(), getName()) &amp;&amp;</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">                Objects.equals(p.getDescription(), getDescription()) &amp;&amp;</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                Objects.equals(p.getDescriptor(), getDescriptor()));</span>
    }

    public int hashCode() {
<span class="nc" id="L157">        return getName().hashCode() ^ getDescription().hashCode() ^</span>
<span class="nc" id="L158">               getDescriptor().hashCode();</span>
    }

    /**
     * Serializes an {@link MBeanFeatureInfo} to an {@link ObjectOutputStream}.
     * @serialData
     * For compatibility reasons, an object of this class is serialized as follows.
     * &lt;p&gt;
     * The method {@link ObjectOutputStream#defaultWriteObject defaultWriteObject()}
     * is called first to serialize the object except the field {@code descriptor}
     * which is declared as transient. The field {@code descriptor} is serialized
     * as follows:
     *     &lt;ul&gt;
     *     &lt;li&gt;If {@code descriptor} is an instance of the class
     *        {@link ImmutableDescriptor}, the method {@link ObjectOutputStream#write
     *        write(int val)} is called to write a byte with the value {@code 1},
     *        then the method {@link ObjectOutputStream#writeObject writeObject(Object obj)}
     *        is called twice to serialize the field names and the field values of the
     *        {@code descriptor}, respectively as a {@code String[]} and an
     *        {@code Object[]};&lt;/li&gt;
     *     &lt;li&gt;Otherwise, the method {@link ObjectOutputStream#write write(int val)}
     * is called to write a byte with the value {@code 0}, then the method
     * {@link ObjectOutputStream#writeObject writeObject(Object obj)} is called
     * to serialize directly the field {@code descriptor}.
     *     &lt;/ul&gt;
     *
     * @since 1.6
     */
    private void writeObject(ObjectOutputStream out) throws IOException {
<span class="nc" id="L187">        out.defaultWriteObject();</span>

<span class="nc bnc" id="L189" title="All 2 branches missed.">        if (descriptor != null &amp;&amp;</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            descriptor.getClass() == ImmutableDescriptor.class) {</span>

<span class="nc" id="L192">            out.write(1);</span>

<span class="nc" id="L194">            final String[] names = descriptor.getFieldNames();</span>

<span class="nc" id="L196">            out.writeObject(names);</span>
<span class="nc" id="L197">            out.writeObject(descriptor.getFieldValues(names));</span>
<span class="nc" id="L198">        } else {</span>
<span class="nc" id="L199">            out.write(0);</span>

<span class="nc" id="L201">            out.writeObject(descriptor);</span>
        }
<span class="nc" id="L203">    }</span>

    /**
     * Deserializes an {@link MBeanFeatureInfo} from an {@link ObjectInputStream}.
     * @serialData
     * For compatibility reasons, an object of this class is deserialized as follows.
     * &lt;p&gt;
     * The method {@link ObjectInputStream#defaultReadObject defaultReadObject()}
     * is called first to deserialize the object except the field
     * {@code descriptor}, which is not serialized in the default way. Then the method
     * {@link ObjectInputStream#read read()} is called to read a byte, the field
     * {@code descriptor} is deserialized according to the value of the byte value:
     *    &lt;ul&gt;
     *    &lt;li&gt;1. The method {@link ObjectInputStream#readObject readObject()}
     *       is called twice to obtain the field names (a {@code String[]}) and
     *       the field values (a {@code Object[]}) of the {@code descriptor}.
     *       The two obtained values then are used to construct
     *       an {@link ImmutableDescriptor} instance for the field
     *       {@code descriptor};&lt;/li&gt;
     *    &lt;li&gt;0. The value for the field {@code descriptor} is obtained directly
     *       by calling the method {@link ObjectInputStream#readObject readObject()}.
     *       If the obtained value is null, the field {@code descriptor} is set to
     *       {@link ImmutableDescriptor#EMPTY_DESCRIPTOR EMPTY_DESCRIPTOR};&lt;/li&gt;
     *    &lt;li&gt;-1. This means that there is no byte to read and that the object is from
     *       an earlier version of the JMX API. The field {@code descriptor} is set
     *       to {@link ImmutableDescriptor#EMPTY_DESCRIPTOR EMPTY_DESCRIPTOR}&lt;/li&gt;
     *    &lt;li&gt;Any other value. A {@link StreamCorruptedException} is thrown.&lt;/li&gt;
     *    &lt;/ul&gt;
     *
     * @since 1.6
     */
    private void readObject(ObjectInputStream in)
        throws IOException, ClassNotFoundException {

<span class="nc" id="L237">        in.defaultReadObject();</span>

<span class="nc bnc" id="L239" title="All 4 branches missed.">        switch (in.read()) {</span>
        case 1:
<span class="nc" id="L241">            final String[] names = (String[])in.readObject();</span>

<span class="nc" id="L243">            final Object[] values = (Object[]) in.readObject();</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">            descriptor = (names.length == 0) ?</span>
                ImmutableDescriptor.EMPTY_DESCRIPTOR :
                new ImmutableDescriptor(names, values);

<span class="nc" id="L248">            break;</span>
        case 0:
<span class="nc" id="L250">            descriptor = (Descriptor)in.readObject();</span>

<span class="nc bnc" id="L252" title="All 2 branches missed.">            if (descriptor == null) {</span>
<span class="nc" id="L253">                descriptor = ImmutableDescriptor.EMPTY_DESCRIPTOR;</span>
            }

            break;
        case -1: // from an earlier version of the JMX API
<span class="nc" id="L258">            descriptor = ImmutableDescriptor.EMPTY_DESCRIPTOR;</span>

<span class="nc" id="L260">            break;</span>
        default:
<span class="nc" id="L262">            throw new StreamCorruptedException(&quot;Got unexpected byte.&quot;);</span>
        }
<span class="nc" id="L264">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>