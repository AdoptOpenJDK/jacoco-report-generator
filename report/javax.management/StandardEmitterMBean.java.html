<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>StandardEmitterMBean.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.management</a> &gt; <span class="el_source">StandardEmitterMBean.java</span></div><h1>StandardEmitterMBean.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2005, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management;

/**
 * &lt;p&gt;An MBean whose management interface is determined by reflection
 * on a Java interface, and that emits notifications.&lt;/p&gt;
 *
 * &lt;p&gt;The following example shows how to use the public constructor
 * {@link #StandardEmitterMBean(Object, Class, NotificationEmitter)
 * StandardEmitterMBean(implementation, mbeanInterface, emitter)} to
 * create an MBean emitting notifications with any
 * implementation class name &lt;i&gt;Impl&lt;/i&gt;, with a management
 * interface defined (as for current Standard MBeans) by any interface
 * &lt;i&gt;Intf&lt;/i&gt;, and with any implementation of the interface
 * {@link NotificationEmitter}. The example uses the class
 * {@link NotificationBroadcasterSupport} as an implementation
 * of the interface {@link NotificationEmitter}.&lt;/p&gt;
 *
 *     &lt;pre&gt;
 *     MBeanServer mbs;
 *     ...
 *     final String[] types = new String[] {&quot;sun.disc.space&quot;,&quot;sun.disc.alarm&quot;};
 *     final MBeanNotificationInfo info = new MBeanNotificationInfo(
 *                                          types,
 *                                          Notification.class.getName(),
 *                                          &quot;Notification about disc info.&quot;);
 *     final NotificationEmitter emitter =
 *                    new NotificationBroadcasterSupport(info);
 *
 *     final Intf impl = new Impl(...);
 *     final Object mbean = new StandardEmitterMBean(
 *                                     impl, Intf.class, emitter);
 *     mbs.registerMBean(mbean, objectName);
 *     &lt;/pre&gt;
 *
 * @see StandardMBean
 *
 * @since 1.6
 */
public class StandardEmitterMBean extends StandardMBean
        implements NotificationEmitter {

<span class="nc" id="L67">    private static final MBeanNotificationInfo[] NO_NOTIFICATION_INFO =</span>
        new MBeanNotificationInfo[0];

    private final NotificationEmitter emitter;
    private final MBeanNotificationInfo[] notificationInfo;

    /**
     * &lt;p&gt;Make an MBean whose management interface is specified by
     * {@code mbeanInterface}, with the given implementation and
     * where notifications are handled by the given {@code NotificationEmitter}.
     * The resultant MBean implements the {@code NotificationEmitter} interface
     * by forwarding its methods to {@code emitter}.  It is legal and useful
     * for {@code implementation} and {@code emitter} to be the same object.&lt;/p&gt;
     *
     * &lt;p&gt;If {@code emitter} is an instance of {@code
     * NotificationBroadcasterSupport} then the MBean's {@link #sendNotification
     * sendNotification} method will call {@code emitter.}{@link
     * NotificationBroadcasterSupport#sendNotification sendNotification}.&lt;/p&gt;
     *
     * &lt;p&gt;The array returned by {@link #getNotificationInfo()} on the
     * new MBean is a copy of the array returned by
     * {@code emitter.}{@link NotificationBroadcaster#getNotificationInfo
     * getNotificationInfo()} at the time of construction.  If the array
     * returned by {@code emitter.getNotificationInfo()} later changes,
     * that will have no effect on this object's
     * {@code getNotificationInfo()}.&lt;/p&gt;
     *
     * @param implementation the implementation of the MBean interface.
     * @param mbeanInterface a Standard MBean interface.
     * @param emitter the object that will handle notifications.
     *
     * @throws IllegalArgumentException if the {@code mbeanInterface}
     *    does not follow JMX design patterns for Management Interfaces, or
     *    if the given {@code implementation} does not implement the
     *    specified interface, or if {@code emitter} is null.
     */
    public &lt;T&gt; StandardEmitterMBean(T implementation, Class&lt;T&gt; mbeanInterface,
                                    NotificationEmitter emitter) {
<span class="nc" id="L105">        this(implementation, mbeanInterface, false, emitter);</span>
<span class="nc" id="L106">    }</span>

    /**
     * &lt;p&gt;Make an MBean whose management interface is specified by
     * {@code mbeanInterface}, with the given implementation and where
     * notifications are handled by the given {@code
     * NotificationEmitter}.  This constructor can be used to make
     * either Standard MBeans or MXBeans.  The resultant MBean
     * implements the {@code NotificationEmitter} interface by
     * forwarding its methods to {@code emitter}.  It is legal and
     * useful for {@code implementation} and {@code emitter} to be the
     * same object.&lt;/p&gt;
     *
     * &lt;p&gt;If {@code emitter} is an instance of {@code
     * NotificationBroadcasterSupport} then the MBean's {@link #sendNotification
     * sendNotification} method will call {@code emitter.}{@link
     * NotificationBroadcasterSupport#sendNotification sendNotification}.&lt;/p&gt;
     *
     * &lt;p&gt;The array returned by {@link #getNotificationInfo()} on the
     * new MBean is a copy of the array returned by
     * {@code emitter.}{@link NotificationBroadcaster#getNotificationInfo
     * getNotificationInfo()} at the time of construction.  If the array
     * returned by {@code emitter.getNotificationInfo()} later changes,
     * that will have no effect on this object's
     * {@code getNotificationInfo()}.&lt;/p&gt;
     *
     * @param implementation the implementation of the MBean interface.
     * @param mbeanInterface a Standard MBean interface.
     * @param isMXBean If true, the {@code mbeanInterface} parameter
     * names an MXBean interface and the resultant MBean is an MXBean.
     * @param emitter the object that will handle notifications.
     *
     * @throws IllegalArgumentException if the {@code mbeanInterface}
     *    does not follow JMX design patterns for Management Interfaces, or
     *    if the given {@code implementation} does not implement the
     *    specified interface, or if {@code emitter} is null.
     */
    public &lt;T&gt; StandardEmitterMBean(T implementation, Class&lt;T&gt; mbeanInterface,
                                    boolean isMXBean,
                                    NotificationEmitter emitter) {
<span class="nc" id="L146">        super(implementation, mbeanInterface, isMXBean);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (emitter == null)</span>
<span class="nc" id="L148">            throw new IllegalArgumentException(&quot;Null emitter&quot;);</span>
<span class="nc" id="L149">        this.emitter = emitter;</span>
<span class="nc" id="L150">        MBeanNotificationInfo[] infos = emitter.getNotificationInfo();</span>
<span class="nc bnc" id="L151" title="All 4 branches missed.">        if (infos == null || infos.length == 0) {</span>
<span class="nc" id="L152">            this.notificationInfo = NO_NOTIFICATION_INFO;</span>
        } else {
<span class="nc" id="L154">            this.notificationInfo = infos.clone();</span>
        }
<span class="nc" id="L156">    }</span>

    /**
     * &lt;p&gt;Make an MBean whose management interface is specified by
     * {@code mbeanInterface}, and
     * where notifications are handled by the given {@code NotificationEmitter}.
     * The resultant MBean implements the {@code NotificationEmitter} interface
     * by forwarding its methods to {@code emitter}.&lt;/p&gt;
     *
     * &lt;p&gt;If {@code emitter} is an instance of {@code
     * NotificationBroadcasterSupport} then the MBean's {@link #sendNotification
     * sendNotification} method will call {@code emitter.}{@link
     * NotificationBroadcasterSupport#sendNotification sendNotification}.&lt;/p&gt;
     *
     * &lt;p&gt;The array returned by {@link #getNotificationInfo()} on the
     * new MBean is a copy of the array returned by
     * {@code emitter.}{@link NotificationBroadcaster#getNotificationInfo
     * getNotificationInfo()} at the time of construction.  If the array
     * returned by {@code emitter.getNotificationInfo()} later changes,
     * that will have no effect on this object's
     * {@code getNotificationInfo()}.&lt;/p&gt;
     *
     * &lt;p&gt;This constructor must be called from a subclass that implements
     * the given {@code mbeanInterface}.&lt;/p&gt;
     *
     * @param mbeanInterface a StandardMBean interface.
     * @param emitter the object that will handle notifications.
     *
     * @throws IllegalArgumentException if the {@code mbeanInterface}
     *    does not follow JMX design patterns for Management Interfaces, or
     *    if {@code this} does not implement the specified interface, or
     *    if {@code emitter} is null.
     */
    protected StandardEmitterMBean(Class&lt;?&gt; mbeanInterface,
                                   NotificationEmitter emitter) {
<span class="nc" id="L191">        this(mbeanInterface, false, emitter);</span>
<span class="nc" id="L192">    }</span>

    /**
     * &lt;p&gt;Make an MBean whose management interface is specified by
     * {@code mbeanInterface}, and where notifications are handled by
     * the given {@code NotificationEmitter}.  This constructor can be
     * used to make either Standard MBeans or MXBeans.  The resultant
     * MBean implements the {@code NotificationEmitter} interface by
     * forwarding its methods to {@code emitter}.&lt;/p&gt;
     *
     * &lt;p&gt;If {@code emitter} is an instance of {@code
     * NotificationBroadcasterSupport} then the MBean's {@link #sendNotification
     * sendNotification} method will call {@code emitter.}{@link
     * NotificationBroadcasterSupport#sendNotification sendNotification}.&lt;/p&gt;
     *
     * &lt;p&gt;The array returned by {@link #getNotificationInfo()} on the
     * new MBean is a copy of the array returned by
     * {@code emitter.}{@link NotificationBroadcaster#getNotificationInfo
     * getNotificationInfo()} at the time of construction.  If the array
     * returned by {@code emitter.getNotificationInfo()} later changes,
     * that will have no effect on this object's
     * {@code getNotificationInfo()}.&lt;/p&gt;
     *
     * &lt;p&gt;This constructor must be called from a subclass that implements
     * the given {@code mbeanInterface}.&lt;/p&gt;
     *
     * @param mbeanInterface a StandardMBean interface.
     * @param isMXBean If true, the {@code mbeanInterface} parameter
     * names an MXBean interface and the resultant MBean is an MXBean.
     * @param emitter the object that will handle notifications.
     *
     * @throws IllegalArgumentException if the {@code mbeanInterface}
     *    does not follow JMX design patterns for Management Interfaces, or
     *    if {@code this} does not implement the specified interface, or
     *    if {@code emitter} is null.
     */
    protected StandardEmitterMBean(Class&lt;?&gt; mbeanInterface, boolean isMXBean,
                                   NotificationEmitter emitter) {
<span class="nc" id="L230">        super(mbeanInterface, isMXBean);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">        if (emitter == null)</span>
<span class="nc" id="L232">            throw new IllegalArgumentException(&quot;Null emitter&quot;);</span>
<span class="nc" id="L233">        this.emitter = emitter;</span>
<span class="nc" id="L234">        MBeanNotificationInfo[] infos = emitter.getNotificationInfo();</span>
<span class="nc bnc" id="L235" title="All 4 branches missed.">        if (infos == null || infos.length == 0) {</span>
<span class="nc" id="L236">            this.notificationInfo = NO_NOTIFICATION_INFO;</span>
        } else {
<span class="nc" id="L238">            this.notificationInfo = infos.clone();</span>
        }
<span class="nc" id="L240">    }</span>

    public void removeNotificationListener(NotificationListener listener)
            throws ListenerNotFoundException {
<span class="nc" id="L244">        emitter.removeNotificationListener(listener);</span>
<span class="nc" id="L245">    }</span>

    public void removeNotificationListener(NotificationListener listener,
                                           NotificationFilter filter,
                                           Object handback)
            throws ListenerNotFoundException {
<span class="nc" id="L251">        emitter.removeNotificationListener(listener, filter, handback);</span>
<span class="nc" id="L252">    }</span>

    public void addNotificationListener(NotificationListener listener,
                                        NotificationFilter filter,
                                        Object handback) {
<span class="nc" id="L257">        emitter.addNotificationListener(listener, filter, handback);</span>
<span class="nc" id="L258">    }</span>

    public MBeanNotificationInfo[] getNotificationInfo() {
        // this getter might get called from the super constructor
        // when the notificationInfo has not been properly set yet
<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (notificationInfo == null) {</span>
<span class="nc" id="L264">            return NO_NOTIFICATION_INFO;</span>
        }
<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (notificationInfo.length == 0) {</span>
<span class="nc" id="L267">            return notificationInfo;</span>
        } else {
<span class="nc" id="L269">            return notificationInfo.clone();</span>
        }
    }

    /**
     * &lt;p&gt;Sends a notification.&lt;/p&gt;
     *
     * &lt;p&gt;If the {@code emitter} parameter to the constructor was an
     * instance of {@code NotificationBroadcasterSupport} then this
     * method will call {@code emitter.}{@link
     * NotificationBroadcasterSupport#sendNotification
     * sendNotification}.&lt;/p&gt;
     *
     * @param n the notification to send.
     *
     * @throws ClassCastException if the {@code emitter} parameter to the
     * constructor was not a {@code NotificationBroadcasterSupport}.
     */
    public void sendNotification(Notification n) {
<span class="nc bnc" id="L288" title="All 2 branches missed.">        if (emitter instanceof NotificationBroadcasterSupport)</span>
<span class="nc" id="L289">            ((NotificationBroadcasterSupport) emitter).sendNotification(n);</span>
        else {
<span class="nc" id="L291">            final String msg =</span>
                &quot;Cannot sendNotification when emitter is not an &quot; +
                &quot;instance of NotificationBroadcasterSupport: &quot; +
<span class="nc" id="L294">                emitter.getClass().getName();</span>
<span class="nc" id="L295">            throw new ClassCastException(msg);</span>
        }
<span class="nc" id="L297">    }</span>

    /**
     * &lt;p&gt;Get the MBeanNotificationInfo[] that will be used in the
     * MBeanInfo returned by this MBean.&lt;/p&gt;
     *
     * &lt;p&gt;The default implementation of this method returns
     * {@link #getNotificationInfo()}.&lt;/p&gt;
     *
     * @param info The default MBeanInfo derived by reflection.
     * @return the MBeanNotificationInfo[] for the new MBeanInfo.
     */
    @Override
    MBeanNotificationInfo[] getNotifications(MBeanInfo info) {
<span class="nc" id="L311">        return getNotificationInfo();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>