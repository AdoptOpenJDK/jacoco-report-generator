<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MBeanAttributeInfo.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.management</a> &gt; <span class="el_source">MBeanAttributeInfo.java</span></div><h1>MBeanAttributeInfo.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management;

import java.lang.reflect.Method;
import java.security.AccessController;

import com.sun.jmx.mbeanserver.GetPropertyAction;
import com.sun.jmx.mbeanserver.Introspector;
import java.util.Objects;


/**
 * Describes an MBean attribute exposed for management.  Instances of
 * this class are immutable.  Subclasses may be mutable but this is
 * not recommended.
 *
 * @since 1.5
 */
@SuppressWarnings(&quot;serial&quot;)  // serialVersionUID not constant
public class MBeanAttributeInfo extends MBeanFeatureInfo implements Cloneable {

    /* Serial version */
    private static final long serialVersionUID;
    static {
        /* For complicated reasons, the serialVersionUID changed
           between JMX 1.0 and JMX 1.1, even though JMX 1.1 did not
           have compatibility code for this class.  So the
           serialization produced by this class with JMX 1.2 and
           jmx.serial.form=1.0 is not the same as that produced by
           this class with JMX 1.1 and jmx.serial.form=1.0.  However,
           the serialization without that property is the same, and
           that is the only form required by JMX 1.2.
        */
<span class="nc" id="L58">        long uid = 8644704819898565848L;</span>
        try {
<span class="nc" id="L60">            GetPropertyAction act = new GetPropertyAction(&quot;jmx.serial.form&quot;);</span>
<span class="nc" id="L61">            String form = AccessController.doPrivileged(act);</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">            if (&quot;1.0&quot;.equals(form))</span>
<span class="nc" id="L63">                uid = 7043855487133450673L;</span>
<span class="nc" id="L64">        } catch (Exception e) {</span>
            // OK: exception means no compat with 1.0, too bad
<span class="nc" id="L66">        }</span>
<span class="nc" id="L67">        serialVersionUID = uid;</span>
    }

<span class="nc" id="L70">    static final MBeanAttributeInfo[] NO_ATTRIBUTES =</span>
        new MBeanAttributeInfo[0];

    /**
     * @serial The actual attribute type.
     */
    private final String attributeType;

    /**
     * @serial The attribute write right.
     */
    private final boolean isWrite;

    /**
     * @serial The attribute read right.
     */
    private final boolean isRead;

    /**
     * @serial Indicates if this method is a &quot;is&quot;
     */
    private final boolean is;


    /**
     * Constructs an &lt;CODE&gt;MBeanAttributeInfo&lt;/CODE&gt; object.
     *
     * @param name The name of the attribute.
     * @param type The type or class name of the attribute.
     * @param description A human readable description of the attribute.
     * @param isReadable True if the attribute has a getter method, false otherwise.
     * @param isWritable True if the attribute has a setter method, false otherwise.
     * @param isIs True if this attribute has an &quot;is&quot; getter, false otherwise.
     *
     * @throws IllegalArgumentException if {@code isIs} is true but
     * {@code isReadable} is not, or if {@code isIs} is true and
     * {@code type} is not {@code boolean} or {@code java.lang.Boolean}.
     * (New code should always use {@code boolean} rather than
     * {@code java.lang.Boolean}.)
     */
    public MBeanAttributeInfo(String name,
                              String type,
                              String description,
                              boolean isReadable,
                              boolean isWritable,
                              boolean isIs) {
<span class="nc" id="L116">        this(name, type, description, isReadable, isWritable, isIs,</span>
             (Descriptor) null);
<span class="nc" id="L118">    }</span>

    /**
     * Constructs an &lt;CODE&gt;MBeanAttributeInfo&lt;/CODE&gt; object.
     *
     * @param name The name of the attribute.
     * @param type The type or class name of the attribute.
     * @param description A human readable description of the attribute.
     * @param isReadable True if the attribute has a getter method, false otherwise.
     * @param isWritable True if the attribute has a setter method, false otherwise.
     * @param isIs True if this attribute has an &quot;is&quot; getter, false otherwise.
     * @param descriptor The descriptor for the attribute.  This may be null
     * which is equivalent to an empty descriptor.
     *
     * @throws IllegalArgumentException if {@code isIs} is true but
     * {@code isReadable} is not, or if {@code isIs} is true and
     * {@code type} is not {@code boolean} or {@code java.lang.Boolean}.
     * (New code should always use {@code boolean} rather than
     * {@code java.lang.Boolean}.)
     *
     * @since 1.6
     */
    public MBeanAttributeInfo(String name,
                              String type,
                              String description,
                              boolean isReadable,
                              boolean isWritable,
                              boolean isIs,
                              Descriptor descriptor) {
<span class="nc" id="L147">        super(name, description, descriptor);</span>

<span class="nc" id="L149">        this.attributeType = type;</span>
<span class="nc" id="L150">        this.isRead = isReadable;</span>
<span class="nc" id="L151">        this.isWrite = isWritable;</span>
<span class="nc bnc" id="L152" title="All 4 branches missed.">        if (isIs &amp;&amp; !isReadable) {</span>
<span class="nc" id="L153">            throw new IllegalArgumentException(&quot;Cannot have an \&quot;is\&quot; getter &quot; +</span>
                                               &quot;for a non-readable attribute&quot;);
        }
<span class="nc bnc" id="L156" title="All 4 branches missed.">        if (isIs &amp;&amp; !type.equals(&quot;java.lang.Boolean&quot;) &amp;&amp;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                !type.equals(&quot;boolean&quot;)) {</span>
<span class="nc" id="L158">            throw new IllegalArgumentException(&quot;Cannot have an \&quot;is\&quot; getter &quot; +</span>
                                               &quot;for a non-boolean attribute&quot;);
        }
<span class="nc" id="L161">        this.is = isIs;</span>
<span class="nc" id="L162">    }</span>

    /**
     * &lt;p&gt;This constructor takes the name of a simple attribute, and Method
     * objects for reading and writing the attribute.  The {@link Descriptor}
     * of the constructed object will include fields contributed by any
     * annotations on the {@code Method} objects that contain the
     * {@link DescriptorKey} meta-annotation.
     *
     * @param name The programmatic name of the attribute.
     * @param description A human readable description of the attribute.
     * @param getter The method used for reading the attribute value.
     *          May be null if the property is write-only.
     * @param setter The method used for writing the attribute value.
     *          May be null if the attribute is read-only.
     * @exception IntrospectionException There is a consistency
     * problem in the definition of this attribute.
     */
    public MBeanAttributeInfo(String name,
                              String description,
                              Method getter,
                              Method setter) throws IntrospectionException {
<span class="nc" id="L184">        this(name,</span>
<span class="nc bnc" id="L185" title="All 4 branches missed.">             attributeType(getter, setter),</span>
             description,
             (getter != null),
             (setter != null),
<span class="nc" id="L189">             isIs(getter),</span>
<span class="nc" id="L190">             ImmutableDescriptor.union(Introspector.descriptorForElement(getter),</span>
<span class="nc" id="L191">                                   Introspector.descriptorForElement(setter)));</span>
<span class="nc" id="L192">    }</span>

    /**
     * &lt;p&gt;Returns a shallow clone of this instance.
     * The clone is obtained by simply calling &lt;tt&gt;super.clone()&lt;/tt&gt;,
     * thus calling the default native shallow cloning mechanism
     * implemented by &lt;tt&gt;Object.clone()&lt;/tt&gt;.
     * No deeper cloning of any internal field is made.&lt;/p&gt;
     *
     * &lt;p&gt;Since this class is immutable, cloning is chiefly of
     * interest to subclasses.&lt;/p&gt;
     */
     public Object clone () {
         try {
<span class="nc" id="L206">             return super.clone() ;</span>
<span class="nc" id="L207">         } catch (CloneNotSupportedException e) {</span>
             // should not happen as this class is cloneable
<span class="nc" id="L209">             return null;</span>
         }
     }

    /**
     * Returns the class name of the attribute.
     *
     * @return the class name.
     */
    public String getType() {
<span class="nc" id="L219">        return attributeType;</span>
    }

    /**
     * Whether the value of the attribute can be read.
     *
     * @return True if the attribute can be read, false otherwise.
     */
    public boolean isReadable() {
<span class="nc" id="L228">        return isRead;</span>
    }

    /**
     * Whether new values can be written to the attribute.
     *
     * @return True if the attribute can be written to, false otherwise.
     */
    public boolean isWritable() {
<span class="nc" id="L237">        return isWrite;</span>
    }

    /**
     * Indicates if this attribute has an &quot;is&quot; getter.
     *
     * @return true if this attribute has an &quot;is&quot; getter.
     */
    public boolean isIs() {
<span class="nc" id="L246">        return is;</span>
    }

    public String toString() {
        String access;
<span class="nc bnc" id="L251" title="All 2 branches missed.">        if (isReadable()) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">            if (isWritable())</span>
<span class="nc" id="L253">                access = &quot;read/write&quot;;</span>
            else
<span class="nc" id="L255">                access = &quot;read-only&quot;;</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">        } else if (isWritable())</span>
<span class="nc" id="L257">            access = &quot;write-only&quot;;</span>
        else
<span class="nc" id="L259">            access = &quot;no-access&quot;;</span>

<span class="nc" id="L261">        return</span>
<span class="nc" id="L262">            getClass().getName() + &quot;[&quot; +</span>
<span class="nc" id="L263">            &quot;description=&quot; + getDescription() + &quot;, &quot; +</span>
<span class="nc" id="L264">            &quot;name=&quot; + getName() + &quot;, &quot; +</span>
<span class="nc" id="L265">            &quot;type=&quot; + getType() + &quot;, &quot; +</span>
            access + &quot;, &quot; +
<span class="nc bnc" id="L267" title="All 2 branches missed.">            (isIs() ? &quot;isIs, &quot; : &quot;&quot;) +</span>
<span class="nc" id="L268">            &quot;descriptor=&quot; + getDescriptor() +</span>
            &quot;]&quot;;
    }

    /**
     * Compare this MBeanAttributeInfo to another.
     *
     * @param o the object to compare to.
     *
     * @return true if and only if &lt;code&gt;o&lt;/code&gt; is an MBeanAttributeInfo such
     * that its {@link #getName()}, {@link #getType()}, {@link
     * #getDescription()}, {@link #isReadable()}, {@link
     * #isWritable()}, and {@link #isIs()} values are equal (not
     * necessarily identical) to those of this MBeanAttributeInfo.
     */
    public boolean equals(Object o) {
<span class="nc bnc" id="L284" title="All 2 branches missed.">        if (o == this)</span>
<span class="nc" id="L285">            return true;</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (!(o instanceof MBeanAttributeInfo))</span>
<span class="nc" id="L287">            return false;</span>
<span class="nc" id="L288">        MBeanAttributeInfo p = (MBeanAttributeInfo) o;</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">        return (Objects.equals(p.getName(), getName()) &amp;&amp;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                Objects.equals(p.getType(), getType()) &amp;&amp;</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">                Objects.equals(p.getDescription(), getDescription()) &amp;&amp;</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">                Objects.equals(p.getDescriptor(), getDescriptor()) &amp;&amp;</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">                p.isReadable() == isReadable() &amp;&amp;</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">                p.isWritable() == isWritable() &amp;&amp;</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">                p.isIs() == isIs());</span>
    }

    /* We do not include everything in the hashcode.  We assume that
       if two operations are different they'll probably have different
       names or types.  The penalty we pay when this assumption is
       wrong should be less than the penalty we would pay if it were
       right and we needlessly hashed in the description and parameter
       array.  */
    public int hashCode() {
<span class="nc" id="L305">        return Objects.hash(getName(), getType());</span>
    }

    private static boolean isIs(Method getter) {
<span class="nc bnc" id="L309" title="All 2 branches missed.">        return (getter != null &amp;&amp;</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">                getter.getName().startsWith(&quot;is&quot;) &amp;&amp;</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                (getter.getReturnType().equals(Boolean.TYPE) ||</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">                 getter.getReturnType().equals(Boolean.class)));</span>
    }

    /**
     * Finds the type of the attribute.
     */
    private static String attributeType(Method getter, Method setter)
            throws IntrospectionException {
<span class="nc" id="L320">        Class&lt;?&gt; type = null;</span>

<span class="nc bnc" id="L322" title="All 2 branches missed.">        if (getter != null) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">            if (getter.getParameterTypes().length != 0) {</span>
<span class="nc" id="L324">                throw new IntrospectionException(&quot;bad getter arg count&quot;);</span>
            }
<span class="nc" id="L326">            type = getter.getReturnType();</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if (type == Void.TYPE) {</span>
<span class="nc" id="L328">                throw new IntrospectionException(&quot;getter &quot; + getter.getName() +</span>
                                                 &quot; returns void&quot;);
            }
        }

<span class="nc bnc" id="L333" title="All 2 branches missed.">        if (setter != null) {</span>
<span class="nc" id="L334">            Class&lt;?&gt; params[] = setter.getParameterTypes();</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">            if (params.length != 1) {</span>
<span class="nc" id="L336">                throw new IntrospectionException(&quot;bad setter arg count&quot;);</span>
            }
<span class="nc bnc" id="L338" title="All 2 branches missed.">            if (type == null)</span>
<span class="nc" id="L339">                type = params[0];</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">            else if (type != params[0]) {</span>
<span class="nc" id="L341">                throw new IntrospectionException(&quot;type mismatch between &quot; +</span>
                                                 &quot;getter and setter&quot;);
            }
        }

<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (type == null) {</span>
<span class="nc" id="L347">            throw new IntrospectionException(&quot;getter and setter cannot &quot; +</span>
                                             &quot;both be null&quot;);
        }

<span class="nc" id="L351">        return type.getName();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>