<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ClassAttributeValueExp.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.management</a> &gt; <span class="el_source">ClassAttributeValueExp.java</span></div><h1>ClassAttributeValueExp.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.management;

import java.security.AccessController;

import com.sun.jmx.mbeanserver.GetPropertyAction;

/**
 * This class represents the name of the Java implementation class of
 * the MBean. It is used for performing queries based on the class of
 * the MBean.
 * @serial include
 *
 * &lt;p&gt;The &lt;b&gt;serialVersionUID&lt;/b&gt; of this class is &lt;code&gt;-1081892073854801359L&lt;/code&gt;.
 *
 * @since 1.5
 */
@SuppressWarnings(&quot;serial&quot;)  // serialVersionUID is not constant
class ClassAttributeValueExp extends AttributeValueExp {

    // Serialization compatibility stuff:
    // Two serial forms are supported in this class. The selected form depends
    // on system property &quot;jmx.serial.form&quot;:
    //  - &quot;1.0&quot; for JMX 1.0
    //  - any other value for JMX 1.1 and higher
    //
    // Serial version for old serial form
    private static final long oldSerialVersionUID = -2212731951078526753L;
    //
    // Serial version for new serial form
    private static final long newSerialVersionUID = -1081892073854801359L;

    private static final long serialVersionUID;
    static {
<span class="nc" id="L59">        boolean compat = false;</span>
        try {
<span class="nc" id="L61">            GetPropertyAction act = new GetPropertyAction(&quot;jmx.serial.form&quot;);</span>
<span class="nc" id="L62">            String form = AccessController.doPrivileged(act);</span>
<span class="nc bnc" id="L63" title="All 4 branches missed.">            compat = (form != null &amp;&amp; form.equals(&quot;1.0&quot;));</span>
<span class="nc" id="L64">        } catch (Exception e) {</span>
            // OK: exception means no compat with 1.0, too bad
<span class="nc" id="L66">        }</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">        if (compat)</span>
<span class="nc" id="L68">            serialVersionUID = oldSerialVersionUID;</span>
        else
<span class="nc" id="L70">            serialVersionUID = newSerialVersionUID;</span>
<span class="nc" id="L71">    }</span>

    /**
     * @serial The name of the attribute
     *
     * &lt;p&gt;The &lt;b&gt;serialVersionUID&lt;/b&gt; of this class is &lt;code&gt;-1081892073854801359L&lt;/code&gt;.
     */
    private String attr;

    /**
     * Basic Constructor.
     */
    public ClassAttributeValueExp() {
        /* Compatibility: we have an attr field that we must hold on to
           for serial compatibility, even though our parent has one too.  */
<span class="nc" id="L86">        super(&quot;Class&quot;);</span>
<span class="nc" id="L87">        attr = &quot;Class&quot;;</span>
<span class="nc" id="L88">    }</span>


    /**
     * Applies the ClassAttributeValueExp on an MBean. Returns the name of
     * the Java implementation class of the MBean.
     *
     * @param name The name of the MBean on which the ClassAttributeValueExp will be applied.
     *
     * @return  The ValueExp.
     *
     * @exception BadAttributeValueExpException
     * @exception InvalidApplicationException
     */
    public ValueExp apply(ObjectName name)
            throws BadStringOperationException, BadBinaryOpValueExpException,
                   BadAttributeValueExpException, InvalidApplicationException {
        // getAttribute(name);
<span class="nc" id="L106">        Object result = getValue(name);</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">        if  (result instanceof String) {</span>
<span class="nc" id="L108">            return new StringValueExp((String)result);</span>
        } else {
<span class="nc" id="L110">            throw new BadAttributeValueExpException(result);</span>
        }
    }

    /**
     * Returns the string &quot;Class&quot; representing its value
     */
    public String toString()  {
<span class="nc" id="L118">        return attr;</span>
    }


    protected Object getValue(ObjectName name) {
        try {
            // Get the class of the object
<span class="nc" id="L125">            MBeanServer server = QueryEval.getMBeanServer();</span>
<span class="nc" id="L126">            return server.getObjectInstance(name).getClassName();</span>
<span class="nc" id="L127">        } catch (Exception re) {</span>
<span class="nc" id="L128">            return null;</span>
            /* In principle the MBean does exist because otherwise we
               wouldn't be evaluating the query on it.  But it could
               potentially have disappeared in between the time we
               discovered it and the time the query is evaluated.

               Also, the exception could be a SecurityException.

               Returning null from here will cause
               BadAttributeValueExpException, which will in turn cause
               this MBean to be omitted from the query result.  */
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>