<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PCSC.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.security.smartcardio</a> &gt; <span class="el_source">PCSC.java</span></div><h1>PCSC.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2005, 2012, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.security.smartcardio;

import java.security.AccessController;

/**
 * Access to native PC/SC functions and definition of PC/SC constants.
 * Initialization and platform specific PC/SC constants are handled in
 * the platform specific superclass.
 *
 * @since   1.6
 * @author  Andreas Sterbenz
 */
final class PCSC extends PlatformPCSC {

<span class="nc" id="L40">    private PCSC() {</span>
        // no instantiation
<span class="nc" id="L42">    }</span>

    static void checkAvailable() throws RuntimeException {
<span class="nc bnc" id="L45" title="All 2 branches missed.">        if (initException != null) {</span>
<span class="nc" id="L46">            throw new UnsupportedOperationException</span>
                    (&quot;PC/SC not available on this platform&quot;, initException);
        }
<span class="nc" id="L49">    }</span>

    // returns SCARDCONTEXT (contextId)
    static native long SCardEstablishContext
            (int scope)
            throws PCSCException;

    static native String[] SCardListReaders
            (long contextId)
            throws PCSCException;

    // returns SCARDHANDLE (cardId)
    static native long SCardConnect
            (long contextId, String readerName, int shareMode, int preferredProtocols)
            throws PCSCException;

    static native byte[] SCardTransmit
            (long cardId, int protocol, byte[] buf, int ofs, int len)
            throws PCSCException;

    // returns the ATR of the card, updates status[] with reader state and protocol
    static native byte[] SCardStatus
            (long cardId, byte[] status)
            throws PCSCException;

    static native void SCardDisconnect
            (long cardId, int disposition)
            throws PCSCException;

    // returns dwEventState[] of the same size and order as readerNames[]
    static native int[] SCardGetStatusChange
            (long contextId, long timeout, int[] currentState, String[] readerNames)
            throws PCSCException;

    static native void SCardBeginTransaction
            (long cardId)
            throws PCSCException;

    static native void SCardEndTransaction
            (long cardId, int disposition)
            throws PCSCException;

    static native byte[] SCardControl
            (long cardId, int controlCode, byte[] sendBuffer)
            throws PCSCException;

    // PCSC success/error/failure/warning codes
    final static int SCARD_S_SUCCESS             = 0x00000000;
    final static int SCARD_E_CANCELLED           = 0x80100002;
    final static int SCARD_E_CANT_DISPOSE        = 0x8010000E;
    final static int SCARD_E_INSUFFICIENT_BUFFER = 0x80100008;
    final static int SCARD_E_INVALID_ATR         = 0x80100015;
    final static int SCARD_E_INVALID_HANDLE      = 0x80100003;
    final static int SCARD_E_INVALID_PARAMETER   = 0x80100004;
    final static int SCARD_E_INVALID_TARGET      = 0x80100005;
    final static int SCARD_E_INVALID_VALUE       = 0x80100011;
    final static int SCARD_E_NO_MEMORY           = 0x80100006;
    final static int SCARD_F_COMM_ERROR          = 0x80100013;
    final static int SCARD_F_INTERNAL_ERROR      = 0x80100001;
    final static int SCARD_F_UNKNOWN_ERROR       = 0x80100014;
    final static int SCARD_F_WAITED_TOO_LONG     = 0x80100007;
    final static int SCARD_E_UNKNOWN_READER      = 0x80100009;
    final static int SCARD_E_TIMEOUT             = 0x8010000A;
    final static int SCARD_E_SHARING_VIOLATION   = 0x8010000B;
    final static int SCARD_E_NO_SMARTCARD        = 0x8010000C;
    final static int SCARD_E_UNKNOWN_CARD        = 0x8010000D;
    final static int SCARD_E_PROTO_MISMATCH      = 0x8010000F;
    final static int SCARD_E_NOT_READY           = 0x80100010;
    final static int SCARD_E_SYSTEM_CANCELLED    = 0x80100012;
    final static int SCARD_E_NOT_TRANSACTED      = 0x80100016;
    final static int SCARD_E_READER_UNAVAILABLE  = 0x80100017;

    final static int SCARD_W_UNSUPPORTED_CARD    = 0x80100065;
    final static int SCARD_W_UNRESPONSIVE_CARD   = 0x80100066;
    final static int SCARD_W_UNPOWERED_CARD      = 0x80100067;
    final static int SCARD_W_RESET_CARD          = 0x80100068;
    final static int SCARD_W_REMOVED_CARD        = 0x80100069;
    final static int SCARD_W_INSERTED_CARD       = 0x8010006A;

    final static int SCARD_E_UNSUPPORTED_FEATURE = 0x8010001F;
    final static int SCARD_E_PCI_TOO_SMALL       = 0x80100019;
    final static int SCARD_E_READER_UNSUPPORTED  = 0x8010001A;
    final static int SCARD_E_DUPLICATE_READER    = 0x8010001B;
    final static int SCARD_E_CARD_UNSUPPORTED    = 0x8010001C;
    final static int SCARD_E_NO_SERVICE          = 0x8010001D;
    final static int SCARD_E_SERVICE_STOPPED     = 0x8010001E;

    // MS undocumented
    final static int SCARD_E_NO_READERS_AVAILABLE = 0x8010002E;
    // std. Windows invalid handle return code, used instead of SCARD code
    final static int WINDOWS_ERROR_INVALID_HANDLE = 6;
    final static int WINDOWS_ERROR_INVALID_PARAMETER = 87;

    //
    final static int SCARD_SCOPE_USER      =  0x0000;
    final static int SCARD_SCOPE_TERMINAL  =  0x0001;
    final static int SCARD_SCOPE_SYSTEM    =  0x0002;
    final static int SCARD_SCOPE_GLOBAL    =  0x0003;

    final static int SCARD_SHARE_EXCLUSIVE =  0x0001;
    final static int SCARD_SHARE_SHARED    =  0x0002;
    final static int SCARD_SHARE_DIRECT    =  0x0003;

    final static int SCARD_LEAVE_CARD      =  0x0000;
    final static int SCARD_RESET_CARD      =  0x0001;
    final static int SCARD_UNPOWER_CARD    =  0x0002;
    final static int SCARD_EJECT_CARD      =  0x0003;

    final static int SCARD_STATE_UNAWARE     = 0x0000;
    final static int SCARD_STATE_IGNORE      = 0x0001;
    final static int SCARD_STATE_CHANGED     = 0x0002;
    final static int SCARD_STATE_UNKNOWN     = 0x0004;
    final static int SCARD_STATE_UNAVAILABLE = 0x0008;
    final static int SCARD_STATE_EMPTY       = 0x0010;
    final static int SCARD_STATE_PRESENT     = 0x0020;
    final static int SCARD_STATE_ATRMATCH    = 0x0040;
    final static int SCARD_STATE_EXCLUSIVE   = 0x0080;
    final static int SCARD_STATE_INUSE       = 0x0100;
    final static int SCARD_STATE_MUTE        = 0x0200;
    final static int SCARD_STATE_UNPOWERED   = 0x0400;

    final static int TIMEOUT_INFINITE = 0xffffffff;

<span class="nc" id="L172">    private final static char[] hexDigits = &quot;0123456789abcdef&quot;.toCharArray();</span>

    public static String toString(byte[] b) {
<span class="nc" id="L175">        StringBuffer sb = new StringBuffer(b.length * 3);</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">        for (int i = 0; i &lt; b.length; i++) {</span>
<span class="nc" id="L177">            int k = b[i] &amp; 0xff;</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (i != 0) {</span>
<span class="nc" id="L179">                sb.append(':');</span>
            }
<span class="nc" id="L181">            sb.append(hexDigits[k &gt;&gt;&gt; 4]);</span>
<span class="nc" id="L182">            sb.append(hexDigits[k &amp; 0xf]);</span>
        }
<span class="nc" id="L184">        return sb.toString();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>