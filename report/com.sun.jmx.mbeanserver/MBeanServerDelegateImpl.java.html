<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MBeanServerDelegateImpl.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.jmx.mbeanserver</a> &gt; <span class="el_source">MBeanServerDelegateImpl.java</span></div><h1>MBeanServerDelegateImpl.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.jmx.mbeanserver;

import java.util.logging.Level;

import javax.management.Attribute;
import javax.management.AttributeList;
import javax.management.AttributeNotFoundException;
import javax.management.DynamicMBean;
import javax.management.InvalidAttributeValueException;
import javax.management.JMRuntimeException;
import javax.management.MBeanAttributeInfo;
import javax.management.MBeanException;
import javax.management.MBeanInfo;
import javax.management.MBeanRegistration;
import javax.management.MBeanServer;
import javax.management.MBeanServerDelegate;
import javax.management.ObjectName;
import javax.management.ReflectionException;
import javax.management.RuntimeOperationsException;

import static com.sun.jmx.defaults.JmxProperties.MBEANSERVER_LOGGER;

/**
 * This class is the MBean implementation of the MBeanServerDelegate.
 *
 * @since 1.5
 */
final class MBeanServerDelegateImpl
    extends MBeanServerDelegate
    implements DynamicMBean, MBeanRegistration {

<span class="nc" id="L56">    final private static String[] attributeNames = new String[] {</span>
        &quot;MBeanServerId&quot;,
        &quot;SpecificationName&quot;,
        &quot;SpecificationVersion&quot;,
        &quot;SpecificationVendor&quot;,
        &quot;ImplementationName&quot;,
        &quot;ImplementationVersion&quot;,
        &quot;ImplementationVendor&quot;
    };

<span class="nc" id="L66">    private static final MBeanAttributeInfo[] attributeInfos =</span>
        new MBeanAttributeInfo[] {
            new MBeanAttributeInfo(&quot;MBeanServerId&quot;,&quot;java.lang.String&quot;,
                                   &quot;The MBean server agent identification&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;SpecificationName&quot;,&quot;java.lang.String&quot;,
                                   &quot;The full name of the JMX specification &quot;+
                                   &quot;implemented by this product.&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;SpecificationVersion&quot;,&quot;java.lang.String&quot;,
                                   &quot;The version of the JMX specification &quot;+
                                   &quot;implemented by this product.&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;SpecificationVendor&quot;,&quot;java.lang.String&quot;,
                                   &quot;The vendor of the JMX specification &quot;+
                                   &quot;implemented by this product.&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;ImplementationName&quot;,&quot;java.lang.String&quot;,
                                   &quot;The JMX implementation name &quot;+
                                   &quot;(the name of this product)&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;ImplementationVersion&quot;,&quot;java.lang.String&quot;,
                                   &quot;The JMX implementation version &quot;+
                                   &quot;(the version of this product).&quot;,
                                   true,false,false),
            new MBeanAttributeInfo(&quot;ImplementationVendor&quot;,&quot;java.lang.String&quot;,
                                   &quot;the JMX implementation vendor &quot;+
                                   &quot;(the vendor of this product).&quot;,
                                   true,false,false)
                };

    private final MBeanInfo delegateInfo;

    public MBeanServerDelegateImpl () {
<span class="nc" id="L100">        super();</span>
<span class="nc" id="L101">        delegateInfo =</span>
            new MBeanInfo(&quot;javax.management.MBeanServerDelegate&quot;,
                          &quot;Represents  the MBean server from the management &quot;+
                          &quot;point of view.&quot;,
                          MBeanServerDelegateImpl.attributeInfos, null,
<span class="nc" id="L106">                          null,getNotificationInfo());</span>
<span class="nc" id="L107">    }</span>

    final public ObjectName preRegister (MBeanServer server, ObjectName name)
        throws java.lang.Exception {
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (name == null) return DELEGATE_NAME;</span>
<span class="nc" id="L112">        else return name;</span>
    }

    final public void postRegister (Boolean registrationDone) {
<span class="nc" id="L116">    }</span>

    final public void preDeregister()
        throws java.lang.Exception {
<span class="nc" id="L120">        throw new IllegalArgumentException(</span>
                 &quot;The MBeanServerDelegate MBean cannot be unregistered&quot;);
    }

    final public void postDeregister() {
<span class="nc" id="L125">    }</span>

    /**
     * Obtains the value of a specific attribute of the MBeanServerDelegate.
     *
     * @param attribute The name of the attribute to be retrieved
     *
     * @return  The value of the attribute retrieved.
     *
     * @exception AttributeNotFoundException
     * @exception MBeanException
     *            Wraps a &lt;CODE&gt;java.lang.Exception&lt;/CODE&gt; thrown by the
     *            MBean's getter.
     */
    public Object getAttribute(String attribute)
        throws AttributeNotFoundException,
               MBeanException, ReflectionException {
        try {
            // attribute must not be null
            //
<span class="nc bnc" id="L145" title="All 2 branches missed.">            if (attribute == null)</span>
<span class="nc" id="L146">                throw new AttributeNotFoundException(&quot;null&quot;);</span>

            // Extract the requested attribute from file
            //
<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (attribute.equals(&quot;MBeanServerId&quot;))</span>
<span class="nc" id="L151">                return getMBeanServerId();</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">            else if (attribute.equals(&quot;SpecificationName&quot;))</span>
<span class="nc" id="L153">                return getSpecificationName();</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            else if (attribute.equals(&quot;SpecificationVersion&quot;))</span>
<span class="nc" id="L155">                return getSpecificationVersion();</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">            else if (attribute.equals(&quot;SpecificationVendor&quot;))</span>
<span class="nc" id="L157">                return getSpecificationVendor();</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">            else if (attribute.equals(&quot;ImplementationName&quot;))</span>
<span class="nc" id="L159">                return getImplementationName();</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">            else if (attribute.equals(&quot;ImplementationVersion&quot;))</span>
<span class="nc" id="L161">                return getImplementationVersion();</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">            else if (attribute.equals(&quot;ImplementationVendor&quot;))</span>
<span class="nc" id="L163">                return getImplementationVendor();</span>

            // Unknown attribute
            //
            else
<span class="nc" id="L168">                throw new AttributeNotFoundException(&quot;null&quot;);</span>

<span class="nc" id="L170">        } catch (AttributeNotFoundException x) {</span>
<span class="nc" id="L171">            throw x;</span>
<span class="nc" id="L172">        } catch (JMRuntimeException j) {</span>
<span class="nc" id="L173">            throw j;</span>
<span class="nc" id="L174">        } catch (SecurityException s) {</span>
<span class="nc" id="L175">            throw s;</span>
<span class="nc" id="L176">        } catch (Exception x) {</span>
<span class="nc" id="L177">            throw new MBeanException(x,&quot;Failed to get &quot; + attribute);</span>
        }
    }

    /**
     * This method always fail since all MBeanServerDelegateMBean attributes
     * are read-only.
     *
     * @param attribute The identification of the attribute to
     * be set and  the value it is to be set to.
     *
     * @exception AttributeNotFoundException
     */
    public void setAttribute(Attribute attribute)
        throws AttributeNotFoundException, InvalidAttributeValueException,
               MBeanException, ReflectionException {

        // Now we will always fail:
        // Either because the attribute is null or because it is not
        // accessible (or does not exist).
        //
<span class="nc bnc" id="L198" title="All 2 branches missed.">        final String attname = (attribute==null?null:attribute.getName());</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (attname == null) {</span>
<span class="nc" id="L200">            final RuntimeException r =</span>
                new IllegalArgumentException(&quot;Attribute name cannot be null&quot;);
<span class="nc" id="L202">            throw new RuntimeOperationsException(r,</span>
                &quot;Exception occurred trying to invoke the setter on the MBean&quot;);
        }

        // This is a hack: we call getAttribute in order to generate an
        // AttributeNotFoundException if the attribute does not exist.
        //
<span class="nc" id="L209">        Object val = getAttribute(attname);</span>

        // If we reach this point, we know that the requested attribute
        // exists. However, since all attributes are read-only, we throw
        // an AttributeNotFoundException.
        //
<span class="nc" id="L215">        throw new AttributeNotFoundException(attname + &quot; not accessible&quot;);</span>
    }

    /**
     * Makes it possible to get the values of several attributes of
     * the MBeanServerDelegate.
     *
     * @param attributes A list of the attributes to be retrieved.
     *
     * @return  The list of attributes retrieved.
     *
     */
    public AttributeList getAttributes(String[] attributes) {
        // If attributes is null, the get all attributes.
        //
<span class="nc bnc" id="L230" title="All 2 branches missed.">        final String[] attn = (attributes==null?attributeNames:attributes);</span>

        // Prepare the result list.
        //
<span class="nc" id="L234">        final int len = attn.length;</span>
<span class="nc" id="L235">        final AttributeList list = new AttributeList(len);</span>

        // Get each requested attribute.
        //
<span class="nc bnc" id="L239" title="All 2 branches missed.">        for (int i=0;i&lt;len;i++) {</span>
            try {
<span class="nc" id="L241">                final Attribute a =</span>
<span class="nc" id="L242">                    new Attribute(attn[i],getAttribute(attn[i]));</span>
<span class="nc" id="L243">                list.add(a);</span>
<span class="nc" id="L244">            } catch (Exception x) {</span>
                // Skip the attribute that couldn't be obtained.
                //
<span class="nc bnc" id="L247" title="All 2 branches missed.">                if (MBEANSERVER_LOGGER.isLoggable(Level.FINEST)) {</span>
<span class="nc" id="L248">                    MBEANSERVER_LOGGER.logp(Level.FINEST,</span>
<span class="nc" id="L249">                            MBeanServerDelegateImpl.class.getName(),</span>
                            &quot;getAttributes&quot;,
                            &quot;Attribute &quot; + attn[i] + &quot; not found&quot;);
                }
<span class="nc" id="L253">            }</span>
        }

        // Finally return the result.
        //
<span class="nc" id="L258">        return list;</span>
    }

    /**
     * This method always return an empty list since all
     * MBeanServerDelegateMBean attributes are read-only.
     *
     * @param attributes A list of attributes: The identification of the
     * attributes to be set and  the values they are to be set to.
     *
     * @return  The list of attributes that were set, with their new values.
     *          In fact, this method always return an empty list since all
     *          MBeanServerDelegateMBean attributes are read-only.
     */
    public AttributeList setAttributes(AttributeList attributes) {
<span class="nc" id="L273">        return new AttributeList(0);</span>
    }

    /**
     * Always fails since the MBeanServerDelegate MBean has no operation.
     *
     * @param actionName The name of the action to be invoked.
     * @param params An array containing the parameters to be set when the
     *        action is invoked.
     * @param signature An array containing the signature of the action.
     *
     * @return  The object returned by the action, which represents
     *          the result of invoking the action on the MBean specified.
     *
     * @exception MBeanException  Wraps a &lt;CODE&gt;java.lang.Exception&lt;/CODE&gt;
     *         thrown by the MBean's invoked method.
     * @exception ReflectionException  Wraps a
     *      &lt;CODE&gt;java.lang.Exception&lt;/CODE&gt; thrown while trying to invoke
     *      the method.
     */
    public Object invoke(String actionName, Object params[],
                         String signature[])
        throws MBeanException, ReflectionException {
        // Check that operation name is not null.
        //
<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (actionName == null) {</span>
<span class="nc" id="L299">            final RuntimeException r =</span>
              new IllegalArgumentException(&quot;Operation name  cannot be null&quot;);
<span class="nc" id="L301">            throw new RuntimeOperationsException(r,</span>
            &quot;Exception occurred trying to invoke the operation on the MBean&quot;);
        }

<span class="nc" id="L305">        throw new ReflectionException(</span>
                          new NoSuchMethodException(actionName),
                          &quot;The operation with name &quot; + actionName +
                          &quot; could not be found&quot;);
    }

    /**
     * Provides the MBeanInfo describing the MBeanServerDelegate.
     *
     * @return  The MBeanInfo describing the MBeanServerDelegate.
     *
     */
    public MBeanInfo getMBeanInfo() {
<span class="nc" id="L318">        return delegateInfo;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>