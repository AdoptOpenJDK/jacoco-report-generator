<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>FontRenderContext.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.awt.font</a> &gt; <span class="el_source">FontRenderContext.java</span></div><h1>FontRenderContext.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

/*
 * @author Charlton Innovations, Inc.
 */

package java.awt.font;

import java.awt.RenderingHints;
import static java.awt.RenderingHints.*;
import java.awt.geom.AffineTransform;

/**
*   The &lt;code&gt;FontRenderContext&lt;/code&gt; class is a container for the
*   information needed to correctly measure text.  The measurement of text
*   can vary because of rules that map outlines to pixels, and rendering
*   hints provided by an application.
*   &lt;p&gt;
*   One such piece of information is a transform that scales
*   typographical points to pixels. (A point is defined to be exactly 1/72
*   of an inch, which is slightly different than
*   the traditional mechanical measurement of a point.)  A character that
*   is rendered at 12pt on a 600dpi device might have a different size
*   than the same character rendered at 12pt on a 72dpi device because of
*   such factors as rounding to pixel boundaries and hints that the font
*   designer may have specified.
*   &lt;p&gt;
*   Anti-aliasing and Fractional-metrics specified by an application can also
*   affect the size of a character because of rounding to pixel
*   boundaries.
*   &lt;p&gt;
*   Typically, instances of &lt;code&gt;FontRenderContext&lt;/code&gt; are
*   obtained from a {@link java.awt.Graphics2D Graphics2D} object.  A
*   &lt;code&gt;FontRenderContext&lt;/code&gt; which is directly constructed will
*   most likely not represent any actual graphics device, and may lead
*   to unexpected or incorrect results.
*   &lt;p&gt;
*   @see java.awt.RenderingHints#KEY_TEXT_ANTIALIASING
*   @see java.awt.RenderingHints#KEY_FRACTIONALMETRICS
*   @see java.awt.Graphics2D#getFontRenderContext()
*   @see java.awt.font.LineMetrics
*/

public class FontRenderContext {
    private transient AffineTransform tx;
    private transient Object aaHintValue;
    private transient Object fmHintValue;
    private transient boolean defaulting;

    /**
     * Constructs a new &lt;code&gt;FontRenderContext&lt;/code&gt;
     * object.
     *
     */
<span class="nc" id="L78">    protected FontRenderContext() {</span>
<span class="nc" id="L79">        aaHintValue = VALUE_TEXT_ANTIALIAS_DEFAULT;</span>
<span class="nc" id="L80">        fmHintValue = VALUE_FRACTIONALMETRICS_DEFAULT;</span>
<span class="nc" id="L81">        defaulting = true;</span>
<span class="nc" id="L82">    }</span>

    /**
     * Constructs a &lt;code&gt;FontRenderContext&lt;/code&gt; object from an
     * optional {@link AffineTransform} and two &lt;code&gt;boolean&lt;/code&gt;
     * values that determine if the newly constructed object has
     * anti-aliasing or fractional metrics.
     * In each case the boolean values &lt;CODE&gt;true&lt;/CODE&gt; and &lt;CODE&gt;false&lt;/CODE&gt;
     * correspond to the rendering hint values &lt;CODE&gt;ON&lt;/CODE&gt; and
     * &lt;CODE&gt;OFF&lt;/CODE&gt; respectively.
     * &lt;p&gt;
     * To specify other hint values, use the constructor which
     * specifies the rendering hint values as parameters :
     * {@link #FontRenderContext(AffineTransform, Object, Object)}.
     * @param tx the transform which is used to scale typographical points
     * to pixels in this &lt;code&gt;FontRenderContext&lt;/code&gt;.  If null, an
     * identity transform is used.
     * @param isAntiAliased determines if the newly constructed object
     * has anti-aliasing.
     * @param usesFractionalMetrics determines if the newly constructed
     * object has fractional metrics.
     */
    public FontRenderContext(AffineTransform tx,
                            boolean isAntiAliased,
<span class="fc" id="L106">                            boolean usesFractionalMetrics) {</span>
<span class="pc bpc" id="L107" title="3 of 4 branches missed.">        if (tx != null &amp;&amp; !tx.isIdentity()) {</span>
<span class="nc" id="L108">            this.tx = new AffineTransform(tx);</span>
        }
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        if (isAntiAliased) {</span>
<span class="nc" id="L111">            aaHintValue = VALUE_TEXT_ANTIALIAS_ON;</span>
        } else {
<span class="fc" id="L113">            aaHintValue = VALUE_TEXT_ANTIALIAS_OFF;</span>
        }
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">        if (usesFractionalMetrics) {</span>
<span class="nc" id="L116">            fmHintValue = VALUE_FRACTIONALMETRICS_ON;</span>
        } else {
<span class="fc" id="L118">            fmHintValue = VALUE_FRACTIONALMETRICS_OFF;</span>
        }
<span class="fc" id="L120">    }</span>

    /**
     * Constructs a &lt;code&gt;FontRenderContext&lt;/code&gt; object from an
     * optional {@link AffineTransform} and two &lt;code&gt;Object&lt;/code&gt;
     * values that determine if the newly constructed object has
     * anti-aliasing or fractional metrics.
     * @param tx the transform which is used to scale typographical points
     * to pixels in this &lt;code&gt;FontRenderContext&lt;/code&gt;.  If null, an
     * identity transform is used.
     * @param aaHint - one of the text antialiasing rendering hint values
     * defined in {@link java.awt.RenderingHints java.awt.RenderingHints}.
     * Any other value will throw &lt;code&gt;IllegalArgumentException&lt;/code&gt;.
     * {@link java.awt.RenderingHints#VALUE_TEXT_ANTIALIAS_DEFAULT VALUE_TEXT_ANTIALIAS_DEFAULT}
     * may be specified, in which case the mode used is implementation
     * dependent.
     * @param fmHint - one of the text fractional rendering hint values defined
     * in {@link java.awt.RenderingHints java.awt.RenderingHints}.
     * {@link java.awt.RenderingHints#VALUE_FRACTIONALMETRICS_DEFAULT VALUE_FRACTIONALMETRICS_DEFAULT}
     * may be specified, in which case the mode used is implementation
     * dependent.
     * Any other value will throw &lt;code&gt;IllegalArgumentException&lt;/code&gt;
     * @throws IllegalArgumentException if the hints are not one of the
     * legal values.
     * @since 1.6
     */
<span class="nc" id="L146">    public FontRenderContext(AffineTransform tx, Object aaHint, Object fmHint){</span>
<span class="nc bnc" id="L147" title="All 4 branches missed.">        if (tx != null &amp;&amp; !tx.isIdentity()) {</span>
<span class="nc" id="L148">            this.tx = new AffineTransform(tx);</span>
        }
        try {
<span class="nc bnc" id="L151" title="All 2 branches missed.">            if (KEY_TEXT_ANTIALIASING.isCompatibleValue(aaHint)) {</span>
<span class="nc" id="L152">                aaHintValue = aaHint;</span>
            } else {
<span class="nc" id="L154">                throw new IllegalArgumentException(&quot;AA hint:&quot; + aaHint);</span>
            }
<span class="nc" id="L156">        } catch (Exception e) {</span>
<span class="nc" id="L157">            throw new IllegalArgumentException(&quot;AA hint:&quot; +aaHint);</span>
<span class="nc" id="L158">        }</span>
        try {
<span class="nc bnc" id="L160" title="All 2 branches missed.">            if (KEY_FRACTIONALMETRICS.isCompatibleValue(fmHint)) {</span>
<span class="nc" id="L161">                fmHintValue = fmHint;</span>
            } else {
<span class="nc" id="L163">                throw new IllegalArgumentException(&quot;FM hint:&quot; + fmHint);</span>
            }
<span class="nc" id="L165">        } catch (Exception e) {</span>
<span class="nc" id="L166">            throw new IllegalArgumentException(&quot;FM hint:&quot; +fmHint);</span>
<span class="nc" id="L167">        }</span>
<span class="nc" id="L168">    }</span>

    /**
     * Indicates whether or not this &lt;code&gt;FontRenderContext&lt;/code&gt; object
     * measures text in a transformed render context.
     * @return  &lt;code&gt;true&lt;/code&gt; if this &lt;code&gt;FontRenderContext&lt;/code&gt;
     *          object has a non-identity AffineTransform attribute.
     *          &lt;code&gt;false&lt;/code&gt; otherwise.
     * @see     java.awt.font.FontRenderContext#getTransform
     * @since   1.6
     */
    public boolean isTransformed() {
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (!defaulting) {</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            return tx != null;</span>
        } else {
<span class="nc bnc" id="L183" title="All 2 branches missed.">            return !getTransform().isIdentity();</span>
        }
    }

    /**
     * Returns the integer type of the affine transform for this
     * &lt;code&gt;FontRenderContext&lt;/code&gt; as specified by
     * {@link java.awt.geom.AffineTransform#getType()}
     * @return the type of the transform.
     * @see AffineTransform
     * @since 1.6
     */
    public int getTransformType() {
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (!defaulting) {</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">            if (tx == null) {</span>
<span class="nc" id="L198">                return AffineTransform.TYPE_IDENTITY;</span>
            } else {
<span class="nc" id="L200">                return tx.getType();</span>
            }
        } else {
<span class="nc" id="L203">            return getTransform().getType();</span>
        }
    }

    /**
    *   Gets the transform that is used to scale typographical points
    *   to pixels in this &lt;code&gt;FontRenderContext&lt;/code&gt;.
    *   @return the &lt;code&gt;AffineTransform&lt;/code&gt; of this
    *    &lt;code&gt;FontRenderContext&lt;/code&gt;.
    *   @see AffineTransform
    */
    public AffineTransform getTransform() {
<span class="nc bnc" id="L215" title="All 2 branches missed.">        return (tx == null) ? new AffineTransform() : new AffineTransform(tx);</span>
    }

    /**
    * Returns a boolean which indicates whether or not some form of
    * antialiasing is specified by this &lt;code&gt;FontRenderContext&lt;/code&gt;.
    * Call {@link #getAntiAliasingHint() getAntiAliasingHint()}
    * for the specific rendering hint value.
    *   @return    &lt;code&gt;true&lt;/code&gt;, if text is anti-aliased in this
    *   &lt;code&gt;FontRenderContext&lt;/code&gt;; &lt;code&gt;false&lt;/code&gt; otherwise.
    *   @see        java.awt.RenderingHints#KEY_TEXT_ANTIALIASING
    *   @see #FontRenderContext(AffineTransform,boolean,boolean)
    *   @see #FontRenderContext(AffineTransform,Object,Object)
    */
    public boolean isAntiAliased() {
<span class="nc bnc" id="L230" title="All 4 branches missed.">        return !(aaHintValue == VALUE_TEXT_ANTIALIAS_OFF ||</span>
                 aaHintValue == VALUE_TEXT_ANTIALIAS_DEFAULT);
    }

    /**
    * Returns a boolean which whether text fractional metrics mode
    * is used in this &lt;code&gt;FontRenderContext&lt;/code&gt;.
    * Call {@link #getFractionalMetricsHint() getFractionalMetricsHint()}
    * to obtain the corresponding rendering hint value.
    *   @return    &lt;code&gt;true&lt;/code&gt;, if layout should be performed with
    *   fractional metrics; &lt;code&gt;false&lt;/code&gt; otherwise.
    *               in this &lt;code&gt;FontRenderContext&lt;/code&gt;.
    *   @see java.awt.RenderingHints#KEY_FRACTIONALMETRICS
    *   @see #FontRenderContext(AffineTransform,boolean,boolean)
    *   @see #FontRenderContext(AffineTransform,Object,Object)
    */
    public boolean usesFractionalMetrics() {
<span class="nc bnc" id="L247" title="All 4 branches missed.">        return !(fmHintValue == VALUE_FRACTIONALMETRICS_OFF ||</span>
                 fmHintValue == VALUE_FRACTIONALMETRICS_DEFAULT);
    }

    /**
     * Return the text anti-aliasing rendering mode hint used in this
     * &lt;code&gt;FontRenderContext&lt;/code&gt;.
     * This will be one of the text antialiasing rendering hint values
     * defined in {@link java.awt.RenderingHints java.awt.RenderingHints}.
     * @return  text anti-aliasing rendering mode hint used in this
     * &lt;code&gt;FontRenderContext&lt;/code&gt;.
     * @since 1.6
     */
    public Object getAntiAliasingHint() {
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (defaulting) {</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">            if (isAntiAliased()) {</span>
<span class="nc" id="L263">                 return VALUE_TEXT_ANTIALIAS_ON;</span>
            } else {
<span class="nc" id="L265">                return VALUE_TEXT_ANTIALIAS_OFF;</span>
            }
        }
<span class="nc" id="L268">        return aaHintValue;</span>
    }

    /**
     * Return the text fractional metrics rendering mode hint used in this
     * &lt;code&gt;FontRenderContext&lt;/code&gt;.
     * This will be one of the text fractional metrics rendering hint values
     * defined in {@link java.awt.RenderingHints java.awt.RenderingHints}.
     * @return the text fractional metrics rendering mode hint used in this
     * &lt;code&gt;FontRenderContext&lt;/code&gt;.
     * @since 1.6
     */
    public Object getFractionalMetricsHint() {
<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (defaulting) {</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (usesFractionalMetrics()) {</span>
<span class="nc" id="L283">                 return VALUE_FRACTIONALMETRICS_ON;</span>
            } else {
<span class="nc" id="L285">                return VALUE_FRACTIONALMETRICS_OFF;</span>
            }
        }
<span class="nc" id="L288">        return fmHintValue;</span>
    }

    /**
     * Return true if obj is an instance of FontRenderContext and has the same
     * transform, antialiasing, and fractional metrics values as this.
     * @param obj the object to test for equality
     * @return &lt;code&gt;true&lt;/code&gt; if the specified object is equal to
     *         this &lt;code&gt;FontRenderContext&lt;/code&gt;; &lt;code&gt;false&lt;/code&gt;
     *         otherwise.
     */
    public boolean equals(Object obj) {
        try {
<span class="nc" id="L301">            return equals((FontRenderContext)obj);</span>
        }
<span class="nc" id="L303">        catch (ClassCastException e) {</span>
<span class="nc" id="L304">            return false;</span>
        }
    }

    /**
     * Return true if rhs has the same transform, antialiasing,
     * and fractional metrics values as this.
     * @param rhs the &lt;code&gt;FontRenderContext&lt;/code&gt; to test for equality
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;rhs&lt;/code&gt; is equal to
     *         this &lt;code&gt;FontRenderContext&lt;/code&gt;; &lt;code&gt;false&lt;/code&gt;
     *         otherwise.
     * @since 1.4
     */
    public boolean equals(FontRenderContext rhs) {
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (this == rhs) {</span>
<span class="nc" id="L319">            return true;</span>
        }
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (rhs == null) {</span>
<span class="nc" id="L322">            return false;</span>
        }

        /* if neither instance is a subclass, reference values directly. */
<span class="nc bnc" id="L326" title="All 4 branches missed.">        if (!rhs.defaulting &amp;&amp; !defaulting) {</span>
<span class="nc bnc" id="L327" title="All 4 branches missed.">            if (rhs.aaHintValue == aaHintValue &amp;&amp;</span>
                rhs.fmHintValue == fmHintValue) {

<span class="nc bnc" id="L330" title="All 4 branches missed.">                return tx == null ? rhs.tx == null : tx.equals(rhs.tx);</span>
            }
<span class="nc" id="L332">            return false;</span>
        } else {
<span class="nc" id="L334">            return</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">                rhs.getAntiAliasingHint() == getAntiAliasingHint() &amp;&amp;</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">                rhs.getFractionalMetricsHint() == getFractionalMetricsHint() &amp;&amp;</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">                rhs.getTransform().equals(getTransform());</span>
        }
    }

    /**
     * Return a hashcode for this FontRenderContext.
     */
    public int hashCode() {
<span class="nc bnc" id="L345" title="All 2 branches missed.">        int hash = tx == null ? 0 : tx.hashCode();</span>
        /* SunHints value objects have identity hashcode, so we can rely on
         * this to ensure that two equal FRC's have the same hashcode.
         */
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (defaulting) {</span>
<span class="nc" id="L350">            hash += getAntiAliasingHint().hashCode();</span>
<span class="nc" id="L351">            hash += getFractionalMetricsHint().hashCode();</span>
        } else {
<span class="nc" id="L353">            hash += aaHintValue.hashCode();</span>
<span class="nc" id="L354">            hash += fmHintValue.hashCode();</span>
        }
<span class="nc" id="L356">        return hash;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>