<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>KeyRep.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.security</a> &gt; <span class="el_source">KeyRep.java</span></div><h1>KeyRep.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.security;

import java.io.*;
import java.util.Locale;

import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.X509EncodedKeySpec;
import java.security.spec.InvalidKeySpecException;

import javax.crypto.SecretKeyFactory;
import javax.crypto.spec.SecretKeySpec;

/**
 * Standardized representation for serialized Key objects.
 *
 * &lt;p&gt;
 *
 * Note that a serialized Key may contain sensitive information
 * which should not be exposed in untrusted environments.  See the
 * &lt;a href=&quot;../../../platform/serialization/spec/security.html&quot;&gt;
 * Security Appendix&lt;/a&gt;
 * of the Serialization Specification for more information.
 *
 * @see Key
 * @see KeyFactory
 * @see javax.crypto.spec.SecretKeySpec
 * @see java.security.spec.X509EncodedKeySpec
 * @see java.security.spec.PKCS8EncodedKeySpec
 *
 * @since 1.5
 */

public class KeyRep implements Serializable {

    private static final long serialVersionUID = -4757683898830641853L;

    /**
     * Key type.
     *
     * @since 1.5
     */
<span class="pc" id="L67">    public static enum Type {</span>

        /** Type for secret keys. */
<span class="fc" id="L70">        SECRET,</span>

        /** Type for public keys. */
<span class="fc" id="L73">        PUBLIC,</span>

        /** Type for private keys. */
<span class="fc" id="L76">        PRIVATE,</span>

    }

    private static final String PKCS8 = &quot;PKCS#8&quot;;
    private static final String X509 = &quot;X.509&quot;;
    private static final String RAW = &quot;RAW&quot;;

    /**
     * Either one of Type.SECRET, Type.PUBLIC, or Type.PRIVATE
     *
     * @serial
     */
    private Type type;

    /**
     * The Key algorithm
     *
     * @serial
     */
    private String algorithm;

    /**
     * The Key encoding format
     *
     * @serial
     */
    private String format;

    /**
     * The encoded Key bytes
     *
     * @serial
     */
    private byte[] encoded;

    /**
     * Construct the alternate Key class.
     *
     * &lt;p&gt;
     *
     * @param type either one of Type.SECRET, Type.PUBLIC, or Type.PRIVATE
     * @param algorithm the algorithm returned from
     *          {@code Key.getAlgorithm()}
     * @param format the encoding format returned from
     *          {@code Key.getFormat()}
     * @param encoded the encoded bytes returned from
     *          {@code Key.getEncoded()}
     *
     * @exception NullPointerException
     *          if type is {@code null},
     *          if algorithm is {@code null},
     *          if format is {@code null},
     *          or if encoded is {@code null}
     */
    public KeyRep(Type type, String algorithm,
<span class="fc" id="L132">                String format, byte[] encoded) {</span>

<span class="pc bpc" id="L134" title="4 of 8 branches missed.">        if (type == null || algorithm == null ||</span>
            format == null || encoded == null) {
<span class="nc" id="L136">            throw new NullPointerException(&quot;invalid null input(s)&quot;);</span>
        }

<span class="fc" id="L139">        this.type = type;</span>
<span class="fc" id="L140">        this.algorithm = algorithm;</span>
<span class="fc" id="L141">        this.format = format.toUpperCase(Locale.ENGLISH);</span>
<span class="fc" id="L142">        this.encoded = encoded.clone();</span>
<span class="fc" id="L143">    }</span>

    /**
     * Resolve the Key object.
     *
     * &lt;p&gt; This method supports three Type/format combinations:
     * &lt;ul&gt;
     * &lt;li&gt; Type.SECRET/&quot;RAW&quot; - returns a SecretKeySpec object
     * constructed using encoded key bytes and algorithm
     * &lt;li&gt; Type.PUBLIC/&quot;X.509&quot; - gets a KeyFactory instance for
     * the key algorithm, constructs an X509EncodedKeySpec with the
     * encoded key bytes, and generates a public key from the spec
     * &lt;li&gt; Type.PRIVATE/&quot;PKCS#8&quot; - gets a KeyFactory instance for
     * the key algorithm, constructs a PKCS8EncodedKeySpec with the
     * encoded key bytes, and generates a private key from the spec
     * &lt;/ul&gt;
     *
     * &lt;p&gt;
     *
     * @return the resolved Key object
     *
     * @exception ObjectStreamException if the Type/format
     *  combination is unrecognized, if the algorithm, key format, or
     *  encoded key bytes are unrecognized/invalid, of if the
     *  resolution of the key fails for any reason
     */
    protected Object readResolve() throws ObjectStreamException {
        try {
<span class="pc bpc" id="L171" title="1 of 4 branches missed.">            if (type == Type.SECRET &amp;&amp; RAW.equals(format)) {</span>
<span class="fc" id="L172">                return new SecretKeySpec(encoded, algorithm);</span>
<span class="pc bpc" id="L173" title="1 of 4 branches missed.">            } else if (type == Type.PUBLIC &amp;&amp; X509.equals(format)) {</span>
<span class="fc" id="L174">                KeyFactory f = KeyFactory.getInstance(algorithm);</span>
<span class="fc" id="L175">                return f.generatePublic(new X509EncodedKeySpec(encoded));</span>
<span class="pc bpc" id="L176" title="2 of 4 branches missed.">            } else if (type == Type.PRIVATE &amp;&amp; PKCS8.equals(format)) {</span>
<span class="fc" id="L177">                KeyFactory f = KeyFactory.getInstance(algorithm);</span>
<span class="fc" id="L178">                return f.generatePrivate(new PKCS8EncodedKeySpec(encoded));</span>
            } else {
<span class="nc" id="L180">                throw new NotSerializableException</span>
                        (&quot;unrecognized type/format combination: &quot; +
                        type + &quot;/&quot; + format);
            }
<span class="nc" id="L184">        } catch (NotSerializableException nse) {</span>
<span class="nc" id="L185">            throw nse;</span>
<span class="nc" id="L186">        } catch (Exception e) {</span>
<span class="nc" id="L187">            NotSerializableException nse = new NotSerializableException</span>
                                        (&quot;java.security.Key: &quot; +
                                        &quot;[&quot; + type + &quot;] &quot; +
                                        &quot;[&quot; + algorithm + &quot;] &quot; +
                                        &quot;[&quot; + format + &quot;]&quot;);
<span class="nc" id="L192">            nse.initCause(e);</span>
<span class="nc" id="L193">            throw nse;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>