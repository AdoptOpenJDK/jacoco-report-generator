<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>DataOutputStream.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.io</a> &gt; <span class="el_source">DataOutputStream.java</span></div><h1>DataOutputStream.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1994, 2004, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.io;

/**
 * A data output stream lets an application write primitive Java data
 * types to an output stream in a portable way. An application can
 * then use a data input stream to read the data back in.
 *
 * @author  unascribed
 * @see     java.io.DataInputStream
 * @since   JDK1.0
 */
public
class DataOutputStream extends FilterOutputStream implements DataOutput {
    /**
     * The number of bytes written to the data output stream so far.
     * If this counter overflows, it will be wrapped to Integer.MAX_VALUE.
     */
    protected int written;

    /**
     * bytearr is initialized on demand by writeUTF
     */
<span class="fc" id="L48">    private byte[] bytearr = null;</span>

    /**
     * Creates a new data output stream to write data to the specified
     * underlying output stream. The counter &lt;code&gt;written&lt;/code&gt; is
     * set to zero.
     *
     * @param   out   the underlying output stream, to be saved for later
     *                use.
     * @see     java.io.FilterOutputStream#out
     */
    public DataOutputStream(OutputStream out) {
<span class="fc" id="L60">        super(out);</span>
<span class="fc" id="L61">    }</span>

    /**
     * Increases the written counter by the specified value
     * until it reaches Integer.MAX_VALUE.
     */
    private void incCount(int value) {
<span class="fc" id="L68">        int temp = written + value;</span>
<span class="pc bpc" id="L69" title="1 of 2 branches missed.">        if (temp &lt; 0) {</span>
<span class="nc" id="L70">            temp = Integer.MAX_VALUE;</span>
        }
<span class="fc" id="L72">        written = temp;</span>
<span class="fc" id="L73">    }</span>

    /**
     * Writes the specified byte (the low eight bits of the argument
     * &lt;code&gt;b&lt;/code&gt;) to the underlying output stream. If no exception
     * is thrown, the counter &lt;code&gt;written&lt;/code&gt; is incremented by
     * &lt;code&gt;1&lt;/code&gt;.
     * &lt;p&gt;
     * Implements the &lt;code&gt;write&lt;/code&gt; method of &lt;code&gt;OutputStream&lt;/code&gt;.
     *
     * @param      b   the &lt;code&gt;byte&lt;/code&gt; to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public synchronized void write(int b) throws IOException {
<span class="fc" id="L88">        out.write(b);</span>
<span class="fc" id="L89">        incCount(1);</span>
<span class="fc" id="L90">    }</span>

    /**
     * Writes &lt;code&gt;len&lt;/code&gt; bytes from the specified byte array
     * starting at offset &lt;code&gt;off&lt;/code&gt; to the underlying output stream.
     * If no exception is thrown, the counter &lt;code&gt;written&lt;/code&gt; is
     * incremented by &lt;code&gt;len&lt;/code&gt;.
     *
     * @param      b     the data.
     * @param      off   the start offset in the data.
     * @param      len   the number of bytes to write.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public synchronized void write(byte b[], int off, int len)
        throws IOException
    {
<span class="fc" id="L107">        out.write(b, off, len);</span>
<span class="fc" id="L108">        incCount(len);</span>
<span class="fc" id="L109">    }</span>

    /**
     * Flushes this data output stream. This forces any buffered output
     * bytes to be written out to the stream.
     * &lt;p&gt;
     * The &lt;code&gt;flush&lt;/code&gt; method of &lt;code&gt;DataOutputStream&lt;/code&gt;
     * calls the &lt;code&gt;flush&lt;/code&gt; method of its underlying output stream.
     *
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     * @see        java.io.OutputStream#flush()
     */
    public void flush() throws IOException {
<span class="fc" id="L123">        out.flush();</span>
<span class="fc" id="L124">    }</span>

    /**
     * Writes a &lt;code&gt;boolean&lt;/code&gt; to the underlying output stream as
     * a 1-byte value. The value &lt;code&gt;true&lt;/code&gt; is written out as the
     * value &lt;code&gt;(byte)1&lt;/code&gt;; the value &lt;code&gt;false&lt;/code&gt; is
     * written out as the value &lt;code&gt;(byte)0&lt;/code&gt;. If no exception is
     * thrown, the counter &lt;code&gt;written&lt;/code&gt; is incremented by
     * &lt;code&gt;1&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;boolean&lt;/code&gt; value to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeBoolean(boolean v) throws IOException {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        out.write(v ? 1 : 0);</span>
<span class="nc" id="L140">        incCount(1);</span>
<span class="nc" id="L141">    }</span>

    /**
     * Writes out a &lt;code&gt;byte&lt;/code&gt; to the underlying output stream as
     * a 1-byte value. If no exception is thrown, the counter
     * &lt;code&gt;written&lt;/code&gt; is incremented by &lt;code&gt;1&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;byte&lt;/code&gt; value to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeByte(int v) throws IOException {
<span class="fc" id="L153">        out.write(v);</span>
<span class="fc" id="L154">        incCount(1);</span>
<span class="fc" id="L155">    }</span>

    /**
     * Writes a &lt;code&gt;short&lt;/code&gt; to the underlying output stream as two
     * bytes, high byte first. If no exception is thrown, the counter
     * &lt;code&gt;written&lt;/code&gt; is incremented by &lt;code&gt;2&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;short&lt;/code&gt; to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeShort(int v) throws IOException {
<span class="fc" id="L167">        out.write((v &gt;&gt;&gt; 8) &amp; 0xFF);</span>
<span class="fc" id="L168">        out.write((v &gt;&gt;&gt; 0) &amp; 0xFF);</span>
<span class="fc" id="L169">        incCount(2);</span>
<span class="fc" id="L170">    }</span>

    /**
     * Writes a &lt;code&gt;char&lt;/code&gt; to the underlying output stream as a
     * 2-byte value, high byte first. If no exception is thrown, the
     * counter &lt;code&gt;written&lt;/code&gt; is incremented by &lt;code&gt;2&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;char&lt;/code&gt; value to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeChar(int v) throws IOException {
<span class="fc" id="L182">        out.write((v &gt;&gt;&gt; 8) &amp; 0xFF);</span>
<span class="fc" id="L183">        out.write((v &gt;&gt;&gt; 0) &amp; 0xFF);</span>
<span class="fc" id="L184">        incCount(2);</span>
<span class="fc" id="L185">    }</span>

    /**
     * Writes an &lt;code&gt;int&lt;/code&gt; to the underlying output stream as four
     * bytes, high byte first. If no exception is thrown, the counter
     * &lt;code&gt;written&lt;/code&gt; is incremented by &lt;code&gt;4&lt;/code&gt;.
     *
     * @param      v   an &lt;code&gt;int&lt;/code&gt; to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeInt(int v) throws IOException {
<span class="fc" id="L197">        out.write((v &gt;&gt;&gt; 24) &amp; 0xFF);</span>
<span class="fc" id="L198">        out.write((v &gt;&gt;&gt; 16) &amp; 0xFF);</span>
<span class="fc" id="L199">        out.write((v &gt;&gt;&gt;  8) &amp; 0xFF);</span>
<span class="fc" id="L200">        out.write((v &gt;&gt;&gt;  0) &amp; 0xFF);</span>
<span class="fc" id="L201">        incCount(4);</span>
<span class="fc" id="L202">    }</span>

<span class="fc" id="L204">    private byte writeBuffer[] = new byte[8];</span>

    /**
     * Writes a &lt;code&gt;long&lt;/code&gt; to the underlying output stream as eight
     * bytes, high byte first. In no exception is thrown, the counter
     * &lt;code&gt;written&lt;/code&gt; is incremented by &lt;code&gt;8&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;long&lt;/code&gt; to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeLong(long v) throws IOException {
<span class="fc" id="L216">        writeBuffer[0] = (byte)(v &gt;&gt;&gt; 56);</span>
<span class="fc" id="L217">        writeBuffer[1] = (byte)(v &gt;&gt;&gt; 48);</span>
<span class="fc" id="L218">        writeBuffer[2] = (byte)(v &gt;&gt;&gt; 40);</span>
<span class="fc" id="L219">        writeBuffer[3] = (byte)(v &gt;&gt;&gt; 32);</span>
<span class="fc" id="L220">        writeBuffer[4] = (byte)(v &gt;&gt;&gt; 24);</span>
<span class="fc" id="L221">        writeBuffer[5] = (byte)(v &gt;&gt;&gt; 16);</span>
<span class="fc" id="L222">        writeBuffer[6] = (byte)(v &gt;&gt;&gt;  8);</span>
<span class="fc" id="L223">        writeBuffer[7] = (byte)(v &gt;&gt;&gt;  0);</span>
<span class="fc" id="L224">        out.write(writeBuffer, 0, 8);</span>
<span class="fc" id="L225">        incCount(8);</span>
<span class="fc" id="L226">    }</span>

    /**
     * Converts the float argument to an &lt;code&gt;int&lt;/code&gt; using the
     * &lt;code&gt;floatToIntBits&lt;/code&gt; method in class &lt;code&gt;Float&lt;/code&gt;,
     * and then writes that &lt;code&gt;int&lt;/code&gt; value to the underlying
     * output stream as a 4-byte quantity, high byte first. If no
     * exception is thrown, the counter &lt;code&gt;written&lt;/code&gt; is
     * incremented by &lt;code&gt;4&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;float&lt;/code&gt; value to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     * @see        java.lang.Float#floatToIntBits(float)
     */
    public final void writeFloat(float v) throws IOException {
<span class="fc" id="L242">        writeInt(Float.floatToIntBits(v));</span>
<span class="fc" id="L243">    }</span>

    /**
     * Converts the double argument to a &lt;code&gt;long&lt;/code&gt; using the
     * &lt;code&gt;doubleToLongBits&lt;/code&gt; method in class &lt;code&gt;Double&lt;/code&gt;,
     * and then writes that &lt;code&gt;long&lt;/code&gt; value to the underlying
     * output stream as an 8-byte quantity, high byte first. If no
     * exception is thrown, the counter &lt;code&gt;written&lt;/code&gt; is
     * incremented by &lt;code&gt;8&lt;/code&gt;.
     *
     * @param      v   a &lt;code&gt;double&lt;/code&gt; value to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     * @see        java.lang.Double#doubleToLongBits(double)
     */
    public final void writeDouble(double v) throws IOException {
<span class="fc" id="L259">        writeLong(Double.doubleToLongBits(v));</span>
<span class="fc" id="L260">    }</span>

    /**
     * Writes out the string to the underlying output stream as a
     * sequence of bytes. Each character in the string is written out, in
     * sequence, by discarding its high eight bits. If no exception is
     * thrown, the counter &lt;code&gt;written&lt;/code&gt; is incremented by the
     * length of &lt;code&gt;s&lt;/code&gt;.
     *
     * @param      s   a string of bytes to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeBytes(String s) throws IOException {
<span class="fc" id="L274">        int len = s.length();</span>
<span class="fc bfc" id="L275" title="All 2 branches covered.">        for (int i = 0 ; i &lt; len ; i++) {</span>
<span class="fc" id="L276">            out.write((byte)s.charAt(i));</span>
        }
<span class="fc" id="L278">        incCount(len);</span>
<span class="fc" id="L279">    }</span>

    /**
     * Writes a string to the underlying output stream as a sequence of
     * characters. Each character is written to the data output stream as
     * if by the &lt;code&gt;writeChar&lt;/code&gt; method. If no exception is
     * thrown, the counter &lt;code&gt;written&lt;/code&gt; is incremented by twice
     * the length of &lt;code&gt;s&lt;/code&gt;.
     *
     * @param      s   a &lt;code&gt;String&lt;/code&gt; value to be written.
     * @exception  IOException  if an I/O error occurs.
     * @see        java.io.DataOutputStream#writeChar(int)
     * @see        java.io.FilterOutputStream#out
     */
    public final void writeChars(String s) throws IOException {
<span class="nc" id="L294">        int len = s.length();</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">        for (int i = 0 ; i &lt; len ; i++) {</span>
<span class="nc" id="L296">            int v = s.charAt(i);</span>
<span class="nc" id="L297">            out.write((v &gt;&gt;&gt; 8) &amp; 0xFF);</span>
<span class="nc" id="L298">            out.write((v &gt;&gt;&gt; 0) &amp; 0xFF);</span>
        }
<span class="nc" id="L300">        incCount(len * 2);</span>
<span class="nc" id="L301">    }</span>

    /**
     * Writes a string to the underlying output stream using
     * &lt;a href=&quot;DataInput.html#modified-utf-8&quot;&gt;modified UTF-8&lt;/a&gt;
     * encoding in a machine-independent manner.
     * &lt;p&gt;
     * First, two bytes are written to the output stream as if by the
     * &lt;code&gt;writeShort&lt;/code&gt; method giving the number of bytes to
     * follow. This value is the number of bytes actually written out,
     * not the length of the string. Following the length, each character
     * of the string is output, in sequence, using the modified UTF-8 encoding
     * for the character. If no exception is thrown, the counter
     * &lt;code&gt;written&lt;/code&gt; is incremented by the total number of
     * bytes written to the output stream. This will be at least two
     * plus the length of &lt;code&gt;str&lt;/code&gt;, and at most two plus
     * thrice the length of &lt;code&gt;str&lt;/code&gt;.
     *
     * @param      str   a string to be written.
     * @exception  IOException  if an I/O error occurs.
     */
    public final void writeUTF(String str) throws IOException {
<span class="fc" id="L323">        writeUTF(str, this);</span>
<span class="fc" id="L324">    }</span>

    /**
     * Writes a string to the specified DataOutput using
     * &lt;a href=&quot;DataInput.html#modified-utf-8&quot;&gt;modified UTF-8&lt;/a&gt;
     * encoding in a machine-independent manner.
     * &lt;p&gt;
     * First, two bytes are written to out as if by the &lt;code&gt;writeShort&lt;/code&gt;
     * method giving the number of bytes to follow. This value is the number of
     * bytes actually written out, not the length of the string. Following the
     * length, each character of the string is output, in sequence, using the
     * modified UTF-8 encoding for the character. If no exception is thrown, the
     * counter &lt;code&gt;written&lt;/code&gt; is incremented by the total number of
     * bytes written to the output stream. This will be at least two
     * plus the length of &lt;code&gt;str&lt;/code&gt;, and at most two plus
     * thrice the length of &lt;code&gt;str&lt;/code&gt;.
     *
     * @param      str   a string to be written.
     * @param      out   destination to write to
     * @return     The number of bytes written out.
     * @exception  IOException  if an I/O error occurs.
     */
    static int writeUTF(String str, DataOutput out) throws IOException {
<span class="fc" id="L347">        int strlen = str.length();</span>
<span class="fc" id="L348">        int utflen = 0;</span>
<span class="fc" id="L349">        int c, count = 0;</span>

        /* use charAt instead of copying String to char array */
<span class="fc bfc" id="L352" title="All 2 branches covered.">        for (int i = 0; i &lt; strlen; i++) {</span>
<span class="fc" id="L353">            c = str.charAt(i);</span>
<span class="fc bfc" id="L354" title="All 4 branches covered.">            if ((c &gt;= 0x0001) &amp;&amp; (c &lt;= 0x007F)) {</span>
<span class="fc" id="L355">                utflen++;</span>
<span class="fc bfc" id="L356" title="All 2 branches covered.">            } else if (c &gt; 0x07FF) {</span>
<span class="fc" id="L357">                utflen += 3;</span>
            } else {
<span class="fc" id="L359">                utflen += 2;</span>
            }
        }

<span class="pc bpc" id="L363" title="1 of 2 branches missed.">        if (utflen &gt; 65535)</span>
<span class="nc" id="L364">            throw new UTFDataFormatException(</span>
                &quot;encoded string too long: &quot; + utflen + &quot; bytes&quot;);

<span class="fc" id="L367">        byte[] bytearr = null;</span>
<span class="pc bpc" id="L368" title="1 of 2 branches missed.">        if (out instanceof DataOutputStream) {</span>
<span class="fc" id="L369">            DataOutputStream dos = (DataOutputStream)out;</span>
<span class="fc bfc" id="L370" title="All 4 branches covered.">            if(dos.bytearr == null || (dos.bytearr.length &lt; (utflen+2)))</span>
<span class="fc" id="L371">                dos.bytearr = new byte[(utflen*2) + 2];</span>
<span class="fc" id="L372">            bytearr = dos.bytearr;</span>
<span class="fc" id="L373">        } else {</span>
<span class="nc" id="L374">            bytearr = new byte[utflen+2];</span>
        }

<span class="fc" id="L377">        bytearr[count++] = (byte) ((utflen &gt;&gt;&gt; 8) &amp; 0xFF);</span>
<span class="fc" id="L378">        bytearr[count++] = (byte) ((utflen &gt;&gt;&gt; 0) &amp; 0xFF);</span>

<span class="fc" id="L380">        int i=0;</span>
<span class="fc bfc" id="L381" title="All 2 branches covered.">        for (i=0; i&lt;strlen; i++) {</span>
<span class="fc" id="L382">           c = str.charAt(i);</span>
<span class="fc bfc" id="L383" title="All 4 branches covered.">           if (!((c &gt;= 0x0001) &amp;&amp; (c &lt;= 0x007F))) break;</span>
<span class="fc" id="L384">           bytearr[count++] = (byte) c;</span>
        }

<span class="fc bfc" id="L387" title="All 2 branches covered.">        for (;i &lt; strlen; i++){</span>
<span class="fc" id="L388">            c = str.charAt(i);</span>
<span class="fc bfc" id="L389" title="All 4 branches covered.">            if ((c &gt;= 0x0001) &amp;&amp; (c &lt;= 0x007F)) {</span>
<span class="fc" id="L390">                bytearr[count++] = (byte) c;</span>

<span class="fc bfc" id="L392" title="All 2 branches covered.">            } else if (c &gt; 0x07FF) {</span>
<span class="fc" id="L393">                bytearr[count++] = (byte) (0xE0 | ((c &gt;&gt; 12) &amp; 0x0F));</span>
<span class="fc" id="L394">                bytearr[count++] = (byte) (0x80 | ((c &gt;&gt;  6) &amp; 0x3F));</span>
<span class="fc" id="L395">                bytearr[count++] = (byte) (0x80 | ((c &gt;&gt;  0) &amp; 0x3F));</span>
            } else {
<span class="fc" id="L397">                bytearr[count++] = (byte) (0xC0 | ((c &gt;&gt;  6) &amp; 0x1F));</span>
<span class="fc" id="L398">                bytearr[count++] = (byte) (0x80 | ((c &gt;&gt;  0) &amp; 0x3F));</span>
            }
        }
<span class="fc" id="L401">        out.write(bytearr, 0, utflen+2);</span>
<span class="fc" id="L402">        return utflen + 2;</span>
    }

    /**
     * Returns the current value of the counter &lt;code&gt;written&lt;/code&gt;,
     * the number of bytes written to this data output stream so far.
     * If the counter overflows, it will be wrapped to Integer.MAX_VALUE.
     *
     * @return  the value of the &lt;code&gt;written&lt;/code&gt; field.
     * @see     java.io.DataOutputStream#written
     */
    public final int size() {
<span class="fc" id="L414">        return written;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>