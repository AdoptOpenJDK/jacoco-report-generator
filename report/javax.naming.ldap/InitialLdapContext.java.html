<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>InitialLdapContext.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.naming.ldap</a> &gt; <span class="el_source">InitialLdapContext.java</span></div><h1>InitialLdapContext.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.naming.ldap;

import javax.naming.*;
import javax.naming.directory.*;

import java.util.Hashtable;

/**
  * This class is the starting context for performing
  * LDAPv3-style extended operations and controls.
  *&lt;p&gt;
  * See &lt;tt&gt;javax.naming.InitialContext&lt;/tt&gt; and
  * &lt;tt&gt;javax.naming.InitialDirContext&lt;/tt&gt; for details on synchronization,
  * and the policy for how an initial context is created.
  *
  * &lt;h1&gt;Request Controls&lt;/h1&gt;
  * When you create an initial context (&lt;tt&gt;InitialLdapContext&lt;/tt&gt;),
  * you can specify a list of request controls.
  * These controls will be used as the request controls for any
  * implicit LDAP &quot;bind&quot; operation performed by the context or contexts
  * derived from the context. These are called &lt;em&gt;connection request controls&lt;/em&gt;.
  * Use &lt;tt&gt;getConnectControls()&lt;/tt&gt; to get a context's connection request
  * controls.
  *&lt;p&gt;
  * The request controls supplied to the initial context constructor
  * are &lt;em&gt;not&lt;/em&gt; used as the context request controls
  * for subsequent context operations such as searches and lookups.
  * Context request controls are set and updated by using
  * &lt;tt&gt;setRequestControls()&lt;/tt&gt;.
  *&lt;p&gt;
  * As shown, there can be two different sets of request controls
  * associated with a context: connection request controls and context
  * request controls.
  * This is required for those applications needing to send critical
  * controls that might not be applicable to both the context operation and
  * any implicit LDAP &quot;bind&quot; operation.
  * A typical user program would do the following:
  *&lt;blockquote&gt;&lt;pre&gt;
  * InitialLdapContext lctx = new InitialLdapContext(env, critConnCtls);
  * lctx.setRequestControls(critModCtls);
  * lctx.modifyAttributes(name, mods);
  * Controls[] respCtls =  lctx.getResponseControls();
  *&lt;/pre&gt;&lt;/blockquote&gt;
  * It specifies first the critical controls for creating the initial context
  * (&lt;tt&gt;critConnCtls&lt;/tt&gt;), and then sets the context's request controls
  * (&lt;tt&gt;critModCtls&lt;/tt&gt;) for the context operation. If for some reason
  * &lt;tt&gt;lctx&lt;/tt&gt; needs to reconnect to the server, it will use
  * &lt;tt&gt;critConnCtls&lt;/tt&gt;. See the &lt;tt&gt;LdapContext&lt;/tt&gt; interface for
  * more discussion about request controls.
  *&lt;p&gt;
  * Service provider implementors should read the &quot;Service Provider&quot; section
  * in the &lt;tt&gt;LdapContext&lt;/tt&gt; class description for implementation details.
  *
  * @author Rosanna Lee
  * @author Scott Seligman
  * @author Vincent Ryan
  *
  * @see LdapContext
  * @see javax.naming.InitialContext
  * @see javax.naming.directory.InitialDirContext
  * @see javax.naming.spi.NamingManager#setInitialContextFactoryBuilder
  * @since 1.3
  */

public class InitialLdapContext extends InitialDirContext implements LdapContext {
    private static final String
        BIND_CONTROLS_PROPERTY = &quot;java.naming.ldap.control.connect&quot;;

    /**
     * Constructs an initial context using no environment properties or
     * connection request controls.
     * Equivalent to &lt;tt&gt;new InitialLdapContext(null, null)&lt;/tt&gt;.
     *
     * @throws  NamingException if a naming exception is encountered
     */
    public InitialLdapContext() throws NamingException {
<span class="nc" id="L102">        super(null);</span>
<span class="nc" id="L103">    }</span>

    /**
     * Constructs an initial context
     * using environment properties and connection request controls.
     * See &lt;tt&gt;javax.naming.InitialContext&lt;/tt&gt; for a discussion of
     * environment properties.
     *
     * &lt;p&gt; This constructor will not modify its parameters or
     * save references to them, but may save a clone or copy.
     * Caller should not modify mutable keys and values in
     * &lt;tt&gt;environment&lt;/tt&gt; after it has been passed to the constructor.
     *
     * &lt;p&gt; &lt;tt&gt;connCtls&lt;/tt&gt; is used as the underlying context instance's
     * connection request controls.  See the class description
     * for details.
     *
     * @param environment
     *          environment used to create the initial DirContext.
     *          Null indicates an empty environment.
     * @param connCtls
     *          connection request controls for the initial context.
     *          If null, no connection request controls are used.
     *
     * @throws  NamingException if a naming exception is encountered
     *
     * @see #reconnect
     * @see LdapContext#reconnect
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public InitialLdapContext(Hashtable&lt;?,?&gt; environment,
                              Control[] connCtls)
            throws NamingException {
<span class="fc" id="L136">        super(true); // don't initialize yet</span>

        // Clone environment since caller owns it.
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">        Hashtable&lt;Object,Object&gt; env = (environment == null)</span>
            ? new Hashtable&lt;&gt;(11)
<span class="fc" id="L141">            : (Hashtable&lt;Object,Object&gt;)environment.clone();</span>

        // Put connect controls into environment.  Copy them first since
        // caller owns the array.
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">        if (connCtls != null) {</span>
<span class="nc" id="L146">            Control[] copy = new Control[connCtls.length];</span>
<span class="nc" id="L147">            System.arraycopy(connCtls, 0, copy, 0, connCtls.length);</span>
<span class="nc" id="L148">            env.put(BIND_CONTROLS_PROPERTY, copy);</span>
        }
        // set version to LDAPv3
<span class="nc" id="L151">        env.put(&quot;java.naming.ldap.version&quot;, &quot;3&quot;);</span>

        // Initialize with updated environment
<span class="nc" id="L154">        init(env);</span>
<span class="nc" id="L155">    }</span>

    /**
     * Retrieves the initial LDAP context.
     *
     * @return The non-null cached initial context.
     * @exception NotContextException If the initial context is not an
     * instance of &lt;tt&gt;LdapContext&lt;/tt&gt;.
     * @exception NamingException If a naming exception was encountered.
     */
    private LdapContext getDefaultLdapInitCtx() throws NamingException{
<span class="nc" id="L166">        Context answer = getDefaultInitCtx();</span>

<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (!(answer instanceof LdapContext)) {</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (answer == null) {</span>
<span class="nc" id="L170">                throw new NoInitialContextException();</span>
            } else {
<span class="nc" id="L172">                throw new NotContextException(</span>
                    &quot;Not an instance of LdapContext&quot;);
            }
        }
<span class="nc" id="L176">        return (LdapContext)answer;</span>
    }

// LdapContext methods
// Most Javadoc is deferred to the LdapContext interface.

    public ExtendedResponse extendedOperation(ExtendedRequest request)
            throws NamingException {
<span class="nc" id="L184">        return getDefaultLdapInitCtx().extendedOperation(request);</span>
    }

    public LdapContext newInstance(Control[] reqCtls)
        throws NamingException {
<span class="nc" id="L189">            return getDefaultLdapInitCtx().newInstance(reqCtls);</span>
    }

    public void reconnect(Control[] connCtls) throws NamingException {
<span class="nc" id="L193">        getDefaultLdapInitCtx().reconnect(connCtls);</span>
<span class="nc" id="L194">    }</span>

    public Control[] getConnectControls() throws NamingException {
<span class="nc" id="L197">        return getDefaultLdapInitCtx().getConnectControls();</span>
    }

    public void setRequestControls(Control[] requestControls)
        throws NamingException {
<span class="nc" id="L202">            getDefaultLdapInitCtx().setRequestControls(requestControls);</span>
<span class="nc" id="L203">    }</span>

    public Control[] getRequestControls() throws NamingException {
<span class="nc" id="L206">        return getDefaultLdapInitCtx().getRequestControls();</span>
    }

    public Control[] getResponseControls() throws NamingException {
<span class="nc" id="L210">        return getDefaultLdapInitCtx().getResponseControls();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>