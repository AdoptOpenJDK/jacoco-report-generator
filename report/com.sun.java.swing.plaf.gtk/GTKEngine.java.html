<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>GTKEngine.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.gtk</a> &gt; <span class="el_source">GTKEngine.java</span></div><h1>GTKEngine.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2005, 2007, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.java.swing.plaf.gtk;

import java.awt.*;
import java.awt.image.*;
import java.util.HashMap;
import javax.swing.*;
import javax.swing.plaf.synth.*;

import com.sun.java.swing.plaf.gtk.GTKConstants.ArrowType;
import com.sun.java.swing.plaf.gtk.GTKConstants.ExpanderStyle;
import com.sun.java.swing.plaf.gtk.GTKConstants.Orientation;
import com.sun.java.swing.plaf.gtk.GTKConstants.PositionType;
import com.sun.java.swing.plaf.gtk.GTKConstants.ShadowType;
import com.sun.java.swing.plaf.gtk.GTKConstants.TextDirection;

import sun.awt.image.SunWritableRaster;
import sun.swing.ImageCache;

/**
 * GTKEngine delegates all painting job to native GTK libraries.
 *
 * Painting with GTKEngine looks like this:
 * First, startPainting() is called. It prepares an offscreen buffer of the
 *   required size.
 * Then, any number of paintXXX() methods can be called. They effectively ignore
 *   the Graphics parameter and draw to the offscreen buffer.
 * Finally, finishPainting() should be called. It fills the data buffer passed
 *   in with the image data.
 *
 * @author Josh Outwater
 */
<span class="nc" id="L57">class GTKEngine {</span>

<span class="nc" id="L59">    final static GTKEngine INSTANCE = new GTKEngine();</span>

    /** Size of the image cache */
    private static final int CACHE_SIZE = 50;

    /** This enum mirrors that in gtk2_interface.h */
<span class="nc" id="L65">    static enum WidgetType {</span>
<span class="nc" id="L66">        BUTTON, CHECK_BOX, CHECK_BOX_MENU_ITEM, COLOR_CHOOSER,</span>
<span class="nc" id="L67">        COMBO_BOX, COMBO_BOX_ARROW_BUTTON, COMBO_BOX_TEXT_FIELD,</span>
<span class="nc" id="L68">        DESKTOP_ICON, DESKTOP_PANE, EDITOR_PANE, FORMATTED_TEXT_FIELD,</span>
<span class="nc" id="L69">        HANDLE_BOX, HPROGRESS_BAR,</span>
<span class="nc" id="L70">        HSCROLL_BAR, HSCROLL_BAR_BUTTON_LEFT, HSCROLL_BAR_BUTTON_RIGHT,</span>
<span class="nc" id="L71">        HSCROLL_BAR_TRACK, HSCROLL_BAR_THUMB,</span>
<span class="nc" id="L72">        HSEPARATOR, HSLIDER, HSLIDER_TRACK, HSLIDER_THUMB, HSPLIT_PANE_DIVIDER,</span>
<span class="nc" id="L73">        INTERNAL_FRAME, INTERNAL_FRAME_TITLE_PANE, IMAGE, LABEL, LIST, MENU,</span>
<span class="nc" id="L74">        MENU_BAR, MENU_ITEM, MENU_ITEM_ACCELERATOR, OPTION_PANE, PANEL,</span>
<span class="nc" id="L75">        PASSWORD_FIELD, POPUP_MENU, POPUP_MENU_SEPARATOR,</span>
<span class="nc" id="L76">        RADIO_BUTTON, RADIO_BUTTON_MENU_ITEM, ROOT_PANE, SCROLL_PANE,</span>
<span class="nc" id="L77">        SPINNER, SPINNER_ARROW_BUTTON, SPINNER_TEXT_FIELD,</span>
<span class="nc" id="L78">        SPLIT_PANE, TABBED_PANE, TABBED_PANE_TAB_AREA, TABBED_PANE_CONTENT,</span>
<span class="nc" id="L79">        TABBED_PANE_TAB, TABLE, TABLE_HEADER, TEXT_AREA, TEXT_FIELD, TEXT_PANE,</span>
<span class="nc" id="L80">        TITLED_BORDER,</span>
<span class="nc" id="L81">        TOGGLE_BUTTON, TOOL_BAR, TOOL_BAR_DRAG_WINDOW, TOOL_BAR_SEPARATOR,</span>
<span class="nc" id="L82">        TOOL_TIP, TREE, TREE_CELL, VIEWPORT, VPROGRESS_BAR,</span>
<span class="nc" id="L83">        VSCROLL_BAR, VSCROLL_BAR_BUTTON_UP, VSCROLL_BAR_BUTTON_DOWN,</span>
<span class="nc" id="L84">        VSCROLL_BAR_TRACK, VSCROLL_BAR_THUMB,</span>
<span class="nc" id="L85">        VSEPARATOR, VSLIDER, VSLIDER_TRACK, VSLIDER_THUMB,</span>
<span class="nc" id="L86">        VSPLIT_PANE_DIVIDER</span>
    }

    /**
     * Representation of GtkSettings properties.
     * When we need more settings we can add them here and
     * to all implementations of getGTKSetting().
     */
<span class="nc" id="L94">    static enum Settings {</span>
<span class="nc" id="L95">        GTK_FONT_NAME,</span>
<span class="nc" id="L96">        GTK_ICON_SIZES</span>
    }

    /* Custom regions are needed for representing regions that don't exist
     * in the original Region class.
     */
    static class CustomRegion extends Region {
        /*
         * TITLED_BORDER Region is mapped to GtkFrame class which can draw
         * titled borders around components.
         */
<span class="nc" id="L107">        static Region TITLED_BORDER = new CustomRegion(&quot;TitledBorder&quot;);</span>

        private CustomRegion(String name) {
<span class="nc" id="L110">            super(name, null, false);</span>
<span class="nc" id="L111">        }</span>
    }


    private static HashMap&lt;Region, Object&gt; regionToWidgetTypeMap;
<span class="nc" id="L116">    private ImageCache cache = new ImageCache(CACHE_SIZE);</span>
    private int x0, y0, w0, h0;
    private Graphics graphics;
    private Object[] cacheArgs;

    private native void native_paint_arrow(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, int arrowType);
    private native void native_paint_box(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, int synthState, int dir);
    private native void native_paint_box_gap(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height,
            int gapSide, int gapX, int gapWidth);
    private native void native_paint_check(
            int widgetType, int synthState, String detail,
            int x, int y, int width, int height);
    private native void native_paint_expander(
            int widgetType, int state, String detail,
            int x, int y, int width, int height, int expanderStyle);
    private native void native_paint_extension(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, int placement);
    private native void native_paint_flat_box(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, boolean hasFocus);
    private native void native_paint_focus(
            int widgetType, int state, String detail,
            int x, int y, int width, int height);
    private native void native_paint_handle(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, int orientation);
    private native void native_paint_hline(
            int widgetType, int state, String detail,
            int x, int y, int width, int height);
    private native void native_paint_option(
            int widgetType, int synthState, String detail,
            int x, int y, int width, int height);
    private native void native_paint_shadow(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, int synthState, int dir);
    private native void native_paint_slider(
            int widgetType, int state, int shadowType, String detail,
            int x, int y, int width, int height, int orientation);
    private native void native_paint_vline(
            int widgetType, int state, String detail,
            int x, int y, int width, int height);
    private native void native_paint_background(
            int widgetType, int state, int x, int y, int width, int height);
    private native Object native_get_gtk_setting(int property);
    private native void nativeSetRangeValue(int widgetType, double value,
                                            double min, double max,
                                            double visible);

    private native void nativeStartPainting(int w, int h);
    private native int nativeFinishPainting(int[] buffer, int width, int height);
    private native void native_switch_theme();

    static {
        // Make sure the awt toolkit is loaded so we have access to native
        // methods.
<span class="nc" id="L178">        Toolkit.getDefaultToolkit();</span>

        // Initialize regionToWidgetTypeMap
<span class="nc" id="L181">        regionToWidgetTypeMap = new HashMap&lt;Region, Object&gt;(50);</span>
<span class="nc" id="L182">        regionToWidgetTypeMap.put(Region.ARROW_BUTTON, new WidgetType[] {</span>
            WidgetType.SPINNER_ARROW_BUTTON,
            WidgetType.COMBO_BOX_ARROW_BUTTON,
            WidgetType.HSCROLL_BAR_BUTTON_LEFT,
            WidgetType.HSCROLL_BAR_BUTTON_RIGHT,
            WidgetType.VSCROLL_BAR_BUTTON_UP,
            WidgetType.VSCROLL_BAR_BUTTON_DOWN});
<span class="nc" id="L189">        regionToWidgetTypeMap.put(Region.BUTTON, WidgetType.BUTTON);</span>
<span class="nc" id="L190">        regionToWidgetTypeMap.put(Region.CHECK_BOX, WidgetType.CHECK_BOX);</span>
<span class="nc" id="L191">        regionToWidgetTypeMap.put(Region.CHECK_BOX_MENU_ITEM,</span>
                                  WidgetType.CHECK_BOX_MENU_ITEM);
<span class="nc" id="L193">        regionToWidgetTypeMap.put(Region.COLOR_CHOOSER, WidgetType.COLOR_CHOOSER);</span>
<span class="nc" id="L194">        regionToWidgetTypeMap.put(Region.FILE_CHOOSER, WidgetType.OPTION_PANE);</span>
<span class="nc" id="L195">        regionToWidgetTypeMap.put(Region.COMBO_BOX, WidgetType.COMBO_BOX);</span>
<span class="nc" id="L196">        regionToWidgetTypeMap.put(Region.DESKTOP_ICON, WidgetType.DESKTOP_ICON);</span>
<span class="nc" id="L197">        regionToWidgetTypeMap.put(Region.DESKTOP_PANE, WidgetType.DESKTOP_PANE);</span>
<span class="nc" id="L198">        regionToWidgetTypeMap.put(Region.EDITOR_PANE, WidgetType.EDITOR_PANE);</span>
<span class="nc" id="L199">        regionToWidgetTypeMap.put(Region.FORMATTED_TEXT_FIELD, new WidgetType[] {</span>
            WidgetType.FORMATTED_TEXT_FIELD, WidgetType.SPINNER_TEXT_FIELD});
<span class="nc" id="L201">        regionToWidgetTypeMap.put(GTKRegion.HANDLE_BOX, WidgetType.HANDLE_BOX);</span>
<span class="nc" id="L202">        regionToWidgetTypeMap.put(Region.INTERNAL_FRAME,</span>
                                  WidgetType.INTERNAL_FRAME);
<span class="nc" id="L204">        regionToWidgetTypeMap.put(Region.INTERNAL_FRAME_TITLE_PANE,</span>
                                  WidgetType.INTERNAL_FRAME_TITLE_PANE);
<span class="nc" id="L206">        regionToWidgetTypeMap.put(Region.LABEL, new WidgetType[] {</span>
            WidgetType.LABEL, WidgetType.COMBO_BOX_TEXT_FIELD});
<span class="nc" id="L208">        regionToWidgetTypeMap.put(Region.LIST, WidgetType.LIST);</span>
<span class="nc" id="L209">        regionToWidgetTypeMap.put(Region.MENU, WidgetType.MENU);</span>
<span class="nc" id="L210">        regionToWidgetTypeMap.put(Region.MENU_BAR, WidgetType.MENU_BAR);</span>
<span class="nc" id="L211">        regionToWidgetTypeMap.put(Region.MENU_ITEM, WidgetType.MENU_ITEM);</span>
<span class="nc" id="L212">        regionToWidgetTypeMap.put(Region.MENU_ITEM_ACCELERATOR,</span>
                                  WidgetType.MENU_ITEM_ACCELERATOR);
<span class="nc" id="L214">        regionToWidgetTypeMap.put(Region.OPTION_PANE, WidgetType.OPTION_PANE);</span>
<span class="nc" id="L215">        regionToWidgetTypeMap.put(Region.PANEL, WidgetType.PANEL);</span>
<span class="nc" id="L216">        regionToWidgetTypeMap.put(Region.PASSWORD_FIELD,</span>
                                  WidgetType.PASSWORD_FIELD);
<span class="nc" id="L218">        regionToWidgetTypeMap.put(Region.POPUP_MENU, WidgetType.POPUP_MENU);</span>
<span class="nc" id="L219">        regionToWidgetTypeMap.put(Region.POPUP_MENU_SEPARATOR,</span>
                                  WidgetType.POPUP_MENU_SEPARATOR);
<span class="nc" id="L221">        regionToWidgetTypeMap.put(Region.PROGRESS_BAR, new WidgetType[] {</span>
            WidgetType.HPROGRESS_BAR, WidgetType.VPROGRESS_BAR});
<span class="nc" id="L223">        regionToWidgetTypeMap.put(Region.RADIO_BUTTON, WidgetType.RADIO_BUTTON);</span>
<span class="nc" id="L224">        regionToWidgetTypeMap.put(Region.RADIO_BUTTON_MENU_ITEM,</span>
                                  WidgetType.RADIO_BUTTON_MENU_ITEM);
<span class="nc" id="L226">        regionToWidgetTypeMap.put(Region.ROOT_PANE, WidgetType.ROOT_PANE);</span>
<span class="nc" id="L227">        regionToWidgetTypeMap.put(Region.SCROLL_BAR, new WidgetType[] {</span>
            WidgetType.HSCROLL_BAR, WidgetType.VSCROLL_BAR});
<span class="nc" id="L229">        regionToWidgetTypeMap.put(Region.SCROLL_BAR_THUMB, new WidgetType[] {</span>
            WidgetType.HSCROLL_BAR_THUMB, WidgetType.VSCROLL_BAR_THUMB});
<span class="nc" id="L231">        regionToWidgetTypeMap.put(Region.SCROLL_BAR_TRACK, new WidgetType[] {</span>
            WidgetType.HSCROLL_BAR_TRACK, WidgetType.VSCROLL_BAR_TRACK});
<span class="nc" id="L233">        regionToWidgetTypeMap.put(Region.SCROLL_PANE, WidgetType.SCROLL_PANE);</span>
<span class="nc" id="L234">        regionToWidgetTypeMap.put(Region.SEPARATOR, new WidgetType[] {</span>
            WidgetType.HSEPARATOR, WidgetType.VSEPARATOR});
<span class="nc" id="L236">        regionToWidgetTypeMap.put(Region.SLIDER, new WidgetType[] {</span>
            WidgetType.HSLIDER, WidgetType.VSLIDER});
<span class="nc" id="L238">        regionToWidgetTypeMap.put(Region.SLIDER_THUMB, new WidgetType[] {</span>
            WidgetType.HSLIDER_THUMB, WidgetType.VSLIDER_THUMB});
<span class="nc" id="L240">        regionToWidgetTypeMap.put(Region.SLIDER_TRACK, new WidgetType[] {</span>
            WidgetType.HSLIDER_TRACK, WidgetType.VSLIDER_TRACK});
<span class="nc" id="L242">        regionToWidgetTypeMap.put(Region.SPINNER, WidgetType.SPINNER);</span>
<span class="nc" id="L243">        regionToWidgetTypeMap.put(Region.SPLIT_PANE, WidgetType.SPLIT_PANE);</span>
<span class="nc" id="L244">        regionToWidgetTypeMap.put(Region.SPLIT_PANE_DIVIDER, new WidgetType[] {</span>
            WidgetType.HSPLIT_PANE_DIVIDER, WidgetType.VSPLIT_PANE_DIVIDER});
<span class="nc" id="L246">        regionToWidgetTypeMap.put(Region.TABBED_PANE, WidgetType.TABBED_PANE);</span>
<span class="nc" id="L247">        regionToWidgetTypeMap.put(Region.TABBED_PANE_CONTENT,</span>
                                  WidgetType.TABBED_PANE_CONTENT);
<span class="nc" id="L249">        regionToWidgetTypeMap.put(Region.TABBED_PANE_TAB,</span>
                                  WidgetType.TABBED_PANE_TAB);
<span class="nc" id="L251">        regionToWidgetTypeMap.put(Region.TABBED_PANE_TAB_AREA,</span>
                                  WidgetType.TABBED_PANE_TAB_AREA);
<span class="nc" id="L253">        regionToWidgetTypeMap.put(Region.TABLE, WidgetType.TABLE);</span>
<span class="nc" id="L254">        regionToWidgetTypeMap.put(Region.TABLE_HEADER, WidgetType.TABLE_HEADER);</span>
<span class="nc" id="L255">        regionToWidgetTypeMap.put(Region.TEXT_AREA, WidgetType.TEXT_AREA);</span>
<span class="nc" id="L256">        regionToWidgetTypeMap.put(Region.TEXT_FIELD, new WidgetType[] {</span>
            WidgetType.TEXT_FIELD, WidgetType.COMBO_BOX_TEXT_FIELD});
<span class="nc" id="L258">        regionToWidgetTypeMap.put(Region.TEXT_PANE, WidgetType.TEXT_PANE);</span>
<span class="nc" id="L259">        regionToWidgetTypeMap.put(CustomRegion.TITLED_BORDER, WidgetType.TITLED_BORDER);</span>
<span class="nc" id="L260">        regionToWidgetTypeMap.put(Region.TOGGLE_BUTTON, WidgetType.TOGGLE_BUTTON);</span>
<span class="nc" id="L261">        regionToWidgetTypeMap.put(Region.TOOL_BAR, WidgetType.TOOL_BAR);</span>
<span class="nc" id="L262">        regionToWidgetTypeMap.put(Region.TOOL_BAR_CONTENT, WidgetType.TOOL_BAR);</span>
<span class="nc" id="L263">        regionToWidgetTypeMap.put(Region.TOOL_BAR_DRAG_WINDOW,</span>
                                  WidgetType.TOOL_BAR_DRAG_WINDOW);
<span class="nc" id="L265">        regionToWidgetTypeMap.put(Region.TOOL_BAR_SEPARATOR,</span>
                                  WidgetType.TOOL_BAR_SEPARATOR);
<span class="nc" id="L267">        regionToWidgetTypeMap.put(Region.TOOL_TIP, WidgetType.TOOL_TIP);</span>
<span class="nc" id="L268">        regionToWidgetTypeMap.put(Region.TREE, WidgetType.TREE);</span>
<span class="nc" id="L269">        regionToWidgetTypeMap.put(Region.TREE_CELL, WidgetType.TREE_CELL);</span>
<span class="nc" id="L270">        regionToWidgetTypeMap.put(Region.VIEWPORT, WidgetType.VIEWPORT);</span>
    }

    /** Translate Region and JComponent into WidgetType ordinals */
    static WidgetType getWidgetType(JComponent c, Region id) {
<span class="nc" id="L275">        Object value = regionToWidgetTypeMap.get(id);</span>

<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (value instanceof WidgetType) {</span>
<span class="nc" id="L278">            return (WidgetType)value;</span>
        }

<span class="nc" id="L281">        WidgetType[] widgets = (WidgetType[])value;</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (c == null ) {</span>
<span class="nc" id="L283">            return widgets[0];</span>
        }

<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (c instanceof JScrollBar) {</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">            return (((JScrollBar)c).getOrientation() == JScrollBar.HORIZONTAL) ?</span>
                widgets[0] : widgets[1];
<span class="nc bnc" id="L289" title="All 2 branches missed.">        } else if (c instanceof JSeparator) {</span>
<span class="nc" id="L290">            JSeparator separator = (JSeparator)c;</span>

            /* We should return correrct WidgetType if the seperator is inserted
             * in Menu/PopupMenu/ToolBar. BugID: 6465603
             */
<span class="nc bnc" id="L295" title="All 2 branches missed.">            if (separator.getParent() instanceof JPopupMenu) {</span>
<span class="nc" id="L296">                return WidgetType.POPUP_MENU_SEPARATOR;</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">            } else if (separator.getParent() instanceof JToolBar) {</span>
<span class="nc" id="L298">                return WidgetType.TOOL_BAR_SEPARATOR;</span>
            }

<span class="nc bnc" id="L301" title="All 2 branches missed.">            return (separator.getOrientation() == JSeparator.HORIZONTAL) ?</span>
                widgets[0] : widgets[1];
<span class="nc bnc" id="L303" title="All 2 branches missed.">        } else if (c instanceof JSlider) {</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">            return (((JSlider)c).getOrientation() == JSlider.HORIZONTAL) ?</span>
                widgets[0] : widgets[1];
<span class="nc bnc" id="L306" title="All 2 branches missed.">        } else if (c instanceof JProgressBar) {</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">            return (((JProgressBar)c).getOrientation() == JProgressBar.HORIZONTAL) ?</span>
                widgets[0] : widgets[1];
<span class="nc bnc" id="L309" title="All 2 branches missed.">        } else if (c instanceof JSplitPane) {</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">            return (((JSplitPane)c).getOrientation() == JSplitPane.HORIZONTAL_SPLIT) ?</span>
                widgets[1] : widgets[0];
<span class="nc bnc" id="L312" title="All 2 branches missed.">        } else if (id == Region.LABEL) {</span>
            /*
             * For all ListCellRenderers we will use COMBO_BOX_TEXT_FIELD widget
             * type because we can get correct insets. List items however won't be
             * drawn as a text entry (see GTKPainter.paintLabelBackground).
             */
<span class="nc bnc" id="L318" title="All 2 branches missed.">            if (c instanceof ListCellRenderer) {</span>
<span class="nc" id="L319">                return widgets[1];</span>
            } else {
<span class="nc" id="L321">                return widgets[0];</span>
            }
<span class="nc bnc" id="L323" title="All 2 branches missed.">        } else if (id == Region.TEXT_FIELD) {</span>
<span class="nc" id="L324">            String name = c.getName();</span>
<span class="nc bnc" id="L325" title="All 4 branches missed.">            if (name != null &amp;&amp; name.startsWith(&quot;ComboBox&quot;)) {</span>
<span class="nc" id="L326">                return widgets[1];</span>
            } else {
<span class="nc" id="L328">                return widgets[0];</span>
            }
<span class="nc bnc" id="L330" title="All 2 branches missed.">        } else if (id == Region.FORMATTED_TEXT_FIELD) {</span>
<span class="nc" id="L331">            String name = c.getName();</span>
<span class="nc bnc" id="L332" title="All 4 branches missed.">            if (name != null &amp;&amp; name.startsWith(&quot;Spinner&quot;)) {</span>
<span class="nc" id="L333">                return widgets[1];</span>
            } else {
<span class="nc" id="L335">                return widgets[0];</span>
            }
<span class="nc bnc" id="L337" title="All 2 branches missed.">        } else if (id == Region.ARROW_BUTTON) {</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">            if (c.getParent() instanceof JScrollBar) {</span>
<span class="nc" id="L339">                Integer prop = (Integer)</span>
<span class="nc" id="L340">                    c.getClientProperty(&quot;__arrow_direction__&quot;);</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                int dir = (prop != null) ?</span>
<span class="nc" id="L342">                    prop.intValue() : SwingConstants.WEST;</span>
<span class="nc bnc" id="L343" title="All 5 branches missed.">                switch (dir) {</span>
                case SwingConstants.WEST:
<span class="nc" id="L345">                    return WidgetType.HSCROLL_BAR_BUTTON_LEFT;</span>
                case SwingConstants.EAST:
<span class="nc" id="L347">                    return WidgetType.HSCROLL_BAR_BUTTON_RIGHT;</span>
                case SwingConstants.NORTH:
<span class="nc" id="L349">                    return WidgetType.VSCROLL_BAR_BUTTON_UP;</span>
                case SwingConstants.SOUTH:
<span class="nc" id="L351">                    return WidgetType.VSCROLL_BAR_BUTTON_DOWN;</span>
                default:
<span class="nc" id="L353">                    return null;</span>
                }
<span class="nc bnc" id="L355" title="All 2 branches missed.">            } else if (c.getParent() instanceof JComboBox) {</span>
<span class="nc" id="L356">                return WidgetType.COMBO_BOX_ARROW_BUTTON;</span>
            } else {
<span class="nc" id="L358">                return WidgetType.SPINNER_ARROW_BUTTON;</span>
            }
        }

<span class="nc" id="L362">        return null;</span>
    }

    private static int getTextDirection(SynthContext context) {
<span class="nc" id="L366">        TextDirection dir = TextDirection.NONE;</span>
<span class="nc" id="L367">        JComponent comp = context.getComponent();</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (comp != null) {</span>
<span class="nc" id="L369">            ComponentOrientation co = comp.getComponentOrientation();</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">            if (co != null) {</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">                dir = co.isLeftToRight() ?</span>
                    TextDirection.LTR : TextDirection.RTL;
            }
        }
<span class="nc" id="L375">        return dir.ordinal();</span>
    }

    public void paintArrow(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType, ArrowType direction,
            String detail, int x, int y, int w, int h) {

<span class="nc" id="L382">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L383">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L384">        native_paint_arrow(widget, state, shadowType.ordinal(),</span>
<span class="nc" id="L385">                detail, x - x0, y - y0, w, h, direction.ordinal());</span>
<span class="nc" id="L386">    }</span>

    public void paintBox(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType,
            String detail, int x, int y, int w, int h) {

<span class="nc" id="L392">        int gtkState =</span>
<span class="nc" id="L393">            GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L394">        int synthState = context.getComponentState();</span>
<span class="nc" id="L395">        int dir = getTextDirection(context);</span>
<span class="nc" id="L396">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L397">        native_paint_box(widget, gtkState, shadowType.ordinal(),</span>
                         detail, x - x0, y - y0, w, h, synthState, dir);
<span class="nc" id="L399">    }</span>

    public void paintBoxGap(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType,
            String detail, int x, int y, int w, int h,
            PositionType boxGapType, int tabBegin, int size) {

<span class="nc" id="L406">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L407">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L408">        native_paint_box_gap(widget, state, shadowType.ordinal(), detail,</span>
<span class="nc" id="L409">                x - x0, y - y0, w, h, boxGapType.ordinal(), tabBegin, size);</span>
<span class="nc" id="L410">    }</span>

    public void paintCheck(Graphics g, SynthContext context,
            Region id, String detail, int x, int y, int w, int h) {

<span class="nc" id="L415">        int synthState = context.getComponentState();</span>
<span class="nc" id="L416">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L417">        native_paint_check(widget, synthState, detail, x - x0, y - y0, w, h);</span>
<span class="nc" id="L418">    }</span>

    public void paintExpander(Graphics g, SynthContext context,
            Region id, int state, ExpanderStyle expanderStyle, String detail,
            int x, int y, int w, int h) {

<span class="nc" id="L424">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L425">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L426">        native_paint_expander(widget, state, detail, x - x0, y - y0, w, h,</span>
<span class="nc" id="L427">                              expanderStyle.ordinal());</span>
<span class="nc" id="L428">    }</span>

    public void paintExtension(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType, String detail,
            int x, int y, int w, int h, PositionType placement, int tabIndex) {

<span class="nc" id="L434">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L435">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L436">        native_paint_extension(widget, state, shadowType.ordinal(), detail,</span>
<span class="nc" id="L437">                               x - x0, y - y0, w, h, placement.ordinal());</span>
<span class="nc" id="L438">    }</span>

    public void paintFlatBox(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType, String detail,
            int x, int y, int w, int h, ColorType colorType) {

<span class="nc" id="L444">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L445">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L446">        native_paint_flat_box(widget, state, shadowType.ordinal(), detail,</span>
                              x - x0, y - y0, w, h,
<span class="nc" id="L448">                              context.getComponent().hasFocus());</span>
<span class="nc" id="L449">    }</span>

    public void paintFocus(Graphics g, SynthContext context,
            Region id, int state, String detail, int x, int y, int w, int h) {

<span class="nc" id="L454">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L455">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L456">        native_paint_focus(widget, state, detail, x - x0, y - y0, w, h);</span>
<span class="nc" id="L457">    }</span>

    public void paintHandle(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType, String detail,
            int x, int y, int w, int h, Orientation orientation) {

<span class="nc" id="L463">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L464">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L465">        native_paint_handle(widget, state, shadowType.ordinal(), detail,</span>
<span class="nc" id="L466">                            x - x0, y - y0, w, h, orientation.ordinal());</span>
<span class="nc" id="L467">    }</span>

    public void paintHline(Graphics g, SynthContext context,
            Region id, int state, String detail, int x, int y, int w, int h) {

<span class="nc" id="L472">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L473">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L474">        native_paint_hline(widget, state, detail, x - x0, y - y0, w, h);</span>
<span class="nc" id="L475">    }</span>

    public void paintOption(Graphics g, SynthContext context,
            Region id, String detail, int x, int y, int w, int h) {

<span class="nc" id="L480">        int synthState = context.getComponentState();</span>
<span class="nc" id="L481">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L482">        native_paint_option(widget, synthState, detail, x - x0, y - y0, w, h);</span>
<span class="nc" id="L483">    }</span>

    public void paintShadow(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType, String detail,
            int x, int y, int w, int h) {

<span class="nc" id="L489">        int gtkState =</span>
<span class="nc" id="L490">            GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L491">        int synthState = context.getComponentState();</span>
<span class="nc" id="L492">        int dir = getTextDirection(context);</span>
<span class="nc" id="L493">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L494">        native_paint_shadow(widget, gtkState, shadowType.ordinal(), detail,</span>
                            x - x0, y - y0, w, h, synthState, dir);
<span class="nc" id="L496">    }</span>

    public void paintSlider(Graphics g, SynthContext context,
            Region id, int state, ShadowType shadowType, String detail,
            int x, int y, int w, int h, Orientation orientation) {

<span class="nc" id="L502">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L503">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L504">        native_paint_slider(widget, state, shadowType.ordinal(), detail,</span>
<span class="nc" id="L505">                            x - x0, y - y0, w, h, orientation.ordinal());</span>
<span class="nc" id="L506">    }</span>

    public void paintVline(Graphics g, SynthContext context,
            Region id, int state, String detail, int x, int y, int w, int h) {

<span class="nc" id="L511">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L512">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L513">        native_paint_vline(widget, state, detail, x - x0, y - y0, w, h);</span>
<span class="nc" id="L514">    }</span>

    public void paintBackground(Graphics g, SynthContext context,
            Region id, int state, Color color, int x, int y, int w, int h) {

<span class="nc" id="L519">        state = GTKLookAndFeel.synthStateToGTKStateType(state).ordinal();</span>
<span class="nc" id="L520">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L521">        native_paint_background(widget, state, x - x0, y - y0, w, h);</span>
<span class="nc" id="L522">    }</span>

<span class="nc" id="L524">    private final static ColorModel[] COLOR_MODELS = {</span>
        // Transparency.OPAQUE
        new DirectColorModel(24, 0x00ff0000, 0x0000ff00, 0x000000ff, 0x00000000),
        // Transparency.BITMASK
        new DirectColorModel(25, 0x00ff0000, 0x0000ff00, 0x000000ff, 0x01000000),
        // Transparency.TRANSLUCENT
<span class="nc" id="L530">        ColorModel.getRGBdefault(),</span>
    };

<span class="nc" id="L533">    private final static int[][] BAND_OFFSETS = {</span>
        { 0x00ff0000, 0x0000ff00, 0x000000ff },             // OPAQUE
        { 0x00ff0000, 0x0000ff00, 0x000000ff, 0x01000000 }, // BITMASK
        { 0x00ff0000, 0x0000ff00, 0x000000ff, 0xff000000 }  // TRANSLUCENT
    };


    /**
     * Paint a cached image identified by its size and a set of additional
     * arguments, if there's one.
     *
     * @return true if a cached image has been painted, false otherwise
     */
    public boolean paintCachedImage(Graphics g,
            int x, int y, int w, int h, Object... args) {
<span class="nc bnc" id="L548" title="All 4 branches missed.">        if (w &lt;= 0 || h &lt;= 0) {</span>
<span class="nc" id="L549">            return true;</span>
        }

        // look for cached image
<span class="nc" id="L553">        Image img = cache.getImage(getClass(), null, w, h, args);</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (img != null) {</span>
<span class="nc" id="L555">            g.drawImage(img, x, y, null);</span>
<span class="nc" id="L556">            return true;</span>
        }
<span class="nc" id="L558">        return false;</span>
    }

    /*
     * Allocate a native offscreen buffer of the specified size.
     */
    public void startPainting(Graphics g,
            int x, int y, int w, int h, Object... args) {
<span class="nc" id="L566">        nativeStartPainting(w, h);</span>
<span class="nc" id="L567">        x0 = x;</span>
<span class="nc" id="L568">        y0 = y;</span>
<span class="nc" id="L569">        w0 = w;</span>
<span class="nc" id="L570">        h0 = h;</span>
<span class="nc" id="L571">        graphics = g;</span>
<span class="nc" id="L572">        cacheArgs = args;</span>
<span class="nc" id="L573">    }</span>

    /**
     * Convenience method that delegates to finishPainting() with
     * caching enabled.
     */
    public void finishPainting() {
<span class="nc" id="L580">        finishPainting(true);</span>
<span class="nc" id="L581">    }</span>

    /**
     * Called to indicate that painting is finished. We create a new
     * BufferedImage from the offscreen buffer, (optionally) cache it,
     * and paint it.
     */
    public void finishPainting(boolean useCache) {
<span class="nc" id="L589">        DataBufferInt dataBuffer = new DataBufferInt(w0 * h0);</span>
        // Note that stealData() requires a markDirty() afterwards
        // since we modify the data in it.
<span class="nc" id="L592">        int transparency =</span>
<span class="nc" id="L593">            nativeFinishPainting(SunWritableRaster.stealData(dataBuffer, 0),</span>
                                 w0, h0);
<span class="nc" id="L595">        SunWritableRaster.markDirty(dataBuffer);</span>

<span class="nc" id="L597">        int[] bands = BAND_OFFSETS[transparency - 1];</span>
<span class="nc" id="L598">        WritableRaster raster = Raster.createPackedRaster(</span>
                dataBuffer, w0, h0, w0, bands, null);

<span class="nc" id="L601">        ColorModel cm = COLOR_MODELS[transparency - 1];</span>
<span class="nc" id="L602">        Image img = new BufferedImage(cm, raster, false, null);</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">        if (useCache) {</span>
<span class="nc" id="L604">            cache.setImage(getClass(), null, w0, h0, cacheArgs, img);</span>
        }
<span class="nc" id="L606">        graphics.drawImage(img, x0, y0, null);</span>
<span class="nc" id="L607">    }</span>

    /**
     * Notify native layer of theme change, and flush cache
     */
    public void themeChanged() {
<span class="nc" id="L613">        synchronized(sun.awt.UNIXToolkit.GTK_LOCK) {</span>
<span class="nc" id="L614">            native_switch_theme();</span>
<span class="nc" id="L615">        }</span>
<span class="nc" id="L616">        cache.flush();</span>
<span class="nc" id="L617">    }</span>

    /* GtkSettings enum mirrors that in gtk2_interface.h */
    public Object getSetting(Settings property) {
<span class="nc" id="L621">        synchronized(sun.awt.UNIXToolkit.GTK_LOCK) {</span>
<span class="nc" id="L622">            return native_get_gtk_setting(property.ordinal());</span>
<span class="nc" id="L623">        }</span>
    }

    /**
     * Sets up the GtkAdjustment values for the native GtkRange widget
     * associated with the given region (e.g. SLIDER, SCROLL_BAR).
     */
    void setRangeValue(SynthContext context, Region id,
                       double value, double min, double max, double visible) {
<span class="nc" id="L632">        int widget = getWidgetType(context.getComponent(), id).ordinal();</span>
<span class="nc" id="L633">        nativeSetRangeValue(widget, value, min, max, visible);</span>
<span class="nc" id="L634">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>