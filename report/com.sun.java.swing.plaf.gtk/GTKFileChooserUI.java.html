<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>GTKFileChooserUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.gtk</a> &gt; <span class="el_source">GTKFileChooserUI.java</span></div><h1>GTKFileChooserUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.java.swing.plaf.gtk;

import java.awt.*;
import java.awt.event.*;
import java.beans.*;
import java.io.File;
import java.io.IOException;
import java.text.MessageFormat;
import java.util.*;

import javax.swing.*;
import javax.swing.border.*;
import javax.swing.filechooser.*;
import javax.swing.event.*;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.BasicDirectoryModel;
import javax.swing.table.*;
import javax.accessibility.*;

import sun.swing.AbstractFilterComboBoxModel;
import sun.swing.SwingUtilities2;

import sun.swing.plaf.synth.*;
import sun.swing.FilePane;
import sun.awt.shell.ShellFolder;

/**
 * GTK FileChooserUI.
 *
 * @author Leif Samuelsson
 * @author Jeff Dinkins
 */
class GTKFileChooserUI extends SynthFileChooserUI {

    // The accessoryPanel is a container to place the JFileChooser accessory component
<span class="nc" id="L60">    private JPanel accessoryPanel = null;</span>

<span class="nc" id="L62">    private String newFolderButtonText = null;</span>
<span class="nc" id="L63">    private String newFolderErrorSeparator = null;</span>
<span class="nc" id="L64">    private String newFolderErrorText = null;</span>
<span class="nc" id="L65">    private String newFolderDialogText = null;</span>
<span class="nc" id="L66">    private String newFolderNoDirectoryErrorTitleText = null;</span>
<span class="nc" id="L67">    private String newFolderNoDirectoryErrorText = null;</span>

<span class="nc" id="L69">    private String deleteFileButtonText = null;</span>
<span class="nc" id="L70">    private String renameFileButtonText = null;</span>

<span class="nc" id="L72">    private String newFolderButtonToolTipText = null;</span>
<span class="nc" id="L73">    private String deleteFileButtonToolTipText = null;</span>
<span class="nc" id="L74">    private String renameFileButtonToolTipText = null;</span>

<span class="nc" id="L76">    private int newFolderButtonMnemonic = 0;</span>
<span class="nc" id="L77">    private int deleteFileButtonMnemonic = 0;</span>
<span class="nc" id="L78">    private int renameFileButtonMnemonic = 0;</span>
<span class="nc" id="L79">    private int foldersLabelMnemonic = 0;</span>
<span class="nc" id="L80">    private int filesLabelMnemonic = 0;</span>

<span class="nc" id="L82">    private String renameFileDialogText = null;</span>
<span class="nc" id="L83">    private String renameFileErrorTitle = null;</span>
<span class="nc" id="L84">    private String renameFileErrorText = null;</span>

    private JComboBox filterComboBox;
    private FilterComboBoxModel filterComboBoxModel;

    // From Motif

    private JPanel rightPanel;
    private JList directoryList;
    private JList fileList;

    private JLabel pathField;
    private JTextField fileNameTextField;

<span class="nc" id="L98">    private static final Dimension hstrut3 = new Dimension(3, 1);</span>
<span class="nc" id="L99">    private static final Dimension vstrut10 = new Dimension(1, 10);</span>

<span class="nc" id="L101">    private static Dimension prefListSize = new Dimension(75, 150);</span>

<span class="nc" id="L103">    private static Dimension PREF_SIZE = new Dimension(435, 360);</span>
<span class="nc" id="L104">    private static Dimension MIN_SIZE = new Dimension(200, 300);</span>

<span class="nc" id="L106">    private static Dimension ZERO_ACC_SIZE = new Dimension(1, 1);</span>

<span class="nc" id="L108">    private static Dimension MAX_SIZE = new Dimension(Short.MAX_VALUE, Short.MAX_VALUE);</span>

<span class="nc" id="L110">    private static final Insets buttonMargin = new Insets(3, 3, 3, 3);</span>

<span class="nc" id="L112">    private String filesLabelText = null;</span>
<span class="nc" id="L113">    private String foldersLabelText = null;</span>
<span class="nc" id="L114">    private String pathLabelText = null;</span>
<span class="nc" id="L115">    private String filterLabelText = null;</span>

<span class="nc" id="L117">    private int pathLabelMnemonic = 0;</span>
<span class="nc" id="L118">    private int filterLabelMnemonic = 0;</span>

    private JComboBox directoryComboBox;
    private DirectoryComboBoxModel directoryComboBoxModel;
<span class="nc" id="L122">    private Action directoryComboBoxAction = new DirectoryComboBoxAction();</span>
    private JPanel bottomButtonPanel;
<span class="nc" id="L124">    private GTKDirectoryModel model = null;</span>
    private Action newFolderAction;
    private boolean readOnly;
    private boolean showDirectoryIcons;
    private boolean showFileIcons;
<span class="nc" id="L129">    private GTKFileView fileView = new GTKFileView();</span>
    private PropertyChangeListener gtkFCPropertyChangeListener;
<span class="nc" id="L131">    private Action approveSelectionAction = new GTKApproveSelectionAction();</span>
    private GTKDirectoryListModel directoryListModel;

    public GTKFileChooserUI(JFileChooser filechooser) {
<span class="nc" id="L135">        super(filechooser);</span>
<span class="nc" id="L136">    }</span>

    protected ActionMap createActionMap() {
<span class="nc" id="L139">        ActionMap map = new ActionMapUIResource();</span>
<span class="nc" id="L140">        map.put(&quot;approveSelection&quot;, getApproveSelectionAction());</span>
<span class="nc" id="L141">        map.put(&quot;cancelSelection&quot;, getCancelSelectionAction());</span>
<span class="nc" id="L142">        map.put(&quot;Go Up&quot;, getChangeToParentDirectoryAction());</span>
<span class="nc" id="L143">        map.put(&quot;fileNameCompletion&quot;, getFileNameCompletionAction());</span>
<span class="nc" id="L144">        return map;</span>
    }

    public String getFileName() {
<span class="nc" id="L148">        JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">        String typedInName = fileNameTextField != null ?</span>
<span class="nc" id="L150">            fileNameTextField.getText() : null;</span>

<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (!fc.isMultiSelectionEnabled()) {</span>
<span class="nc" id="L153">            return typedInName;</span>
        }

<span class="nc" id="L156">        int mode = fc.getFileSelectionMode();</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        JList list = mode == JFileChooser.DIRECTORIES_ONLY ?</span>
            directoryList : fileList;
<span class="nc" id="L159">        Object[] files = list.getSelectedValues();</span>
<span class="nc" id="L160">        int len = files.length;</span>
<span class="nc" id="L161">        Vector&lt;String&gt; result = new Vector&lt;String&gt;(len + 1);</span>

        // we return all selected file names
<span class="nc bnc" id="L164" title="All 2 branches missed.">        for (int i = 0; i &lt; len; i++) {</span>
<span class="nc" id="L165">            File file = (File)files[i];</span>
<span class="nc" id="L166">            result.add(file.getName());</span>
        }
        // plus the file name typed into the text field, if not already there
<span class="nc bnc" id="L169" title="All 4 branches missed.">        if (typedInName != null &amp;&amp; !result.contains(typedInName)) {</span>
<span class="nc" id="L170">            result.add(typedInName);</span>
        }

<span class="nc" id="L173">        StringBuffer buf = new StringBuffer();</span>
<span class="nc" id="L174">        len = result.size();</span>

        // construct the resulting string
<span class="nc bnc" id="L177" title="All 2 branches missed.">        for (int i=0; i&lt;len; i++) {</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (i &gt; 0) {</span>
<span class="nc" id="L179">                buf.append(&quot; &quot;);</span>
            }
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (len &gt; 1) {</span>
<span class="nc" id="L182">                buf.append(&quot;\&quot;&quot;);</span>
            }
<span class="nc" id="L184">            buf.append(result.get(i));</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">            if (len &gt; 1) {</span>
<span class="nc" id="L186">                buf.append(&quot;\&quot;&quot;);</span>
            }
        }
<span class="nc" id="L189">        return buf.toString();</span>
    }

    public void setFileName(String fileName) {
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (fileNameTextField != null) {</span>
<span class="nc" id="L194">            fileNameTextField.setText(fileName);</span>
        }
<span class="nc" id="L196">    }</span>

//     public String getDirectoryName() {
//      return pathField.getText();
//     }

    public void setDirectoryName(String dirname) {
<span class="nc" id="L203">        pathField.setText(dirname);</span>
<span class="nc" id="L204">    }</span>

    public void ensureFileIsVisible(JFileChooser fc, File f) {
        // PENDING
<span class="nc" id="L208">    }</span>

    public void rescanCurrentDirectory(JFileChooser fc) {
<span class="nc" id="L211">        getModel().validateFileCache();</span>
<span class="nc" id="L212">    }</span>

    public JPanel getAccessoryPanel() {
<span class="nc" id="L215">        return accessoryPanel;</span>
    }

    // ***********************
    // * FileView operations *
    // ***********************

    public FileView getFileView(JFileChooser fc) {
<span class="nc" id="L223">        return fileView;</span>
    }

    private class GTKFileView extends BasicFileView {
<span class="nc" id="L227">        public GTKFileView() {</span>
<span class="nc" id="L228">            iconCache = null;</span>
<span class="nc" id="L229">        }</span>

        public void clearIconCache() {
<span class="nc" id="L232">        }</span>

        public Icon getCachedIcon(File f) {
<span class="nc" id="L235">            return null;</span>
        }

        public void cacheIcon(File f, Icon i) {
<span class="nc" id="L239">        }</span>

        public Icon getIcon(File f) {
<span class="nc bnc" id="L242" title="All 4 branches missed.">            return (f != null &amp;&amp; f.isDirectory()) ? directoryIcon : fileIcon;</span>
        }
    }


    private void updateDefaultButton() {
<span class="nc" id="L248">        JFileChooser filechooser = getFileChooser();</span>
<span class="nc" id="L249">        JRootPane root = SwingUtilities.getRootPane(filechooser);</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (root == null) {</span>
<span class="nc" id="L251">            return;</span>
        }

<span class="nc bnc" id="L254" title="All 2 branches missed.">        if (filechooser.getControlButtonsAreShown()) {</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">            if (root.getDefaultButton() == null) {</span>
<span class="nc" id="L256">                root.setDefaultButton(getApproveButton(filechooser));</span>
<span class="nc" id="L257">                getCancelButton(filechooser).setDefaultCapable(false);</span>
            }
        } else {
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (root.getDefaultButton() == getApproveButton(filechooser)) {</span>
<span class="nc" id="L261">                root.setDefaultButton(null);</span>
            }
        }
<span class="nc" id="L264">    }</span>

    protected void doSelectedFileChanged(PropertyChangeEvent e) {
<span class="nc" id="L267">        super.doSelectedFileChanged(e);</span>
<span class="nc" id="L268">        File f = (File) e.getNewValue();</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (f != null) {</span>
<span class="nc" id="L270">            setFileName(getFileChooser().getName(f));</span>
        }
<span class="nc" id="L272">    }</span>

    protected void doDirectoryChanged(PropertyChangeEvent e) {
<span class="nc" id="L275">        directoryList.clearSelection();</span>
<span class="nc" id="L276">        ListSelectionModel sm = directoryList.getSelectionModel();</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (sm instanceof DefaultListSelectionModel) {</span>
<span class="nc" id="L278">            ((DefaultListSelectionModel)sm).moveLeadSelectionIndex(0);</span>
<span class="nc" id="L279">            sm.setAnchorSelectionIndex(0);</span>
        }
<span class="nc" id="L281">        fileList.clearSelection();</span>
<span class="nc" id="L282">        sm = fileList.getSelectionModel();</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (sm instanceof DefaultListSelectionModel) {</span>
<span class="nc" id="L284">            ((DefaultListSelectionModel)sm).moveLeadSelectionIndex(0);</span>
<span class="nc" id="L285">            sm.setAnchorSelectionIndex(0);</span>
        }

<span class="nc" id="L288">        File currentDirectory = getFileChooser().getCurrentDirectory();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if (currentDirectory != null) {</span>
            try {
<span class="nc" id="L291">                setDirectoryName(ShellFolder.getNormalizedFile((File)e.getNewValue()).getPath());</span>
<span class="nc" id="L292">            } catch (IOException ioe) {</span>
<span class="nc" id="L293">                setDirectoryName(((File)e.getNewValue()).getAbsolutePath());</span>
<span class="nc" id="L294">            }</span>
<span class="nc bnc" id="L295" title="All 4 branches missed.">            if ((getFileChooser().getFileSelectionMode() == JFileChooser.DIRECTORIES_ONLY) &amp;&amp; !getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L296">                setFileName(pathField.getText());</span>
            }
<span class="nc" id="L298">            directoryComboBoxModel.addItem(currentDirectory);</span>
<span class="nc" id="L299">            directoryListModel.directoryChanged();</span>
        }
<span class="nc" id="L301">        super.doDirectoryChanged(e);</span>
<span class="nc" id="L302">    }</span>

    protected void doAccessoryChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L305" title="All 2 branches missed.">        if (getAccessoryPanel() != null) {</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">            if (e.getOldValue() != null) {</span>
<span class="nc" id="L307">                getAccessoryPanel().remove((JComponent)e.getOldValue());</span>
            }
<span class="nc" id="L309">            JComponent accessory = (JComponent)e.getNewValue();</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">            if (accessory != null) {</span>
<span class="nc" id="L311">                getAccessoryPanel().add(accessory, BorderLayout.CENTER);</span>
<span class="nc" id="L312">                getAccessoryPanel().setPreferredSize(accessory.getPreferredSize());</span>
<span class="nc" id="L313">                getAccessoryPanel().setMaximumSize(MAX_SIZE);</span>
            } else {
<span class="nc" id="L315">                getAccessoryPanel().setPreferredSize(ZERO_ACC_SIZE);</span>
<span class="nc" id="L316">                getAccessoryPanel().setMaximumSize(ZERO_ACC_SIZE);</span>
            }
        }
<span class="nc" id="L319">    }</span>

    protected void doFileSelectionModeChanged(PropertyChangeEvent e) {
<span class="nc" id="L322">        directoryList.clearSelection();</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">        rightPanel.setVisible(((Integer)e.getNewValue()).intValue() != JFileChooser.DIRECTORIES_ONLY);</span>

<span class="nc" id="L325">        super.doFileSelectionModeChanged(e);</span>
<span class="nc" id="L326">    }</span>

    protected void doMultiSelectionChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L330">            fileList.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
        } else {
<span class="nc" id="L332">            fileList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L333">            fileList.clearSelection();</span>
        }

<span class="nc" id="L336">        super.doMultiSelectionChanged(e);</span>
<span class="nc" id="L337">    }</span>

    protected void doControlButtonsChanged(PropertyChangeEvent e) {
<span class="nc" id="L340">        super.doControlButtonsChanged(e);</span>

<span class="nc" id="L342">        JFileChooser filechooser = getFileChooser();</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">        if (filechooser.getControlButtonsAreShown()) {</span>
<span class="nc" id="L344">            filechooser.add(bottomButtonPanel, BorderLayout.SOUTH);</span>
        } else {
<span class="nc" id="L346">            filechooser.remove(bottomButtonPanel);</span>
        }
<span class="nc" id="L348">        updateDefaultButton();</span>
<span class="nc" id="L349">    }</span>

    protected void doAncestorChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L352" title="All 4 branches missed.">        if (e.getOldValue() == null &amp;&amp; e.getNewValue() != null) {</span>
            // Ancestor was added, set initial focus
<span class="nc" id="L354">            fileNameTextField.selectAll();</span>
<span class="nc" id="L355">            fileNameTextField.requestFocus();</span>
<span class="nc" id="L356">            updateDefaultButton();</span>
        }

<span class="nc" id="L359">        super.doAncestorChanged(e);</span>
<span class="nc" id="L360">    }</span>



    // ********************************************
    // ************ Create Listeners **************
    // ********************************************

    public ListSelectionListener createListSelectionListener(JFileChooser fc) {
<span class="nc" id="L369">        return new SelectionListener();</span>
    }

    class DoubleClickListener extends MouseAdapter {
        JList list;
<span class="nc" id="L374">        public  DoubleClickListener(JList list) {</span>
<span class="nc" id="L375">            this.list = list;</span>
<span class="nc" id="L376">        }</span>

        public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L379" title="All 4 branches missed.">            if (SwingUtilities.isLeftMouseButton(e) &amp;&amp; e.getClickCount() == 2) {</span>
<span class="nc" id="L380">                int index = list.locationToIndex(e.getPoint());</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">                if (index &gt;= 0) {</span>
<span class="nc" id="L382">                    File f = (File) list.getModel().getElementAt(index);</span>
                    try {
                        // Strip trailing &quot;..&quot;
<span class="nc" id="L385">                        f = ShellFolder.getNormalizedFile(f);</span>
<span class="nc" id="L386">                    } catch (IOException ex) {</span>
                        // That's ok, we'll use f as is
<span class="nc" id="L388">                    }</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">                    if (getFileChooser().isTraversable(f)) {</span>
<span class="nc" id="L390">                        list.clearSelection();</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">                        if (getFileChooser().getCurrentDirectory().equals(f)){</span>
<span class="nc" id="L392">                            rescanCurrentDirectory(getFileChooser());</span>
                        } else {
<span class="nc" id="L394">                            getFileChooser().setCurrentDirectory(f);</span>
                        }
                    } else {
<span class="nc" id="L397">                        getFileChooser().approveSelection();</span>
                    }
                }
            }
<span class="nc" id="L401">        }</span>

        public void mouseEntered(MouseEvent evt) {
<span class="nc bnc" id="L404" title="All 2 branches missed.">            if (list != null) {</span>
<span class="nc" id="L405">                TransferHandler th1 = getFileChooser().getTransferHandler();</span>
<span class="nc" id="L406">                TransferHandler th2 = list.getTransferHandler();</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                if (th1 != th2) {</span>
<span class="nc" id="L408">                    list.setTransferHandler(th1);</span>
                }
<span class="nc bnc" id="L410" title="All 2 branches missed.">                if (getFileChooser().getDragEnabled() != list.getDragEnabled()) {</span>
<span class="nc" id="L411">                    list.setDragEnabled(getFileChooser().getDragEnabled());</span>
                }
            }
<span class="nc" id="L414">        }</span>
    }

    protected MouseListener createDoubleClickListener(JFileChooser fc, JList list) {
<span class="nc" id="L418">        return new DoubleClickListener(list);</span>
    }



<span class="nc" id="L423">    protected class SelectionListener implements ListSelectionListener {</span>
        public void valueChanged(ListSelectionEvent e) {
<span class="nc bnc" id="L425" title="All 2 branches missed.">            if (!e.getValueIsAdjusting()) {</span>
<span class="nc" id="L426">                JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L427">                JList list = (JList) e.getSource();</span>

<span class="nc bnc" id="L429" title="All 2 branches missed.">                if (chooser.isMultiSelectionEnabled()) {</span>
<span class="nc" id="L430">                    File[] files = null;</span>
<span class="nc" id="L431">                    Object[] objects = list.getSelectedValues();</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">                    if (objects != null) {</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">                        if (objects.length == 1</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">                            &amp;&amp; ((File)objects[0]).isDirectory()</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">                            &amp;&amp; chooser.isTraversable(((File)objects[0]))</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">                            &amp;&amp; (chooser.getFileSelectionMode() != chooser.DIRECTORIES_ONLY</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">                                || !chooser.getFileSystemView().isFileSystem(((File)objects[0])))) {</span>
<span class="nc" id="L438">                            setDirectorySelected(true);</span>
<span class="nc" id="L439">                            setDirectory(((File)objects[0]));</span>
                        } else {
<span class="nc" id="L441">                            ArrayList&lt;File&gt; fList = new ArrayList&lt;File&gt;(objects.length);</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">                            for (Object object : objects) {</span>
<span class="nc" id="L443">                                File f = (File) object;</span>
<span class="nc bnc" id="L444" title="All 4 branches missed.">                                if ((chooser.isFileSelectionEnabled() &amp;&amp; f.isFile())</span>
<span class="nc bnc" id="L445" title="All 4 branches missed.">                                    || (chooser.isDirectorySelectionEnabled() &amp;&amp; f.isDirectory())) {</span>
<span class="nc" id="L446">                                    fList.add(f);</span>
                                }
                            }
<span class="nc bnc" id="L449" title="All 2 branches missed.">                            if (fList.size() &gt; 0) {</span>
<span class="nc" id="L450">                                files = fList.toArray(new File[fList.size()]);</span>
                            }
<span class="nc" id="L452">                            setDirectorySelected(false);</span>
                        }
                    }
<span class="nc" id="L455">                    chooser.setSelectedFiles(files);</span>
<span class="nc" id="L456">                } else {</span>
<span class="nc" id="L457">                    File file = (File)list.getSelectedValue();</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                    if (file != null</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">                        &amp;&amp; file.isDirectory()</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">                        &amp;&amp; chooser.isTraversable(file)</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">                        &amp;&amp; (chooser.getFileSelectionMode() == chooser.FILES_ONLY</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">                            || !chooser.getFileSystemView().isFileSystem(file))) {</span>

<span class="nc" id="L464">                        setDirectorySelected(true);</span>
<span class="nc" id="L465">                        setDirectory(file);</span>
                    } else {
<span class="nc" id="L467">                        setDirectorySelected(false);</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">                        if (file != null) {</span>
<span class="nc" id="L469">                            chooser.setSelectedFile(file);</span>
                        }
                    }
                }
            }
<span class="nc" id="L474">        }</span>
    }


    //
    // ComponentUI Interface Implementation methods
    //
    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L482">        return new GTKFileChooserUI((JFileChooser)c);</span>
    }

    public void installUI(JComponent c) {
<span class="nc" id="L486">        accessoryPanel = new JPanel(new BorderLayout(10, 10));</span>
<span class="nc" id="L487">        accessoryPanel.setName(&quot;GTKFileChooser.accessoryPanel&quot;);</span>

<span class="nc" id="L489">        super.installUI(c);</span>
<span class="nc" id="L490">    }</span>

    public void uninstallUI(JComponent c) {
<span class="nc" id="L493">        c.removePropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L494">        super.uninstallUI(c);</span>

<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (accessoryPanel != null) {</span>
<span class="nc" id="L497">            accessoryPanel.removeAll();</span>
        }
<span class="nc" id="L499">        accessoryPanel = null;</span>
<span class="nc" id="L500">        getFileChooser().removeAll();</span>
<span class="nc" id="L501">    }</span>

    public void installComponents(JFileChooser fc) {
<span class="nc" id="L504">        super.installComponents(fc);</span>

<span class="nc" id="L506">        boolean leftToRight = fc.getComponentOrientation().isLeftToRight();</span>

<span class="nc" id="L508">        fc.setLayout(new BorderLayout());</span>
<span class="nc" id="L509">        fc.setAlignmentX(JComponent.CENTER_ALIGNMENT);</span>

        // Top row of buttons
<span class="nc" id="L512">        JPanel topButtonPanel = new JPanel(new FlowLayout(FlowLayout.LEADING, 0, 0));</span>
<span class="nc" id="L513">        topButtonPanel.setBorder(new EmptyBorder(10, 10, 0, 10));</span>
<span class="nc" id="L514">        topButtonPanel.setName(&quot;GTKFileChooser.topButtonPanel&quot;);</span>

<span class="nc bnc" id="L516" title="All 2 branches missed.">        if (!UIManager.getBoolean(&quot;FileChooser.readOnly&quot;)) {</span>
<span class="nc" id="L517">            JButton newFolderButton = new JButton(getNewFolderAction());</span>
<span class="nc" id="L518">            newFolderButton.setName(&quot;GTKFileChooser.newFolderButton&quot;);</span>
<span class="nc" id="L519">            newFolderButton.setMnemonic(newFolderButtonMnemonic);</span>
<span class="nc" id="L520">            newFolderButton.setToolTipText(newFolderButtonToolTipText);</span>
<span class="nc" id="L521">            newFolderButton.setText(newFolderButtonText);</span>
<span class="nc" id="L522">            topButtonPanel.add(newFolderButton);</span>
        }
<span class="nc" id="L524">        JButton deleteFileButton = new JButton(deleteFileButtonText);</span>
<span class="nc" id="L525">        deleteFileButton.setName(&quot;GTKFileChooser.deleteFileButton&quot;);</span>
<span class="nc" id="L526">        deleteFileButton.setMnemonic(deleteFileButtonMnemonic);</span>
<span class="nc" id="L527">        deleteFileButton.setToolTipText(deleteFileButtonToolTipText);</span>
<span class="nc" id="L528">        deleteFileButton.setEnabled(false);</span>
<span class="nc" id="L529">        topButtonPanel.add(deleteFileButton);</span>

<span class="nc" id="L531">        RenameFileAction rfa = new RenameFileAction();</span>
<span class="nc" id="L532">        JButton renameFileButton = new JButton(rfa);</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (readOnly) {</span>
<span class="nc" id="L534">            rfa.setEnabled(false);</span>
        }
<span class="nc" id="L536">        renameFileButton.setText(renameFileButtonText);</span>
<span class="nc" id="L537">        renameFileButton.setName(&quot;GTKFileChooser.renameFileButton&quot;);</span>
<span class="nc" id="L538">        renameFileButton.setMnemonic(renameFileButtonMnemonic);</span>
<span class="nc" id="L539">        renameFileButton.setToolTipText(renameFileButtonToolTipText);</span>
<span class="nc" id="L540">        topButtonPanel.add(renameFileButton);</span>

<span class="nc" id="L542">        fc.add(topButtonPanel, BorderLayout.NORTH);</span>


<span class="nc" id="L545">        JPanel interior = new JPanel();</span>
<span class="nc" id="L546">        interior.setBorder(new EmptyBorder(0, 10, 10, 10));</span>
<span class="nc" id="L547">        interior.setName(&quot;GTKFileChooser.interiorPanel&quot;);</span>
<span class="nc" id="L548">        align(interior);</span>
<span class="nc" id="L549">        interior.setLayout(new BoxLayout(interior, BoxLayout.PAGE_AXIS));</span>

<span class="nc" id="L551">        fc.add(interior, BorderLayout.CENTER);</span>

<span class="nc" id="L553">        JPanel comboBoxPanel = new JPanel(new FlowLayout(FlowLayout.CENTER,</span>
<span class="nc" id="L554">                                                         0, 0) {</span>
            public void layoutContainer(Container target) {
<span class="nc" id="L556">                super.layoutContainer(target);</span>
<span class="nc" id="L557">                JComboBox comboBox = directoryComboBox;</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">                if (comboBox.getWidth() &gt; target.getWidth()) {</span>
<span class="nc" id="L559">                    comboBox.setBounds(0, comboBox.getY(), target.getWidth(),</span>
<span class="nc" id="L560">                                       comboBox.getHeight());</span>
                }
<span class="nc" id="L562">            }</span>
        });
<span class="nc" id="L564">        comboBoxPanel.setBorder(new EmptyBorder(0, 0, 4, 0));</span>
<span class="nc" id="L565">        comboBoxPanel.setName(&quot;GTKFileChooser.directoryComboBoxPanel&quot;);</span>
        // CurrentDir ComboBox
<span class="nc" id="L567">        directoryComboBoxModel = createDirectoryComboBoxModel(fc);</span>
<span class="nc" id="L568">        directoryComboBox = new JComboBox(directoryComboBoxModel);</span>
<span class="nc" id="L569">        directoryComboBox.setName(&quot;GTKFileChooser.directoryComboBox&quot;);</span>
<span class="nc" id="L570">        directoryComboBox.putClientProperty( &quot;JComboBox.lightweightKeyboardNavigation&quot;, &quot;Lightweight&quot; );</span>
<span class="nc" id="L571">        directoryComboBox.addActionListener(directoryComboBoxAction);</span>
<span class="nc" id="L572">        directoryComboBox.setMaximumRowCount(8);</span>
<span class="nc" id="L573">        comboBoxPanel.add(directoryComboBox);</span>
<span class="nc" id="L574">        interior.add(comboBoxPanel);</span>


        // CENTER: left, right, accessory
<span class="nc" id="L578">        JPanel centerPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L579">        centerPanel.setName(&quot;GTKFileChooser.centerPanel&quot;);</span>

        // SPLIT PANEL: left, right
<span class="nc" id="L582">        JSplitPane splitPanel = new JSplitPane();</span>
<span class="nc" id="L583">        splitPanel.setName(&quot;GTKFileChooser.splitPanel&quot;);</span>
<span class="nc" id="L584">        splitPanel.setDividerLocation((PREF_SIZE.width-8)/2);</span>

        // left panel - Filter &amp; directoryList
<span class="nc" id="L587">        JPanel leftPanel = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L588">        leftPanel.setName(&quot;GTKFileChooser.directoryListPanel&quot;);</span>

        // Add the Directory List
        // Create a label that looks like button (should be a table header)
<span class="nc" id="L592">        TableCellRenderer headerRenderer = new JTableHeader().getDefaultRenderer();</span>
<span class="nc" id="L593">        JLabel directoryListLabel =</span>
<span class="nc" id="L594">            (JLabel)headerRenderer.getTableCellRendererComponent(null, foldersLabelText,</span>
                                                                     false, false, 0, 0);
<span class="nc" id="L596">        directoryListLabel.setName(&quot;GTKFileChooser.directoryListLabel&quot;);</span>
<span class="nc" id="L597">        leftPanel.add(directoryListLabel, new GridBagConstraints(</span>
                          0, 0, 1, 1, 1, 0, GridBagConstraints.WEST,
                          GridBagConstraints.HORIZONTAL,
                          new Insets(0, 0, 0, 0), 0, 0));
<span class="nc" id="L601">        leftPanel.add(createDirectoryList(), new GridBagConstraints(</span>
                          0, 1, 1, 1, 1, 1, GridBagConstraints.EAST,
                          GridBagConstraints.BOTH,
                          new Insets(0, 0, 0, 0), 0, 0));
<span class="nc" id="L605">        directoryListLabel.setDisplayedMnemonic(foldersLabelMnemonic);</span>
<span class="nc" id="L606">        directoryListLabel.setLabelFor(directoryList);</span>

        // create files list
<span class="nc" id="L609">        rightPanel = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L610">        rightPanel.setName(&quot;GTKFileChooser.fileListPanel&quot;);</span>

<span class="nc" id="L612">        headerRenderer = new JTableHeader().getDefaultRenderer();</span>
<span class="nc" id="L613">        JLabel fileListLabel =</span>
<span class="nc" id="L614">            (JLabel)headerRenderer.getTableCellRendererComponent(null, filesLabelText,</span>
                                                                     false, false, 0, 0);
<span class="nc" id="L616">        fileListLabel.setName(&quot;GTKFileChooser.fileListLabel&quot;);</span>
<span class="nc" id="L617">        rightPanel.add(fileListLabel, new GridBagConstraints(</span>
                          0, 0, 1, 1, 1, 0, GridBagConstraints.WEST,
                          GridBagConstraints.HORIZONTAL,
                          new Insets(0, 0, 0, 0), 0, 0));
<span class="nc" id="L621">        rightPanel.add(createFilesList(), new GridBagConstraints(</span>
                          0, 1, 1, 1, 1, 1, GridBagConstraints.EAST,
                          GridBagConstraints.BOTH,
                          new Insets(0, 0, 0, 0), 0, 0));
<span class="nc" id="L625">        fileListLabel.setDisplayedMnemonic(filesLabelMnemonic);</span>
<span class="nc" id="L626">        fileListLabel.setLabelFor(fileList);</span>

<span class="nc bnc" id="L628" title="All 2 branches missed.">        splitPanel.add(leftPanel,  leftToRight ? JSplitPane.LEFT : JSplitPane.RIGHT);</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">        splitPanel.add(rightPanel, leftToRight ? JSplitPane.RIGHT : JSplitPane.LEFT);</span>
<span class="nc" id="L630">        centerPanel.add(splitPanel, BorderLayout.CENTER);</span>

<span class="nc" id="L632">        JComponent accessoryPanel = getAccessoryPanel();</span>
<span class="nc" id="L633">        JComponent accessory = fc.getAccessory();</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">        if (accessoryPanel != null) {</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">            if (accessory == null) {</span>
<span class="nc" id="L636">                accessoryPanel.setPreferredSize(ZERO_ACC_SIZE);</span>
<span class="nc" id="L637">                accessoryPanel.setMaximumSize(ZERO_ACC_SIZE);</span>
            } else {
<span class="nc" id="L639">                getAccessoryPanel().add(accessory, BorderLayout.CENTER);</span>
<span class="nc" id="L640">                accessoryPanel.setPreferredSize(accessory.getPreferredSize());</span>
<span class="nc" id="L641">                accessoryPanel.setMaximumSize(MAX_SIZE);</span>
            }
<span class="nc" id="L643">            align(accessoryPanel);</span>
<span class="nc" id="L644">            centerPanel.add(accessoryPanel, BorderLayout.AFTER_LINE_ENDS);</span>
        }
<span class="nc" id="L646">        interior.add(centerPanel);</span>
<span class="nc" id="L647">        interior.add(Box.createRigidArea(vstrut10));</span>

<span class="nc" id="L649">        JPanel pathFieldPanel = new JPanel(new FlowLayout(FlowLayout.LEADING,</span>
                                                          0, 0));
<span class="nc" id="L651">        pathFieldPanel.setBorder(new EmptyBorder(0, 0, 4, 0));</span>
<span class="nc" id="L652">        JLabel pathFieldLabel = new JLabel(pathLabelText);</span>
<span class="nc" id="L653">        pathFieldLabel.setName(&quot;GTKFileChooser.pathFieldLabel&quot;);</span>
<span class="nc" id="L654">        pathFieldLabel.setDisplayedMnemonic(pathLabelMnemonic);</span>
<span class="nc" id="L655">        align(pathFieldLabel);</span>
<span class="nc" id="L656">        pathFieldPanel.add(pathFieldLabel);</span>
<span class="nc" id="L657">        pathFieldPanel.add(Box.createRigidArea(hstrut3));</span>

<span class="nc" id="L659">        File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc" id="L660">        String curDirName = null;</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">        if (currentDirectory != null) {</span>
<span class="nc" id="L662">            curDirName = currentDirectory.getPath();</span>
        }
<span class="nc" id="L664">        pathField = new JLabel(curDirName) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L666">                Dimension d = super.getMaximumSize();</span>
<span class="nc" id="L667">                d.height = getPreferredSize().height;</span>
<span class="nc" id="L668">                return d;</span>
            }
        };
<span class="nc" id="L671">        pathField.setName(&quot;GTKFileChooser.pathField&quot;);</span>
<span class="nc" id="L672">        align(pathField);</span>
<span class="nc" id="L673">        pathFieldPanel.add(pathField);</span>
<span class="nc" id="L674">        interior.add(pathFieldPanel);</span>

        // add the fileName field
<span class="nc" id="L677">        fileNameTextField = new JTextField() {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L679">                Dimension d = super.getMaximumSize();</span>
<span class="nc" id="L680">                d.height = getPreferredSize().height;</span>
<span class="nc" id="L681">                return d;</span>
            }
        };

<span class="nc" id="L685">        pathFieldLabel.setLabelFor(fileNameTextField);</span>

<span class="nc" id="L687">        Set&lt;AWTKeyStroke&gt; forwardTraversalKeys = fileNameTextField.getFocusTraversalKeys(</span>
            KeyboardFocusManager.FORWARD_TRAVERSAL_KEYS);
<span class="nc" id="L689">        forwardTraversalKeys = new HashSet&lt;AWTKeyStroke&gt;(forwardTraversalKeys);</span>
<span class="nc" id="L690">        forwardTraversalKeys.remove(KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0));</span>
<span class="nc" id="L691">        fileNameTextField.setFocusTraversalKeys(KeyboardFocusManager.FORWARD_TRAVERSAL_KEYS, forwardTraversalKeys);</span>

<span class="nc" id="L693">        fileNameTextField.setName(&quot;GTKFileChooser.fileNameTextField&quot;);</span>
<span class="nc" id="L694">        fileNameTextField.getActionMap().put(&quot;fileNameCompletionAction&quot;, getFileNameCompletionAction());</span>
<span class="nc" id="L695">        fileNameTextField.getInputMap().put(KeyStroke.getKeyStroke(KeyEvent.VK_TAB, 0), &quot;fileNameCompletionAction&quot;);</span>
<span class="nc" id="L696">        interior.add(fileNameTextField);</span>

        // Add the filter combo box
<span class="nc" id="L699">        JPanel panel = new JPanel();</span>
<span class="nc" id="L700">        panel.setLayout(new FlowLayout(FlowLayout.LEADING, 0, 0));</span>
<span class="nc" id="L701">        panel.setBorder(new EmptyBorder(0, 0, 4, 0));</span>
<span class="nc" id="L702">        JLabel filterLabel = new JLabel(filterLabelText);</span>
<span class="nc" id="L703">        filterLabel.setName(&quot;GTKFileChooser.filterLabel&quot;);</span>
<span class="nc" id="L704">        filterLabel.setDisplayedMnemonic(filterLabelMnemonic);</span>
<span class="nc" id="L705">        panel.add(filterLabel);</span>

<span class="nc" id="L707">        filterComboBoxModel = createFilterComboBoxModel();</span>
<span class="nc" id="L708">        fc.addPropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L709">        filterComboBox = new JComboBox(filterComboBoxModel);</span>
<span class="nc" id="L710">        filterComboBox.setRenderer(createFilterComboBoxRenderer());</span>
<span class="nc" id="L711">        filterLabel.setLabelFor(filterComboBox);</span>

<span class="nc" id="L713">        interior.add(Box.createRigidArea(vstrut10));</span>
<span class="nc" id="L714">        interior.add(panel);</span>
<span class="nc" id="L715">        interior.add(filterComboBox);</span>

        // Add buttons
<span class="nc" id="L718">        bottomButtonPanel = new JPanel(new FlowLayout(FlowLayout.TRAILING));</span>
<span class="nc" id="L719">        bottomButtonPanel.setName(&quot;GTKFileChooser.bottomButtonPanel&quot;);</span>
<span class="nc" id="L720">        align(bottomButtonPanel);</span>

<span class="nc" id="L722">        JPanel pnButtons = new JPanel(new GridLayout(1, 2, 5, 0));</span>

<span class="nc" id="L724">        JButton cancelButton = getCancelButton(fc);</span>
<span class="nc" id="L725">        align(cancelButton);</span>
<span class="nc" id="L726">        cancelButton.setMargin(buttonMargin);</span>
<span class="nc" id="L727">        pnButtons.add(cancelButton);</span>

<span class="nc" id="L729">        JButton approveButton = getApproveButton(fc);</span>
<span class="nc" id="L730">        align(approveButton);</span>
<span class="nc" id="L731">        approveButton.setMargin(buttonMargin);</span>
<span class="nc" id="L732">        pnButtons.add(approveButton);</span>

<span class="nc" id="L734">        bottomButtonPanel.add(pnButtons);</span>

<span class="nc bnc" id="L736" title="All 2 branches missed.">        if (fc.getControlButtonsAreShown()) {</span>
<span class="nc" id="L737">            fc.add(bottomButtonPanel, BorderLayout.SOUTH);</span>
        }
<span class="nc" id="L739">    }</span>

    protected void installListeners(JFileChooser fc) {
<span class="nc" id="L742">        super.installListeners(fc);</span>

<span class="nc" id="L744">        gtkFCPropertyChangeListener = new GTKFCPropertyChangeListener();</span>
<span class="nc" id="L745">        fc.addPropertyChangeListener(gtkFCPropertyChangeListener);</span>
<span class="nc" id="L746">    }</span>

    private int getMnemonic(String key, Locale l) {
<span class="nc" id="L749">        return SwingUtilities2.getUIDefaultsInt(key, l);</span>
    }

    protected void uninstallListeners(JFileChooser fc) {
<span class="nc" id="L753">        super.uninstallListeners(fc);</span>

<span class="nc bnc" id="L755" title="All 2 branches missed.">        if (gtkFCPropertyChangeListener != null) {</span>
<span class="nc" id="L756">            fc.removePropertyChangeListener(gtkFCPropertyChangeListener);</span>
        }
<span class="nc" id="L758">    }</span>

<span class="nc" id="L760">    private class GTKFCPropertyChangeListener implements PropertyChangeListener {</span>
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L762">            String prop = e.getPropertyName();</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">            if (prop.equals(&quot;GTKFileChooser.showDirectoryIcons&quot;)) {</span>
<span class="nc" id="L764">                showDirectoryIcons = Boolean.TRUE.equals(e.getNewValue());</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">            } else if (prop.equals(&quot;GTKFileChooser.showFileIcons&quot;)) {</span>
<span class="nc" id="L766">                showFileIcons      = Boolean.TRUE.equals(e.getNewValue());</span>
            }
<span class="nc" id="L768">        }</span>
    }

    protected void installDefaults(JFileChooser fc) {
<span class="nc" id="L772">        super.installDefaults(fc);</span>
<span class="nc" id="L773">        readOnly = UIManager.getBoolean(&quot;FileChooser.readOnly&quot;);</span>
<span class="nc" id="L774">        showDirectoryIcons =</span>
<span class="nc" id="L775">            Boolean.TRUE.equals(fc.getClientProperty(&quot;GTKFileChooser.showDirectoryIcons&quot;));</span>
<span class="nc" id="L776">        showFileIcons =</span>
<span class="nc" id="L777">            Boolean.TRUE.equals(fc.getClientProperty(&quot;GTKFileChooser.showFileIcons&quot;));</span>
<span class="nc" id="L778">    }</span>

    protected void installIcons(JFileChooser fc) {
<span class="nc" id="L781">        directoryIcon    = UIManager.getIcon(&quot;FileView.directoryIcon&quot;);</span>
<span class="nc" id="L782">        fileIcon         = UIManager.getIcon(&quot;FileView.fileIcon&quot;);</span>
<span class="nc" id="L783">    }</span>

    protected void installStrings(JFileChooser fc) {
<span class="nc" id="L786">        super.installStrings(fc);</span>

<span class="nc" id="L788">        Locale l = fc.getLocale();</span>

<span class="nc" id="L790">        newFolderDialogText = UIManager.getString(&quot;FileChooser.newFolderDialogText&quot;, l);</span>
<span class="nc" id="L791">        newFolderErrorText = UIManager.getString(&quot;FileChooser.newFolderErrorText&quot;,l);</span>
<span class="nc" id="L792">        newFolderErrorSeparator = UIManager.getString(&quot;FileChooser.newFolderErrorSeparator&quot;,l);</span>
<span class="nc" id="L793">        newFolderButtonText = UIManager.getString(&quot;FileChooser.newFolderButtonText&quot;, l);</span>
<span class="nc" id="L794">        newFolderNoDirectoryErrorTitleText = UIManager.getString(&quot;FileChooser.newFolderNoDirectoryErrorTitleText&quot;, l);</span>
<span class="nc" id="L795">        newFolderNoDirectoryErrorText = UIManager.getString(&quot;FileChooser.newFolderNoDirectoryErrorText&quot;, l);</span>
<span class="nc" id="L796">        deleteFileButtonText = UIManager.getString(&quot;FileChooser.deleteFileButtonText&quot;, l);</span>
<span class="nc" id="L797">        renameFileButtonText = UIManager.getString(&quot;FileChooser.renameFileButtonText&quot;, l);</span>

<span class="nc" id="L799">        newFolderButtonMnemonic = getMnemonic(&quot;FileChooser.newFolderButtonMnemonic&quot;, l);</span>
<span class="nc" id="L800">        deleteFileButtonMnemonic = getMnemonic(&quot;FileChooser.deleteFileButtonMnemonic&quot;, l);</span>
<span class="nc" id="L801">        renameFileButtonMnemonic = getMnemonic(&quot;FileChooser.renameFileButtonMnemonic&quot;, l);</span>

<span class="nc" id="L803">        newFolderButtonToolTipText = UIManager.getString(&quot;FileChooser.newFolderButtonToolTipText&quot;, l);</span>
<span class="nc" id="L804">        deleteFileButtonToolTipText = UIManager.getString(&quot;FileChooser.deleteFileButtonToolTipText&quot;, l);</span>
<span class="nc" id="L805">        renameFileButtonToolTipText = UIManager.getString(&quot;FileChooser.renameFileButtonToolTipText&quot;, l);</span>

<span class="nc" id="L807">        renameFileDialogText = UIManager.getString(&quot;FileChooser.renameFileDialogText&quot;, l);</span>
<span class="nc" id="L808">        renameFileErrorTitle = UIManager.getString(&quot;FileChooser.renameFileErrorTitle&quot;, l);</span>
<span class="nc" id="L809">        renameFileErrorText = UIManager.getString(&quot;FileChooser.renameFileErrorText&quot;, l);</span>

<span class="nc" id="L811">        foldersLabelText = UIManager.getString(&quot;FileChooser.foldersLabelText&quot;,l);</span>
<span class="nc" id="L812">        foldersLabelMnemonic = getMnemonic(&quot;FileChooser.foldersLabelMnemonic&quot;, l);</span>

<span class="nc" id="L814">        filesLabelText = UIManager.getString(&quot;FileChooser.filesLabelText&quot;,l);</span>
<span class="nc" id="L815">        filesLabelMnemonic = getMnemonic(&quot;FileChooser.filesLabelMnemonic&quot;, l);</span>

<span class="nc" id="L817">        pathLabelText = UIManager.getString(&quot;FileChooser.pathLabelText&quot;,l);</span>
<span class="nc" id="L818">        pathLabelMnemonic = getMnemonic(&quot;FileChooser.pathLabelMnemonic&quot;, l);</span>

<span class="nc" id="L820">        filterLabelText = UIManager.getString(&quot;FileChooser.filterLabelText&quot;, l);</span>
<span class="nc" id="L821">        filterLabelMnemonic = UIManager.getInt(&quot;FileChooser.filterLabelMnemonic&quot;);</span>
<span class="nc" id="L822">    }</span>

    protected void uninstallStrings(JFileChooser fc) {
<span class="nc" id="L825">        super.uninstallStrings(fc);</span>

<span class="nc" id="L827">        newFolderButtonText = null;</span>
<span class="nc" id="L828">        deleteFileButtonText = null;</span>
<span class="nc" id="L829">        renameFileButtonText = null;</span>

<span class="nc" id="L831">        newFolderButtonToolTipText = null;</span>
<span class="nc" id="L832">        deleteFileButtonToolTipText = null;</span>
<span class="nc" id="L833">        renameFileButtonToolTipText = null;</span>

<span class="nc" id="L835">        renameFileDialogText = null;</span>
<span class="nc" id="L836">        renameFileErrorTitle = null;</span>
<span class="nc" id="L837">        renameFileErrorText = null;</span>

<span class="nc" id="L839">        foldersLabelText = null;</span>
<span class="nc" id="L840">        filesLabelText = null;</span>

<span class="nc" id="L842">        pathLabelText = null;</span>

<span class="nc" id="L844">        newFolderDialogText = null;</span>
<span class="nc" id="L845">        newFolderErrorText = null;</span>
<span class="nc" id="L846">        newFolderErrorSeparator = null;</span>
<span class="nc" id="L847">    }</span>

    protected JScrollPane createFilesList() {
<span class="nc" id="L850">        fileList = new JList();</span>
<span class="nc" id="L851">        fileList.setName(&quot;GTKFileChooser.fileList&quot;);</span>
<span class="nc" id="L852">        fileList.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY, filesLabelText);</span>

<span class="nc bnc" id="L854" title="All 2 branches missed.">        if (getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L855">            fileList.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
        } else {
<span class="nc" id="L857">            fileList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
        }

<span class="nc" id="L860">        fileList.setModel(new GTKFileListModel());</span>
<span class="nc" id="L861">        fileList.getSelectionModel().removeSelectionInterval(0, 0);</span>
<span class="nc" id="L862">        fileList.setCellRenderer(new FileCellRenderer());</span>
<span class="nc" id="L863">        fileList.addListSelectionListener(createListSelectionListener(getFileChooser()));</span>
<span class="nc" id="L864">        fileList.addMouseListener(createDoubleClickListener(getFileChooser(), fileList));</span>
<span class="nc" id="L865">        align(fileList);</span>
<span class="nc" id="L866">        JScrollPane scrollpane = new JScrollPane(fileList);</span>
<span class="nc" id="L867">    scrollpane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);</span>
<span class="nc" id="L868">        scrollpane.setName(&quot;GTKFileChooser.fileListScrollPane&quot;);</span>
<span class="nc" id="L869">        scrollpane.setPreferredSize(prefListSize);</span>
<span class="nc" id="L870">        scrollpane.setMaximumSize(MAX_SIZE);</span>
<span class="nc" id="L871">        align(scrollpane);</span>
<span class="nc" id="L872">        return scrollpane;</span>
    }

    protected JScrollPane createDirectoryList() {
<span class="nc" id="L876">        directoryList = new JList();</span>
<span class="nc" id="L877">        directoryList.setName(&quot;GTKFileChooser.directoryList&quot;);</span>
<span class="nc" id="L878">        directoryList.putClientProperty(AccessibleContext.ACCESSIBLE_NAME_PROPERTY, foldersLabelText);</span>
<span class="nc" id="L879">        align(directoryList);</span>

<span class="nc" id="L881">        directoryList.setCellRenderer(new DirectoryCellRenderer());</span>
<span class="nc" id="L882">        directoryListModel = new GTKDirectoryListModel();</span>
<span class="nc" id="L883">        directoryList.getSelectionModel().removeSelectionInterval(0, 0);</span>
<span class="nc" id="L884">        directoryList.setModel(directoryListModel);</span>
<span class="nc" id="L885">        directoryList.addMouseListener(createDoubleClickListener(getFileChooser(), directoryList));</span>
<span class="nc" id="L886">        directoryList.addListSelectionListener(createListSelectionListener(getFileChooser()));</span>

<span class="nc" id="L888">        JScrollPane scrollpane = new JScrollPane(directoryList);</span>
<span class="nc" id="L889">    scrollpane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);</span>
<span class="nc" id="L890">        scrollpane.setName(&quot;GTKFileChooser.directoryListScrollPane&quot;);</span>
<span class="nc" id="L891">        scrollpane.setMaximumSize(MAX_SIZE);</span>
<span class="nc" id="L892">        scrollpane.setPreferredSize(prefListSize);</span>
<span class="nc" id="L893">        align(scrollpane);</span>
<span class="nc" id="L894">        return scrollpane;</span>
    }

    protected void createModel() {
<span class="nc" id="L898">        model = new GTKDirectoryModel();</span>
<span class="nc" id="L899">    }</span>

    public BasicDirectoryModel getModel() {
<span class="nc" id="L902">        return model;</span>
    }

    public Action getApproveSelectionAction() {
<span class="nc" id="L906">        return approveSelectionAction;</span>
    }

    private class GTKDirectoryModel extends BasicDirectoryModel {
        FileSystemView fsv;
<span class="nc" id="L911">        private Comparator&lt;File&gt; fileComparator = new Comparator&lt;File&gt;() {</span>
            public int compare(File o, File o1) {
<span class="nc" id="L913">                return fsv.getSystemDisplayName(o).compareTo(fsv.getSystemDisplayName(o1));</span>
            }
        };

<span class="nc" id="L917">        public GTKDirectoryModel() {</span>
<span class="nc" id="L918">            super(getFileChooser());</span>
<span class="nc" id="L919">        }</span>

        protected void sort(Vector&lt;? extends File&gt; v) {
<span class="nc" id="L922">            fsv = getFileChooser().getFileSystemView();</span>
<span class="nc" id="L923">            Collections.sort(v, fileComparator);</span>
<span class="nc" id="L924">        }</span>
    }

    protected class GTKDirectoryListModel extends AbstractListModel implements ListDataListener {
        File curDir;
<span class="nc" id="L929">        public GTKDirectoryListModel() {</span>
<span class="nc" id="L930">            getModel().addListDataListener(this);</span>
<span class="nc" id="L931">            directoryChanged();</span>
<span class="nc" id="L932">        }</span>

        public int getSize() {
<span class="nc" id="L935">            return getModel().getDirectories().size() + 1;</span>
        }

        public Object getElementAt(int index) {
<span class="nc bnc" id="L939" title="All 2 branches missed.">            return index &gt; 0 ? getModel().getDirectories().elementAt(index - 1):</span>
                    curDir;
        }

        public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L944">            fireIntervalAdded(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L945">        }</span>

        public void intervalRemoved(ListDataEvent e) {
<span class="nc" id="L948">            fireIntervalRemoved(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L949">        }</span>

        // PENDING - this is inefficient - should sent out
        // incremental adjustment values instead of saying that the
        // whole list has changed.
        public void fireContentsChanged() {
<span class="nc" id="L955">            fireContentsChanged(this, 0, getModel().getDirectories().size()-1);</span>
<span class="nc" id="L956">        }</span>

        // PENDING - fire the correct interval changed - currently sending
        // out that everything has changed
        public void contentsChanged(ListDataEvent e) {
<span class="nc" id="L961">            fireContentsChanged();</span>
<span class="nc" id="L962">        }</span>

        private void directoryChanged() {
<span class="nc" id="L965">            curDir = getFileChooser().getFileSystemView().createFileObject(</span>
<span class="nc" id="L966">                    getFileChooser().getCurrentDirectory(), &quot;.&quot;);</span>
<span class="nc" id="L967">        }</span>
    }

    protected class GTKFileListModel extends AbstractListModel implements ListDataListener {
<span class="nc" id="L971">        public GTKFileListModel() {</span>
<span class="nc" id="L972">            getModel().addListDataListener(this);</span>
<span class="nc" id="L973">        }</span>

        public int getSize() {
<span class="nc" id="L976">            return getModel().getFiles().size();</span>
        }

        public boolean contains(Object o) {
<span class="nc" id="L980">            return getModel().getFiles().contains(o);</span>
        }

        public int indexOf(Object o) {
<span class="nc" id="L984">            return getModel().getFiles().indexOf(o);</span>
        }

        public Object getElementAt(int index) {
<span class="nc" id="L988">            return getModel().getFiles().elementAt(index);</span>
        }

        public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L992">            fireIntervalAdded(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L993">        }</span>

        public void intervalRemoved(ListDataEvent e) {
<span class="nc" id="L996">            fireIntervalRemoved(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L997">        }</span>

        // PENDING - this is inefficient - should sent out
        // incremental adjustment values instead of saying that the
        // whole list has changed.
        public void fireContentsChanged() {
<span class="nc" id="L1003">            fireContentsChanged(this, 0, getModel().getFiles().size()-1);</span>
<span class="nc" id="L1004">        }</span>

        // PENDING - fire the interval changed
        public void contentsChanged(ListDataEvent e) {
<span class="nc" id="L1008">            fireContentsChanged();</span>
<span class="nc" id="L1009">        }</span>
    }


<span class="nc" id="L1013">    protected class FileCellRenderer extends DefaultListCellRenderer  {</span>
        public Component getListCellRendererComponent(JList list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {

<span class="nc" id="L1017">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>
<span class="nc" id="L1018">            setText(getFileChooser().getName((File) value));</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">            if (showFileIcons) {</span>
<span class="nc" id="L1020">                setIcon(getFileChooser().getIcon((File)value));</span>
            }
<span class="nc" id="L1022">            return this;</span>
        }
    }

<span class="nc" id="L1026">    protected class DirectoryCellRenderer extends DefaultListCellRenderer  {</span>
        public Component getListCellRendererComponent(JList list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {

<span class="nc" id="L1030">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc bnc" id="L1032" title="All 2 branches missed.">            if (showDirectoryIcons) {</span>
<span class="nc" id="L1033">                setIcon(getFileChooser().getIcon((File)value));</span>
<span class="nc" id="L1034">                setText(getFileChooser().getName((File)value));</span>
            } else {
<span class="nc" id="L1036">                setText(getFileChooser().getName((File)value) + &quot;/&quot;);</span>
            }
<span class="nc" id="L1038">            return this;</span>
        }
    }

    public Dimension getPreferredSize(JComponent c) {
<span class="nc" id="L1043">        Dimension prefSize = new Dimension(PREF_SIZE);</span>
<span class="nc" id="L1044">        JComponent accessory = getFileChooser().getAccessory();</span>
<span class="nc bnc" id="L1045" title="All 2 branches missed.">        if (accessory != null) {</span>
<span class="nc" id="L1046">            prefSize.width += accessory.getPreferredSize().width + 20;</span>
        }
<span class="nc" id="L1048">        Dimension d = c.getLayout().preferredLayoutSize(c);</span>
<span class="nc bnc" id="L1049" title="All 2 branches missed.">        if (d != null) {</span>
<span class="nc bnc" id="L1050" title="All 4 branches missed.">            return new Dimension(d.width &lt; prefSize.width ? prefSize.width : d.width,</span>
                                 d.height &lt; prefSize.height ? prefSize.height : d.height);
        } else {
<span class="nc" id="L1053">            return prefSize;</span>
        }
    }

    public Dimension getMinimumSize(JComponent x)  {
<span class="nc" id="L1058">        return new Dimension(MIN_SIZE);</span>
    }

    public Dimension getMaximumSize(JComponent x) {
<span class="nc" id="L1062">        return new Dimension(Integer.MAX_VALUE, Integer.MAX_VALUE);</span>
    }

    protected void align(JComponent c) {
<span class="nc" id="L1066">        c.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L1067">        c.setAlignmentY(JComponent.TOP_ALIGNMENT);</span>
<span class="nc" id="L1068">    }</span>

    public Action getNewFolderAction() {
<span class="nc bnc" id="L1071" title="All 2 branches missed.">        if (newFolderAction == null) {</span>
<span class="nc" id="L1072">            newFolderAction = new NewFolderAction();</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">            newFolderAction.setEnabled(!readOnly);</span>
        }
<span class="nc" id="L1075">        return newFolderAction;</span>
    }

    //
    // DataModel for DirectoryComboxbox
    //
    protected DirectoryComboBoxModel createDirectoryComboBoxModel(JFileChooser fc) {
<span class="nc" id="L1082">        return new DirectoryComboBoxModel();</span>
    }

    /**
     * Data model for a type-face selection combo-box.
     */
    protected class DirectoryComboBoxModel extends AbstractListModel implements ComboBoxModel {
<span class="nc" id="L1089">        Vector&lt;File&gt; directories = new Vector&lt;File&gt;();</span>
<span class="nc" id="L1090">        File selectedDirectory = null;</span>
<span class="nc" id="L1091">        JFileChooser chooser = getFileChooser();</span>
<span class="nc" id="L1092">        FileSystemView fsv = chooser.getFileSystemView();</span>

<span class="nc" id="L1094">        public DirectoryComboBoxModel() {</span>
            // Add the current directory to the model, and make it the
            // selectedDirectory
<span class="nc" id="L1097">            File dir = getFileChooser().getCurrentDirectory();</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">            if (dir != null) {</span>
<span class="nc" id="L1099">                addItem(dir);</span>
            }
<span class="nc" id="L1101">        }</span>

        /**
         * Adds the directory to the model and sets it to be selected,
         * additionally clears out the previous selected directory and
         * the paths leading up to it, if any.
         */
        private void addItem(File directory) {

<span class="nc bnc" id="L1110" title="All 2 branches missed.">            if (directory == null) {</span>
<span class="nc" id="L1111">                return;</span>
            }

<span class="nc" id="L1114">            int oldSize = directories.size();</span>
<span class="nc" id="L1115">            directories.clear();</span>
<span class="nc bnc" id="L1116" title="All 2 branches missed.">            if (oldSize &gt; 0) {</span>
<span class="nc" id="L1117">                fireIntervalRemoved(this, 0, oldSize);</span>
            }

            // Get the canonical (full) path. This has the side
            // benefit of removing extraneous chars from the path,
            // for example /foo/bar/ becomes /foo/bar
            File canonical;
            try {
<span class="nc" id="L1125">                canonical = fsv.createFileObject(ShellFolder.getNormalizedFile(directory).getPath());</span>
<span class="nc" id="L1126">            } catch (IOException e) {</span>
                // Maybe drive is not ready. Can't abort here.
<span class="nc" id="L1128">                canonical = directory;</span>
<span class="nc" id="L1129">            }</span>

            // create File instances of each directory leading up to the top
<span class="nc" id="L1132">            File f = canonical;</span>
            do {
<span class="nc" id="L1134">                directories.add(f);</span>
<span class="nc bnc" id="L1135" title="All 2 branches missed.">            } while ((f = f.getParentFile()) != null);</span>
<span class="nc" id="L1136">            int newSize = directories.size();</span>
<span class="nc bnc" id="L1137" title="All 2 branches missed.">            if (newSize &gt; 0) {</span>
<span class="nc" id="L1138">                fireIntervalAdded(this, 0, newSize);</span>
            }
<span class="nc" id="L1140">            setSelectedItem(canonical);</span>
<span class="nc" id="L1141">        }</span>

        public void setSelectedItem(Object selectedDirectory) {
<span class="nc" id="L1144">            this.selectedDirectory = (File)selectedDirectory;</span>
<span class="nc" id="L1145">            fireContentsChanged(this, -1, -1);</span>
<span class="nc" id="L1146">        }</span>

        public Object getSelectedItem() {
<span class="nc" id="L1149">            return selectedDirectory;</span>
        }

        public int getSize() {
<span class="nc" id="L1153">            return directories.size();</span>
        }

        public Object getElementAt(int index) {
<span class="nc" id="L1157">            return directories.elementAt(index);</span>
        }
    }

    /**
     * Acts when DirectoryComboBox has changed the selected item.
     */
    protected class DirectoryComboBoxAction extends AbstractAction {
<span class="nc" id="L1165">        protected DirectoryComboBoxAction() {</span>
<span class="nc" id="L1166">            super(&quot;DirectoryComboBoxAction&quot;);</span>
<span class="nc" id="L1167">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1170">            File f = (File)directoryComboBox.getSelectedItem();</span>
<span class="nc" id="L1171">            getFileChooser().setCurrentDirectory(f);</span>
<span class="nc" id="L1172">        }</span>
    }

    /**
     * Creates a new folder.
     */
    private class NewFolderAction extends AbstractAction {
<span class="nc" id="L1179">        protected NewFolderAction() {</span>
<span class="nc" id="L1180">            super(FilePane.ACTION_NEW_FOLDER);</span>
<span class="nc" id="L1181">        }</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L1183" title="All 2 branches missed.">            if (readOnly) {</span>
<span class="nc" id="L1184">                return;</span>
            }
<span class="nc" id="L1186">            JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L1187">            File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc" id="L1188">            String dirName = JOptionPane.showInputDialog(fc,</span>
<span class="nc" id="L1189">                    newFolderDialogText, newFolderButtonText,</span>
                    JOptionPane.PLAIN_MESSAGE);

<span class="nc bnc" id="L1192" title="All 2 branches missed.">            if (dirName != null) {</span>
<span class="nc bnc" id="L1193" title="All 2 branches missed.">                if (!currentDirectory.exists()) {</span>
<span class="nc" id="L1194">                    JOptionPane.showMessageDialog(fc,</span>
<span class="nc" id="L1195">                            MessageFormat.format(newFolderNoDirectoryErrorText, dirName),</span>
<span class="nc" id="L1196">                            newFolderNoDirectoryErrorTitleText, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L1197">                    return;</span>
                }

<span class="nc" id="L1200">                File newDir = fc.getFileSystemView().createFileObject</span>
<span class="nc" id="L1201">                        (currentDirectory, dirName);</span>
<span class="nc bnc" id="L1202" title="All 4 branches missed.">                if (newDir == null || !newDir.mkdir()) {</span>
<span class="nc" id="L1203">                    JOptionPane.showMessageDialog(fc,</span>
<span class="nc" id="L1204">                            newFolderErrorText + newFolderErrorSeparator + &quot; \&quot;&quot; +</span>
                            dirName + &quot;\&quot;&quot;,
<span class="nc" id="L1206">                            newFolderErrorText, JOptionPane.ERROR_MESSAGE);</span>
                }
<span class="nc" id="L1208">                fc.rescanCurrentDirectory();</span>
            }
<span class="nc" id="L1210">        }</span>
    }

<span class="nc" id="L1213">    private class GTKApproveSelectionAction extends ApproveSelectionAction {</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L1215" title="All 2 branches missed.">            if (isDirectorySelected()) {</span>
<span class="nc" id="L1216">                File dir = getDirectory();</span>
                try {
                    // Strip trailing &quot;..&quot;
<span class="nc bnc" id="L1219" title="All 2 branches missed.">                    if (dir != null) {</span>
<span class="nc" id="L1220">                        dir = ShellFolder.getNormalizedFile(dir);</span>
                    }
<span class="nc" id="L1222">                } catch (IOException ex) {</span>
                    // Ok, use f as is
<span class="nc" id="L1224">                }</span>
<span class="nc bnc" id="L1225" title="All 2 branches missed.">                if (getFileChooser().getCurrentDirectory().equals(dir)) {</span>
<span class="nc" id="L1226">                    directoryList.clearSelection();</span>
<span class="nc" id="L1227">                    fileList.clearSelection();</span>
<span class="nc" id="L1228">                    ListSelectionModel sm = fileList.getSelectionModel();</span>
<span class="nc bnc" id="L1229" title="All 2 branches missed.">                    if (sm instanceof DefaultListSelectionModel) {</span>
<span class="nc" id="L1230">                        ((DefaultListSelectionModel)sm).moveLeadSelectionIndex(0);</span>
<span class="nc" id="L1231">                        sm.setAnchorSelectionIndex(0);</span>
                    }
<span class="nc" id="L1233">                    rescanCurrentDirectory(getFileChooser());</span>
<span class="nc" id="L1234">                    return;</span>
                }
            }
<span class="nc" id="L1237">            super.actionPerformed(e);</span>
<span class="nc" id="L1238">        }</span>
    }

    /**
     * Renames file
     */
    private class RenameFileAction extends AbstractAction {
<span class="nc" id="L1245">        protected RenameFileAction() {</span>
<span class="nc" id="L1246">            super(FilePane.ACTION_EDIT_FILE_NAME);</span>
<span class="nc" id="L1247">        }</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L1249" title="All 2 branches missed.">            if (getFileName().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1250">                return;</span>
            }
<span class="nc" id="L1252">            JFileChooser fc = getFileChooser();</span>
<span class="nc" id="L1253">            File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc" id="L1254">            String newFileName = (String) JOptionPane.showInputDialog</span>
<span class="nc" id="L1255">                   (fc, new MessageFormat(renameFileDialogText).format</span>
<span class="nc" id="L1256">                           (new Object[] { getFileName() }),</span>
<span class="nc" id="L1257">                           renameFileButtonText, JOptionPane.PLAIN_MESSAGE, null, null,</span>
<span class="nc" id="L1258">                           getFileName());</span>

<span class="nc bnc" id="L1260" title="All 2 branches missed.">            if (newFileName != null) {</span>
<span class="nc" id="L1261">                File oldFile = fc.getFileSystemView().createFileObject</span>
<span class="nc" id="L1262">                        (currentDirectory, getFileName());</span>
<span class="nc" id="L1263">                File newFile = fc.getFileSystemView().createFileObject</span>
<span class="nc" id="L1264">                        (currentDirectory, newFileName);</span>
<span class="nc bnc" id="L1265" title="All 4 branches missed.">                if (oldFile == null || newFile == null ||</span>
<span class="nc bnc" id="L1266" title="All 2 branches missed.">                        !getModel().renameFile(oldFile, newFile)) {</span>
<span class="nc" id="L1267">                    JOptionPane.showMessageDialog(fc,</span>
<span class="nc" id="L1268">                            new MessageFormat(renameFileErrorText).</span>
<span class="nc" id="L1269">                            format(new Object[] { getFileName(), newFileName}),</span>
<span class="nc" id="L1270">                            renameFileErrorTitle, JOptionPane.ERROR_MESSAGE);</span>
                } else {
<span class="nc" id="L1272">                    setFileName(getFileChooser().getName(newFile));</span>
<span class="nc" id="L1273">                    fc.rescanCurrentDirectory();</span>
                }
            }
<span class="nc" id="L1276">        }</span>
    }

    //
    // Renderer for Filter ComboBox
    //
    protected FilterComboBoxRenderer createFilterComboBoxRenderer() {
<span class="nc" id="L1283">        return new FilterComboBoxRenderer();</span>
    }

    /**
     * Render different filters
     */
<span class="nc" id="L1289">    public class FilterComboBoxRenderer extends DefaultListCellRenderer implements UIResource {</span>
        public String getName() {
            // As SynthComboBoxRenderer's are asked for a size BEFORE they
            // are parented getName is overriden to force the name to be
            // ComboBox.renderer if it isn't set. If we didn't do this the
            // wrong style could be used for size calculations.
<span class="nc" id="L1295">            String name = super.getName();</span>
<span class="nc bnc" id="L1296" title="All 2 branches missed.">            if (name == null) {</span>
<span class="nc" id="L1297">                return &quot;ComboBox.renderer&quot;;</span>
            }
<span class="nc" id="L1299">            return name;</span>
        }

        public Component getListCellRendererComponent(JList list, Object value,
                                                      int index, boolean isSelected,
                                                      boolean cellHasFocus) {

<span class="nc" id="L1306">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc" id="L1308">            setName(&quot;ComboBox.listRenderer&quot;);</span>

<span class="nc bnc" id="L1310" title="All 2 branches missed.">            if (value != null) {</span>
<span class="nc bnc" id="L1311" title="All 2 branches missed.">                if (value instanceof FileFilter) {</span>
<span class="nc" id="L1312">                    setText(((FileFilter) value).getDescription());</span>
                }
            } else {
<span class="nc" id="L1315">                setText(&quot;&quot;);</span>
            }

<span class="nc" id="L1318">            return this;</span>
        }
    }

    //
    // DataModel for Filter Combobox
    //
    protected FilterComboBoxModel createFilterComboBoxModel() {
<span class="nc" id="L1326">        return new FilterComboBoxModel();</span>
    }

    /**
     * Data model for filter combo-box.
     */
<span class="nc" id="L1332">    protected class FilterComboBoxModel extends AbstractFilterComboBoxModel {</span>
        protected JFileChooser getFileChooser() {
<span class="nc" id="L1334">            return GTKFileChooserUI.this.getFileChooser();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>