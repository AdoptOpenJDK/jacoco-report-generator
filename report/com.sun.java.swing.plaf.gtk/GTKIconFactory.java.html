<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GTKIconFactory.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.gtk</a> &gt; <span class="el_source">GTKIconFactory.java</span></div><h1>GTKIconFactory.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2002, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.java.swing.plaf.gtk;

import java.util.*;
import javax.swing.plaf.synth.*;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.lang.reflect.*;
import javax.swing.*;
import javax.swing.plaf.*;
import sun.swing.plaf.synth.*;
import com.sun.java.swing.plaf.gtk.GTKConstants.ArrowType;
import com.sun.java.swing.plaf.gtk.GTKConstants.ExpanderStyle;
import com.sun.java.swing.plaf.gtk.GTKConstants.Orientation;
import com.sun.java.swing.plaf.gtk.GTKConstants.ShadowType;

/**
 */
<span class="nc" id="L42">class GTKIconFactory {</span>
    static final int CHECK_ICON_EXTRA_INSET        = 1;
    static final int DEFAULT_ICON_SPACING          = 2;
    static final int DEFAULT_ICON_SIZE             = 13;
    static final int DEFAULT_TOGGLE_MENU_ITEM_SIZE = 12; // For pre-gtk2.4

    private static final String RADIO_BUTTON_ICON    = &quot;paintRadioButtonIcon&quot;;
    private static final String CHECK_BOX_ICON       = &quot;paintCheckBoxIcon&quot;;
    private static final String MENU_ARROW_ICON      = &quot;paintMenuArrowIcon&quot;;
    private static final String CHECK_BOX_MENU_ITEM_CHECK_ICON =
                                      &quot;paintCheckBoxMenuItemCheckIcon&quot;;
    private static final String RADIO_BUTTON_MENU_ITEM_CHECK_ICON =
                                      &quot;paintRadioButtonMenuItemCheckIcon&quot;;
    private static final String TREE_EXPANDED_ICON = &quot;paintTreeExpandedIcon&quot;;
    private static final String TREE_COLLAPSED_ICON = &quot;paintTreeCollapsedIcon&quot;;
    private static final String ASCENDING_SORT_ICON = &quot;paintAscendingSortIcon&quot;;
    private static final String DESCENDING_SORT_ICON = &quot;paintDescendingSortIcon&quot;;
    private static final String TOOL_BAR_HANDLE_ICON = &quot;paintToolBarHandleIcon&quot;;

<span class="nc" id="L61">    private static Map&lt;String, DelegatingIcon&gt; iconsPool =</span>
<span class="nc" id="L62">            Collections.synchronizedMap(new HashMap&lt;String, DelegatingIcon&gt;());</span>

    private static DelegatingIcon getIcon(String methodName) {
<span class="nc" id="L65">        DelegatingIcon result = iconsPool.get(methodName);</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (result == null) {</span>
<span class="nc bnc" id="L67" title="All 4 branches missed.">            if (methodName == TREE_COLLAPSED_ICON ||</span>
                methodName == TREE_EXPANDED_ICON)
            {
<span class="nc" id="L70">                result = new SynthExpanderIcon(methodName);</span>

<span class="nc bnc" id="L72" title="All 2 branches missed.">            } else if (methodName == TOOL_BAR_HANDLE_ICON) {</span>
<span class="nc" id="L73">                result = new ToolBarHandleIcon();</span>

<span class="nc bnc" id="L75" title="All 2 branches missed.">            } else if (methodName == MENU_ARROW_ICON) {</span>
<span class="nc" id="L76">                result = new MenuArrowIcon();</span>

            } else {
<span class="nc" id="L79">                result = new DelegatingIcon(methodName);</span>
            }
<span class="nc" id="L81">            iconsPool.put(methodName, result);</span>
        }
<span class="nc" id="L83">        return result;</span>
    }

    //
    // Sort arrow
    //
    public static Icon getAscendingSortIcon() {
<span class="nc" id="L90">        return getIcon(ASCENDING_SORT_ICON);</span>
    }

    public static Icon getDescendingSortIcon() {
<span class="nc" id="L94">        return getIcon(DESCENDING_SORT_ICON);</span>
    }

    //
    // Tree methods
    //
    public static SynthIcon getTreeExpandedIcon() {
<span class="nc" id="L101">        return getIcon(TREE_EXPANDED_ICON);</span>
    }

    public static SynthIcon getTreeCollapsedIcon() {
<span class="nc" id="L105">        return getIcon(TREE_COLLAPSED_ICON);</span>
    }

    //
    // Radio button
    //
    public static SynthIcon getRadioButtonIcon() {
<span class="nc" id="L112">        return getIcon(RADIO_BUTTON_ICON);</span>
    }

    //
    // CheckBox
    //
    public static SynthIcon getCheckBoxIcon() {
<span class="nc" id="L119">        return getIcon(CHECK_BOX_ICON);</span>
    }

    //
    // Menus
    //
    public static SynthIcon getMenuArrowIcon() {
<span class="nc" id="L126">        return getIcon(MENU_ARROW_ICON);</span>
    }

    public static SynthIcon getCheckBoxMenuItemCheckIcon() {
<span class="nc" id="L130">        return getIcon(CHECK_BOX_MENU_ITEM_CHECK_ICON);</span>
    }

    public static SynthIcon getRadioButtonMenuItemCheckIcon() {
<span class="nc" id="L134">        return getIcon(RADIO_BUTTON_MENU_ITEM_CHECK_ICON);</span>
    }

    //
    // ToolBar Handle
    //
    public static SynthIcon getToolBarHandleIcon() {
<span class="nc" id="L141">        return getIcon(TOOL_BAR_HANDLE_ICON);</span>
    }

    static void resetIcons() {
<span class="nc" id="L145">        synchronized (iconsPool) {</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">            for (DelegatingIcon di: iconsPool.values()) {</span>
<span class="nc" id="L147">                di.resetIconDimensions();</span>
<span class="nc" id="L148">            }</span>
<span class="nc" id="L149">        }</span>
<span class="nc" id="L150">    }</span>

<span class="nc bnc" id="L152" title="All 2 branches missed.">    private static class DelegatingIcon extends SynthIcon implements</span>
                                   UIResource {
<span class="nc" id="L154">        private static final Class[] PARAM_TYPES = new Class[] {</span>
            SynthContext.class, Graphics.class, int.class,
            int.class, int.class, int.class, int.class
        };

        private Object method;
<span class="nc" id="L160">        int iconDimension = -1;</span>

<span class="nc" id="L162">        DelegatingIcon(String methodName ){</span>
<span class="nc" id="L163">            this.method = methodName;</span>
<span class="nc" id="L164">        }</span>

        public void paintIcon(SynthContext context, Graphics g,
                              int x, int y, int w, int h) {
<span class="nc bnc" id="L168" title="All 2 branches missed.">            if (context != null) {</span>
<span class="nc" id="L169">                GTKPainter.INSTANCE.paintIcon(context, g,</span>
<span class="nc" id="L170">                        getMethod(), x, y, w, h);</span>
            }
<span class="nc" id="L172">        }</span>

        public int getIconWidth(SynthContext context) {
<span class="nc" id="L175">            return getIconDimension(context);</span>
        }

        public int getIconHeight(SynthContext context) {
<span class="nc" id="L179">            return getIconDimension(context);</span>
        }

        void resetIconDimensions() {
<span class="nc" id="L183">            iconDimension = -1;</span>
<span class="nc" id="L184">        }</span>

        protected Method getMethod() {
<span class="nc bnc" id="L187" title="All 2 branches missed.">            if (method instanceof String) {</span>
<span class="nc" id="L188">                method = resolveMethod((String)method);</span>
            }
<span class="nc" id="L190">            return (Method)method;</span>
        }

        protected Class[] getMethodParamTypes() {
<span class="nc" id="L194">            return PARAM_TYPES;</span>
        }

        private Method resolveMethod(String name) {
            try {
<span class="nc" id="L199">                return GTKPainter.class.getMethod(name, getMethodParamTypes());</span>
<span class="nc" id="L200">            } catch (NoSuchMethodException e) {</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                assert false;</span>
            }
<span class="nc" id="L203">            return null;</span>
        }

        int getIconDimension(SynthContext context) {
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if (iconDimension &gt;= 0) {</span>
<span class="nc" id="L208">                return iconDimension;</span>
            }

<span class="nc bnc" id="L211" title="All 2 branches missed.">            if (context == null) {</span>
<span class="nc" id="L212">                return DEFAULT_ICON_SIZE;</span>
            }

<span class="nc" id="L215">            Region region = context.getRegion();</span>
<span class="nc" id="L216">            GTKStyle style = (GTKStyle) context.getStyle();</span>
<span class="nc bnc" id="L217" title="All 4 branches missed.">            iconDimension = style.getClassSpecificIntValue(context,</span>
                    &quot;indicator-size&quot;,
                    (region == Region.CHECK_BOX_MENU_ITEM ||
                     region == Region.RADIO_BUTTON_MENU_ITEM) ?
                        DEFAULT_TOGGLE_MENU_ITEM_SIZE : DEFAULT_ICON_SIZE);

<span class="nc bnc" id="L223" title="All 4 branches missed.">            if (region == Region.CHECK_BOX || region == Region.RADIO_BUTTON) {</span>
<span class="nc" id="L224">                iconDimension += 2 * style.getClassSpecificIntValue(context,</span>
                        &quot;indicator-spacing&quot;, DEFAULT_ICON_SPACING);
<span class="nc bnc" id="L226" title="All 4 branches missed.">            } else if (region == Region.CHECK_BOX_MENU_ITEM ||</span>
                       region == Region.RADIO_BUTTON_MENU_ITEM) {
<span class="nc" id="L228">                iconDimension += 2 * CHECK_ICON_EXTRA_INSET;</span>
            }
<span class="nc" id="L230">            return iconDimension;</span>
        }
    }

    private static class SynthExpanderIcon extends DelegatingIcon {
        SynthExpanderIcon(String method) {
<span class="nc" id="L236">            super(method);</span>
<span class="nc" id="L237">        }</span>

        public void paintIcon(SynthContext context, Graphics g, int x, int y,
                              int w, int h) {
<span class="nc bnc" id="L241" title="All 2 branches missed.">            if (context != null) {</span>
<span class="nc" id="L242">                super.paintIcon(context, g, x, y, w, h);</span>
<span class="nc" id="L243">                updateSizeIfNecessary(context);</span>
            }
<span class="nc" id="L245">        }</span>

        int getIconDimension(SynthContext context) {
<span class="nc" id="L248">            updateSizeIfNecessary(context);</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">            return (iconDimension == -1) ? DEFAULT_ICON_SIZE :</span>
                                           iconDimension;
        }

        private void updateSizeIfNecessary(SynthContext context) {
<span class="nc bnc" id="L254" title="All 4 branches missed.">            if (iconDimension == -1 &amp;&amp; context != null) {</span>
<span class="nc" id="L255">                iconDimension = context.getStyle().getInt(context,</span>
                        &quot;Tree.expanderSize&quot;, 10);
            }
<span class="nc" id="L258">        }</span>
    }

    // GTK has a separate widget for the handle box, to mirror this
    // we create a unique icon per ToolBar and lookup the style for the
    // HandleBox.
    private static class ToolBarHandleIcon extends DelegatingIcon {
<span class="nc" id="L265">        private static final Class[] PARAM_TYPES = new Class[] {</span>
            SynthContext.class, Graphics.class, int.class,
            int.class, int.class, int.class, int.class, Orientation.class,
        };

        private SynthStyle style;

        public ToolBarHandleIcon() {
<span class="nc" id="L273">            super(TOOL_BAR_HANDLE_ICON);</span>
<span class="nc" id="L274">        }</span>

        protected Class[] getMethodParamTypes() {
<span class="nc" id="L277">            return PARAM_TYPES;</span>
        }

        public void paintIcon(SynthContext context, Graphics g, int x, int y,
                              int w, int h) {
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (context != null) {</span>
<span class="nc" id="L283">                JToolBar toolbar = (JToolBar)context.getComponent();</span>
<span class="nc" id="L284">                Orientation orientation =</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                        (toolbar.getOrientation() == JToolBar.HORIZONTAL ?</span>
                            Orientation.HORIZONTAL : Orientation.VERTICAL);

<span class="nc bnc" id="L288" title="All 2 branches missed.">                if (style == null) {</span>
<span class="nc" id="L289">                    style = SynthLookAndFeel.getStyleFactory().getStyle(</span>
<span class="nc" id="L290">                            context.getComponent(), GTKRegion.HANDLE_BOX);</span>
                }
<span class="nc" id="L292">                context = new SynthContext(toolbar, GTKRegion.HANDLE_BOX,</span>
                        style, SynthConstants.ENABLED);

<span class="nc" id="L295">                GTKPainter.INSTANCE.paintIcon(context, g,</span>
<span class="nc" id="L296">                        getMethod(), x, y, w, h, orientation);</span>
            }
<span class="nc" id="L298">        }</span>

        public int getIconWidth(SynthContext context) {
<span class="nc bnc" id="L301" title="All 2 branches missed.">            if (context == null) {</span>
<span class="nc" id="L302">                return 10;</span>
            }
<span class="nc bnc" id="L304" title="All 2 branches missed.">            if (((JToolBar)context.getComponent()).getOrientation() ==</span>
                    JToolBar.HORIZONTAL) {
<span class="nc" id="L306">                return 10;</span>
            } else {
<span class="nc" id="L308">                return context.getComponent().getWidth();</span>
            }
        }

        public int getIconHeight(SynthContext context) {
<span class="nc bnc" id="L313" title="All 2 branches missed.">            if (context == null) {</span>
<span class="nc" id="L314">                return 10;</span>
            }
<span class="nc bnc" id="L316" title="All 2 branches missed.">            if (((JToolBar)context.getComponent()).getOrientation() ==</span>
                    JToolBar.HORIZONTAL) {
<span class="nc" id="L318">                return context.getComponent().getHeight();</span>
            } else {
<span class="nc" id="L320">                return 10;</span>
            }
        }
    }

<span class="nc" id="L325">    private static class MenuArrowIcon extends DelegatingIcon {</span>
<span class="nc" id="L326">        private static final Class[] PARAM_TYPES = new Class[] {</span>
            SynthContext.class, Graphics.class, int.class,
            int.class, int.class, int.class, int.class, ArrowType.class,
        };

        public MenuArrowIcon() {
<span class="nc" id="L332">            super(MENU_ARROW_ICON);</span>
<span class="nc" id="L333">        }</span>

        protected Class[] getMethodParamTypes() {
<span class="nc" id="L336">            return PARAM_TYPES;</span>
        }

        public void paintIcon(SynthContext context, Graphics g, int x, int y,
                              int w, int h) {
<span class="nc bnc" id="L341" title="All 2 branches missed.">            if (context != null) {</span>
<span class="nc" id="L342">                ArrowType arrowDir = ArrowType.RIGHT;</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                if (!context.getComponent().getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L344">                    arrowDir = ArrowType.LEFT;</span>
                }
<span class="nc" id="L346">                GTKPainter.INSTANCE.paintIcon(context, g,</span>
<span class="nc" id="L347">                        getMethod(), x, y, w, h, arrowDir);</span>
            }
<span class="nc" id="L349">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>