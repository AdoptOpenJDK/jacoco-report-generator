<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>InputEvent.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">java.awt.event</a> &gt; <span class="el_source">InputEvent.java</span></div><h1>InputEvent.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1996, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.awt.event;

import java.awt.Event;
import java.awt.Component;
import java.awt.GraphicsEnvironment;
import java.awt.Toolkit;
import java.util.Arrays;

import sun.awt.AWTAccessor;
import sun.util.logging.PlatformLogger;
import sun.security.util.SecurityConstants;

/**
 * The root event class for all component-level input events.
 *
 * Input events are delivered to listeners before they are
 * processed normally by the source where they originated.
 * This allows listeners and component subclasses to &quot;consume&quot;
 * the event so that the source will not process them in their
 * default manner.  For example, consuming mousePressed events
 * on a Button component will prevent the Button from being
 * activated.
 *
 * @author Carl Quinn
 *
 * @see KeyEvent
 * @see KeyAdapter
 * @see MouseEvent
 * @see MouseAdapter
 * @see MouseMotionAdapter
 *
 * @since 1.1
 */
public abstract class InputEvent extends ComponentEvent {

<span class="nc" id="L61">    private static final PlatformLogger logger = PlatformLogger.getLogger(&quot;java.awt.event.InputEvent&quot;);</span>

    /**
     * The Shift key modifier constant.
     * It is recommended that SHIFT_DOWN_MASK be used instead.
     */
    public static final int SHIFT_MASK = Event.SHIFT_MASK;

    /**
     * The Control key modifier constant.
     * It is recommended that CTRL_DOWN_MASK be used instead.
     */
    public static final int CTRL_MASK = Event.CTRL_MASK;

    /**
     * The Meta key modifier constant.
     * It is recommended that META_DOWN_MASK be used instead.
     */
    public static final int META_MASK = Event.META_MASK;

    /**
     * The Alt key modifier constant.
     * It is recommended that ALT_DOWN_MASK be used instead.
     */
    public static final int ALT_MASK = Event.ALT_MASK;

    /**
     * The AltGraph key modifier constant.
     */
    public static final int ALT_GRAPH_MASK = 1 &lt;&lt; 5;

    /**
     * The Mouse Button1 modifier constant.
     * It is recommended that BUTTON1_DOWN_MASK be used instead.
     */
    public static final int BUTTON1_MASK = 1 &lt;&lt; 4;

    /**
     * The Mouse Button2 modifier constant.
     * It is recommended that BUTTON2_DOWN_MASK be used instead.
     * Note that BUTTON2_MASK has the same value as ALT_MASK.
     */
    public static final int BUTTON2_MASK = Event.ALT_MASK;

    /**
     * The Mouse Button3 modifier constant.
     * It is recommended that BUTTON3_DOWN_MASK be used instead.
     * Note that BUTTON3_MASK has the same value as META_MASK.
     */
    public static final int BUTTON3_MASK = Event.META_MASK;

    /**
     * The Shift key extended modifier constant.
     * @since 1.4
     */
    public static final int SHIFT_DOWN_MASK = 1 &lt;&lt; 6;

    /**
     * The Control key extended modifier constant.
     * @since 1.4
     */
    public static final int CTRL_DOWN_MASK = 1 &lt;&lt; 7;

    /**
     * The Meta key extended modifier constant.
     * @since 1.4
     */
    public static final int META_DOWN_MASK = 1 &lt;&lt; 8;

    /**
     * The Alt key extended modifier constant.
     * @since 1.4
     */
    public static final int ALT_DOWN_MASK = 1 &lt;&lt; 9;

    /**
     * The Mouse Button1 extended modifier constant.
     * @since 1.4
     */
    public static final int BUTTON1_DOWN_MASK = 1 &lt;&lt; 10;

    /**
     * The Mouse Button2 extended modifier constant.
     * @since 1.4
     */
    public static final int BUTTON2_DOWN_MASK = 1 &lt;&lt; 11;

    /**
     * The Mouse Button3 extended modifier constant.
     * @since 1.4
     */
    public static final int BUTTON3_DOWN_MASK = 1 &lt;&lt; 12;

    /**
     * The AltGraph key extended modifier constant.
     * @since 1.4
     */
    public static final int ALT_GRAPH_DOWN_MASK = 1 &lt;&lt; 13;

    /**
     * An array of extended modifiers for additional buttons.
     * @see getButtonDownMasks
     * There are twenty buttons fit into 4byte space.
     * one more bit is reserved for FIRST_HIGH_BIT.
     * @since 7.0
     */
<span class="nc" id="L167">    private static final int [] BUTTON_DOWN_MASK = new int [] { BUTTON1_DOWN_MASK,</span>
                                                               BUTTON2_DOWN_MASK,
                                                               BUTTON3_DOWN_MASK,
                                                               1&lt;&lt;14, //4th phisical button (this is not a wheel!)
                                                               1&lt;&lt;15, //(this is not a wheel!)
                                                               1&lt;&lt;16,
                                                               1&lt;&lt;17,
                                                               1&lt;&lt;18,
                                                               1&lt;&lt;19,
                                                               1&lt;&lt;20,
                                                               1&lt;&lt;21,
                                                               1&lt;&lt;22,
                                                               1&lt;&lt;23,
                                                               1&lt;&lt;24,
                                                               1&lt;&lt;25,
                                                               1&lt;&lt;26,
                                                               1&lt;&lt;27,
                                                               1&lt;&lt;28,
                                                               1&lt;&lt;29,
                                                               1&lt;&lt;30};

    /**
     * A method to access an array of extended modifiers for additional buttons.
     * @since 7.0
     */
    private static int [] getButtonDownMasks(){
<span class="nc" id="L193">        return Arrays.copyOf(BUTTON_DOWN_MASK, BUTTON_DOWN_MASK.length);</span>
    }


    /**
     * A method to obtain a mask for any existing mouse button.
     * The returned mask may be used for different purposes. Following are some of them:
     * &lt;ul&gt;
     * &lt;li&gt; {@link java.awt.Robot#mousePress(int) mousePress(buttons)} and
     *      {@link java.awt.Robot#mouseRelease(int) mouseRelease(buttons)}
     * &lt;li&gt; as a {@code modifiers} parameter when creating a new {@link MouseEvent} instance
     * &lt;li&gt; to check {@link MouseEvent#getModifiersEx() modifiersEx} of existing {@code MouseEvent}
     * &lt;/ul&gt;
     * @param button is a number to represent a button starting from 1.
     * For example,
     * &lt;pre&gt;
     * int button = InputEvent.getMaskForButton(1);
     * &lt;/pre&gt;
     * will have the same meaning as
     * &lt;pre&gt;
     * int button = InputEvent.getMaskForButton(MouseEvent.BUTTON1);
     * &lt;/pre&gt;
     * because {@link MouseEvent#BUTTON1 MouseEvent.BUTTON1} equals to 1.
     * If a mouse has three enabled buttons(see {@link java.awt.MouseInfo#getNumberOfButtons() MouseInfo.getNumberOfButtons()})
     * then the values from the left column passed into the method will return
     * corresponding values from the right column:
     * &lt;PRE&gt;
     *    &lt;b&gt;button &lt;/b&gt;   &lt;b&gt;returned mask&lt;/b&gt;
     *    {@link MouseEvent#BUTTON1 BUTTON1}  {@link MouseEvent#BUTTON1_DOWN_MASK BUTTON1_DOWN_MASK}
     *    {@link MouseEvent#BUTTON2 BUTTON2}  {@link MouseEvent#BUTTON2_DOWN_MASK BUTTON2_DOWN_MASK}
     *    {@link MouseEvent#BUTTON3 BUTTON3}  {@link MouseEvent#BUTTON3_DOWN_MASK BUTTON3_DOWN_MASK}
     * &lt;/PRE&gt;
     * If a mouse has more than three enabled buttons then more values
     * are admissible (4, 5, etc.). There is no assigned constants for these extended buttons.
     * The button masks for the extra buttons returned by this method have no assigned names like the
     * first three button masks.
     * &lt;p&gt;
     * This method has the following implementation restriction.
     * It returns masks for a limited number of buttons only. The maximum number is
     * implementation dependent and may vary.
     * This limit is defined by the relevant number
     * of buttons that may hypothetically exist on the mouse but it is greater than the
     * {@link java.awt.MouseInfo#getNumberOfButtons() MouseInfo.getNumberOfButtons()}.
     * &lt;p&gt;
     * @throws IllegalArgumentException if {@code button} is less than zero or greater than the number
     *         of button masks reserved for buttons
     * @since 7.0
     * @see java.awt.MouseInfo#getNumberOfButtons()
     * @see Toolkit#areExtraMouseButtonsEnabled()
     * @see MouseEvent#getModifiers()
     * @see MouseEvent#getModifiersEx()
     */
    public static int getMaskForButton(int button) {
<span class="nc bnc" id="L246" title="All 4 branches missed.">        if (button &lt;= 0 || button &gt; BUTTON_DOWN_MASK.length) {</span>
<span class="nc" id="L247">            throw new IllegalArgumentException(&quot;button doesn\'t exist &quot; + button);</span>
        }
<span class="nc" id="L249">        return BUTTON_DOWN_MASK[button - 1];</span>
    }

    // the constant below MUST be updated if any extra modifier
    // bits are to be added!
    // in fact, it is undesirable to add modifier bits
    // to the same field as this may break applications
    // see bug# 5066958
    static final int FIRST_HIGH_BIT = 1 &lt;&lt; 31;

    static final int JDK_1_3_MODIFIERS = SHIFT_DOWN_MASK - 1;
    static final int HIGH_MODIFIERS = ~( FIRST_HIGH_BIT - 1 );

    /**
     * The input event's Time stamp in UTC format.  The time stamp
     * indicates when the input event was created.
     *
     * @serial
     * @see #getWhen()
     */
    long when;

    /**
     * The state of the modifier mask at the time the input
     * event was fired.
     *
     * @serial
     * @see #getModifiers()
     * @see #getModifiersEx()
     * @see java.awt.event.KeyEvent
     * @see java.awt.event.MouseEvent
     */
    int modifiers;

    /*
     * A flag that indicates that this instance can be used to access
     * the system clipboard.
     */
    private transient boolean canAccessSystemClipboard;

    static {
        /* ensure that the necessary native libraries are loaded */
<span class="nc" id="L291">        NativeLibLoader.loadLibraries();</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">        if (!GraphicsEnvironment.isHeadless()) {</span>
<span class="nc" id="L293">            initIDs();</span>
        }
<span class="nc" id="L295">        AWTAccessor.setInputEventAccessor(</span>
<span class="nc" id="L296">            new AWTAccessor.InputEventAccessor() {</span>
                public int[] getButtonDownMasks() {
<span class="nc" id="L298">                    return InputEvent.getButtonDownMasks();</span>
                }
            });
<span class="nc" id="L301">    }</span>

    /**
     * Initialize JNI field and method IDs for fields that may be
       accessed from C.
     */
    private static native void initIDs();

    /**
     * Constructs an InputEvent object with the specified source component,
     * modifiers, and type.
     * &lt;p&gt; This method throws an
     * &lt;code&gt;IllegalArgumentException&lt;/code&gt; if &lt;code&gt;source&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;.
     *
     * @param source the object where the event originated
     * @param id           the integer that identifies the event type.
     *                     It is allowed to pass as parameter any value that
     *                     allowed for some subclass of {@code InputEvent} class.
     *                     Passing in the value different from those values result
     *                     in unspecified behavior
     * @param when         a long int that gives the time the event occurred.
     *                     Passing negative or zero value
     *                     is not recommended
     * @param modifiers    a modifier mask describing the modifier keys and mouse
     *                     buttons (for example, shift, ctrl, alt, and meta) that
     *                     are down during the event.
     *                     Only extended modifiers are allowed to be used as a
     *                     value for this parameter (see the {@link InputEvent#getModifiersEx}
     *                     class for the description of extended modifiers).
     *                     Passing negative parameter
     *                     is not recommended.
     *                     Zero value means that no modifiers were passed
     * @throws IllegalArgumentException if &lt;code&gt;source&lt;/code&gt; is null
     * @see #getSource()
     * @see #getID()
     * @see #getWhen()
     * @see #getModifiers()
     */
    InputEvent(Component source, int id, long when, int modifiers) {
<span class="nc" id="L341">        super(source, id);</span>
<span class="nc" id="L342">        this.when = when;</span>
<span class="nc" id="L343">        this.modifiers = modifiers;</span>
<span class="nc" id="L344">        canAccessSystemClipboard = canAccessSystemClipboard();</span>
<span class="nc" id="L345">    }</span>

    private boolean canAccessSystemClipboard() {
<span class="nc" id="L348">        boolean b = false;</span>

<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (!GraphicsEnvironment.isHeadless()) {</span>
<span class="nc" id="L351">            SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">            if (sm != null) {</span>
                try {
<span class="nc" id="L354">                    sm.checkPermission(SecurityConstants.AWT.ACCESS_CLIPBOARD_PERMISSION);</span>
<span class="nc" id="L355">                    b = true;</span>
<span class="nc" id="L356">                } catch (SecurityException se) {</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                    if (logger.isLoggable(PlatformLogger.Level.FINE)) {</span>
<span class="nc" id="L358">                        logger.fine(&quot;InputEvent.canAccessSystemClipboard() got SecurityException &quot;, se);</span>
                    }
<span class="nc" id="L360">                }</span>
            } else {
<span class="nc" id="L362">                b = true;</span>
            }
        }

<span class="nc" id="L366">        return b;</span>
    }

    /**
     * Returns whether or not the Shift modifier is down on this event.
     */
    public boolean isShiftDown() {
<span class="nc bnc" id="L373" title="All 2 branches missed.">        return (modifiers &amp; SHIFT_MASK) != 0;</span>
    }

    /**
     * Returns whether or not the Control modifier is down on this event.
     */
    public boolean isControlDown() {
<span class="nc bnc" id="L380" title="All 2 branches missed.">        return (modifiers &amp; CTRL_MASK) != 0;</span>
    }

    /**
     * Returns whether or not the Meta modifier is down on this event.
     */
    public boolean isMetaDown() {
<span class="nc bnc" id="L387" title="All 2 branches missed.">        return (modifiers &amp; META_MASK) != 0;</span>
    }

    /**
     * Returns whether or not the Alt modifier is down on this event.
     */
    public boolean isAltDown() {
<span class="nc bnc" id="L394" title="All 2 branches missed.">        return (modifiers &amp; ALT_MASK) != 0;</span>
    }

    /**
     * Returns whether or not the AltGraph modifier is down on this event.
     */
    public boolean isAltGraphDown() {
<span class="nc bnc" id="L401" title="All 2 branches missed.">        return (modifiers &amp; ALT_GRAPH_MASK) != 0;</span>
    }

    /**
     * Returns the difference in milliseconds between the timestamp of when this event occurred and
     * midnight, January 1, 1970 UTC.
     */
    public long getWhen() {
<span class="nc" id="L409">        return when;</span>
    }

    /**
     * Returns the modifier mask for this event.
     */
    public int getModifiers() {
<span class="nc" id="L416">        return modifiers &amp; (JDK_1_3_MODIFIERS | HIGH_MODIFIERS);</span>
    }

    /**
     * Returns the extended modifier mask for this event.
     * &lt;P&gt;
     * Extended modifiers are the modifiers that ends with the _DOWN_MASK suffix,
     * such as ALT_DOWN_MASK, BUTTON1_DOWN_MASK, and others.
     * &lt;P&gt;
     * Extended modifiers represent the state of all modal keys,
     * such as ALT, CTRL, META, and the mouse buttons just after
     * the event occurred.
     * &lt;P&gt;
     * For example, if the user presses &lt;b&gt;button 1&lt;/b&gt; followed by
     * &lt;b&gt;button 2&lt;/b&gt;, and then releases them in the same order,
     * the following sequence of events is generated:
     * &lt;PRE&gt;
     *    &lt;code&gt;MOUSE_PRESSED&lt;/code&gt;:  &lt;code&gt;BUTTON1_DOWN_MASK&lt;/code&gt;
     *    &lt;code&gt;MOUSE_PRESSED&lt;/code&gt;:  &lt;code&gt;BUTTON1_DOWN_MASK | BUTTON2_DOWN_MASK&lt;/code&gt;
     *    &lt;code&gt;MOUSE_RELEASED&lt;/code&gt;: &lt;code&gt;BUTTON2_DOWN_MASK&lt;/code&gt;
     *    &lt;code&gt;MOUSE_CLICKED&lt;/code&gt;:  &lt;code&gt;BUTTON2_DOWN_MASK&lt;/code&gt;
     *    &lt;code&gt;MOUSE_RELEASED&lt;/code&gt;:
     *    &lt;code&gt;MOUSE_CLICKED&lt;/code&gt;:
     * &lt;/PRE&gt;
     * &lt;P&gt;
     * It is not recommended to compare the return value of this method
     * using &lt;code&gt;==&lt;/code&gt; because new modifiers can be added in the future.
     * For example, the appropriate way to check that SHIFT and BUTTON1 are
     * down, but CTRL is up is demonstrated by the following code:
     * &lt;PRE&gt;
     *    int onmask = SHIFT_DOWN_MASK | BUTTON1_DOWN_MASK;
     *    int offmask = CTRL_DOWN_MASK;
     *    if ((event.getModifiersEx() &amp;amp; (onmask | offmask)) == onmask) {
     *        ...
     *    }
     * &lt;/PRE&gt;
     * The above code will work even if new modifiers are added.
     *
     * @since 1.4
     */
    public int getModifiersEx() {
<span class="nc" id="L457">        return modifiers &amp; ~JDK_1_3_MODIFIERS;</span>
    }

    /**
     * Consumes this event so that it will not be processed
     * in the default manner by the source which originated it.
     */
    public void consume() {
<span class="nc" id="L465">        consumed = true;</span>
<span class="nc" id="L466">    }</span>

    /**
     * Returns whether or not this event has been consumed.
     * @see #consume
     */
    public boolean isConsumed() {
<span class="nc" id="L473">        return consumed;</span>
    }

    // state serialization compatibility with JDK 1.1
    static final long serialVersionUID = -2482525981698309786L;

    /**
     * Returns a String describing the extended modifier keys and
     * mouse buttons, such as &quot;Shift&quot;, &quot;Button1&quot;, or &quot;Ctrl+Shift&quot;.
     * These strings can be localized by changing the
     * &lt;code&gt;awt.properties&lt;/code&gt; file.
     * &lt;p&gt;
     * Note that passing negative parameter is incorrect,
     * and will cause the returning an unspecified string.
     * Zero parameter means that no modifiers were passed and will
     * cause the returning an empty string.
     *
     * @param modifiers a modifier mask describing the extended
     *                modifier keys and mouse buttons for the event
     * @return a text description of the combination of extended
     *         modifier keys and mouse buttons that were held down
     *         during the event.
     * @since 1.4
     */
    public static String getModifiersExText(int modifiers) {
<span class="nc" id="L498">        StringBuilder buf = new StringBuilder();</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if ((modifiers &amp; InputEvent.META_DOWN_MASK) != 0) {</span>
<span class="nc" id="L500">            buf.append(Toolkit.getProperty(&quot;AWT.meta&quot;, &quot;Meta&quot;));</span>
<span class="nc" id="L501">            buf.append(&quot;+&quot;);</span>
        }
<span class="nc bnc" id="L503" title="All 2 branches missed.">        if ((modifiers &amp; InputEvent.CTRL_DOWN_MASK) != 0) {</span>
<span class="nc" id="L504">            buf.append(Toolkit.getProperty(&quot;AWT.control&quot;, &quot;Ctrl&quot;));</span>
<span class="nc" id="L505">            buf.append(&quot;+&quot;);</span>
        }
<span class="nc bnc" id="L507" title="All 2 branches missed.">        if ((modifiers &amp; InputEvent.ALT_DOWN_MASK) != 0) {</span>
<span class="nc" id="L508">            buf.append(Toolkit.getProperty(&quot;AWT.alt&quot;, &quot;Alt&quot;));</span>
<span class="nc" id="L509">            buf.append(&quot;+&quot;);</span>
        }
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if ((modifiers &amp; InputEvent.SHIFT_DOWN_MASK) != 0) {</span>
<span class="nc" id="L512">            buf.append(Toolkit.getProperty(&quot;AWT.shift&quot;, &quot;Shift&quot;));</span>
<span class="nc" id="L513">            buf.append(&quot;+&quot;);</span>
        }
<span class="nc bnc" id="L515" title="All 2 branches missed.">        if ((modifiers &amp; InputEvent.ALT_GRAPH_DOWN_MASK) != 0) {</span>
<span class="nc" id="L516">            buf.append(Toolkit.getProperty(&quot;AWT.altGraph&quot;, &quot;Alt Graph&quot;));</span>
<span class="nc" id="L517">            buf.append(&quot;+&quot;);</span>
        }

<span class="nc" id="L520">        int buttonNumber = 1;</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">        for (int mask : InputEvent.BUTTON_DOWN_MASK){</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">            if ((modifiers &amp; mask) != 0) {</span>
<span class="nc" id="L523">                buf.append(Toolkit.getProperty(&quot;AWT.button&quot;+buttonNumber, &quot;Button&quot;+buttonNumber));</span>
<span class="nc" id="L524">                buf.append(&quot;+&quot;);</span>
            }
<span class="nc" id="L526">            buttonNumber++;</span>
        }
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (buf.length() &gt; 0) {</span>
<span class="nc" id="L529">            buf.setLength(buf.length()-1); // remove trailing '+'</span>
        }
<span class="nc" id="L531">        return buf.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>