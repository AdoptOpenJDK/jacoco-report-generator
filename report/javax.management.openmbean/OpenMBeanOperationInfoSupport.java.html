<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>OpenMBeanOperationInfoSupport.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.management.openmbean</a> &gt; <span class="el_source">OpenMBeanOperationInfoSupport.java</span></div><h1>OpenMBeanOperationInfoSupport.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */


package javax.management.openmbean;


// java import
//
import java.util.Arrays;

import javax.management.Descriptor;
import javax.management.ImmutableDescriptor;
import javax.management.MBeanOperationInfo;
import javax.management.MBeanParameterInfo;


/**
 * Describes an operation of an Open MBean.
 *
 *
 * @since 1.5
 */
public class OpenMBeanOperationInfoSupport
    extends MBeanOperationInfo
    implements OpenMBeanOperationInfo {

    /* Serial version */
    static final long serialVersionUID = 4996859732565369366L;

    /**
     * @serial The &lt;i&gt;open type&lt;/i&gt; of the values returned by the operation
     *         described by this {@link OpenMBeanOperationInfo} instance
     *
     */
    private OpenType&lt;?&gt; returnOpenType;


    // As this instance is immutable,
    // these two values need only be calculated once.
<span class="nc" id="L63">    private transient Integer myHashCode = null;</span>
<span class="nc" id="L64">    private transient String  myToString = null;</span>


    /**
     * &lt;p&gt;Constructs an {@code OpenMBeanOperationInfoSupport}
     * instance, which describes the operation of a class of open
     * MBeans, with the specified {@code name}, {@code description},
     * {@code signature}, {@code returnOpenType} and {@code
     * impact}.&lt;/p&gt;
     *
     * &lt;p&gt;The {@code signature} array parameter is internally copied,
     * so that subsequent changes to the array referenced by {@code
     * signature} have no effect on this instance.&lt;/p&gt;
     *
     * @param name cannot be a null or empty string.
     *
     * @param description cannot be a null or empty string.
     *
     * @param signature can be null or empty if there are no
     * parameters to describe.
     *
     * @param returnOpenType cannot be null: use {@code
     * SimpleType.VOID} for operations that return nothing.
     *
     * @param impact must be one of {@code ACTION}, {@code
     * ACTION_INFO}, {@code INFO}, or {@code UNKNOWN}.
     *
     * @throws IllegalArgumentException if {@code name} or {@code
     * description} are null or empty string, or {@code
     * returnOpenType} is null, or {@code impact} is not one of {@code
     * ACTION}, {@code ACTION_INFO}, {@code INFO}, or {@code UNKNOWN}.
     *
     * @throws ArrayStoreException If {@code signature} is not an
     * array of instances of a subclass of {@code MBeanParameterInfo}.
     */
    public OpenMBeanOperationInfoSupport(String name,
                                         String description,
                                         OpenMBeanParameterInfo[] signature,
                                         OpenType&lt;?&gt; returnOpenType,
                                         int impact) {
<span class="nc" id="L104">        this(name, description, signature, returnOpenType, impact,</span>
             (Descriptor) null);
<span class="nc" id="L106">    }</span>

    /**
     * &lt;p&gt;Constructs an {@code OpenMBeanOperationInfoSupport}
     * instance, which describes the operation of a class of open
     * MBeans, with the specified {@code name}, {@code description},
     * {@code signature}, {@code returnOpenType}, {@code
     * impact}, and {@code descriptor}.&lt;/p&gt;
     *
     * &lt;p&gt;The {@code signature} array parameter is internally copied,
     * so that subsequent changes to the array referenced by {@code
     * signature} have no effect on this instance.&lt;/p&gt;
     *
     * @param name cannot be a null or empty string.
     *
     * @param description cannot be a null or empty string.
     *
     * @param signature can be null or empty if there are no
     * parameters to describe.
     *
     * @param returnOpenType cannot be null: use {@code
     * SimpleType.VOID} for operations that return nothing.
     *
     * @param impact must be one of {@code ACTION}, {@code
     * ACTION_INFO}, {@code INFO}, or {@code UNKNOWN}.
     *
     * @param descriptor The descriptor for the operation.  This may
     * be null, which is equivalent to an empty descriptor.
     *
     * @throws IllegalArgumentException if {@code name} or {@code
     * description} are null or empty string, or {@code
     * returnOpenType} is null, or {@code impact} is not one of {@code
     * ACTION}, {@code ACTION_INFO}, {@code INFO}, or {@code UNKNOWN}.
     *
     * @throws ArrayStoreException If {@code signature} is not an
     * array of instances of a subclass of {@code MBeanParameterInfo}.
     *
     * @since 1.6
     */
    public OpenMBeanOperationInfoSupport(String name,
                                         String description,
                                         OpenMBeanParameterInfo[] signature,
                                         OpenType&lt;?&gt; returnOpenType,
                                         int impact,
                                         Descriptor descriptor) {
<span class="nc" id="L151">        super(name,</span>
              description,
<span class="nc bnc" id="L153" title="All 2 branches missed.">              arrayCopyCast(signature),</span>
              // must prevent NPE here - we will throw IAE later on if
              // returnOpenType is null
<span class="nc bnc" id="L156" title="All 2 branches missed.">              (returnOpenType == null) ? null : returnOpenType.getClassName(),</span>
              impact,
<span class="nc" id="L158">              ImmutableDescriptor.union(descriptor,</span>
                // must prevent NPE here - we will throw IAE later on if
                // returnOpenType is null
<span class="nc" id="L161">                (returnOpenType==null) ? null :returnOpenType.getDescriptor()));</span>

        // check parameters that should not be null or empty
        // (unfortunately it is not done in superclass :-( ! )
        //
<span class="nc bnc" id="L166" title="All 4 branches missed.">        if (name == null || name.trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L167">            throw new IllegalArgumentException(&quot;Argument name cannot &quot; +</span>
                                               &quot;be null or empty&quot;);
        }
<span class="nc bnc" id="L170" title="All 4 branches missed.">        if (description == null || description.trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L171">            throw new IllegalArgumentException(&quot;Argument description cannot &quot; +</span>
                                               &quot;be null or empty&quot;);
        }
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (returnOpenType == null) {</span>
<span class="nc" id="L175">            throw new IllegalArgumentException(&quot;Argument returnOpenType &quot; +</span>
                                               &quot;cannot be null&quot;);
        }

<span class="nc bnc" id="L179" title="All 8 branches missed.">        if (impact != ACTION &amp;&amp; impact != ACTION_INFO &amp;&amp; impact != INFO &amp;&amp;</span>
                impact != UNKNOWN) {
<span class="nc" id="L181">            throw new IllegalArgumentException(&quot;Argument impact can only be &quot; +</span>
                                               &quot;one of ACTION, ACTION_INFO, &quot; +
                                               &quot;INFO, or UNKNOWN: &quot; + impact);
        }

<span class="nc" id="L186">        this.returnOpenType = returnOpenType;</span>
<span class="nc" id="L187">    }</span>


    // Converts an array of OpenMBeanParameterInfo objects extending
    // MBeanParameterInfo into an array of MBeanParameterInfo.
    //
    private static MBeanParameterInfo[]
            arrayCopyCast(OpenMBeanParameterInfo[] src) {
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (src == null)</span>
<span class="nc" id="L196">            return null;</span>

<span class="nc" id="L198">        MBeanParameterInfo[] dst = new MBeanParameterInfo[src.length];</span>
<span class="nc" id="L199">        System.arraycopy(src, 0, dst, 0, src.length);</span>
        // may throw an ArrayStoreException
<span class="nc" id="L201">        return dst;</span>
    }

    // Converts an array of MBeanParameterInfo objects implementing
    // OpenMBeanParameterInfo into an array of OpenMBeanParameterInfo.
    //
    private static OpenMBeanParameterInfo[]
            arrayCopyCast(MBeanParameterInfo[] src) {
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (src == null)</span>
<span class="nc" id="L210">            return null;</span>

<span class="nc" id="L212">        OpenMBeanParameterInfo[] dst = new OpenMBeanParameterInfo[src.length];</span>
<span class="nc" id="L213">        System.arraycopy(src, 0, dst, 0, src.length);</span>
        // may throw an ArrayStoreException
<span class="nc" id="L215">        return dst;</span>
    }


    // [JF]: should we add constructor with java.lang.reflect.Method
    // method parameter ?  would need to add consistency check between
    // OpenType&lt;?&gt; returnOpenType and method.getReturnType().


    /**
     * Returns the &lt;i&gt;open type&lt;/i&gt; of the values returned by the
     * operation described by this {@code OpenMBeanOperationInfo}
     * instance.
     */
    public OpenType&lt;?&gt; getReturnOpenType() {

<span class="nc" id="L231">        return returnOpenType;</span>
    }



    /* ***  Commodity methods from java.lang.Object  *** */


    /**
     * &lt;p&gt;Compares the specified {@code obj} parameter with this
     * {@code OpenMBeanOperationInfoSupport} instance for
     * equality.&lt;/p&gt;
     *
     * &lt;p&gt;Returns {@code true} if and only if all of the following
     * statements are true:
     *
     * &lt;ul&gt;
     * &lt;li&gt;{@code obj} is non null,&lt;/li&gt;
     * &lt;li&gt;{@code obj} also implements the {@code
     * OpenMBeanOperationInfo} interface,&lt;/li&gt;
     * &lt;li&gt;their names are equal&lt;/li&gt;
     * &lt;li&gt;their signatures are equal&lt;/li&gt;
     * &lt;li&gt;their return open types are equal&lt;/li&gt;
     * &lt;li&gt;their impacts are equal&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * This ensures that this {@code equals} method works properly for
     * {@code obj} parameters which are different implementations of
     * the {@code OpenMBeanOperationInfo} interface.
     *
     * @param obj the object to be compared for equality with this
     * {@code OpenMBeanOperationInfoSupport} instance;
     *
     * @return {@code true} if the specified object is equal to this
     * {@code OpenMBeanOperationInfoSupport} instance.
     */
    public boolean equals(Object obj) {

        // if obj is null, return false
        //
<span class="nc bnc" id="L271" title="All 2 branches missed.">        if (obj == null) {</span>
<span class="nc" id="L272">            return false;</span>
        }

        // if obj is not a OpenMBeanOperationInfo, return false
        //
        OpenMBeanOperationInfo other;
        try {
<span class="nc" id="L279">            other = (OpenMBeanOperationInfo) obj;</span>
<span class="nc" id="L280">        } catch (ClassCastException e) {</span>
<span class="nc" id="L281">            return false;</span>
<span class="nc" id="L282">        }</span>

        // Now, really test for equality between this
        // OpenMBeanOperationInfo implementation and the other:
        //

        // their Name should be equal
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if ( ! this.getName().equals(other.getName()) ) {</span>
<span class="nc" id="L290">            return false;</span>
        }

        // their Signatures should be equal
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if ( ! Arrays.equals(this.getSignature(), other.getSignature()) ) {</span>
<span class="nc" id="L295">            return false;</span>
        }

        // their return open types should be equal
<span class="nc bnc" id="L299" title="All 2 branches missed.">        if ( ! this.getReturnOpenType().equals(other.getReturnOpenType()) ) {</span>
<span class="nc" id="L300">            return false;</span>
        }

        // their impacts should be equal
<span class="nc bnc" id="L304" title="All 2 branches missed.">        if ( this.getImpact() != other.getImpact() ) {</span>
<span class="nc" id="L305">            return false;</span>
        }

        // All tests for equality were successfull
        //
<span class="nc" id="L310">        return true;</span>
    }

    /**
     * &lt;p&gt;Returns the hash code value for this {@code
     * OpenMBeanOperationInfoSupport} instance.&lt;/p&gt;
     *
     * &lt;p&gt;The hash code of an {@code OpenMBeanOperationInfoSupport}
     * instance is the sum of the hash codes of all elements of
     * information used in {@code equals} comparisons (ie: its name,
     * return open type, impact and signature, where the signature
     * hashCode is calculated by a call to {@code
     * java.util.Arrays.asList(this.getSignature).hashCode()}).&lt;/p&gt;
     *
     * &lt;p&gt;This ensures that {@code t1.equals(t2) } implies that {@code
     * t1.hashCode()==t2.hashCode() } for any two {@code
     * OpenMBeanOperationInfoSupport} instances {@code t1} and {@code
     * t2}, as required by the general contract of the method {@link
     * Object#hashCode() Object.hashCode()}.&lt;/p&gt;
     *
     * &lt;p&gt;However, note that another instance of a class implementing
     * the {@code OpenMBeanOperationInfo} interface may be equal to
     * this {@code OpenMBeanOperationInfoSupport} instance as defined
     * by {@link #equals(java.lang.Object)}, but may have a different
     * hash code if it is calculated differently.&lt;/p&gt;
     *
     * &lt;p&gt;As {@code OpenMBeanOperationInfoSupport} instances are
     * immutable, the hash code for this instance is calculated once,
     * on the first call to {@code hashCode}, and then the same value
     * is returned for subsequent calls.&lt;/p&gt;
     *
     * @return the hash code value for this {@code
     * OpenMBeanOperationInfoSupport} instance
     */
    public int hashCode() {

        // Calculate the hash code value if it has not yet been done
        // (ie 1st call to hashCode())
        //
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (myHashCode == null) {</span>
<span class="nc" id="L350">            int value = 0;</span>
<span class="nc" id="L351">            value += this.getName().hashCode();</span>
<span class="nc" id="L352">            value += Arrays.asList(this.getSignature()).hashCode();</span>
<span class="nc" id="L353">            value += this.getReturnOpenType().hashCode();</span>
<span class="nc" id="L354">            value += this.getImpact();</span>
<span class="nc" id="L355">            myHashCode = Integer.valueOf(value);</span>
        }

        // return always the same hash code for this instance (immutable)
        //
<span class="nc" id="L360">        return myHashCode.intValue();</span>
    }

    /**
     * &lt;p&gt;Returns a string representation of this {@code
     * OpenMBeanOperationInfoSupport} instance.&lt;/p&gt;
     *
     * &lt;p&gt;The string representation consists of the name of this class
     * (ie {@code
     * javax.management.openmbean.OpenMBeanOperationInfoSupport}), and
     * the name, signature, return open type and impact of the
     * described operation and the string representation of its descriptor.&lt;/p&gt;
     *
     * &lt;p&gt;As {@code OpenMBeanOperationInfoSupport} instances are
     * immutable, the string representation for this instance is
     * calculated once, on the first call to {@code toString}, and
     * then the same value is returned for subsequent calls.&lt;/p&gt;
     *
     * @return a string representation of this {@code
     * OpenMBeanOperationInfoSupport} instance
     */
    public String toString() {

        // Calculate the hash code value if it has not yet been done
        // (ie 1st call to toString())
        //
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (myToString == null) {</span>
<span class="nc" id="L387">            myToString = new StringBuilder()</span>
<span class="nc" id="L388">                .append(this.getClass().getName())</span>
<span class="nc" id="L389">                .append(&quot;(name=&quot;)</span>
<span class="nc" id="L390">                .append(this.getName())</span>
<span class="nc" id="L391">                .append(&quot;,signature=&quot;)</span>
<span class="nc" id="L392">                .append(Arrays.asList(this.getSignature()).toString())</span>
<span class="nc" id="L393">                .append(&quot;,return=&quot;)</span>
<span class="nc" id="L394">                .append(this.getReturnOpenType().toString())</span>
<span class="nc" id="L395">                .append(&quot;,impact=&quot;)</span>
<span class="nc" id="L396">                .append(this.getImpact())</span>
<span class="nc" id="L397">                .append(&quot;,descriptor=&quot;)</span>
<span class="nc" id="L398">                .append(this.getDescriptor())</span>
<span class="nc" id="L399">                .append(&quot;)&quot;)</span>
<span class="nc" id="L400">                .toString();</span>
        }

        // return always the same string representation for this
        // instance (immutable)
        //
<span class="nc" id="L406">        return myToString;</span>
    }

    /**
     * An object serialized in a version of the API before Descriptors were
     * added to this class will have an empty or null Descriptor.
     * For consistency with our
     * behavior in this version, we must replace the object with one
     * where the Descriptors reflect the same value of returned openType.
     **/
    private Object readResolve() {
<span class="nc bnc" id="L417" title="All 2 branches missed.">        if (getDescriptor().getFieldNames().length == 0) {</span>
            // This constructor will construct the expected default Descriptor.
            //
<span class="nc" id="L420">            return new OpenMBeanOperationInfoSupport(</span>
<span class="nc" id="L421">                    name, description, arrayCopyCast(getSignature()),</span>
<span class="nc" id="L422">                    returnOpenType, getImpact());</span>
        } else
<span class="nc" id="L424">            return this;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>