<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>SerialRef.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.sql.rowset.serial</a> &gt; <span class="el_source">SerialRef.java</span></div><h1>SerialRef.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2003, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.sql.rowset.serial;

import java.sql.*;
import java.io.*;
import java.util.*;

/**
 * A serialized mapping of a &lt;code&gt;Ref&lt;/code&gt; object, which is the mapping in the
 * Java programming language of an SQL &lt;code&gt;REF&lt;/code&gt; value.
 * &lt;p&gt;
 * The &lt;code&gt;SerialRef&lt;/code&gt; class provides a constructor  for
 * creating a &lt;code&gt;SerialRef&lt;/code&gt; instance from a &lt;code&gt;Ref&lt;/code&gt;
 * object and provides methods for getting and setting the &lt;code&gt;Ref&lt;/code&gt; object.
 *
 * &lt;h3&gt; Thread safety &lt;/h3&gt;
 *
 * A SerialRef is not safe for use by multiple concurrent threads.  If a
 * SerialRef is to be used by more than one thread then access to the SerialRef
 * should be controlled by appropriate synchronization.
 *
 */
public class SerialRef implements Ref, Serializable, Cloneable {

    /**
     * String containing the base type name.
     * @serial
     */
    private String baseTypeName;

    /**
     * This will store the type &lt;code&gt;Ref&lt;/code&gt; as an &lt;code&gt;Object&lt;/code&gt;.
     */
    private Object object;

    /**
     * Private copy of the Ref reference.
     */
    private Ref reference;

    /**
     * Constructs a &lt;code&gt;SerialRef&lt;/code&gt; object from the given &lt;code&gt;Ref&lt;/code&gt;
     * object.
     *
     * @param ref a Ref object; cannot be &lt;code&gt;null&lt;/code&gt;
     * @throws SQLException if a database access occurs; if &lt;code&gt;ref&lt;/code&gt;
     *     is &lt;code&gt;null&lt;/code&gt;; or if the &lt;code&gt;Ref&lt;/code&gt; object returns a
     *     &lt;code&gt;null&lt;/code&gt; value base type name.
     * @throws SerialException if an error occurs serializing the &lt;code&gt;Ref&lt;/code&gt;
     *     object
     */
<span class="nc" id="L76">    public SerialRef(Ref ref) throws SerialException, SQLException {</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">        if (ref == null) {</span>
<span class="nc" id="L78">            throw new SQLException(&quot;Cannot instantiate a SerialRef object &quot; +</span>
                &quot;with a null Ref object&quot;);
        }
<span class="nc" id="L81">        reference = ref;</span>
<span class="nc" id="L82">        object = ref;</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (ref.getBaseTypeName() == null) {</span>
<span class="nc" id="L84">            throw new SQLException(&quot;Cannot instantiate a SerialRef object &quot; +</span>
                &quot;that returns a null base type name&quot;);
        } else {
<span class="nc" id="L87">            baseTypeName = ref.getBaseTypeName();</span>
        }
<span class="nc" id="L89">    }</span>

    /**
     * Returns a string describing the base type name of the &lt;code&gt;Ref&lt;/code&gt;.
     *
     * @return a string of the base type name of the Ref
     * @throws SerialException in no Ref object has been set
     */
    public String getBaseTypeName() throws SerialException {
<span class="nc" id="L98">        return baseTypeName;</span>
    }

    /**
     * Returns an &lt;code&gt;Object&lt;/code&gt; representing the SQL structured type
     * to which this &lt;code&gt;SerialRef&lt;/code&gt; object refers.  The attributes
     * of the structured type are mapped according to the given type map.
     *
     * @param map a &lt;code&gt;java.util.Map&lt;/code&gt; object containing zero or
     *        more entries, with each entry consisting of 1) a &lt;code&gt;String&lt;/code&gt;
     *        giving the fully qualified name of a UDT and 2) the
     *        &lt;code&gt;Class&lt;/code&gt; object for the &lt;code&gt;SQLData&lt;/code&gt; implementation
     *        that defines how the UDT is to be mapped
     * @return an object instance resolved from the Ref reference and mapped
     *        according to the supplied type map
     * @throws SerialException if an error is encountered in the reference
     *        resolution
     */
    public Object getObject(java.util.Map&lt;String,Class&lt;?&gt;&gt; map)
        throws SerialException
    {
<span class="nc" id="L119">        map = new Hashtable&lt;String, Class&lt;?&gt;&gt;(map);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (object != null) {</span>
<span class="nc" id="L121">            return map.get(object);</span>
        } else {
<span class="nc" id="L123">            throw new SerialException(&quot;The object is not set&quot;);</span>
        }
    }

    /**
     * Returns an &lt;code&gt;Object&lt;/code&gt; representing the SQL structured type
     * to which this &lt;code&gt;SerialRef&lt;/code&gt; object refers.
     *
     * @return an object instance resolved from the Ref reference
     * @throws SerialException if an error is encountered in the reference
     *         resolution
     */
    public Object getObject() throws SerialException {

<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (reference != null) {</span>
            try {
<span class="nc" id="L139">                return reference.getObject();</span>
<span class="nc" id="L140">            } catch (SQLException e) {</span>
<span class="nc" id="L141">                throw new SerialException(&quot;SQLException: &quot; + e.getMessage());</span>
            }
        }

<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (object != null) {</span>
<span class="nc" id="L146">            return object;</span>
        }


<span class="nc" id="L150">        throw new SerialException(&quot;The object is not set&quot;);</span>

    }

    /**
     * Sets the SQL structured type that this &lt;code&gt;SerialRef&lt;/code&gt; object
     * references to the given &lt;code&gt;Object&lt;/code&gt; object.
     *
     * @param obj an &lt;code&gt;Object&lt;/code&gt; representing the SQL structured type
     *        to be referenced
     * @throws SerialException if an error is encountered generating the
     * the structured type referenced by this &lt;code&gt;SerialRef&lt;/code&gt; object
     */
    public void setObject(Object obj) throws SerialException {
        try {
<span class="nc" id="L165">            reference.setObject(obj);</span>
<span class="nc" id="L166">        } catch (SQLException e) {</span>
<span class="nc" id="L167">            throw new SerialException(&quot;SQLException: &quot; + e.getMessage());</span>
<span class="nc" id="L168">        }</span>
<span class="nc" id="L169">        object = obj;</span>
<span class="nc" id="L170">    }</span>

    /**
     * Compares this SerialRef to the specified object.  The result is {@code
     * true} if and only if the argument is not {@code null} and is a {@code
     * SerialRef} object that represents the same object as this
     * object.
     *
     * @param  obj The object to compare this {@code SerialRef} against
     *
     * @return  {@code true} if the given object represents a {@code SerialRef}
     *          equivalent to this SerialRef, {@code false} otherwise
     *
     */
    public boolean equals(Object obj) {
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (this == obj) {</span>
<span class="nc" id="L186">            return true;</span>
        }
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if(obj instanceof SerialRef) {</span>
<span class="nc" id="L189">            SerialRef ref = (SerialRef)obj;</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            return baseTypeName.equals(ref.baseTypeName) &amp;&amp;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                    object.equals(ref.object);</span>
        }
<span class="nc" id="L193">        return false;</span>
    }

    /**
     * Returns a hash code for this {@code SerialRef}.
     * @return  a hash code value for this object.
     */
    public int hashCode() {
<span class="nc" id="L201">        return (31 + object.hashCode()) * 31 + baseTypeName.hashCode();</span>
    }

    /**
     * Returns a clone of this {@code SerialRef}.
     * The underlying {@code Ref} object will be set to null.
     *
     * @return  a clone of this SerialRef
     */
    public Object clone() {
        try {
<span class="nc" id="L212">            SerialRef ref = (SerialRef) super.clone();</span>
<span class="nc" id="L213">            ref.reference = null;</span>
<span class="nc" id="L214">            return ref;</span>
<span class="nc" id="L215">        } catch (CloneNotSupportedException ex) {</span>
            // this shouldn't happen, since we are Cloneable
<span class="nc" id="L217">            throw new InternalError();</span>
        }

    }

    /**
     * readObject is called to restore the state of the SerialRef from
     * a stream.
     */
    private void readObject(ObjectInputStream s)
            throws IOException, ClassNotFoundException {
<span class="nc" id="L228">        ObjectInputStream.GetField fields = s.readFields();</span>
<span class="nc" id="L229">        object = fields.get(&quot;object&quot;, null);</span>
<span class="nc" id="L230">        baseTypeName = (String) fields.get(&quot;baseTypeName&quot;, null);</span>
<span class="nc" id="L231">        reference = (Ref) fields.get(&quot;reference&quot;, null);</span>
<span class="nc" id="L232">    }</span>

    /**
     * writeObject is called to save the state of the SerialRef
     * to a stream.
     */
    private void writeObject(ObjectOutputStream s)
            throws IOException, ClassNotFoundException {

<span class="nc" id="L241">        ObjectOutputStream.PutField fields = s.putFields();</span>
<span class="nc" id="L242">        fields.put(&quot;baseTypeName&quot;, baseTypeName);</span>
<span class="nc" id="L243">        fields.put(&quot;object&quot;, object);</span>
        // Note: this check to see if it is an instance of Serializable
        // is for backwards compatibiity
<span class="nc bnc" id="L246" title="All 2 branches missed.">        fields.put(&quot;reference&quot;, reference instanceof Serializable ? reference : null);</span>
<span class="nc" id="L247">        s.writeFields();</span>
<span class="nc" id="L248">    }</span>

    /**
     * The identifier that assists in the serialization of this &lt;code&gt;SerialRef&lt;/code&gt;
     * object.
     */
    static final long serialVersionUID = -4727123500609662274L;


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>