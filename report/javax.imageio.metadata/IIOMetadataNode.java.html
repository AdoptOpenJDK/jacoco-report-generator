<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>IIOMetadataNode.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.imageio.metadata</a> &gt; <span class="el_source">IIOMetadataNode.java</span></div><h1>IIOMetadataNode.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.imageio.metadata;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.w3c.dom.Attr;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.DOMException;
import org.w3c.dom.NamedNodeMap;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.w3c.dom.TypeInfo;
import org.w3c.dom.UserDataHandler;


class IIODOMException extends DOMException {

    public IIODOMException(short code, String message) {
<span class="nc" id="L46">        super(code, message);</span>
<span class="nc" id="L47">    }</span>
}

class IIONamedNodeMap implements NamedNodeMap {

    List nodes;

<span class="nc" id="L54">    public IIONamedNodeMap(List nodes) {</span>
<span class="nc" id="L55">        this.nodes = nodes;</span>
<span class="nc" id="L56">    }</span>

    public int getLength() {
<span class="nc" id="L59">        return nodes.size();</span>
    }

    public Node getNamedItem(String name) {
<span class="nc" id="L63">        Iterator iter = nodes.iterator();</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">        while (iter.hasNext()) {</span>
<span class="nc" id="L65">            Node node = (Node)iter.next();</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">            if (name.equals(node.getNodeName())) {</span>
<span class="nc" id="L67">                return node;</span>
            }
<span class="nc" id="L69">        }</span>

<span class="nc" id="L71">        return null;</span>
    }

    public Node item(int index) {
<span class="nc" id="L75">        Node node = (Node)nodes.get(index);</span>
<span class="nc" id="L76">        return node;</span>
    }

    public Node removeNamedItem(java.lang.String name) {
<span class="nc" id="L80">        throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR,</span>
                               &quot;This NamedNodeMap is read-only!&quot;);
    }

    public Node setNamedItem(Node arg) {
<span class="nc" id="L85">        throw new DOMException(DOMException.NO_MODIFICATION_ALLOWED_ERR,</span>
                               &quot;This NamedNodeMap is read-only!&quot;);
    }

    /**
     * Equivalent to &lt;code&gt;getNamedItem(localName)&lt;/code&gt;.
     */
    public Node getNamedItemNS(String namespaceURI, String localName) {
<span class="nc" id="L93">        return getNamedItem(localName);</span>
    }

    /**
     * Equivalent to &lt;code&gt;setNamedItem(arg)&lt;/code&gt;.
     */
    public Node setNamedItemNS(Node arg) {
<span class="nc" id="L100">        return setNamedItem(arg);</span>
    }

    /**
     * Equivalent to &lt;code&gt;removeNamedItem(localName)&lt;/code&gt;.
     */
    public Node removeNamedItemNS(String namespaceURI, String localName) {
<span class="nc" id="L107">        return removeNamedItem(localName);</span>
    }
}

class IIONodeList implements NodeList {

    List nodes;

<span class="nc" id="L115">    public IIONodeList(List nodes) {</span>
<span class="nc" id="L116">        this.nodes = nodes;</span>
<span class="nc" id="L117">    }</span>

    public int getLength() {
<span class="nc" id="L120">        return nodes.size();</span>
    }

    public Node item(int index) {
<span class="nc bnc" id="L124" title="All 4 branches missed.">        if (index &lt; 0 || index &gt; nodes.size()) {</span>
<span class="nc" id="L125">            return null;</span>
        }
<span class="nc" id="L127">        return (Node)nodes.get(index);</span>
    }
}

class IIOAttr extends IIOMetadataNode implements Attr {

    Element owner;
    String name;
    String value;

<span class="nc" id="L137">    public IIOAttr(Element owner, String name, String value) {</span>
<span class="nc" id="L138">        this.owner = owner;</span>
<span class="nc" id="L139">        this.name = name;</span>
<span class="nc" id="L140">        this.value = value;</span>
<span class="nc" id="L141">    }</span>

    public String getName() {
<span class="nc" id="L144">        return name;</span>
    }

    public String getNodeName() {
<span class="nc" id="L148">        return name;</span>
    }

    public short getNodeType() {
<span class="nc" id="L152">        return ATTRIBUTE_NODE;</span>
    }

    public boolean getSpecified() {
<span class="nc" id="L156">        return true;</span>
    }

    public String getValue() {
<span class="nc" id="L160">        return value;</span>
    }

    public String getNodeValue() {
<span class="nc" id="L164">        return value;</span>
    }

    public void setValue(String value) {
<span class="nc" id="L168">        this.value = value;</span>
<span class="nc" id="L169">    }</span>

    public void setNodeValue(String value) {
<span class="nc" id="L172">        this.value = value;</span>
<span class="nc" id="L173">    }</span>

    public Element getOwnerElement() {
<span class="nc" id="L176">        return owner;</span>
    }

    public void setOwnerElement(Element owner) {
<span class="nc" id="L180">        this.owner = owner;</span>
<span class="nc" id="L181">    }</span>

    /** This method is new in the DOM L3 for Attr interface.
     * Could throw DOMException here, but its probably OK
     * to always return false. One reason for this, is we have no good
     * way to document this exception, since this class, IIOAttr,
     * is not a public class. The rest of the methods that throw
     * DOMException are publically documented as such on IIOMetadataNode.
     * @return false
     */
    public boolean isId() {
<span class="nc" id="L192">        return false;</span>
    }


}

/**
 * A class representing a node in a meta-data tree, which implements
 * the &lt;a
 * href=&quot;../../../../api/org/w3c/dom/Element.html&quot;&gt;
 * &lt;code&gt;org.w3c.dom.Element&lt;/code&gt;&lt;/a&gt; interface and additionally allows
 * for the storage of non-textual objects via the
 * &lt;code&gt;getUserObject&lt;/code&gt; and &lt;code&gt;setUserObject&lt;/code&gt; methods.
 *
 * &lt;p&gt; This class is not intended to be used for general XML
 * processing. In particular, &lt;code&gt;Element&lt;/code&gt; nodes created
 * within the Image I/O API are not compatible with those created by
 * Sun's standard implementation of the &lt;code&gt;org.w3.dom&lt;/code&gt; API.
 * In particular, the implementation is tuned for simple uses and may
 * not perform well for intensive processing.
 *
 * &lt;p&gt; Namespaces are ignored in this implementation.  The terms &quot;tag
 * name&quot; and &quot;node name&quot; are always considered to be synonymous.
 *
 * &lt;em&gt;Note:&lt;/em&gt;
 * The DOM Level 3 specification added a number of new methods to the
 * {@code Node}, {@code Element} and {@code Attr} interfaces that are not
 * of value to the {@code IIOMetadataNode} implementation or specification.
 *
 * Calling such methods on an {@code IIOMetadataNode}, or an {@code Attr}
 * instance returned from an {@code IIOMetadataNode} will result in a
 * {@code DOMException} being thrown.
 *
 * @see IIOMetadata#getAsTree
 * @see IIOMetadata#setFromTree
 * @see IIOMetadata#mergeTree
 *
 */
public class IIOMetadataNode implements Element, NodeList {

    /**
     * The name of the node as a &lt;code&gt;String&lt;/code&gt;.
     */
<span class="nc" id="L235">    private String nodeName = null;</span>

    /**
     * The value of the node as a &lt;code&gt;String&lt;/code&gt;.  The Image I/O
     * API typically does not make use of the node value.
     */
<span class="nc" id="L241">    private String nodeValue = null;</span>

    /**
     * The &lt;code&gt;Object&lt;/code&gt; value associated with this node.
     */
<span class="nc" id="L246">    private Object userObject = null;</span>

    /**
     * The parent node of this node, or &lt;code&gt;null&lt;/code&gt; if this node
     * forms the root of its own tree.
     */
<span class="nc" id="L252">    private IIOMetadataNode parent = null;</span>

    /**
     * The number of child nodes.
     */
<span class="nc" id="L257">    private int numChildren = 0;</span>

    /**
     * The first (leftmost) child node of this node, or
     * &lt;code&gt;null&lt;/code&gt; if this node is a leaf node.
     */
<span class="nc" id="L263">    private IIOMetadataNode firstChild = null;</span>

    /**
     * The last (rightmost) child node of this node, or
     * &lt;code&gt;null&lt;/code&gt; if this node is a leaf node.
     */
<span class="nc" id="L269">    private IIOMetadataNode lastChild = null;</span>

    /**
     * The next (right) sibling node of this node, or
     * &lt;code&gt;null&lt;/code&gt; if this node is its parent's last child node.
     */
<span class="nc" id="L275">    private IIOMetadataNode nextSibling = null;</span>

    /**
     * The previous (left) sibling node of this node, or
     * &lt;code&gt;null&lt;/code&gt; if this node is its parent's first child node.
     */
<span class="nc" id="L281">    private IIOMetadataNode previousSibling = null;</span>

    /**
     * A &lt;code&gt;List&lt;/code&gt; of &lt;code&gt;IIOAttr&lt;/code&gt; nodes representing
     * attributes.
     */
<span class="nc" id="L287">    private List attributes = new ArrayList();</span>

    /**
     * Constructs an empty &lt;code&gt;IIOMetadataNode&lt;/code&gt;.
     */
<span class="nc" id="L292">    public IIOMetadataNode() {}</span>

    /**
     * Constructs an &lt;code&gt;IIOMetadataNode&lt;/code&gt; with a given node
     * name.
     *
     * @param nodeName the name of the node, as a &lt;code&gt;String&lt;/code&gt;.
     */
<span class="nc" id="L300">    public IIOMetadataNode(String nodeName) {</span>
<span class="nc" id="L301">        this.nodeName = nodeName;</span>
<span class="nc" id="L302">    }</span>

    /**
     * Check that the node is either &lt;code&gt;null&lt;/code&gt; or an
     * &lt;code&gt;IIOMetadataNode&lt;/code&gt;.
     */
    private void checkNode(Node node) throws DOMException {
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (node == null) {</span>
<span class="nc" id="L310">            return;</span>
        }
<span class="nc bnc" id="L312" title="All 2 branches missed.">        if (!(node instanceof IIOMetadataNode)) {</span>
<span class="nc" id="L313">            throw new IIODOMException(DOMException.WRONG_DOCUMENT_ERR,</span>
                                      &quot;Node not an IIOMetadataNode!&quot;);
        }
<span class="nc" id="L316">    }</span>

    // Methods from Node

    /**
     * Returns the node name associated with this node.
     *
     * @return the node name, as a &lt;code&gt;String&lt;/code&gt;.
     */
    public String getNodeName() {
<span class="nc" id="L326">        return nodeName;</span>
    }

    /**
     * Returns the value associated with this node.
     *
     * @return the node value, as a &lt;code&gt;String&lt;/code&gt;.
     */
    public String getNodeValue(){
<span class="nc" id="L335">        return nodeValue;</span>
    }

    /**
     * Sets the &lt;code&gt;String&lt;/code&gt; value associated with this node.
     */
    public void setNodeValue(String nodeValue) {
<span class="nc" id="L342">        this.nodeValue = nodeValue;</span>
<span class="nc" id="L343">    }</span>

    /**
     * Returns the node type, which is always
     * &lt;code&gt;ELEMENT_NODE&lt;/code&gt;.
     *
     * @return the &lt;code&gt;short&lt;/code&gt; value &lt;code&gt;ELEMENT_NODE&lt;/code&gt;.
     */
    public short getNodeType() {
<span class="nc" id="L352">        return ELEMENT_NODE;</span>
    }

    /**
     * Returns the parent of this node.  A &lt;code&gt;null&lt;/code&gt; value
     * indicates that the node is the root of its own tree.  To add a
     * node to an existing tree, use one of the
     * &lt;code&gt;insertBefore&lt;/code&gt;, &lt;code&gt;replaceChild&lt;/code&gt;, or
     * &lt;code&gt;appendChild&lt;/code&gt; methods.
     *
     * @return the parent, as a &lt;code&gt;Node&lt;/code&gt;.
     *
     * @see #insertBefore
     * @see #replaceChild
     * @see #appendChild
     */
    public Node getParentNode() {
<span class="nc" id="L369">        return parent;</span>
    }

    /**
     * Returns a &lt;code&gt;NodeList&lt;/code&gt; that contains all children of this node.
     * If there are no children, this is a &lt;code&gt;NodeList&lt;/code&gt; containing
     * no nodes.
     *
     * @return the children as a &lt;code&gt;NodeList&lt;/code&gt;
     */
    public NodeList getChildNodes() {
<span class="nc" id="L380">        return this;</span>
    }

    /**
     * Returns the first child of this node, or &lt;code&gt;null&lt;/code&gt; if
     * the node has no children.
     *
     * @return the first child, as a &lt;code&gt;Node&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt;
     */
    public Node getFirstChild() {
<span class="nc" id="L391">        return firstChild;</span>
    }

    /**
     * Returns the last child of this node, or &lt;code&gt;null&lt;/code&gt; if
     * the node has no children.
     *
     * @return the last child, as a &lt;code&gt;Node&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node getLastChild() {
<span class="nc" id="L402">        return lastChild;</span>
    }

    /**
     * Returns the previous sibling of this node, or &lt;code&gt;null&lt;/code&gt;
     * if this node has no previous sibling.
     *
     * @return the previous sibling, as a &lt;code&gt;Node&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node getPreviousSibling() {
<span class="nc" id="L413">        return previousSibling;</span>
    }

    /**
     * Returns the next sibling of this node, or &lt;code&gt;null&lt;/code&gt; if
     * the node has no next sibling.
     *
     * @return the next sibling, as a &lt;code&gt;Node&lt;/code&gt;, or
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node getNextSibling() {
<span class="nc" id="L424">        return nextSibling;</span>
    }

    /**
     * Returns a &lt;code&gt;NamedNodeMap&lt;/code&gt; containing the attributes of
     * this node.
     *
     * @return a &lt;code&gt;NamedNodeMap&lt;/code&gt; containing the attributes of
     * this node.
     */
    public NamedNodeMap getAttributes() {
<span class="nc" id="L435">        return new IIONamedNodeMap(attributes);</span>
    }

    /**
     * Returns &lt;code&gt;null&lt;/code&gt;, since &lt;code&gt;IIOMetadataNode&lt;/code&gt;s
     * do not belong to any &lt;code&gt;Document&lt;/code&gt;.
     *
     * @return &lt;code&gt;null&lt;/code&gt;.
     */
    public Document getOwnerDocument() {
<span class="nc" id="L445">        return null;</span>
    }

    /**
     * Inserts the node &lt;code&gt;newChild&lt;/code&gt; before the existing
     * child node &lt;code&gt;refChild&lt;/code&gt;. If &lt;code&gt;refChild&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;, insert &lt;code&gt;newChild&lt;/code&gt; at the end of
     * the list of children.
     *
     * @param newChild the &lt;code&gt;Node&lt;/code&gt; to insert.
     * @param refChild the reference &lt;code&gt;Node&lt;/code&gt;.
     *
     * @return the node being inserted.
     *
     * @exception IllegalArgumentException if &lt;code&gt;newChild&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node insertBefore(Node newChild,
                             Node refChild) {
<span class="nc bnc" id="L464" title="All 2 branches missed.">        if (newChild == null) {</span>
<span class="nc" id="L465">            throw new IllegalArgumentException(&quot;newChild == null!&quot;);</span>
        }

<span class="nc" id="L468">        checkNode(newChild);</span>
<span class="nc" id="L469">        checkNode(refChild);</span>

<span class="nc" id="L471">        IIOMetadataNode newChildNode = (IIOMetadataNode)newChild;</span>
<span class="nc" id="L472">        IIOMetadataNode refChildNode = (IIOMetadataNode)refChild;</span>

        // Siblings, can be null.
<span class="nc" id="L475">        IIOMetadataNode previous = null;</span>
<span class="nc" id="L476">        IIOMetadataNode next = null;</span>

<span class="nc bnc" id="L478" title="All 2 branches missed.">        if (refChild == null) {</span>
<span class="nc" id="L479">            previous = this.lastChild;</span>
<span class="nc" id="L480">            next = null;</span>
<span class="nc" id="L481">            this.lastChild = newChildNode;</span>
        } else {
<span class="nc" id="L483">            previous = refChildNode.previousSibling;</span>
<span class="nc" id="L484">            next = refChildNode;</span>
        }

<span class="nc bnc" id="L487" title="All 2 branches missed.">        if (previous != null) {</span>
<span class="nc" id="L488">            previous.nextSibling = newChildNode;</span>
        }
<span class="nc bnc" id="L490" title="All 2 branches missed.">        if (next != null) {</span>
<span class="nc" id="L491">            next.previousSibling = newChildNode;</span>
        }

<span class="nc" id="L494">        newChildNode.parent = this;</span>
<span class="nc" id="L495">        newChildNode.previousSibling = previous;</span>
<span class="nc" id="L496">        newChildNode.nextSibling = next;</span>

        // N.B.: O.K. if refChild == null
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (this.firstChild == refChildNode) {</span>
<span class="nc" id="L500">            this.firstChild = newChildNode;</span>
        }

<span class="nc" id="L503">        ++numChildren;</span>
<span class="nc" id="L504">        return newChildNode;</span>
    }

    /**
     * Replaces the child node &lt;code&gt;oldChild&lt;/code&gt; with
     * &lt;code&gt;newChild&lt;/code&gt; in the list of children, and returns the
     * &lt;code&gt;oldChild&lt;/code&gt; node.
     *
     * @param newChild the &lt;code&gt;Node&lt;/code&gt; to insert.
     * @param oldChild the &lt;code&gt;Node&lt;/code&gt; to be replaced.
     *
     * @return the node replaced.
     *
     * @exception IllegalArgumentException if &lt;code&gt;newChild&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node replaceChild(Node newChild,
                             Node oldChild) {
<span class="nc bnc" id="L522" title="All 2 branches missed.">        if (newChild == null) {</span>
<span class="nc" id="L523">            throw new IllegalArgumentException(&quot;newChild == null!&quot;);</span>
        }

<span class="nc" id="L526">        checkNode(newChild);</span>
<span class="nc" id="L527">        checkNode(oldChild);</span>

<span class="nc" id="L529">        IIOMetadataNode newChildNode = (IIOMetadataNode)newChild;</span>
<span class="nc" id="L530">        IIOMetadataNode oldChildNode = (IIOMetadataNode)oldChild;</span>

<span class="nc" id="L532">        IIOMetadataNode previous = oldChildNode.previousSibling;</span>
<span class="nc" id="L533">        IIOMetadataNode next = oldChildNode.nextSibling;</span>

<span class="nc bnc" id="L535" title="All 2 branches missed.">        if (previous != null) {</span>
<span class="nc" id="L536">            previous.nextSibling = newChildNode;</span>
        }
<span class="nc bnc" id="L538" title="All 2 branches missed.">        if (next != null) {</span>
<span class="nc" id="L539">            next.previousSibling = newChildNode;</span>
        }

<span class="nc" id="L542">        newChildNode.parent = this;</span>
<span class="nc" id="L543">        newChildNode.previousSibling = previous;</span>
<span class="nc" id="L544">        newChildNode.nextSibling = next;</span>

<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (firstChild == oldChildNode) {</span>
<span class="nc" id="L547">            firstChild = newChildNode;</span>
        }
<span class="nc bnc" id="L549" title="All 2 branches missed.">        if (lastChild == oldChildNode) {</span>
<span class="nc" id="L550">            lastChild = newChildNode;</span>
        }

<span class="nc" id="L553">        oldChildNode.parent = null;</span>
<span class="nc" id="L554">        oldChildNode.previousSibling = null;</span>
<span class="nc" id="L555">        oldChildNode.nextSibling = null;</span>

<span class="nc" id="L557">        return oldChildNode;</span>
    }

    /**
     * Removes the child node indicated by &lt;code&gt;oldChild&lt;/code&gt; from
     * the list of children, and returns it.
     *
     * @param oldChild the &lt;code&gt;Node&lt;/code&gt; to be removed.
     *
     * @return the node removed.
     *
     * @exception IllegalArgumentException if &lt;code&gt;oldChild&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node removeChild(Node oldChild) {
<span class="nc bnc" id="L572" title="All 2 branches missed.">        if (oldChild == null) {</span>
<span class="nc" id="L573">            throw new IllegalArgumentException(&quot;oldChild == null!&quot;);</span>
        }
<span class="nc" id="L575">        checkNode(oldChild);</span>

<span class="nc" id="L577">        IIOMetadataNode oldChildNode = (IIOMetadataNode)oldChild;</span>

<span class="nc" id="L579">        IIOMetadataNode previous = oldChildNode.previousSibling;</span>
<span class="nc" id="L580">        IIOMetadataNode next = oldChildNode.nextSibling;</span>

<span class="nc bnc" id="L582" title="All 2 branches missed.">        if (previous != null) {</span>
<span class="nc" id="L583">            previous.nextSibling = next;</span>
        }
<span class="nc bnc" id="L585" title="All 2 branches missed.">        if (next != null) {</span>
<span class="nc" id="L586">            next.previousSibling = previous;</span>
        }

<span class="nc bnc" id="L589" title="All 2 branches missed.">        if (this.firstChild == oldChildNode) {</span>
<span class="nc" id="L590">            this.firstChild = next;</span>
        }
<span class="nc bnc" id="L592" title="All 2 branches missed.">        if (this.lastChild == oldChildNode) {</span>
<span class="nc" id="L593">            this.lastChild = previous;</span>
        }

<span class="nc" id="L596">        oldChildNode.parent = null;</span>
<span class="nc" id="L597">        oldChildNode.previousSibling = null;</span>
<span class="nc" id="L598">        oldChildNode.nextSibling = null;</span>

<span class="nc" id="L600">        --numChildren;</span>
<span class="nc" id="L601">        return oldChildNode;</span>
    }

    /**
     * Adds the node &lt;code&gt;newChild&lt;/code&gt; to the end of the list of
     * children of this node.
     *
     * @param newChild the &lt;code&gt;Node&lt;/code&gt; to insert.
     *
     * @return the node added.
     *
     * @exception IllegalArgumentException if &lt;code&gt;newChild&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     */
    public Node appendChild(Node newChild) {
<span class="nc bnc" id="L616" title="All 2 branches missed.">        if (newChild == null) {</span>
<span class="nc" id="L617">            throw new IllegalArgumentException(&quot;newChild == null!&quot;);</span>
        }
<span class="nc" id="L619">        checkNode(newChild);</span>

        // insertBefore will increment numChildren
<span class="nc" id="L622">        return insertBefore(newChild, null);</span>
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if this node has child nodes.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if this node has children.
     */
    public boolean hasChildNodes() {
<span class="nc bnc" id="L631" title="All 2 branches missed.">        return numChildren &gt; 0;</span>
    }

    /**
     * Returns a duplicate of this node.  The duplicate node has no
     * parent (&lt;code&gt;getParentNode&lt;/code&gt; returns &lt;code&gt;null&lt;/code&gt;).
     * If a shallow clone is being performed (&lt;code&gt;deep&lt;/code&gt; is
     * &lt;code&gt;false&lt;/code&gt;), the new node will not have any children or
     * siblings.  If a deep clone is being performed, the new node
     * will form the root of a complete cloned subtree.
     *
     * @param deep if &lt;code&gt;true&lt;/code&gt;, recursively clone the subtree
     * under the specified node; if &lt;code&gt;false&lt;/code&gt;, clone only the
     * node itself.
     *
     * @return the duplicate node.
     */
    public Node cloneNode(boolean deep) {
<span class="nc" id="L649">        IIOMetadataNode newNode = new IIOMetadataNode(this.nodeName);</span>
<span class="nc" id="L650">        newNode.setUserObject(getUserObject());</span>
        // Attributes

<span class="nc bnc" id="L653" title="All 2 branches missed.">        if (deep) {</span>
<span class="nc" id="L654">            for (IIOMetadataNode child = firstChild;</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">                 child != null;</span>
<span class="nc" id="L656">                 child = child.nextSibling) {</span>
<span class="nc" id="L657">                newNode.appendChild(child.cloneNode(true));</span>
            }
        }

<span class="nc" id="L661">        return newNode;</span>
    }

    /**
     * Does nothing, since &lt;code&gt;IIOMetadataNode&lt;/code&gt;s do not
     * contain &lt;code&gt;Text&lt;/code&gt; children.
     */
    public void normalize() {
<span class="nc" id="L669">    }</span>

    /**
     * Returns &lt;code&gt;false&lt;/code&gt; since DOM features are not
     * supported.
     *
     * @return &lt;code&gt;false&lt;/code&gt;.
     *
     * @param feature a &lt;code&gt;String&lt;/code&gt;, which is ignored.
     * @param version a &lt;code&gt;String&lt;/code&gt;, which is ignored.
     */
    public boolean isSupported(String feature, String version) {
<span class="nc" id="L681">        return false;</span>
    }

    /**
     * Returns &lt;code&gt;null&lt;/code&gt;, since namespaces are not supported.
     */
    public String getNamespaceURI() throws DOMException {
<span class="nc" id="L688">        return null;</span>
    }

    /**
     * Returns &lt;code&gt;null&lt;/code&gt;, since namespaces are not supported.
     *
     * @return &lt;code&gt;null&lt;/code&gt;.
     *
     * @see #setPrefix
     */
    public String getPrefix() {
<span class="nc" id="L699">        return null;</span>
    }

    /**
     * Does nothing, since namespaces are not supported.
     *
     * @param prefix a &lt;code&gt;String&lt;/code&gt;, which is ignored.
     *
     * @see #getPrefix
     */
    public void setPrefix(String prefix) {
<span class="nc" id="L710">    }</span>

    /**
     * Equivalent to &lt;code&gt;getNodeName&lt;/code&gt;.
     *
     * @return the node name, as a &lt;code&gt;String&lt;/code&gt;.
     */
    public String getLocalName() {
<span class="nc" id="L718">        return nodeName;</span>
    }

    // Methods from Element


    /**
     * Equivalent to &lt;code&gt;getNodeName&lt;/code&gt;.
     *
     * @return the node name, as a &lt;code&gt;String&lt;/code&gt;
     */
    public String getTagName() {
<span class="nc" id="L730">        return nodeName;</span>
    }

    /**
     * Retrieves an attribute value by name.
     * @param name The name of the attribute to retrieve.
     * @return The &lt;code&gt;Attr&lt;/code&gt; value as a string, or the empty string
     * if that attribute does not have a specified or default value.
     */
    public String getAttribute(String name) {
<span class="nc" id="L740">        Attr attr = getAttributeNode(name);</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">        if (attr == null) {</span>
<span class="nc" id="L742">            return &quot;&quot;;</span>
        }
<span class="nc" id="L744">        return attr.getValue();</span>
    }

    /**
     * Equivalent to &lt;code&gt;getAttribute(localName)&lt;/code&gt;.
     *
     * @see #setAttributeNS
     */
    public String getAttributeNS(String namespaceURI, String localName) {
<span class="nc" id="L753">        return getAttribute(localName);</span>
    }

    public void setAttribute(String name, String value) {
        // Name must be valid unicode chars
<span class="nc" id="L758">        boolean valid = true;</span>
<span class="nc" id="L759">        char[] chs = name.toCharArray();</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">        for (int i=0;i&lt;chs.length;i++) {</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">            if (chs[i] &gt;= 0xfffe) {</span>
<span class="nc" id="L762">                valid = false;</span>
<span class="nc" id="L763">                break;</span>
            }
        }
<span class="nc bnc" id="L766" title="All 2 branches missed.">        if (!valid) {</span>
<span class="nc" id="L767">            throw new IIODOMException(DOMException.INVALID_CHARACTER_ERR,</span>
                                      &quot;Attribute name is illegal!&quot;);
        }
<span class="nc" id="L770">        removeAttribute(name, false);</span>
<span class="nc" id="L771">        attributes.add(new IIOAttr(this, name, value));</span>
<span class="nc" id="L772">    }</span>

    /**
     * Equivalent to &lt;code&gt;setAttribute(qualifiedName, value)&lt;/code&gt;.
     *
     * @see #getAttributeNS
     */
    public void setAttributeNS(String namespaceURI,
                               String qualifiedName, String value) {
<span class="nc" id="L781">        setAttribute(qualifiedName, value);</span>
<span class="nc" id="L782">    }</span>

    public void removeAttribute(String name) {
<span class="nc" id="L785">        removeAttribute(name, true);</span>
<span class="nc" id="L786">    }</span>

    private void removeAttribute(String name, boolean checkPresent) {
<span class="nc" id="L789">        int numAttributes = attributes.size();</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">        for (int i = 0; i &lt; numAttributes; i++) {</span>
<span class="nc" id="L791">            IIOAttr attr = (IIOAttr)attributes.get(i);</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">            if (name.equals(attr.getName())) {</span>
<span class="nc" id="L793">                attr.setOwnerElement(null);</span>
<span class="nc" id="L794">                attributes.remove(i);</span>
<span class="nc" id="L795">                return;</span>
            }
        }

        // If we get here, the attribute doesn't exist
<span class="nc bnc" id="L800" title="All 2 branches missed.">        if (checkPresent) {</span>
<span class="nc" id="L801">            throw new IIODOMException(DOMException.NOT_FOUND_ERR,</span>
                                      &quot;No such attribute!&quot;);
        }
<span class="nc" id="L804">    }</span>

    /**
     * Equivalent to &lt;code&gt;removeAttribute(localName)&lt;/code&gt;.
     */
    public void removeAttributeNS(String namespaceURI,
                                  String localName) {
<span class="nc" id="L811">        removeAttribute(localName);</span>
<span class="nc" id="L812">    }</span>

    public Attr getAttributeNode(String name) {
<span class="nc" id="L815">        Node node = getAttributes().getNamedItem(name);</span>
<span class="nc" id="L816">        return (Attr)node;</span>
    }

    /**
     * Equivalent to &lt;code&gt;getAttributeNode(localName)&lt;/code&gt;.
     *
     * @see #setAttributeNodeNS
     */
   public Attr getAttributeNodeNS(String namespaceURI,
                                   String localName) {
<span class="nc" id="L826">        return getAttributeNode(localName);</span>
    }

    public Attr setAttributeNode(Attr newAttr) throws DOMException {
<span class="nc" id="L830">        Element owner = newAttr.getOwnerElement();</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">        if (owner != null) {</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">            if (owner == this) {</span>
<span class="nc" id="L833">                return null;</span>
            } else {
<span class="nc" id="L835">                throw new DOMException(DOMException.INUSE_ATTRIBUTE_ERR,</span>
                                       &quot;Attribute is already in use&quot;);
            }
        }

        IIOAttr attr;
<span class="nc bnc" id="L841" title="All 2 branches missed.">        if (newAttr instanceof IIOAttr) {</span>
<span class="nc" id="L842">            attr = (IIOAttr)newAttr;</span>
<span class="nc" id="L843">            attr.setOwnerElement(this);</span>
        } else {
<span class="nc" id="L845">            attr = new IIOAttr(this,</span>
<span class="nc" id="L846">                               newAttr.getName(),</span>
<span class="nc" id="L847">                               newAttr.getValue());</span>
        }

<span class="nc" id="L850">        Attr oldAttr = getAttributeNode(attr.getName());</span>
<span class="nc bnc" id="L851" title="All 2 branches missed.">        if (oldAttr != null) {</span>
<span class="nc" id="L852">            removeAttributeNode(oldAttr);</span>
        }

<span class="nc" id="L855">        attributes.add(attr);</span>

<span class="nc" id="L857">        return oldAttr;</span>
    }

    /**
     * Equivalent to &lt;code&gt;setAttributeNode(newAttr)&lt;/code&gt;.
     *
     * @see #getAttributeNodeNS
     */
    public Attr setAttributeNodeNS(Attr newAttr) {
<span class="nc" id="L866">        return setAttributeNode(newAttr);</span>
    }

    public Attr removeAttributeNode(Attr oldAttr) {
<span class="nc" id="L870">        removeAttribute(oldAttr.getName());</span>
<span class="nc" id="L871">        return oldAttr;</span>
    }

    public NodeList getElementsByTagName(String name) {
<span class="nc" id="L875">        List l = new ArrayList();</span>
<span class="nc" id="L876">        getElementsByTagName(name, l);</span>
<span class="nc" id="L877">        return new IIONodeList(l);</span>
    }

    private void getElementsByTagName(String name, List l) {
<span class="nc bnc" id="L881" title="All 2 branches missed.">        if (nodeName.equals(name)) {</span>
<span class="nc" id="L882">            l.add(this);</span>
        }

<span class="nc" id="L885">        Node child = getFirstChild();</span>
<span class="nc bnc" id="L886" title="All 2 branches missed.">        while (child != null) {</span>
<span class="nc" id="L887">            ((IIOMetadataNode)child).getElementsByTagName(name, l);</span>
<span class="nc" id="L888">            child = child.getNextSibling();</span>
        }
<span class="nc" id="L890">    }</span>

    /**
     * Equivalent to &lt;code&gt;getElementsByTagName(localName)&lt;/code&gt;.
     */
    public NodeList getElementsByTagNameNS(String namespaceURI,
                                           String localName) {
<span class="nc" id="L897">        return getElementsByTagName(localName);</span>
    }

    public boolean hasAttributes() {
<span class="nc bnc" id="L901" title="All 2 branches missed.">        return attributes.size() &gt; 0;</span>
    }

    public boolean hasAttribute(String name) {
<span class="nc bnc" id="L905" title="All 2 branches missed.">        return getAttributeNode(name) != null;</span>
    }

    /**
     * Equivalent to &lt;code&gt;hasAttribute(localName)&lt;/code&gt;.
     */
    public boolean hasAttributeNS(String namespaceURI,
                                  String localName) {
<span class="nc" id="L913">        return hasAttribute(localName);</span>
    }

    // Methods from NodeList

    public int getLength() {
<span class="nc" id="L919">        return numChildren;</span>
    }

    public Node item(int index) {
<span class="nc bnc" id="L923" title="All 2 branches missed.">        if (index &lt; 0) {</span>
<span class="nc" id="L924">            return null;</span>
        }

<span class="nc" id="L927">        Node child = getFirstChild();</span>
<span class="nc bnc" id="L928" title="All 4 branches missed.">        while (child != null &amp;&amp; index-- &gt; 0) {</span>
<span class="nc" id="L929">            child = child.getNextSibling();</span>
        }
<span class="nc" id="L931">        return child;</span>
    }

    /**
     * Returns the &lt;code&gt;Object&lt;/code&gt; value associated with this node.
     *
     * @return the user &lt;code&gt;Object&lt;/code&gt;.
     *
     * @see #setUserObject
     */
    public Object getUserObject() {
<span class="nc" id="L942">        return userObject;</span>
    }

    /**
     * Sets the value associated with this node.
     *
     * @param userObject the user &lt;code&gt;Object&lt;/code&gt;.
     *
     * @see #getUserObject
     */
    public void setUserObject(Object userObject) {
<span class="nc" id="L953">        this.userObject = userObject;</span>
<span class="nc" id="L954">    }</span>

    // Start of dummy methods for DOM L3.

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public void setIdAttribute(String name,
                               boolean isId)
                               throws DOMException {
<span class="nc" id="L966">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public void setIdAttributeNS(String namespaceURI,
                                 String localName,
                                 boolean isId)
                                 throws DOMException {
<span class="nc" id="L979">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public void setIdAttributeNode(Attr idAttr,
                                   boolean isId)
                                   throws DOMException {
<span class="nc" id="L991">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public TypeInfo getSchemaTypeInfo() throws DOMException {
<span class="nc" id="L1001">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public Object setUserData(String key,
                              Object data,
                              UserDataHandler handler) throws DOMException {
<span class="nc" id="L1013">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public Object getUserData(String key) throws DOMException {
<span class="nc" id="L1023">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public Object getFeature(String feature, String version)
                              throws DOMException {
<span class="nc" id="L1034">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public boolean isSameNode(Node node) throws DOMException {
<span class="nc" id="L1044">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public boolean isEqualNode(Node node) throws DOMException {
<span class="nc" id="L1054">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public String lookupNamespaceURI(String prefix) throws DOMException {
<span class="nc" id="L1064">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public boolean isDefaultNamespace(String namespaceURI)
                                               throws DOMException {
<span class="nc" id="L1075">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public String lookupPrefix(String namespaceURI) throws DOMException {
<span class="nc" id="L1085">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public String getTextContent() throws DOMException {
<span class="nc" id="L1095">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public void setTextContent(String textContent) throws DOMException {
<span class="nc" id="L1105">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public short compareDocumentPosition(Node other)
                                         throws DOMException {
<span class="nc" id="L1116">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }

    /**
     * This DOM Level 3 method is not supported for {@code IIOMetadataNode}
     * and will throw a {@code DOMException}.
     * @throws DOMException - always.
     */
    public String getBaseURI() throws DOMException {
<span class="nc" id="L1126">        throw new DOMException(DOMException.NOT_SUPPORTED_ERR,</span>
                               &quot;Method not supported&quot;);
    }
    //End of dummy methods for DOM L3.


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>