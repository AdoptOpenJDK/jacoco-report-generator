<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>IIOMetadataFormatImpl.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.imageio.metadata</a> &gt; <span class="el_source">IIOMetadataFormatImpl.java</span></div><h1>IIOMetadataFormatImpl.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2004, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.imageio.metadata;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.MissingResourceException;
import java.util.ResourceBundle;
import javax.imageio.ImageTypeSpecifier;
import com.sun.imageio.plugins.common.StandardMetadataFormat;

/**
 * A concrete class providing a reusable implementation of the
 * &lt;code&gt;IIOMetadataFormat&lt;/code&gt; interface.  In addition, a static
 * instance representing the standard, plug-in neutral
 * &lt;code&gt;javax_imageio_1.0&lt;/code&gt; format is provided by the
 * &lt;code&gt;getStandardFormatInstance&lt;/code&gt; method.
 *
 * &lt;p&gt; In order to supply localized descriptions of elements and
 * attributes, a &lt;code&gt;ResourceBundle&lt;/code&gt; with a base name of
 * &lt;code&gt;this.getClass().getName() + &quot;Resources&quot;&lt;/code&gt; should be
 * supplied via the usual mechanism used by
 * &lt;code&gt;ResourceBundle.getBundle&lt;/code&gt;.  Briefly, the subclasser
 * supplies one or more additional classes according to a naming
 * convention (by default, the fully-qualified name of the subclass
 * extending &lt;code&gt;IIMetadataFormatImpl&lt;/code&gt;, plus the string
 * &quot;Resources&quot;, plus the country, language, and variant codes
 * separated by underscores).  At run time, calls to
 * &lt;code&gt;getElementDescription&lt;/code&gt; or
 * &lt;code&gt;getAttributeDescription&lt;/code&gt; will attempt to load such
 * classes dynamically according to the supplied locale, and will use
 * either the element name, or the element name followed by a '/'
 * character followed by the attribute name as a key.  This key will
 * be supplied to the &lt;code&gt;ResourceBundle&lt;/code&gt;'s
 * &lt;code&gt;getString&lt;/code&gt; method, and the resulting localized
 * description of the node or attribute is returned.
 *
 * &lt;p&gt; The subclass may supply a different base name for the resource
 * bundles using the &lt;code&gt;setResourceBaseName&lt;/code&gt; method.
 *
 * &lt;p&gt; A subclass may choose its own localization mechanism, if so
 * desired, by overriding the supplied implementations of
 * &lt;code&gt;getElementDescription&lt;/code&gt; and
 * &lt;code&gt;getAttributeDescription&lt;/code&gt;.
 *
 * @see ResourceBundle#getBundle(String,Locale)
 *
 */
public abstract class IIOMetadataFormatImpl implements IIOMetadataFormat {

    /**
     * A &lt;code&gt;String&lt;/code&gt; constant containing the standard format
     * name, &lt;code&gt;&quot;javax_imageio_1.0&quot;&lt;/code&gt;.
     */
    public static final String standardMetadataFormatName =
        &quot;javax_imageio_1.0&quot;;

<span class="nc" id="L86">    private static IIOMetadataFormat standardFormat = null;</span>

<span class="nc" id="L88">    private String resourceBaseName = this.getClass().getName() + &quot;Resources&quot;;</span>

    private String rootName;

    // Element name (String) -&gt; Element
<span class="nc" id="L93">    private HashMap elementMap = new HashMap();</span>

<span class="nc" id="L95">    class Element {</span>
        String elementName;

        int childPolicy;
<span class="nc" id="L99">        int minChildren = 0;</span>
<span class="nc" id="L100">        int maxChildren = 0;</span>

        // Child names (Strings)
<span class="nc" id="L103">        List childList = new ArrayList();</span>

        // Parent names (Strings)
<span class="nc" id="L106">        List parentList = new ArrayList();</span>

        // List of attribute names in the order they were added
<span class="nc" id="L109">        List attrList = new ArrayList();</span>
        // Attr name (String) -&gt; Attribute
<span class="nc" id="L111">        Map attrMap = new HashMap();</span>

        ObjectValue objectValue;
    }

<span class="nc" id="L116">    class Attribute {</span>
        String attrName;

<span class="nc" id="L119">        int valueType = VALUE_ARBITRARY;</span>
        int dataType;
        boolean required;
<span class="nc" id="L122">        String defaultValue = null;</span>

        // enumeration
        List enumeratedValues;

        // range
        String minValue;
        String maxValue;

        // list
        int listMinLength;
        int listMaxLength;
    }

<span class="nc" id="L136">    class ObjectValue {</span>
<span class="nc" id="L137">        int valueType = VALUE_NONE;</span>
<span class="nc" id="L138">        Class classType = null;</span>
<span class="nc" id="L139">        Object defaultValue = null;</span>

        // Meaningful only if valueType == VALUE_ENUMERATION
<span class="nc" id="L142">        List enumeratedValues = null;</span>

        // Meaningful only if valueType == VALUE_RANGE
<span class="nc" id="L145">        Comparable minValue = null;</span>
<span class="nc" id="L146">        Comparable maxValue = null;</span>

        // Meaningful only if valueType == VALUE_LIST
<span class="nc" id="L149">        int arrayMinLength = 0;</span>
<span class="nc" id="L150">        int arrayMaxLength = 0;</span>
    }

    /**
     * Constructs a blank &lt;code&gt;IIOMetadataFormatImpl&lt;/code&gt; instance,
     * with a given root element name and child policy (other than
     * &lt;code&gt;CHILD_POLICY_REPEAT&lt;/code&gt;).  Additional elements, and
     * their attributes and &lt;code&gt;Object&lt;/code&gt; reference information
     * may be added using the various &lt;code&gt;add&lt;/code&gt; methods.
     *
     * @param rootName the name of the root element.
     * @param childPolicy one of the &lt;code&gt;CHILD_POLICY_*&lt;/code&gt; constants,
     * other than &lt;code&gt;CHILD_POLICY_REPEAT&lt;/code&gt;.
     *
     * @exception IllegalArgumentException if &lt;code&gt;rootName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;childPolicy&lt;/code&gt; is
     * not one of the predefined constants.
     */
    public IIOMetadataFormatImpl(String rootName,
<span class="nc" id="L170">                                 int childPolicy) {</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (rootName == null) {</span>
<span class="nc" id="L172">            throw new IllegalArgumentException(&quot;rootName == null!&quot;);</span>
        }
<span class="nc bnc" id="L174" title="All 6 branches missed.">        if (childPolicy &lt; CHILD_POLICY_EMPTY ||</span>
            childPolicy &gt; CHILD_POLICY_MAX ||
            childPolicy == CHILD_POLICY_REPEAT) {
<span class="nc" id="L177">            throw new IllegalArgumentException(&quot;Invalid value for childPolicy!&quot;);</span>
        }

<span class="nc" id="L180">        this.rootName = rootName;</span>

<span class="nc" id="L182">        Element root = new Element();</span>
<span class="nc" id="L183">        root.elementName = rootName;</span>
<span class="nc" id="L184">        root.childPolicy = childPolicy;</span>

<span class="nc" id="L186">        elementMap.put(rootName, root);</span>
<span class="nc" id="L187">    }</span>

    /**
     * Constructs a blank &lt;code&gt;IIOMetadataFormatImpl&lt;/code&gt; instance,
     * with a given root element name and a child policy of
     * &lt;code&gt;CHILD_POLICY_REPEAT&lt;/code&gt;.  Additional elements, and
     * their attributes and &lt;code&gt;Object&lt;/code&gt; reference information
     * may be added using the various &lt;code&gt;add&lt;/code&gt; methods.
     *
     * @param rootName the name of the root element.
     * @param minChildren the minimum number of children of the node.
     * @param maxChildren the maximum number of children of the node.
     *
     * @exception IllegalArgumentException if &lt;code&gt;rootName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;minChildren&lt;/code&gt;
     * is negative or larger than &lt;code&gt;maxChildren&lt;/code&gt;.
     */
    public IIOMetadataFormatImpl(String rootName,
                                 int minChildren,
<span class="nc" id="L207">                                 int maxChildren) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (rootName == null) {</span>
<span class="nc" id="L209">            throw new IllegalArgumentException(&quot;rootName == null!&quot;);</span>
        }
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (minChildren &lt; 0) {</span>
<span class="nc" id="L212">            throw new IllegalArgumentException(&quot;minChildren &lt; 0!&quot;);</span>
        }
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (minChildren &gt; maxChildren) {</span>
<span class="nc" id="L215">            throw new IllegalArgumentException(&quot;minChildren &gt; maxChildren!&quot;);</span>
        }

<span class="nc" id="L218">        Element root = new Element();</span>
<span class="nc" id="L219">        root.elementName = rootName;</span>
<span class="nc" id="L220">        root.childPolicy = CHILD_POLICY_REPEAT;</span>
<span class="nc" id="L221">        root.minChildren = minChildren;</span>
<span class="nc" id="L222">        root.maxChildren = maxChildren;</span>

<span class="nc" id="L224">        this.rootName = rootName;</span>
<span class="nc" id="L225">        elementMap.put(rootName, root);</span>
<span class="nc" id="L226">    }</span>

    /**
     * Sets a new base name for locating &lt;code&gt;ResourceBundle&lt;/code&gt;s
     * containing descriptions of elements and attributes for this
     * format.
     *
     * &lt;p&gt; Prior to the first time this method is called, the base
     * name will be equal to &lt;code&gt;this.getClass().getName() +
     * &quot;Resources&quot;&lt;/code&gt;.
     *
     * @param resourceBaseName a &lt;code&gt;String&lt;/code&gt; containing the new
     * base name.
     *
     * @exception IllegalArgumentException if
     * &lt;code&gt;resourceBaseName&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     *
     * @see #getResourceBaseName
     */
    protected void setResourceBaseName(String resourceBaseName) {
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (resourceBaseName == null) {</span>
<span class="nc" id="L247">            throw new IllegalArgumentException(&quot;resourceBaseName == null!&quot;);</span>
        }
<span class="nc" id="L249">        this.resourceBaseName = resourceBaseName;</span>
<span class="nc" id="L250">    }</span>

    /**
     * Returns the currently set base name for locating
     * &lt;code&gt;ResourceBundle&lt;/code&gt;s.
     *
     * @return a &lt;code&gt;String&lt;/code&gt; containing the base name.
     *
     * @see #setResourceBaseName
     */
    protected String getResourceBaseName() {
<span class="nc" id="L261">        return resourceBaseName;</span>
    }

    /**
     * Utility method for locating an element.
     *
     * @param mustAppear if &lt;code&gt;true&lt;/code&gt;, throw an
     * &lt;code&gt;IllegalArgumentException&lt;/code&gt; if no such node exists;
     * if &lt;code&gt;false&lt;/code&gt;, just return null.
     */
    private Element getElement(String elementName, boolean mustAppear) {
<span class="nc bnc" id="L272" title="All 4 branches missed.">        if (mustAppear &amp;&amp; (elementName == null)) {</span>
<span class="nc" id="L273">            throw new IllegalArgumentException(&quot;element name is null!&quot;);</span>
        }
<span class="nc" id="L275">        Element element = (Element)elementMap.get(elementName);</span>
<span class="nc bnc" id="L276" title="All 4 branches missed.">        if (mustAppear &amp;&amp; (element == null)) {</span>
<span class="nc" id="L277">            throw new IllegalArgumentException(&quot;No such element: &quot; +</span>
                                               elementName);
        }
<span class="nc" id="L280">        return element;</span>
    }

    private Element getElement(String elementName) {
<span class="nc" id="L284">        return getElement(elementName, true);</span>
    }

    // Utility method for locating an attribute
    private Attribute getAttribute(String elementName, String attrName) {
<span class="nc" id="L289">        Element element = getElement(elementName);</span>
<span class="nc" id="L290">        Attribute attr = (Attribute)element.attrMap.get(attrName);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (attr == null) {</span>
<span class="nc" id="L292">            throw new IllegalArgumentException(&quot;No such attribute \&quot;&quot; +</span>
                                               attrName + &quot;\&quot;!&quot;);
        }
<span class="nc" id="L295">        return attr;</span>
    }

    // Setup

    /**
     * Adds a new element type to this metadata document format with a
     * child policy other than &lt;code&gt;CHILD_POLICY_REPEAT&lt;/code&gt;.
     *
     * @param elementName the name of the new element.
     * @param parentName the name of the element that will be the
     * parent of the new element.
     * @param childPolicy one of the &lt;code&gt;CHILD_POLICY_*&lt;/code&gt;
     * constants, other than &lt;code&gt;CHILD_POLICY_REPEAT&lt;/code&gt;,
     * indicating the child policy of the new element.
     *
     * @exception IllegalArgumentException if &lt;code&gt;parentName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;childPolicy&lt;/code&gt;
     * is not one of the predefined constants.
     */
    protected void addElement(String elementName,
                              String parentName,
                              int childPolicy) {
<span class="nc" id="L320">        Element parent = getElement(parentName);</span>
<span class="nc bnc" id="L321" title="All 6 branches missed.">        if (childPolicy &lt; CHILD_POLICY_EMPTY ||</span>
            childPolicy &gt; CHILD_POLICY_MAX ||
            childPolicy == CHILD_POLICY_REPEAT) {
<span class="nc" id="L324">            throw new IllegalArgumentException</span>
                (&quot;Invalid value for childPolicy!&quot;);
        }

<span class="nc" id="L328">        Element element = new Element();</span>
<span class="nc" id="L329">        element.elementName = elementName;</span>
<span class="nc" id="L330">        element.childPolicy = childPolicy;</span>

<span class="nc" id="L332">        parent.childList.add(elementName);</span>
<span class="nc" id="L333">        element.parentList.add(parentName);</span>

<span class="nc" id="L335">        elementMap.put(elementName, element);</span>
<span class="nc" id="L336">    }</span>

    /**
     * Adds a new element type to this metadata document format with a
     * child policy of &lt;code&gt;CHILD_POLICY_REPEAT&lt;/code&gt;.
     *
     * @param elementName the name of the new element.
     * @param parentName the name of the element that will be the
     * parent of the new element.
     * @param minChildren the minimum number of children of the node.
     * @param maxChildren the maximum number of children of the node.
     *
     * @exception IllegalArgumentException if &lt;code&gt;parentName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;minChildren&lt;/code&gt;
     * is negative or larger than &lt;code&gt;maxChildren&lt;/code&gt;.
     */
    protected void addElement(String elementName,
                              String parentName,
                              int minChildren,
                              int maxChildren) {
<span class="nc" id="L358">        Element parent = getElement(parentName);</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (minChildren &lt; 0) {</span>
<span class="nc" id="L360">            throw new IllegalArgumentException(&quot;minChildren &lt; 0!&quot;);</span>
        }
<span class="nc bnc" id="L362" title="All 2 branches missed.">        if (minChildren &gt; maxChildren) {</span>
<span class="nc" id="L363">            throw new IllegalArgumentException(&quot;minChildren &gt; maxChildren!&quot;);</span>
        }

<span class="nc" id="L366">        Element element = new Element();</span>
<span class="nc" id="L367">        element.elementName = elementName;</span>
<span class="nc" id="L368">        element.childPolicy = CHILD_POLICY_REPEAT;</span>
<span class="nc" id="L369">        element.minChildren = minChildren;</span>
<span class="nc" id="L370">        element.maxChildren = maxChildren;</span>

<span class="nc" id="L372">        parent.childList.add(elementName);</span>
<span class="nc" id="L373">        element.parentList.add(parentName);</span>

<span class="nc" id="L375">        elementMap.put(elementName, element);</span>
<span class="nc" id="L376">    }</span>

    /**
     * Adds an existing element to the list of legal children for a
     * given parent node type.
     *
     * @param parentName the name of the element that will be the
     * new parent of the element.
     * @param elementName the name of the element to be added as a
     * child.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;parentName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     */
    protected void addChildElement(String elementName, String parentName) {
<span class="nc" id="L395">        Element parent = getElement(parentName);</span>
<span class="nc" id="L396">        Element element = getElement(elementName);</span>
<span class="nc" id="L397">        parent.childList.add(elementName);</span>
<span class="nc" id="L398">        element.parentList.add(parentName);</span>
<span class="nc" id="L399">    }</span>

    /**
     * Removes an element from the format.  If no element with the
     * given name was present, nothing happens and no exception is
     * thrown.
     *
     * @param elementName the name of the element to be removed.
     */
    protected void removeElement(String elementName) {
<span class="nc" id="L409">        Element element = getElement(elementName, false);</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (element != null) {</span>
<span class="nc" id="L411">            Iterator iter = element.parentList.iterator();</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">            while (iter.hasNext()) {</span>
<span class="nc" id="L413">                String parentName = (String)iter.next();</span>
<span class="nc" id="L414">                Element parent = getElement(parentName, false);</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">                if (parent != null) {</span>
<span class="nc" id="L416">                    parent.childList.remove(elementName);</span>
                }
<span class="nc" id="L418">            }</span>
<span class="nc" id="L419">            elementMap.remove(elementName);</span>
        }
<span class="nc" id="L421">    }</span>

    /**
     * Adds a new attribute to a previously defined element that may
     * be set to an arbitrary value.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute being added.
     * @param dataType the data type (string format) of the attribute,
     * one of the &lt;code&gt;DATATYPE_*&lt;/code&gt; constants.
     * @param required &lt;code&gt;true&lt;/code&gt; if the attribute must be present.
     * @param defaultValue the default value for the attribute, or
     * &lt;code&gt;null&lt;/code&gt;.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;attrName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;dataType&lt;/code&gt; is
     * not one of the predefined constants.
     */
    protected void addAttribute(String elementName,
                                String attrName,
                                int dataType,
                                boolean required,
                                String defaultValue) {
<span class="nc" id="L448">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">        if (attrName == null) {</span>
<span class="nc" id="L450">            throw new IllegalArgumentException(&quot;attrName == null!&quot;);</span>
        }
<span class="nc bnc" id="L452" title="All 4 branches missed.">        if (dataType &lt; DATATYPE_STRING || dataType &gt; DATATYPE_DOUBLE) {</span>
<span class="nc" id="L453">            throw new IllegalArgumentException(&quot;Invalid value for dataType!&quot;);</span>
        }

<span class="nc" id="L456">        Attribute attr = new Attribute();</span>
<span class="nc" id="L457">        attr.attrName = attrName;</span>
<span class="nc" id="L458">        attr.valueType = VALUE_ARBITRARY;</span>
<span class="nc" id="L459">        attr.dataType = dataType;</span>
<span class="nc" id="L460">        attr.required = required;</span>
<span class="nc" id="L461">        attr.defaultValue = defaultValue;</span>

<span class="nc" id="L463">        element.attrList.add(attrName);</span>
<span class="nc" id="L464">        element.attrMap.put(attrName, attr);</span>
<span class="nc" id="L465">    }</span>

    /**
     * Adds a new attribute to a previously defined element that will
     * be defined by a set of enumerated values.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute being added.
     * @param dataType the data type (string format) of the attribute,
     * one of the &lt;code&gt;DATATYPE_*&lt;/code&gt; constants.
     * @param required &lt;code&gt;true&lt;/code&gt; if the attribute must be present.
     * @param defaultValue the default value for the attribute, or
     * &lt;code&gt;null&lt;/code&gt;.
     * @param enumeratedValues a &lt;code&gt;List&lt;/code&gt; of
     * &lt;code&gt;String&lt;/code&gt;s containing the legal values for the
     * attribute.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;attrName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;dataType&lt;/code&gt; is
     * not one of the predefined constants.
     * @exception IllegalArgumentException if
     * &lt;code&gt;enumeratedValues&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if
     * &lt;code&gt;enumeratedValues&lt;/code&gt; does not contain at least one
     * entry.
     * @exception IllegalArgumentException if
     * &lt;code&gt;enumeratedValues&lt;/code&gt; contains an element that is not a
     * &lt;code&gt;String&lt;/code&gt; or is &lt;code&gt;null&lt;/code&gt;.
     */
    protected void addAttribute(String elementName,
                                String attrName,
                                int dataType,
                                boolean required,
                                String defaultValue,
                                List&lt;String&gt; enumeratedValues) {
<span class="nc" id="L504">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">        if (attrName == null) {</span>
<span class="nc" id="L506">            throw new IllegalArgumentException(&quot;attrName == null!&quot;);</span>
        }
<span class="nc bnc" id="L508" title="All 4 branches missed.">        if (dataType &lt; DATATYPE_STRING || dataType &gt; DATATYPE_DOUBLE) {</span>
<span class="nc" id="L509">            throw new IllegalArgumentException(&quot;Invalid value for dataType!&quot;);</span>
        }
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (enumeratedValues == null) {</span>
<span class="nc" id="L512">            throw new IllegalArgumentException(&quot;enumeratedValues == null!&quot;);</span>
        }
<span class="nc bnc" id="L514" title="All 2 branches missed.">        if (enumeratedValues.size() == 0) {</span>
<span class="nc" id="L515">            throw new IllegalArgumentException(&quot;enumeratedValues is empty!&quot;);</span>
        }
<span class="nc" id="L517">        Iterator iter = enumeratedValues.iterator();</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">        while (iter.hasNext()) {</span>
<span class="nc" id="L519">            Object o = iter.next();</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">            if (o == null) {</span>
<span class="nc" id="L521">                throw new IllegalArgumentException</span>
                    (&quot;enumeratedValues contains a null!&quot;);
            }
<span class="nc bnc" id="L524" title="All 2 branches missed.">            if (!(o instanceof String)) {</span>
<span class="nc" id="L525">                throw new IllegalArgumentException</span>
                    (&quot;enumeratedValues contains a non-String value!&quot;);
            }
<span class="nc" id="L528">        }</span>

<span class="nc" id="L530">        Attribute attr = new Attribute();</span>
<span class="nc" id="L531">        attr.attrName = attrName;</span>
<span class="nc" id="L532">        attr.valueType = VALUE_ENUMERATION;</span>
<span class="nc" id="L533">        attr.dataType = dataType;</span>
<span class="nc" id="L534">        attr.required = required;</span>
<span class="nc" id="L535">        attr.defaultValue = defaultValue;</span>
<span class="nc" id="L536">        attr.enumeratedValues = enumeratedValues;</span>

<span class="nc" id="L538">        element.attrList.add(attrName);</span>
<span class="nc" id="L539">        element.attrMap.put(attrName, attr);</span>
<span class="nc" id="L540">    }</span>

    /**
     * Adds a new attribute to a previously defined element that will
     * be defined by a range of values.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute being added.
     * @param dataType the data type (string format) of the attribute,
     * one of the &lt;code&gt;DATATYPE_*&lt;/code&gt; constants.
     * @param required &lt;code&gt;true&lt;/code&gt; if the attribute must be present.
     * @param defaultValue the default value for the attribute, or
     * &lt;code&gt;null&lt;/code&gt;.
     * @param minValue the smallest (inclusive or exclusive depending
     * on the value of &lt;code&gt;minInclusive&lt;/code&gt;) legal value for the
     * attribute, as a &lt;code&gt;String&lt;/code&gt;.
     * @param maxValue the largest (inclusive or exclusive depending
     * on the value of &lt;code&gt;minInclusive&lt;/code&gt;) legal value for the
     * attribute, as a &lt;code&gt;String&lt;/code&gt;.
     * @param minInclusive &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;minValue&lt;/code&gt;
     * is inclusive.
     * @param maxInclusive &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;maxValue&lt;/code&gt;
     * is inclusive.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;attrName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;dataType&lt;/code&gt; is
     * not one of the predefined constants.
     */
    protected void addAttribute(String elementName,
                                String attrName,
                                int dataType,
                                boolean required,
                                String defaultValue,
                                String minValue,
                                String maxValue,
                                boolean minInclusive,
                                boolean maxInclusive) {
<span class="nc" id="L581">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">        if (attrName == null) {</span>
<span class="nc" id="L583">            throw new IllegalArgumentException(&quot;attrName == null!&quot;);</span>
        }
<span class="nc bnc" id="L585" title="All 4 branches missed.">        if (dataType &lt; DATATYPE_STRING || dataType &gt; DATATYPE_DOUBLE) {</span>
<span class="nc" id="L586">            throw new IllegalArgumentException(&quot;Invalid value for dataType!&quot;);</span>
        }

<span class="nc" id="L589">        Attribute attr = new Attribute();</span>
<span class="nc" id="L590">        attr.attrName = attrName;</span>
<span class="nc" id="L591">        attr.valueType = VALUE_RANGE;</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">        if (minInclusive) {</span>
<span class="nc" id="L593">            attr.valueType |= VALUE_RANGE_MIN_INCLUSIVE_MASK;</span>
        }
<span class="nc bnc" id="L595" title="All 2 branches missed.">        if (maxInclusive) {</span>
<span class="nc" id="L596">            attr.valueType |= VALUE_RANGE_MAX_INCLUSIVE_MASK;</span>
        }
<span class="nc" id="L598">        attr.dataType = dataType;</span>
<span class="nc" id="L599">        attr.required = required;</span>
<span class="nc" id="L600">        attr.defaultValue = defaultValue;</span>
<span class="nc" id="L601">        attr.minValue = minValue;</span>
<span class="nc" id="L602">        attr.maxValue = maxValue;</span>

<span class="nc" id="L604">        element.attrList.add(attrName);</span>
<span class="nc" id="L605">        element.attrMap.put(attrName, attr);</span>
<span class="nc" id="L606">    }</span>

    /**
     * Adds a new attribute to a previously defined element that will
     * be defined by a list of values.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute being added.
     * @param dataType the data type (string format) of the attribute,
     * one of the &lt;code&gt;DATATYPE_*&lt;/code&gt; constants.
     * @param required &lt;code&gt;true&lt;/code&gt; if the attribute must be present.
     * @param listMinLength the smallest legal number of list items.
     * @param listMaxLength the largest legal number of list items.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;attrName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if &lt;code&gt;dataType&lt;/code&gt; is
     * not one of the predefined constants.
     * @exception IllegalArgumentException if
     * &lt;code&gt;listMinLength&lt;/code&gt; is negative or larger than
     * &lt;code&gt;listMaxLength&lt;/code&gt;.
     */
    protected void addAttribute(String elementName,
                                String attrName,
                                int dataType,
                                boolean required,
                                int listMinLength,
                                int listMaxLength) {
<span class="nc" id="L637">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">        if (attrName == null) {</span>
<span class="nc" id="L639">            throw new IllegalArgumentException(&quot;attrName == null!&quot;);</span>
        }
<span class="nc bnc" id="L641" title="All 4 branches missed.">        if (dataType &lt; DATATYPE_STRING || dataType &gt; DATATYPE_DOUBLE) {</span>
<span class="nc" id="L642">            throw new IllegalArgumentException(&quot;Invalid value for dataType!&quot;);</span>
        }
<span class="nc bnc" id="L644" title="All 4 branches missed.">        if (listMinLength &lt; 0 || listMinLength &gt; listMaxLength) {</span>
<span class="nc" id="L645">            throw new IllegalArgumentException(&quot;Invalid list bounds!&quot;);</span>
        }

<span class="nc" id="L648">        Attribute attr = new Attribute();</span>
<span class="nc" id="L649">        attr.attrName = attrName;</span>
<span class="nc" id="L650">        attr.valueType = VALUE_LIST;</span>
<span class="nc" id="L651">        attr.dataType = dataType;</span>
<span class="nc" id="L652">        attr.required = required;</span>
<span class="nc" id="L653">        attr.listMinLength = listMinLength;</span>
<span class="nc" id="L654">        attr.listMaxLength = listMaxLength;</span>

<span class="nc" id="L656">        element.attrList.add(attrName);</span>
<span class="nc" id="L657">        element.attrMap.put(attrName, attr);</span>
<span class="nc" id="L658">    }</span>

    /**
     * Adds a new attribute to a previously defined element that will
     * be defined by the enumerated values &lt;code&gt;TRUE&lt;/code&gt; and
     * &lt;code&gt;FALSE&lt;/code&gt;, with a datatype of
     * &lt;code&gt;DATATYPE_BOOLEAN&lt;/code&gt;.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute being added.
     * @param hasDefaultValue &lt;code&gt;true&lt;/code&gt; if a default value
     * should be present.
     * @param defaultValue the default value for the attribute as a
     * &lt;code&gt;boolean&lt;/code&gt;, ignored if &lt;code&gt;hasDefaultValue&lt;/code&gt;
     * is &lt;code&gt;false&lt;/code&gt;.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     * @exception IllegalArgumentException if &lt;code&gt;attrName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt;.
     */
    protected void addBooleanAttribute(String elementName,
                                       String attrName,
                                       boolean hasDefaultValue,
                                       boolean defaultValue) {
<span class="nc" id="L684">        List values = new ArrayList();</span>
<span class="nc" id="L685">        values.add(&quot;TRUE&quot;);</span>
<span class="nc" id="L686">        values.add(&quot;FALSE&quot;);</span>

<span class="nc" id="L688">        String dval = null;</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">        if (hasDefaultValue) {</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">            dval = defaultValue ? &quot;TRUE&quot; : &quot;FALSE&quot;;</span>
        }
<span class="nc" id="L692">        addAttribute(elementName,</span>
                     attrName,
                     DATATYPE_BOOLEAN,
                     true,
                     dval,
                     values);
<span class="nc" id="L698">    }</span>

    /**
     * Removes an attribute from a previously defined element.  If no
     * attribute with the given name was present in the given element,
     * nothing happens and no exception is thrown.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute being removed.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this format.
     */
    protected void removeAttribute(String elementName, String attrName) {
<span class="nc" id="L712">        Element element = getElement(elementName);</span>
<span class="nc" id="L713">        element.attrList.remove(attrName);</span>
<span class="nc" id="L714">        element.attrMap.remove(attrName);</span>
<span class="nc" id="L715">    }</span>

    /**
     * Allows an &lt;code&gt;Object&lt;/code&gt; reference of a given class type
     * to be stored in nodes implementing the named element.  The
     * value of the &lt;code&gt;Object&lt;/code&gt; is unconstrained other than by
     * its class type.
     *
     * &lt;p&gt; If an &lt;code&gt;Object&lt;/code&gt; reference was previously allowed,
     * the previous settings are overwritten.
     *
     * @param elementName the name of the element.
     * @param classType a &lt;code&gt;Class&lt;/code&gt; variable indicating the
     * legal class type for the object value.
     * @param required &lt;code&gt;true&lt;/code&gt; if an object value must be present.
     * @param defaultValue the default value for the
     * &lt;code&gt;Object&lt;/code&gt; reference, or &lt;code&gt;null&lt;/code&gt;.
     * @param &lt;T&gt; the type of the object.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this format.
     */
    protected &lt;T&gt; void addObjectValue(String elementName,
                                      Class&lt;T&gt; classType,
                                      boolean required,
                                      T defaultValue)
    {
<span class="nc" id="L742">        Element element = getElement(elementName);</span>
<span class="nc" id="L743">        ObjectValue obj = new ObjectValue();</span>
<span class="nc" id="L744">        obj.valueType = VALUE_ARBITRARY;</span>
<span class="nc" id="L745">        obj.classType = classType;</span>
<span class="nc" id="L746">        obj.defaultValue = defaultValue;</span>

<span class="nc" id="L748">        element.objectValue = obj;</span>
<span class="nc" id="L749">    }</span>

    /**
     * Allows an &lt;code&gt;Object&lt;/code&gt; reference of a given class type
     * to be stored in nodes implementing the named element.  The
     * value of the &lt;code&gt;Object&lt;/code&gt; must be one of the values
     * given by &lt;code&gt;enumeratedValues&lt;/code&gt;.
     *
     * &lt;p&gt; If an &lt;code&gt;Object&lt;/code&gt; reference was previously allowed,
     * the previous settings are overwritten.
     *
     * @param elementName the name of the element.
     * @param classType a &lt;code&gt;Class&lt;/code&gt; variable indicating the
     * legal class type for the object value.
     * @param required &lt;code&gt;true&lt;/code&gt; if an object value must be present.
     * @param defaultValue the default value for the
     * &lt;code&gt;Object&lt;/code&gt; reference, or &lt;code&gt;null&lt;/code&gt;.
     * @param enumeratedValues a &lt;code&gt;List&lt;/code&gt; of
     * &lt;code&gt;Object&lt;/code&gt;s containing the legal values for the
     * object reference.
     * @param &lt;T&gt; the type of the object.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this format.
     * @exception IllegalArgumentException if
     * &lt;code&gt;enumeratedValues&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
     * @exception IllegalArgumentException if
     * &lt;code&gt;enumeratedValues&lt;/code&gt; does not contain at least one
     * entry.
     * @exception IllegalArgumentException if
     * &lt;code&gt;enumeratedValues&lt;/code&gt; contains an element that is not
     * an instance of the class type denoted by &lt;code&gt;classType&lt;/code&gt;
     * or is &lt;code&gt;null&lt;/code&gt;.
     */
    protected &lt;T&gt; void addObjectValue(String elementName,
                                      Class&lt;T&gt; classType,
                                      boolean required,
                                      T defaultValue,
                                      List&lt;? extends T&gt; enumeratedValues)
    {
<span class="nc" id="L789">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">        if (enumeratedValues == null) {</span>
<span class="nc" id="L791">            throw new IllegalArgumentException(&quot;enumeratedValues == null!&quot;);</span>
        }
<span class="nc bnc" id="L793" title="All 2 branches missed.">        if (enumeratedValues.size() == 0) {</span>
<span class="nc" id="L794">            throw new IllegalArgumentException(&quot;enumeratedValues is empty!&quot;);</span>
        }
<span class="nc" id="L796">        Iterator iter = enumeratedValues.iterator();</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">        while (iter.hasNext()) {</span>
<span class="nc" id="L798">            Object o = iter.next();</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">            if (o == null) {</span>
<span class="nc" id="L800">                throw new IllegalArgumentException(&quot;enumeratedValues contains a null!&quot;);</span>
            }
<span class="nc bnc" id="L802" title="All 2 branches missed.">            if (!classType.isInstance(o)) {</span>
<span class="nc" id="L803">                throw new IllegalArgumentException(&quot;enumeratedValues contains a value not of class classType!&quot;);</span>
            }
<span class="nc" id="L805">        }</span>

<span class="nc" id="L807">        ObjectValue obj = new ObjectValue();</span>
<span class="nc" id="L808">        obj.valueType = VALUE_ENUMERATION;</span>
<span class="nc" id="L809">        obj.classType = classType;</span>
<span class="nc" id="L810">        obj.defaultValue = defaultValue;</span>
<span class="nc" id="L811">        obj.enumeratedValues = enumeratedValues;</span>

<span class="nc" id="L813">        element.objectValue = obj;</span>
<span class="nc" id="L814">    }</span>

    /**
     * Allows an &lt;code&gt;Object&lt;/code&gt; reference of a given class type
     * to be stored in nodes implementing the named element.  The
     * value of the &lt;code&gt;Object&lt;/code&gt; must be within the range given
     * by &lt;code&gt;minValue&lt;/code&gt; and &lt;code&gt;maxValue&lt;/code&gt;.
     * Furthermore, the class type must implement the
     * &lt;code&gt;Comparable&lt;/code&gt; interface.
     *
     * &lt;p&gt; If an &lt;code&gt;Object&lt;/code&gt; reference was previously allowed,
     * the previous settings are overwritten.
     *
     * @param elementName the name of the element.
     * @param classType a &lt;code&gt;Class&lt;/code&gt; variable indicating the
     * legal class type for the object value.
     * @param defaultValue the default value for the
     * @param minValue the smallest (inclusive or exclusive depending
     * on the value of &lt;code&gt;minInclusive&lt;/code&gt;) legal value for the
     * object value, as a &lt;code&gt;String&lt;/code&gt;.
     * @param maxValue the largest (inclusive or exclusive depending
     * on the value of &lt;code&gt;minInclusive&lt;/code&gt;) legal value for the
     * object value, as a &lt;code&gt;String&lt;/code&gt;.
     * @param minInclusive &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;minValue&lt;/code&gt;
     * is inclusive.
     * @param maxInclusive &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;maxValue&lt;/code&gt;
     * is inclusive.
     * @param &lt;T&gt; the type of the object.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this
     * format.
     */
    protected &lt;T extends Object &amp; Comparable&lt;? super T&gt;&gt; void
        addObjectValue(String elementName,
                       Class&lt;T&gt; classType,
                       T defaultValue,
                       Comparable&lt;? super T&gt; minValue,
                       Comparable&lt;? super T&gt; maxValue,
                       boolean minInclusive,
                       boolean maxInclusive)
    {
<span class="nc" id="L856">        Element element = getElement(elementName);</span>
<span class="nc" id="L857">        ObjectValue obj = new ObjectValue();</span>
<span class="nc" id="L858">        obj.valueType = VALUE_RANGE;</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">        if (minInclusive) {</span>
<span class="nc" id="L860">            obj.valueType |= VALUE_RANGE_MIN_INCLUSIVE_MASK;</span>
        }
<span class="nc bnc" id="L862" title="All 2 branches missed.">        if (maxInclusive) {</span>
<span class="nc" id="L863">            obj.valueType |= VALUE_RANGE_MAX_INCLUSIVE_MASK;</span>
        }
<span class="nc" id="L865">        obj.classType = classType;</span>
<span class="nc" id="L866">        obj.defaultValue = defaultValue;</span>
<span class="nc" id="L867">        obj.minValue = minValue;</span>
<span class="nc" id="L868">        obj.maxValue = maxValue;</span>

<span class="nc" id="L870">        element.objectValue = obj;</span>
<span class="nc" id="L871">    }</span>

    /**
     * Allows an &lt;code&gt;Object&lt;/code&gt; reference of a given class type
     * to be stored in nodes implementing the named element.  The
     * value of the &lt;code&gt;Object&lt;/code&gt; must an array of objects of
     * class type given by &lt;code&gt;classType&lt;/code&gt;, with at least
     * &lt;code&gt;arrayMinLength&lt;/code&gt; and at most
     * &lt;code&gt;arrayMaxLength&lt;/code&gt; elements.
     *
     * &lt;p&gt; If an &lt;code&gt;Object&lt;/code&gt; reference was previously allowed,
     * the previous settings are overwritten.
     *
     * @param elementName the name of the element.
     * @param classType a &lt;code&gt;Class&lt;/code&gt; variable indicating the
     * legal class type for the object value.
     * @param arrayMinLength the smallest legal length for the array.
     * @param arrayMaxLength the largest legal length for the array.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt; is
     * not a legal element name for this format.
     */
    protected void addObjectValue(String elementName,
                                  Class&lt;?&gt; classType,
                                  int arrayMinLength,
                                  int arrayMaxLength) {
<span class="nc" id="L897">        Element element = getElement(elementName);</span>
<span class="nc" id="L898">        ObjectValue obj = new ObjectValue();</span>
<span class="nc" id="L899">        obj.valueType = VALUE_LIST;</span>
<span class="nc" id="L900">        obj.classType = classType;</span>
<span class="nc" id="L901">        obj.arrayMinLength = arrayMinLength;</span>
<span class="nc" id="L902">        obj.arrayMaxLength = arrayMaxLength;</span>

<span class="nc" id="L904">        element.objectValue = obj;</span>
<span class="nc" id="L905">    }</span>

    /**
     * Disallows an &lt;code&gt;Object&lt;/code&gt; reference from being stored in
     * nodes implementing the named element.
     *
     * @param elementName the name of the element.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt; is
     * not a legal element name for this format.
     */
    protected void removeObjectValue(String elementName) {
<span class="nc" id="L917">        Element element = getElement(elementName);</span>
<span class="nc" id="L918">        element.objectValue = null;</span>
<span class="nc" id="L919">    }</span>

    // Utility method

    // Methods from IIOMetadataFormat

    // Root

    public String getRootName() {
<span class="nc" id="L928">        return rootName;</span>
    }

    // Multiplicity

    public abstract boolean canNodeAppear(String elementName,
                                          ImageTypeSpecifier imageType);

    public int getElementMinChildren(String elementName) {
<span class="nc" id="L937">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">        if (element.childPolicy != CHILD_POLICY_REPEAT) {</span>
<span class="nc" id="L939">            throw new IllegalArgumentException(&quot;Child policy not CHILD_POLICY_REPEAT!&quot;);</span>
        }
<span class="nc" id="L941">        return element.minChildren;</span>
    }

    public int getElementMaxChildren(String elementName) {
<span class="nc" id="L945">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L946" title="All 2 branches missed.">        if (element.childPolicy != CHILD_POLICY_REPEAT) {</span>
<span class="nc" id="L947">            throw new IllegalArgumentException(&quot;Child policy not CHILD_POLICY_REPEAT!&quot;);</span>
        }
<span class="nc" id="L949">        return element.maxChildren;</span>
    }

    private String getResource(String key, Locale locale) {
<span class="nc bnc" id="L953" title="All 2 branches missed.">        if (locale == null) {</span>
<span class="nc" id="L954">            locale = Locale.getDefault();</span>
        }

        /**
         * If an applet supplies an implementation of IIOMetadataFormat and
         * resource bundles, then the resource bundle will need to be
         * accessed via the applet class loader. So first try the context
         * class loader to locate the resource bundle.
         * If that throws MissingResourceException, then try the
         * system class loader.
         */
<span class="nc" id="L965">        ClassLoader loader = (ClassLoader)</span>
<span class="nc" id="L966">            java.security.AccessController.doPrivileged(</span>
<span class="nc" id="L967">                new java.security.PrivilegedAction() {</span>
                   public Object run() {
<span class="nc" id="L969">                       return Thread.currentThread().getContextClassLoader();</span>
                   }
            });

<span class="nc" id="L973">        ResourceBundle bundle = null;</span>
        try {
<span class="nc" id="L975">            bundle = ResourceBundle.getBundle(resourceBaseName,</span>
                                              locale, loader);
<span class="nc" id="L977">        } catch (MissingResourceException mre) {</span>
            try {
<span class="nc" id="L979">                bundle = ResourceBundle.getBundle(resourceBaseName, locale);</span>
<span class="nc" id="L980">            } catch (MissingResourceException mre1) {</span>
<span class="nc" id="L981">                return null;</span>
<span class="nc" id="L982">            }</span>
<span class="nc" id="L983">        }</span>

        try {
<span class="nc" id="L986">            return bundle.getString(key);</span>
<span class="nc" id="L987">        } catch (MissingResourceException e) {</span>
<span class="nc" id="L988">            return null;</span>
        }
    }

    /**
     * Returns a &lt;code&gt;String&lt;/code&gt; containing a description of the
     * named element, or &lt;code&gt;null&lt;/code&gt;.  The description will be
     * localized for the supplied &lt;code&gt;Locale&lt;/code&gt; if possible.
     *
     * &lt;p&gt; The default implementation will first locate a
     * &lt;code&gt;ResourceBundle&lt;/code&gt; using the current resource base
     * name set by &lt;code&gt;setResourceBaseName&lt;/code&gt; and the supplied
     * &lt;code&gt;Locale&lt;/code&gt;, using the fallback mechanism described in
     * the comments for &lt;code&gt;ResourceBundle.getBundle&lt;/code&gt;.  If a
     * &lt;code&gt;ResourceBundle&lt;/code&gt; is found, the element name will be
     * used as a key to its &lt;code&gt;getString&lt;/code&gt; method, and the
     * result returned.  If no &lt;code&gt;ResourceBundle&lt;/code&gt; is found,
     * or no such key is present, &lt;code&gt;null&lt;/code&gt; will be returned.
     *
     * &lt;p&gt; If &lt;code&gt;locale&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;, the current
     * default &lt;code&gt;Locale&lt;/code&gt; returned by &lt;code&gt;Locale.getLocale&lt;/code&gt;
     * will be used.
     *
     * @param elementName the name of the element.
     * @param locale the &lt;code&gt;Locale&lt;/code&gt; for which localization
     * will be attempted.
     *
     * @return the element description.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this format.
     *
     * @see #setResourceBaseName
     */
    public String getElementDescription(String elementName,
                                        Locale locale) {
<span class="nc" id="L1024">        Element element = getElement(elementName);</span>
<span class="nc" id="L1025">        return getResource(elementName, locale);</span>
    }

    // Children

    public int getChildPolicy(String elementName) {
<span class="nc" id="L1031">        Element element = getElement(elementName);</span>
<span class="nc" id="L1032">        return element.childPolicy;</span>
    }

    public String[] getChildNames(String elementName) {
<span class="nc" id="L1036">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L1037" title="All 2 branches missed.">        if (element.childPolicy == CHILD_POLICY_EMPTY) {</span>
<span class="nc" id="L1038">            return null;</span>
        }
<span class="nc" id="L1040">        return (String[])element.childList.toArray(new String[0]);</span>
    }

    // Attributes

    public String[] getAttributeNames(String elementName) {
<span class="nc" id="L1046">        Element element = getElement(elementName);</span>
<span class="nc" id="L1047">        List names = element.attrList;</span>

<span class="nc" id="L1049">        String[] result = new String[names.size()];</span>
<span class="nc" id="L1050">        return (String[])names.toArray(result);</span>
    }

    public int getAttributeValueType(String elementName, String attrName) {
<span class="nc" id="L1054">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc" id="L1055">        return attr.valueType;</span>
    }

    public int getAttributeDataType(String elementName, String attrName) {
<span class="nc" id="L1059">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc" id="L1060">        return attr.dataType;</span>
    }

    public boolean isAttributeRequired(String elementName, String attrName) {
<span class="nc" id="L1064">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc" id="L1065">        return attr.required;</span>
    }

    public String getAttributeDefaultValue(String elementName,
                                           String attrName) {
<span class="nc" id="L1070">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc" id="L1071">        return attr.defaultValue;</span>
    }

    public String[] getAttributeEnumerations(String elementName,
                                             String attrName) {
<span class="nc" id="L1076">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">        if (attr.valueType != VALUE_ENUMERATION) {</span>
<span class="nc" id="L1078">            throw new IllegalArgumentException</span>
                (&quot;Attribute not an enumeration!&quot;);
        }

<span class="nc" id="L1082">        List values = attr.enumeratedValues;</span>
<span class="nc" id="L1083">        Iterator iter = values.iterator();</span>
<span class="nc" id="L1084">        String[] result = new String[values.size()];</span>
<span class="nc" id="L1085">        return (String[])values.toArray(result);</span>
    }

    public String getAttributeMinValue(String elementName, String attrName) {
<span class="nc" id="L1089">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc bnc" id="L1090" title="All 8 branches missed.">        if (attr.valueType != VALUE_RANGE &amp;&amp;</span>
            attr.valueType != VALUE_RANGE_MIN_INCLUSIVE &amp;&amp;
            attr.valueType != VALUE_RANGE_MAX_INCLUSIVE &amp;&amp;
            attr.valueType != VALUE_RANGE_MIN_MAX_INCLUSIVE) {
<span class="nc" id="L1094">            throw new IllegalArgumentException(&quot;Attribute not a range!&quot;);</span>
        }

<span class="nc" id="L1097">        return attr.minValue;</span>
    }

    public String getAttributeMaxValue(String elementName, String attrName) {
<span class="nc" id="L1101">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc bnc" id="L1102" title="All 8 branches missed.">        if (attr.valueType != VALUE_RANGE &amp;&amp;</span>
            attr.valueType != VALUE_RANGE_MIN_INCLUSIVE &amp;&amp;
            attr.valueType != VALUE_RANGE_MAX_INCLUSIVE &amp;&amp;
            attr.valueType != VALUE_RANGE_MIN_MAX_INCLUSIVE) {
<span class="nc" id="L1106">            throw new IllegalArgumentException(&quot;Attribute not a range!&quot;);</span>
        }

<span class="nc" id="L1109">        return attr.maxValue;</span>
    }

    public int getAttributeListMinLength(String elementName, String attrName) {
<span class="nc" id="L1113">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc bnc" id="L1114" title="All 2 branches missed.">        if (attr.valueType != VALUE_LIST) {</span>
<span class="nc" id="L1115">            throw new IllegalArgumentException(&quot;Attribute not a list!&quot;);</span>
        }

<span class="nc" id="L1118">        return attr.listMinLength;</span>
    }

    public int getAttributeListMaxLength(String elementName, String attrName) {
<span class="nc" id="L1122">        Attribute attr = getAttribute(elementName, attrName);</span>
<span class="nc bnc" id="L1123" title="All 2 branches missed.">        if (attr.valueType != VALUE_LIST) {</span>
<span class="nc" id="L1124">            throw new IllegalArgumentException(&quot;Attribute not a list!&quot;);</span>
        }

<span class="nc" id="L1127">        return attr.listMaxLength;</span>
    }

    /**
     * Returns a &lt;code&gt;String&lt;/code&gt; containing a description of the
     * named attribute, or &lt;code&gt;null&lt;/code&gt;.  The description will be
     * localized for the supplied &lt;code&gt;Locale&lt;/code&gt; if possible.
     *
     * &lt;p&gt; The default implementation will first locate a
     * &lt;code&gt;ResourceBundle&lt;/code&gt; using the current resource base
     * name set by &lt;code&gt;setResourceBaseName&lt;/code&gt; and the supplied
     * &lt;code&gt;Locale&lt;/code&gt;, using the fallback mechanism described in
     * the comments for &lt;code&gt;ResourceBundle.getBundle&lt;/code&gt;.  If a
     * &lt;code&gt;ResourceBundle&lt;/code&gt; is found, the element name followed
     * by a &quot;/&quot; character followed by the attribute name
     * (&lt;code&gt;elementName + &quot;/&quot; + attrName&lt;/code&gt;) will be used as a
     * key to its &lt;code&gt;getString&lt;/code&gt; method, and the result
     * returned.  If no &lt;code&gt;ResourceBundle&lt;/code&gt; is found, or no
     * such key is present, &lt;code&gt;null&lt;/code&gt; will be returned.
     *
     * &lt;p&gt; If &lt;code&gt;locale&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;, the current
     * default &lt;code&gt;Locale&lt;/code&gt; returned by &lt;code&gt;Locale.getLocale&lt;/code&gt;
     * will be used.
     *
     * @param elementName the name of the element.
     * @param attrName the name of the attribute.
     * @param locale the &lt;code&gt;Locale&lt;/code&gt; for which localization
     * will be attempted, or &lt;code&gt;null&lt;/code&gt;.
     *
     * @return the attribute description.
     *
     * @exception IllegalArgumentException if &lt;code&gt;elementName&lt;/code&gt;
     * is &lt;code&gt;null&lt;/code&gt;, or is not a legal element name for this format.
     * @exception IllegalArgumentException if &lt;code&gt;attrName&lt;/code&gt; is
     * &lt;code&gt;null&lt;/code&gt; or is not a legal attribute name for this
     * element.
     *
     * @see #setResourceBaseName
     */
    public String getAttributeDescription(String elementName,
                                          String attrName,
                                          Locale locale) {
<span class="nc" id="L1169">        Element element = getElement(elementName);</span>
<span class="nc bnc" id="L1170" title="All 2 branches missed.">        if (attrName == null) {</span>
<span class="nc" id="L1171">            throw new IllegalArgumentException(&quot;attrName == null!&quot;);</span>
        }
<span class="nc" id="L1173">        Attribute attr = (Attribute)element.attrMap.get(attrName);</span>
<span class="nc bnc" id="L1174" title="All 2 branches missed.">        if (attr == null) {</span>
<span class="nc" id="L1175">            throw new IllegalArgumentException(&quot;No such attribute!&quot;);</span>
        }

<span class="nc" id="L1178">        String key = elementName + &quot;/&quot; + attrName;</span>
<span class="nc" id="L1179">        return getResource(key, locale);</span>
    }

    private ObjectValue getObjectValue(String elementName) {
<span class="nc" id="L1183">        Element element = getElement(elementName);</span>
<span class="nc" id="L1184">        ObjectValue objv = (ObjectValue)element.objectValue;</span>
<span class="nc bnc" id="L1185" title="All 2 branches missed.">        if (objv == null) {</span>
<span class="nc" id="L1186">            throw new IllegalArgumentException(&quot;No object within element &quot; +</span>
                                               elementName + &quot;!&quot;);
        }
<span class="nc" id="L1189">        return objv;</span>
    }

    public int getObjectValueType(String elementName) {
<span class="nc" id="L1193">        Element element = getElement(elementName);</span>
<span class="nc" id="L1194">        ObjectValue objv = (ObjectValue)element.objectValue;</span>
<span class="nc bnc" id="L1195" title="All 2 branches missed.">        if (objv == null) {</span>
<span class="nc" id="L1196">            return VALUE_NONE;</span>
        }
<span class="nc" id="L1198">        return objv.valueType;</span>
    }

    public Class&lt;?&gt; getObjectClass(String elementName) {
<span class="nc" id="L1202">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc" id="L1203">        return objv.classType;</span>
    }

    public Object getObjectDefaultValue(String elementName) {
<span class="nc" id="L1207">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc" id="L1208">        return objv.defaultValue;</span>
    }

    public Object[] getObjectEnumerations(String elementName) {
<span class="nc" id="L1212">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc bnc" id="L1213" title="All 2 branches missed.">        if (objv.valueType != VALUE_ENUMERATION) {</span>
<span class="nc" id="L1214">            throw new IllegalArgumentException(&quot;Not an enumeration!&quot;);</span>
        }
<span class="nc" id="L1216">        List vlist = objv.enumeratedValues;</span>
<span class="nc" id="L1217">        Object[] values = new Object[vlist.size()];</span>
<span class="nc" id="L1218">        return vlist.toArray(values);</span>
    }

    public Comparable&lt;?&gt; getObjectMinValue(String elementName) {
<span class="nc" id="L1222">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc bnc" id="L1223" title="All 2 branches missed.">        if ((objv.valueType &amp; VALUE_RANGE) != VALUE_RANGE) {</span>
<span class="nc" id="L1224">            throw new IllegalArgumentException(&quot;Not a range!&quot;);</span>
        }
<span class="nc" id="L1226">        return objv.minValue;</span>
    }

    public Comparable&lt;?&gt; getObjectMaxValue(String elementName) {
<span class="nc" id="L1230">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc bnc" id="L1231" title="All 2 branches missed.">        if ((objv.valueType &amp; VALUE_RANGE) != VALUE_RANGE) {</span>
<span class="nc" id="L1232">            throw new IllegalArgumentException(&quot;Not a range!&quot;);</span>
        }
<span class="nc" id="L1234">        return objv.maxValue;</span>
    }

    public int getObjectArrayMinLength(String elementName) {
<span class="nc" id="L1238">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc bnc" id="L1239" title="All 2 branches missed.">        if (objv.valueType != VALUE_LIST) {</span>
<span class="nc" id="L1240">            throw new IllegalArgumentException(&quot;Not a list!&quot;);</span>
        }
<span class="nc" id="L1242">        return objv.arrayMinLength;</span>
    }

    public int getObjectArrayMaxLength(String elementName) {
<span class="nc" id="L1246">        ObjectValue objv = getObjectValue(elementName);</span>
<span class="nc bnc" id="L1247" title="All 2 branches missed.">        if (objv.valueType != VALUE_LIST) {</span>
<span class="nc" id="L1248">            throw new IllegalArgumentException(&quot;Not a list!&quot;);</span>
        }
<span class="nc" id="L1250">        return objv.arrayMaxLength;</span>
    }

    // Standard format descriptor

    private synchronized static void createStandardFormat() {
<span class="nc bnc" id="L1256" title="All 2 branches missed.">        if (standardFormat == null) {</span>
<span class="nc" id="L1257">            standardFormat = new StandardMetadataFormat();</span>
        }
<span class="nc" id="L1259">    }</span>

    /**
     * Returns an &lt;code&gt;IIOMetadataFormat&lt;/code&gt; object describing the
     * standard, plug-in neutral &lt;code&gt;javax.imageio_1.0&lt;/code&gt;
     * metadata document format described in the comment of the
     * &lt;code&gt;javax.imageio.metadata&lt;/code&gt; package.
     *
     * @return a predefined &lt;code&gt;IIOMetadataFormat&lt;/code&gt; instance.
     */
    public static IIOMetadataFormat getStandardFormatInstance() {
<span class="nc" id="L1270">        createStandardFormat();</span>
<span class="nc" id="L1271">        return standardFormat;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>