<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>JdpJmxPacket.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">sun.management.jdp</a> &gt; <span class="el_source">JdpJmxPacket.java</span></div><h1>JdpJmxPacket.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package sun.management.jdp;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.Objects;
import java.util.UUID;

/**
 * A packet to broadcasts JMX URL
 *
 * Fields:
 *
 * &lt;ul&gt;
 * &lt;li&gt;UUID - broadcast session ID, changed every time when we start/stop
 * discovery service&lt;/li&gt;
 * &lt;li&gt;JMX_URL - URL to connect to JMX service&lt;/li&gt;
 * &lt;li&gt;MAIN_CLASS - optional name of main class, filled from sun.java.command stripped for
 * security reason to first space&lt;/li&gt;
 * &lt;li&gt;INSTANCE_NAME - optional custom name of particular instance as provided by customer&lt;/li&gt;
 * &lt;/ul&gt;
 */
public final class JdpJmxPacket
       extends JdpGenericPacket
       implements JdpPacket {

    /**
     * Session ID
     */
    public final static String UUID_KEY = &quot;DISCOVERABLE_SESSION_UUID&quot;;
    /**
     * Name of main class
     */
    public final static String MAIN_CLASS_KEY = &quot;MAIN_CLASS&quot;;
    /**
     * JMX service URL
     */
    public final static String JMX_SERVICE_URL_KEY = &quot;JMX_SERVICE_URL&quot;;
    /**
     * Name of Java instance
     */
    public final static String INSTANCE_NAME_KEY = &quot;INSTANCE_NAME&quot;;
    /**
     * PID of java process, optional presented if it could be obtained
     */
    public final static String PROCESS_ID_KEY = &quot;PROCESS_ID&quot;;
    /**
     * Hostname of rmi server, optional presented if user overrides rmi server
     * hostname by java.rmi.server.hostname property
     */
    public final static String RMI_HOSTNAME_KEY = &quot;RMI_HOSTNAME&quot;;
    /**
     * Configured broadcast interval, optional
     */
    public final static String BROADCAST_INTERVAL_KEY = &quot;BROADCAST_INTERVAL&quot;;

    private UUID id;
    private String mainClass;
    private String jmxServiceUrl;
    private String instanceName;
    private String processId;
    private String rmiHostname;
    private String broadcastInterval;

    /**
     * Create new instance from user provided data. Set mandatory fields
     *
     * @param id - java instance id
     * @param jmxServiceUrl - JMX service url
     */
<span class="nc" id="L95">    public JdpJmxPacket(UUID id, String jmxServiceUrl) {</span>
<span class="nc" id="L96">        this.id = id;</span>
<span class="nc" id="L97">        this.jmxServiceUrl = jmxServiceUrl;</span>
<span class="nc" id="L98">    }</span>

    /**
     * Create new instance from network data Parse packet and set fields.
     *
     * @param data - raw packet data as it came from a Net
     * @throws JdpException
     */
    public JdpJmxPacket(byte[] data)
<span class="nc" id="L107">            throws JdpException {</span>
        JdpPacketReader reader;

<span class="nc" id="L110">        reader = new JdpPacketReader(data);</span>
<span class="nc" id="L111">        Map&lt;String, String&gt; p = reader.getDiscoveryDataAsMap();</span>

<span class="nc" id="L113">        String sId = p.get(UUID_KEY);</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        this.id = (sId == null) ? null : UUID.fromString(sId);</span>
<span class="nc" id="L115">        this.jmxServiceUrl = p.get(JMX_SERVICE_URL_KEY);</span>
<span class="nc" id="L116">        this.mainClass = p.get(MAIN_CLASS_KEY);</span>
<span class="nc" id="L117">        this.instanceName = p.get(INSTANCE_NAME_KEY);</span>
<span class="nc" id="L118">        this.processId = p.get(PROCESS_ID_KEY);</span>
<span class="nc" id="L119">        this.rmiHostname = p.get(RMI_HOSTNAME_KEY);</span>
<span class="nc" id="L120">        this.broadcastInterval = p.get(BROADCAST_INTERVAL_KEY);</span>
<span class="nc" id="L121">    }</span>

    /**
     * Set main class field
     *
     * @param mainClass - main class of running app
     */
    public void setMainClass(String mainClass) {
<span class="nc" id="L129">        this.mainClass = mainClass;</span>
<span class="nc" id="L130">    }</span>

    /**
     * Set instance name field
     *
     * @param instanceName - name of instance as provided by customer
     */
    public void setInstanceName(String instanceName) {
<span class="nc" id="L138">        this.instanceName = instanceName;</span>
<span class="nc" id="L139">    }</span>

    /**
     * @return id of discovery session
     */
    public UUID getId() {
<span class="nc" id="L145">        return id;</span>
    }

    /**
     *
     * @return main class field
     */
    public String getMainClass() {
<span class="nc" id="L153">        return mainClass;</span>
    }

    /**
     *
     * @return JMX service URL
     */
    public String getJmxServiceUrl() {
<span class="nc" id="L161">        return jmxServiceUrl;</span>
    }

    /**
     *
     * @return instance name
     */
    public String getInstanceName() {
<span class="nc" id="L169">        return instanceName;</span>
    }

    public String getProcessId() {
<span class="nc" id="L173">        return processId;</span>
    }

    public void setProcessId(String processId) {
<span class="nc" id="L177">        this.processId = processId;</span>
<span class="nc" id="L178">    }</span>

    public String getRmiHostname() {
<span class="nc" id="L181">        return rmiHostname;</span>
    }

    public void setRmiHostname(String rmiHostname) {
<span class="nc" id="L185">        this.rmiHostname = rmiHostname;</span>
<span class="nc" id="L186">    }</span>

    public String getBroadcastInterval() {
<span class="nc" id="L189">        return broadcastInterval;</span>
    }

    public void setBroadcastInterval(String broadcastInterval) {
<span class="nc" id="L193">        this.broadcastInterval = broadcastInterval;</span>
<span class="nc" id="L194">    }</span>

    /**
     *
     * @return assembled packet ready to be sent across a Net
     * @throws IOException
     */
    @Override
    public byte[] getPacketData() throws IOException {
        // Assemble packet from fields to byte array
        JdpPacketWriter writer;
<span class="nc" id="L205">        writer = new JdpPacketWriter();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">        writer.addEntry(UUID_KEY, (id == null) ? null : id.toString());</span>
<span class="nc" id="L207">        writer.addEntry(MAIN_CLASS_KEY, mainClass);</span>
<span class="nc" id="L208">        writer.addEntry(JMX_SERVICE_URL_KEY, jmxServiceUrl);</span>
<span class="nc" id="L209">        writer.addEntry(INSTANCE_NAME_KEY, instanceName);</span>
<span class="nc" id="L210">        writer.addEntry(PROCESS_ID_KEY, processId);</span>
<span class="nc" id="L211">        writer.addEntry(RMI_HOSTNAME_KEY, rmiHostname);</span>
<span class="nc" id="L212">        writer.addEntry(BROADCAST_INTERVAL_KEY, broadcastInterval);</span>

<span class="nc" id="L214">        return writer.getPacketBytes();</span>
    }

    /**
     *
     * @return packet hash code
     */
    @Override
    public int hashCode() {
<span class="nc" id="L223">        int hash = 1;</span>
<span class="nc" id="L224">        hash = hash * 31 + id.hashCode();</span>
<span class="nc" id="L225">        hash = hash * 31 + jmxServiceUrl.hashCode();</span>
<span class="nc" id="L226">        return hash;</span>
    }

    /**
     * Compare two packets
     *
     * @param o - packet to compare
     * @return either packet equals or not
     */
    @Override
    public boolean equals(Object o) {

<span class="nc bnc" id="L238" title="All 4 branches missed.">        if (o == null || ! (o instanceof JdpJmxPacket) ){</span>
<span class="nc" id="L239">            return false;</span>
        }

<span class="nc" id="L242">        JdpJmxPacket p = (JdpJmxPacket) o;</span>
<span class="nc bnc" id="L243" title="All 4 branches missed.">        return  Objects.equals(id, p.getId()) &amp;&amp; Objects.equals(jmxServiceUrl, p.getJmxServiceUrl());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>