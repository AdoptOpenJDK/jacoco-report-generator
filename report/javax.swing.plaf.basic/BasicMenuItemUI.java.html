<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BasicMenuItemUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicMenuItemUI.java</span></div><h1>BasicMenuItemUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import java.awt.*;
import java.awt.event.*;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;

import javax.swing.*;
import javax.swing.event.*;
import javax.swing.plaf.*;
import javax.swing.text.View;

import sun.swing.*;

/**
 * BasicMenuItem implementation
 *
 * @author Georges Saab
 * @author David Karlton
 * @author Arnaud Weber
 * @author Fredrik Lagerblad
 */
<span class="nc" id="L48">public class BasicMenuItemUI extends MenuItemUI</span>
{
<span class="nc" id="L50">    protected JMenuItem menuItem = null;</span>
    protected Color selectionBackground;
    protected Color selectionForeground;
    protected Color disabledForeground;
    protected Color acceleratorForeground;
    protected Color acceleratorSelectionForeground;

    /**
     * Accelerator delimiter string, such as {@code '+'} in {@code 'Ctrl+C'}.
     * @since 1.7
     */
    protected String acceleratorDelimiter;

    protected int defaultTextIconGap;
    protected Font acceleratorFont;

    protected MouseInputListener mouseInputListener;
    protected MenuDragMouseListener menuDragMouseListener;
    protected MenuKeyListener menuKeyListener;
    /**
     * &lt;code&gt;PropertyChangeListener&lt;/code&gt; returned from
     * &lt;code&gt;createPropertyChangeListener&lt;/code&gt;. You should not
     * need to access this field, rather if you want to customize the
     * &lt;code&gt;PropertyChangeListener&lt;/code&gt; override
     * &lt;code&gt;createPropertyChangeListener&lt;/code&gt;.
     *
     * @since 1.6
     * @see #createPropertyChangeListener
     */
    protected PropertyChangeListener propertyChangeListener;
    // BasicMenuUI also uses this.
    Handler handler;

<span class="nc" id="L83">    protected Icon arrowIcon = null;</span>
<span class="nc" id="L84">    protected Icon checkIcon = null;</span>

    protected boolean oldBorderPainted;

    /* diagnostic aids -- should be false for production builds. */
    private static final boolean TRACE =   false; // trace creates and disposes

    private static final boolean VERBOSE = false; // show reuse hits/misses
    private static final boolean DEBUG =   false;  // show bad params, misc.

    static void loadActionMap(LazyActionMap map) {
        // NOTE: BasicMenuUI also calls into this method.
<span class="nc" id="L96">        map.put(new Actions(Actions.CLICK));</span>
<span class="nc" id="L97">        BasicLookAndFeel.installAudioActionMap(map);</span>
<span class="nc" id="L98">    }</span>

    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L101">        return new BasicMenuItemUI();</span>
    }

    public void installUI(JComponent c) {
<span class="nc" id="L105">        menuItem = (JMenuItem) c;</span>

<span class="nc" id="L107">        installDefaults();</span>
<span class="nc" id="L108">        installComponents(menuItem);</span>
<span class="nc" id="L109">        installListeners();</span>
<span class="nc" id="L110">        installKeyboardActions();</span>
<span class="nc" id="L111">    }</span>


    protected void installDefaults() {
<span class="nc" id="L115">        String prefix = getPropertyPrefix();</span>

<span class="nc" id="L117">        acceleratorFont = UIManager.getFont(&quot;MenuItem.acceleratorFont&quot;);</span>
        // use default if missing so that BasicMenuItemUI can be used in other
        // LAFs like Nimbus
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (acceleratorFont == null) {</span>
<span class="nc" id="L121">            acceleratorFont = UIManager.getFont(&quot;MenuItem.font&quot;);</span>
        }

<span class="nc" id="L124">        Object opaque = UIManager.get(getPropertyPrefix() + &quot;.opaque&quot;);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (opaque != null) {</span>
<span class="nc" id="L126">            LookAndFeel.installProperty(menuItem, &quot;opaque&quot;, opaque);</span>
        }
        else {
<span class="nc" id="L129">            LookAndFeel.installProperty(menuItem, &quot;opaque&quot;, Boolean.TRUE);</span>
        }
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if(menuItem.getMargin() == null ||</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">           (menuItem.getMargin() instanceof UIResource)) {</span>
<span class="nc" id="L133">            menuItem.setMargin(UIManager.getInsets(prefix + &quot;.margin&quot;));</span>
        }

<span class="nc" id="L136">        LookAndFeel.installProperty(menuItem, &quot;iconTextGap&quot;, Integer.valueOf(4));</span>
<span class="nc" id="L137">        defaultTextIconGap = menuItem.getIconTextGap();</span>

<span class="nc" id="L139">        LookAndFeel.installBorder(menuItem, prefix + &quot;.border&quot;);</span>
<span class="nc" id="L140">        oldBorderPainted = menuItem.isBorderPainted();</span>
<span class="nc" id="L141">        LookAndFeel.installProperty(menuItem, &quot;borderPainted&quot;,</span>
<span class="nc" id="L142">                                    UIManager.getBoolean(prefix + &quot;.borderPainted&quot;));</span>
<span class="nc" id="L143">        LookAndFeel.installColorsAndFont(menuItem,</span>
                                         prefix + &quot;.background&quot;,
                                         prefix + &quot;.foreground&quot;,
                                         prefix + &quot;.font&quot;);

        // MenuItem specific defaults
<span class="nc bnc" id="L149" title="All 4 branches missed.">        if (selectionBackground == null ||</span>
            selectionBackground instanceof UIResource) {
<span class="nc" id="L151">            selectionBackground =</span>
<span class="nc" id="L152">                UIManager.getColor(prefix + &quot;.selectionBackground&quot;);</span>
        }
<span class="nc bnc" id="L154" title="All 4 branches missed.">        if (selectionForeground == null ||</span>
            selectionForeground instanceof UIResource) {
<span class="nc" id="L156">            selectionForeground =</span>
<span class="nc" id="L157">                UIManager.getColor(prefix + &quot;.selectionForeground&quot;);</span>
        }
<span class="nc bnc" id="L159" title="All 4 branches missed.">        if (disabledForeground == null ||</span>
            disabledForeground instanceof UIResource) {
<span class="nc" id="L161">            disabledForeground =</span>
<span class="nc" id="L162">                UIManager.getColor(prefix + &quot;.disabledForeground&quot;);</span>
        }
<span class="nc bnc" id="L164" title="All 4 branches missed.">        if (acceleratorForeground == null ||</span>
            acceleratorForeground instanceof UIResource) {
<span class="nc" id="L166">            acceleratorForeground =</span>
<span class="nc" id="L167">                UIManager.getColor(prefix + &quot;.acceleratorForeground&quot;);</span>
        }
<span class="nc bnc" id="L169" title="All 4 branches missed.">        if (acceleratorSelectionForeground == null ||</span>
            acceleratorSelectionForeground instanceof UIResource) {
<span class="nc" id="L171">            acceleratorSelectionForeground =</span>
<span class="nc" id="L172">                UIManager.getColor(prefix + &quot;.acceleratorSelectionForeground&quot;);</span>
        }
        // Get accelerator delimiter
<span class="nc" id="L175">        acceleratorDelimiter =</span>
<span class="nc" id="L176">            UIManager.getString(&quot;MenuItem.acceleratorDelimiter&quot;);</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (acceleratorDelimiter == null) { acceleratorDelimiter = &quot;+&quot;; }</span>
        // Icons
<span class="nc bnc" id="L179" title="All 4 branches missed.">        if (arrowIcon == null ||</span>
            arrowIcon instanceof UIResource) {
<span class="nc" id="L181">            arrowIcon = UIManager.getIcon(prefix + &quot;.arrowIcon&quot;);</span>
        }
<span class="nc bnc" id="L183" title="All 4 branches missed.">        if (checkIcon == null ||</span>
            checkIcon instanceof UIResource) {
<span class="nc" id="L185">            checkIcon = UIManager.getIcon(prefix + &quot;.checkIcon&quot;);</span>
            //In case of column layout, .checkIconFactory is defined for this UI,
            //the icon is compatible with it and useCheckAndArrow() is true,
            //then the icon is handled by the checkIcon.
<span class="nc" id="L189">            boolean isColumnLayout = MenuItemLayoutHelper.isColumnLayout(</span>
<span class="nc" id="L190">                    BasicGraphicsUtils.isLeftToRight(menuItem), menuItem);</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">            if (isColumnLayout) {</span>
<span class="nc" id="L192">                MenuItemCheckIconFactory iconFactory =</span>
<span class="nc" id="L193">                    (MenuItemCheckIconFactory) UIManager.get(prefix</span>
                        + &quot;.checkIconFactory&quot;);
<span class="nc bnc" id="L195" title="All 2 branches missed.">                if (iconFactory != null</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                        &amp;&amp; MenuItemLayoutHelper.useCheckAndArrow(menuItem)</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">                        &amp;&amp; iconFactory.isCompatible(checkIcon, prefix)) {</span>
<span class="nc" id="L198">                    checkIcon = iconFactory.getIcon(menuItem);</span>
                }
            }
        }
<span class="nc" id="L202">    }</span>

    /**
     * @since 1.3
     */
    protected void installComponents(JMenuItem menuItem){
<span class="nc" id="L208">        BasicHTML.updateRenderer(menuItem, menuItem.getText());</span>
<span class="nc" id="L209">    }</span>

    protected String getPropertyPrefix() {
<span class="nc" id="L212">        return &quot;MenuItem&quot;;</span>
    }

    protected void installListeners() {
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if ((mouseInputListener = createMouseInputListener(menuItem)) != null) {</span>
<span class="nc" id="L217">            menuItem.addMouseListener(mouseInputListener);</span>
<span class="nc" id="L218">            menuItem.addMouseMotionListener(mouseInputListener);</span>
        }
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if ((menuDragMouseListener = createMenuDragMouseListener(menuItem)) != null) {</span>
<span class="nc" id="L221">            menuItem.addMenuDragMouseListener(menuDragMouseListener);</span>
        }
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if ((menuKeyListener = createMenuKeyListener(menuItem)) != null) {</span>
<span class="nc" id="L224">            menuItem.addMenuKeyListener(menuKeyListener);</span>
        }
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if ((propertyChangeListener = createPropertyChangeListener(menuItem)) != null) {</span>
<span class="nc" id="L227">            menuItem.addPropertyChangeListener(propertyChangeListener);</span>
        }
<span class="nc" id="L229">    }</span>

    protected void installKeyboardActions() {
<span class="nc" id="L232">        installLazyActionMap();</span>
<span class="nc" id="L233">        updateAcceleratorBinding();</span>
<span class="nc" id="L234">    }</span>

    void installLazyActionMap() {
<span class="nc" id="L237">        LazyActionMap.installLazyActionMap(menuItem, BasicMenuItemUI.class,</span>
<span class="nc" id="L238">                                           getPropertyPrefix() + &quot;.actionMap&quot;);</span>
<span class="nc" id="L239">    }</span>

    public void uninstallUI(JComponent c) {
<span class="nc" id="L242">        menuItem = (JMenuItem)c;</span>
<span class="nc" id="L243">        uninstallDefaults();</span>
<span class="nc" id="L244">        uninstallComponents(menuItem);</span>
<span class="nc" id="L245">        uninstallListeners();</span>
<span class="nc" id="L246">        uninstallKeyboardActions();</span>
<span class="nc" id="L247">        MenuItemLayoutHelper.clearUsedParentClientProperties(menuItem);</span>
<span class="nc" id="L248">        menuItem = null;</span>
<span class="nc" id="L249">    }</span>


    protected void uninstallDefaults() {
<span class="nc" id="L253">        LookAndFeel.uninstallBorder(menuItem);</span>
<span class="nc" id="L254">        LookAndFeel.installProperty(menuItem, &quot;borderPainted&quot;, oldBorderPainted);</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (menuItem.getMargin() instanceof UIResource)</span>
<span class="nc" id="L256">            menuItem.setMargin(null);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">        if (arrowIcon instanceof UIResource)</span>
<span class="nc" id="L258">            arrowIcon = null;</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (checkIcon instanceof UIResource)</span>
<span class="nc" id="L260">            checkIcon = null;</span>
<span class="nc" id="L261">    }</span>

    /**
     * @since 1.3
     */
    protected void uninstallComponents(JMenuItem menuItem){
<span class="nc" id="L267">        BasicHTML.updateRenderer(menuItem, &quot;&quot;);</span>
<span class="nc" id="L268">    }</span>

    protected void uninstallListeners() {
<span class="nc bnc" id="L271" title="All 2 branches missed.">        if (mouseInputListener != null) {</span>
<span class="nc" id="L272">            menuItem.removeMouseListener(mouseInputListener);</span>
<span class="nc" id="L273">            menuItem.removeMouseMotionListener(mouseInputListener);</span>
        }
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (menuDragMouseListener != null) {</span>
<span class="nc" id="L276">            menuItem.removeMenuDragMouseListener(menuDragMouseListener);</span>
        }
<span class="nc bnc" id="L278" title="All 2 branches missed.">        if (menuKeyListener != null) {</span>
<span class="nc" id="L279">            menuItem.removeMenuKeyListener(menuKeyListener);</span>
        }
<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (propertyChangeListener != null) {</span>
<span class="nc" id="L282">            menuItem.removePropertyChangeListener(propertyChangeListener);</span>
        }

<span class="nc" id="L285">        mouseInputListener = null;</span>
<span class="nc" id="L286">        menuDragMouseListener = null;</span>
<span class="nc" id="L287">        menuKeyListener = null;</span>
<span class="nc" id="L288">        propertyChangeListener = null;</span>
<span class="nc" id="L289">        handler = null;</span>
<span class="nc" id="L290">    }</span>

    protected void uninstallKeyboardActions() {
<span class="nc" id="L293">        SwingUtilities.replaceUIActionMap(menuItem, null);</span>
<span class="nc" id="L294">        SwingUtilities.replaceUIInputMap(menuItem, JComponent.</span>
                                         WHEN_IN_FOCUSED_WINDOW, null);
<span class="nc" id="L296">    }</span>

    protected MouseInputListener createMouseInputListener(JComponent c) {
<span class="nc" id="L299">        return getHandler();</span>
    }

    protected MenuDragMouseListener createMenuDragMouseListener(JComponent c) {
<span class="nc" id="L303">        return getHandler();</span>
    }

    protected MenuKeyListener createMenuKeyListener(JComponent c) {
<span class="nc" id="L307">        return null;</span>
    }

    /**
     * Creates a &lt;code&gt;PropertyChangeListener&lt;/code&gt; which will be added to
     * the menu item.
     * If this method returns null then it will not be added to the menu item.
     *
     * @return an instance of a &lt;code&gt;PropertyChangeListener&lt;/code&gt; or null
     * @since 1.6
     */
    protected PropertyChangeListener
                                  createPropertyChangeListener(JComponent c) {
<span class="nc" id="L320">        return getHandler();</span>
    }

    Handler getHandler() {
<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L325">            handler = new Handler();</span>
        }
<span class="nc" id="L327">        return handler;</span>
    }

    InputMap createInputMap(int condition) {
<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (condition == JComponent.WHEN_IN_FOCUSED_WINDOW) {</span>
<span class="nc" id="L332">            return new ComponentInputMapUIResource(menuItem);</span>
        }
<span class="nc" id="L334">        return null;</span>
    }

    void updateAcceleratorBinding() {
<span class="nc" id="L338">        KeyStroke accelerator = menuItem.getAccelerator();</span>
<span class="nc" id="L339">        InputMap windowInputMap = SwingUtilities.getUIInputMap(</span>
                       menuItem, JComponent.WHEN_IN_FOCUSED_WINDOW);

<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (windowInputMap != null) {</span>
<span class="nc" id="L343">            windowInputMap.clear();</span>
        }
<span class="nc bnc" id="L345" title="All 2 branches missed.">        if (accelerator != null) {</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">            if (windowInputMap == null) {</span>
<span class="nc" id="L347">                windowInputMap = createInputMap(JComponent.</span>
                                                WHEN_IN_FOCUSED_WINDOW);
<span class="nc" id="L349">                SwingUtilities.replaceUIInputMap(menuItem,</span>
                           JComponent.WHEN_IN_FOCUSED_WINDOW, windowInputMap);
            }
<span class="nc" id="L352">            windowInputMap.put(accelerator, &quot;doClick&quot;);</span>
        }
<span class="nc" id="L354">    }</span>

    public Dimension getMinimumSize(JComponent c) {
<span class="nc" id="L357">        Dimension d = null;</span>
<span class="nc" id="L358">        View v = (View) c.getClientProperty(BasicHTML.propertyKey);</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (v != null) {</span>
<span class="nc" id="L360">            d = getPreferredSize(c);</span>
<span class="nc" id="L361">            d.width -= v.getPreferredSpan(View.X_AXIS) - v.getMinimumSpan(View.X_AXIS);</span>
        }
<span class="nc" id="L363">        return d;</span>
    }

    public Dimension getPreferredSize(JComponent c) {
<span class="nc" id="L367">        return getPreferredMenuItemSize(c,</span>
                                        checkIcon,
                                        arrowIcon,
                                        defaultTextIconGap);
    }

    public Dimension getMaximumSize(JComponent c) {
<span class="nc" id="L374">        Dimension d = null;</span>
<span class="nc" id="L375">        View v = (View) c.getClientProperty(BasicHTML.propertyKey);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">        if (v != null) {</span>
<span class="nc" id="L377">            d = getPreferredSize(c);</span>
<span class="nc" id="L378">            d.width += v.getMaximumSpan(View.X_AXIS) - v.getPreferredSpan(View.X_AXIS);</span>
        }
<span class="nc" id="L380">        return d;</span>
    }

    protected Dimension getPreferredMenuItemSize(JComponent c,
                                                 Icon checkIcon,
                                                 Icon arrowIcon,
                                                 int defaultTextIconGap) {

        // The method also determines the preferred width of the
        // parent popup menu (through DefaultMenuLayout class).
        // The menu width equals to the maximal width
        // among child menu items.

        // Menu item width will be a sum of the widest check icon, label,
        // arrow icon and accelerator text among neighbor menu items.
        // For the latest menu item we will know the maximal widths exactly.
        // It will be the widest menu item and it will determine
        // the width of the parent popup menu.

        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        // There is a conceptual problem: if user sets preferred size manually
        // for a menu item, this method won't be called for it
        // (see JComponent.getPreferredSize()),
        // maximal widths won't be calculated, other menu items won't be able
        // to take them into account and will be layouted in such a way,
        // as there is no the item with manual preferred size.
        // But after the first paint() method call, all maximal widths
        // will be correctly calculated and layout of some menu items
        // can be changed. For example, it can cause a shift of
        // the icon and text when user points a menu item by mouse.

<span class="nc" id="L411">        JMenuItem mi = (JMenuItem) c;</span>
<span class="nc" id="L412">        MenuItemLayoutHelper lh = new MenuItemLayoutHelper(mi, checkIcon,</span>
<span class="nc" id="L413">                arrowIcon, MenuItemLayoutHelper.createMaxRect(), defaultTextIconGap,</span>
<span class="nc" id="L414">                acceleratorDelimiter, BasicGraphicsUtils.isLeftToRight(mi),</span>
<span class="nc" id="L415">                mi.getFont(), acceleratorFont,</span>
<span class="nc" id="L416">                MenuItemLayoutHelper.useCheckAndArrow(menuItem),</span>
<span class="nc" id="L417">                getPropertyPrefix());</span>

<span class="nc" id="L419">        Dimension result = new Dimension();</span>

        // Calculate the result width
<span class="nc" id="L422">        result.width = lh.getLeadingGap();</span>
<span class="nc" id="L423">        MenuItemLayoutHelper.addMaxWidth(lh.getCheckSize(),</span>
<span class="nc" id="L424">                lh.getAfterCheckIconGap(), result);</span>
        // Take into account mimimal text offset.
<span class="nc bnc" id="L426" title="All 2 branches missed.">        if ((!lh.isTopLevelMenu())</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">                &amp;&amp; (lh.getMinTextOffset() &gt; 0)</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">                &amp;&amp; (result.width &lt; lh.getMinTextOffset())) {</span>
<span class="nc" id="L429">            result.width = lh.getMinTextOffset();</span>
        }
<span class="nc" id="L431">        MenuItemLayoutHelper.addMaxWidth(lh.getLabelSize(), lh.getGap(), result);</span>
<span class="nc" id="L432">        MenuItemLayoutHelper.addMaxWidth(lh.getAccSize(), lh.getGap(), result);</span>
<span class="nc" id="L433">        MenuItemLayoutHelper.addMaxWidth(lh.getArrowSize(), lh.getGap(), result);</span>

        // Calculate the result height
<span class="nc" id="L436">        result.height = MenuItemLayoutHelper.max(lh.getCheckSize().getHeight(),</span>
<span class="nc" id="L437">                lh.getLabelSize().getHeight(), lh.getAccSize().getHeight(),</span>
<span class="nc" id="L438">                lh.getArrowSize().getHeight());</span>

        // Take into account menu item insets
<span class="nc" id="L441">        Insets insets = lh.getMenuItem().getInsets();</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if(insets != null) {</span>
<span class="nc" id="L443">            result.width += insets.left + insets.right;</span>
<span class="nc" id="L444">            result.height += insets.top + insets.bottom;</span>
        }

        // if the width is even, bump it up one. This is critical
        // for the focus dash line to draw properly
<span class="nc bnc" id="L449" title="All 2 branches missed.">        if(result.width%2 == 0) {</span>
<span class="nc" id="L450">            result.width++;</span>
        }

        // if the height is even, bump it up one. This is critical
        // for the text to center properly
<span class="nc bnc" id="L455" title="All 2 branches missed.">        if(result.height%2 == 0</span>
                &amp;&amp; Boolean.TRUE !=
<span class="nc bnc" id="L457" title="All 2 branches missed.">                    UIManager.get(getPropertyPrefix() + &quot;.evenHeight&quot;)) {</span>
<span class="nc" id="L458">            result.height++;</span>
        }

<span class="nc" id="L461">        return result;</span>
    }

    /**
     * We draw the background in paintMenuItem()
     * so override update (which fills the background of opaque
     * components by default) to just call paint().
     *
     */
    public void update(Graphics g, JComponent c) {
<span class="nc" id="L471">        paint(g, c);</span>
<span class="nc" id="L472">    }</span>

    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L475">        paintMenuItem(g, c, checkIcon, arrowIcon,</span>
                      selectionBackground, selectionForeground,
                      defaultTextIconGap);
<span class="nc" id="L478">    }</span>

    protected void paintMenuItem(Graphics g, JComponent c,
                                     Icon checkIcon, Icon arrowIcon,
                                     Color background, Color foreground,
                                     int defaultTextIconGap) {
        // Save original graphics font and color
<span class="nc" id="L485">        Font holdf = g.getFont();</span>
<span class="nc" id="L486">        Color holdc = g.getColor();</span>

<span class="nc" id="L488">        JMenuItem mi = (JMenuItem) c;</span>
<span class="nc" id="L489">        g.setFont(mi.getFont());</span>

<span class="nc" id="L491">        Rectangle viewRect = new Rectangle(0, 0, mi.getWidth(), mi.getHeight());</span>
<span class="nc" id="L492">        applyInsets(viewRect, mi.getInsets());</span>

<span class="nc" id="L494">        MenuItemLayoutHelper lh = new MenuItemLayoutHelper(mi, checkIcon,</span>
                arrowIcon, viewRect, defaultTextIconGap, acceleratorDelimiter,
<span class="nc" id="L496">                BasicGraphicsUtils.isLeftToRight(mi), mi.getFont(),</span>
<span class="nc" id="L497">                acceleratorFont, MenuItemLayoutHelper.useCheckAndArrow(menuItem),</span>
<span class="nc" id="L498">                getPropertyPrefix());</span>
<span class="nc" id="L499">        MenuItemLayoutHelper.LayoutResult lr = lh.layoutMenuItem();</span>

<span class="nc" id="L501">        paintBackground(g, mi, background);</span>
<span class="nc" id="L502">        paintCheckIcon(g, lh, lr, holdc, foreground);</span>
<span class="nc" id="L503">        paintIcon(g, lh, lr, holdc);</span>
<span class="nc" id="L504">        paintText(g, lh, lr);</span>
<span class="nc" id="L505">        paintAccText(g, lh, lr);</span>
<span class="nc" id="L506">        paintArrowIcon(g, lh, lr, foreground);</span>

        // Restore original graphics font and color
<span class="nc" id="L509">        g.setColor(holdc);</span>
<span class="nc" id="L510">        g.setFont(holdf);</span>
<span class="nc" id="L511">    }</span>

    private void paintIcon(Graphics g, MenuItemLayoutHelper lh,
                           MenuItemLayoutHelper.LayoutResult lr, Color holdc) {
<span class="nc bnc" id="L515" title="All 2 branches missed.">        if (lh.getIcon() != null) {</span>
            Icon icon;
<span class="nc" id="L517">            ButtonModel model = lh.getMenuItem().getModel();</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">            if (!model.isEnabled()) {</span>
<span class="nc" id="L519">                icon = lh.getMenuItem().getDisabledIcon();</span>
<span class="nc bnc" id="L520" title="All 4 branches missed.">            } else if (model.isPressed() &amp;&amp; model.isArmed()) {</span>
<span class="nc" id="L521">                icon = lh.getMenuItem().getPressedIcon();</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">                if (icon == null) {</span>
                    // Use default icon
<span class="nc" id="L524">                    icon = lh.getMenuItem().getIcon();</span>
                }
            } else {
<span class="nc" id="L527">                icon = lh.getMenuItem().getIcon();</span>
            }

<span class="nc bnc" id="L530" title="All 2 branches missed.">            if (icon != null) {</span>
<span class="nc" id="L531">                icon.paintIcon(lh.getMenuItem(), g, lr.getIconRect().x,</span>
<span class="nc" id="L532">                        lr.getIconRect().y);</span>
<span class="nc" id="L533">                g.setColor(holdc);</span>
            }
        }
<span class="nc" id="L536">    }</span>

    private void paintCheckIcon(Graphics g, MenuItemLayoutHelper lh,
                                MenuItemLayoutHelper.LayoutResult lr,
                                Color holdc, Color foreground) {
<span class="nc bnc" id="L541" title="All 2 branches missed.">        if (lh.getCheckIcon() != null) {</span>
<span class="nc" id="L542">            ButtonModel model = lh.getMenuItem().getModel();</span>
<span class="nc bnc" id="L543" title="All 4 branches missed.">            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">                    &amp;&amp; model.isSelected())) {</span>
<span class="nc" id="L545">                g.setColor(foreground);</span>
            } else {
<span class="nc" id="L547">                g.setColor(holdc);</span>
            }
<span class="nc bnc" id="L549" title="All 2 branches missed.">            if (lh.useCheckAndArrow()) {</span>
<span class="nc" id="L550">                lh.getCheckIcon().paintIcon(lh.getMenuItem(), g,</span>
<span class="nc" id="L551">                        lr.getCheckRect().x, lr.getCheckRect().y);</span>
            }
<span class="nc" id="L553">            g.setColor(holdc);</span>
        }
<span class="nc" id="L555">    }</span>

    private void paintAccText(Graphics g, MenuItemLayoutHelper lh,
                              MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc bnc" id="L559" title="All 2 branches missed.">        if (!lh.getAccText().equals(&quot;&quot;)) {</span>
<span class="nc" id="L560">            ButtonModel model = lh.getMenuItem().getModel();</span>
<span class="nc" id="L561">            g.setFont(lh.getAccFontMetrics().getFont());</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">            if (!model.isEnabled()) {</span>
                // *** paint the accText disabled
<span class="nc bnc" id="L564" title="All 2 branches missed.">                if (disabledForeground != null) {</span>
<span class="nc" id="L565">                    g.setColor(disabledForeground);</span>
<span class="nc" id="L566">                    SwingUtilities2.drawString(lh.getMenuItem(), g,</span>
<span class="nc" id="L567">                        lh.getAccText(), lr.getAccRect().x,</span>
<span class="nc" id="L568">                        lr.getAccRect().y + lh.getAccFontMetrics().getAscent());</span>
                } else {
<span class="nc" id="L570">                    g.setColor(lh.getMenuItem().getBackground().brighter());</span>
<span class="nc" id="L571">                    SwingUtilities2.drawString(lh.getMenuItem(), g,</span>
<span class="nc" id="L572">                        lh.getAccText(), lr.getAccRect().x,</span>
<span class="nc" id="L573">                        lr.getAccRect().y + lh.getAccFontMetrics().getAscent());</span>
<span class="nc" id="L574">                    g.setColor(lh.getMenuItem().getBackground().darker());</span>
<span class="nc" id="L575">                    SwingUtilities2.drawString(lh.getMenuItem(), g,</span>
<span class="nc" id="L576">                        lh.getAccText(), lr.getAccRect().x - 1,</span>
<span class="nc" id="L577">                        lr.getAccRect().y + lh.getFontMetrics().getAscent() - 1);</span>
                }
            } else {
                // *** paint the accText normally
<span class="nc bnc" id="L581" title="All 2 branches missed.">                if (model.isArmed()</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">                        || (lh.getMenuItem() instanceof JMenu</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">                        &amp;&amp; model.isSelected())) {</span>
<span class="nc" id="L584">                    g.setColor(acceleratorSelectionForeground);</span>
                } else {
<span class="nc" id="L586">                    g.setColor(acceleratorForeground);</span>
                }
<span class="nc" id="L588">                SwingUtilities2.drawString(lh.getMenuItem(), g, lh.getAccText(),</span>
<span class="nc" id="L589">                        lr.getAccRect().x, lr.getAccRect().y +</span>
<span class="nc" id="L590">                        lh.getAccFontMetrics().getAscent());</span>
            }
        }
<span class="nc" id="L593">    }</span>

    private void paintText(Graphics g, MenuItemLayoutHelper lh,
                           MenuItemLayoutHelper.LayoutResult lr) {
<span class="nc bnc" id="L597" title="All 2 branches missed.">        if (!lh.getText().equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">            if (lh.getHtmlView() != null) {</span>
                // Text is HTML
<span class="nc" id="L600">                lh.getHtmlView().paint(g, lr.getTextRect());</span>
            } else {
                // Text isn't HTML
<span class="nc" id="L603">                paintText(g, lh.getMenuItem(), lr.getTextRect(), lh.getText());</span>
            }
        }
<span class="nc" id="L606">    }</span>

    private void paintArrowIcon(Graphics g, MenuItemLayoutHelper lh,
                                MenuItemLayoutHelper.LayoutResult lr,
                                Color foreground) {
<span class="nc bnc" id="L611" title="All 2 branches missed.">        if (lh.getArrowIcon() != null) {</span>
<span class="nc" id="L612">            ButtonModel model = lh.getMenuItem().getModel();</span>
<span class="nc bnc" id="L613" title="All 4 branches missed.">            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">                                &amp;&amp; model.isSelected())) {</span>
<span class="nc" id="L615">                g.setColor(foreground);</span>
            }
<span class="nc bnc" id="L617" title="All 2 branches missed.">            if (lh.useCheckAndArrow()) {</span>
<span class="nc" id="L618">                lh.getArrowIcon().paintIcon(lh.getMenuItem(), g,</span>
<span class="nc" id="L619">                        lr.getArrowRect().x, lr.getArrowRect().y);</span>
            }
        }
<span class="nc" id="L622">    }</span>

    private void applyInsets(Rectangle rect, Insets insets) {
<span class="nc bnc" id="L625" title="All 2 branches missed.">        if(insets != null) {</span>
<span class="nc" id="L626">            rect.x += insets.left;</span>
<span class="nc" id="L627">            rect.y += insets.top;</span>
<span class="nc" id="L628">            rect.width -= (insets.right + rect.x);</span>
<span class="nc" id="L629">            rect.height -= (insets.bottom + rect.y);</span>
        }
<span class="nc" id="L631">    }</span>

    /**
     * Draws the background of the menu item.
     *
     * @param g the paint graphics
     * @param menuItem menu item to be painted
     * @param bgColor selection background color
     * @since 1.4
     */
    protected void paintBackground(Graphics g, JMenuItem menuItem, Color bgColor) {
<span class="nc" id="L642">        ButtonModel model = menuItem.getModel();</span>
<span class="nc" id="L643">        Color oldColor = g.getColor();</span>
<span class="nc" id="L644">        int menuWidth = menuItem.getWidth();</span>
<span class="nc" id="L645">        int menuHeight = menuItem.getHeight();</span>

<span class="nc bnc" id="L647" title="All 2 branches missed.">        if(menuItem.isOpaque()) {</span>
<span class="nc bnc" id="L648" title="All 6 branches missed.">            if (model.isArmed()|| (menuItem instanceof JMenu &amp;&amp; model.isSelected())) {</span>
<span class="nc" id="L649">                g.setColor(bgColor);</span>
<span class="nc" id="L650">                g.fillRect(0,0, menuWidth, menuHeight);</span>
            } else {
<span class="nc" id="L652">                g.setColor(menuItem.getBackground());</span>
<span class="nc" id="L653">                g.fillRect(0,0, menuWidth, menuHeight);</span>
            }
<span class="nc" id="L655">            g.setColor(oldColor);</span>
        }
<span class="nc bnc" id="L657" title="All 4 branches missed.">        else if (model.isArmed() || (menuItem instanceof JMenu &amp;&amp;</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">                                     model.isSelected())) {</span>
<span class="nc" id="L659">            g.setColor(bgColor);</span>
<span class="nc" id="L660">            g.fillRect(0,0, menuWidth, menuHeight);</span>
<span class="nc" id="L661">            g.setColor(oldColor);</span>
        }
<span class="nc" id="L663">    }</span>

    /**
     * Renders the text of the current menu item.
     * &lt;p&gt;
     * @param g graphics context
     * @param menuItem menu item to render
     * @param textRect bounding rectangle for rendering the text
     * @param text string to render
     * @since 1.4
     */
    protected void paintText(Graphics g, JMenuItem menuItem, Rectangle textRect, String text) {
<span class="nc" id="L675">        ButtonModel model = menuItem.getModel();</span>
<span class="nc" id="L676">        FontMetrics fm = SwingUtilities2.getFontMetrics(menuItem, g);</span>
<span class="nc" id="L677">        int mnemIndex = menuItem.getDisplayedMnemonicIndex();</span>

<span class="nc bnc" id="L679" title="All 2 branches missed.">        if(!model.isEnabled()) {</span>
            // *** paint the text disabled
<span class="nc bnc" id="L681" title="All 2 branches missed.">            if ( UIManager.get(&quot;MenuItem.disabledForeground&quot;) instanceof Color ) {</span>
<span class="nc" id="L682">                g.setColor( UIManager.getColor(&quot;MenuItem.disabledForeground&quot;) );</span>
<span class="nc" id="L683">                SwingUtilities2.drawStringUnderlineCharAt(menuItem, g,text,</span>
<span class="nc" id="L684">                          mnemIndex, textRect.x,  textRect.y + fm.getAscent());</span>
            } else {
<span class="nc" id="L686">                g.setColor(menuItem.getBackground().brighter());</span>
<span class="nc" id="L687">                SwingUtilities2.drawStringUnderlineCharAt(menuItem, g, text,</span>
<span class="nc" id="L688">                           mnemIndex, textRect.x, textRect.y + fm.getAscent());</span>
<span class="nc" id="L689">                g.setColor(menuItem.getBackground().darker());</span>
<span class="nc" id="L690">                SwingUtilities2.drawStringUnderlineCharAt(menuItem, g,text,</span>
                           mnemIndex,  textRect.x - 1, textRect.y +
<span class="nc" id="L692">                           fm.getAscent() - 1);</span>
            }
        } else {
            // *** paint the text normally
<span class="nc bnc" id="L696" title="All 6 branches missed.">            if (model.isArmed()|| (menuItem instanceof JMenu &amp;&amp; model.isSelected())) {</span>
<span class="nc" id="L697">                g.setColor(selectionForeground); // Uses protected field.</span>
            }
<span class="nc" id="L699">            SwingUtilities2.drawStringUnderlineCharAt(menuItem, g,text,</span>
<span class="nc" id="L700">                           mnemIndex, textRect.x, textRect.y + fm.getAscent());</span>
        }
<span class="nc" id="L702">    }</span>

    public MenuElement[] getPath() {
<span class="nc" id="L705">        MenuSelectionManager m = MenuSelectionManager.defaultManager();</span>
<span class="nc" id="L706">        MenuElement oldPath[] = m.getSelectedPath();</span>
        MenuElement newPath[];
<span class="nc" id="L708">        int i = oldPath.length;</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">        if (i == 0)</span>
<span class="nc" id="L710">            return new MenuElement[0];</span>
<span class="nc" id="L711">        Component parent = menuItem.getParent();</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">        if (oldPath[i-1].getComponent() == parent) {</span>
            // The parent popup menu is the last so far
<span class="nc" id="L714">            newPath = new MenuElement[i+1];</span>
<span class="nc" id="L715">            System.arraycopy(oldPath, 0, newPath, 0, i);</span>
<span class="nc" id="L716">            newPath[i] = menuItem;</span>
        } else {
            // A sibling menuitem is the current selection
            //
            //  This probably needs to handle 'exit submenu into
            // a menu item.  Search backwards along the current
            // selection until you find the parent popup menu,
            // then copy up to that and add yourself...
            int j;
<span class="nc bnc" id="L725" title="All 2 branches missed.">            for (j = oldPath.length-1; j &gt;= 0; j--) {</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">                if (oldPath[j].getComponent() == parent)</span>
<span class="nc" id="L727">                    break;</span>
            }
<span class="nc" id="L729">            newPath = new MenuElement[j+2];</span>
<span class="nc" id="L730">            System.arraycopy(oldPath, 0, newPath, 0, j+1);</span>
<span class="nc" id="L731">            newPath[j+1] = menuItem;</span>
            /*
            System.out.println(&quot;Sibling condition -- &quot;);
            System.out.println(&quot;Old array : &quot;);
            printMenuElementArray(oldPath, false);
            System.out.println(&quot;New array : &quot;);
            printMenuElementArray(newPath, false);
            */
        }
<span class="nc" id="L740">        return newPath;</span>
    }

    void printMenuElementArray(MenuElement path[], boolean dumpStack) {
<span class="nc" id="L744">        System.out.println(&quot;Path is(&quot;);</span>
        int i, j;
<span class="nc bnc" id="L746" title="All 2 branches missed.">        for(i=0,j=path.length; i&lt;j ;i++){</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">            for (int k=0; k&lt;=i; k++)</span>
<span class="nc" id="L748">                System.out.print(&quot;  &quot;);</span>
<span class="nc" id="L749">            MenuElement me = path[i];</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">            if(me instanceof JMenuItem)</span>
<span class="nc" id="L751">                System.out.println(((JMenuItem)me).getText() + &quot;, &quot;);</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">            else if (me == null)</span>
<span class="nc" id="L753">                System.out.println(&quot;NULL , &quot;);</span>
            else
<span class="nc" id="L755">                System.out.println(&quot;&quot; + me + &quot;, &quot;);</span>
        }
<span class="nc" id="L757">        System.out.println(&quot;)&quot;);</span>

<span class="nc bnc" id="L759" title="All 2 branches missed.">        if (dumpStack == true)</span>
<span class="nc" id="L760">            Thread.dumpStack();</span>
<span class="nc" id="L761">    }</span>
<span class="nc" id="L762">    protected class MouseInputHandler implements MouseInputListener {</span>
        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        public void mouseClicked(MouseEvent e) {
<span class="nc" id="L769">            getHandler().mouseClicked(e);</span>
<span class="nc" id="L770">        }</span>
        public void mousePressed(MouseEvent e) {
<span class="nc" id="L772">            getHandler().mousePressed(e);</span>
<span class="nc" id="L773">        }</span>
        public void mouseReleased(MouseEvent e) {
<span class="nc" id="L775">            getHandler().mouseReleased(e);</span>
<span class="nc" id="L776">        }</span>
        public void mouseEntered(MouseEvent e) {
<span class="nc" id="L778">            getHandler().mouseEntered(e);</span>
<span class="nc" id="L779">        }</span>
        public void mouseExited(MouseEvent e) {
<span class="nc" id="L781">            getHandler().mouseExited(e);</span>
<span class="nc" id="L782">        }</span>
        public void mouseDragged(MouseEvent e) {
<span class="nc" id="L784">            getHandler().mouseDragged(e);</span>
<span class="nc" id="L785">        }</span>
        public void mouseMoved(MouseEvent e) {
<span class="nc" id="L787">            getHandler().mouseMoved(e);</span>
<span class="nc" id="L788">        }</span>
    }


    private static class Actions extends UIAction {
        private static final String CLICK = &quot;doClick&quot;;

        Actions(String key) {
<span class="nc" id="L796">            super(key);</span>
<span class="nc" id="L797">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L800">            JMenuItem mi = (JMenuItem)e.getSource();</span>
<span class="nc" id="L801">            MenuSelectionManager.defaultManager().clearSelectedPath();</span>
<span class="nc" id="L802">            mi.doClick();</span>
<span class="nc" id="L803">        }</span>
    }

    /**
     * Call this method when a menu item is to be activated.
     * This method handles some of the details of menu item activation
     * such as clearing the selected path and messaging the
     * JMenuItem's doClick() method.
     *
     * @param msm  A MenuSelectionManager. The visual feedback and
     *             internal bookkeeping tasks are delegated to
     *             this MenuSelectionManager. If &lt;code&gt;null&lt;/code&gt; is
     *             passed as this argument, the
     *             &lt;code&gt;MenuSelectionManager.defaultManager&lt;/code&gt; is
     *             used.
     * @see MenuSelectionManager
     * @see JMenuItem#doClick(int)
     * @since 1.4
     */
    protected void doClick(MenuSelectionManager msm) {
        // Auditory cue
<span class="nc bnc" id="L824" title="All 2 branches missed.">        if (! isInternalFrameSystemMenu()) {</span>
<span class="nc" id="L825">            BasicLookAndFeel.playSound(menuItem, getPropertyPrefix() +</span>
                                       &quot;.commandSound&quot;);
        }
        // Visual feedback
<span class="nc bnc" id="L829" title="All 2 branches missed.">        if (msm == null) {</span>
<span class="nc" id="L830">            msm = MenuSelectionManager.defaultManager();</span>
        }
<span class="nc" id="L832">        msm.clearSelectedPath();</span>
<span class="nc" id="L833">        menuItem.doClick(0);</span>
<span class="nc" id="L834">    }</span>

    /**
     * This is to see if the menu item in question is part of the
     * system menu on an internal frame.
     * The Strings that are being checked can be found in
     * MetalInternalFrameTitlePaneUI.java,
     * WindowsInternalFrameTitlePaneUI.java, and
     * MotifInternalFrameTitlePaneUI.java.
     *
     * @since 1.4
     */
    private boolean isInternalFrameSystemMenu() {
<span class="nc" id="L847">        String actionCommand = menuItem.getActionCommand();</span>
<span class="nc bnc" id="L848" title="All 8 branches missed.">        if ((actionCommand == &quot;Close&quot;) ||</span>
            (actionCommand == &quot;Minimize&quot;) ||
            (actionCommand == &quot;Restore&quot;) ||
            (actionCommand == &quot;Maximize&quot;)) {
<span class="nc" id="L852">          return true;</span>
        } else {
<span class="nc" id="L854">          return false;</span>
        }
    }


    // BasicMenuUI subclasses this.
<span class="nc" id="L860">    class Handler implements MenuDragMouseListener,</span>
                          MouseInputListener, PropertyChangeListener {
        //
        // MouseInputListener
        //
<span class="nc" id="L865">        public void mouseClicked(MouseEvent e) {}</span>
        public void mousePressed(MouseEvent e) {
<span class="nc" id="L867">        }</span>
        public void mouseReleased(MouseEvent e) {
<span class="nc bnc" id="L869" title="All 2 branches missed.">            if (!menuItem.isEnabled()) {</span>
<span class="nc" id="L870">                return;</span>
            }
            MenuSelectionManager manager =
<span class="nc" id="L873">                MenuSelectionManager.defaultManager();</span>
<span class="nc" id="L874">            Point p = e.getPoint();</span>
<span class="nc bnc" id="L875" title="All 6 branches missed.">            if(p.x &gt;= 0 &amp;&amp; p.x &lt; menuItem.getWidth() &amp;&amp;</span>
<span class="nc bnc" id="L876" title="All 2 branches missed.">               p.y &gt;= 0 &amp;&amp; p.y &lt; menuItem.getHeight()) {</span>
<span class="nc" id="L877">                doClick(manager);</span>
            } else {
<span class="nc" id="L879">                manager.processMouseEvent(e);</span>
            }
<span class="nc" id="L881">        }</span>
        public void mouseEntered(MouseEvent e) {
<span class="nc" id="L883">            MenuSelectionManager manager = MenuSelectionManager.defaultManager();</span>
<span class="nc" id="L884">            int modifiers = e.getModifiers();</span>
            // 4188027: drag enter/exit added in JDK 1.1.7A, JDK1.2
<span class="nc bnc" id="L886" title="All 2 branches missed.">            if ((modifiers &amp; (InputEvent.BUTTON1_MASK |</span>
                              InputEvent.BUTTON2_MASK | InputEvent.BUTTON3_MASK)) !=0 ) {
<span class="nc" id="L888">                MenuSelectionManager.defaultManager().processMouseEvent(e);</span>
            } else {
<span class="nc" id="L890">            manager.setSelectedPath(getPath());</span>
             }
<span class="nc" id="L892">        }</span>
        public void mouseExited(MouseEvent e) {
<span class="nc" id="L894">            MenuSelectionManager manager = MenuSelectionManager.defaultManager();</span>

<span class="nc" id="L896">            int modifiers = e.getModifiers();</span>
            // 4188027: drag enter/exit added in JDK 1.1.7A, JDK1.2
<span class="nc bnc" id="L898" title="All 2 branches missed.">            if ((modifiers &amp; (InputEvent.BUTTON1_MASK |</span>
                              InputEvent.BUTTON2_MASK | InputEvent.BUTTON3_MASK)) !=0 ) {
<span class="nc" id="L900">                MenuSelectionManager.defaultManager().processMouseEvent(e);</span>
            } else {

<span class="nc" id="L903">                MenuElement path[] = manager.getSelectedPath();</span>
<span class="nc bnc" id="L904" title="All 4 branches missed.">                if (path.length &gt; 1 &amp;&amp; path[path.length-1] == menuItem) {</span>
<span class="nc" id="L905">                    MenuElement newPath[] = new MenuElement[path.length-1];</span>
                    int i,c;
<span class="nc bnc" id="L907" title="All 2 branches missed.">                    for(i=0,c=path.length-1;i&lt;c;i++)</span>
<span class="nc" id="L908">                        newPath[i] = path[i];</span>
<span class="nc" id="L909">                    manager.setSelectedPath(newPath);</span>
                }
                }
<span class="nc" id="L912">        }</span>

        public void mouseDragged(MouseEvent e) {
<span class="nc" id="L915">            MenuSelectionManager.defaultManager().processMouseEvent(e);</span>
<span class="nc" id="L916">        }</span>
        public void mouseMoved(MouseEvent e) {
<span class="nc" id="L918">        }</span>

        //
        // MenuDragListener
        //
        public void menuDragMouseEntered(MenuDragMouseEvent e) {
<span class="nc" id="L924">            MenuSelectionManager manager = e.getMenuSelectionManager();</span>
<span class="nc" id="L925">            MenuElement path[] = e.getPath();</span>
<span class="nc" id="L926">            manager.setSelectedPath(path);</span>
<span class="nc" id="L927">        }</span>
        public void menuDragMouseDragged(MenuDragMouseEvent e) {
<span class="nc" id="L929">            MenuSelectionManager manager = e.getMenuSelectionManager();</span>
<span class="nc" id="L930">            MenuElement path[] = e.getPath();</span>
<span class="nc" id="L931">            manager.setSelectedPath(path);</span>
<span class="nc" id="L932">        }</span>
<span class="nc" id="L933">        public void menuDragMouseExited(MenuDragMouseEvent e) {}</span>
        public void menuDragMouseReleased(MenuDragMouseEvent e) {
<span class="nc bnc" id="L935" title="All 2 branches missed.">            if (!menuItem.isEnabled()) {</span>
<span class="nc" id="L936">                return;</span>
            }
<span class="nc" id="L938">            MenuSelectionManager manager = e.getMenuSelectionManager();</span>
<span class="nc" id="L939">            MenuElement path[] = e.getPath();</span>
<span class="nc" id="L940">            Point p = e.getPoint();</span>
<span class="nc bnc" id="L941" title="All 6 branches missed.">            if (p.x &gt;= 0 &amp;&amp; p.x &lt; menuItem.getWidth() &amp;&amp;</span>
<span class="nc bnc" id="L942" title="All 2 branches missed.">                    p.y &gt;= 0 &amp;&amp; p.y &lt; menuItem.getHeight()) {</span>
<span class="nc" id="L943">                doClick(manager);</span>
            } else {
<span class="nc" id="L945">                manager.clearSelectedPath();</span>
            }
<span class="nc" id="L947">        }</span>


        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L954">            String name = e.getPropertyName();</span>

<span class="nc bnc" id="L956" title="All 6 branches missed.">            if (name == &quot;labelFor&quot; || name == &quot;displayedMnemonic&quot; ||</span>
                name == &quot;accelerator&quot;) {
<span class="nc" id="L958">                updateAcceleratorBinding();</span>
<span class="nc bnc" id="L959" title="All 6 branches missed.">            } else if (name == &quot;text&quot; || &quot;font&quot; == name ||</span>
                       &quot;foreground&quot; == name) {
                // remove the old html view client property if one
                // existed, and install a new one if the text installed
                // into the JLabel is html source.
<span class="nc" id="L964">                JMenuItem lbl = ((JMenuItem) e.getSource());</span>
<span class="nc" id="L965">                String text = lbl.getText();</span>
<span class="nc" id="L966">                BasicHTML.updateRenderer(lbl, text);</span>
<span class="nc bnc" id="L967" title="All 2 branches missed.">            } else if (name  == &quot;iconTextGap&quot;) {</span>
<span class="nc" id="L968">                defaultTextIconGap = ((Number)e.getNewValue()).intValue();</span>
            }
<span class="nc" id="L970">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>