<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BasicInternalFrameTitlePane.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicInternalFrameTitlePane.java</span></div><h1>BasicInternalFrameTitlePane.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import sun.swing.SwingUtilities2;
import java.awt.*;
import java.awt.event.*;
import javax.accessibility.AccessibleContext;
import javax.swing.*;
import javax.swing.plaf.*;
import javax.swing.border.*;
import javax.swing.event.InternalFrameEvent;
import java.util.EventListener;
import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeEvent;
import java.beans.VetoableChangeListener;
import java.beans.PropertyVetoException;

import sun.swing.DefaultLookup;
import sun.swing.UIAction;

/**
 * The class that manages a basic title bar
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases. The current serialization support is
 * appropriate for short term storage or RMI between applications running
 * the same version of Swing.  As of 1.4, support for long term storage
 * of all JavaBeans&amp;trade;
 * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
 * Please see {@link java.beans.XMLEncoder}.
 *
 * @author David Kloba
 * @author Steve Wilson
 */
public class BasicInternalFrameTitlePane extends JComponent
{
    protected JMenuBar menuBar;
    protected JButton iconButton;
    protected JButton maxButton;
    protected JButton closeButton;

    protected JMenu windowMenu;
    protected JInternalFrame frame;

    protected Color selectedTitleColor;
    protected Color selectedTextColor;
    protected Color notSelectedTitleColor;
    protected Color notSelectedTextColor;

    protected Icon maxIcon;
    protected Icon minIcon;
    protected Icon iconIcon;
    protected Icon closeIcon;

    protected PropertyChangeListener propertyChangeListener;

    protected Action closeAction;
    protected Action maximizeAction;
    protected Action iconifyAction;
    protected Action restoreAction;
    protected Action moveAction;
    protected Action sizeAction;

    // These constants are not used in JDK code
<span class="nc" id="L90">    protected static final String CLOSE_CMD =</span>
<span class="nc" id="L91">        UIManager.getString(&quot;InternalFrameTitlePane.closeButtonText&quot;);</span>
<span class="nc" id="L92">    protected static final String ICONIFY_CMD =</span>
<span class="nc" id="L93">        UIManager.getString(&quot;InternalFrameTitlePane.minimizeButtonText&quot;);</span>
<span class="nc" id="L94">    protected static final String RESTORE_CMD =</span>
<span class="nc" id="L95">        UIManager.getString(&quot;InternalFrameTitlePane.restoreButtonText&quot;);</span>
<span class="nc" id="L96">    protected static final String MAXIMIZE_CMD =</span>
<span class="nc" id="L97">        UIManager.getString(&quot;InternalFrameTitlePane.maximizeButtonText&quot;);</span>
<span class="nc" id="L98">    protected static final String MOVE_CMD =</span>
<span class="nc" id="L99">        UIManager.getString(&quot;InternalFrameTitlePane.moveButtonText&quot;);</span>
<span class="nc" id="L100">    protected static final String SIZE_CMD =</span>
<span class="nc" id="L101">        UIManager.getString(&quot;InternalFrameTitlePane.sizeButtonText&quot;);</span>

    private String closeButtonToolTip;
    private String iconButtonToolTip;
    private String restoreButtonToolTip;
    private String maxButtonToolTip;
    private Handler handler;

<span class="nc" id="L109">    public BasicInternalFrameTitlePane(JInternalFrame f) {</span>
<span class="nc" id="L110">        frame = f;</span>
<span class="nc" id="L111">        installTitlePane();</span>
<span class="nc" id="L112">    }</span>

    protected void installTitlePane() {
<span class="nc" id="L115">        installDefaults();</span>
<span class="nc" id="L116">        installListeners();</span>

<span class="nc" id="L118">        createActions();</span>
<span class="nc" id="L119">        enableActions();</span>
<span class="nc" id="L120">        createActionMap();</span>

<span class="nc" id="L122">        setLayout(createLayout());</span>

<span class="nc" id="L124">        assembleSystemMenu();</span>
<span class="nc" id="L125">        createButtons();</span>
<span class="nc" id="L126">        addSubComponents();</span>

<span class="nc" id="L128">    }</span>

    protected void addSubComponents() {
<span class="nc" id="L131">        add(menuBar);</span>
<span class="nc" id="L132">        add(iconButton);</span>
<span class="nc" id="L133">        add(maxButton);</span>
<span class="nc" id="L134">        add(closeButton);</span>
<span class="nc" id="L135">    }</span>

    protected void createActions() {
<span class="nc" id="L138">        maximizeAction = new MaximizeAction();</span>
<span class="nc" id="L139">        iconifyAction = new IconifyAction();</span>
<span class="nc" id="L140">        closeAction = new CloseAction();</span>
<span class="nc" id="L141">        restoreAction = new RestoreAction();</span>
<span class="nc" id="L142">        moveAction = new MoveAction();</span>
<span class="nc" id="L143">        sizeAction = new SizeAction();</span>
<span class="nc" id="L144">    }</span>

    ActionMap createActionMap() {
<span class="nc" id="L147">        ActionMap map = new ActionMapUIResource();</span>
<span class="nc" id="L148">        map.put(&quot;showSystemMenu&quot;, new ShowSystemMenuAction(true));</span>
<span class="nc" id="L149">        map.put(&quot;hideSystemMenu&quot;, new ShowSystemMenuAction(false));</span>
<span class="nc" id="L150">        return map;</span>
    }

    protected void installListeners() {
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if( propertyChangeListener == null ) {</span>
<span class="nc" id="L155">            propertyChangeListener = createPropertyChangeListener();</span>
        }
<span class="nc" id="L157">        frame.addPropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L158">    }</span>

    protected void uninstallListeners() {
<span class="nc" id="L161">        frame.removePropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L162">        handler = null;</span>
<span class="nc" id="L163">    }</span>

    protected void installDefaults() {
<span class="nc" id="L166">        maxIcon = UIManager.getIcon(&quot;InternalFrame.maximizeIcon&quot;);</span>
<span class="nc" id="L167">        minIcon = UIManager.getIcon(&quot;InternalFrame.minimizeIcon&quot;);</span>
<span class="nc" id="L168">        iconIcon = UIManager.getIcon(&quot;InternalFrame.iconifyIcon&quot;);</span>
<span class="nc" id="L169">        closeIcon = UIManager.getIcon(&quot;InternalFrame.closeIcon&quot;);</span>

<span class="nc" id="L171">        selectedTitleColor = UIManager.getColor(&quot;InternalFrame.activeTitleBackground&quot;);</span>
<span class="nc" id="L172">        selectedTextColor = UIManager.getColor(&quot;InternalFrame.activeTitleForeground&quot;);</span>
<span class="nc" id="L173">        notSelectedTitleColor = UIManager.getColor(&quot;InternalFrame.inactiveTitleBackground&quot;);</span>
<span class="nc" id="L174">        notSelectedTextColor = UIManager.getColor(&quot;InternalFrame.inactiveTitleForeground&quot;);</span>
<span class="nc" id="L175">        setFont(UIManager.getFont(&quot;InternalFrame.titleFont&quot;));</span>
<span class="nc" id="L176">        closeButtonToolTip =</span>
<span class="nc" id="L177">                UIManager.getString(&quot;InternalFrame.closeButtonToolTip&quot;);</span>
<span class="nc" id="L178">        iconButtonToolTip =</span>
<span class="nc" id="L179">                UIManager.getString(&quot;InternalFrame.iconButtonToolTip&quot;);</span>
<span class="nc" id="L180">        restoreButtonToolTip =</span>
<span class="nc" id="L181">                UIManager.getString(&quot;InternalFrame.restoreButtonToolTip&quot;);</span>
<span class="nc" id="L182">        maxButtonToolTip =</span>
<span class="nc" id="L183">                UIManager.getString(&quot;InternalFrame.maxButtonToolTip&quot;);</span>
<span class="nc" id="L184">    }</span>


    protected void uninstallDefaults() {
<span class="nc" id="L188">    }</span>

    protected void createButtons() {
<span class="nc" id="L191">        iconButton = new NoFocusButton(</span>
                     &quot;InternalFrameTitlePane.iconifyButtonAccessibleName&quot;,
                     &quot;InternalFrameTitlePane.iconifyButtonOpacity&quot;);
<span class="nc" id="L194">        iconButton.addActionListener(iconifyAction);</span>
<span class="nc bnc" id="L195" title="All 4 branches missed.">        if (iconButtonToolTip != null &amp;&amp; iconButtonToolTip.length() != 0) {</span>
<span class="nc" id="L196">            iconButton.setToolTipText(iconButtonToolTip);</span>
        }

<span class="nc" id="L199">        maxButton = new NoFocusButton(</span>
                        &quot;InternalFrameTitlePane.maximizeButtonAccessibleName&quot;,
                        &quot;InternalFrameTitlePane.maximizeButtonOpacity&quot;);
<span class="nc" id="L202">        maxButton.addActionListener(maximizeAction);</span>

<span class="nc" id="L204">        closeButton = new NoFocusButton(</span>
                      &quot;InternalFrameTitlePane.closeButtonAccessibleName&quot;,
                      &quot;InternalFrameTitlePane.closeButtonOpacity&quot;);
<span class="nc" id="L207">        closeButton.addActionListener(closeAction);</span>
<span class="nc bnc" id="L208" title="All 4 branches missed.">        if (closeButtonToolTip != null &amp;&amp; closeButtonToolTip.length() != 0) {</span>
<span class="nc" id="L209">            closeButton.setToolTipText(closeButtonToolTip);</span>
        }

<span class="nc" id="L212">        setButtonIcons();</span>
<span class="nc" id="L213">    }</span>

    protected void setButtonIcons() {
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if(frame.isIcon()) {</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">            if (minIcon != null) {</span>
<span class="nc" id="L218">                iconButton.setIcon(minIcon);</span>
            }
<span class="nc bnc" id="L220" title="All 2 branches missed.">            if (restoreButtonToolTip != null &amp;&amp;</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                    restoreButtonToolTip.length() != 0) {</span>
<span class="nc" id="L222">                iconButton.setToolTipText(restoreButtonToolTip);</span>
            }
<span class="nc bnc" id="L224" title="All 2 branches missed.">            if (maxIcon != null) {</span>
<span class="nc" id="L225">                maxButton.setIcon(maxIcon);</span>
            }
<span class="nc bnc" id="L227" title="All 4 branches missed.">            if (maxButtonToolTip != null &amp;&amp; maxButtonToolTip.length() != 0) {</span>
<span class="nc" id="L228">                maxButton.setToolTipText(maxButtonToolTip);</span>
            }
<span class="nc bnc" id="L230" title="All 2 branches missed.">        } else if (frame.isMaximum()) {</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">            if (iconIcon != null) {</span>
<span class="nc" id="L232">                iconButton.setIcon(iconIcon);</span>
            }
<span class="nc bnc" id="L234" title="All 4 branches missed.">            if (iconButtonToolTip != null &amp;&amp; iconButtonToolTip.length() != 0) {</span>
<span class="nc" id="L235">                iconButton.setToolTipText(iconButtonToolTip);</span>
            }
<span class="nc bnc" id="L237" title="All 2 branches missed.">            if (minIcon != null) {</span>
<span class="nc" id="L238">                maxButton.setIcon(minIcon);</span>
            }
<span class="nc bnc" id="L240" title="All 2 branches missed.">            if (restoreButtonToolTip != null &amp;&amp;</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">                    restoreButtonToolTip.length() != 0) {</span>
<span class="nc" id="L242">                maxButton.setToolTipText(restoreButtonToolTip);</span>
            }
        } else {
<span class="nc bnc" id="L245" title="All 2 branches missed.">            if (iconIcon != null) {</span>
<span class="nc" id="L246">                iconButton.setIcon(iconIcon);</span>
            }
<span class="nc bnc" id="L248" title="All 4 branches missed.">            if (iconButtonToolTip != null &amp;&amp; iconButtonToolTip.length() != 0) {</span>
<span class="nc" id="L249">                iconButton.setToolTipText(iconButtonToolTip);</span>
            }
<span class="nc bnc" id="L251" title="All 2 branches missed.">            if (maxIcon != null) {</span>
<span class="nc" id="L252">                maxButton.setIcon(maxIcon);</span>
            }
<span class="nc bnc" id="L254" title="All 4 branches missed.">            if (maxButtonToolTip != null &amp;&amp; maxButtonToolTip.length() != 0) {</span>
<span class="nc" id="L255">                maxButton.setToolTipText(maxButtonToolTip);</span>
            }
        }
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (closeIcon != null) {</span>
<span class="nc" id="L259">            closeButton.setIcon(closeIcon);</span>
        }
<span class="nc" id="L261">    }</span>

    protected void assembleSystemMenu() {
<span class="nc" id="L264">        menuBar = createSystemMenuBar();</span>
<span class="nc" id="L265">        windowMenu = createSystemMenu();</span>
<span class="nc" id="L266">        menuBar.add(windowMenu);</span>
<span class="nc" id="L267">        addSystemMenuItems(windowMenu);</span>
<span class="nc" id="L268">        enableActions();</span>
<span class="nc" id="L269">    }</span>

    protected void addSystemMenuItems(JMenu systemMenu) {
<span class="nc" id="L272">        JMenuItem mi = systemMenu.add(restoreAction);</span>
<span class="nc" id="L273">        mi.setMnemonic(getButtonMnemonic(&quot;restore&quot;));</span>
<span class="nc" id="L274">        mi = systemMenu.add(moveAction);</span>
<span class="nc" id="L275">        mi.setMnemonic(getButtonMnemonic(&quot;move&quot;));</span>
<span class="nc" id="L276">        mi = systemMenu.add(sizeAction);</span>
<span class="nc" id="L277">        mi.setMnemonic(getButtonMnemonic(&quot;size&quot;));</span>
<span class="nc" id="L278">        mi = systemMenu.add(iconifyAction);</span>
<span class="nc" id="L279">        mi.setMnemonic(getButtonMnemonic(&quot;minimize&quot;));</span>
<span class="nc" id="L280">        mi = systemMenu.add(maximizeAction);</span>
<span class="nc" id="L281">        mi.setMnemonic(getButtonMnemonic(&quot;maximize&quot;));</span>
<span class="nc" id="L282">        systemMenu.add(new JSeparator());</span>
<span class="nc" id="L283">        mi = systemMenu.add(closeAction);</span>
<span class="nc" id="L284">        mi.setMnemonic(getButtonMnemonic(&quot;close&quot;));</span>
<span class="nc" id="L285">    }</span>

    private static int getButtonMnemonic(String button) {
        try {
<span class="nc" id="L289">            return Integer.parseInt(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.&quot; + button + &quot;Button.mnemonic&quot;));
<span class="nc" id="L291">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L292">            return -1;</span>
        }
    }

    protected JMenu createSystemMenu() {
<span class="nc" id="L297">        return new JMenu(&quot;    &quot;);</span>
    }

    protected JMenuBar createSystemMenuBar() {
<span class="nc" id="L301">        menuBar = new SystemMenuBar();</span>
<span class="nc" id="L302">        menuBar.setBorderPainted(false);</span>
<span class="nc" id="L303">        return menuBar;</span>
    }

    protected void showSystemMenu(){
        //      windowMenu.setPopupMenuVisible(true);
      //      windowMenu.setVisible(true);
<span class="nc" id="L309">      windowMenu.doClick();</span>
<span class="nc" id="L310">    }</span>

    public void paintComponent(Graphics g)  {
<span class="nc" id="L313">        paintTitleBackground(g);</span>

<span class="nc bnc" id="L315" title="All 2 branches missed.">        if(frame.getTitle() != null) {</span>
<span class="nc" id="L316">            boolean isSelected = frame.isSelected();</span>
<span class="nc" id="L317">            Font f = g.getFont();</span>
<span class="nc" id="L318">            g.setFont(getFont());</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">            if(isSelected)</span>
<span class="nc" id="L320">                g.setColor(selectedTextColor);</span>
            else
<span class="nc" id="L322">                g.setColor(notSelectedTextColor);</span>

            // Center text vertically.
<span class="nc" id="L325">            FontMetrics fm = SwingUtilities2.getFontMetrics(frame, g);</span>
<span class="nc" id="L326">            int baseline = (getHeight() + fm.getAscent() - fm.getLeading() -</span>
<span class="nc" id="L327">                    fm.getDescent()) / 2;</span>

            int titleX;
<span class="nc" id="L330">            Rectangle r = new Rectangle(0, 0, 0, 0);</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">            if (frame.isIconifiable())  r = iconButton.getBounds();</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">            else if (frame.isMaximizable())  r = maxButton.getBounds();</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">            else if (frame.isClosable())  r = closeButton.getBounds();</span>
            int titleW;

<span class="nc" id="L336">            String title = frame.getTitle();</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">            if( BasicGraphicsUtils.isLeftToRight(frame) ) {</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">              if (r.x == 0)  r.x = frame.getWidth()-frame.getInsets().right;</span>
<span class="nc" id="L339">              titleX = menuBar.getX() + menuBar.getWidth() + 2;</span>
<span class="nc" id="L340">              titleW = r.x - titleX - 3;</span>
<span class="nc" id="L341">              title = getTitle(frame.getTitle(), fm, titleW);</span>
            } else {
<span class="nc" id="L343">                titleX = menuBar.getX() - 2</span>
<span class="nc" id="L344">                         - SwingUtilities2.stringWidth(frame,fm,title);</span>
            }

<span class="nc" id="L347">            SwingUtilities2.drawString(frame, g, title, titleX, baseline);</span>
<span class="nc" id="L348">            g.setFont(f);</span>
        }
<span class="nc" id="L350">    }</span>

   /**
    * Invoked from paintComponent.
    * Paints the background of the titlepane.  All text and icons will
    * then be rendered on top of this background.
    * @param g the graphics to use to render the background
    * @since 1.4
    */
    protected void paintTitleBackground(Graphics g) {
<span class="nc" id="L360">        boolean isSelected = frame.isSelected();</span>

<span class="nc bnc" id="L362" title="All 2 branches missed.">        if(isSelected)</span>
<span class="nc" id="L363">            g.setColor(selectedTitleColor);</span>
        else
<span class="nc" id="L365">            g.setColor(notSelectedTitleColor);</span>
<span class="nc" id="L366">        g.fillRect(0, 0, getWidth(), getHeight());</span>
<span class="nc" id="L367">    }</span>

    protected String getTitle(String text, FontMetrics fm, int availTextWidth) {
<span class="nc" id="L370">        return SwingUtilities2.clipStringIfNecessary(</span>
                           frame, fm, text, availTextWidth);
      }

    /**
     * Post a WINDOW_CLOSING-like event to the frame, so that it can
     * be treated like a regular Frame.
     */
    protected void postClosingEvent(JInternalFrame frame) {
<span class="nc" id="L379">        InternalFrameEvent e = new InternalFrameEvent(</span>
            frame, InternalFrameEvent.INTERNAL_FRAME_CLOSING);
        // Try posting event, unless there's a SecurityManager.
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (JInternalFrame.class.getClassLoader() == null) {</span>
            try {
<span class="nc" id="L384">                Toolkit.getDefaultToolkit().getSystemEventQueue().postEvent(e);</span>
<span class="nc" id="L385">                return;</span>
<span class="nc" id="L386">            } catch (SecurityException se) {</span>
                // Use dispatchEvent instead.
            }
        }
<span class="nc" id="L390">        frame.dispatchEvent(e);</span>
<span class="nc" id="L391">    }</span>


    protected void enableActions() {
<span class="nc bnc" id="L395" title="All 4 branches missed.">        restoreAction.setEnabled(frame.isMaximum() || frame.isIcon());</span>
<span class="nc" id="L396">        maximizeAction.setEnabled(</span>
<span class="nc bnc" id="L397" title="All 6 branches missed.">            (frame.isMaximizable() &amp;&amp; !frame.isMaximum() &amp;&amp; !frame.isIcon()) ||</span>
<span class="nc bnc" id="L398" title="All 4 branches missed.">            (frame.isMaximizable() &amp;&amp; frame.isIcon()));</span>
<span class="nc bnc" id="L399" title="All 4 branches missed.">        iconifyAction.setEnabled(frame.isIconifiable() &amp;&amp; !frame.isIcon());</span>
<span class="nc" id="L400">        closeAction.setEnabled(frame.isClosable());</span>
<span class="nc" id="L401">        sizeAction.setEnabled(false);</span>
<span class="nc" id="L402">        moveAction.setEnabled(false);</span>
<span class="nc" id="L403">    }</span>

    private Handler getHandler() {
<span class="nc bnc" id="L406" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L407">            handler = new Handler();</span>
        }
<span class="nc" id="L409">        return handler;</span>
    }

    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L413">        return getHandler();</span>
    }

    protected LayoutManager createLayout() {
<span class="nc" id="L417">        return getHandler();</span>
    }


<span class="nc" id="L421">    private class Handler implements LayoutManager, PropertyChangeListener {</span>
        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L426">            String prop = evt.getPropertyName();</span>

<span class="nc bnc" id="L428" title="All 2 branches missed.">            if (prop == JInternalFrame.IS_SELECTED_PROPERTY) {</span>
<span class="nc" id="L429">                repaint();</span>
<span class="nc" id="L430">                return;</span>
            }

<span class="nc bnc" id="L433" title="All 4 branches missed.">            if (prop == JInternalFrame.IS_ICON_PROPERTY ||</span>
                    prop == JInternalFrame.IS_MAXIMUM_PROPERTY) {
<span class="nc" id="L435">                setButtonIcons();</span>
<span class="nc" id="L436">                enableActions();</span>
<span class="nc" id="L437">                return;</span>
            }

<span class="nc bnc" id="L440" title="All 2 branches missed.">            if (&quot;closable&quot; == prop) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                if (evt.getNewValue() == Boolean.TRUE) {</span>
<span class="nc" id="L442">                    add(closeButton);</span>
                } else {
<span class="nc" id="L444">                    remove(closeButton);</span>
                }
<span class="nc bnc" id="L446" title="All 2 branches missed.">            } else if (&quot;maximizable&quot; == prop) {</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">                if (evt.getNewValue() == Boolean.TRUE) {</span>
<span class="nc" id="L448">                    add(maxButton);</span>
                } else {
<span class="nc" id="L450">                    remove(maxButton);</span>
                }
<span class="nc bnc" id="L452" title="All 2 branches missed.">            } else if (&quot;iconable&quot; == prop) {</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">                if (evt.getNewValue() == Boolean.TRUE) {</span>
<span class="nc" id="L454">                    add(iconButton);</span>
                } else {
<span class="nc" id="L456">                    remove(iconButton);</span>
                }
            }
<span class="nc" id="L459">            enableActions();</span>

<span class="nc" id="L461">            revalidate();</span>
<span class="nc" id="L462">            repaint();</span>
<span class="nc" id="L463">        }</span>


        //
        // LayoutManager
        //
<span class="nc" id="L469">        public void addLayoutComponent(String name, Component c) {}</span>
<span class="nc" id="L470">        public void removeLayoutComponent(Component c) {}</span>
        public Dimension preferredLayoutSize(Container c) {
<span class="nc" id="L472">            return minimumLayoutSize(c);</span>
        }

        public Dimension minimumLayoutSize(Container c) {
            // Calculate width.
<span class="nc" id="L477">            int width = 22;</span>

<span class="nc bnc" id="L479" title="All 2 branches missed.">            if (frame.isClosable()) {</span>
<span class="nc" id="L480">                width += 19;</span>
            }
<span class="nc bnc" id="L482" title="All 2 branches missed.">            if (frame.isMaximizable()) {</span>
<span class="nc" id="L483">                width += 19;</span>
            }
<span class="nc bnc" id="L485" title="All 2 branches missed.">            if (frame.isIconifiable()) {</span>
<span class="nc" id="L486">                width += 19;</span>
            }

<span class="nc" id="L489">            FontMetrics fm = frame.getFontMetrics(getFont());</span>
<span class="nc" id="L490">            String frameTitle = frame.getTitle();</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">            int title_w = frameTitle != null ? SwingUtilities2.stringWidth(</span>
                               frame, fm, frameTitle) : 0;
<span class="nc bnc" id="L493" title="All 2 branches missed.">            int title_length = frameTitle != null ? frameTitle.length() : 0;</span>

            // Leave room for three characters in the title.
<span class="nc bnc" id="L496" title="All 2 branches missed.">            if (title_length &gt; 3) {</span>
<span class="nc" id="L497">                int subtitle_w = SwingUtilities2.stringWidth(</span>
<span class="nc" id="L498">                    frame, fm, frameTitle.substring(0, 3) + &quot;...&quot;);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">                width += (title_w &lt; subtitle_w) ? title_w : subtitle_w;</span>
<span class="nc" id="L500">            } else {</span>
<span class="nc" id="L501">                width += title_w;</span>
            }

            // Calculate height.
<span class="nc" id="L505">            Icon icon = frame.getFrameIcon();</span>
<span class="nc" id="L506">            int fontHeight = fm.getHeight();</span>
<span class="nc" id="L507">            fontHeight += 2;</span>
<span class="nc" id="L508">            int iconHeight = 0;</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">            if (icon != null) {</span>
                // SystemMenuBar forces the icon to be 16x16 or less.
<span class="nc" id="L511">                iconHeight = Math.min(icon.getIconHeight(), 16);</span>
            }
<span class="nc" id="L513">            iconHeight += 2;</span>

<span class="nc" id="L515">            int height = Math.max( fontHeight, iconHeight );</span>

<span class="nc" id="L517">            Dimension dim = new Dimension(width, height);</span>

            // Take into account the border insets if any.
<span class="nc bnc" id="L520" title="All 2 branches missed.">            if (getBorder() != null) {</span>
<span class="nc" id="L521">                Insets insets = getBorder().getBorderInsets(c);</span>
<span class="nc" id="L522">                dim.height += insets.top + insets.bottom;</span>
<span class="nc" id="L523">                dim.width += insets.left + insets.right;</span>
            }
<span class="nc" id="L525">            return dim;</span>
        }

        public void layoutContainer(Container c) {
<span class="nc" id="L529">            boolean leftToRight = BasicGraphicsUtils.isLeftToRight(frame);</span>

<span class="nc" id="L531">            int w = getWidth();</span>
<span class="nc" id="L532">            int h = getHeight();</span>
            int x;

<span class="nc" id="L535">            int buttonHeight = closeButton.getIcon().getIconHeight();</span>

<span class="nc" id="L537">            Icon icon = frame.getFrameIcon();</span>
<span class="nc" id="L538">            int iconHeight = 0;</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">            if (icon != null) {</span>
<span class="nc" id="L540">                iconHeight = icon.getIconHeight();</span>
            }
<span class="nc bnc" id="L542" title="All 2 branches missed.">            x = (leftToRight) ? 2 : w - 16 - 2;</span>
<span class="nc" id="L543">            menuBar.setBounds(x, (h - iconHeight) / 2, 16, 16);</span>

<span class="nc bnc" id="L545" title="All 2 branches missed.">            x = (leftToRight) ? w - 16 - 2 : 2;</span>

<span class="nc bnc" id="L547" title="All 2 branches missed.">            if (frame.isClosable()) {</span>
<span class="nc" id="L548">                closeButton.setBounds(x, (h - buttonHeight) / 2, 16, 14);</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">                x += (leftToRight) ? -(16 + 2) : 16 + 2;</span>
            }

<span class="nc bnc" id="L552" title="All 2 branches missed.">            if (frame.isMaximizable()) {</span>
<span class="nc" id="L553">                maxButton.setBounds(x, (h - buttonHeight) / 2, 16, 14);</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">                x += (leftToRight) ? -(16 + 2) : 16 + 2;</span>
            }

<span class="nc bnc" id="L557" title="All 2 branches missed.">            if (frame.isIconifiable()) {</span>
<span class="nc" id="L558">                iconButton.setBounds(x, (h - buttonHeight) / 2, 16, 14);</span>
            }
<span class="nc" id="L560">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
<span class="nc" id="L567">    public class PropertyChangeHandler implements PropertyChangeListener {</span>
        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.
        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L573">            getHandler().propertyChange(evt);</span>
<span class="nc" id="L574">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
<span class="nc" id="L581">    public class TitlePaneLayout implements LayoutManager {</span>
        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.
        public void addLayoutComponent(String name, Component c) {
<span class="nc" id="L587">            getHandler().addLayoutComponent(name, c);</span>
<span class="nc" id="L588">        }</span>

        public void removeLayoutComponent(Component c) {
<span class="nc" id="L591">            getHandler().removeLayoutComponent(c);</span>
<span class="nc" id="L592">        }</span>

        public Dimension preferredLayoutSize(Container c)  {
<span class="nc" id="L595">            return getHandler().preferredLayoutSize(c);</span>
        }

        public Dimension minimumLayoutSize(Container c) {
<span class="nc" id="L599">            return getHandler().minimumLayoutSize(c);</span>
        }

        public void layoutContainer(Container c) {
<span class="nc" id="L603">            getHandler().layoutContainer(c);</span>
<span class="nc" id="L604">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
    public class CloseAction extends AbstractAction {
<span class="nc" id="L612">        public CloseAction() {</span>
<span class="nc" id="L613">            super(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.closeButtonText&quot;));
<span class="nc" id="L615">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L618" title="All 2 branches missed.">            if(frame.isClosable()) {</span>
<span class="nc" id="L619">                frame.doDefaultCloseAction();</span>
            }
<span class="nc" id="L621">        }</span>
    } // end CloseAction

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
    public class MaximizeAction extends AbstractAction {
<span class="nc" id="L629">        public MaximizeAction() {</span>
<span class="nc" id="L630">            super(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.maximizeButtonText&quot;));
<span class="nc" id="L632">        }</span>

        public void actionPerformed(ActionEvent evt) {
<span class="nc bnc" id="L635" title="All 2 branches missed.">            if (frame.isMaximizable()) {</span>
<span class="nc bnc" id="L636" title="All 4 branches missed.">                if (frame.isMaximum() &amp;&amp; frame.isIcon()) {</span>
                    try {
<span class="nc" id="L638">                        frame.setIcon(false);</span>
<span class="nc" id="L639">                    } catch (PropertyVetoException e) { }</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">                } else if (!frame.isMaximum()) {</span>
                    try {
<span class="nc" id="L642">                        frame.setMaximum(true);</span>
<span class="nc" id="L643">                    } catch (PropertyVetoException e) { }</span>
                } else {
                    try {
<span class="nc" id="L646">                        frame.setMaximum(false);</span>
<span class="nc" id="L647">                    } catch (PropertyVetoException e) { }</span>
                }
            }
<span class="nc" id="L650">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
    public class IconifyAction extends AbstractAction {
<span class="nc" id="L658">        public IconifyAction() {</span>
<span class="nc" id="L659">            super(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.minimizeButtonText&quot;));
<span class="nc" id="L661">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L664" title="All 2 branches missed.">            if(frame.isIconifiable()) {</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">              if(!frame.isIcon()) {</span>
<span class="nc" id="L666">                try { frame.setIcon(true); } catch (PropertyVetoException e1) { }</span>
              } else{
<span class="nc" id="L668">                try { frame.setIcon(false); } catch (PropertyVetoException e1) { }</span>
              }
            }
<span class="nc" id="L671">        }</span>
    } // end IconifyAction

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
    public class RestoreAction extends AbstractAction {
<span class="nc" id="L679">        public RestoreAction() {</span>
<span class="nc" id="L680">            super(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.restoreButtonText&quot;));
<span class="nc" id="L682">        }</span>

        public void actionPerformed(ActionEvent evt) {
<span class="nc bnc" id="L685" title="All 6 branches missed.">            if (frame.isMaximizable() &amp;&amp; frame.isMaximum() &amp;&amp; frame.isIcon()) {</span>
                try {
<span class="nc" id="L687">                    frame.setIcon(false);</span>
<span class="nc" id="L688">                } catch (PropertyVetoException e) { }</span>
<span class="nc bnc" id="L689" title="All 4 branches missed.">            } else if (frame.isMaximizable() &amp;&amp; frame.isMaximum()) {</span>
                try {
<span class="nc" id="L691">                    frame.setMaximum(false);</span>
<span class="nc" id="L692">                } catch (PropertyVetoException e) { }</span>
<span class="nc bnc" id="L693" title="All 4 branches missed.">            } else if (frame.isIconifiable() &amp;&amp; frame.isIcon()) {</span>
                try {
<span class="nc" id="L695">                    frame.setIcon(false);</span>
<span class="nc" id="L696">                } catch (PropertyVetoException e) { }</span>
            }
<span class="nc" id="L698">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
    public class MoveAction extends AbstractAction {
<span class="nc" id="L706">        public MoveAction() {</span>
<span class="nc" id="L707">            super(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.moveButtonText&quot;));
<span class="nc" id="L709">        }</span>

        public void actionPerformed(ActionEvent e) {
            // This action is currently undefined
<span class="nc" id="L713">        }</span>
    } // end MoveAction

    /*
     * Handles showing and hiding the system menu.
     */
    private class ShowSystemMenuAction extends AbstractAction {
        private boolean show;   // whether to show the menu

<span class="nc" id="L722">        public ShowSystemMenuAction(boolean show) {</span>
<span class="nc" id="L723">            this.show = show;</span>
<span class="nc" id="L724">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L727" title="All 2 branches missed.">            if (show) {</span>
<span class="nc" id="L728">                windowMenu.doClick();</span>
            } else {
<span class="nc" id="L730">                windowMenu.setVisible(false);</span>
            }
<span class="nc" id="L732">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
    public class SizeAction extends AbstractAction {
<span class="nc" id="L740">        public SizeAction() {</span>
<span class="nc" id="L741">            super(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.sizeButtonText&quot;));
<span class="nc" id="L743">        }</span>

        public void actionPerformed(ActionEvent e) {
            // This action is currently undefined
<span class="nc" id="L747">        }</span>
    } // end SizeAction


    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;code&gt;JDK&lt;/code&gt;.
     */
<span class="nc" id="L755">    public class SystemMenuBar extends JMenuBar {</span>
<span class="nc" id="L756">        public boolean isFocusTraversable() { return false; }</span>
<span class="nc" id="L757">        public void requestFocus() {}</span>
        public void paint(Graphics g) {
<span class="nc" id="L759">            Icon icon = frame.getFrameIcon();</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">            if (icon == null) {</span>
<span class="nc" id="L761">              icon = (Icon)DefaultLookup.get(frame, frame.getUI(),</span>
                      &quot;InternalFrame.icon&quot;);
            }
<span class="nc bnc" id="L764" title="All 2 branches missed.">            if (icon != null) {</span>
                // Resize to 16x16 if necessary.
<span class="nc bnc" id="L766" title="All 6 branches missed.">                if (icon instanceof ImageIcon &amp;&amp; (icon.getIconWidth() &gt; 16 || icon.getIconHeight() &gt; 16)) {</span>
<span class="nc" id="L767">                    Image img = ((ImageIcon)icon).getImage();</span>
<span class="nc" id="L768">                    ((ImageIcon)icon).setImage(img.getScaledInstance(16, 16, Image.SCALE_SMOOTH));</span>
                }
<span class="nc" id="L770">                icon.paintIcon(this, g, 0, 0);</span>
            }
<span class="nc" id="L772">        }</span>

        public boolean isOpaque() {
<span class="nc" id="L775">            return true;</span>
        }
    } // end SystemMenuBar


    private class NoFocusButton extends JButton {
        private String uiKey;
<span class="nc" id="L782">        public NoFocusButton(String uiKey, String opacityKey) {</span>
<span class="nc" id="L783">            setFocusPainted(false);</span>
<span class="nc" id="L784">            setMargin(new Insets(0,0,0,0));</span>
<span class="nc" id="L785">            this.uiKey = uiKey;</span>

<span class="nc" id="L787">            Object opacity = UIManager.get(opacityKey);</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">            if (opacity instanceof Boolean) {</span>
<span class="nc" id="L789">                setOpaque(((Boolean)opacity).booleanValue());</span>
            }
<span class="nc" id="L791">        }</span>
<span class="nc" id="L792">        public boolean isFocusTraversable() { return false; }</span>
<span class="nc" id="L793">        public void requestFocus() {}</span>
        public AccessibleContext getAccessibleContext() {
<span class="nc" id="L795">            AccessibleContext ac = super.getAccessibleContext();</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">            if (uiKey != null) {</span>
<span class="nc" id="L797">                ac.setAccessibleName(UIManager.getString(uiKey));</span>
<span class="nc" id="L798">                uiKey = null;</span>
            }
<span class="nc" id="L800">            return ac;</span>
        }
    }  // end NoFocusButton

}   // End Title Pane Class
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>