<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BasicListUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicListUI.java</span></div><h1>BasicListUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2007, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import sun.swing.DefaultLookup;
import sun.swing.UIAction;

import javax.swing.*;
import javax.swing.event.*;
import javax.swing.plaf.*;
import javax.swing.text.Position;

import java.awt.*;
import java.awt.event.*;
import java.awt.datatransfer.Transferable;
import java.awt.geom.Point2D;

import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeEvent;

import sun.swing.SwingUtilities2;
import javax.swing.plaf.basic.DragRecognitionSupport.BeforeDrag;

/**
 * An extensible implementation of {@code ListUI}.
 * &lt;p&gt;
 * {@code BasicListUI} instances cannot be shared between multiple
 * lists.
 *
 * @author Hans Muller
 * @author Philip Milne
 * @author Shannon Hickey (drag and drop)
 */
<span class="nc" id="L57">public class BasicListUI extends ListUI</span>
{
<span class="nc" id="L59">    private static final StringBuilder BASELINE_COMPONENT_KEY =</span>
        new StringBuilder(&quot;List.baselineComponent&quot;);

<span class="nc" id="L62">    protected JList list = null;</span>
    protected CellRendererPane rendererPane;

    // Listeners that this UI attaches to the JList
    protected FocusListener focusListener;
    protected MouseInputListener mouseInputListener;
    protected ListSelectionListener listSelectionListener;
    protected ListDataListener listDataListener;
    protected PropertyChangeListener propertyChangeListener;
    private Handler handler;

<span class="nc" id="L73">    protected int[] cellHeights = null;</span>
<span class="nc" id="L74">    protected int cellHeight = -1;</span>
<span class="nc" id="L75">    protected int cellWidth = -1;</span>
<span class="nc" id="L76">    protected int updateLayoutStateNeeded = modelChanged;</span>
    /**
     * Height of the list. When asked to paint, if the current size of
     * the list differs, this will update the layout state.
     */
    private int listHeight;

    /**
     * Width of the list. When asked to paint, if the current size of
     * the list differs, this will update the layout state.
     */
    private int listWidth;

    /**
     * The layout orientation of the list.
     */
    private int layoutOrientation;

    // Following ivars are used if the list is laying out horizontally

    /**
     * Number of columns to create.
     */
    private int columnCount;
    /**
     * Preferred height to make the list, this is only used if the
     * the list is layed out horizontally.
     */
    private int preferredHeight;
    /**
     * Number of rows per column. This is only used if the row height is
     * fixed.
     */
    private int rowsPerColumn;

    /**
     * The time factor to treate the series of typed alphanumeric key
     * as prefix for first letter navigation.
     */
<span class="nc" id="L115">    private long timeFactor = 1000L;</span>

    /**
     * Local cache of JList's client property &quot;List.isFileList&quot;
     */
<span class="nc" id="L120">    private boolean isFileList = false;</span>

    /**
     * Local cache of JList's component orientation property
     */
<span class="nc" id="L125">    private boolean isLeftToRight = true;</span>

    /* The bits below define JList property changes that affect layout.
     * When one of these properties changes we set a bit in
     * updateLayoutStateNeeded.  The change is dealt with lazily, see
     * maybeUpdateLayoutState.  Changes to the JLists model, e.g. the
     * models length changed, are handled similarly, see DataListener.
     */

    protected final static int modelChanged = 1 &lt;&lt; 0;
    protected final static int selectionModelChanged = 1 &lt;&lt; 1;
    protected final static int fontChanged = 1 &lt;&lt; 2;
    protected final static int fixedCellWidthChanged = 1 &lt;&lt; 3;
    protected final static int fixedCellHeightChanged = 1 &lt;&lt; 4;
    protected final static int prototypeCellValueChanged = 1 &lt;&lt; 5;
    protected final static int cellRendererChanged = 1 &lt;&lt; 6;
    private final static int layoutOrientationChanged = 1 &lt;&lt; 7;
    private final static int heightChanged = 1 &lt;&lt; 8;
    private final static int widthChanged = 1 &lt;&lt; 9;
    private final static int componentOrientationChanged = 1 &lt;&lt; 10;

    private static final int DROP_LINE_THICKNESS = 2;

    static void loadActionMap(LazyActionMap map) {
<span class="nc" id="L149">        map.put(new Actions(Actions.SELECT_PREVIOUS_COLUMN));</span>
<span class="nc" id="L150">        map.put(new Actions(Actions.SELECT_PREVIOUS_COLUMN_EXTEND));</span>
<span class="nc" id="L151">        map.put(new Actions(Actions.SELECT_PREVIOUS_COLUMN_CHANGE_LEAD));</span>
<span class="nc" id="L152">        map.put(new Actions(Actions.SELECT_NEXT_COLUMN));</span>
<span class="nc" id="L153">        map.put(new Actions(Actions.SELECT_NEXT_COLUMN_EXTEND));</span>
<span class="nc" id="L154">        map.put(new Actions(Actions.SELECT_NEXT_COLUMN_CHANGE_LEAD));</span>
<span class="nc" id="L155">        map.put(new Actions(Actions.SELECT_PREVIOUS_ROW));</span>
<span class="nc" id="L156">        map.put(new Actions(Actions.SELECT_PREVIOUS_ROW_EXTEND));</span>
<span class="nc" id="L157">        map.put(new Actions(Actions.SELECT_PREVIOUS_ROW_CHANGE_LEAD));</span>
<span class="nc" id="L158">        map.put(new Actions(Actions.SELECT_NEXT_ROW));</span>
<span class="nc" id="L159">        map.put(new Actions(Actions.SELECT_NEXT_ROW_EXTEND));</span>
<span class="nc" id="L160">        map.put(new Actions(Actions.SELECT_NEXT_ROW_CHANGE_LEAD));</span>
<span class="nc" id="L161">        map.put(new Actions(Actions.SELECT_FIRST_ROW));</span>
<span class="nc" id="L162">        map.put(new Actions(Actions.SELECT_FIRST_ROW_EXTEND));</span>
<span class="nc" id="L163">        map.put(new Actions(Actions.SELECT_FIRST_ROW_CHANGE_LEAD));</span>
<span class="nc" id="L164">        map.put(new Actions(Actions.SELECT_LAST_ROW));</span>
<span class="nc" id="L165">        map.put(new Actions(Actions.SELECT_LAST_ROW_EXTEND));</span>
<span class="nc" id="L166">        map.put(new Actions(Actions.SELECT_LAST_ROW_CHANGE_LEAD));</span>
<span class="nc" id="L167">        map.put(new Actions(Actions.SCROLL_UP));</span>
<span class="nc" id="L168">        map.put(new Actions(Actions.SCROLL_UP_EXTEND));</span>
<span class="nc" id="L169">        map.put(new Actions(Actions.SCROLL_UP_CHANGE_LEAD));</span>
<span class="nc" id="L170">        map.put(new Actions(Actions.SCROLL_DOWN));</span>
<span class="nc" id="L171">        map.put(new Actions(Actions.SCROLL_DOWN_EXTEND));</span>
<span class="nc" id="L172">        map.put(new Actions(Actions.SCROLL_DOWN_CHANGE_LEAD));</span>
<span class="nc" id="L173">        map.put(new Actions(Actions.SELECT_ALL));</span>
<span class="nc" id="L174">        map.put(new Actions(Actions.CLEAR_SELECTION));</span>
<span class="nc" id="L175">        map.put(new Actions(Actions.ADD_TO_SELECTION));</span>
<span class="nc" id="L176">        map.put(new Actions(Actions.TOGGLE_AND_ANCHOR));</span>
<span class="nc" id="L177">        map.put(new Actions(Actions.EXTEND_TO));</span>
<span class="nc" id="L178">        map.put(new Actions(Actions.MOVE_SELECTION_TO));</span>

<span class="nc" id="L180">        map.put(TransferHandler.getCutAction().getValue(Action.NAME),</span>
<span class="nc" id="L181">                TransferHandler.getCutAction());</span>
<span class="nc" id="L182">        map.put(TransferHandler.getCopyAction().getValue(Action.NAME),</span>
<span class="nc" id="L183">                TransferHandler.getCopyAction());</span>
<span class="nc" id="L184">        map.put(TransferHandler.getPasteAction().getValue(Action.NAME),</span>
<span class="nc" id="L185">                TransferHandler.getPasteAction());</span>
<span class="nc" id="L186">    }</span>

    /**
     * Paint one List cell: compute the relevant state, get the &quot;rubber stamp&quot;
     * cell renderer component, and then use the CellRendererPane to paint it.
     * Subclasses may want to override this method rather than paint().
     *
     * @see #paint
     */
    protected void paintCell(
        Graphics g,
        int row,
        Rectangle rowBounds,
        ListCellRenderer cellRenderer,
        ListModel dataModel,
        ListSelectionModel selModel,
        int leadIndex)
    {
<span class="nc" id="L204">        Object value = dataModel.getElementAt(row);</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">        boolean cellHasFocus = list.hasFocus() &amp;&amp; (row == leadIndex);</span>
<span class="nc" id="L206">        boolean isSelected = selModel.isSelectedIndex(row);</span>

<span class="nc" id="L208">        Component rendererComponent =</span>
<span class="nc" id="L209">            cellRenderer.getListCellRendererComponent(list, value, row, isSelected, cellHasFocus);</span>

<span class="nc" id="L211">        int cx = rowBounds.x;</span>
<span class="nc" id="L212">        int cy = rowBounds.y;</span>
<span class="nc" id="L213">        int cw = rowBounds.width;</span>
<span class="nc" id="L214">        int ch = rowBounds.height;</span>

<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (isFileList) {</span>
            // Shrink renderer to preferred size. This is mostly used on Windows
            // where selection is only shown around the file name, instead of
            // across the whole list cell.
<span class="nc" id="L220">            int w = Math.min(cw, rendererComponent.getPreferredSize().width + 4);</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">            if (!isLeftToRight) {</span>
<span class="nc" id="L222">                cx += (cw - w);</span>
            }
<span class="nc" id="L224">            cw = w;</span>
        }

<span class="nc" id="L227">        rendererPane.paintComponent(g, rendererComponent, list, cx, cy, cw, ch, true);</span>
<span class="nc" id="L228">    }</span>


    /**
     * Paint the rows that intersect the Graphics objects clipRect.  This
     * method calls paintCell as necessary.  Subclasses
     * may want to override these methods.
     *
     * @see #paintCell
     */
    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L239">        Shape clip = g.getClip();</span>
<span class="nc" id="L240">        paintImpl(g, c);</span>
<span class="nc" id="L241">        g.setClip(clip);</span>

<span class="nc" id="L243">        paintDropLine(g);</span>
<span class="nc" id="L244">    }</span>

    private void paintImpl(Graphics g, JComponent c)
    {
<span class="nc bnc" id="L248" title="All 3 branches missed.">        switch (layoutOrientation) {</span>
        case JList.VERTICAL_WRAP:
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if (list.getHeight() != listHeight) {</span>
<span class="nc" id="L251">                updateLayoutStateNeeded |= heightChanged;</span>
<span class="nc" id="L252">                redrawList();</span>
            }
            break;
        case JList.HORIZONTAL_WRAP:
<span class="nc bnc" id="L256" title="All 2 branches missed.">            if (list.getWidth() != listWidth) {</span>
<span class="nc" id="L257">                updateLayoutStateNeeded |= widthChanged;</span>
<span class="nc" id="L258">                redrawList();</span>
            }
            break;
        default:
            break;
        }
<span class="nc" id="L264">        maybeUpdateLayoutState();</span>

<span class="nc" id="L266">        ListCellRenderer renderer = list.getCellRenderer();</span>
<span class="nc" id="L267">        ListModel dataModel = list.getModel();</span>
<span class="nc" id="L268">        ListSelectionModel selModel = list.getSelectionModel();</span>
        int size;

<span class="nc bnc" id="L271" title="All 4 branches missed.">        if ((renderer == null) || (size = dataModel.getSize()) == 0) {</span>
<span class="nc" id="L272">            return;</span>
        }

        // Determine how many columns we need to paint
<span class="nc" id="L276">        Rectangle paintBounds = g.getClipBounds();</span>

        int startColumn, endColumn;
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (c.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L280">            startColumn = convertLocationToColumn(paintBounds.x,</span>
                                                  paintBounds.y);
<span class="nc" id="L282">            endColumn = convertLocationToColumn(paintBounds.x +</span>
                                                paintBounds.width,
                                                paintBounds.y);
        } else {
<span class="nc" id="L286">            startColumn = convertLocationToColumn(paintBounds.x +</span>
                                                paintBounds.width,
                                                paintBounds.y);
<span class="nc" id="L289">            endColumn = convertLocationToColumn(paintBounds.x,</span>
                                                  paintBounds.y);
        }
<span class="nc" id="L292">        int maxY = paintBounds.y + paintBounds.height;</span>
<span class="nc" id="L293">        int leadIndex = adjustIndex(list.getLeadSelectionIndex(), list);</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        int rowIncrement = (layoutOrientation == JList.HORIZONTAL_WRAP) ?</span>
                           columnCount : 1;


<span class="nc bnc" id="L298" title="All 2 branches missed.">        for (int colCounter = startColumn; colCounter &lt;= endColumn;</span>
<span class="nc" id="L299">             colCounter++) {</span>
            // And then how many rows in this columnn
<span class="nc" id="L301">            int row = convertLocationToRowInColumn(paintBounds.y, colCounter);</span>
<span class="nc" id="L302">            int rowCount = getRowCount(colCounter);</span>
<span class="nc" id="L303">            int index = getModelIndex(colCounter, row);</span>
<span class="nc" id="L304">            Rectangle rowBounds = getCellBounds(list, index, index);</span>

<span class="nc bnc" id="L306" title="All 2 branches missed.">            if (rowBounds == null) {</span>
                // Not valid, bail!
<span class="nc" id="L308">                return;</span>
            }
<span class="nc bnc" id="L310" title="All 6 branches missed.">            while (row &lt; rowCount &amp;&amp; rowBounds.y &lt; maxY &amp;&amp;</span>
                   index &lt; size) {
<span class="nc" id="L312">                rowBounds.height = getHeight(colCounter, row);</span>
<span class="nc" id="L313">                g.setClip(rowBounds.x, rowBounds.y, rowBounds.width,</span>
                          rowBounds.height);
<span class="nc" id="L315">                g.clipRect(paintBounds.x, paintBounds.y, paintBounds.width,</span>
                           paintBounds.height);
<span class="nc" id="L317">                paintCell(g, index, rowBounds, renderer, dataModel, selModel,</span>
                          leadIndex);
<span class="nc" id="L319">                rowBounds.y += rowBounds.height;</span>
<span class="nc" id="L320">                index += rowIncrement;</span>
<span class="nc" id="L321">                row++;</span>
            }
        }
        // Empty out the renderer pane, allowing renderers to be gc'ed.
<span class="nc" id="L325">        rendererPane.removeAll();</span>
<span class="nc" id="L326">    }</span>

    private void paintDropLine(Graphics g) {
<span class="nc" id="L329">        JList.DropLocation loc = list.getDropLocation();</span>
<span class="nc bnc" id="L330" title="All 4 branches missed.">        if (loc == null || !loc.isInsert()) {</span>
<span class="nc" id="L331">            return;</span>
        }

<span class="nc" id="L334">        Color c = DefaultLookup.getColor(list, this, &quot;List.dropLineColor&quot;, null);</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (c != null) {</span>
<span class="nc" id="L336">            g.setColor(c);</span>
<span class="nc" id="L337">            Rectangle rect = getDropLineRect(loc);</span>
<span class="nc" id="L338">            g.fillRect(rect.x, rect.y, rect.width, rect.height);</span>
        }
<span class="nc" id="L340">    }</span>

    private Rectangle getDropLineRect(JList.DropLocation loc) {
<span class="nc" id="L343">        int size = list.getModel().getSize();</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">        if (size == 0) {</span>
<span class="nc" id="L346">            Insets insets = list.getInsets();</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">            if (layoutOrientation == JList.HORIZONTAL_WRAP) {</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">                if (isLeftToRight) {</span>
<span class="nc" id="L349">                    return new Rectangle(insets.left, insets.top, DROP_LINE_THICKNESS, 20);</span>
                } else {
<span class="nc" id="L351">                    return new Rectangle(list.getWidth() - DROP_LINE_THICKNESS - insets.right,</span>
                                         insets.top, DROP_LINE_THICKNESS, 20);
                }
            } else {
<span class="nc" id="L355">                return new Rectangle(insets.left, insets.top,</span>
<span class="nc" id="L356">                                     list.getWidth() - insets.left - insets.right,</span>
                                     DROP_LINE_THICKNESS);
            }
        }

<span class="nc" id="L361">        Rectangle rect = null;</span>
<span class="nc" id="L362">        int index = loc.getIndex();</span>
<span class="nc" id="L363">        boolean decr = false;</span>

<span class="nc bnc" id="L365" title="All 2 branches missed.">        if (layoutOrientation == JList.HORIZONTAL_WRAP) {</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">            if (index == size) {</span>
<span class="nc" id="L367">                decr = true;</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">            } else if (index != 0 &amp;&amp; convertModelToRow(index)</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                                         != convertModelToRow(index - 1)) {</span>

<span class="nc" id="L371">                Rectangle prev = getCellBounds(list, index - 1);</span>
<span class="nc" id="L372">                Rectangle me = getCellBounds(list, index);</span>
<span class="nc" id="L373">                Point p = loc.getDropPoint();</span>

<span class="nc bnc" id="L375" title="All 2 branches missed.">                if (isLeftToRight) {</span>
<span class="nc" id="L376">                    decr = Point2D.distance(prev.x + prev.width,</span>
                                            prev.y + (int)(prev.height / 2.0),
                                            p.x, p.y)
<span class="nc bnc" id="L379" title="All 2 branches missed.">                           &lt; Point2D.distance(me.x,</span>
                                              me.y + (int)(me.height / 2.0),
                                              p.x, p.y);
                } else {
<span class="nc" id="L383">                    decr = Point2D.distance(prev.x,</span>
                                            prev.y + (int)(prev.height / 2.0),
                                            p.x, p.y)
<span class="nc bnc" id="L386" title="All 2 branches missed.">                           &lt; Point2D.distance(me.x + me.width,</span>
                                              me.y + (int)(prev.height / 2.0),
                                              p.x, p.y);
                }
            }

<span class="nc bnc" id="L392" title="All 2 branches missed.">            if (decr) {</span>
<span class="nc" id="L393">                index--;</span>
<span class="nc" id="L394">                rect = getCellBounds(list, index);</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (isLeftToRight) {</span>
<span class="nc" id="L396">                    rect.x += rect.width;</span>
                } else {
<span class="nc" id="L398">                    rect.x -= DROP_LINE_THICKNESS;</span>
                }
            } else {
<span class="nc" id="L401">                rect = getCellBounds(list, index);</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">                if (!isLeftToRight) {</span>
<span class="nc" id="L403">                    rect.x += rect.width - DROP_LINE_THICKNESS;</span>
                }
            }

<span class="nc bnc" id="L407" title="All 2 branches missed.">            if (rect.x &gt;= list.getWidth()) {</span>
<span class="nc" id="L408">                rect.x = list.getWidth() - DROP_LINE_THICKNESS;</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            } else if (rect.x &lt; 0) {</span>
<span class="nc" id="L410">                rect.x = 0;</span>
            }

<span class="nc" id="L413">            rect.width = DROP_LINE_THICKNESS;</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">        } else if (layoutOrientation == JList.VERTICAL_WRAP) {</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">            if (index == size) {</span>
<span class="nc" id="L416">                index--;</span>
<span class="nc" id="L417">                rect = getCellBounds(list, index);</span>
<span class="nc" id="L418">                rect.y += rect.height;</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">            } else if (index != 0 &amp;&amp; convertModelToColumn(index)</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">                                         != convertModelToColumn(index - 1)) {</span>

<span class="nc" id="L422">                Rectangle prev = getCellBounds(list, index - 1);</span>
<span class="nc" id="L423">                Rectangle me = getCellBounds(list, index);</span>
<span class="nc" id="L424">                Point p = loc.getDropPoint();</span>
<span class="nc" id="L425">                if (Point2D.distance(prev.x + (int)(prev.width / 2.0),</span>
                                     prev.y + prev.height,
                                     p.x, p.y)
<span class="nc bnc" id="L428" title="All 2 branches missed.">                        &lt; Point2D.distance(me.x + (int)(me.width / 2.0),</span>
                                           me.y,
                                           p.x, p.y)) {

<span class="nc" id="L432">                    index--;</span>
<span class="nc" id="L433">                    rect = getCellBounds(list, index);</span>
<span class="nc" id="L434">                    rect.y += rect.height;</span>
                } else {
<span class="nc" id="L436">                    rect = getCellBounds(list, index);</span>
                }
<span class="nc" id="L438">            } else {</span>
<span class="nc" id="L439">                rect = getCellBounds(list, index);</span>
            }

<span class="nc bnc" id="L442" title="All 2 branches missed.">            if (rect.y &gt;= list.getHeight()) {</span>
<span class="nc" id="L443">                rect.y = list.getHeight() - DROP_LINE_THICKNESS;</span>
            }

<span class="nc" id="L446">            rect.height = DROP_LINE_THICKNESS;</span>
        } else {
<span class="nc bnc" id="L448" title="All 2 branches missed.">            if (index == size) {</span>
<span class="nc" id="L449">                index--;</span>
<span class="nc" id="L450">                rect = getCellBounds(list, index);</span>
<span class="nc" id="L451">                rect.y += rect.height;</span>
            } else {
<span class="nc" id="L453">                rect = getCellBounds(list, index);</span>
            }

<span class="nc bnc" id="L456" title="All 2 branches missed.">            if (rect.y &gt;= list.getHeight()) {</span>
<span class="nc" id="L457">                rect.y = list.getHeight() - DROP_LINE_THICKNESS;</span>
            }

<span class="nc" id="L460">            rect.height = DROP_LINE_THICKNESS;</span>
        }

<span class="nc" id="L463">        return rect;</span>
    }

    /**
     * Returns the baseline.
     *
     * @throws NullPointerException {@inheritDoc}
     * @throws IllegalArgumentException {@inheritDoc}
     * @see javax.swing.JComponent#getBaseline(int, int)
     * @since 1.6
     */
    public int getBaseline(JComponent c, int width, int height) {
<span class="nc" id="L475">        super.getBaseline(c, width, height);</span>
<span class="nc" id="L476">        int rowHeight = list.getFixedCellHeight();</span>
<span class="nc" id="L477">        UIDefaults lafDefaults = UIManager.getLookAndFeelDefaults();</span>
<span class="nc" id="L478">        Component renderer = (Component)lafDefaults.get(</span>
                BASELINE_COMPONENT_KEY);
<span class="nc bnc" id="L480" title="All 2 branches missed.">        if (renderer == null) {</span>
<span class="nc" id="L481">            ListCellRenderer lcr = (ListCellRenderer)UIManager.get(</span>
                    &quot;List.cellRenderer&quot;);

            // fix for 6711072 some LAFs like Nimbus do not provide this
            // UIManager key and we should not through a NPE here because of it
<span class="nc bnc" id="L486" title="All 2 branches missed.">            if (lcr == null) {</span>
<span class="nc" id="L487">                lcr = new DefaultListCellRenderer();</span>
            }
<span class="nc" id="L489">            renderer = lcr.getListCellRendererComponent(</span>
                    list, &quot;a&quot;, -1, false, false);
<span class="nc" id="L491">            lafDefaults.put(BASELINE_COMPONENT_KEY, renderer);</span>
        }
<span class="nc" id="L493">        renderer.setFont(list.getFont());</span>
        // JList actually has much more complex behavior here.
        // If rowHeight != -1 the rowHeight is either the max of all cell
        // heights (layout orientation != VERTICAL), or is variable depending
        // upon the cell.  We assume a default size.
        // We could theoretically query the real renderer, but that would
        // not work for an empty model and the results may vary with
        // the content.
<span class="nc bnc" id="L501" title="All 2 branches missed.">        if (rowHeight == -1) {</span>
<span class="nc" id="L502">            rowHeight = renderer.getPreferredSize().height;</span>
        }
<span class="nc" id="L504">        return renderer.getBaseline(Integer.MAX_VALUE, rowHeight) +</span>
<span class="nc" id="L505">                list.getInsets().top;</span>
    }

    /**
     * Returns an enum indicating how the baseline of the component
     * changes as the size changes.
     *
     * @throws NullPointerException {@inheritDoc}
     * @see javax.swing.JComponent#getBaseline(int, int)
     * @since 1.6
     */
    public Component.BaselineResizeBehavior getBaselineResizeBehavior(
            JComponent c) {
<span class="nc" id="L518">        super.getBaselineResizeBehavior(c);</span>
<span class="nc" id="L519">        return Component.BaselineResizeBehavior.CONSTANT_ASCENT;</span>
    }

    /**
     * The preferredSize of the list depends upon the layout orientation.
     * &lt;table summary=&quot;Describes the preferred size for each layout orientation&quot;&gt;
     * &lt;tr&gt;&lt;th&gt;Layout Orientation&lt;/th&gt;&lt;th&gt;Preferred Size&lt;/th&gt;&lt;/tr&gt;
     * &lt;tr&gt;
     *   &lt;td&gt;JList.VERTICAL
     *   &lt;td&gt;The preferredSize of the list is total height of the rows
     *       and the maximum width of the cells.  If JList.fixedCellHeight
     *       is specified then the total height of the rows is just
     *       (cellVerticalMargins + fixedCellHeight) * model.getSize() where
     *       rowVerticalMargins is the space we allocate for drawing
     *       the yellow focus outline.  Similarly if fixedCellWidth is
     *       specified then we just use that.
     *   &lt;/td&gt;
     * &lt;tr&gt;
     *   &lt;td&gt;JList.VERTICAL_WRAP
     *   &lt;td&gt;If the visible row count is greater than zero, the preferredHeight
     *       is the maximum cell height * visibleRowCount. If the visible row
     *       count is &amp;lt;= 0, the preferred height is either the current height
     *       of the list, or the maximum cell height, whichever is
     *       bigger. The preferred width is than the maximum cell width *
     *       number of columns needed. Where the number of columns needs is
     *       list.height / max cell height. Max cell height is either the fixed
     *       cell height, or is determined by iterating through all the cells
     *       to find the maximum height from the ListCellRenderer.
     * &lt;tr&gt;
     *   &lt;td&gt;JList.HORIZONTAL_WRAP
     *   &lt;td&gt;If the visible row count is greater than zero, the preferredHeight
     *       is the maximum cell height * adjustedRowCount.  Where
     *       visibleRowCount is used to determine the number of columns.
     *       Because this lays out horizontally the number of rows is
     *       then determined from the column count.  For example, lets say
     *       you have a model with 10 items and the visible row count is 8.
     *       The number of columns needed to display this is 2, but you no
     *       longer need 8 rows to display this, you only need 5, thus
     *       the adjustedRowCount is 5.
     *       &lt;p&gt;If the visible row
     *       count is &amp;lt;= 0, the preferred height is dictated by the
     *       number of columns, which will be as many as can fit in the width
     *       of the &lt;code&gt;JList&lt;/code&gt; (width / max cell width), with at
     *       least one column.  The preferred height then becomes the
     *       model size / number of columns * maximum cell height.
     *       Max cell height is either the fixed
     *       cell height, or is determined by iterating through all the cells
     *       to find the maximum height from the ListCellRenderer.
     * &lt;/table&gt;
     * The above specifies the raw preferred width and height. The resulting
     * preferred width is the above width + insets.left + insets.right and
     * the resulting preferred height is the above height + insets.top +
     * insets.bottom. Where the &lt;code&gt;Insets&lt;/code&gt; are determined from
     * &lt;code&gt;list.getInsets()&lt;/code&gt;.
     *
     * @param c The JList component.
     * @return The total size of the list.
     */
    public Dimension getPreferredSize(JComponent c) {
<span class="nc" id="L578">        maybeUpdateLayoutState();</span>

<span class="nc" id="L580">        int lastRow = list.getModel().getSize() - 1;</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">        if (lastRow &lt; 0) {</span>
<span class="nc" id="L582">            return new Dimension(0, 0);</span>
        }

<span class="nc" id="L585">        Insets insets = list.getInsets();</span>
<span class="nc" id="L586">        int width = cellWidth * columnCount + insets.left + insets.right;</span>
        int height;

<span class="nc bnc" id="L589" title="All 2 branches missed.">        if (layoutOrientation != JList.VERTICAL) {</span>
<span class="nc" id="L590">            height = preferredHeight;</span>
        }
        else {
<span class="nc" id="L593">            Rectangle bounds = getCellBounds(list, lastRow);</span>

<span class="nc bnc" id="L595" title="All 2 branches missed.">            if (bounds != null) {</span>
<span class="nc" id="L596">                height = bounds.y + bounds.height + insets.bottom;</span>
            }
            else {
<span class="nc" id="L599">                height = 0;</span>
            }
        }
<span class="nc" id="L602">        return new Dimension(width, height);</span>
    }


    /**
     * Selected the previous row and force it to be visible.
     *
     * @see JList#ensureIndexIsVisible
     */
    protected void selectPreviousIndex() {
<span class="nc" id="L612">        int s = list.getSelectedIndex();</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">        if(s &gt; 0) {</span>
<span class="nc" id="L614">            s -= 1;</span>
<span class="nc" id="L615">            list.setSelectedIndex(s);</span>
<span class="nc" id="L616">            list.ensureIndexIsVisible(s);</span>
        }
<span class="nc" id="L618">    }</span>


    /**
     * Selected the previous row and force it to be visible.
     *
     * @see JList#ensureIndexIsVisible
     */
    protected void selectNextIndex()
    {
<span class="nc" id="L628">        int s = list.getSelectedIndex();</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">        if((s + 1) &lt; list.getModel().getSize()) {</span>
<span class="nc" id="L630">            s += 1;</span>
<span class="nc" id="L631">            list.setSelectedIndex(s);</span>
<span class="nc" id="L632">            list.ensureIndexIsVisible(s);</span>
        }
<span class="nc" id="L634">    }</span>


    /**
     * Registers the keyboard bindings on the &lt;code&gt;JList&lt;/code&gt; that the
     * &lt;code&gt;BasicListUI&lt;/code&gt; is associated with. This method is called at
     * installUI() time.
     *
     * @see #installUI
     */
    protected void installKeyboardActions() {
<span class="nc" id="L645">        InputMap inputMap = getInputMap(JComponent.WHEN_FOCUSED);</span>

<span class="nc" id="L647">        SwingUtilities.replaceUIInputMap(list, JComponent.WHEN_FOCUSED,</span>
                                           inputMap);

<span class="nc" id="L650">        LazyActionMap.installLazyActionMap(list, BasicListUI.class,</span>
                                           &quot;List.actionMap&quot;);
<span class="nc" id="L652">    }</span>

    InputMap getInputMap(int condition) {
<span class="nc bnc" id="L655" title="All 2 branches missed.">        if (condition == JComponent.WHEN_FOCUSED) {</span>
<span class="nc" id="L656">            InputMap keyMap = (InputMap)DefaultLookup.get(</span>
                             list, this, &quot;List.focusInputMap&quot;);
            InputMap rtlKeyMap;

<span class="nc bnc" id="L660" title="All 2 branches missed.">            if (isLeftToRight ||</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">                ((rtlKeyMap = (InputMap)DefaultLookup.get(list, this,</span>
                              &quot;List.focusInputMap.RightToLeft&quot;)) == null)) {
<span class="nc" id="L663">                    return keyMap;</span>
            } else {
<span class="nc" id="L665">                rtlKeyMap.setParent(keyMap);</span>
<span class="nc" id="L666">                return rtlKeyMap;</span>
            }
        }
<span class="nc" id="L669">        return null;</span>
    }

    /**
     * Unregisters keyboard actions installed from
     * &lt;code&gt;installKeyboardActions&lt;/code&gt;.
     * This method is called at uninstallUI() time - subclassess should
     * ensure that all of the keyboard actions registered at installUI
     * time are removed here.
     *
     * @see #installUI
     */
    protected void uninstallKeyboardActions() {
<span class="nc" id="L682">        SwingUtilities.replaceUIActionMap(list, null);</span>
<span class="nc" id="L683">        SwingUtilities.replaceUIInputMap(list, JComponent.WHEN_FOCUSED, null);</span>
<span class="nc" id="L684">    }</span>


    /**
     * Creates and installs the listeners for the JList, its model, and its
     * selectionModel.  This method is called at installUI() time.
     *
     * @see #installUI
     * @see #uninstallListeners
     */
    protected void installListeners()
    {
<span class="nc" id="L696">        TransferHandler th = list.getTransferHandler();</span>
<span class="nc bnc" id="L697" title="All 4 branches missed.">        if (th == null || th instanceof UIResource) {</span>
<span class="nc" id="L698">            list.setTransferHandler(defaultTransferHandler);</span>
            // default TransferHandler doesn't support drop
            // so we don't want drop handling
<span class="nc bnc" id="L701" title="All 2 branches missed.">            if (list.getDropTarget() instanceof UIResource) {</span>
<span class="nc" id="L702">                list.setDropTarget(null);</span>
            }
        }

<span class="nc" id="L706">        focusListener = createFocusListener();</span>
<span class="nc" id="L707">        mouseInputListener = createMouseInputListener();</span>
<span class="nc" id="L708">        propertyChangeListener = createPropertyChangeListener();</span>
<span class="nc" id="L709">        listSelectionListener = createListSelectionListener();</span>
<span class="nc" id="L710">        listDataListener = createListDataListener();</span>

<span class="nc" id="L712">        list.addFocusListener(focusListener);</span>
<span class="nc" id="L713">        list.addMouseListener(mouseInputListener);</span>
<span class="nc" id="L714">        list.addMouseMotionListener(mouseInputListener);</span>
<span class="nc" id="L715">        list.addPropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L716">        list.addKeyListener(getHandler());</span>

<span class="nc" id="L718">        ListModel model = list.getModel();</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if (model != null) {</span>
<span class="nc" id="L720">            model.addListDataListener(listDataListener);</span>
        }

<span class="nc" id="L723">        ListSelectionModel selectionModel = list.getSelectionModel();</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">        if (selectionModel != null) {</span>
<span class="nc" id="L725">            selectionModel.addListSelectionListener(listSelectionListener);</span>
        }
<span class="nc" id="L727">    }</span>


    /**
     * Removes the listeners from the JList, its model, and its
     * selectionModel.  All of the listener fields, are reset to
     * null here.  This method is called at uninstallUI() time,
     * it should be kept in sync with installListeners.
     *
     * @see #uninstallUI
     * @see #installListeners
     */
    protected void uninstallListeners()
    {
<span class="nc" id="L741">        list.removeFocusListener(focusListener);</span>
<span class="nc" id="L742">        list.removeMouseListener(mouseInputListener);</span>
<span class="nc" id="L743">        list.removeMouseMotionListener(mouseInputListener);</span>
<span class="nc" id="L744">        list.removePropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L745">        list.removeKeyListener(getHandler());</span>

<span class="nc" id="L747">        ListModel model = list.getModel();</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">        if (model != null) {</span>
<span class="nc" id="L749">            model.removeListDataListener(listDataListener);</span>
        }

<span class="nc" id="L752">        ListSelectionModel selectionModel = list.getSelectionModel();</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">        if (selectionModel != null) {</span>
<span class="nc" id="L754">            selectionModel.removeListSelectionListener(listSelectionListener);</span>
        }

<span class="nc" id="L757">        focusListener = null;</span>
<span class="nc" id="L758">        mouseInputListener  = null;</span>
<span class="nc" id="L759">        listSelectionListener = null;</span>
<span class="nc" id="L760">        listDataListener = null;</span>
<span class="nc" id="L761">        propertyChangeListener = null;</span>
<span class="nc" id="L762">        handler = null;</span>
<span class="nc" id="L763">    }</span>


    /**
     * Initializes list properties such as font, foreground, and background,
     * and adds the CellRendererPane. The font, foreground, and background
     * properties are only set if their current value is either null
     * or a UIResource, other properties are set if the current
     * value is null.
     *
     * @see #uninstallDefaults
     * @see #installUI
     * @see CellRendererPane
     */
    protected void installDefaults()
    {
<span class="nc" id="L779">        list.setLayout(null);</span>

<span class="nc" id="L781">        LookAndFeel.installBorder(list, &quot;List.border&quot;);</span>

<span class="nc" id="L783">        LookAndFeel.installColorsAndFont(list, &quot;List.background&quot;, &quot;List.foreground&quot;, &quot;List.font&quot;);</span>

<span class="nc" id="L785">        LookAndFeel.installProperty(list, &quot;opaque&quot;, Boolean.TRUE);</span>

<span class="nc bnc" id="L787" title="All 2 branches missed.">        if (list.getCellRenderer() == null) {</span>
<span class="nc" id="L788">            list.setCellRenderer((ListCellRenderer)(UIManager.get(&quot;List.cellRenderer&quot;)));</span>
        }

<span class="nc" id="L791">        Color sbg = list.getSelectionBackground();</span>
<span class="nc bnc" id="L792" title="All 4 branches missed.">        if (sbg == null || sbg instanceof UIResource) {</span>
<span class="nc" id="L793">            list.setSelectionBackground(UIManager.getColor(&quot;List.selectionBackground&quot;));</span>
        }

<span class="nc" id="L796">        Color sfg = list.getSelectionForeground();</span>
<span class="nc bnc" id="L797" title="All 4 branches missed.">        if (sfg == null || sfg instanceof UIResource) {</span>
<span class="nc" id="L798">            list.setSelectionForeground(UIManager.getColor(&quot;List.selectionForeground&quot;));</span>
        }

<span class="nc" id="L801">        Long l = (Long)UIManager.get(&quot;List.timeFactor&quot;);</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">        timeFactor = (l!=null) ? l.longValue() : 1000L;</span>

<span class="nc" id="L804">        updateIsFileList();</span>
<span class="nc" id="L805">    }</span>

    private void updateIsFileList() {
<span class="nc" id="L808">        boolean b = Boolean.TRUE.equals(list.getClientProperty(&quot;List.isFileList&quot;));</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">        if (b != isFileList) {</span>
<span class="nc" id="L810">            isFileList = b;</span>
<span class="nc" id="L811">            Font oldFont = list.getFont();</span>
<span class="nc bnc" id="L812" title="All 4 branches missed.">            if (oldFont == null || oldFont instanceof UIResource) {</span>
<span class="nc bnc" id="L813" title="All 2 branches missed.">                Font newFont = UIManager.getFont(b ? &quot;FileChooser.listFont&quot; : &quot;List.font&quot;);</span>
<span class="nc bnc" id="L814" title="All 4 branches missed.">                if (newFont != null &amp;&amp; newFont != oldFont) {</span>
<span class="nc" id="L815">                    list.setFont(newFont);</span>
                }
            }
        }
<span class="nc" id="L819">    }</span>


    /**
     * Sets the list properties that have not been explicitly overridden to
     * {@code null}. A property is considered overridden if its current value
     * is not a {@code UIResource}.
     *
     * @see #installDefaults
     * @see #uninstallUI
     * @see CellRendererPane
     */
    protected void uninstallDefaults()
    {
<span class="nc" id="L833">        LookAndFeel.uninstallBorder(list);</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">        if (list.getFont() instanceof UIResource) {</span>
<span class="nc" id="L835">            list.setFont(null);</span>
        }
<span class="nc bnc" id="L837" title="All 2 branches missed.">        if (list.getForeground() instanceof UIResource) {</span>
<span class="nc" id="L838">            list.setForeground(null);</span>
        }
<span class="nc bnc" id="L840" title="All 2 branches missed.">        if (list.getBackground() instanceof UIResource) {</span>
<span class="nc" id="L841">            list.setBackground(null);</span>
        }
<span class="nc bnc" id="L843" title="All 2 branches missed.">        if (list.getSelectionBackground() instanceof UIResource) {</span>
<span class="nc" id="L844">            list.setSelectionBackground(null);</span>
        }
<span class="nc bnc" id="L846" title="All 2 branches missed.">        if (list.getSelectionForeground() instanceof UIResource) {</span>
<span class="nc" id="L847">            list.setSelectionForeground(null);</span>
        }
<span class="nc bnc" id="L849" title="All 2 branches missed.">        if (list.getCellRenderer() instanceof UIResource) {</span>
<span class="nc" id="L850">            list.setCellRenderer(null);</span>
        }
<span class="nc bnc" id="L852" title="All 2 branches missed.">        if (list.getTransferHandler() instanceof UIResource) {</span>
<span class="nc" id="L853">            list.setTransferHandler(null);</span>
        }
<span class="nc" id="L855">    }</span>


    /**
     * Initializes &lt;code&gt;this.list&lt;/code&gt; by calling &lt;code&gt;installDefaults()&lt;/code&gt;,
     * &lt;code&gt;installListeners()&lt;/code&gt;, and &lt;code&gt;installKeyboardActions()&lt;/code&gt;
     * in order.
     *
     * @see #installDefaults
     * @see #installListeners
     * @see #installKeyboardActions
     */
    public void installUI(JComponent c)
    {
<span class="nc" id="L869">        list = (JList)c;</span>

<span class="nc" id="L871">        layoutOrientation = list.getLayoutOrientation();</span>

<span class="nc" id="L873">        rendererPane = new CellRendererPane();</span>
<span class="nc" id="L874">        list.add(rendererPane);</span>

<span class="nc" id="L876">        columnCount = 1;</span>

<span class="nc" id="L878">        updateLayoutStateNeeded = modelChanged;</span>
<span class="nc" id="L879">        isLeftToRight = list.getComponentOrientation().isLeftToRight();</span>

<span class="nc" id="L881">        installDefaults();</span>
<span class="nc" id="L882">        installListeners();</span>
<span class="nc" id="L883">        installKeyboardActions();</span>
<span class="nc" id="L884">    }</span>


    /**
     * Uninitializes &lt;code&gt;this.list&lt;/code&gt; by calling &lt;code&gt;uninstallListeners()&lt;/code&gt;,
     * &lt;code&gt;uninstallKeyboardActions()&lt;/code&gt;, and &lt;code&gt;uninstallDefaults()&lt;/code&gt;
     * in order.  Sets this.list to null.
     *
     * @see #uninstallListeners
     * @see #uninstallKeyboardActions
     * @see #uninstallDefaults
     */
    public void uninstallUI(JComponent c)
    {
<span class="nc" id="L898">        uninstallListeners();</span>
<span class="nc" id="L899">        uninstallDefaults();</span>
<span class="nc" id="L900">        uninstallKeyboardActions();</span>

<span class="nc" id="L902">        cellWidth = cellHeight = -1;</span>
<span class="nc" id="L903">        cellHeights = null;</span>

<span class="nc" id="L905">        listWidth = listHeight = -1;</span>

<span class="nc" id="L907">        list.remove(rendererPane);</span>
<span class="nc" id="L908">        rendererPane = null;</span>
<span class="nc" id="L909">        list = null;</span>
<span class="nc" id="L910">    }</span>


    /**
     * Returns a new instance of BasicListUI.  BasicListUI delegates are
     * allocated one per JList.
     *
     * @return A new ListUI implementation for the Windows look and feel.
     */
    public static ComponentUI createUI(JComponent list) {
<span class="nc" id="L920">        return new BasicListUI();</span>
    }


    /**
     * {@inheritDoc}
     * @throws NullPointerException {@inheritDoc}
     */
    public int locationToIndex(JList list, Point location) {
<span class="nc" id="L929">        maybeUpdateLayoutState();</span>
<span class="nc" id="L930">        return convertLocationToModel(location.x, location.y);</span>
    }


    /**
     * {@inheritDoc}
     */
    public Point indexToLocation(JList list, int index) {
<span class="nc" id="L938">        maybeUpdateLayoutState();</span>
<span class="nc" id="L939">        Rectangle rect = getCellBounds(list, index, index);</span>

<span class="nc bnc" id="L941" title="All 2 branches missed.">        if (rect != null) {</span>
<span class="nc" id="L942">            return new Point(rect.x, rect.y);</span>
        }
<span class="nc" id="L944">        return null;</span>
    }


    /**
     * {@inheritDoc}
     */
    public Rectangle getCellBounds(JList list, int index1, int index2) {
<span class="nc" id="L952">        maybeUpdateLayoutState();</span>

<span class="nc" id="L954">        int minIndex = Math.min(index1, index2);</span>
<span class="nc" id="L955">        int maxIndex = Math.max(index1, index2);</span>

<span class="nc bnc" id="L957" title="All 2 branches missed.">        if (minIndex &gt;= list.getModel().getSize()) {</span>
<span class="nc" id="L958">            return null;</span>
        }

<span class="nc" id="L961">        Rectangle minBounds = getCellBounds(list, minIndex);</span>

<span class="nc bnc" id="L963" title="All 2 branches missed.">        if (minBounds == null) {</span>
<span class="nc" id="L964">            return null;</span>
        }
<span class="nc bnc" id="L966" title="All 2 branches missed.">        if (minIndex == maxIndex) {</span>
<span class="nc" id="L967">            return minBounds;</span>
        }
<span class="nc" id="L969">        Rectangle maxBounds = getCellBounds(list, maxIndex);</span>

<span class="nc bnc" id="L971" title="All 2 branches missed.">        if (maxBounds != null) {</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">            if (layoutOrientation == JList.HORIZONTAL_WRAP) {</span>
<span class="nc" id="L973">                int minRow = convertModelToRow(minIndex);</span>
<span class="nc" id="L974">                int maxRow = convertModelToRow(maxIndex);</span>

<span class="nc bnc" id="L976" title="All 2 branches missed.">                if (minRow != maxRow) {</span>
<span class="nc" id="L977">                    minBounds.x = 0;</span>
<span class="nc" id="L978">                    minBounds.width = list.getWidth();</span>
                }
<span class="nc" id="L980">            }</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">            else if (minBounds.x != maxBounds.x) {</span>
                // Different columns
<span class="nc" id="L983">                minBounds.y = 0;</span>
<span class="nc" id="L984">                minBounds.height = list.getHeight();</span>
            }
<span class="nc" id="L986">            minBounds.add(maxBounds);</span>
        }
<span class="nc" id="L988">        return minBounds;</span>
    }

    /**
     * Gets the bounds of the specified model index, returning the resulting
     * bounds, or null if &lt;code&gt;index&lt;/code&gt; is not valid.
     */
    private Rectangle getCellBounds(JList list, int index) {
<span class="nc" id="L996">        maybeUpdateLayoutState();</span>

<span class="nc" id="L998">        int row = convertModelToRow(index);</span>
<span class="nc" id="L999">        int column = convertModelToColumn(index);</span>

<span class="nc bnc" id="L1001" title="All 4 branches missed.">        if (row == -1 || column == -1) {</span>
<span class="nc" id="L1002">            return null;</span>
        }

<span class="nc" id="L1005">        Insets insets = list.getInsets();</span>
        int x;
<span class="nc" id="L1007">        int w = cellWidth;</span>
<span class="nc" id="L1008">        int y = insets.top;</span>
        int h;
<span class="nc bnc" id="L1010" title="All 2 branches missed.">        switch (layoutOrientation) {</span>
        case JList.VERTICAL_WRAP:
        case JList.HORIZONTAL_WRAP:
<span class="nc bnc" id="L1013" title="All 2 branches missed.">            if (isLeftToRight) {</span>
<span class="nc" id="L1014">                x = insets.left + column * cellWidth;</span>
            } else {
<span class="nc" id="L1016">                x = list.getWidth() - insets.right - (column+1) * cellWidth;</span>
            }
<span class="nc" id="L1018">            y += cellHeight * row;</span>
<span class="nc" id="L1019">            h = cellHeight;</span>
<span class="nc" id="L1020">            break;</span>
        default:
<span class="nc" id="L1022">            x = insets.left;</span>
<span class="nc bnc" id="L1023" title="All 2 branches missed.">            if (cellHeights == null) {</span>
<span class="nc" id="L1024">                y += (cellHeight * row);</span>
            }
<span class="nc bnc" id="L1026" title="All 2 branches missed.">            else if (row &gt;= cellHeights.length) {</span>
<span class="nc" id="L1027">                y = 0;</span>
            }
            else {
<span class="nc bnc" id="L1030" title="All 2 branches missed.">                for(int i = 0; i &lt; row; i++) {</span>
<span class="nc" id="L1031">                    y += cellHeights[i];</span>
                }
            }
<span class="nc" id="L1034">            w = list.getWidth() - (insets.left + insets.right);</span>
<span class="nc" id="L1035">            h = getRowHeight(index);</span>
            break;
        }
<span class="nc" id="L1038">        return new Rectangle(x, y, w, h);</span>
    }

    /**
     * Returns the height of the specified row based on the current layout.
     *
     * @return The specified row height or -1 if row isn't valid.
     * @see #convertYToRow
     * @see #convertRowToY
     * @see #updateLayoutState
     */
    protected int getRowHeight(int row)
    {
<span class="nc" id="L1051">        return getHeight(0, row);</span>
    }


    /**
     * Convert the JList relative coordinate to the row that contains it,
     * based on the current layout.  If y0 doesn't fall within any row,
     * return -1.
     *
     * @return The row that contains y0, or -1.
     * @see #getRowHeight
     * @see #updateLayoutState
     */
    protected int convertYToRow(int y0)
    {
<span class="nc" id="L1066">        return convertLocationToRow(0, y0, false);</span>
    }


    /**
     * Return the JList relative Y coordinate of the origin of the specified
     * row or -1 if row isn't valid.
     *
     * @return The Y coordinate of the origin of row, or -1.
     * @see #getRowHeight
     * @see #updateLayoutState
     */
    protected int convertRowToY(int row)
    {
<span class="nc bnc" id="L1080" title="All 4 branches missed.">        if (row &gt;= getRowCount(0) || row &lt; 0) {</span>
<span class="nc" id="L1081">            return -1;</span>
        }
<span class="nc" id="L1083">        Rectangle bounds = getCellBounds(list, row, row);</span>
<span class="nc" id="L1084">        return bounds.y;</span>
    }

    /**
     * Returns the height of the cell at the passed in location.
     */
    private int getHeight(int column, int row) {
<span class="nc bnc" id="L1091" title="All 6 branches missed.">        if (column &lt; 0 || column &gt; columnCount || row &lt; 0) {</span>
<span class="nc" id="L1092">            return -1;</span>
        }
<span class="nc bnc" id="L1094" title="All 2 branches missed.">        if (layoutOrientation != JList.VERTICAL) {</span>
<span class="nc" id="L1095">            return cellHeight;</span>
        }
<span class="nc bnc" id="L1097" title="All 2 branches missed.">        if (row &gt;= list.getModel().getSize()) {</span>
<span class="nc" id="L1098">            return -1;</span>
        }
<span class="nc bnc" id="L1100" title="All 4 branches missed.">        return (cellHeights == null) ? cellHeight :</span>
                           ((row &lt; cellHeights.length) ? cellHeights[row] : -1);
    }

    /**
     * Returns the row at location x/y.
     *
     * @param closest If true and the location doesn't exactly match a
     *                particular location, this will return the closest row.
     */
    private int convertLocationToRow(int x, int y0, boolean closest) {
<span class="nc" id="L1111">        int size = list.getModel().getSize();</span>

<span class="nc bnc" id="L1113" title="All 2 branches missed.">        if (size &lt;= 0) {</span>
<span class="nc" id="L1114">            return -1;</span>
        }
<span class="nc" id="L1116">        Insets insets = list.getInsets();</span>
<span class="nc bnc" id="L1117" title="All 2 branches missed.">        if (cellHeights == null) {</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">            int row = (cellHeight == 0) ? 0 :</span>
                           ((y0 - insets.top) / cellHeight);
<span class="nc bnc" id="L1120" title="All 2 branches missed.">            if (closest) {</span>
<span class="nc bnc" id="L1121" title="All 2 branches missed.">                if (row &lt; 0) {</span>
<span class="nc" id="L1122">                    row = 0;</span>
                }
<span class="nc bnc" id="L1124" title="All 2 branches missed.">                else if (row &gt;= size) {</span>
<span class="nc" id="L1125">                    row = size - 1;</span>
                }
            }
<span class="nc" id="L1128">            return row;</span>
        }
<span class="nc bnc" id="L1130" title="All 2 branches missed.">        else if (size &gt; cellHeights.length) {</span>
<span class="nc" id="L1131">            return -1;</span>
        }
        else {
<span class="nc" id="L1134">            int y = insets.top;</span>
<span class="nc" id="L1135">            int row = 0;</span>

<span class="nc bnc" id="L1137" title="All 4 branches missed.">            if (closest &amp;&amp; y0 &lt; y) {</span>
<span class="nc" id="L1138">                return 0;</span>
            }
            int i;
<span class="nc bnc" id="L1141" title="All 2 branches missed.">            for (i = 0; i &lt; size; i++) {</span>
<span class="nc bnc" id="L1142" title="All 4 branches missed.">                if ((y0 &gt;= y) &amp;&amp; (y0 &lt; y + cellHeights[i])) {</span>
<span class="nc" id="L1143">                    return row;</span>
                }
<span class="nc" id="L1145">                y += cellHeights[i];</span>
<span class="nc" id="L1146">                row += 1;</span>
            }
<span class="nc" id="L1148">            return i - 1;</span>
        }
    }

    /**
     * Returns the closest row that starts at the specified y-location
     * in the passed in column.
     */
    private int convertLocationToRowInColumn(int y, int column) {
<span class="nc" id="L1157">        int x = 0;</span>

<span class="nc bnc" id="L1159" title="All 2 branches missed.">        if (layoutOrientation != JList.VERTICAL) {</span>
<span class="nc bnc" id="L1160" title="All 2 branches missed.">            if (isLeftToRight) {</span>
<span class="nc" id="L1161">                x = column * cellWidth;</span>
            } else {
<span class="nc" id="L1163">                x = list.getWidth() - (column+1)*cellWidth - list.getInsets().right;</span>
            }
        }
<span class="nc" id="L1166">        return convertLocationToRow(x, y, true);</span>
    }

    /**
     * Returns the closest location to the model index of the passed in
     * location.
     */
    private int convertLocationToModel(int x, int y) {
<span class="nc" id="L1174">        int row = convertLocationToRow(x, y, true);</span>
<span class="nc" id="L1175">        int column = convertLocationToColumn(x, y);</span>

<span class="nc bnc" id="L1177" title="All 4 branches missed.">        if (row &gt;= 0 &amp;&amp; column &gt;= 0) {</span>
<span class="nc" id="L1178">            return getModelIndex(column, row);</span>
        }
<span class="nc" id="L1180">        return -1;</span>
    }

    /**
     * Returns the number of rows in the given column.
     */
    private int getRowCount(int column) {
<span class="nc bnc" id="L1187" title="All 4 branches missed.">        if (column &lt; 0 || column &gt;= columnCount) {</span>
<span class="nc" id="L1188">            return -1;</span>
        }
<span class="nc bnc" id="L1190" title="All 6 branches missed.">        if (layoutOrientation == JList.VERTICAL ||</span>
                  (column == 0 &amp;&amp; columnCount == 1)) {
<span class="nc" id="L1192">            return list.getModel().getSize();</span>
        }
<span class="nc bnc" id="L1194" title="All 2 branches missed.">        if (column &gt;= columnCount) {</span>
<span class="nc" id="L1195">            return -1;</span>
        }
<span class="nc bnc" id="L1197" title="All 2 branches missed.">        if (layoutOrientation == JList.VERTICAL_WRAP) {</span>
<span class="nc bnc" id="L1198" title="All 2 branches missed.">            if (column &lt; (columnCount - 1)) {</span>
<span class="nc" id="L1199">                return rowsPerColumn;</span>
            }
<span class="nc" id="L1201">            return list.getModel().getSize() - (columnCount - 1) *</span>
                        rowsPerColumn;
        }
        // JList.HORIZONTAL_WRAP
<span class="nc" id="L1205">        int diff = columnCount - (columnCount * rowsPerColumn -</span>
<span class="nc" id="L1206">                                  list.getModel().getSize());</span>

<span class="nc bnc" id="L1208" title="All 2 branches missed.">        if (column &gt;= diff) {</span>
<span class="nc" id="L1209">            return Math.max(0, rowsPerColumn - 1);</span>
        }
<span class="nc" id="L1211">        return rowsPerColumn;</span>
    }

    /**
     * Returns the model index for the specified display location.
     * If &lt;code&gt;column&lt;/code&gt;x&lt;code&gt;row&lt;/code&gt; is beyond the length of the
     * model, this will return the model size - 1.
     */
    private int getModelIndex(int column, int row) {
<span class="nc bnc" id="L1220" title="All 3 branches missed.">        switch (layoutOrientation) {</span>
        case JList.VERTICAL_WRAP:
<span class="nc" id="L1222">            return Math.min(list.getModel().getSize() - 1, rowsPerColumn *</span>
<span class="nc" id="L1223">                            column + Math.min(row, rowsPerColumn-1));</span>
        case JList.HORIZONTAL_WRAP:
<span class="nc" id="L1225">            return Math.min(list.getModel().getSize() - 1, row * columnCount +</span>
                            column);
        default:
<span class="nc" id="L1228">            return row;</span>
        }
    }

    /**
     * Returns the closest column to the passed in location.
     */
    private int convertLocationToColumn(int x, int y) {
<span class="nc bnc" id="L1236" title="All 2 branches missed.">        if (cellWidth &gt; 0) {</span>
<span class="nc bnc" id="L1237" title="All 2 branches missed.">            if (layoutOrientation == JList.VERTICAL) {</span>
<span class="nc" id="L1238">                return 0;</span>
            }
<span class="nc" id="L1240">            Insets insets = list.getInsets();</span>
            int col;
<span class="nc bnc" id="L1242" title="All 2 branches missed.">            if (isLeftToRight) {</span>
<span class="nc" id="L1243">                col = (x - insets.left) / cellWidth;</span>
            } else {
<span class="nc" id="L1245">                col = (list.getWidth() - x - insets.right - 1) / cellWidth;</span>
            }
<span class="nc bnc" id="L1247" title="All 2 branches missed.">            if (col &lt; 0) {</span>
<span class="nc" id="L1248">                return 0;</span>
            }
<span class="nc bnc" id="L1250" title="All 2 branches missed.">            else if (col &gt;= columnCount) {</span>
<span class="nc" id="L1251">                return columnCount - 1;</span>
            }
<span class="nc" id="L1253">            return col;</span>
        }
<span class="nc" id="L1255">        return 0;</span>
    }

    /**
     * Returns the row that the model index &lt;code&gt;index&lt;/code&gt; will be
     * displayed in..
     */
    private int convertModelToRow(int index) {
<span class="nc" id="L1263">        int size = list.getModel().getSize();</span>

<span class="nc bnc" id="L1265" title="All 4 branches missed.">        if ((index &lt; 0) || (index &gt;= size)) {</span>
<span class="nc" id="L1266">            return -1;</span>
        }

<span class="nc bnc" id="L1269" title="All 6 branches missed.">        if (layoutOrientation != JList.VERTICAL &amp;&amp; columnCount &gt; 1 &amp;&amp;</span>
                                                   rowsPerColumn &gt; 0) {
<span class="nc bnc" id="L1271" title="All 2 branches missed.">            if (layoutOrientation == JList.VERTICAL_WRAP) {</span>
<span class="nc" id="L1272">                return index % rowsPerColumn;</span>
            }
<span class="nc" id="L1274">            return index / columnCount;</span>
        }
<span class="nc" id="L1276">        return index;</span>
    }

    /**
     * Returns the column that the model index &lt;code&gt;index&lt;/code&gt; will be
     * displayed in.
     */
    private int convertModelToColumn(int index) {
<span class="nc" id="L1284">        int size = list.getModel().getSize();</span>

<span class="nc bnc" id="L1286" title="All 4 branches missed.">        if ((index &lt; 0) || (index &gt;= size)) {</span>
<span class="nc" id="L1287">            return -1;</span>
        }

<span class="nc bnc" id="L1290" title="All 6 branches missed.">        if (layoutOrientation != JList.VERTICAL &amp;&amp; rowsPerColumn &gt; 0 &amp;&amp;</span>
                                                   columnCount &gt; 1) {
<span class="nc bnc" id="L1292" title="All 2 branches missed.">            if (layoutOrientation == JList.VERTICAL_WRAP) {</span>
<span class="nc" id="L1293">                return index / rowsPerColumn;</span>
            }
<span class="nc" id="L1295">            return index % columnCount;</span>
        }
<span class="nc" id="L1297">        return 0;</span>
    }

    /**
     * If updateLayoutStateNeeded is non zero, call updateLayoutState() and reset
     * updateLayoutStateNeeded.  This method should be called by methods
     * before doing any computation based on the geometry of the list.
     * For example it's the first call in paint() and getPreferredSize().
     *
     * @see #updateLayoutState
     */
    protected void maybeUpdateLayoutState()
    {
<span class="nc bnc" id="L1310" title="All 2 branches missed.">        if (updateLayoutStateNeeded != 0) {</span>
<span class="nc" id="L1311">            updateLayoutState();</span>
<span class="nc" id="L1312">            updateLayoutStateNeeded = 0;</span>
        }
<span class="nc" id="L1314">    }</span>


    /**
     * Recompute the value of cellHeight or cellHeights based
     * and cellWidth, based on the current font and the current
     * values of fixedCellWidth, fixedCellHeight, and prototypeCellValue.
     *
     * @see #maybeUpdateLayoutState
     */
    protected void updateLayoutState()
    {
        /* If both JList fixedCellWidth and fixedCellHeight have been
         * set, then initialize cellWidth and cellHeight, and set
         * cellHeights to null.
         */

<span class="nc" id="L1331">        int fixedCellHeight = list.getFixedCellHeight();</span>
<span class="nc" id="L1332">        int fixedCellWidth = list.getFixedCellWidth();</span>

<span class="nc bnc" id="L1334" title="All 2 branches missed.">        cellWidth = (fixedCellWidth != -1) ? fixedCellWidth : -1;</span>

<span class="nc bnc" id="L1336" title="All 2 branches missed.">        if (fixedCellHeight != -1) {</span>
<span class="nc" id="L1337">            cellHeight = fixedCellHeight;</span>
<span class="nc" id="L1338">            cellHeights = null;</span>
        }
        else {
<span class="nc" id="L1341">            cellHeight = -1;</span>
<span class="nc" id="L1342">            cellHeights = new int[list.getModel().getSize()];</span>
        }

        /* If either of  JList fixedCellWidth and fixedCellHeight haven't
         * been set, then initialize cellWidth and cellHeights by
         * scanning through the entire model.  Note: if the renderer is
         * null, we just set cellWidth and cellHeights[*] to zero,
         * if they're not set already.
         */

<span class="nc bnc" id="L1352" title="All 4 branches missed.">        if ((fixedCellWidth == -1) || (fixedCellHeight == -1)) {</span>

<span class="nc" id="L1354">            ListModel dataModel = list.getModel();</span>
<span class="nc" id="L1355">            int dataModelSize = dataModel.getSize();</span>
<span class="nc" id="L1356">            ListCellRenderer renderer = list.getCellRenderer();</span>

<span class="nc bnc" id="L1358" title="All 2 branches missed.">            if (renderer != null) {</span>
<span class="nc bnc" id="L1359" title="All 2 branches missed.">                for(int index = 0; index &lt; dataModelSize; index++) {</span>
<span class="nc" id="L1360">                    Object value = dataModel.getElementAt(index);</span>
<span class="nc" id="L1361">                    Component c = renderer.getListCellRendererComponent(list, value, index, false, false);</span>
<span class="nc" id="L1362">                    rendererPane.add(c);</span>
<span class="nc" id="L1363">                    Dimension cellSize = c.getPreferredSize();</span>
<span class="nc bnc" id="L1364" title="All 2 branches missed.">                    if (fixedCellWidth == -1) {</span>
<span class="nc" id="L1365">                        cellWidth = Math.max(cellSize.width, cellWidth);</span>
                    }
<span class="nc bnc" id="L1367" title="All 2 branches missed.">                    if (fixedCellHeight == -1) {</span>
<span class="nc" id="L1368">                        cellHeights[index] = cellSize.height;</span>
                    }
                }
            }
            else {
<span class="nc bnc" id="L1373" title="All 2 branches missed.">                if (cellWidth == -1) {</span>
<span class="nc" id="L1374">                    cellWidth = 0;</span>
                }
<span class="nc bnc" id="L1376" title="All 2 branches missed.">                if (cellHeights == null) {</span>
<span class="nc" id="L1377">                    cellHeights = new int[dataModelSize];</span>
                }
<span class="nc bnc" id="L1379" title="All 2 branches missed.">                for(int index = 0; index &lt; dataModelSize; index++) {</span>
<span class="nc" id="L1380">                    cellHeights[index] = 0;</span>
                }
            }
        }

<span class="nc" id="L1385">        columnCount = 1;</span>
<span class="nc bnc" id="L1386" title="All 2 branches missed.">        if (layoutOrientation != JList.VERTICAL) {</span>
<span class="nc" id="L1387">            updateHorizontalLayoutState(fixedCellWidth, fixedCellHeight);</span>
        }
<span class="nc" id="L1389">    }</span>

    /**
     * Invoked when the list is layed out horizontally to determine how
     * many columns to create.
     * &lt;p&gt;
     * This updates the &lt;code&gt;rowsPerColumn, &lt;/code&gt;&lt;code&gt;columnCount&lt;/code&gt;,
     * &lt;code&gt;preferredHeight&lt;/code&gt; and potentially &lt;code&gt;cellHeight&lt;/code&gt;
     * instance variables.
     */
    private void updateHorizontalLayoutState(int fixedCellWidth,
                                             int fixedCellHeight) {
<span class="nc" id="L1401">        int visRows = list.getVisibleRowCount();</span>
<span class="nc" id="L1402">        int dataModelSize = list.getModel().getSize();</span>
<span class="nc" id="L1403">        Insets insets = list.getInsets();</span>

<span class="nc" id="L1405">        listHeight = list.getHeight();</span>
<span class="nc" id="L1406">        listWidth = list.getWidth();</span>

<span class="nc bnc" id="L1408" title="All 2 branches missed.">        if (dataModelSize == 0) {</span>
<span class="nc" id="L1409">            rowsPerColumn = columnCount = 0;</span>
<span class="nc" id="L1410">            preferredHeight = insets.top + insets.bottom;</span>
<span class="nc" id="L1411">            return;</span>
        }

        int height;

<span class="nc bnc" id="L1416" title="All 2 branches missed.">        if (fixedCellHeight != -1) {</span>
<span class="nc" id="L1417">            height = fixedCellHeight;</span>
        }
        else {
            // Determine the max of the renderer heights.
<span class="nc" id="L1421">            int maxHeight = 0;</span>
<span class="nc bnc" id="L1422" title="All 2 branches missed.">            if (cellHeights.length &gt; 0) {</span>
<span class="nc" id="L1423">                maxHeight = cellHeights[cellHeights.length - 1];</span>
<span class="nc" id="L1424">                for (int counter = cellHeights.length - 2;</span>
<span class="nc bnc" id="L1425" title="All 2 branches missed.">                     counter &gt;= 0; counter--) {</span>
<span class="nc" id="L1426">                    maxHeight = Math.max(maxHeight, cellHeights[counter]);</span>
                }
            }
<span class="nc" id="L1429">            height = cellHeight = maxHeight;</span>
<span class="nc" id="L1430">            cellHeights = null;</span>
        }
        // The number of rows is either determined by the visible row
        // count, or by the height of the list.
<span class="nc" id="L1434">        rowsPerColumn = dataModelSize;</span>
<span class="nc bnc" id="L1435" title="All 2 branches missed.">        if (visRows &gt; 0) {</span>
<span class="nc" id="L1436">            rowsPerColumn = visRows;</span>
<span class="nc" id="L1437">            columnCount = Math.max(1, dataModelSize / rowsPerColumn);</span>
<span class="nc bnc" id="L1438" title="All 6 branches missed.">            if (dataModelSize &gt; 0 &amp;&amp; dataModelSize &gt; rowsPerColumn &amp;&amp;</span>
                dataModelSize % rowsPerColumn != 0) {
<span class="nc" id="L1440">                columnCount++;</span>
            }
<span class="nc bnc" id="L1442" title="All 2 branches missed.">            if (layoutOrientation == JList.HORIZONTAL_WRAP) {</span>
                // Because HORIZONTAL_WRAP flows differently, the
                // rowsPerColumn needs to be adjusted.
<span class="nc" id="L1445">                rowsPerColumn = (dataModelSize / columnCount);</span>
<span class="nc bnc" id="L1446" title="All 2 branches missed.">                if (dataModelSize % columnCount &gt; 0) {</span>
<span class="nc" id="L1447">                    rowsPerColumn++;</span>
                }
            }
        }
<span class="nc bnc" id="L1451" title="All 4 branches missed.">        else if (layoutOrientation == JList.VERTICAL_WRAP &amp;&amp; height != 0) {</span>
<span class="nc" id="L1452">            rowsPerColumn = Math.max(1, (listHeight - insets.top -</span>
                                         insets.bottom) / height);
<span class="nc" id="L1454">            columnCount = Math.max(1, dataModelSize / rowsPerColumn);</span>
<span class="nc bnc" id="L1455" title="All 6 branches missed.">            if (dataModelSize &gt; 0 &amp;&amp; dataModelSize &gt; rowsPerColumn &amp;&amp;</span>
                dataModelSize % rowsPerColumn != 0) {
<span class="nc" id="L1457">                columnCount++;</span>
            }
        }
<span class="nc bnc" id="L1460" title="All 6 branches missed.">        else if (layoutOrientation == JList.HORIZONTAL_WRAP &amp;&amp; cellWidth &gt; 0 &amp;&amp;</span>
                 listWidth &gt; 0) {
<span class="nc" id="L1462">            columnCount = Math.max(1, (listWidth - insets.left -</span>
                                       insets.right) / cellWidth);
<span class="nc" id="L1464">            rowsPerColumn = dataModelSize / columnCount;</span>
<span class="nc bnc" id="L1465" title="All 2 branches missed.">            if (dataModelSize % columnCount &gt; 0) {</span>
<span class="nc" id="L1466">                rowsPerColumn++;</span>
            }
        }
<span class="nc" id="L1469">        preferredHeight = rowsPerColumn * cellHeight + insets.top +</span>
                              insets.bottom;
<span class="nc" id="L1471">    }</span>

    private Handler getHandler() {
<span class="nc bnc" id="L1474" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L1475">            handler = new Handler();</span>
        }
<span class="nc" id="L1477">        return handler;</span>
    }

    /**
     * Mouse input, and focus handling for JList.  An instance of this
     * class is added to the appropriate java.awt.Component lists
     * at installUI() time.  Note keyboard input is handled with JComponent
     * KeyboardActions, see installKeyboardActions().
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see #createMouseInputListener
     * @see #installKeyboardActions
     * @see #installUI
     */
<span class="nc" id="L1499">    public class MouseInputHandler implements MouseInputListener</span>
    {
        public void mouseClicked(MouseEvent e) {
<span class="nc" id="L1502">            getHandler().mouseClicked(e);</span>
<span class="nc" id="L1503">        }</span>

        public void mouseEntered(MouseEvent e) {
<span class="nc" id="L1506">            getHandler().mouseEntered(e);</span>
<span class="nc" id="L1507">        }</span>

        public void mouseExited(MouseEvent e) {
<span class="nc" id="L1510">            getHandler().mouseExited(e);</span>
<span class="nc" id="L1511">        }</span>

        public void mousePressed(MouseEvent e) {
<span class="nc" id="L1514">            getHandler().mousePressed(e);</span>
<span class="nc" id="L1515">        }</span>

        public void mouseDragged(MouseEvent e) {
<span class="nc" id="L1518">            getHandler().mouseDragged(e);</span>
<span class="nc" id="L1519">        }</span>

        public void mouseMoved(MouseEvent e) {
<span class="nc" id="L1522">            getHandler().mouseMoved(e);</span>
<span class="nc" id="L1523">        }</span>

        public void mouseReleased(MouseEvent e) {
<span class="nc" id="L1526">            getHandler().mouseReleased(e);</span>
<span class="nc" id="L1527">        }</span>
    }


    /**
     * Creates a delegate that implements MouseInputListener.
     * The delegate is added to the corresponding java.awt.Component listener
     * lists at installUI() time. Subclasses can override this method to return
     * a custom MouseInputListener, e.g.
     * &lt;pre&gt;
     * class MyListUI extends BasicListUI {
     *    protected MouseInputListener &lt;b&gt;createMouseInputListener&lt;/b&gt;() {
     *        return new MyMouseInputHandler();
     *    }
     *    public class MyMouseInputHandler extends MouseInputHandler {
     *        public void mouseMoved(MouseEvent e) {
     *            // do some extra work when the mouse moves
     *            super.mouseMoved(e);
     *        }
     *    }
     * }
     * &lt;/pre&gt;
     *
     * @see MouseInputHandler
     * @see #installUI
     */
    protected MouseInputListener createMouseInputListener() {
<span class="nc" id="L1554">        return getHandler();</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of {@code BasicListUI}.
     */
<span class="nc" id="L1561">    public class FocusHandler implements FocusListener</span>
    {
        protected void repaintCellFocus()
        {
<span class="nc" id="L1565">            getHandler().repaintCellFocus();</span>
<span class="nc" id="L1566">        }</span>

        /* The focusGained() focusLost() methods run when the JList
         * focus changes.
         */

        public void focusGained(FocusEvent e) {
<span class="nc" id="L1573">            getHandler().focusGained(e);</span>
<span class="nc" id="L1574">        }</span>

        public void focusLost(FocusEvent e) {
<span class="nc" id="L1577">            getHandler().focusLost(e);</span>
<span class="nc" id="L1578">        }</span>
    }

    protected FocusListener createFocusListener() {
<span class="nc" id="L1582">        return getHandler();</span>
    }

    /**
     * The ListSelectionListener that's added to the JLists selection
     * model at installUI time, and whenever the JList.selectionModel property
     * changes.  When the selection changes we repaint the affected rows.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see #createListSelectionListener
     * @see #getCellBounds
     * @see #installUI
     */
<span class="nc" id="L1603">    public class ListSelectionHandler implements ListSelectionListener</span>
    {
        public void valueChanged(ListSelectionEvent e)
        {
<span class="nc" id="L1607">            getHandler().valueChanged(e);</span>
<span class="nc" id="L1608">        }</span>
    }


    /**
     * Creates an instance of ListSelectionHandler that's added to
     * the JLists by selectionModel as needed.  Subclasses can override
     * this method to return a custom ListSelectionListener, e.g.
     * &lt;pre&gt;
     * class MyListUI extends BasicListUI {
     *    protected ListSelectionListener &lt;b&gt;createListSelectionListener&lt;/b&gt;() {
     *        return new MySelectionListener();
     *    }
     *    public class MySelectionListener extends ListSelectionHandler {
     *        public void valueChanged(ListSelectionEvent e) {
     *            // do some extra work when the selection changes
     *            super.valueChange(e);
     *        }
     *    }
     * }
     * &lt;/pre&gt;
     *
     * @see ListSelectionHandler
     * @see #installUI
     */
    protected ListSelectionListener createListSelectionListener() {
<span class="nc" id="L1634">        return getHandler();</span>
    }


    private void redrawList() {
<span class="nc" id="L1639">        list.revalidate();</span>
<span class="nc" id="L1640">        list.repaint();</span>
<span class="nc" id="L1641">    }</span>


    /**
     * The ListDataListener that's added to the JLists model at
     * installUI time, and whenever the JList.model property changes.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see JList#getModel
     * @see #maybeUpdateLayoutState
     * @see #createListDataListener
     * @see #installUI
     */
<span class="nc" id="L1662">    public class ListDataHandler implements ListDataListener</span>
    {
        public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L1665">            getHandler().intervalAdded(e);</span>
<span class="nc" id="L1666">        }</span>


        public void intervalRemoved(ListDataEvent e)
        {
<span class="nc" id="L1671">            getHandler().intervalRemoved(e);</span>
<span class="nc" id="L1672">        }</span>


        public void contentsChanged(ListDataEvent e) {
<span class="nc" id="L1676">            getHandler().contentsChanged(e);</span>
<span class="nc" id="L1677">        }</span>
    }


    /**
     * Creates an instance of ListDataListener that's added to
     * the JLists by model as needed.  Subclasses can override
     * this method to return a custom ListDataListener, e.g.
     * &lt;pre&gt;
     * class MyListUI extends BasicListUI {
     *    protected ListDataListener &lt;b&gt;createListDataListener&lt;/b&gt;() {
     *        return new MyListDataListener();
     *    }
     *    public class MyListDataListener extends ListDataHandler {
     *        public void contentsChanged(ListDataEvent e) {
     *            // do some extra work when the models contents change
     *            super.contentsChange(e);
     *        }
     *    }
     * }
     * &lt;/pre&gt;
     *
     * @see ListDataListener
     * @see JList#getModel
     * @see #installUI
     */
    protected ListDataListener createListDataListener() {
<span class="nc" id="L1704">        return getHandler();</span>
    }


    /**
     * The PropertyChangeListener that's added to the JList at
     * installUI time.  When the value of a JList property that
     * affects layout changes, we set a bit in updateLayoutStateNeeded.
     * If the JLists model changes we additionally remove our listeners
     * from the old model.  Likewise for the JList selectionModel.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see #maybeUpdateLayoutState
     * @see #createPropertyChangeListener
     * @see #installUI
     */
<span class="nc" id="L1728">    public class PropertyChangeHandler implements PropertyChangeListener</span>
    {
        public void propertyChange(PropertyChangeEvent e)
        {
<span class="nc" id="L1732">            getHandler().propertyChange(e);</span>
<span class="nc" id="L1733">        }</span>
    }


    /**
     * Creates an instance of PropertyChangeHandler that's added to
     * the JList by installUI().  Subclasses can override this method
     * to return a custom PropertyChangeListener, e.g.
     * &lt;pre&gt;
     * class MyListUI extends BasicListUI {
     *    protected PropertyChangeListener &lt;b&gt;createPropertyChangeListener&lt;/b&gt;() {
     *        return new MyPropertyChangeListener();
     *    }
     *    public class MyPropertyChangeListener extends PropertyChangeHandler {
     *        public void propertyChange(PropertyChangeEvent e) {
     *            if (e.getPropertyName().equals(&quot;model&quot;)) {
     *                // do some extra work when the model changes
     *            }
     *            super.propertyChange(e);
     *        }
     *    }
     * }
     * &lt;/pre&gt;
     *
     * @see PropertyChangeListener
     * @see #installUI
     */
    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L1761">        return getHandler();</span>
    }

    /** Used by IncrementLeadSelectionAction. Indicates the action should
     * change the lead, and not select it. */
    private static final int CHANGE_LEAD = 0;
    /** Used by IncrementLeadSelectionAction. Indicates the action should
     * change the selection and lead. */
    private static final int CHANGE_SELECTION = 1;
    /** Used by IncrementLeadSelectionAction. Indicates the action should
     * extend the selection from the anchor to the next index. */
    private static final int EXTEND_SELECTION = 2;


    private static class Actions extends UIAction {
        private static final String SELECT_PREVIOUS_COLUMN =
                                    &quot;selectPreviousColumn&quot;;
        private static final String SELECT_PREVIOUS_COLUMN_EXTEND =
                                    &quot;selectPreviousColumnExtendSelection&quot;;
        private static final String SELECT_PREVIOUS_COLUMN_CHANGE_LEAD =
                                    &quot;selectPreviousColumnChangeLead&quot;;
        private static final String SELECT_NEXT_COLUMN = &quot;selectNextColumn&quot;;
        private static final String SELECT_NEXT_COLUMN_EXTEND =
                                    &quot;selectNextColumnExtendSelection&quot;;
        private static final String SELECT_NEXT_COLUMN_CHANGE_LEAD =
                                    &quot;selectNextColumnChangeLead&quot;;
        private static final String SELECT_PREVIOUS_ROW = &quot;selectPreviousRow&quot;;
        private static final String SELECT_PREVIOUS_ROW_EXTEND =
                                     &quot;selectPreviousRowExtendSelection&quot;;
        private static final String SELECT_PREVIOUS_ROW_CHANGE_LEAD =
                                     &quot;selectPreviousRowChangeLead&quot;;
        private static final String SELECT_NEXT_ROW = &quot;selectNextRow&quot;;
        private static final String SELECT_NEXT_ROW_EXTEND =
                                     &quot;selectNextRowExtendSelection&quot;;
        private static final String SELECT_NEXT_ROW_CHANGE_LEAD =
                                     &quot;selectNextRowChangeLead&quot;;
        private static final String SELECT_FIRST_ROW = &quot;selectFirstRow&quot;;
        private static final String SELECT_FIRST_ROW_EXTEND =
                                     &quot;selectFirstRowExtendSelection&quot;;
        private static final String SELECT_FIRST_ROW_CHANGE_LEAD =
                                     &quot;selectFirstRowChangeLead&quot;;
        private static final String SELECT_LAST_ROW = &quot;selectLastRow&quot;;
        private static final String SELECT_LAST_ROW_EXTEND =
                                     &quot;selectLastRowExtendSelection&quot;;
        private static final String SELECT_LAST_ROW_CHANGE_LEAD =
                                     &quot;selectLastRowChangeLead&quot;;
        private static final String SCROLL_UP = &quot;scrollUp&quot;;
        private static final String SCROLL_UP_EXTEND =
                                     &quot;scrollUpExtendSelection&quot;;
        private static final String SCROLL_UP_CHANGE_LEAD =
                                     &quot;scrollUpChangeLead&quot;;
        private static final String SCROLL_DOWN = &quot;scrollDown&quot;;
        private static final String SCROLL_DOWN_EXTEND =
                                     &quot;scrollDownExtendSelection&quot;;
        private static final String SCROLL_DOWN_CHANGE_LEAD =
                                     &quot;scrollDownChangeLead&quot;;
        private static final String SELECT_ALL = &quot;selectAll&quot;;
        private static final String CLEAR_SELECTION = &quot;clearSelection&quot;;

        // add the lead item to the selection without changing lead or anchor
        private static final String ADD_TO_SELECTION = &quot;addToSelection&quot;;

        // toggle the selected state of the lead item and move the anchor to it
        private static final String TOGGLE_AND_ANCHOR = &quot;toggleAndAnchor&quot;;

        // extend the selection to the lead item
        private static final String EXTEND_TO = &quot;extendTo&quot;;

        // move the anchor to the lead and ensure only that item is selected
        private static final String MOVE_SELECTION_TO = &quot;moveSelectionTo&quot;;

        Actions(String name) {
<span class="nc" id="L1833">            super(name);</span>
<span class="nc" id="L1834">        }</span>
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1836">            String name = getName();</span>
<span class="nc" id="L1837">            JList list = (JList)e.getSource();</span>
<span class="nc" id="L1838">            BasicListUI ui = (BasicListUI)BasicLookAndFeel.getUIOfType(</span>
<span class="nc" id="L1839">                     list.getUI(), BasicListUI.class);</span>

<span class="nc bnc" id="L1841" title="All 2 branches missed.">            if (name == SELECT_PREVIOUS_COLUMN) {</span>
<span class="nc" id="L1842">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1843">                                getNextColumnIndex(list, ui, -1), -1);</span>
            }
<span class="nc bnc" id="L1845" title="All 2 branches missed.">            else if (name == SELECT_PREVIOUS_COLUMN_EXTEND) {</span>
<span class="nc" id="L1846">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1847">                                getNextColumnIndex(list, ui, -1), -1);</span>
            }
<span class="nc bnc" id="L1849" title="All 2 branches missed.">            else if (name == SELECT_PREVIOUS_COLUMN_CHANGE_LEAD) {</span>
<span class="nc" id="L1850">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1851">                                getNextColumnIndex(list, ui, -1), -1);</span>
            }
<span class="nc bnc" id="L1853" title="All 2 branches missed.">            else if (name == SELECT_NEXT_COLUMN) {</span>
<span class="nc" id="L1854">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1855">                                getNextColumnIndex(list, ui, 1), 1);</span>
            }
<span class="nc bnc" id="L1857" title="All 2 branches missed.">            else if (name == SELECT_NEXT_COLUMN_EXTEND) {</span>
<span class="nc" id="L1858">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1859">                                getNextColumnIndex(list, ui, 1), 1);</span>
            }
<span class="nc bnc" id="L1861" title="All 2 branches missed.">            else if (name == SELECT_NEXT_COLUMN_CHANGE_LEAD) {</span>
<span class="nc" id="L1862">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1863">                                getNextColumnIndex(list, ui, 1), 1);</span>
            }
<span class="nc bnc" id="L1865" title="All 2 branches missed.">            else if (name == SELECT_PREVIOUS_ROW) {</span>
<span class="nc" id="L1866">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1867">                                getNextIndex(list, ui, -1), -1);</span>
            }
<span class="nc bnc" id="L1869" title="All 2 branches missed.">            else if (name == SELECT_PREVIOUS_ROW_EXTEND) {</span>
<span class="nc" id="L1870">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1871">                                getNextIndex(list, ui, -1), -1);</span>
            }
<span class="nc bnc" id="L1873" title="All 2 branches missed.">            else if (name == SELECT_PREVIOUS_ROW_CHANGE_LEAD) {</span>
<span class="nc" id="L1874">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1875">                                getNextIndex(list, ui, -1), -1);</span>
            }
<span class="nc bnc" id="L1877" title="All 2 branches missed.">            else if (name == SELECT_NEXT_ROW) {</span>
<span class="nc" id="L1878">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1879">                                getNextIndex(list, ui, 1), 1);</span>
            }
<span class="nc bnc" id="L1881" title="All 2 branches missed.">            else if (name == SELECT_NEXT_ROW_EXTEND) {</span>
<span class="nc" id="L1882">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1883">                                getNextIndex(list, ui, 1), 1);</span>
            }
<span class="nc bnc" id="L1885" title="All 2 branches missed.">            else if (name == SELECT_NEXT_ROW_CHANGE_LEAD) {</span>
<span class="nc" id="L1886">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1887">                                getNextIndex(list, ui, 1), 1);</span>
            }
<span class="nc bnc" id="L1889" title="All 2 branches missed.">            else if (name == SELECT_FIRST_ROW) {</span>
<span class="nc" id="L1890">                changeSelection(list, CHANGE_SELECTION, 0, -1);</span>
            }
<span class="nc bnc" id="L1892" title="All 2 branches missed.">            else if (name == SELECT_FIRST_ROW_EXTEND) {</span>
<span class="nc" id="L1893">                changeSelection(list, EXTEND_SELECTION, 0, -1);</span>
            }
<span class="nc bnc" id="L1895" title="All 2 branches missed.">            else if (name == SELECT_FIRST_ROW_CHANGE_LEAD) {</span>
<span class="nc" id="L1896">                changeSelection(list, CHANGE_LEAD, 0, -1);</span>
            }
<span class="nc bnc" id="L1898" title="All 2 branches missed.">            else if (name == SELECT_LAST_ROW) {</span>
<span class="nc" id="L1899">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1900">                                list.getModel().getSize() - 1, 1);</span>
            }
<span class="nc bnc" id="L1902" title="All 2 branches missed.">            else if (name == SELECT_LAST_ROW_EXTEND) {</span>
<span class="nc" id="L1903">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1904">                                list.getModel().getSize() - 1, 1);</span>
            }
<span class="nc bnc" id="L1906" title="All 2 branches missed.">            else if (name == SELECT_LAST_ROW_CHANGE_LEAD) {</span>
<span class="nc" id="L1907">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1908">                                list.getModel().getSize() - 1, 1);</span>
            }
<span class="nc bnc" id="L1910" title="All 2 branches missed.">            else if (name == SCROLL_UP) {</span>
<span class="nc" id="L1911">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1912">                                getNextPageIndex(list, -1), -1);</span>
            }
<span class="nc bnc" id="L1914" title="All 2 branches missed.">            else if (name == SCROLL_UP_EXTEND) {</span>
<span class="nc" id="L1915">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1916">                                getNextPageIndex(list, -1), -1);</span>
            }
<span class="nc bnc" id="L1918" title="All 2 branches missed.">            else if (name == SCROLL_UP_CHANGE_LEAD) {</span>
<span class="nc" id="L1919">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1920">                                getNextPageIndex(list, -1), -1);</span>
            }
<span class="nc bnc" id="L1922" title="All 2 branches missed.">            else if (name == SCROLL_DOWN) {</span>
<span class="nc" id="L1923">                changeSelection(list, CHANGE_SELECTION,</span>
<span class="nc" id="L1924">                                getNextPageIndex(list, 1), 1);</span>
            }
<span class="nc bnc" id="L1926" title="All 2 branches missed.">            else if (name == SCROLL_DOWN_EXTEND) {</span>
<span class="nc" id="L1927">                changeSelection(list, EXTEND_SELECTION,</span>
<span class="nc" id="L1928">                                getNextPageIndex(list, 1), 1);</span>
            }
<span class="nc bnc" id="L1930" title="All 2 branches missed.">            else if (name == SCROLL_DOWN_CHANGE_LEAD) {</span>
<span class="nc" id="L1931">                changeSelection(list, CHANGE_LEAD,</span>
<span class="nc" id="L1932">                                getNextPageIndex(list, 1), 1);</span>
            }
<span class="nc bnc" id="L1934" title="All 2 branches missed.">            else if (name == SELECT_ALL) {</span>
<span class="nc" id="L1935">                selectAll(list);</span>
            }
<span class="nc bnc" id="L1937" title="All 2 branches missed.">            else if (name == CLEAR_SELECTION) {</span>
<span class="nc" id="L1938">                clearSelection(list);</span>
            }
<span class="nc bnc" id="L1940" title="All 2 branches missed.">            else if (name == ADD_TO_SELECTION) {</span>
<span class="nc" id="L1941">                int index = adjustIndex(</span>
<span class="nc" id="L1942">                    list.getSelectionModel().getLeadSelectionIndex(), list);</span>

<span class="nc bnc" id="L1944" title="All 2 branches missed.">                if (!list.isSelectedIndex(index)) {</span>
<span class="nc" id="L1945">                    int oldAnchor = list.getSelectionModel().getAnchorSelectionIndex();</span>
<span class="nc" id="L1946">                    list.setValueIsAdjusting(true);</span>
<span class="nc" id="L1947">                    list.addSelectionInterval(index, index);</span>
<span class="nc" id="L1948">                    list.getSelectionModel().setAnchorSelectionIndex(oldAnchor);</span>
<span class="nc" id="L1949">                    list.setValueIsAdjusting(false);</span>
                }
<span class="nc" id="L1951">            }</span>
<span class="nc bnc" id="L1952" title="All 2 branches missed.">            else if (name == TOGGLE_AND_ANCHOR) {</span>
<span class="nc" id="L1953">                int index = adjustIndex(</span>
<span class="nc" id="L1954">                    list.getSelectionModel().getLeadSelectionIndex(), list);</span>

<span class="nc bnc" id="L1956" title="All 2 branches missed.">                if (list.isSelectedIndex(index)) {</span>
<span class="nc" id="L1957">                    list.removeSelectionInterval(index, index);</span>
                } else {
<span class="nc" id="L1959">                    list.addSelectionInterval(index, index);</span>
                }
<span class="nc" id="L1961">            }</span>
<span class="nc bnc" id="L1962" title="All 2 branches missed.">            else if (name == EXTEND_TO) {</span>
<span class="nc" id="L1963">                changeSelection(</span>
                    list, EXTEND_SELECTION,
<span class="nc" id="L1965">                    adjustIndex(list.getSelectionModel().getLeadSelectionIndex(), list),</span>
                    0);
            }
<span class="nc bnc" id="L1968" title="All 2 branches missed.">            else if (name == MOVE_SELECTION_TO) {</span>
<span class="nc" id="L1969">                changeSelection(</span>
                    list, CHANGE_SELECTION,
<span class="nc" id="L1971">                    adjustIndex(list.getSelectionModel().getLeadSelectionIndex(), list),</span>
                    0);
            }
<span class="nc" id="L1974">        }</span>

        public boolean isEnabled(Object c) {
<span class="nc" id="L1977">            Object name = getName();</span>
<span class="nc bnc" id="L1978" title="All 16 branches missed.">            if (name == SELECT_PREVIOUS_COLUMN_CHANGE_LEAD ||</span>
                    name == SELECT_NEXT_COLUMN_CHANGE_LEAD ||
                    name == SELECT_PREVIOUS_ROW_CHANGE_LEAD ||
                    name == SELECT_NEXT_ROW_CHANGE_LEAD ||
                    name == SELECT_FIRST_ROW_CHANGE_LEAD ||
                    name == SELECT_LAST_ROW_CHANGE_LEAD ||
                    name == SCROLL_UP_CHANGE_LEAD ||
                    name == SCROLL_DOWN_CHANGE_LEAD) {

                // discontinuous selection actions are only enabled for
                // DefaultListSelectionModel
<span class="nc bnc" id="L1989" title="All 4 branches missed.">                return c != null &amp;&amp; ((JList)c).getSelectionModel()</span>
                                        instanceof DefaultListSelectionModel;
            }

<span class="nc" id="L1993">            return true;</span>
        }

        private void clearSelection(JList list) {
<span class="nc" id="L1997">            list.clearSelection();</span>
<span class="nc" id="L1998">        }</span>

        private void selectAll(JList list) {
<span class="nc" id="L2001">            int size = list.getModel().getSize();</span>
<span class="nc bnc" id="L2002" title="All 2 branches missed.">            if (size &gt; 0) {</span>
<span class="nc" id="L2003">                ListSelectionModel lsm = list.getSelectionModel();</span>
<span class="nc" id="L2004">                int lead = adjustIndex(lsm.getLeadSelectionIndex(), list);</span>

<span class="nc bnc" id="L2006" title="All 2 branches missed.">                if (lsm.getSelectionMode() == ListSelectionModel.SINGLE_SELECTION) {</span>
<span class="nc bnc" id="L2007" title="All 2 branches missed.">                    if (lead == -1) {</span>
<span class="nc" id="L2008">                        int min = adjustIndex(list.getMinSelectionIndex(), list);</span>
<span class="nc bnc" id="L2009" title="All 2 branches missed.">                        lead = (min == -1 ? 0 : min);</span>
                    }

<span class="nc" id="L2012">                    list.setSelectionInterval(lead, lead);</span>
<span class="nc" id="L2013">                    list.ensureIndexIsVisible(lead);</span>
                } else {
<span class="nc" id="L2015">                    list.setValueIsAdjusting(true);</span>

<span class="nc" id="L2017">                    int anchor = adjustIndex(lsm.getAnchorSelectionIndex(), list);</span>

<span class="nc" id="L2019">                    list.setSelectionInterval(0, size - 1);</span>

                    // this is done to restore the anchor and lead
<span class="nc" id="L2022">                    SwingUtilities2.setLeadAnchorWithoutSelection(lsm, anchor, lead);</span>

<span class="nc" id="L2024">                    list.setValueIsAdjusting(false);</span>
                }
            }
<span class="nc" id="L2027">        }</span>

        private int getNextPageIndex(JList list, int direction) {
<span class="nc bnc" id="L2030" title="All 2 branches missed.">            if (list.getModel().getSize() == 0) {</span>
<span class="nc" id="L2031">                return -1;</span>
            }

<span class="nc" id="L2034">            int index = -1;</span>
<span class="nc" id="L2035">            Rectangle visRect = list.getVisibleRect();</span>
<span class="nc" id="L2036">            ListSelectionModel lsm = list.getSelectionModel();</span>
<span class="nc" id="L2037">            int lead = adjustIndex(lsm.getLeadSelectionIndex(), list);</span>
<span class="nc bnc" id="L2038" title="All 2 branches missed.">            Rectangle leadRect =</span>
<span class="nc" id="L2039">                (lead==-1) ? new Rectangle() : list.getCellBounds(lead, lead);</span>

<span class="nc bnc" id="L2041" title="All 2 branches missed.">            if (list.getLayoutOrientation() == JList.VERTICAL_WRAP &amp;&amp;</span>
<span class="nc bnc" id="L2042" title="All 2 branches missed.">                list.getVisibleRowCount() &lt;= 0) {</span>
<span class="nc bnc" id="L2043" title="All 2 branches missed.">                if (!list.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L2044">                    direction = -direction;</span>
                }
                // apply for horizontal scrolling: the step for next
                // page index is number of visible columns
<span class="nc bnc" id="L2048" title="All 2 branches missed.">                if (direction &lt; 0) {</span>
                    // left
<span class="nc" id="L2050">                    visRect.x = leadRect.x + leadRect.width - visRect.width;</span>
<span class="nc" id="L2051">                    Point p = new Point(visRect.x - 1, leadRect.y);</span>
<span class="nc" id="L2052">                    index = list.locationToIndex(p);</span>
<span class="nc" id="L2053">                    Rectangle cellBounds = list.getCellBounds(index, index);</span>
<span class="nc bnc" id="L2054" title="All 2 branches missed.">                    if (visRect.intersects(cellBounds)) {</span>
<span class="nc" id="L2055">                        p.x = cellBounds.x - 1;</span>
<span class="nc" id="L2056">                        index = list.locationToIndex(p);</span>
<span class="nc" id="L2057">                        cellBounds = list.getCellBounds(index, index);</span>
                    }
                    // this is necessary for right-to-left orientation only
<span class="nc bnc" id="L2060" title="All 2 branches missed.">                    if (cellBounds.y != leadRect.y) {</span>
<span class="nc" id="L2061">                        p.x = cellBounds.x + cellBounds.width;</span>
<span class="nc" id="L2062">                        index = list.locationToIndex(p);</span>
                    }
<span class="nc" id="L2064">                }</span>
                else {
                    // right
<span class="nc" id="L2067">                    visRect.x = leadRect.x;</span>
<span class="nc" id="L2068">                    Point p = new Point(visRect.x + visRect.width, leadRect.y);</span>
<span class="nc" id="L2069">                    index = list.locationToIndex(p);</span>
<span class="nc" id="L2070">                    Rectangle cellBounds = list.getCellBounds(index, index);</span>
<span class="nc bnc" id="L2071" title="All 2 branches missed.">                    if (visRect.intersects(cellBounds)) {</span>
<span class="nc" id="L2072">                        p.x = cellBounds.x + cellBounds.width;</span>
<span class="nc" id="L2073">                        index = list.locationToIndex(p);</span>
<span class="nc" id="L2074">                        cellBounds = list.getCellBounds(index, index);</span>
                    }
<span class="nc bnc" id="L2076" title="All 2 branches missed.">                    if (cellBounds.y != leadRect.y) {</span>
<span class="nc" id="L2077">                        p.x = cellBounds.x - 1;</span>
<span class="nc" id="L2078">                        index = list.locationToIndex(p);</span>
                    }
<span class="nc" id="L2080">                }</span>
            }
            else {
<span class="nc bnc" id="L2083" title="All 2 branches missed.">                if (direction &lt; 0) {</span>
                    // up
                    // go to the first visible cell
<span class="nc" id="L2086">                    Point p = new Point(leadRect.x, visRect.y);</span>
<span class="nc" id="L2087">                    index = list.locationToIndex(p);</span>
<span class="nc bnc" id="L2088" title="All 2 branches missed.">                    if (lead &lt;= index) {</span>
                        // if lead is the first visible cell (or above it)
                        // adjust the visible rect up
<span class="nc" id="L2091">                        visRect.y = leadRect.y + leadRect.height - visRect.height;</span>
<span class="nc" id="L2092">                        p.y = visRect.y;</span>
<span class="nc" id="L2093">                        index = list.locationToIndex(p);</span>
<span class="nc" id="L2094">                        Rectangle cellBounds = list.getCellBounds(index, index);</span>
                        // go one cell down if first visible cell doesn't fit
                        // into adjasted visible rectangle
<span class="nc bnc" id="L2097" title="All 2 branches missed.">                        if (cellBounds.y &lt; visRect.y) {</span>
<span class="nc" id="L2098">                            p.y = cellBounds.y + cellBounds.height;</span>
<span class="nc" id="L2099">                            index = list.locationToIndex(p);</span>
<span class="nc" id="L2100">                            cellBounds = list.getCellBounds(index, index);</span>
                        }
                        // if index isn't less then lead
                        // try to go to cell previous to lead
<span class="nc bnc" id="L2104" title="All 2 branches missed.">                        if (cellBounds.y &gt;= leadRect.y) {</span>
<span class="nc" id="L2105">                            p.y = leadRect.y - 1;</span>
<span class="nc" id="L2106">                            index = list.locationToIndex(p);</span>
                        }
                    }
<span class="nc" id="L2109">                }</span>
                else {
                    // down
                    // go to the last completely visible cell
<span class="nc" id="L2113">                    Point p = new Point(leadRect.x,</span>
                                        visRect.y + visRect.height - 1);
<span class="nc" id="L2115">                    index = list.locationToIndex(p);</span>
<span class="nc" id="L2116">                    Rectangle cellBounds = list.getCellBounds(index, index);</span>
                    // go up one cell if last visible cell doesn't fit
                    // into visible rectangle
<span class="nc bnc" id="L2119" title="All 2 branches missed.">                    if (cellBounds.y + cellBounds.height &gt;</span>
                        visRect.y + visRect.height) {
<span class="nc" id="L2121">                        p.y = cellBounds.y - 1;</span>
<span class="nc" id="L2122">                        index = list.locationToIndex(p);</span>
<span class="nc" id="L2123">                        cellBounds = list.getCellBounds(index, index);</span>
<span class="nc" id="L2124">                        index = Math.max(index, lead);</span>
                    }

<span class="nc bnc" id="L2127" title="All 2 branches missed.">                    if (lead &gt;= index) {</span>
                        // if lead is the last completely visible index
                        // (or below it) adjust the visible rect down
<span class="nc" id="L2130">                        visRect.y = leadRect.y;</span>
<span class="nc" id="L2131">                        p.y = visRect.y + visRect.height - 1;</span>
<span class="nc" id="L2132">                        index = list.locationToIndex(p);</span>
<span class="nc" id="L2133">                        cellBounds = list.getCellBounds(index, index);</span>
                        // go one cell up if last visible cell doesn't fit
                        // into adjasted visible rectangle
<span class="nc bnc" id="L2136" title="All 2 branches missed.">                        if (cellBounds.y + cellBounds.height &gt;</span>
                            visRect.y + visRect.height) {
<span class="nc" id="L2138">                            p.y = cellBounds.y - 1;</span>
<span class="nc" id="L2139">                            index = list.locationToIndex(p);</span>
<span class="nc" id="L2140">                            cellBounds = list.getCellBounds(index, index);</span>
                        }
                        // if index isn't greater then lead
                        // try to go to cell next after lead
<span class="nc bnc" id="L2144" title="All 2 branches missed.">                        if (cellBounds.y &lt;= leadRect.y) {</span>
<span class="nc" id="L2145">                            p.y = leadRect.y + leadRect.height;</span>
<span class="nc" id="L2146">                            index = list.locationToIndex(p);</span>
                        }
                    }
                }
            }
<span class="nc" id="L2151">            return index;</span>
        }

        private void changeSelection(JList list, int type,
                                     int index, int direction) {
<span class="nc bnc" id="L2156" title="All 4 branches missed.">            if (index &gt;= 0 &amp;&amp; index &lt; list.getModel().getSize()) {</span>
<span class="nc" id="L2157">                ListSelectionModel lsm = list.getSelectionModel();</span>

                // CHANGE_LEAD is only valid with multiple interval selection
<span class="nc bnc" id="L2160" title="All 2 branches missed.">                if (type == CHANGE_LEAD &amp;&amp;</span>
<span class="nc bnc" id="L2161" title="All 2 branches missed.">                        list.getSelectionMode()</span>
                            != ListSelectionModel.MULTIPLE_INTERVAL_SELECTION) {

<span class="nc" id="L2164">                    type = CHANGE_SELECTION;</span>
                }

                // IMPORTANT - This needs to happen before the index is changed.
                // This is because JFileChooser, which uses JList, also scrolls
                // the selected item into view. If that happens first, then
                // this method becomes a no-op.
<span class="nc" id="L2171">                adjustScrollPositionIfNecessary(list, index, direction);</span>

<span class="nc bnc" id="L2173" title="All 2 branches missed.">                if (type == EXTEND_SELECTION) {</span>
<span class="nc" id="L2174">                    int anchor = adjustIndex(lsm.getAnchorSelectionIndex(), list);</span>
<span class="nc bnc" id="L2175" title="All 2 branches missed.">                    if (anchor == -1) {</span>
<span class="nc" id="L2176">                        anchor = 0;</span>
                    }

<span class="nc" id="L2179">                    list.setSelectionInterval(anchor, index);</span>
<span class="nc" id="L2180">                }</span>
<span class="nc bnc" id="L2181" title="All 2 branches missed.">                else if (type == CHANGE_SELECTION) {</span>
<span class="nc" id="L2182">                    list.setSelectedIndex(index);</span>
                }
                else {
                    // casting should be safe since the action is only enabled
                    // for DefaultListSelectionModel
<span class="nc" id="L2187">                    ((DefaultListSelectionModel)lsm).moveLeadSelectionIndex(index);</span>
                }
            }
<span class="nc" id="L2190">        }</span>

        /**
         * When scroll down makes selected index the last completely visible
         * index. When scroll up makes selected index the first visible index.
         * Adjust visible rectangle respect to list's component orientation.
         */
        private void adjustScrollPositionIfNecessary(JList list, int index,
                                                     int direction) {
<span class="nc bnc" id="L2199" title="All 2 branches missed.">            if (direction == 0) {</span>
<span class="nc" id="L2200">                return;</span>
            }
<span class="nc" id="L2202">            Rectangle cellBounds = list.getCellBounds(index, index);</span>
<span class="nc" id="L2203">            Rectangle visRect = list.getVisibleRect();</span>
<span class="nc bnc" id="L2204" title="All 4 branches missed.">            if (cellBounds != null &amp;&amp; !visRect.contains(cellBounds)) {</span>
<span class="nc bnc" id="L2205" title="All 2 branches missed.">                if (list.getLayoutOrientation() == JList.VERTICAL_WRAP &amp;&amp;</span>
<span class="nc bnc" id="L2206" title="All 2 branches missed.">                    list.getVisibleRowCount() &lt;= 0) {</span>
                    // horizontal
<span class="nc bnc" id="L2208" title="All 2 branches missed.">                    if (list.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc bnc" id="L2209" title="All 2 branches missed.">                        if (direction &gt; 0) {</span>
                            // right for left-to-right
<span class="nc" id="L2211">                            int x =Math.max(0,</span>
                                cellBounds.x + cellBounds.width - visRect.width);
<span class="nc" id="L2213">                            int startIndex =</span>
<span class="nc" id="L2214">                                list.locationToIndex(new Point(x, cellBounds.y));</span>
<span class="nc" id="L2215">                            Rectangle startRect = list.getCellBounds(startIndex,</span>
                                                                     startIndex);
<span class="nc bnc" id="L2217" title="All 4 branches missed.">                            if (startRect.x &lt; x &amp;&amp; startRect.x &lt; cellBounds.x) {</span>
<span class="nc" id="L2218">                                startRect.x += startRect.width;</span>
<span class="nc" id="L2219">                                startIndex =</span>
<span class="nc" id="L2220">                                    list.locationToIndex(startRect.getLocation());</span>
<span class="nc" id="L2221">                                startRect = list.getCellBounds(startIndex,</span>
                                                               startIndex);
                            }
<span class="nc" id="L2224">                            cellBounds = startRect;</span>
                        }
<span class="nc" id="L2226">                        cellBounds.width = visRect.width;</span>
                    }
                    else {
<span class="nc bnc" id="L2229" title="All 2 branches missed.">                        if (direction &gt; 0) {</span>
                            // left for right-to-left
<span class="nc" id="L2231">                            int x = cellBounds.x + visRect.width;</span>
<span class="nc" id="L2232">                            int rightIndex =</span>
<span class="nc" id="L2233">                                list.locationToIndex(new Point(x, cellBounds.y));</span>
<span class="nc" id="L2234">                            Rectangle rightRect = list.getCellBounds(rightIndex,</span>
                                                                     rightIndex);
<span class="nc bnc" id="L2236" title="All 4 branches missed.">                            if (rightRect.x + rightRect.width &gt; x &amp;&amp;</span>
                                rightRect.x &gt; cellBounds.x) {
<span class="nc" id="L2238">                                rightRect.width = 0;</span>
                            }
<span class="nc" id="L2240">                            cellBounds.x = Math.max(0,</span>
                                rightRect.x + rightRect.width - visRect.width);
<span class="nc" id="L2242">                            cellBounds.width = visRect.width;</span>
<span class="nc" id="L2243">                        }</span>
                        else {
<span class="nc" id="L2245">                            cellBounds.x += Math.max(0,</span>
                                cellBounds.width - visRect.width);
                            // adjust width to fit into visible rectangle
<span class="nc" id="L2248">                            cellBounds.width = Math.min(cellBounds.width,</span>
                                                        visRect.width);
                        }
                    }
                }
                else {
                    // vertical
<span class="nc bnc" id="L2255" title="All 6 branches missed.">                    if (direction &gt; 0 &amp;&amp;</span>
                            (cellBounds.y &lt; visRect.y ||
                                    cellBounds.y + cellBounds.height
                                            &gt; visRect.y + visRect.height)) {
                        //down
<span class="nc" id="L2260">                        int y = Math.max(0,</span>
                            cellBounds.y + cellBounds.height - visRect.height);
<span class="nc" id="L2262">                        int startIndex =</span>
<span class="nc" id="L2263">                            list.locationToIndex(new Point(cellBounds.x, y));</span>
<span class="nc" id="L2264">                        Rectangle startRect = list.getCellBounds(startIndex,</span>
                                                                 startIndex);
<span class="nc bnc" id="L2266" title="All 4 branches missed.">                        if (startRect.y &lt; y &amp;&amp; startRect.y &lt; cellBounds.y) {</span>
<span class="nc" id="L2267">                            startRect.y += startRect.height;</span>
<span class="nc" id="L2268">                            startIndex =</span>
<span class="nc" id="L2269">                                list.locationToIndex(startRect.getLocation());</span>
<span class="nc" id="L2270">                            startRect =</span>
<span class="nc" id="L2271">                                list.getCellBounds(startIndex, startIndex);</span>
                        }
<span class="nc" id="L2273">                        cellBounds = startRect;</span>
<span class="nc" id="L2274">                        cellBounds.height = visRect.height;</span>
<span class="nc" id="L2275">                    }</span>
                    else {
                        // adjust height to fit into visible rectangle
<span class="nc" id="L2278">                        cellBounds.height = Math.min(cellBounds.height, visRect.height);</span>
                    }
                }
<span class="nc" id="L2281">                list.scrollRectToVisible(cellBounds);</span>
            }
<span class="nc" id="L2283">        }</span>

        private int getNextColumnIndex(JList list, BasicListUI ui,
                                       int amount) {
<span class="nc bnc" id="L2287" title="All 2 branches missed.">            if (list.getLayoutOrientation() != JList.VERTICAL) {</span>
<span class="nc" id="L2288">                int index = adjustIndex(list.getLeadSelectionIndex(), list);</span>
<span class="nc" id="L2289">                int size = list.getModel().getSize();</span>

<span class="nc bnc" id="L2291" title="All 2 branches missed.">                if (index == -1) {</span>
<span class="nc" id="L2292">                    return 0;</span>
<span class="nc bnc" id="L2293" title="All 2 branches missed.">                } else if (size == 1) {</span>
                    // there's only one item so we should select it
<span class="nc" id="L2295">                    return 0;</span>
<span class="nc bnc" id="L2296" title="All 4 branches missed.">                } else if (ui == null || ui.columnCount &lt;= 1) {</span>
<span class="nc" id="L2297">                    return -1;</span>
                }

<span class="nc" id="L2300">                int column = ui.convertModelToColumn(index);</span>
<span class="nc" id="L2301">                int row = ui.convertModelToRow(index);</span>

<span class="nc" id="L2303">                column += amount;</span>
<span class="nc bnc" id="L2304" title="All 4 branches missed.">                if (column &gt;= ui.columnCount || column &lt; 0) {</span>
                    // No wrapping.
<span class="nc" id="L2306">                    return -1;</span>
                }
<span class="nc" id="L2308">                int maxRowCount = ui.getRowCount(column);</span>
<span class="nc bnc" id="L2309" title="All 2 branches missed.">                if (row &gt;= maxRowCount) {</span>
<span class="nc" id="L2310">                    return -1;</span>
                }
<span class="nc" id="L2312">                return ui.getModelIndex(column, row);</span>
            }
            // Won't change the selection.
<span class="nc" id="L2315">            return -1;</span>
        }

        private int getNextIndex(JList list, BasicListUI ui, int amount) {
<span class="nc" id="L2319">            int index = adjustIndex(list.getLeadSelectionIndex(), list);</span>
<span class="nc" id="L2320">            int size = list.getModel().getSize();</span>

<span class="nc bnc" id="L2322" title="All 2 branches missed.">            if (index == -1) {</span>
<span class="nc bnc" id="L2323" title="All 2 branches missed.">                if (size &gt; 0) {</span>
<span class="nc bnc" id="L2324" title="All 2 branches missed.">                    if (amount &gt; 0) {</span>
<span class="nc" id="L2325">                        index = 0;</span>
                    }
                    else {
<span class="nc" id="L2328">                        index = size - 1;</span>
                    }
                }
<span class="nc bnc" id="L2331" title="All 2 branches missed.">            } else if (size == 1) {</span>
                // there's only one item so we should select it
<span class="nc" id="L2333">                index = 0;</span>
<span class="nc bnc" id="L2334" title="All 2 branches missed.">            } else if (list.getLayoutOrientation() == JList.HORIZONTAL_WRAP) {</span>
<span class="nc bnc" id="L2335" title="All 2 branches missed.">                if (ui != null) {</span>
<span class="nc" id="L2336">                    index += ui.columnCount * amount;</span>
                }
            } else {
<span class="nc" id="L2339">                index += amount;</span>
            }

<span class="nc" id="L2342">            return index;</span>
        }
    }


<span class="nc" id="L2347">    private class Handler implements FocusListener, KeyListener,</span>
                          ListDataListener, ListSelectionListener,
                          MouseInputListener, PropertyChangeListener,
                          BeforeDrag {
        //
        // KeyListener
        //
<span class="nc" id="L2354">        private String prefix = &quot;&quot;;</span>
<span class="nc" id="L2355">        private String typedString = &quot;&quot;;</span>
<span class="nc" id="L2356">        private long lastTime = 0L;</span>

        /**
         * Invoked when a key has been typed.
         *
         * Moves the keyboard focus to the first element whose prefix matches the
         * sequence of alphanumeric keys pressed by the user with delay less
         * than value of &lt;code&gt;timeFactor&lt;/code&gt; property (or 1000 milliseconds
         * if it is not defined). Subsequent same key presses move the keyboard
         * focus to the next object that starts with the same letter until another
         * key is pressed, then it is treated as the prefix with appropriate number
         * of the same letters followed by first typed another letter.
         */
        public void keyTyped(KeyEvent e) {
<span class="nc" id="L2370">            JList src = (JList)e.getSource();</span>
<span class="nc" id="L2371">            ListModel model = src.getModel();</span>

<span class="nc bnc" id="L2373" title="All 4 branches missed.">            if (model.getSize() == 0 || e.isAltDown() ||</span>
<span class="nc bnc" id="L2374" title="All 2 branches missed.">                    BasicGraphicsUtils.isMenuShortcutKeyDown(e) ||</span>
<span class="nc bnc" id="L2375" title="All 2 branches missed.">                    isNavigationKey(e)) {</span>
                // Nothing to select
<span class="nc" id="L2377">                return;</span>
            }
<span class="nc" id="L2379">            boolean startingFromSelection = true;</span>

<span class="nc" id="L2381">            char c = e.getKeyChar();</span>

<span class="nc" id="L2383">            long time = e.getWhen();</span>
<span class="nc" id="L2384">            int startIndex = adjustIndex(src.getLeadSelectionIndex(), list);</span>
<span class="nc bnc" id="L2385" title="All 2 branches missed.">            if (time - lastTime &lt; timeFactor) {</span>
<span class="nc" id="L2386">                typedString += c;</span>
<span class="nc bnc" id="L2387" title="All 4 branches missed.">                if((prefix.length() == 1) &amp;&amp; (c == prefix.charAt(0))) {</span>
                    // Subsequent same key presses move the keyboard focus to the next
                    // object that starts with the same letter.
<span class="nc" id="L2390">                    startIndex++;</span>
                } else {
<span class="nc" id="L2392">                    prefix = typedString;</span>
                }
            } else {
<span class="nc" id="L2395">                startIndex++;</span>
<span class="nc" id="L2396">                typedString = &quot;&quot; + c;</span>
<span class="nc" id="L2397">                prefix = typedString;</span>
            }
<span class="nc" id="L2399">            lastTime = time;</span>

<span class="nc bnc" id="L2401" title="All 4 branches missed.">            if (startIndex &lt; 0 || startIndex &gt;= model.getSize()) {</span>
<span class="nc" id="L2402">                startingFromSelection = false;</span>
<span class="nc" id="L2403">                startIndex = 0;</span>
            }
<span class="nc" id="L2405">            int index = src.getNextMatch(prefix, startIndex,</span>
                                         Position.Bias.Forward);
<span class="nc bnc" id="L2407" title="All 2 branches missed.">            if (index &gt;= 0) {</span>
<span class="nc" id="L2408">                src.setSelectedIndex(index);</span>
<span class="nc" id="L2409">                src.ensureIndexIsVisible(index);</span>
<span class="nc bnc" id="L2410" title="All 2 branches missed.">            } else if (startingFromSelection) { // wrap</span>
<span class="nc" id="L2411">                index = src.getNextMatch(prefix, 0,</span>
                                         Position.Bias.Forward);
<span class="nc bnc" id="L2413" title="All 2 branches missed.">                if (index &gt;= 0) {</span>
<span class="nc" id="L2414">                    src.setSelectedIndex(index);</span>
<span class="nc" id="L2415">                    src.ensureIndexIsVisible(index);</span>
                }
            }
<span class="nc" id="L2418">        }</span>

        /**
         * Invoked when a key has been pressed.
         *
         * Checks to see if the key event is a navigation key to prevent
         * dispatching these keys for the first letter navigation.
         */
        public void keyPressed(KeyEvent e) {
<span class="nc bnc" id="L2427" title="All 2 branches missed.">            if ( isNavigationKey(e) ) {</span>
<span class="nc" id="L2428">                prefix = &quot;&quot;;</span>
<span class="nc" id="L2429">                typedString = &quot;&quot;;</span>
<span class="nc" id="L2430">                lastTime = 0L;</span>
            }
<span class="nc" id="L2432">        }</span>

        /**
         * Invoked when a key has been released.
         * See the class description for {@link KeyEvent} for a definition of
         * a key released event.
         */
        public void keyReleased(KeyEvent e) {
<span class="nc" id="L2440">        }</span>

        /**
         * Returns whether or not the supplied key event maps to a key that is used for
         * navigation.  This is used for optimizing key input by only passing non-
         * navigation keys to the first letter navigation mechanism.
         */
        private boolean isNavigationKey(KeyEvent event) {
<span class="nc" id="L2448">            InputMap inputMap = list.getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);</span>
<span class="nc" id="L2449">            KeyStroke key = KeyStroke.getKeyStrokeForEvent(event);</span>

<span class="nc bnc" id="L2451" title="All 4 branches missed.">            if (inputMap != null &amp;&amp; inputMap.get(key) != null) {</span>
<span class="nc" id="L2452">                return true;</span>
            }
<span class="nc" id="L2454">            return false;</span>
        }

        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L2461">            String propertyName = e.getPropertyName();</span>

            /* If the JList.model property changes, remove our listener,
             * listDataListener from the old model and add it to the new one.
             */
<span class="nc bnc" id="L2466" title="All 2 branches missed.">            if (propertyName == &quot;model&quot;) {</span>
<span class="nc" id="L2467">                ListModel oldModel = (ListModel)e.getOldValue();</span>
<span class="nc" id="L2468">                ListModel newModel = (ListModel)e.getNewValue();</span>
<span class="nc bnc" id="L2469" title="All 2 branches missed.">                if (oldModel != null) {</span>
<span class="nc" id="L2470">                    oldModel.removeListDataListener(listDataListener);</span>
                }
<span class="nc bnc" id="L2472" title="All 2 branches missed.">                if (newModel != null) {</span>
<span class="nc" id="L2473">                    newModel.addListDataListener(listDataListener);</span>
                }
<span class="nc" id="L2475">                updateLayoutStateNeeded |= modelChanged;</span>
<span class="nc" id="L2476">                redrawList();</span>
<span class="nc" id="L2477">            }</span>

            /* If the JList.selectionModel property changes, remove our listener,
             * listSelectionListener from the old selectionModel and add it to the new one.
             */
<span class="nc bnc" id="L2482" title="All 2 branches missed.">            else if (propertyName == &quot;selectionModel&quot;) {</span>
<span class="nc" id="L2483">                ListSelectionModel oldModel = (ListSelectionModel)e.getOldValue();</span>
<span class="nc" id="L2484">                ListSelectionModel newModel = (ListSelectionModel)e.getNewValue();</span>
<span class="nc bnc" id="L2485" title="All 2 branches missed.">                if (oldModel != null) {</span>
<span class="nc" id="L2486">                    oldModel.removeListSelectionListener(listSelectionListener);</span>
                }
<span class="nc bnc" id="L2488" title="All 2 branches missed.">                if (newModel != null) {</span>
<span class="nc" id="L2489">                    newModel.addListSelectionListener(listSelectionListener);</span>
                }
<span class="nc" id="L2491">                updateLayoutStateNeeded |= modelChanged;</span>
<span class="nc" id="L2492">                redrawList();</span>
<span class="nc" id="L2493">            }</span>
<span class="nc bnc" id="L2494" title="All 2 branches missed.">            else if (propertyName == &quot;cellRenderer&quot;) {</span>
<span class="nc" id="L2495">                updateLayoutStateNeeded |= cellRendererChanged;</span>
<span class="nc" id="L2496">                redrawList();</span>
            }
<span class="nc bnc" id="L2498" title="All 2 branches missed.">            else if (propertyName == &quot;font&quot;) {</span>
<span class="nc" id="L2499">                updateLayoutStateNeeded |= fontChanged;</span>
<span class="nc" id="L2500">                redrawList();</span>
            }
<span class="nc bnc" id="L2502" title="All 2 branches missed.">            else if (propertyName == &quot;prototypeCellValue&quot;) {</span>
<span class="nc" id="L2503">                updateLayoutStateNeeded |= prototypeCellValueChanged;</span>
<span class="nc" id="L2504">                redrawList();</span>
            }
<span class="nc bnc" id="L2506" title="All 2 branches missed.">            else if (propertyName == &quot;fixedCellHeight&quot;) {</span>
<span class="nc" id="L2507">                updateLayoutStateNeeded |= fixedCellHeightChanged;</span>
<span class="nc" id="L2508">                redrawList();</span>
            }
<span class="nc bnc" id="L2510" title="All 2 branches missed.">            else if (propertyName == &quot;fixedCellWidth&quot;) {</span>
<span class="nc" id="L2511">                updateLayoutStateNeeded |= fixedCellWidthChanged;</span>
<span class="nc" id="L2512">                redrawList();</span>
            }
<span class="nc bnc" id="L2514" title="All 2 branches missed.">            else if (propertyName == &quot;selectionForeground&quot;) {</span>
<span class="nc" id="L2515">                list.repaint();</span>
            }
<span class="nc bnc" id="L2517" title="All 2 branches missed.">            else if (propertyName == &quot;selectionBackground&quot;) {</span>
<span class="nc" id="L2518">                list.repaint();</span>
            }
<span class="nc bnc" id="L2520" title="All 2 branches missed.">            else if (&quot;layoutOrientation&quot; == propertyName) {</span>
<span class="nc" id="L2521">                updateLayoutStateNeeded |= layoutOrientationChanged;</span>
<span class="nc" id="L2522">                layoutOrientation = list.getLayoutOrientation();</span>
<span class="nc" id="L2523">                redrawList();</span>
            }
<span class="nc bnc" id="L2525" title="All 2 branches missed.">            else if (&quot;visibleRowCount&quot; == propertyName) {</span>
<span class="nc bnc" id="L2526" title="All 2 branches missed.">                if (layoutOrientation != JList.VERTICAL) {</span>
<span class="nc" id="L2527">                    updateLayoutStateNeeded |= layoutOrientationChanged;</span>
<span class="nc" id="L2528">                    redrawList();</span>
                }
            }
<span class="nc bnc" id="L2531" title="All 2 branches missed.">            else if (&quot;componentOrientation&quot; == propertyName) {</span>
<span class="nc" id="L2532">                isLeftToRight = list.getComponentOrientation().isLeftToRight();</span>
<span class="nc" id="L2533">                updateLayoutStateNeeded |= componentOrientationChanged;</span>
<span class="nc" id="L2534">                redrawList();</span>

<span class="nc" id="L2536">                InputMap inputMap = getInputMap(JComponent.WHEN_FOCUSED);</span>
<span class="nc" id="L2537">                SwingUtilities.replaceUIInputMap(list, JComponent.WHEN_FOCUSED,</span>
                                                 inputMap);
<span class="nc bnc" id="L2539" title="All 2 branches missed.">            } else if (&quot;List.isFileList&quot; == propertyName) {</span>
<span class="nc" id="L2540">                updateIsFileList();</span>
<span class="nc" id="L2541">                redrawList();</span>
<span class="nc bnc" id="L2542" title="All 2 branches missed.">            } else if (&quot;dropLocation&quot; == propertyName) {</span>
<span class="nc" id="L2543">                JList.DropLocation oldValue = (JList.DropLocation)e.getOldValue();</span>
<span class="nc" id="L2544">                repaintDropLocation(oldValue);</span>
<span class="nc" id="L2545">                repaintDropLocation(list.getDropLocation());</span>
            }
<span class="nc" id="L2547">        }</span>

        private void repaintDropLocation(JList.DropLocation loc) {
<span class="nc bnc" id="L2550" title="All 2 branches missed.">            if (loc == null) {</span>
<span class="nc" id="L2551">                return;</span>
            }

            Rectangle r;

<span class="nc bnc" id="L2556" title="All 2 branches missed.">            if (loc.isInsert()) {</span>
<span class="nc" id="L2557">                r = getDropLineRect(loc);</span>
            } else {
<span class="nc" id="L2559">                r = getCellBounds(list, loc.getIndex());</span>
            }

<span class="nc bnc" id="L2562" title="All 2 branches missed.">            if (r != null) {</span>
<span class="nc" id="L2563">                list.repaint(r);</span>
            }
<span class="nc" id="L2565">        }</span>

        //
        // ListDataListener
        //
        public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L2571">            updateLayoutStateNeeded = modelChanged;</span>

<span class="nc" id="L2573">            int minIndex = Math.min(e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L2574">            int maxIndex = Math.max(e.getIndex0(), e.getIndex1());</span>

            /* Sync the SelectionModel with the DataModel.
             */

<span class="nc" id="L2579">            ListSelectionModel sm = list.getSelectionModel();</span>
<span class="nc bnc" id="L2580" title="All 2 branches missed.">            if (sm != null) {</span>
<span class="nc" id="L2581">                sm.insertIndexInterval(minIndex, maxIndex - minIndex+1, true);</span>
            }

            /* Repaint the entire list, from the origin of
             * the first added cell, to the bottom of the
             * component.
             */
<span class="nc" id="L2588">            redrawList();</span>
<span class="nc" id="L2589">        }</span>


        public void intervalRemoved(ListDataEvent e)
        {
<span class="nc" id="L2594">            updateLayoutStateNeeded = modelChanged;</span>

            /* Sync the SelectionModel with the DataModel.
             */

<span class="nc" id="L2599">            ListSelectionModel sm = list.getSelectionModel();</span>
<span class="nc bnc" id="L2600" title="All 2 branches missed.">            if (sm != null) {</span>
<span class="nc" id="L2601">                sm.removeIndexInterval(e.getIndex0(), e.getIndex1());</span>
            }

            /* Repaint the entire list, from the origin of
             * the first removed cell, to the bottom of the
             * component.
             */

<span class="nc" id="L2609">            redrawList();</span>
<span class="nc" id="L2610">        }</span>


        public void contentsChanged(ListDataEvent e) {
<span class="nc" id="L2614">            updateLayoutStateNeeded = modelChanged;</span>
<span class="nc" id="L2615">            redrawList();</span>
<span class="nc" id="L2616">        }</span>


        //
        // ListSelectionListener
        //
        public void valueChanged(ListSelectionEvent e) {
<span class="nc" id="L2623">            maybeUpdateLayoutState();</span>

<span class="nc" id="L2625">            int size = list.getModel().getSize();</span>
<span class="nc" id="L2626">            int firstIndex = Math.min(size - 1, Math.max(e.getFirstIndex(), 0));</span>
<span class="nc" id="L2627">            int lastIndex = Math.min(size - 1, Math.max(e.getLastIndex(), 0));</span>

<span class="nc" id="L2629">            Rectangle bounds = getCellBounds(list, firstIndex, lastIndex);</span>

<span class="nc bnc" id="L2631" title="All 2 branches missed.">            if (bounds != null) {</span>
<span class="nc" id="L2632">                list.repaint(bounds.x, bounds.y, bounds.width, bounds.height);</span>
            }
<span class="nc" id="L2634">        }</span>

        //
        // MouseListener
        //
        public void mouseClicked(MouseEvent e) {
<span class="nc" id="L2640">        }</span>

        public void mouseEntered(MouseEvent e) {
<span class="nc" id="L2643">        }</span>

        public void mouseExited(MouseEvent e) {
<span class="nc" id="L2646">        }</span>

        // Whether or not the mouse press (which is being considered as part
        // of a drag sequence) also caused the selection change to be fully
        // processed.
        private boolean dragPressDidSelection;

        public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L2654" title="All 2 branches missed.">            if (SwingUtilities2.shouldIgnore(e, list)) {</span>
<span class="nc" id="L2655">                return;</span>
            }

<span class="nc" id="L2658">            boolean dragEnabled = list.getDragEnabled();</span>
<span class="nc" id="L2659">            boolean grabFocus = true;</span>

            // different behavior if drag is enabled
<span class="nc bnc" id="L2662" title="All 2 branches missed.">            if (dragEnabled) {</span>
<span class="nc" id="L2663">                int row = SwingUtilities2.loc2IndexFileList(list, e.getPoint());</span>
                // if we have a valid row and this is a drag initiating event
<span class="nc bnc" id="L2665" title="All 4 branches missed.">                if (row != -1 &amp;&amp; DragRecognitionSupport.mousePressed(e)) {</span>
<span class="nc" id="L2666">                    dragPressDidSelection = false;</span>

<span class="nc bnc" id="L2668" title="All 2 branches missed.">                    if (BasicGraphicsUtils.isMenuShortcutKeyDown(e)) {</span>
                        // do nothing for control - will be handled on release
                        // or when drag starts
<span class="nc" id="L2671">                        return;</span>
<span class="nc bnc" id="L2672" title="All 4 branches missed.">                    } else if (!e.isShiftDown() &amp;&amp; list.isSelectedIndex(row)) {</span>
                        // clicking on something that's already selected
                        // and need to make it the lead now
<span class="nc" id="L2675">                        list.addSelectionInterval(row, row);</span>
<span class="nc" id="L2676">                        return;</span>
                    }

                    // could be a drag initiating event - don't grab focus
<span class="nc" id="L2680">                    grabFocus = false;</span>

<span class="nc" id="L2682">                    dragPressDidSelection = true;</span>
                }
<span class="nc" id="L2684">            } else {</span>
                // When drag is enabled mouse drags won't change the selection
                // in the list, so we only set the isAdjusting flag when it's
                // not enabled
<span class="nc" id="L2688">                list.setValueIsAdjusting(true);</span>
            }

<span class="nc bnc" id="L2691" title="All 2 branches missed.">            if (grabFocus) {</span>
<span class="nc" id="L2692">                SwingUtilities2.adjustFocus(list);</span>
            }

<span class="nc" id="L2695">            adjustSelection(e);</span>
<span class="nc" id="L2696">        }</span>

        private void adjustSelection(MouseEvent e) {
<span class="nc" id="L2699">            int row = SwingUtilities2.loc2IndexFileList(list, e.getPoint());</span>
<span class="nc bnc" id="L2700" title="All 2 branches missed.">            if (row &lt; 0) {</span>
                // If shift is down in multi-select, we should do nothing.
                // For single select or non-shift-click, clear the selection
<span class="nc bnc" id="L2703" title="All 2 branches missed.">                if (isFileList &amp;&amp;</span>
<span class="nc bnc" id="L2704" title="All 2 branches missed.">                    e.getID() == MouseEvent.MOUSE_PRESSED &amp;&amp;</span>
<span class="nc bnc" id="L2705" title="All 2 branches missed.">                    (!e.isShiftDown() ||</span>
<span class="nc bnc" id="L2706" title="All 2 branches missed.">                     list.getSelectionMode() == ListSelectionModel.SINGLE_SELECTION)) {</span>
<span class="nc" id="L2707">                    list.clearSelection();</span>
                }
            }
            else {
<span class="nc" id="L2711">                int anchorIndex = adjustIndex(list.getAnchorSelectionIndex(), list);</span>
                boolean anchorSelected;
<span class="nc bnc" id="L2713" title="All 2 branches missed.">                if (anchorIndex == -1) {</span>
<span class="nc" id="L2714">                    anchorIndex = 0;</span>
<span class="nc" id="L2715">                    anchorSelected = false;</span>
                } else {
<span class="nc" id="L2717">                    anchorSelected = list.isSelectedIndex(anchorIndex);</span>
                }

<span class="nc bnc" id="L2720" title="All 2 branches missed.">                if (BasicGraphicsUtils.isMenuShortcutKeyDown(e)) {</span>
<span class="nc bnc" id="L2721" title="All 2 branches missed.">                    if (e.isShiftDown()) {</span>
<span class="nc bnc" id="L2722" title="All 2 branches missed.">                        if (anchorSelected) {</span>
<span class="nc" id="L2723">                            list.addSelectionInterval(anchorIndex, row);</span>
                        } else {
<span class="nc" id="L2725">                            list.removeSelectionInterval(anchorIndex, row);</span>
<span class="nc bnc" id="L2726" title="All 2 branches missed.">                            if (isFileList) {</span>
<span class="nc" id="L2727">                                list.addSelectionInterval(row, row);</span>
<span class="nc" id="L2728">                                list.getSelectionModel().setAnchorSelectionIndex(anchorIndex);</span>
                            }
                        }
<span class="nc bnc" id="L2731" title="All 2 branches missed.">                    } else if (list.isSelectedIndex(row)) {</span>
<span class="nc" id="L2732">                        list.removeSelectionInterval(row, row);</span>
                    } else {
<span class="nc" id="L2734">                        list.addSelectionInterval(row, row);</span>
                    }
<span class="nc bnc" id="L2736" title="All 2 branches missed.">                } else if (e.isShiftDown()) {</span>
<span class="nc" id="L2737">                    list.setSelectionInterval(anchorIndex, row);</span>
                } else {
<span class="nc" id="L2739">                    list.setSelectionInterval(row, row);</span>
                }
            }
<span class="nc" id="L2742">        }</span>

        public void dragStarting(MouseEvent me) {
<span class="nc bnc" id="L2745" title="All 2 branches missed.">            if (BasicGraphicsUtils.isMenuShortcutKeyDown(me)) {</span>
<span class="nc" id="L2746">                int row = SwingUtilities2.loc2IndexFileList(list, me.getPoint());</span>
<span class="nc" id="L2747">                list.addSelectionInterval(row, row);</span>
            }
<span class="nc" id="L2749">        }</span>

        public void mouseDragged(MouseEvent e) {
<span class="nc bnc" id="L2752" title="All 2 branches missed.">            if (SwingUtilities2.shouldIgnore(e, list)) {</span>
<span class="nc" id="L2753">                return;</span>
            }

<span class="nc bnc" id="L2756" title="All 2 branches missed.">            if (list.getDragEnabled()) {</span>
<span class="nc" id="L2757">                DragRecognitionSupport.mouseDragged(e, this);</span>
<span class="nc" id="L2758">                return;</span>
            }

<span class="nc bnc" id="L2761" title="All 4 branches missed.">            if (e.isShiftDown() || BasicGraphicsUtils.isMenuShortcutKeyDown(e)) {</span>
<span class="nc" id="L2762">                return;</span>
            }

<span class="nc" id="L2765">            int row = locationToIndex(list, e.getPoint());</span>
<span class="nc bnc" id="L2766" title="All 2 branches missed.">            if (row != -1) {</span>
                // 4835633.  Dragging onto a File should not select it.
<span class="nc bnc" id="L2768" title="All 2 branches missed.">                if (isFileList) {</span>
<span class="nc" id="L2769">                    return;</span>
                }
<span class="nc" id="L2771">                Rectangle cellBounds = getCellBounds(list, row, row);</span>
<span class="nc bnc" id="L2772" title="All 2 branches missed.">                if (cellBounds != null) {</span>
<span class="nc" id="L2773">                    list.scrollRectToVisible(cellBounds);</span>
<span class="nc" id="L2774">                    list.setSelectionInterval(row, row);</span>
                }
            }
<span class="nc" id="L2777">        }</span>

        public void mouseMoved(MouseEvent e) {
<span class="nc" id="L2780">        }</span>

        public void mouseReleased(MouseEvent e) {
<span class="nc bnc" id="L2783" title="All 2 branches missed.">            if (SwingUtilities2.shouldIgnore(e, list)) {</span>
<span class="nc" id="L2784">                return;</span>
            }

<span class="nc bnc" id="L2787" title="All 2 branches missed.">            if (list.getDragEnabled()) {</span>
<span class="nc" id="L2788">                MouseEvent me = DragRecognitionSupport.mouseReleased(e);</span>
<span class="nc bnc" id="L2789" title="All 2 branches missed.">                if (me != null) {</span>
<span class="nc" id="L2790">                    SwingUtilities2.adjustFocus(list);</span>
<span class="nc bnc" id="L2791" title="All 2 branches missed.">                    if (!dragPressDidSelection) {</span>
<span class="nc" id="L2792">                        adjustSelection(me);</span>
                    }
                }
<span class="nc" id="L2795">            } else {</span>
<span class="nc" id="L2796">                list.setValueIsAdjusting(false);</span>
            }
<span class="nc" id="L2798">        }</span>

        //
        // FocusListener
        //
        protected void repaintCellFocus()
        {
<span class="nc" id="L2805">            int leadIndex = adjustIndex(list.getLeadSelectionIndex(), list);</span>
<span class="nc bnc" id="L2806" title="All 2 branches missed.">            if (leadIndex != -1) {</span>
<span class="nc" id="L2807">                Rectangle r = getCellBounds(list, leadIndex, leadIndex);</span>
<span class="nc bnc" id="L2808" title="All 2 branches missed.">                if (r != null) {</span>
<span class="nc" id="L2809">                    list.repaint(r.x, r.y, r.width, r.height);</span>
                }
            }
<span class="nc" id="L2812">        }</span>

        /* The focusGained() focusLost() methods run when the JList
         * focus changes.
         */

        public void focusGained(FocusEvent e) {
<span class="nc" id="L2819">            repaintCellFocus();</span>
<span class="nc" id="L2820">        }</span>

        public void focusLost(FocusEvent e) {
<span class="nc" id="L2823">            repaintCellFocus();</span>
<span class="nc" id="L2824">        }</span>
    }

    private static int adjustIndex(int index, JList list) {
<span class="nc bnc" id="L2828" title="All 2 branches missed.">        return index &lt; list.getModel().getSize() ? index : -1;</span>
    }

<span class="nc" id="L2831">    private static final TransferHandler defaultTransferHandler = new ListTransferHandler();</span>

<span class="nc" id="L2833">    static class ListTransferHandler extends TransferHandler implements UIResource {</span>

        /**
         * Create a Transferable to use as the source for a data transfer.
         *
         * @param c  The component holding the data to be transfered.  This
         *  argument is provided to enable sharing of TransferHandlers by
         *  multiple components.
         * @return  The representation of the data to be transfered.
         *
         */
        protected Transferable createTransferable(JComponent c) {
<span class="nc bnc" id="L2845" title="All 2 branches missed.">            if (c instanceof JList) {</span>
<span class="nc" id="L2846">                JList list = (JList) c;</span>
<span class="nc" id="L2847">                Object[] values = list.getSelectedValues();</span>

<span class="nc bnc" id="L2849" title="All 4 branches missed.">                if (values == null || values.length == 0) {</span>
<span class="nc" id="L2850">                    return null;</span>
                }

<span class="nc" id="L2853">                StringBuffer plainBuf = new StringBuffer();</span>
<span class="nc" id="L2854">                StringBuffer htmlBuf = new StringBuffer();</span>

<span class="nc" id="L2856">                htmlBuf.append(&quot;&lt;html&gt;\n&lt;body&gt;\n&lt;ul&gt;\n&quot;);</span>

<span class="nc bnc" id="L2858" title="All 2 branches missed.">                for (int i = 0; i &lt; values.length; i++) {</span>
<span class="nc" id="L2859">                    Object obj = values[i];</span>
<span class="nc bnc" id="L2860" title="All 2 branches missed.">                    String val = ((obj == null) ? &quot;&quot; : obj.toString());</span>
<span class="nc" id="L2861">                    plainBuf.append(val + &quot;\n&quot;);</span>
<span class="nc" id="L2862">                    htmlBuf.append(&quot;  &lt;li&gt;&quot; + val + &quot;\n&quot;);</span>
                }

                // remove the last newline
<span class="nc" id="L2866">                plainBuf.deleteCharAt(plainBuf.length() - 1);</span>
<span class="nc" id="L2867">                htmlBuf.append(&quot;&lt;/ul&gt;\n&lt;/body&gt;\n&lt;/html&gt;&quot;);</span>

<span class="nc" id="L2869">                return new BasicTransferable(plainBuf.toString(), htmlBuf.toString());</span>
            }

<span class="nc" id="L2872">            return null;</span>
        }

        public int getSourceActions(JComponent c) {
<span class="nc" id="L2876">            return COPY;</span>
        }

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>