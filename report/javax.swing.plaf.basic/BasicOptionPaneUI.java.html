<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BasicOptionPaneUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicOptionPaneUI.java</span></div><h1>BasicOptionPaneUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import sun.swing.DefaultLookup;
import sun.swing.UIAction;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.plaf.ActionMapUIResource;
import javax.swing.plaf.ComponentUI;
import javax.swing.plaf.OptionPaneUI;
import java.awt.*;
import java.awt.event.*;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.util.Locale;
import java.security.AccessController;

import sun.security.action.GetPropertyAction;


/**
 * Provides the basic look and feel for a &lt;code&gt;JOptionPane&lt;/code&gt;.
 * &lt;code&gt;BasicMessagePaneUI&lt;/code&gt; provides a means to place an icon,
 * message and buttons into a &lt;code&gt;Container&lt;/code&gt;.
 * Generally, the layout will look like:&lt;p&gt;
 * &lt;pre&gt;
 *        ------------------
 *        | i | message    |
 *        | c | message    |
 *        | o | message    |
 *        | n | message    |
 *        ------------------
 *        |     buttons    |
 *        |________________|
 * &lt;/pre&gt;
 * icon is an instance of &lt;code&gt;Icon&lt;/code&gt; that is wrapped inside a
 * &lt;code&gt;JLabel&lt;/code&gt;.  The message is an opaque object and is tested
 * for the following: if the message is a &lt;code&gt;Component&lt;/code&gt; it is
 * added to the &lt;code&gt;Container&lt;/code&gt;, if it is an &lt;code&gt;Icon&lt;/code&gt;
 * it is wrapped inside a &lt;code&gt;JLabel&lt;/code&gt; and added to the
 * &lt;code&gt;Container&lt;/code&gt; otherwise it is wrapped inside a &lt;code&gt;JLabel&lt;/code&gt;.
 * &lt;p&gt;
 * The above layout is used when the option pane's
 * &lt;code&gt;ComponentOrientation&lt;/code&gt; property is horizontal, left-to-right.
 * The layout will be adjusted appropriately for other orientations.
 * &lt;p&gt;
 * The &lt;code&gt;Container&lt;/code&gt;, message, icon, and buttons are all
 * determined from abstract methods.
 *
 * @author James Gosling
 * @author Scott Violet
 * @author Amy Fowler
 */
<span class="nc" id="L80">public class BasicOptionPaneUI extends OptionPaneUI {</span>

    public static final int MinimumWidth = 262;
    public static final int MinimumHeight = 90;

    private static String newline;

    /**
     * &lt;code&gt;JOptionPane&lt;/code&gt; that the receiver is providing the
     * look and feel for.
     */
    protected JOptionPane         optionPane;

    protected Dimension minimumSize;

    /** JComponent provide for input if optionPane.getWantsInput() returns
     * true. */
    protected JComponent          inputComponent;

    /** Component to receive focus when messaged with selectInitialValue. */
    protected Component           initialFocusComponent;

    /** This is set to true in validateComponent if a Component is contained
     * in either the message or the buttons. */
    protected boolean             hasCustomComponents;

    protected PropertyChangeListener propertyChangeListener;

    private Handler handler;


    static {
<span class="nc" id="L112">        newline = java.security.AccessController.doPrivileged(</span>
                                new GetPropertyAction(&quot;line.separator&quot;));
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (newline == null) {</span>
<span class="nc" id="L115">            newline = &quot;\n&quot;;</span>
        }
<span class="nc" id="L117">    }</span>

    static void loadActionMap(LazyActionMap map) {
<span class="nc" id="L120">        map.put(new Actions(Actions.CLOSE));</span>
<span class="nc" id="L121">        BasicLookAndFeel.installAudioActionMap(map);</span>
<span class="nc" id="L122">    }</span>



    /**
      * Creates a new BasicOptionPaneUI instance.
      */
    public static ComponentUI createUI(JComponent x) {
<span class="nc" id="L130">        return new BasicOptionPaneUI();</span>
    }

    /**
      * Installs the receiver as the L&amp;amp;F for the passed in
      * &lt;code&gt;JOptionPane&lt;/code&gt;.
      */
    public void installUI(JComponent c) {
<span class="nc" id="L138">        optionPane = (JOptionPane)c;</span>
<span class="nc" id="L139">        installDefaults();</span>
<span class="nc" id="L140">        optionPane.setLayout(createLayoutManager());</span>
<span class="nc" id="L141">        installComponents();</span>
<span class="nc" id="L142">        installListeners();</span>
<span class="nc" id="L143">        installKeyboardActions();</span>
<span class="nc" id="L144">    }</span>

    /**
      * Removes the receiver from the L&amp;amp;F controller of the passed in split
      * pane.
      */
    public void uninstallUI(JComponent c) {
<span class="nc" id="L151">        uninstallComponents();</span>
<span class="nc" id="L152">        optionPane.setLayout(null);</span>
<span class="nc" id="L153">        uninstallKeyboardActions();</span>
<span class="nc" id="L154">        uninstallListeners();</span>
<span class="nc" id="L155">        uninstallDefaults();</span>
<span class="nc" id="L156">        optionPane = null;</span>
<span class="nc" id="L157">    }</span>

    protected void installDefaults() {
<span class="nc" id="L160">        LookAndFeel.installColorsAndFont(optionPane, &quot;OptionPane.background&quot;,</span>
                                         &quot;OptionPane.foreground&quot;, &quot;OptionPane.font&quot;);
<span class="nc" id="L162">        LookAndFeel.installBorder(optionPane, &quot;OptionPane.border&quot;);</span>
<span class="nc" id="L163">        minimumSize = UIManager.getDimension(&quot;OptionPane.minimumSize&quot;);</span>
<span class="nc" id="L164">        LookAndFeel.installProperty(optionPane, &quot;opaque&quot;, Boolean.TRUE);</span>
<span class="nc" id="L165">    }</span>

    protected void uninstallDefaults() {
<span class="nc" id="L168">        LookAndFeel.uninstallBorder(optionPane);</span>
<span class="nc" id="L169">    }</span>

    protected void installComponents() {
<span class="nc" id="L172">        optionPane.add(createMessageArea());</span>

<span class="nc" id="L174">        Container separator = createSeparator();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (separator != null) {</span>
<span class="nc" id="L176">            optionPane.add(separator);</span>
        }
<span class="nc" id="L178">        optionPane.add(createButtonArea());</span>
<span class="nc" id="L179">        optionPane.applyComponentOrientation(optionPane.getComponentOrientation());</span>
<span class="nc" id="L180">    }</span>

    protected void uninstallComponents() {
<span class="nc" id="L183">        hasCustomComponents = false;</span>
<span class="nc" id="L184">        inputComponent = null;</span>
<span class="nc" id="L185">        initialFocusComponent = null;</span>
<span class="nc" id="L186">        optionPane.removeAll();</span>
<span class="nc" id="L187">    }</span>

    protected LayoutManager createLayoutManager() {
<span class="nc" id="L190">        return new BoxLayout(optionPane, BoxLayout.Y_AXIS);</span>
    }

    protected void installListeners() {
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if ((propertyChangeListener = createPropertyChangeListener()) != null) {</span>
<span class="nc" id="L195">            optionPane.addPropertyChangeListener(propertyChangeListener);</span>
        }
<span class="nc" id="L197">    }</span>

    protected void uninstallListeners() {
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (propertyChangeListener != null) {</span>
<span class="nc" id="L201">            optionPane.removePropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L202">            propertyChangeListener = null;</span>
        }
<span class="nc" id="L204">        handler = null;</span>
<span class="nc" id="L205">    }</span>

    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L208">        return getHandler();</span>
    }

    private Handler getHandler() {
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L213">            handler = new Handler();</span>
        }
<span class="nc" id="L215">        return handler;</span>
    }

    protected void installKeyboardActions() {
<span class="nc" id="L219">        InputMap map = getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);</span>

<span class="nc" id="L221">        SwingUtilities.replaceUIInputMap(optionPane, JComponent.</span>
                                       WHEN_IN_FOCUSED_WINDOW, map);

<span class="nc" id="L224">        LazyActionMap.installLazyActionMap(optionPane, BasicOptionPaneUI.class,</span>
                                           &quot;OptionPane.actionMap&quot;);
<span class="nc" id="L226">    }</span>

    protected void uninstallKeyboardActions() {
<span class="nc" id="L229">        SwingUtilities.replaceUIInputMap(optionPane, JComponent.</span>
                                       WHEN_IN_FOCUSED_WINDOW, null);
<span class="nc" id="L231">        SwingUtilities.replaceUIActionMap(optionPane, null);</span>
<span class="nc" id="L232">    }</span>

    InputMap getInputMap(int condition) {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if (condition == JComponent.WHEN_IN_FOCUSED_WINDOW) {</span>
<span class="nc" id="L236">            Object[] bindings = (Object[])DefaultLookup.get(</span>
                             optionPane, this, &quot;OptionPane.windowBindings&quot;);
<span class="nc bnc" id="L238" title="All 2 branches missed.">            if (bindings != null) {</span>
<span class="nc" id="L239">                return LookAndFeel.makeComponentInputMap(optionPane, bindings);</span>
            }
        }
<span class="nc" id="L242">        return null;</span>
    }

    /**
     * Returns the minimum size the option pane should be. Primarily
     * provided for subclassers wishing to offer a different minimum size.
     */
    public Dimension getMinimumOptionPaneSize() {
<span class="nc bnc" id="L250" title="All 2 branches missed.">        if (minimumSize == null) {</span>
<span class="nc" id="L251">            return new Dimension(MinimumWidth, MinimumHeight);</span>
        }
<span class="nc" id="L253">        return new Dimension(minimumSize.width,</span>
                             minimumSize.height);
    }

    /**
     * If &lt;code&gt;c&lt;/code&gt; is the &lt;code&gt;JOptionPane&lt;/code&gt; the receiver
     * is contained in, the preferred
     * size that is returned is the maximum of the preferred size of
     * the &lt;code&gt;LayoutManager&lt;/code&gt; for the &lt;code&gt;JOptionPane&lt;/code&gt;, and
     * &lt;code&gt;getMinimumOptionPaneSize&lt;/code&gt;.
     */
    public Dimension getPreferredSize(JComponent c) {
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (c == optionPane) {</span>
<span class="nc" id="L266">            Dimension            ourMin = getMinimumOptionPaneSize();</span>
<span class="nc" id="L267">            LayoutManager        lm = c.getLayout();</span>

<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (lm != null) {</span>
<span class="nc" id="L270">                Dimension         lmSize = lm.preferredLayoutSize(c);</span>

<span class="nc bnc" id="L272" title="All 2 branches missed.">                if (ourMin != null)</span>
<span class="nc" id="L273">                    return new Dimension</span>
<span class="nc" id="L274">                        (Math.max(lmSize.width, ourMin.width),</span>
<span class="nc" id="L275">                         Math.max(lmSize.height, ourMin.height));</span>
<span class="nc" id="L276">                return lmSize;</span>
            }
<span class="nc" id="L278">            return ourMin;</span>
        }
<span class="nc" id="L280">        return null;</span>
    }

    /**
     * Messaged from installComponents to create a Container containing the
     * body of the message. The icon is the created by calling
     * &lt;code&gt;addIcon&lt;/code&gt;.
     */
    protected Container createMessageArea() {
<span class="nc" id="L289">        JPanel top = new JPanel();</span>
<span class="nc" id="L290">        Border topBorder = (Border)DefaultLookup.get(optionPane, this,</span>
                                             &quot;OptionPane.messageAreaBorder&quot;);
<span class="nc bnc" id="L292" title="All 2 branches missed.">        if (topBorder != null) {</span>
<span class="nc" id="L293">            top.setBorder(topBorder);</span>
        }
<span class="nc" id="L295">        top.setLayout(new BorderLayout());</span>

        /* Fill the body. */
<span class="nc" id="L298">        Container          body = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L299">        Container          realBody = new JPanel(new BorderLayout());</span>

<span class="nc" id="L301">        body.setName(&quot;OptionPane.body&quot;);</span>
<span class="nc" id="L302">        realBody.setName(&quot;OptionPane.realBody&quot;);</span>

<span class="nc bnc" id="L304" title="All 2 branches missed.">        if (getIcon() != null) {</span>
<span class="nc" id="L305">            JPanel sep = new JPanel();</span>
<span class="nc" id="L306">            sep.setName(&quot;OptionPane.separator&quot;);</span>
<span class="nc" id="L307">            sep.setPreferredSize(new Dimension(15, 1));</span>
<span class="nc" id="L308">            realBody.add(sep, BorderLayout.BEFORE_LINE_BEGINS);</span>
        }
<span class="nc" id="L310">        realBody.add(body, BorderLayout.CENTER);</span>

<span class="nc" id="L312">        GridBagConstraints cons = new GridBagConstraints();</span>
<span class="nc" id="L313">        cons.gridx = cons.gridy = 0;</span>
<span class="nc" id="L314">        cons.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L315">        cons.gridheight = 1;</span>
<span class="nc" id="L316">        cons.anchor = DefaultLookup.getInt(optionPane, this,</span>
                      &quot;OptionPane.messageAnchor&quot;, GridBagConstraints.CENTER);
<span class="nc" id="L318">        cons.insets = new Insets(0,0,3,0);</span>

<span class="nc" id="L320">        addMessageComponents(body, cons, getMessage(),</span>
<span class="nc" id="L321">                          getMaxCharactersPerLineCount(), false);</span>
<span class="nc" id="L322">        top.add(realBody, BorderLayout.CENTER);</span>

<span class="nc" id="L324">        addIcon(top);</span>
<span class="nc" id="L325">        return top;</span>
    }

    /**
     * Creates the appropriate object to represent &lt;code&gt;msg&lt;/code&gt; and
     * places it into &lt;code&gt;container&lt;/code&gt;. If &lt;code&gt;msg&lt;/code&gt; is an
     * instance of Component, it is added directly, if it is an Icon,
     * a JLabel is created to represent it, otherwise a JLabel is
     * created for the string, if &lt;code&gt;d&lt;/code&gt; is an Object[], this
     * method will be recursively invoked for the children.
     * &lt;code&gt;internallyCreated&lt;/code&gt; is true if Objc is an instance
     * of Component and was created internally by this method (this is
     * used to correctly set hasCustomComponents only if !internallyCreated).
     */
    protected void addMessageComponents(Container container,
                                     GridBagConstraints cons,
                                     Object msg, int maxll,
                                     boolean internallyCreated) {
<span class="nc bnc" id="L343" title="All 2 branches missed.">        if (msg == null) {</span>
<span class="nc" id="L344">            return;</span>
        }
<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (msg instanceof Component) {</span>
            // To workaround problem where Gridbad will set child
            // to its minimum size if its preferred size will not fit
            // within allocated cells
<span class="nc bnc" id="L350" title="All 4 branches missed.">            if (msg instanceof JScrollPane || msg instanceof JPanel) {</span>
<span class="nc" id="L351">                cons.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L352">                cons.weighty = 1;</span>
            } else {
<span class="nc" id="L354">                cons.fill = GridBagConstraints.HORIZONTAL;</span>
            }
<span class="nc" id="L356">            cons.weightx = 1;</span>

<span class="nc" id="L358">            container.add((Component) msg, cons);</span>
<span class="nc" id="L359">            cons.weightx = 0;</span>
<span class="nc" id="L360">            cons.weighty = 0;</span>
<span class="nc" id="L361">            cons.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L362">            cons.gridy++;</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">            if (!internallyCreated) {</span>
<span class="nc" id="L364">                hasCustomComponents = true;</span>
            }

<span class="nc bnc" id="L367" title="All 2 branches missed.">        } else if (msg instanceof Object[]) {</span>
<span class="nc" id="L368">            Object [] msgs = (Object[]) msg;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">            for (Object o : msgs) {</span>
<span class="nc" id="L370">                addMessageComponents(container, cons, o, maxll, false);</span>
            }

<span class="nc bnc" id="L373" title="All 2 branches missed.">        } else if (msg instanceof Icon) {</span>
<span class="nc" id="L374">            JLabel label = new JLabel( (Icon)msg, SwingConstants.CENTER );</span>
<span class="nc" id="L375">            configureMessageLabel(label);</span>
<span class="nc" id="L376">            addMessageComponents(container, cons, label, maxll, true);</span>

<span class="nc" id="L378">        } else {</span>
<span class="nc" id="L379">            String s = msg.toString();</span>
<span class="nc" id="L380">            int len = s.length();</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">            if (len &lt;= 0) {</span>
<span class="nc" id="L382">                return;</span>
            }
            int nl;
<span class="nc" id="L385">            int nll = 0;</span>

<span class="nc bnc" id="L387" title="All 2 branches missed.">            if ((nl = s.indexOf(newline)) &gt;= 0) {</span>
<span class="nc" id="L388">                nll = newline.length();</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">            } else if ((nl = s.indexOf(&quot;\r\n&quot;)) &gt;= 0) {</span>
<span class="nc" id="L390">                nll = 2;</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">            } else if ((nl = s.indexOf('\n')) &gt;= 0) {</span>
<span class="nc" id="L392">                nll = 1;</span>
            }
<span class="nc bnc" id="L394" title="All 2 branches missed.">            if (nl &gt;= 0) {</span>
                // break up newlines
<span class="nc bnc" id="L396" title="All 2 branches missed.">                if (nl == 0) {</span>
<span class="nc" id="L397">                    JPanel breakPanel = new JPanel() {</span>
                        public Dimension getPreferredSize() {
<span class="nc" id="L399">                            Font       f = getFont();</span>

<span class="nc bnc" id="L401" title="All 2 branches missed.">                            if (f != null) {</span>
<span class="nc" id="L402">                                return new Dimension(1, f.getSize() + 2);</span>
                            }
<span class="nc" id="L404">                            return new Dimension(0, 0);</span>
                        }
                    };
<span class="nc" id="L407">                    breakPanel.setName(&quot;OptionPane.break&quot;);</span>
<span class="nc" id="L408">                    addMessageComponents(container, cons, breakPanel, maxll,</span>
                                         true);
<span class="nc" id="L410">                } else {</span>
<span class="nc" id="L411">                    addMessageComponents(container, cons, s.substring(0, nl),</span>
                                      maxll, false);
                }
<span class="nc" id="L414">                addMessageComponents(container, cons, s.substring(nl + nll), maxll,</span>
                                  false);

<span class="nc bnc" id="L417" title="All 2 branches missed.">            } else if (len &gt; maxll) {</span>
<span class="nc" id="L418">                Container c = Box.createVerticalBox();</span>
<span class="nc" id="L419">                c.setName(&quot;OptionPane.verticalBox&quot;);</span>
<span class="nc" id="L420">                burstStringInto(c, s, maxll);</span>
<span class="nc" id="L421">                addMessageComponents(container, cons, c, maxll, true );</span>

<span class="nc" id="L423">            } else {</span>
                JLabel label;
<span class="nc" id="L425">                label = new JLabel( s, JLabel.LEADING );</span>
<span class="nc" id="L426">                label.setName(&quot;OptionPane.label&quot;);</span>
<span class="nc" id="L427">                configureMessageLabel(label);</span>
<span class="nc" id="L428">                addMessageComponents(container, cons, label, maxll, true);</span>
            }
        }
<span class="nc" id="L431">    }</span>

    /**
     * Returns the message to display from the JOptionPane the receiver is
     * providing the look and feel for.
     */
    protected Object getMessage() {
<span class="nc" id="L438">        inputComponent = null;</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (optionPane != null) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">            if (optionPane.getWantsInput()) {</span>
                /* Create a user component to capture the input. If the
                   selectionValues are non null the component and there
                   are &lt; 20 values it'll be a combobox, if non null and
                   &gt;= 20, it'll be a list, otherwise it'll be a textfield. */
<span class="nc" id="L445">                Object             message = optionPane.getMessage();</span>
<span class="nc" id="L446">                Object[]           sValues = optionPane.getSelectionValues();</span>
<span class="nc" id="L447">                Object             inputValue = optionPane</span>
<span class="nc" id="L448">                                           .getInitialSelectionValue();</span>
                JComponent         toAdd;

<span class="nc bnc" id="L451" title="All 2 branches missed.">                if (sValues != null) {</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">                    if (sValues.length &lt; 20) {</span>
<span class="nc" id="L453">                        JComboBox            cBox = new JComboBox();</span>

<span class="nc" id="L455">                        cBox.setName(&quot;OptionPane.comboBox&quot;);</span>
<span class="nc" id="L456">                        for(int counter = 0, maxCounter = sValues.length;</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                            counter &lt; maxCounter; counter++) {</span>
<span class="nc" id="L458">                            cBox.addItem(sValues[counter]);</span>
                        }
<span class="nc bnc" id="L460" title="All 2 branches missed.">                        if (inputValue != null) {</span>
<span class="nc" id="L461">                            cBox.setSelectedItem(inputValue);</span>
                        }
<span class="nc" id="L463">                        inputComponent = cBox;</span>
<span class="nc" id="L464">                        toAdd = cBox;</span>

<span class="nc" id="L466">                    } else {</span>
<span class="nc" id="L467">                        JList                list = new JList(sValues);</span>
<span class="nc" id="L468">                        JScrollPane          sp = new JScrollPane(list);</span>

<span class="nc" id="L470">                        sp.setName(&quot;OptionPane.scrollPane&quot;);</span>
<span class="nc" id="L471">                        list.setName(&quot;OptionPane.list&quot;);</span>
<span class="nc" id="L472">                        list.setVisibleRowCount(10);</span>
<span class="nc" id="L473">                        list.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">                        if(inputValue != null)</span>
<span class="nc" id="L475">                            list.setSelectedValue(inputValue, true);</span>
<span class="nc" id="L476">                        list.addMouseListener(getHandler());</span>
<span class="nc" id="L477">                        toAdd = sp;</span>
<span class="nc" id="L478">                        inputComponent = list;</span>
<span class="nc" id="L479">                    }</span>

                } else {
<span class="nc" id="L482">                    MultiplexingTextField   tf = new MultiplexingTextField(20);</span>

<span class="nc" id="L484">                    tf.setName(&quot;OptionPane.textField&quot;);</span>
<span class="nc" id="L485">                    tf.setKeyStrokes(new KeyStroke[] {</span>
<span class="nc" id="L486">                                     KeyStroke.getKeyStroke(&quot;ENTER&quot;) } );</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">                    if (inputValue != null) {</span>
<span class="nc" id="L488">                        String inputString = inputValue.toString();</span>
<span class="nc" id="L489">                        tf.setText(inputString);</span>
<span class="nc" id="L490">                        tf.setSelectionStart(0);</span>
<span class="nc" id="L491">                        tf.setSelectionEnd(inputString.length());</span>
                    }
<span class="nc" id="L493">                    tf.addActionListener(getHandler());</span>
<span class="nc" id="L494">                    toAdd = inputComponent = tf;</span>
                }

                Object[]           newMessage;

<span class="nc bnc" id="L499" title="All 2 branches missed.">                if (message == null) {</span>
<span class="nc" id="L500">                    newMessage = new Object[1];</span>
<span class="nc" id="L501">                    newMessage[0] = toAdd;</span>

                } else {
<span class="nc" id="L504">                    newMessage = new Object[2];</span>
<span class="nc" id="L505">                    newMessage[0] = message;</span>
<span class="nc" id="L506">                    newMessage[1] = toAdd;</span>
                }
<span class="nc" id="L508">                return newMessage;</span>
            }
<span class="nc" id="L510">            return optionPane.getMessage();</span>
        }
<span class="nc" id="L512">        return null;</span>
    }

    /**
     * Creates and adds a JLabel representing the icon returned from
     * &lt;code&gt;getIcon&lt;/code&gt; to &lt;code&gt;top&lt;/code&gt;. This is messaged from
     * &lt;code&gt;createMessageArea&lt;/code&gt;
     */
    protected void addIcon(Container top) {
        /* Create the icon. */
<span class="nc" id="L522">        Icon                  sideIcon = getIcon();</span>

<span class="nc bnc" id="L524" title="All 2 branches missed.">        if (sideIcon != null) {</span>
<span class="nc" id="L525">            JLabel            iconLabel = new JLabel(sideIcon);</span>

<span class="nc" id="L527">            iconLabel.setName(&quot;OptionPane.iconLabel&quot;);</span>
<span class="nc" id="L528">            iconLabel.setVerticalAlignment(SwingConstants.TOP);</span>
<span class="nc" id="L529">            top.add(iconLabel, BorderLayout.BEFORE_LINE_BEGINS);</span>
        }
<span class="nc" id="L531">    }</span>

    /**
     * Returns the icon from the JOptionPane the receiver is providing
     * the look and feel for, or the default icon as returned from
     * &lt;code&gt;getDefaultIcon&lt;/code&gt;.
     */
    protected Icon getIcon() {
<span class="nc bnc" id="L539" title="All 2 branches missed.">        Icon      mIcon = (optionPane == null ? null : optionPane.getIcon());</span>

<span class="nc bnc" id="L541" title="All 4 branches missed.">        if(mIcon == null &amp;&amp; optionPane != null)</span>
<span class="nc" id="L542">            mIcon = getIconForType(optionPane.getMessageType());</span>
<span class="nc" id="L543">        return mIcon;</span>
    }

    /**
     * Returns the icon to use for the passed in type.
     */
    protected Icon getIconForType(int messageType) {
<span class="nc bnc" id="L550" title="All 4 branches missed.">        if(messageType &lt; 0 || messageType &gt; 3)</span>
<span class="nc" id="L551">            return null;</span>
<span class="nc" id="L552">        String propertyName = null;</span>
<span class="nc bnc" id="L553" title="All 5 branches missed.">        switch(messageType) {</span>
        case 0:
<span class="nc" id="L555">            propertyName = &quot;OptionPane.errorIcon&quot;;</span>
<span class="nc" id="L556">            break;</span>
        case 1:
<span class="nc" id="L558">            propertyName = &quot;OptionPane.informationIcon&quot;;</span>
<span class="nc" id="L559">            break;</span>
        case 2:
<span class="nc" id="L561">            propertyName = &quot;OptionPane.warningIcon&quot;;</span>
<span class="nc" id="L562">            break;</span>
        case 3:
<span class="nc" id="L564">            propertyName = &quot;OptionPane.questionIcon&quot;;</span>
            break;
        }
<span class="nc bnc" id="L567" title="All 2 branches missed.">        if (propertyName != null) {</span>
<span class="nc" id="L568">            return (Icon)DefaultLookup.get(optionPane, this, propertyName);</span>
        }
<span class="nc" id="L570">        return null;</span>
    }

    /**
     * Returns the maximum number of characters to place on a line.
     */
    protected int getMaxCharactersPerLineCount() {
<span class="nc" id="L577">        return optionPane.getMaxCharactersPerLineCount();</span>
    }

   /**
     * Recursively creates new JLabel instances to represent &lt;code&gt;d&lt;/code&gt;.
     * Each JLabel instance is added to &lt;code&gt;c&lt;/code&gt;.
     */
    protected void burstStringInto(Container c, String d, int maxll) {
        // Primitive line wrapping
<span class="nc" id="L586">        int len = d.length();</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">        if (len &lt;= 0)</span>
<span class="nc" id="L588">            return;</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">        if (len &gt; maxll) {</span>
<span class="nc" id="L590">            int p = d.lastIndexOf(' ', maxll);</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">            if (p &lt;= 0)</span>
<span class="nc" id="L592">                p = d.indexOf(' ', maxll);</span>
<span class="nc bnc" id="L593" title="All 4 branches missed.">            if (p &gt; 0 &amp;&amp; p &lt; len) {</span>
<span class="nc" id="L594">                burstStringInto(c, d.substring(0, p), maxll);</span>
<span class="nc" id="L595">                burstStringInto(c, d.substring(p + 1), maxll);</span>
<span class="nc" id="L596">                return;</span>
            }
        }
<span class="nc" id="L599">        JLabel label = new JLabel(d, JLabel.LEFT);</span>
<span class="nc" id="L600">        label.setName(&quot;OptionPane.label&quot;);</span>
<span class="nc" id="L601">        configureMessageLabel(label);</span>
<span class="nc" id="L602">        c.add(label);</span>
<span class="nc" id="L603">    }</span>

    protected Container createSeparator() {
<span class="nc" id="L606">        return null;</span>
    }

    /**
     * Creates and returns a Container containing the buttons. The buttons
     * are created by calling &lt;code&gt;getButtons&lt;/code&gt;.
     */
    protected Container createButtonArea() {
<span class="nc" id="L614">        JPanel bottom = new JPanel();</span>
<span class="nc" id="L615">        Border border = (Border)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.buttonAreaBorder&quot;);
<span class="nc" id="L617">        bottom.setName(&quot;OptionPane.buttonArea&quot;);</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">        if (border != null) {</span>
<span class="nc" id="L619">            bottom.setBorder(border);</span>
        }
<span class="nc" id="L621">        bottom.setLayout(new ButtonAreaLayout(</span>
<span class="nc" id="L622">           DefaultLookup.getBoolean(optionPane, this,</span>
                                    &quot;OptionPane.sameSizeButtons&quot;, true),
<span class="nc" id="L624">           DefaultLookup.getInt(optionPane, this, &quot;OptionPane.buttonPadding&quot;,</span>
                                6),
<span class="nc" id="L626">           DefaultLookup.getInt(optionPane, this,</span>
                        &quot;OptionPane.buttonOrientation&quot;, SwingConstants.CENTER),
<span class="nc" id="L628">           DefaultLookup.getBoolean(optionPane, this, &quot;OptionPane.isYesLast&quot;,</span>
                                    false)));
<span class="nc" id="L630">        addButtonComponents(bottom, getButtons(), getInitialValueIndex());</span>
<span class="nc" id="L631">        return bottom;</span>
    }

    /**
     * Creates the appropriate object to represent each of the objects in
     * &lt;code&gt;buttons&lt;/code&gt; and adds it to &lt;code&gt;container&lt;/code&gt;. This
     * differs from addMessageComponents in that it will recurse on
     * &lt;code&gt;buttons&lt;/code&gt; and that if button is not a Component
     * it will create an instance of JButton.
     */
    protected void addButtonComponents(Container container, Object[] buttons,
                                 int initialIndex) {
<span class="nc bnc" id="L643" title="All 4 branches missed.">        if (buttons != null &amp;&amp; buttons.length &gt; 0) {</span>
<span class="nc" id="L644">            boolean            sizeButtonsToSame = getSizeButtonsToSameWidth();</span>
<span class="nc" id="L645">            boolean            createdAll = true;</span>
<span class="nc" id="L646">            int                numButtons = buttons.length;</span>
<span class="nc" id="L647">            JButton[]          createdButtons = null;</span>
<span class="nc" id="L648">            int                maxWidth = 0;</span>

<span class="nc bnc" id="L650" title="All 2 branches missed.">            if (sizeButtonsToSame) {</span>
<span class="nc" id="L651">                createdButtons = new JButton[numButtons];</span>
            }

<span class="nc bnc" id="L654" title="All 2 branches missed.">            for(int counter = 0; counter &lt; numButtons; counter++) {</span>
<span class="nc" id="L655">                Object       button = buttons[counter];</span>
                Component    newComponent;

<span class="nc bnc" id="L658" title="All 2 branches missed.">                if (button instanceof Component) {</span>
<span class="nc" id="L659">                    createdAll = false;</span>
<span class="nc" id="L660">                    newComponent = (Component)button;</span>
<span class="nc" id="L661">                    container.add(newComponent);</span>
<span class="nc" id="L662">                    hasCustomComponents = true;</span>

                } else {
                    JButton      aButton;

<span class="nc bnc" id="L667" title="All 2 branches missed.">                    if (button instanceof ButtonFactory) {</span>
<span class="nc" id="L668">                        aButton = ((ButtonFactory)button).createButton();</span>
                    }
<span class="nc bnc" id="L670" title="All 2 branches missed.">                    else if (button instanceof Icon)</span>
<span class="nc" id="L671">                        aButton = new JButton((Icon)button);</span>
                    else
<span class="nc" id="L673">                        aButton = new JButton(button.toString());</span>

<span class="nc" id="L675">                    aButton.setName(&quot;OptionPane.button&quot;);</span>
<span class="nc" id="L676">                    aButton.setMultiClickThreshhold(DefaultLookup.getInt(</span>
                          optionPane, this, &quot;OptionPane.buttonClickThreshhold&quot;,
                          0));
<span class="nc" id="L679">                    configureButton(aButton);</span>

<span class="nc" id="L681">                    container.add(aButton);</span>

<span class="nc" id="L683">                    ActionListener buttonListener = createButtonActionListener(counter);</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">                    if (buttonListener != null) {</span>
<span class="nc" id="L685">                        aButton.addActionListener(buttonListener);</span>
                    }
<span class="nc" id="L687">                    newComponent = aButton;</span>
                }
<span class="nc bnc" id="L689" title="All 6 branches missed.">                if (sizeButtonsToSame &amp;&amp; createdAll &amp;&amp;</span>
                   (newComponent instanceof JButton)) {
<span class="nc" id="L691">                    createdButtons[counter] = (JButton)newComponent;</span>
<span class="nc" id="L692">                    maxWidth = Math.max(maxWidth,</span>
<span class="nc" id="L693">                                        newComponent.getMinimumSize().width);</span>
                }
<span class="nc bnc" id="L695" title="All 2 branches missed.">                if (counter == initialIndex) {</span>
<span class="nc" id="L696">                    initialFocusComponent = newComponent;</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">                    if (initialFocusComponent instanceof JButton) {</span>
<span class="nc" id="L698">                        JButton defaultB = (JButton)initialFocusComponent;</span>
<span class="nc" id="L699">                        defaultB.addHierarchyListener(new HierarchyListener() {</span>
                            public void hierarchyChanged(HierarchyEvent e) {
<span class="nc bnc" id="L701" title="All 2 branches missed.">                                if ((e.getChangeFlags() &amp;</span>
                                        HierarchyEvent.PARENT_CHANGED) != 0) {
<span class="nc" id="L703">                                    JButton defaultButton = (JButton) e.getComponent();</span>
<span class="nc" id="L704">                                    JRootPane root =</span>
<span class="nc" id="L705">                                            SwingUtilities.getRootPane(defaultButton);</span>
<span class="nc bnc" id="L706" title="All 2 branches missed.">                                    if (root != null) {</span>
<span class="nc" id="L707">                                        root.setDefaultButton(defaultButton);</span>
                                    }
                                }
<span class="nc" id="L710">                            }</span>
                        });
                    }
                }
            }
<span class="nc bnc" id="L715" title="All 4 branches missed.">            ((ButtonAreaLayout)container.getLayout()).</span>
<span class="nc" id="L716">                              setSyncAllWidths((sizeButtonsToSame &amp;&amp; createdAll));</span>
            /* Set the padding, windows seems to use 8 if &lt;= 2 components,
               otherwise 4 is used. It may actually just be the size of the
               buttons is always the same, not sure. */
<span class="nc bnc" id="L720" title="All 6 branches missed.">            if (DefaultLookup.getBoolean(optionPane, this,</span>
                   &quot;OptionPane.setButtonMargin&quot;, true) &amp;&amp; sizeButtonsToSame &amp;&amp;
                   createdAll) {
                JButton               aButton;
                int                   padSize;

<span class="nc bnc" id="L726" title="All 2 branches missed.">                padSize = (numButtons &lt;= 2? 8 : 4);</span>

<span class="nc bnc" id="L728" title="All 2 branches missed.">                for(int counter = 0; counter &lt; numButtons; counter++) {</span>
<span class="nc" id="L729">                    aButton = createdButtons[counter];</span>
<span class="nc" id="L730">                    aButton.setMargin(new Insets(2, padSize, 2, padSize));</span>
                }
            }
        }
<span class="nc" id="L734">    }</span>

    protected ActionListener createButtonActionListener(int buttonIndex) {
<span class="nc" id="L737">        return new ButtonActionListener(buttonIndex);</span>
    }

    /**
     * Returns the buttons to display from the JOptionPane the receiver is
     * providing the look and feel for. If the JOptionPane has options
     * set, they will be provided, otherwise if the optionType is
     * YES_NO_OPTION, yesNoOptions is returned, if the type is
     * YES_NO_CANCEL_OPTION yesNoCancelOptions is returned, otherwise
     * defaultButtons are returned.
     */
    protected Object[] getButtons() {
<span class="nc bnc" id="L749" title="All 2 branches missed.">        if (optionPane != null) {</span>
<span class="nc" id="L750">            Object[] suppliedOptions = optionPane.getOptions();</span>

<span class="nc bnc" id="L752" title="All 2 branches missed.">            if (suppliedOptions == null) {</span>
                Object[] defaultOptions;
<span class="nc" id="L754">                int type = optionPane.getOptionType();</span>
<span class="nc" id="L755">                Locale l = optionPane.getLocale();</span>
<span class="nc" id="L756">                int minimumWidth =</span>
<span class="nc" id="L757">                    DefaultLookup.getInt(optionPane, this,</span>
                                        &quot;OptionPane.buttonMinimumWidth&quot;,-1);
<span class="nc bnc" id="L759" title="All 2 branches missed.">                if (type == JOptionPane.YES_NO_OPTION) {</span>
<span class="nc" id="L760">                    defaultOptions = new ButtonFactory[2];</span>
<span class="nc" id="L761">                    defaultOptions[0] = new ButtonFactory(</span>
<span class="nc" id="L762">                        UIManager.getString(&quot;OptionPane.yesButtonText&quot;, l),</span>
<span class="nc" id="L763">                        getMnemonic(&quot;OptionPane.yesButtonMnemonic&quot;, l),</span>
<span class="nc" id="L764">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.yesIcon&quot;), minimumWidth);
<span class="nc" id="L766">                    defaultOptions[1] = new ButtonFactory(</span>
<span class="nc" id="L767">                        UIManager.getString(&quot;OptionPane.noButtonText&quot;, l),</span>
<span class="nc" id="L768">                        getMnemonic(&quot;OptionPane.noButtonMnemonic&quot;, l),</span>
<span class="nc" id="L769">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.noIcon&quot;), minimumWidth);
<span class="nc bnc" id="L771" title="All 2 branches missed.">                } else if (type == JOptionPane.YES_NO_CANCEL_OPTION) {</span>
<span class="nc" id="L772">                    defaultOptions = new ButtonFactory[3];</span>
<span class="nc" id="L773">                    defaultOptions[0] = new ButtonFactory(</span>
<span class="nc" id="L774">                        UIManager.getString(&quot;OptionPane.yesButtonText&quot;, l),</span>
<span class="nc" id="L775">                        getMnemonic(&quot;OptionPane.yesButtonMnemonic&quot;, l),</span>
<span class="nc" id="L776">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.yesIcon&quot;), minimumWidth);
<span class="nc" id="L778">                    defaultOptions[1] = new ButtonFactory(</span>
<span class="nc" id="L779">                        UIManager.getString(&quot;OptionPane.noButtonText&quot;,l),</span>
<span class="nc" id="L780">                        getMnemonic(&quot;OptionPane.noButtonMnemonic&quot;, l),</span>
<span class="nc" id="L781">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.noIcon&quot;), minimumWidth);
<span class="nc" id="L783">                    defaultOptions[2] = new ButtonFactory(</span>
<span class="nc" id="L784">                        UIManager.getString(&quot;OptionPane.cancelButtonText&quot;,l),</span>
<span class="nc" id="L785">                        getMnemonic(&quot;OptionPane.cancelButtonMnemonic&quot;, l),</span>
<span class="nc" id="L786">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.cancelIcon&quot;), minimumWidth);
<span class="nc bnc" id="L788" title="All 2 branches missed.">                } else if (type == JOptionPane.OK_CANCEL_OPTION) {</span>
<span class="nc" id="L789">                    defaultOptions = new ButtonFactory[2];</span>
<span class="nc" id="L790">                    defaultOptions[0] = new ButtonFactory(</span>
<span class="nc" id="L791">                        UIManager.getString(&quot;OptionPane.okButtonText&quot;,l),</span>
<span class="nc" id="L792">                        getMnemonic(&quot;OptionPane.okButtonMnemonic&quot;, l),</span>
<span class="nc" id="L793">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.okIcon&quot;), minimumWidth);
<span class="nc" id="L795">                    defaultOptions[1] = new ButtonFactory(</span>
<span class="nc" id="L796">                        UIManager.getString(&quot;OptionPane.cancelButtonText&quot;,l),</span>
<span class="nc" id="L797">                        getMnemonic(&quot;OptionPane.cancelButtonMnemonic&quot;, l),</span>
<span class="nc" id="L798">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.cancelIcon&quot;), minimumWidth);
                } else {
<span class="nc" id="L801">                    defaultOptions = new ButtonFactory[1];</span>
<span class="nc" id="L802">                    defaultOptions[0] = new ButtonFactory(</span>
<span class="nc" id="L803">                        UIManager.getString(&quot;OptionPane.okButtonText&quot;,l),</span>
<span class="nc" id="L804">                        getMnemonic(&quot;OptionPane.okButtonMnemonic&quot;, l),</span>
<span class="nc" id="L805">                        (Icon)DefaultLookup.get(optionPane, this,</span>
                                          &quot;OptionPane.okIcon&quot;), minimumWidth);
                }
<span class="nc" id="L808">                return defaultOptions;</span>

            }
<span class="nc" id="L811">            return suppliedOptions;</span>
        }
<span class="nc" id="L813">        return null;</span>
    }

    private int getMnemonic(String key, Locale l) {
<span class="nc" id="L817">        String value = (String)UIManager.get(key, l);</span>

<span class="nc bnc" id="L819" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L820">            return 0;</span>
        }
        try {
<span class="nc" id="L823">            return Integer.parseInt(value);</span>
        }
<span class="nc" id="L825">        catch (NumberFormatException nfe) { }</span>
<span class="nc" id="L826">        return 0;</span>
    }

    /**
     * Returns true, basic L&amp;amp;F wants all the buttons to have the same
     * width.
     */
    protected boolean getSizeButtonsToSameWidth() {
<span class="nc" id="L834">        return true;</span>
    }

    /**
     * Returns the initial index into the buttons to select. The index
     * is calculated from the initial value from the JOptionPane and
     * options of the JOptionPane or 0.
     */
    protected int getInitialValueIndex() {
<span class="nc bnc" id="L843" title="All 2 branches missed.">        if (optionPane != null) {</span>
<span class="nc" id="L844">            Object             iv = optionPane.getInitialValue();</span>
<span class="nc" id="L845">            Object[]           options = optionPane.getOptions();</span>

<span class="nc bnc" id="L847" title="All 2 branches missed.">            if(options == null) {</span>
<span class="nc" id="L848">                return 0;</span>
            }
<span class="nc bnc" id="L850" title="All 2 branches missed.">            else if(iv != null) {</span>
<span class="nc bnc" id="L851" title="All 2 branches missed.">                for(int counter = options.length - 1; counter &gt;= 0; counter--){</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">                    if(options[counter].equals(iv))</span>
<span class="nc" id="L853">                        return counter;</span>
                }
            }
        }
<span class="nc" id="L857">        return -1;</span>
    }

    /**
     * Sets the input value in the option pane the receiver is providing
     * the look and feel for based on the value in the inputComponent.
     */
    protected void resetInputValue() {
<span class="nc bnc" id="L865" title="All 4 branches missed.">        if(inputComponent != null &amp;&amp; (inputComponent instanceof JTextField)) {</span>
<span class="nc" id="L866">            optionPane.setInputValue(((JTextField)inputComponent).getText());</span>

<span class="nc bnc" id="L868" title="All 4 branches missed.">        } else if(inputComponent != null &amp;&amp;</span>
                  (inputComponent instanceof JComboBox)) {
<span class="nc" id="L870">            optionPane.setInputValue(((JComboBox)inputComponent)</span>
<span class="nc" id="L871">                                     .getSelectedItem());</span>
<span class="nc bnc" id="L872" title="All 2 branches missed.">        } else if(inputComponent != null) {</span>
<span class="nc" id="L873">            optionPane.setInputValue(((JList)inputComponent)</span>
<span class="nc" id="L874">                                     .getSelectedValue());</span>
        }
<span class="nc" id="L876">    }</span>


    /**
     * If inputComponent is non-null, the focus is requested on that,
     * otherwise request focus on the default value
     */
    public void selectInitialValue(JOptionPane op) {
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if (inputComponent != null)</span>
<span class="nc" id="L885">            inputComponent.requestFocus();</span>
        else {
<span class="nc bnc" id="L887" title="All 2 branches missed.">            if (initialFocusComponent != null)</span>
<span class="nc" id="L888">                initialFocusComponent.requestFocus();</span>

<span class="nc bnc" id="L890" title="All 2 branches missed.">            if (initialFocusComponent instanceof JButton) {</span>
<span class="nc" id="L891">                JRootPane root = SwingUtilities.getRootPane(initialFocusComponent);</span>
<span class="nc bnc" id="L892" title="All 2 branches missed.">                if (root != null) {</span>
<span class="nc" id="L893">                    root.setDefaultButton((JButton)initialFocusComponent);</span>
                }
            }
        }
<span class="nc" id="L897">    }</span>

    /**
     * Returns true if in the last call to validateComponent the message
     * or buttons contained a subclass of Component.
     */
    public boolean containsCustomComponents(JOptionPane op) {
<span class="nc" id="L904">        return hasCustomComponents;</span>
    }


    /**
     * &lt;code&gt;ButtonAreaLayout&lt;/code&gt; behaves in a similar manner to
     * &lt;code&gt;FlowLayout&lt;/code&gt;. It lays out all components from left to
     * right. If &lt;code&gt;syncAllWidths&lt;/code&gt; is true, the widths of each
     * component will be set to the largest preferred size width.
     *
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of {@code BasicOptionPaneUI}.
     */
    public static class ButtonAreaLayout implements LayoutManager {
        protected boolean           syncAllWidths;
        protected int               padding;
        /** If true, children are lumped together in parent. */
        protected boolean           centersChildren;
        private int orientation;
        private boolean reverseButtons;
        /**
         * Indicates whether or not centersChildren should be used vs
         * the orientation. This is done for backward compatibility
         * for subclassers.
         */
        private boolean useOrientation;

<span class="nc" id="L931">        public ButtonAreaLayout(boolean syncAllWidths, int padding) {</span>
<span class="nc" id="L932">            this.syncAllWidths = syncAllWidths;</span>
<span class="nc" id="L933">            this.padding = padding;</span>
<span class="nc" id="L934">            centersChildren = true;</span>
<span class="nc" id="L935">            useOrientation = false;</span>
<span class="nc" id="L936">        }</span>

        ButtonAreaLayout(boolean syncAllSizes, int padding, int orientation,
                         boolean reverseButtons) {
<span class="nc" id="L940">            this(syncAllSizes, padding);</span>
<span class="nc" id="L941">            useOrientation = true;</span>
<span class="nc" id="L942">            this.orientation = orientation;</span>
<span class="nc" id="L943">            this.reverseButtons = reverseButtons;</span>
<span class="nc" id="L944">        }</span>

        public void setSyncAllWidths(boolean newValue) {
<span class="nc" id="L947">            syncAllWidths = newValue;</span>
<span class="nc" id="L948">        }</span>

        public boolean getSyncAllWidths() {
<span class="nc" id="L951">            return syncAllWidths;</span>
        }

        public void setPadding(int newPadding) {
<span class="nc" id="L955">            this.padding = newPadding;</span>
<span class="nc" id="L956">        }</span>

        public int getPadding() {
<span class="nc" id="L959">            return padding;</span>
        }

        public void setCentersChildren(boolean newValue) {
<span class="nc" id="L963">            centersChildren = newValue;</span>
<span class="nc" id="L964">            useOrientation = false;</span>
<span class="nc" id="L965">        }</span>

        public boolean getCentersChildren() {
<span class="nc" id="L968">            return centersChildren;</span>
        }

        private int getOrientation(Container container) {
<span class="nc bnc" id="L972" title="All 2 branches missed.">            if (!useOrientation) {</span>
<span class="nc" id="L973">                return SwingConstants.CENTER;</span>
            }
<span class="nc bnc" id="L975" title="All 2 branches missed.">            if (container.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L976">                return orientation;</span>
            }
<span class="nc bnc" id="L978" title="All 4 branches missed.">            switch (orientation) {</span>
            case SwingConstants.LEFT:
<span class="nc" id="L980">                return SwingConstants.RIGHT;</span>
            case SwingConstants.RIGHT:
<span class="nc" id="L982">                return SwingConstants.LEFT;</span>
            case SwingConstants.CENTER:
<span class="nc" id="L984">                return SwingConstants.CENTER;</span>
            }
<span class="nc" id="L986">            return SwingConstants.LEFT;</span>
        }

        public void addLayoutComponent(String string, Component comp) {
<span class="nc" id="L990">        }</span>

        public void layoutContainer(Container container) {
<span class="nc" id="L993">            Component[]      children = container.getComponents();</span>

<span class="nc bnc" id="L995" title="All 4 branches missed.">            if(children != null &amp;&amp; children.length &gt; 0) {</span>
<span class="nc" id="L996">                int               numChildren = children.length;</span>
<span class="nc" id="L997">                Insets            insets = container.getInsets();</span>
<span class="nc" id="L998">                int maxWidth = 0;</span>
<span class="nc" id="L999">                int maxHeight = 0;</span>
<span class="nc" id="L1000">                int totalButtonWidth = 0;</span>
<span class="nc" id="L1001">                int x = 0;</span>
<span class="nc" id="L1002">                int xOffset = 0;</span>
<span class="nc" id="L1003">                boolean ltr = container.getComponentOrientation().</span>
<span class="nc" id="L1004">                                        isLeftToRight();</span>
<span class="nc bnc" id="L1005" title="All 4 branches missed.">                boolean reverse = (ltr) ? reverseButtons : !reverseButtons;</span>

<span class="nc bnc" id="L1007" title="All 2 branches missed.">                for(int counter = 0; counter &lt; numChildren; counter++) {</span>
<span class="nc" id="L1008">                    Dimension pref = children[counter].getPreferredSize();</span>
<span class="nc" id="L1009">                    maxWidth = Math.max(maxWidth, pref.width);</span>
<span class="nc" id="L1010">                    maxHeight = Math.max(maxHeight, pref.height);</span>
<span class="nc" id="L1011">                    totalButtonWidth += pref.width;</span>
                }
<span class="nc bnc" id="L1013" title="All 2 branches missed.">                if (getSyncAllWidths()) {</span>
<span class="nc" id="L1014">                    totalButtonWidth = maxWidth * numChildren;</span>
                }
<span class="nc" id="L1016">                totalButtonWidth += (numChildren - 1) * padding;</span>

<span class="nc bnc" id="L1018" title="All 4 branches missed.">                switch (getOrientation(container)) {</span>
                case SwingConstants.LEFT:
<span class="nc" id="L1020">                    x = insets.left;</span>
<span class="nc" id="L1021">                    break;</span>
                case SwingConstants.RIGHT:
<span class="nc" id="L1023">                    x = container.getWidth() - insets.right - totalButtonWidth;</span>
<span class="nc" id="L1024">                    break;</span>
                case SwingConstants.CENTER:
<span class="nc bnc" id="L1026" title="All 4 branches missed.">                    if (getCentersChildren() || numChildren &lt; 2) {</span>
<span class="nc" id="L1027">                        x = (container.getWidth() - totalButtonWidth) / 2;</span>
                    }
                    else {
<span class="nc" id="L1030">                        x = insets.left;</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">                        if (getSyncAllWidths()) {</span>
<span class="nc" id="L1032">                            xOffset = (container.getWidth() - insets.left -</span>
                                       insets.right - totalButtonWidth) /
                                (numChildren - 1) + maxWidth;
                        }
                        else {
<span class="nc" id="L1037">                            xOffset = (container.getWidth() - insets.left -</span>
                                       insets.right - totalButtonWidth) /
                                      (numChildren - 1);
                        }
                    }
                    break;
                }

<span class="nc bnc" id="L1045" title="All 2 branches missed.">                for (int counter = 0; counter &lt; numChildren; counter++) {</span>
<span class="nc bnc" id="L1046" title="All 2 branches missed.">                    int index = (reverse) ? numChildren - counter - 1 :</span>
                                counter;
<span class="nc" id="L1048">                    Dimension pref = children[index].getPreferredSize();</span>

<span class="nc bnc" id="L1050" title="All 2 branches missed.">                    if (getSyncAllWidths()) {</span>
<span class="nc" id="L1051">                        children[index].setBounds(x, insets.top,</span>
                                                  maxWidth, maxHeight);
                    }
                    else {
<span class="nc" id="L1055">                        children[index].setBounds(x, insets.top, pref.width,</span>
                                                  pref.height);
                    }
<span class="nc bnc" id="L1058" title="All 2 branches missed.">                    if (xOffset != 0) {</span>
<span class="nc" id="L1059">                        x += xOffset;</span>
                    }
                    else {
<span class="nc" id="L1062">                        x += children[index].getWidth() + padding;</span>
                    }
                }
            }
<span class="nc" id="L1066">        }</span>

        public Dimension minimumLayoutSize(Container c) {
<span class="nc bnc" id="L1069" title="All 2 branches missed.">            if(c != null) {</span>
<span class="nc" id="L1070">                Component[]       children = c.getComponents();</span>

<span class="nc bnc" id="L1072" title="All 4 branches missed.">                if(children != null &amp;&amp; children.length &gt; 0) {</span>
                    Dimension     aSize;
<span class="nc" id="L1074">                    int           numChildren = children.length;</span>
<span class="nc" id="L1075">                    int           height = 0;</span>
<span class="nc" id="L1076">                    Insets        cInsets = c.getInsets();</span>
<span class="nc" id="L1077">                    int           extraHeight = cInsets.top + cInsets.bottom;</span>
<span class="nc" id="L1078">                    int           extraWidth = cInsets.left + cInsets.right;</span>

<span class="nc bnc" id="L1080" title="All 2 branches missed.">                    if (syncAllWidths) {</span>
<span class="nc" id="L1081">                        int              maxWidth = 0;</span>

<span class="nc bnc" id="L1083" title="All 2 branches missed.">                        for(int counter = 0; counter &lt; numChildren; counter++){</span>
<span class="nc" id="L1084">                            aSize = children[counter].getPreferredSize();</span>
<span class="nc" id="L1085">                            height = Math.max(height, aSize.height);</span>
<span class="nc" id="L1086">                            maxWidth = Math.max(maxWidth, aSize.width);</span>
                        }
<span class="nc" id="L1088">                        return new Dimension(extraWidth + (maxWidth * numChildren) +</span>
                                             (numChildren - 1) * padding,
                                             extraHeight + height);
                    }
                    else {
<span class="nc" id="L1093">                        int        totalWidth = 0;</span>

<span class="nc bnc" id="L1095" title="All 2 branches missed.">                        for(int counter = 0; counter &lt; numChildren; counter++){</span>
<span class="nc" id="L1096">                            aSize = children[counter].getPreferredSize();</span>
<span class="nc" id="L1097">                            height = Math.max(height, aSize.height);</span>
<span class="nc" id="L1098">                            totalWidth += aSize.width;</span>
                        }
<span class="nc" id="L1100">                        totalWidth += ((numChildren - 1) * padding);</span>
<span class="nc" id="L1101">                        return new Dimension(extraWidth + totalWidth, extraHeight + height);</span>
                    }
                }
            }
<span class="nc" id="L1105">            return new Dimension(0, 0);</span>
        }

        public Dimension preferredLayoutSize(Container c) {
<span class="nc" id="L1109">            return minimumLayoutSize(c);</span>
        }

<span class="nc" id="L1112">        public void removeLayoutComponent(Component c) { }</span>
    }


    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of {@code BasicOptionPaneUI}.
     */
<span class="nc" id="L1120">    public class PropertyChangeHandler implements PropertyChangeListener {</span>
        /**
         * If the source of the PropertyChangeEvent &lt;code&gt;e&lt;/code&gt; equals the
         * optionPane and is one of the ICON_PROPERTY, MESSAGE_PROPERTY,
         * OPTIONS_PROPERTY or INITIAL_VALUE_PROPERTY,
         * validateComponent is invoked.
         */
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L1128">            getHandler().propertyChange(e);</span>
<span class="nc" id="L1129">        }</span>
    }

    /**
     * Configures any necessary colors/fonts for the specified label
     * used representing the message.
     */
    private void configureMessageLabel(JLabel label) {
<span class="nc" id="L1137">        Color color = (Color)DefaultLookup.get(optionPane, this,</span>
                                               &quot;OptionPane.messageForeground&quot;);
<span class="nc bnc" id="L1139" title="All 2 branches missed.">        if (color != null) {</span>
<span class="nc" id="L1140">            label.setForeground(color);</span>
        }
<span class="nc" id="L1142">        Font messageFont = (Font)DefaultLookup.get(optionPane, this,</span>
                                                   &quot;OptionPane.messageFont&quot;);
<span class="nc bnc" id="L1144" title="All 2 branches missed.">        if (messageFont != null) {</span>
<span class="nc" id="L1145">            label.setFont(messageFont);</span>
        }
<span class="nc" id="L1147">    }</span>

    /**
     * Configures any necessary colors/fonts for the specified button
     * used representing the button portion of the optionpane.
     */
    private void configureButton(JButton button) {
<span class="nc" id="L1154">        Font buttonFont = (Font)DefaultLookup.get(optionPane, this,</span>
                                            &quot;OptionPane.buttonFont&quot;);
<span class="nc bnc" id="L1156" title="All 2 branches missed.">        if (buttonFont != null) {</span>
<span class="nc" id="L1157">            button.setFont(buttonFont);</span>
        }
<span class="nc" id="L1159">    }</span>

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of {@code BasicOptionPaneUI}.
     */
    public class ButtonActionListener implements ActionListener {
        protected int buttonIndex;

<span class="nc" id="L1168">        public ButtonActionListener(int buttonIndex) {</span>
<span class="nc" id="L1169">            this.buttonIndex = buttonIndex;</span>
<span class="nc" id="L1170">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L1173" title="All 2 branches missed.">            if (optionPane != null) {</span>
<span class="nc" id="L1174">                int optionType = optionPane.getOptionType();</span>
<span class="nc" id="L1175">                Object[] options = optionPane.getOptions();</span>

                /* If the option pane takes input, then store the input value
                 * if custom options were specified, if the option type is
                 * DEFAULT_OPTION, OR if option type is set to a predefined
                 * one and the user chose the affirmative answer.
                 */
<span class="nc bnc" id="L1182" title="All 2 branches missed.">                if (inputComponent != null) {</span>
<span class="nc bnc" id="L1183" title="All 12 branches missed.">                    if (options != null ||</span>
                        optionType == JOptionPane.DEFAULT_OPTION ||
                        ((optionType == JOptionPane.YES_NO_OPTION ||
                         optionType == JOptionPane.YES_NO_CANCEL_OPTION ||
                         optionType == JOptionPane.OK_CANCEL_OPTION) &amp;&amp;
                         buttonIndex == 0)) {
<span class="nc" id="L1189">                        resetInputValue();</span>
                    }
                }
<span class="nc bnc" id="L1192" title="All 2 branches missed.">                if (options == null) {</span>
<span class="nc bnc" id="L1193" title="All 4 branches missed.">                    if (optionType == JOptionPane.OK_CANCEL_OPTION &amp;&amp;</span>
                        buttonIndex == 1) {
<span class="nc" id="L1195">                        optionPane.setValue(Integer.valueOf(2));</span>

                    } else {
<span class="nc" id="L1198">                        optionPane.setValue(Integer.valueOf(buttonIndex));</span>
                    }
                } else {
<span class="nc" id="L1201">                    optionPane.setValue(options[buttonIndex]);</span>
                }
            }
<span class="nc" id="L1204">        }</span>
    }


<span class="nc" id="L1208">    private class Handler implements ActionListener, MouseListener,</span>
                                     PropertyChangeListener {
        //
        // ActionListener
        //
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1214">            optionPane.setInputValue(((JTextField)e.getSource()).getText());</span>
<span class="nc" id="L1215">        }</span>


        //
        // MouseListener
        //
        public void mouseClicked(MouseEvent e) {
<span class="nc" id="L1222">        }</span>

        public void mouseReleased(MouseEvent e) {
<span class="nc" id="L1225">        }</span>

        public void mouseEntered(MouseEvent e) {
<span class="nc" id="L1228">        }</span>

        public void mouseExited(MouseEvent e) {
<span class="nc" id="L1231">        }</span>

        public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L1234" title="All 2 branches missed.">            if (e.getClickCount() == 2) {</span>
<span class="nc" id="L1235">                JList     list = (JList)e.getSource();</span>
<span class="nc" id="L1236">                int       index = list.locationToIndex(e.getPoint());</span>

<span class="nc" id="L1238">                optionPane.setInputValue(list.getModel().getElementAt(index));</span>
<span class="nc" id="L1239">                optionPane.setValue(JOptionPane.OK_OPTION);</span>
            }
<span class="nc" id="L1241">        }</span>

        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc bnc" id="L1247" title="All 2 branches missed.">            if(e.getSource() == optionPane) {</span>
                // Option Pane Auditory Cue Activation
                // only respond to &quot;ancestor&quot; changes
                // the idea being that a JOptionPane gets a JDialog when it is
                // set to appear and loses it's JDialog when it is dismissed.
<span class="nc bnc" id="L1252" title="All 2 branches missed.">                if (&quot;ancestor&quot; == e.getPropertyName()) {</span>
<span class="nc" id="L1253">                    JOptionPane op = (JOptionPane)e.getSource();</span>
                    boolean isComingUp;

                    // if the old value is null, then the JOptionPane is being
                    // created since it didn't previously have an ancestor.
<span class="nc bnc" id="L1258" title="All 2 branches missed.">                    if (e.getOldValue() == null) {</span>
<span class="nc" id="L1259">                        isComingUp = true;</span>
                    } else {
<span class="nc" id="L1261">                        isComingUp = false;</span>
                    }

                    // figure out what to do based on the message type
<span class="nc bnc" id="L1265" title="All 6 branches missed.">                    switch (op.getMessageType()) {</span>
                    case JOptionPane.PLAIN_MESSAGE:
<span class="nc bnc" id="L1267" title="All 2 branches missed.">                        if (isComingUp) {</span>
<span class="nc" id="L1268">                            BasicLookAndFeel.playSound(optionPane,</span>
                                               &quot;OptionPane.informationSound&quot;);
                        }
                        break;
                    case JOptionPane.QUESTION_MESSAGE:
<span class="nc bnc" id="L1273" title="All 2 branches missed.">                        if (isComingUp) {</span>
<span class="nc" id="L1274">                            BasicLookAndFeel.playSound(optionPane,</span>
                                             &quot;OptionPane.questionSound&quot;);
                        }
                        break;
                    case JOptionPane.INFORMATION_MESSAGE:
<span class="nc bnc" id="L1279" title="All 2 branches missed.">                        if (isComingUp) {</span>
<span class="nc" id="L1280">                            BasicLookAndFeel.playSound(optionPane,</span>
                                             &quot;OptionPane.informationSound&quot;);
                        }
                        break;
                    case JOptionPane.WARNING_MESSAGE:
<span class="nc bnc" id="L1285" title="All 2 branches missed.">                        if (isComingUp) {</span>
<span class="nc" id="L1286">                            BasicLookAndFeel.playSound(optionPane,</span>
                                             &quot;OptionPane.warningSound&quot;);
                        }
                        break;
                    case JOptionPane.ERROR_MESSAGE:
<span class="nc bnc" id="L1291" title="All 2 branches missed.">                        if (isComingUp) {</span>
<span class="nc" id="L1292">                            BasicLookAndFeel.playSound(optionPane,</span>
                                             &quot;OptionPane.errorSound&quot;);
                        }
                        break;
                    default:
<span class="nc" id="L1297">                        System.err.println(&quot;Undefined JOptionPane type: &quot; +</span>
<span class="nc" id="L1298">                                           op.getMessageType());</span>
                        break;
                    }
                }
                // Visual activity
<span class="nc" id="L1303">                String         changeName = e.getPropertyName();</span>

<span class="nc bnc" id="L1305" title="All 18 branches missed.">                if(changeName == JOptionPane.OPTIONS_PROPERTY ||</span>
                   changeName == JOptionPane.INITIAL_VALUE_PROPERTY ||
                   changeName == JOptionPane.ICON_PROPERTY ||
                   changeName == JOptionPane.MESSAGE_TYPE_PROPERTY ||
                   changeName == JOptionPane.OPTION_TYPE_PROPERTY ||
                   changeName == JOptionPane.MESSAGE_PROPERTY ||
                   changeName == JOptionPane.SELECTION_VALUES_PROPERTY ||
                   changeName == JOptionPane.INITIAL_SELECTION_VALUE_PROPERTY ||
                   changeName == JOptionPane.WANTS_INPUT_PROPERTY) {
<span class="nc" id="L1314">                   uninstallComponents();</span>
<span class="nc" id="L1315">                   installComponents();</span>
<span class="nc" id="L1316">                   optionPane.validate();</span>
                }
<span class="nc bnc" id="L1318" title="All 2 branches missed.">                else if (changeName == &quot;componentOrientation&quot;) {</span>
<span class="nc" id="L1319">                    ComponentOrientation o = (ComponentOrientation)e.getNewValue();</span>
<span class="nc" id="L1320">                    JOptionPane op = (JOptionPane)e.getSource();</span>
<span class="nc bnc" id="L1321" title="All 2 branches missed.">                    if (o != e.getOldValue()) {</span>
<span class="nc" id="L1322">                        op.applyComponentOrientation(o);</span>
                    }
                }
            }
<span class="nc" id="L1326">        }</span>
    }


    //
    // Classes used when optionPane.getWantsInput returns true.
    //

    /**
     * A JTextField that allows you to specify an array of KeyStrokes that
     * that will have their bindings processed regardless of whether or
     * not they are registered on the JTextField. This is used as we really
     * want the ActionListener to be notified so that we can push the
     * change to the JOptionPane, but we also want additional bindings
     * (those of the JRootPane) to be processed as well.
     */
    private static class MultiplexingTextField extends JTextField {
        private KeyStroke[] strokes;

        MultiplexingTextField(int cols) {
<span class="nc" id="L1346">            super(cols);</span>
<span class="nc" id="L1347">        }</span>

        /**
         * Sets the KeyStrokes that will be additional processed for
         * ancestor bindings.
         */
        void setKeyStrokes(KeyStroke[] strokes) {
<span class="nc" id="L1354">            this.strokes = strokes;</span>
<span class="nc" id="L1355">        }</span>

        protected boolean processKeyBinding(KeyStroke ks, KeyEvent e,
                                            int condition, boolean pressed) {
<span class="nc" id="L1359">            boolean processed = super.processKeyBinding(ks, e, condition,</span>
                                                        pressed);

<span class="nc bnc" id="L1362" title="All 4 branches missed.">            if (processed &amp;&amp; condition != JComponent.WHEN_IN_FOCUSED_WINDOW) {</span>
<span class="nc bnc" id="L1363" title="All 2 branches missed.">                for (int counter = strokes.length - 1; counter &gt;= 0;</span>
<span class="nc" id="L1364">                         counter--) {</span>
<span class="nc bnc" id="L1365" title="All 2 branches missed.">                    if (strokes[counter].equals(ks)) {</span>
                        // Returning false will allow further processing
                        // of the bindings, eg our parent Containers will get a
                        // crack at them.
<span class="nc" id="L1369">                        return false;</span>
                    }
                }
            }
<span class="nc" id="L1373">            return processed;</span>
        }
    }



    /**
     * Registered in the ActionMap. Sets the value of the option pane
     * to &lt;code&gt;JOptionPane.CLOSED_OPTION&lt;/code&gt;.
     */
    private static class Actions extends UIAction {
        private static final String CLOSE = &quot;close&quot;;

        Actions(String key) {
<span class="nc" id="L1387">            super(key);</span>
<span class="nc" id="L1388">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L1391" title="All 2 branches missed.">            if (getName() == CLOSE) {</span>
<span class="nc" id="L1392">                JOptionPane optionPane = (JOptionPane)e.getSource();</span>

<span class="nc" id="L1394">                optionPane.setValue(Integer.valueOf(JOptionPane.CLOSED_OPTION));</span>
            }
<span class="nc" id="L1396">        }</span>
    }


    /**
     * This class is used to create the default buttons. This indirection is
     * used so that addButtonComponents can tell which Buttons were created
     * by us vs subclassers or from the JOptionPane itself.
     */
<span class="nc" id="L1405">    private static class ButtonFactory {</span>
        private String text;
        private int mnemonic;
        private Icon icon;
<span class="nc" id="L1409">        private int minimumWidth = -1;</span>

<span class="nc" id="L1411">        ButtonFactory(String text, int mnemonic, Icon icon, int minimumWidth) {</span>
<span class="nc" id="L1412">            this.text = text;</span>
<span class="nc" id="L1413">            this.mnemonic = mnemonic;</span>
<span class="nc" id="L1414">            this.icon = icon;</span>
<span class="nc" id="L1415">            this.minimumWidth = minimumWidth;</span>
<span class="nc" id="L1416">        }</span>

        JButton createButton() {
            JButton button;

<span class="nc bnc" id="L1421" title="All 2 branches missed.">            if (minimumWidth &gt; 0) {</span>
<span class="nc" id="L1422">                button = new ConstrainedButton(text, minimumWidth);</span>
            } else {
<span class="nc" id="L1424">                button = new JButton(text);</span>
            }
<span class="nc bnc" id="L1426" title="All 2 branches missed.">            if (icon != null) {</span>
<span class="nc" id="L1427">                button.setIcon(icon);</span>
            }
<span class="nc bnc" id="L1429" title="All 2 branches missed.">            if (mnemonic != 0) {</span>
<span class="nc" id="L1430">                button.setMnemonic(mnemonic);</span>
            }
<span class="nc" id="L1432">            return button;</span>
        }

        private static class ConstrainedButton extends JButton {
            int minimumWidth;

            ConstrainedButton(String text, int minimumWidth) {
<span class="nc" id="L1439">                super(text);</span>
<span class="nc" id="L1440">                this.minimumWidth = minimumWidth;</span>
<span class="nc" id="L1441">            }</span>

            public Dimension getMinimumSize() {
<span class="nc" id="L1444">                Dimension min = super.getMinimumSize();</span>
<span class="nc" id="L1445">                min.width = Math.max(min.width, minimumWidth);</span>
<span class="nc" id="L1446">                return min;</span>
            }

            public Dimension getPreferredSize() {
<span class="nc" id="L1450">                Dimension pref = super.getPreferredSize();</span>
<span class="nc" id="L1451">                pref.width = Math.max(pref.width, minimumWidth);</span>
<span class="nc" id="L1452">                return pref;</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>