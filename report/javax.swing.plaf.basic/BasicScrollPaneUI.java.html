<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BasicScrollPaneUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicScrollPaneUI.java</span></div><h1>BasicScrollPaneUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import sun.swing.DefaultLookup;
import sun.swing.UIAction;

import javax.swing.*;
import javax.swing.event.*;
import javax.swing.border.*;
import javax.swing.plaf.*;

import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeEvent;

import java.awt.Component;
import java.awt.Rectangle;
import java.awt.Dimension;
import java.awt.Point;
import java.awt.Insets;
import java.awt.Graphics;
import java.awt.event.*;

/**
 * A default L&amp;amp;F implementation of ScrollPaneUI.
 *
 * @author Hans Muller
 */
<span class="nc" id="L52">public class BasicScrollPaneUI</span>
    extends ScrollPaneUI implements ScrollPaneConstants
{
    protected JScrollPane scrollpane;
    protected ChangeListener vsbChangeListener;
    protected ChangeListener hsbChangeListener;
    protected ChangeListener viewportChangeListener;
    protected PropertyChangeListener spPropertyChangeListener;
    private MouseWheelListener mouseScrollListener;
<span class="nc" id="L61">    private int oldExtent = Integer.MIN_VALUE;</span>

    /**
     * PropertyChangeListener installed on the vertical scrollbar.
     */
    private PropertyChangeListener vsbPropertyChangeListener;

    /**
     * PropertyChangeListener installed on the horizontal scrollbar.
     */
    private PropertyChangeListener hsbPropertyChangeListener;

    private Handler handler;

    /**
     * State flag that shows whether setValue() was called from a user program
     * before the value of &quot;extent&quot; was set in right-to-left component
     * orientation.
     */
<span class="nc" id="L80">    private boolean setValueCalled = false;</span>


    public static ComponentUI createUI(JComponent x) {
<span class="nc" id="L84">        return new BasicScrollPaneUI();</span>
    }

    static void loadActionMap(LazyActionMap map) {
<span class="nc" id="L88">        map.put(new Actions(Actions.SCROLL_UP));</span>
<span class="nc" id="L89">        map.put(new Actions(Actions.SCROLL_DOWN));</span>
<span class="nc" id="L90">        map.put(new Actions(Actions.SCROLL_HOME));</span>
<span class="nc" id="L91">        map.put(new Actions(Actions.SCROLL_END));</span>
<span class="nc" id="L92">        map.put(new Actions(Actions.UNIT_SCROLL_UP));</span>
<span class="nc" id="L93">        map.put(new Actions(Actions.UNIT_SCROLL_DOWN));</span>
<span class="nc" id="L94">        map.put(new Actions(Actions.SCROLL_LEFT));</span>
<span class="nc" id="L95">        map.put(new Actions(Actions.SCROLL_RIGHT));</span>
<span class="nc" id="L96">        map.put(new Actions(Actions.UNIT_SCROLL_RIGHT));</span>
<span class="nc" id="L97">        map.put(new Actions(Actions.UNIT_SCROLL_LEFT));</span>
<span class="nc" id="L98">    }</span>



    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L103">        Border vpBorder = scrollpane.getViewportBorder();</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (vpBorder != null) {</span>
<span class="nc" id="L105">            Rectangle r = scrollpane.getViewportBorderBounds();</span>
<span class="nc" id="L106">            vpBorder.paintBorder(scrollpane, g, r.x, r.y, r.width, r.height);</span>
        }
<span class="nc" id="L108">    }</span>


    /**
     * @return new Dimension(Short.MAX_VALUE, Short.MAX_VALUE)
     */
    public Dimension getMaximumSize(JComponent c) {
<span class="nc" id="L115">        return new Dimension(Short.MAX_VALUE, Short.MAX_VALUE);</span>
    }


    protected void installDefaults(JScrollPane scrollpane)
    {
<span class="nc" id="L121">        LookAndFeel.installBorder(scrollpane, &quot;ScrollPane.border&quot;);</span>
<span class="nc" id="L122">        LookAndFeel.installColorsAndFont(scrollpane,</span>
            &quot;ScrollPane.background&quot;,
            &quot;ScrollPane.foreground&quot;,
            &quot;ScrollPane.font&quot;);

<span class="nc" id="L127">        Border vpBorder = scrollpane.getViewportBorder();</span>
<span class="nc bnc" id="L128" title="All 4 branches missed.">        if ((vpBorder == null) ||( vpBorder instanceof UIResource)) {</span>
<span class="nc" id="L129">            vpBorder = UIManager.getBorder(&quot;ScrollPane.viewportBorder&quot;);</span>
<span class="nc" id="L130">            scrollpane.setViewportBorder(vpBorder);</span>
        }
<span class="nc" id="L132">        LookAndFeel.installProperty(scrollpane, &quot;opaque&quot;, Boolean.TRUE);</span>
<span class="nc" id="L133">    }</span>


    protected void installListeners(JScrollPane c)
    {
<span class="nc" id="L138">        vsbChangeListener = createVSBChangeListener();</span>
<span class="nc" id="L139">        vsbPropertyChangeListener = createVSBPropertyChangeListener();</span>
<span class="nc" id="L140">        hsbChangeListener = createHSBChangeListener();</span>
<span class="nc" id="L141">        hsbPropertyChangeListener = createHSBPropertyChangeListener();</span>
<span class="nc" id="L142">        viewportChangeListener = createViewportChangeListener();</span>
<span class="nc" id="L143">        spPropertyChangeListener = createPropertyChangeListener();</span>

<span class="nc" id="L145">        JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L146">        JScrollBar vsb = scrollpane.getVerticalScrollBar();</span>
<span class="nc" id="L147">        JScrollBar hsb = scrollpane.getHorizontalScrollBar();</span>

<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (viewport != null) {</span>
<span class="nc" id="L150">            viewport.addChangeListener(viewportChangeListener);</span>
        }
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (vsb != null) {</span>
<span class="nc" id="L153">            vsb.getModel().addChangeListener(vsbChangeListener);</span>
<span class="nc" id="L154">            vsb.addPropertyChangeListener(vsbPropertyChangeListener);</span>
        }
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (hsb != null) {</span>
<span class="nc" id="L157">            hsb.getModel().addChangeListener(hsbChangeListener);</span>
<span class="nc" id="L158">            hsb.addPropertyChangeListener(hsbPropertyChangeListener);</span>
        }

<span class="nc" id="L161">        scrollpane.addPropertyChangeListener(spPropertyChangeListener);</span>

<span class="nc" id="L163">    mouseScrollListener = createMouseWheelListener();</span>
<span class="nc" id="L164">    scrollpane.addMouseWheelListener(mouseScrollListener);</span>

<span class="nc" id="L166">    }</span>

    protected void installKeyboardActions(JScrollPane c) {
<span class="nc" id="L169">        InputMap inputMap = getInputMap(JComponent.</span>
                                  WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);

<span class="nc" id="L172">        SwingUtilities.replaceUIInputMap(c, JComponent.</span>
                               WHEN_ANCESTOR_OF_FOCUSED_COMPONENT, inputMap);

<span class="nc" id="L175">        LazyActionMap.installLazyActionMap(c, BasicScrollPaneUI.class,</span>
                                           &quot;ScrollPane.actionMap&quot;);
<span class="nc" id="L177">    }</span>

    InputMap getInputMap(int condition) {
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (condition == JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT) {</span>
<span class="nc" id="L181">            InputMap keyMap = (InputMap)DefaultLookup.get(scrollpane, this,</span>
                                        &quot;ScrollPane.ancestorInputMap&quot;);
            InputMap rtlKeyMap;

<span class="nc bnc" id="L185" title="All 2 branches missed.">            if (scrollpane.getComponentOrientation().isLeftToRight() ||</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">                    ((rtlKeyMap = (InputMap)DefaultLookup.get(scrollpane, this,</span>
                    &quot;ScrollPane.ancestorInputMap.RightToLeft&quot;)) == null)) {
<span class="nc" id="L188">                return keyMap;</span>
            } else {
<span class="nc" id="L190">                rtlKeyMap.setParent(keyMap);</span>
<span class="nc" id="L191">                return rtlKeyMap;</span>
            }
        }
<span class="nc" id="L194">        return null;</span>
    }

    public void installUI(JComponent x) {
<span class="nc" id="L198">        scrollpane = (JScrollPane)x;</span>
<span class="nc" id="L199">        installDefaults(scrollpane);</span>
<span class="nc" id="L200">        installListeners(scrollpane);</span>
<span class="nc" id="L201">        installKeyboardActions(scrollpane);</span>
<span class="nc" id="L202">    }</span>


    protected void uninstallDefaults(JScrollPane c) {
<span class="nc" id="L206">        LookAndFeel.uninstallBorder(scrollpane);</span>

<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (scrollpane.getViewportBorder() instanceof UIResource) {</span>
<span class="nc" id="L209">            scrollpane.setViewportBorder(null);</span>
        }
<span class="nc" id="L211">    }</span>


    protected void uninstallListeners(JComponent c) {
<span class="nc" id="L215">        JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L216">        JScrollBar vsb = scrollpane.getVerticalScrollBar();</span>
<span class="nc" id="L217">        JScrollBar hsb = scrollpane.getHorizontalScrollBar();</span>

<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (viewport != null) {</span>
<span class="nc" id="L220">            viewport.removeChangeListener(viewportChangeListener);</span>
        }
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if (vsb != null) {</span>
<span class="nc" id="L223">            vsb.getModel().removeChangeListener(vsbChangeListener);</span>
<span class="nc" id="L224">            vsb.removePropertyChangeListener(vsbPropertyChangeListener);</span>
        }
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (hsb != null) {</span>
<span class="nc" id="L227">            hsb.getModel().removeChangeListener(hsbChangeListener);</span>
<span class="nc" id="L228">            hsb.removePropertyChangeListener(hsbPropertyChangeListener);</span>
        }

<span class="nc" id="L231">        scrollpane.removePropertyChangeListener(spPropertyChangeListener);</span>

<span class="nc bnc" id="L233" title="All 2 branches missed.">    if (mouseScrollListener != null) {</span>
<span class="nc" id="L234">        scrollpane.removeMouseWheelListener(mouseScrollListener);</span>
    }

<span class="nc" id="L237">        vsbChangeListener = null;</span>
<span class="nc" id="L238">        hsbChangeListener = null;</span>
<span class="nc" id="L239">        viewportChangeListener = null;</span>
<span class="nc" id="L240">        spPropertyChangeListener = null;</span>
<span class="nc" id="L241">        mouseScrollListener = null;</span>
<span class="nc" id="L242">        handler = null;</span>
<span class="nc" id="L243">    }</span>


    protected void uninstallKeyboardActions(JScrollPane c) {
<span class="nc" id="L247">        SwingUtilities.replaceUIActionMap(c, null);</span>
<span class="nc" id="L248">        SwingUtilities.replaceUIInputMap(c, JComponent.</span>
                           WHEN_ANCESTOR_OF_FOCUSED_COMPONENT, null);
<span class="nc" id="L250">    }</span>


    public void uninstallUI(JComponent c) {
<span class="nc" id="L254">        uninstallDefaults(scrollpane);</span>
<span class="nc" id="L255">        uninstallListeners(scrollpane);</span>
<span class="nc" id="L256">        uninstallKeyboardActions(scrollpane);</span>
<span class="nc" id="L257">        scrollpane = null;</span>
<span class="nc" id="L258">    }</span>

    private Handler getHandler() {
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L262">            handler = new Handler();</span>
        }
<span class="nc" id="L264">        return handler;</span>
    }

    protected void syncScrollPaneWithViewport()
    {
<span class="nc" id="L269">        JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L270">        JScrollBar vsb = scrollpane.getVerticalScrollBar();</span>
<span class="nc" id="L271">        JScrollBar hsb = scrollpane.getHorizontalScrollBar();</span>
<span class="nc" id="L272">        JViewport rowHead = scrollpane.getRowHeader();</span>
<span class="nc" id="L273">        JViewport colHead = scrollpane.getColumnHeader();</span>
<span class="nc" id="L274">        boolean ltr = scrollpane.getComponentOrientation().isLeftToRight();</span>

<span class="nc bnc" id="L276" title="All 2 branches missed.">        if (viewport != null) {</span>
<span class="nc" id="L277">            Dimension extentSize = viewport.getExtentSize();</span>
<span class="nc" id="L278">            Dimension viewSize = viewport.getViewSize();</span>
<span class="nc" id="L279">            Point viewPosition = viewport.getViewPosition();</span>

<span class="nc bnc" id="L281" title="All 2 branches missed.">            if (vsb != null) {</span>
<span class="nc" id="L282">                int extent = extentSize.height;</span>
<span class="nc" id="L283">                int max = viewSize.height;</span>
<span class="nc" id="L284">                int value = Math.max(0, Math.min(viewPosition.y, max - extent));</span>
<span class="nc" id="L285">                vsb.setValues(value, extent, 0, max);</span>
            }

<span class="nc bnc" id="L288" title="All 2 branches missed.">            if (hsb != null) {</span>
<span class="nc" id="L289">                int extent = extentSize.width;</span>
<span class="nc" id="L290">                int max = viewSize.width;</span>
                int value;

<span class="nc bnc" id="L293" title="All 2 branches missed.">                if (ltr) {</span>
<span class="nc" id="L294">                    value = Math.max(0, Math.min(viewPosition.x, max - extent));</span>
                } else {
<span class="nc" id="L296">                    int currentValue = hsb.getValue();</span>

                    /* Use a particular formula to calculate &quot;value&quot;
                     * until effective x coordinate is calculated.
                     */
<span class="nc bnc" id="L301" title="All 4 branches missed.">                    if (setValueCalled &amp;&amp; ((max - currentValue) == viewPosition.x)) {</span>
<span class="nc" id="L302">                        value = Math.max(0, Math.min(max - extent, currentValue));</span>
                        /* After &quot;extent&quot; is set, turn setValueCalled flag off.
                         */
<span class="nc bnc" id="L305" title="All 2 branches missed.">                        if (extent != 0) {</span>
<span class="nc" id="L306">                            setValueCalled = false;</span>
                        }
                    } else {
<span class="nc bnc" id="L309" title="All 2 branches missed.">                        if (extent &gt; max) {</span>
<span class="nc" id="L310">                            viewPosition.x = max - extent;</span>
<span class="nc" id="L311">                            viewport.setViewPosition(viewPosition);</span>
<span class="nc" id="L312">                            value = 0;</span>
                        } else {
                           /* The following line can't handle a small value of
                            * viewPosition.x like Integer.MIN_VALUE correctly
                            * because (max - extent - viewPositoiin.x) causes
                            * an overflow. As a result, value becomes zero.
                            * (e.g. setViewPosition(Integer.MAX_VALUE, ...)
                            *       in a user program causes a overflow.
                            *       Its expected value is (max - extent).)
                            * However, this seems a trivial bug and adding a
                            * fix makes this often-called method slow, so I'll
                            * leave it until someone claims.
                            */
<span class="nc" id="L325">                            value = Math.max(0, Math.min(max - extent, max - extent - viewPosition.x));</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                            if (oldExtent &gt; extent) {</span>
<span class="nc" id="L327">                                value -= oldExtent - extent;</span>
                            }
                        }
                    }
                }
<span class="nc" id="L332">                oldExtent = extent;</span>
<span class="nc" id="L333">                hsb.setValues(value, extent, 0, max);</span>
            }

<span class="nc bnc" id="L336" title="All 2 branches missed.">            if (rowHead != null) {</span>
<span class="nc" id="L337">                Point p = rowHead.getViewPosition();</span>
<span class="nc" id="L338">                p.y = viewport.getViewPosition().y;</span>
<span class="nc" id="L339">                p.x = 0;</span>
<span class="nc" id="L340">                rowHead.setViewPosition(p);</span>
            }

<span class="nc bnc" id="L343" title="All 2 branches missed.">            if (colHead != null) {</span>
<span class="nc" id="L344">                Point p = colHead.getViewPosition();</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">                if (ltr) {</span>
<span class="nc" id="L346">                    p.x = viewport.getViewPosition().x;</span>
                } else {
<span class="nc" id="L348">                    p.x = Math.max(0, viewport.getViewPosition().x);</span>
                }
<span class="nc" id="L350">                p.y = 0;</span>
<span class="nc" id="L351">                colHead.setViewPosition(p);</span>
            }
        }
<span class="nc" id="L354">    }</span>

    /**
     * Returns the baseline.
     *
     * @throws NullPointerException {@inheritDoc}
     * @throws IllegalArgumentException {@inheritDoc}
     * @see javax.swing.JComponent#getBaseline(int, int)
     * @since 1.6
     */
    public int getBaseline(JComponent c, int width, int height) {
<span class="nc bnc" id="L365" title="All 2 branches missed.">        if (c == null) {</span>
<span class="nc" id="L366">            throw new NullPointerException(&quot;Component must be non-null&quot;);</span>
        }

<span class="nc bnc" id="L369" title="All 4 branches missed.">        if (width &lt; 0 || height &lt; 0) {</span>
<span class="nc" id="L370">            throw new IllegalArgumentException(&quot;Width and height must be &gt;= 0&quot;);</span>
        }

<span class="nc" id="L373">        JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L374">        Insets spInsets = scrollpane.getInsets();</span>
<span class="nc" id="L375">        int y = spInsets.top;</span>
<span class="nc" id="L376">        height = height - spInsets.top - spInsets.bottom;</span>
<span class="nc" id="L377">        width = width - spInsets.left - spInsets.right;</span>
<span class="nc" id="L378">        JViewport columnHeader = scrollpane.getColumnHeader();</span>
<span class="nc bnc" id="L379" title="All 4 branches missed.">        if (columnHeader != null &amp;&amp; columnHeader.isVisible()) {</span>
<span class="nc" id="L380">            Component header = columnHeader.getView();</span>
<span class="nc bnc" id="L381" title="All 4 branches missed.">            if (header != null &amp;&amp; header.isVisible()) {</span>
                // Header is always given it's preferred size.
<span class="nc" id="L383">                Dimension headerPref = header.getPreferredSize();</span>
<span class="nc" id="L384">                int baseline = header.getBaseline(headerPref.width,</span>
                                                  headerPref.height);
<span class="nc bnc" id="L386" title="All 2 branches missed.">                if (baseline &gt;= 0) {</span>
<span class="nc" id="L387">                    return y + baseline;</span>
                }
            }
<span class="nc" id="L390">            Dimension columnPref = columnHeader.getPreferredSize();</span>
<span class="nc" id="L391">            height -= columnPref.height;</span>
<span class="nc" id="L392">            y += columnPref.height;</span>
        }
<span class="nc bnc" id="L394" title="All 2 branches missed.">        Component view = (viewport == null) ? null : viewport.getView();</span>
<span class="nc bnc" id="L395" title="All 4 branches missed.">        if (view != null &amp;&amp; view.isVisible() &amp;&amp;</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">                view.getBaselineResizeBehavior() ==</span>
                Component.BaselineResizeBehavior.CONSTANT_ASCENT) {
<span class="nc" id="L398">            Border viewportBorder = scrollpane.getViewportBorder();</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">            if (viewportBorder != null) {</span>
<span class="nc" id="L400">                Insets vpbInsets = viewportBorder.getBorderInsets(scrollpane);</span>
<span class="nc" id="L401">                y += vpbInsets.top;</span>
<span class="nc" id="L402">                height = height - vpbInsets.top - vpbInsets.bottom;</span>
<span class="nc" id="L403">                width = width - vpbInsets.left - vpbInsets.right;</span>
            }
<span class="nc bnc" id="L405" title="All 4 branches missed.">            if (view.getWidth() &gt; 0 &amp;&amp; view.getHeight() &gt; 0) {</span>
<span class="nc" id="L406">                Dimension min = view.getMinimumSize();</span>
<span class="nc" id="L407">                width = Math.max(min.width, view.getWidth());</span>
<span class="nc" id="L408">                height = Math.max(min.height, view.getHeight());</span>
            }
<span class="nc bnc" id="L410" title="All 4 branches missed.">            if (width &gt; 0 &amp;&amp; height &gt; 0) {</span>
<span class="nc" id="L411">                int baseline = view.getBaseline(width, height);</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">                if (baseline &gt; 0) {</span>
<span class="nc" id="L413">                    return y + baseline;</span>
                }
            }
        }
<span class="nc" id="L417">        return -1;</span>
    }

    /**
     * Returns an enum indicating how the baseline of the component
     * changes as the size changes.
     *
     * @throws NullPointerException {@inheritDoc}
     * @see javax.swing.JComponent#getBaseline(int, int)
     * @since 1.6
     */
    public Component.BaselineResizeBehavior getBaselineResizeBehavior(
            JComponent c) {
<span class="nc" id="L430">        super.getBaselineResizeBehavior(c);</span>
        // Baseline is either from the header, in which case it's always
        // the same size and therefor can be created as CONSTANT_ASCENT.
        // If the header doesn't have a baseline than the baseline will only
        // be valid if it's BaselineResizeBehavior is
        // CONSTANT_ASCENT, so, return CONSTANT_ASCENT.
<span class="nc" id="L436">        return Component.BaselineResizeBehavior.CONSTANT_ASCENT;</span>
    }


    /**
     * Listener for viewport events.
     */
<span class="nc" id="L443">    public class ViewportChangeHandler implements ChangeListener</span>
    {

        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        public void stateChanged(ChangeEvent e) {
<span class="nc" id="L452">            getHandler().stateChanged(e);</span>
<span class="nc" id="L453">        }</span>
    }

    protected ChangeListener createViewportChangeListener() {
<span class="nc" id="L457">        return getHandler();</span>
    }


    /**
     * Horizontal scrollbar listener.
     */
<span class="nc" id="L464">    public class HSBChangeListener implements ChangeListener</span>
    {

        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        public void stateChanged(ChangeEvent e)
        {
<span class="nc" id="L474">            getHandler().stateChanged(e);</span>
<span class="nc" id="L475">        }</span>
    }

    /**
     * Returns a &lt;code&gt;PropertyChangeListener&lt;/code&gt; that will be installed
     * on the horizontal &lt;code&gt;JScrollBar&lt;/code&gt;.
     */
    private PropertyChangeListener createHSBPropertyChangeListener() {
<span class="nc" id="L483">        return getHandler();</span>
    }

    protected ChangeListener createHSBChangeListener() {
<span class="nc" id="L487">        return getHandler();</span>
    }


    /**
     * Vertical scrollbar listener.
     */
<span class="nc" id="L494">    public class VSBChangeListener implements ChangeListener</span>
    {

        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        public void stateChanged(ChangeEvent e)
        {
<span class="nc" id="L504">            getHandler().stateChanged(e);</span>
<span class="nc" id="L505">        }</span>
    }


    /**
     * Returns a &lt;code&gt;PropertyChangeListener&lt;/code&gt; that will be installed
     * on the vertical &lt;code&gt;JScrollBar&lt;/code&gt;.
     */
    private PropertyChangeListener createVSBPropertyChangeListener() {
<span class="nc" id="L514">        return getHandler();</span>
    }

    protected ChangeListener createVSBChangeListener() {
<span class="nc" id="L518">        return getHandler();</span>
    }

    /**
     * MouseWheelHandler is an inner class which implements the
     * MouseWheelListener interface.  MouseWheelHandler responds to
     * MouseWheelEvents by scrolling the JScrollPane appropriately.
     * If the scroll pane's
     * &lt;code&gt;isWheelScrollingEnabled&lt;/code&gt;
     * method returns false, no scrolling occurs.
     *
     * @see javax.swing.JScrollPane#isWheelScrollingEnabled
     * @see #createMouseWheelListener
     * @see java.awt.event.MouseWheelListener
     * @see java.awt.event.MouseWheelEvent
     * @since 1.4
     */
<span class="nc" id="L535">    protected class MouseWheelHandler implements MouseWheelListener {</span>

        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        /**
         * Called when the mouse wheel is rotated while over a
         * JScrollPane.
         *
         * @param e     MouseWheelEvent to be handled
         * @since 1.4
         */
        public void mouseWheelMoved(MouseWheelEvent e) {
<span class="nc" id="L550">            getHandler().mouseWheelMoved(e);</span>
<span class="nc" id="L551">        }</span>
    }

    /**
     * Creates an instance of MouseWheelListener, which is added to the
     * JScrollPane by installUI().  The returned MouseWheelListener is used
     * to handle mouse wheel-driven scrolling.
     *
     * @return      MouseWheelListener which implements wheel-driven scrolling
     * @see #installUI
     * @see MouseWheelHandler
     * @since 1.4
     */
    protected MouseWheelListener createMouseWheelListener() {
<span class="nc" id="L565">        return getHandler();</span>
    }

    protected void updateScrollBarDisplayPolicy(PropertyChangeEvent e) {
<span class="nc" id="L569">        scrollpane.revalidate();</span>
<span class="nc" id="L570">        scrollpane.repaint();</span>
<span class="nc" id="L571">    }</span>


    protected void updateViewport(PropertyChangeEvent e)
    {
<span class="nc" id="L576">        JViewport oldViewport = (JViewport)(e.getOldValue());</span>
<span class="nc" id="L577">        JViewport newViewport = (JViewport)(e.getNewValue());</span>

<span class="nc bnc" id="L579" title="All 2 branches missed.">        if (oldViewport != null) {</span>
<span class="nc" id="L580">            oldViewport.removeChangeListener(viewportChangeListener);</span>
        }

<span class="nc bnc" id="L583" title="All 2 branches missed.">        if (newViewport != null) {</span>
<span class="nc" id="L584">            Point p = newViewport.getViewPosition();</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">            if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L586">                p.x = Math.max(p.x, 0);</span>
            } else {
<span class="nc" id="L588">                int max = newViewport.getViewSize().width;</span>
<span class="nc" id="L589">                int extent = newViewport.getExtentSize().width;</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                if (extent &gt; max) {</span>
<span class="nc" id="L591">                    p.x = max - extent;</span>
                } else {
<span class="nc" id="L593">                    p.x = Math.max(0, Math.min(max - extent, p.x));</span>
                }
            }
<span class="nc" id="L596">            p.y = Math.max(p.y, 0);</span>
<span class="nc" id="L597">            newViewport.setViewPosition(p);</span>
<span class="nc" id="L598">            newViewport.addChangeListener(viewportChangeListener);</span>
        }
<span class="nc" id="L600">    }</span>


    protected void updateRowHeader(PropertyChangeEvent e)
    {
<span class="nc" id="L605">        JViewport newRowHead = (JViewport)(e.getNewValue());</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">        if (newRowHead != null) {</span>
<span class="nc" id="L607">            JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L608">            Point p = newRowHead.getViewPosition();</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">            p.y = (viewport != null) ? viewport.getViewPosition().y : 0;</span>
<span class="nc" id="L610">            newRowHead.setViewPosition(p);</span>
        }
<span class="nc" id="L612">    }</span>


    protected void updateColumnHeader(PropertyChangeEvent e)
    {
<span class="nc" id="L617">        JViewport newColHead = (JViewport)(e.getNewValue());</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">        if (newColHead != null) {</span>
<span class="nc" id="L619">            JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L620">            Point p = newColHead.getViewPosition();</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">            if (viewport == null) {</span>
<span class="nc" id="L622">                p.x = 0;</span>
            } else {
<span class="nc bnc" id="L624" title="All 2 branches missed.">                if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L625">                    p.x = viewport.getViewPosition().x;</span>
                } else {
<span class="nc" id="L627">                    p.x = Math.max(0, viewport.getViewPosition().x);</span>
                }
            }
<span class="nc" id="L630">            newColHead.setViewPosition(p);</span>
<span class="nc" id="L631">            scrollpane.add(newColHead, COLUMN_HEADER);</span>
        }
<span class="nc" id="L633">    }</span>

    private void updateHorizontalScrollBar(PropertyChangeEvent pce) {
<span class="nc" id="L636">        updateScrollBar(pce, hsbChangeListener, hsbPropertyChangeListener);</span>
<span class="nc" id="L637">    }</span>

    private void updateVerticalScrollBar(PropertyChangeEvent pce) {
<span class="nc" id="L640">        updateScrollBar(pce, vsbChangeListener, vsbPropertyChangeListener);</span>
<span class="nc" id="L641">    }</span>

    private void updateScrollBar(PropertyChangeEvent pce, ChangeListener cl,
                                 PropertyChangeListener pcl) {
<span class="nc" id="L645">        JScrollBar sb = (JScrollBar)pce.getOldValue();</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">        if (sb != null) {</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">            if (cl != null) {</span>
<span class="nc" id="L648">                sb.getModel().removeChangeListener(cl);</span>
            }
<span class="nc bnc" id="L650" title="All 2 branches missed.">            if (pcl != null) {</span>
<span class="nc" id="L651">                sb.removePropertyChangeListener(pcl);</span>
            }
        }
<span class="nc" id="L654">        sb = (JScrollBar)pce.getNewValue();</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        if (sb != null) {</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">            if (cl != null) {</span>
<span class="nc" id="L657">                sb.getModel().addChangeListener(cl);</span>
            }
<span class="nc bnc" id="L659" title="All 2 branches missed.">            if (pcl != null) {</span>
<span class="nc" id="L660">                sb.addPropertyChangeListener(pcl);</span>
            }
        }
<span class="nc" id="L663">    }</span>

<span class="nc" id="L665">    public class PropertyChangeHandler implements PropertyChangeListener</span>
    {

        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        public void propertyChange(PropertyChangeEvent e)
        {
<span class="nc" id="L675">            getHandler().propertyChange(e);</span>
<span class="nc" id="L676">        }</span>
    }



    /**
     * Creates an instance of PropertyChangeListener that's added to
     * the JScrollPane by installUI().  Subclasses can override this method
     * to return a custom PropertyChangeListener, e.g.
     * &lt;pre&gt;
     * class MyScrollPaneUI extends BasicScrollPaneUI {
     *    protected PropertyChangeListener &lt;b&gt;createPropertyChangeListener&lt;/b&gt;() {
     *        return new MyPropertyChangeListener();
     *    }
     *    public class MyPropertyChangeListener extends PropertyChangeListener {
     *        public void propertyChange(PropertyChangeEvent e) {
     *            if (e.getPropertyName().equals(&quot;viewport&quot;)) {
     *                // do some extra work when the viewport changes
     *            }
     *            super.propertyChange(e);
     *        }
     *    }
     * }
     * &lt;/pre&gt;
     *
     * @see java.beans.PropertyChangeListener
     * @see #installUI
     */
    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L705">        return getHandler();</span>
    }


    private static class Actions extends UIAction {
        private static final String SCROLL_UP = &quot;scrollUp&quot;;
        private static final String SCROLL_DOWN = &quot;scrollDown&quot;;
        private static final String SCROLL_HOME = &quot;scrollHome&quot;;
        private static final String SCROLL_END = &quot;scrollEnd&quot;;
        private static final String UNIT_SCROLL_UP = &quot;unitScrollUp&quot;;
        private static final String UNIT_SCROLL_DOWN = &quot;unitScrollDown&quot;;
        private static final String SCROLL_LEFT = &quot;scrollLeft&quot;;
        private static final String SCROLL_RIGHT = &quot;scrollRight&quot;;
        private static final String UNIT_SCROLL_LEFT = &quot;unitScrollLeft&quot;;
        private static final String UNIT_SCROLL_RIGHT = &quot;unitScrollRight&quot;;


        Actions(String key) {
<span class="nc" id="L723">            super(key);</span>
<span class="nc" id="L724">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L727">            JScrollPane scrollPane = (JScrollPane)e.getSource();</span>
<span class="nc" id="L728">            boolean ltr = scrollPane.getComponentOrientation().isLeftToRight();</span>
<span class="nc" id="L729">            String key = getName();</span>

<span class="nc bnc" id="L731" title="All 2 branches missed.">            if (key == SCROLL_UP) {</span>
<span class="nc" id="L732">                scroll(scrollPane, SwingConstants.VERTICAL, -1, true);</span>
            }
<span class="nc bnc" id="L734" title="All 2 branches missed.">            else if (key == SCROLL_DOWN) {</span>
<span class="nc" id="L735">                scroll(scrollPane, SwingConstants.VERTICAL, 1, true);</span>
            }
<span class="nc bnc" id="L737" title="All 2 branches missed.">            else if (key == SCROLL_HOME) {</span>
<span class="nc" id="L738">                scrollHome(scrollPane);</span>
            }
<span class="nc bnc" id="L740" title="All 2 branches missed.">            else if (key == SCROLL_END) {</span>
<span class="nc" id="L741">                scrollEnd(scrollPane);</span>
            }
<span class="nc bnc" id="L743" title="All 2 branches missed.">            else if (key == UNIT_SCROLL_UP) {</span>
<span class="nc" id="L744">                scroll(scrollPane, SwingConstants.VERTICAL, -1, false);</span>
            }
<span class="nc bnc" id="L746" title="All 2 branches missed.">            else if (key == UNIT_SCROLL_DOWN) {</span>
<span class="nc" id="L747">                scroll(scrollPane, SwingConstants.VERTICAL, 1, false);</span>
            }
<span class="nc bnc" id="L749" title="All 2 branches missed.">            else if (key == SCROLL_LEFT) {</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">                scroll(scrollPane, SwingConstants.HORIZONTAL, ltr ? -1 : 1,</span>
                       true);
            }
<span class="nc bnc" id="L753" title="All 2 branches missed.">            else if (key == SCROLL_RIGHT) {</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">                scroll(scrollPane, SwingConstants.HORIZONTAL, ltr ? 1 : -1,</span>
                       true);
            }
<span class="nc bnc" id="L757" title="All 2 branches missed.">            else if (key == UNIT_SCROLL_LEFT) {</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">                scroll(scrollPane, SwingConstants.HORIZONTAL, ltr ? -1 : 1,</span>
                       false);
            }
<span class="nc bnc" id="L761" title="All 2 branches missed.">            else if (key == UNIT_SCROLL_RIGHT) {</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">                scroll(scrollPane, SwingConstants.HORIZONTAL, ltr ? 1 : -1,</span>
                       false);
            }
<span class="nc" id="L765">        }</span>

        private void scrollEnd(JScrollPane scrollpane) {
<span class="nc" id="L768">            JViewport vp = scrollpane.getViewport();</span>
            Component view;
<span class="nc bnc" id="L770" title="All 4 branches missed.">            if (vp != null &amp;&amp; (view = vp.getView()) != null) {</span>
<span class="nc" id="L771">                Rectangle visRect = vp.getViewRect();</span>
<span class="nc" id="L772">                Rectangle bounds = view.getBounds();</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">                if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L774">                    vp.setViewPosition(new Point(bounds.width - visRect.width,</span>
                                             bounds.height - visRect.height));
                } else {
<span class="nc" id="L777">                    vp.setViewPosition(new Point(0,</span>
                                             bounds.height - visRect.height));
                }
            }
<span class="nc" id="L781">        }</span>

        private void scrollHome(JScrollPane scrollpane) {
<span class="nc" id="L784">            JViewport vp = scrollpane.getViewport();</span>
            Component view;
<span class="nc bnc" id="L786" title="All 4 branches missed.">            if (vp != null &amp;&amp; (view = vp.getView()) != null) {</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">                if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L788">                    vp.setViewPosition(new Point(0, 0));</span>
                } else {
<span class="nc" id="L790">                    Rectangle visRect = vp.getViewRect();</span>
<span class="nc" id="L791">                    Rectangle bounds = view.getBounds();</span>
<span class="nc" id="L792">                    vp.setViewPosition(new Point(bounds.width - visRect.width, 0));</span>
                }
            }
<span class="nc" id="L795">        }</span>

        private void scroll(JScrollPane scrollpane, int orientation,
                            int direction, boolean block) {
<span class="nc" id="L799">            JViewport vp = scrollpane.getViewport();</span>
            Component view;
<span class="nc bnc" id="L801" title="All 4 branches missed.">            if (vp != null &amp;&amp; (view = vp.getView()) != null) {</span>
<span class="nc" id="L802">                Rectangle visRect = vp.getViewRect();</span>
<span class="nc" id="L803">                Dimension vSize = view.getSize();</span>
                int amount;

<span class="nc bnc" id="L806" title="All 2 branches missed.">                if (view instanceof Scrollable) {</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">                    if (block) {</span>
<span class="nc" id="L808">                        amount = ((Scrollable)view).getScrollableBlockIncrement</span>
<span class="nc" id="L809">                                 (visRect, orientation, direction);</span>
                    }
                    else {
<span class="nc" id="L812">                        amount = ((Scrollable)view).getScrollableUnitIncrement</span>
<span class="nc" id="L813">                                 (visRect, orientation, direction);</span>
                    }
                }
                else {
<span class="nc bnc" id="L817" title="All 2 branches missed.">                    if (block) {</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">                        if (orientation == SwingConstants.VERTICAL) {</span>
<span class="nc" id="L819">                            amount = visRect.height;</span>
                        }
                        else {
<span class="nc" id="L822">                            amount = visRect.width;</span>
                        }
                    }
                    else {
<span class="nc" id="L826">                        amount = 10;</span>
                    }
                }
<span class="nc bnc" id="L829" title="All 2 branches missed.">                if (orientation == SwingConstants.VERTICAL) {</span>
<span class="nc" id="L830">                    visRect.y += (amount * direction);</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">                    if ((visRect.y + visRect.height) &gt; vSize.height) {</span>
<span class="nc" id="L832">                        visRect.y = Math.max(0, vSize.height - visRect.height);</span>
                    }
<span class="nc bnc" id="L834" title="All 2 branches missed.">                    else if (visRect.y &lt; 0) {</span>
<span class="nc" id="L835">                        visRect.y = 0;</span>
                    }
                }
                else {
<span class="nc bnc" id="L839" title="All 2 branches missed.">                    if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L840">                        visRect.x += (amount * direction);</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">                        if ((visRect.x + visRect.width) &gt; vSize.width) {</span>
<span class="nc" id="L842">                            visRect.x = Math.max(0, vSize.width - visRect.width);</span>
<span class="nc bnc" id="L843" title="All 2 branches missed.">                        } else if (visRect.x &lt; 0) {</span>
<span class="nc" id="L844">                            visRect.x = 0;</span>
                        }
                    } else {
<span class="nc" id="L847">                        visRect.x -= (amount * direction);</span>
<span class="nc bnc" id="L848" title="All 2 branches missed.">                        if (visRect.width &gt; vSize.width) {</span>
<span class="nc" id="L849">                            visRect.x = vSize.width - visRect.width;</span>
                        } else {
<span class="nc" id="L851">                            visRect.x = Math.max(0, Math.min(vSize.width - visRect.width, visRect.x));</span>
                        }
                    }
                }
<span class="nc" id="L855">                vp.setViewPosition(visRect.getLocation());</span>
            }
<span class="nc" id="L857">        }</span>
    }


<span class="nc bnc" id="L861" title="All 2 branches missed.">    class Handler implements ChangeListener, PropertyChangeListener, MouseWheelListener {</span>
        //
        // MouseWheelListener
        //
        public void mouseWheelMoved(MouseWheelEvent e) {
<span class="nc bnc" id="L866" title="All 2 branches missed.">            if (scrollpane.isWheelScrollingEnabled() &amp;&amp;</span>
<span class="nc bnc" id="L867" title="All 2 branches missed.">                e.getWheelRotation() != 0) {</span>
<span class="nc" id="L868">                JScrollBar toScroll = scrollpane.getVerticalScrollBar();</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">                int direction = e.getWheelRotation() &lt; 0 ? -1 : 1;</span>
<span class="nc" id="L870">                int orientation = SwingConstants.VERTICAL;</span>

                // find which scrollbar to scroll, or return if none
<span class="nc bnc" id="L873" title="All 4 branches missed.">                if (toScroll == null || !toScroll.isVisible()) {</span>
<span class="nc" id="L874">                    toScroll = scrollpane.getHorizontalScrollBar();</span>
<span class="nc bnc" id="L875" title="All 4 branches missed.">                    if (toScroll == null || !toScroll.isVisible()) {</span>
<span class="nc" id="L876">                        return;</span>
                    }
<span class="nc" id="L878">                    orientation = SwingConstants.HORIZONTAL;</span>
                }

<span class="nc" id="L881">                e.consume();</span>

<span class="nc bnc" id="L883" title="All 2 branches missed.">                if (e.getScrollType() == MouseWheelEvent.WHEEL_UNIT_SCROLL) {</span>
<span class="nc" id="L884">                    JViewport vp = scrollpane.getViewport();</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">                    if (vp == null) { return; }</span>
<span class="nc" id="L886">                    Component comp = vp.getView();</span>
<span class="nc" id="L887">                    int units = Math.abs(e.getUnitsToScroll());</span>

                    // When the scrolling speed is set to maximum, it's possible
                    // for a single wheel click to scroll by more units than
                    // will fit in the visible area.  This makes it
                    // hard/impossible to get to certain parts of the scrolling
                    // Component with the wheel.  To make for more accurate
                    // low-speed scrolling, we limit scrolling to the block
                    // increment if the wheel was only rotated one click.
<span class="nc bnc" id="L896" title="All 2 branches missed.">                    boolean limitScroll = Math.abs(e.getWheelRotation()) == 1;</span>

                    // Check if we should use the visibleRect trick
<span class="nc" id="L899">                    Object fastWheelScroll = toScroll.getClientProperty(</span>
                                               &quot;JScrollBar.fastWheelScrolling&quot;);
<span class="nc bnc" id="L901" title="All 4 branches missed.">                    if (Boolean.TRUE == fastWheelScroll &amp;&amp;</span>
                        comp instanceof Scrollable) {
                        // 5078454: Under maximum acceleration, we may scroll
                        // by many 100s of units in ~1 second.
                        //
                        // BasicScrollBarUI.scrollByUnits() can bog down the EDT
                        // with repaints in this situation.  However, the
                        // Scrollable interface allows us to pass in an
                        // arbitrary visibleRect.  This allows us to accurately
                        // calculate the total scroll amount, and then update
                        // the GUI once.  This technique provides much faster
                        // accelerated wheel scrolling.
<span class="nc" id="L913">                        Scrollable scrollComp = (Scrollable) comp;</span>
<span class="nc" id="L914">                        Rectangle viewRect = vp.getViewRect();</span>
<span class="nc" id="L915">                        int startingX = viewRect.x;</span>
<span class="nc" id="L916">                        boolean leftToRight =</span>
<span class="nc" id="L917">                                 comp.getComponentOrientation().isLeftToRight();</span>
<span class="nc" id="L918">                        int scrollMin = toScroll.getMinimum();</span>
<span class="nc" id="L919">                        int scrollMax = toScroll.getMaximum() -</span>
<span class="nc" id="L920">                                        toScroll.getModel().getExtent();</span>

<span class="nc bnc" id="L922" title="All 2 branches missed.">                        if (limitScroll) {</span>
<span class="nc" id="L923">                            int blockIncr =</span>
<span class="nc" id="L924">                                scrollComp.getScrollableBlockIncrement(viewRect,</span>
                                                                    orientation,
                                                                    direction);
<span class="nc bnc" id="L927" title="All 2 branches missed.">                            if (direction &lt; 0) {</span>
<span class="nc" id="L928">                                scrollMin = Math.max(scrollMin,</span>
<span class="nc" id="L929">                                               toScroll.getValue() - blockIncr);</span>
                            }
                            else {
<span class="nc" id="L932">                                scrollMax = Math.min(scrollMax,</span>
<span class="nc" id="L933">                                               toScroll.getValue() + blockIncr);</span>
                            }
                        }

<span class="nc bnc" id="L937" title="All 2 branches missed.">                        for (int i = 0; i &lt; units; i++) {</span>
<span class="nc" id="L938">                            int unitIncr =</span>
<span class="nc" id="L939">                                scrollComp.getScrollableUnitIncrement(viewRect,</span>
                                                        orientation, direction);
                            // Modify the visible rect for the next unit, and
                            // check to see if we're at the end already.
<span class="nc bnc" id="L943" title="All 2 branches missed.">                            if (orientation == SwingConstants.VERTICAL) {</span>
<span class="nc bnc" id="L944" title="All 2 branches missed.">                                if (direction &lt; 0) {</span>
<span class="nc" id="L945">                                    viewRect.y -= unitIncr;</span>
<span class="nc bnc" id="L946" title="All 2 branches missed.">                                    if (viewRect.y &lt;= scrollMin) {</span>
<span class="nc" id="L947">                                        viewRect.y = scrollMin;</span>
<span class="nc" id="L948">                                        break;</span>
                                    }
                                }
                                else { // (direction &gt; 0
<span class="nc" id="L952">                                    viewRect.y += unitIncr;</span>
<span class="nc bnc" id="L953" title="All 2 branches missed.">                                    if (viewRect.y &gt;= scrollMax) {</span>
<span class="nc" id="L954">                                        viewRect.y = scrollMax;</span>
<span class="nc" id="L955">                                        break;</span>
                                    }
                                }
                            }
                            else {
                                // Scroll left
<span class="nc bnc" id="L961" title="All 8 branches missed.">                                if ((leftToRight &amp;&amp; direction &lt; 0) ||</span>
                                    (!leftToRight &amp;&amp; direction &gt; 0)) {
<span class="nc" id="L963">                                    viewRect.x -= unitIncr;</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">                                    if (leftToRight) {</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">                                        if (viewRect.x &lt; scrollMin) {</span>
<span class="nc" id="L966">                                            viewRect.x = scrollMin;</span>
<span class="nc" id="L967">                                            break;</span>
                                        }
                                    }
                                }
                                // Scroll right
<span class="nc bnc" id="L972" title="All 8 branches missed.">                                else if ((leftToRight &amp;&amp; direction &gt; 0) ||</span>
                                    (!leftToRight &amp;&amp; direction &lt; 0)) {
<span class="nc" id="L974">                                    viewRect.x += unitIncr;</span>
<span class="nc bnc" id="L975" title="All 2 branches missed.">                                    if (leftToRight) {</span>
<span class="nc bnc" id="L976" title="All 2 branches missed.">                                        if (viewRect.x &gt; scrollMax) {</span>
<span class="nc" id="L977">                                            viewRect.x = scrollMax;</span>
<span class="nc" id="L978">                                            break;</span>
                                        }
                                    }
                                }
                                else {
<span class="nc bnc" id="L983" title="All 2 branches missed.">                                    assert false : &quot;Non-sensical ComponentOrientation / scroll direction&quot;;</span>
                                }
                            }
                        }
                        // Set the final view position on the ScrollBar
<span class="nc bnc" id="L988" title="All 2 branches missed.">                        if (orientation == SwingConstants.VERTICAL) {</span>
<span class="nc" id="L989">                            toScroll.setValue(viewRect.y);</span>
                        }
                        else {
<span class="nc bnc" id="L992" title="All 2 branches missed.">                            if (leftToRight) {</span>
<span class="nc" id="L993">                                toScroll.setValue(viewRect.x);</span>
                            }
                            else {
                                // rightToLeft scrollbars are oriented with
                                // minValue on the right and maxValue on the
                                // left.
<span class="nc" id="L999">                                int newPos = toScroll.getValue() -</span>
                                                       (viewRect.x - startingX);
<span class="nc bnc" id="L1001" title="All 2 branches missed.">                                if (newPos &lt; scrollMin) {</span>
<span class="nc" id="L1002">                                    newPos = scrollMin;</span>
                                }
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                                else if (newPos &gt; scrollMax) {</span>
<span class="nc" id="L1005">                                    newPos = scrollMax;</span>
                                }
<span class="nc" id="L1007">                                toScroll.setValue(newPos);</span>
                            }
                        }
<span class="nc" id="L1010">                    }</span>
                    else {
                        // Viewport's view is not a Scrollable, or fast wheel
                        // scrolling is not enabled.
<span class="nc" id="L1014">                        BasicScrollBarUI.scrollByUnits(toScroll, direction,</span>
                                                       units, limitScroll);
                    }
<span class="nc" id="L1017">                }</span>
<span class="nc bnc" id="L1018" title="All 2 branches missed.">                else if (e.getScrollType() ==</span>
                         MouseWheelEvent.WHEEL_BLOCK_SCROLL) {
<span class="nc" id="L1020">                    BasicScrollBarUI.scrollByBlock(toScroll, direction);</span>
                }
            }
<span class="nc" id="L1023">        }</span>

        //
        // ChangeListener: This is added to the vieport, and hsb/vsb models.
        //
        public void stateChanged(ChangeEvent e) {
<span class="nc" id="L1029">            JViewport viewport = scrollpane.getViewport();</span>

<span class="nc bnc" id="L1031" title="All 2 branches missed.">            if (viewport != null) {</span>
<span class="nc bnc" id="L1032" title="All 2 branches missed.">                if (e.getSource() == viewport) {</span>
<span class="nc" id="L1033">                    syncScrollPaneWithViewport();</span>
                }
                else {
<span class="nc" id="L1036">                    JScrollBar hsb = scrollpane.getHorizontalScrollBar();</span>
<span class="nc bnc" id="L1037" title="All 4 branches missed.">                    if (hsb != null &amp;&amp; e.getSource() == hsb.getModel()) {</span>
<span class="nc" id="L1038">                        hsbStateChanged(viewport, e);</span>
                    }
                    else {
<span class="nc" id="L1041">                        JScrollBar vsb = scrollpane.getVerticalScrollBar();</span>
<span class="nc bnc" id="L1042" title="All 4 branches missed.">                        if (vsb != null &amp;&amp; e.getSource() == vsb.getModel()) {</span>
<span class="nc" id="L1043">                            vsbStateChanged(viewport, e);</span>
                        }
                    }
                }
            }
<span class="nc" id="L1048">        }</span>

        private void vsbStateChanged(JViewport viewport, ChangeEvent e) {
<span class="nc" id="L1051">            BoundedRangeModel model = (BoundedRangeModel)(e.getSource());</span>
<span class="nc" id="L1052">            Point p = viewport.getViewPosition();</span>
<span class="nc" id="L1053">            p.y = model.getValue();</span>
<span class="nc" id="L1054">            viewport.setViewPosition(p);</span>
<span class="nc" id="L1055">        }</span>

        private void hsbStateChanged(JViewport viewport, ChangeEvent e) {
<span class="nc" id="L1058">            BoundedRangeModel model = (BoundedRangeModel)(e.getSource());</span>
<span class="nc" id="L1059">            Point p = viewport.getViewPosition();</span>
<span class="nc" id="L1060">            int value = model.getValue();</span>
<span class="nc bnc" id="L1061" title="All 2 branches missed.">            if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1062">                p.x = value;</span>
            } else {
<span class="nc" id="L1064">                int max = viewport.getViewSize().width;</span>
<span class="nc" id="L1065">                int extent = viewport.getExtentSize().width;</span>
<span class="nc" id="L1066">                int oldX = p.x;</span>

                /* Set new X coordinate based on &quot;value&quot;.
                 */
<span class="nc" id="L1070">                p.x = max - extent - value;</span>

                /* If setValue() was called before &quot;extent&quot; was fixed,
                 * turn setValueCalled flag on.
                 */
<span class="nc bnc" id="L1075" title="All 6 branches missed.">                if ((extent == 0) &amp;&amp; (value != 0) &amp;&amp; (oldX == max)) {</span>
<span class="nc" id="L1076">                    setValueCalled = true;</span>
                } else {
                    /* When a pane without a horizontal scroll bar was
                     * reduced and the bar appeared, the viewport should
                     * show the right side of the view.
                     */
<span class="nc bnc" id="L1082" title="All 6 branches missed.">                    if ((extent != 0) &amp;&amp; (oldX &lt; 0) &amp;&amp; (p.x == 0)) {</span>
<span class="nc" id="L1083">                        p.x += value;</span>
                    }
                }
            }
<span class="nc" id="L1087">            viewport.setViewPosition(p);</span>
<span class="nc" id="L1088">        }</span>

        //
        // PropertyChangeListener: This is installed on both the JScrollPane
        // and the horizontal/vertical scrollbars.
        //

        // Listens for changes in the model property and reinstalls the
        // horizontal/vertical PropertyChangeListeners.
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc bnc" id="L1098" title="All 2 branches missed.">            if (e.getSource() == scrollpane) {</span>
<span class="nc" id="L1099">                scrollPanePropertyChange(e);</span>
            }
            else {
<span class="nc" id="L1102">                sbPropertyChange(e);</span>
            }
<span class="nc" id="L1104">        }</span>

        private void scrollPanePropertyChange(PropertyChangeEvent e) {
<span class="nc" id="L1107">            String propertyName = e.getPropertyName();</span>

<span class="nc bnc" id="L1109" title="All 2 branches missed.">            if (propertyName == &quot;verticalScrollBarDisplayPolicy&quot;) {</span>
<span class="nc" id="L1110">                updateScrollBarDisplayPolicy(e);</span>
            }
<span class="nc bnc" id="L1112" title="All 2 branches missed.">            else if (propertyName == &quot;horizontalScrollBarDisplayPolicy&quot;) {</span>
<span class="nc" id="L1113">                updateScrollBarDisplayPolicy(e);</span>
            }
<span class="nc bnc" id="L1115" title="All 2 branches missed.">            else if (propertyName == &quot;viewport&quot;) {</span>
<span class="nc" id="L1116">                updateViewport(e);</span>
            }
<span class="nc bnc" id="L1118" title="All 2 branches missed.">            else if (propertyName == &quot;rowHeader&quot;) {</span>
<span class="nc" id="L1119">                updateRowHeader(e);</span>
            }
<span class="nc bnc" id="L1121" title="All 2 branches missed.">            else if (propertyName == &quot;columnHeader&quot;) {</span>
<span class="nc" id="L1122">                updateColumnHeader(e);</span>
            }
<span class="nc bnc" id="L1124" title="All 2 branches missed.">            else if (propertyName == &quot;verticalScrollBar&quot;) {</span>
<span class="nc" id="L1125">                updateVerticalScrollBar(e);</span>
            }
<span class="nc bnc" id="L1127" title="All 2 branches missed.">            else if (propertyName == &quot;horizontalScrollBar&quot;) {</span>
<span class="nc" id="L1128">                updateHorizontalScrollBar(e);</span>
            }
<span class="nc bnc" id="L1130" title="All 2 branches missed.">            else if (propertyName == &quot;componentOrientation&quot;) {</span>
<span class="nc" id="L1131">                scrollpane.revalidate();</span>
<span class="nc" id="L1132">                scrollpane.repaint();</span>
            }
<span class="nc" id="L1134">        }</span>

        // PropertyChangeListener for the horizontal and vertical scrollbars.
        private void sbPropertyChange(PropertyChangeEvent e) {
<span class="nc" id="L1138">            String propertyName = e.getPropertyName();</span>
<span class="nc" id="L1139">            Object source = e.getSource();</span>

<span class="nc bnc" id="L1141" title="All 2 branches missed.">            if (&quot;model&quot; == propertyName) {</span>
<span class="nc" id="L1142">                JScrollBar sb = scrollpane.getVerticalScrollBar();</span>
<span class="nc" id="L1143">                BoundedRangeModel oldModel = (BoundedRangeModel)e.</span>
<span class="nc" id="L1144">                                     getOldValue();</span>
<span class="nc" id="L1145">                ChangeListener cl = null;</span>

<span class="nc bnc" id="L1147" title="All 2 branches missed.">                if (source == sb) {</span>
<span class="nc" id="L1148">                    cl = vsbChangeListener;</span>
                }
<span class="nc bnc" id="L1150" title="All 2 branches missed.">                else if (source == scrollpane.getHorizontalScrollBar()) {</span>
<span class="nc" id="L1151">                    sb = scrollpane.getHorizontalScrollBar();</span>
<span class="nc" id="L1152">                    cl = hsbChangeListener;</span>
                }
<span class="nc bnc" id="L1154" title="All 2 branches missed.">                if (cl != null) {</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">                    if (oldModel != null) {</span>
<span class="nc" id="L1156">                        oldModel.removeChangeListener(cl);</span>
                    }
<span class="nc bnc" id="L1158" title="All 2 branches missed.">                    if (sb.getModel() != null) {</span>
<span class="nc" id="L1159">                        sb.getModel().addChangeListener(cl);</span>
                    }
                }
<span class="nc" id="L1162">            }</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">            else if (&quot;componentOrientation&quot; == propertyName) {</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">                if (source == scrollpane.getHorizontalScrollBar()) {</span>
<span class="nc" id="L1165">                    JScrollBar hsb = scrollpane.getHorizontalScrollBar();</span>
<span class="nc" id="L1166">                    JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L1167">                    Point p = viewport.getViewPosition();</span>
<span class="nc bnc" id="L1168" title="All 2 branches missed.">                    if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1169">                        p.x = hsb.getValue();</span>
                    } else {
<span class="nc" id="L1171">                        p.x = viewport.getViewSize().width - viewport.getExtentSize().width - hsb.getValue();</span>
                    }
<span class="nc" id="L1173">                    viewport.setViewPosition(p);</span>
                }
            }
<span class="nc" id="L1176">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>