<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BasicSpinnerUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicSpinnerUI.java</span></div><h1>BasicSpinnerUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import java.awt.*;
import java.awt.event.*;
import java.text.ParseException;

import javax.swing.*;
import javax.swing.border.*;
import javax.swing.event.*;
import javax.swing.plaf.*;
import javax.swing.text.*;

import java.beans.*;
import java.text.*;
import java.util.*;
import sun.swing.DefaultLookup;


/**
 * The default Spinner UI delegate.
 *
 * @author Hans Muller
 * @since 1.4
 */
<span class="nc" id="L50">public class BasicSpinnerUI extends SpinnerUI</span>
{
    /**
     * The spinner that we're a UI delegate for.  Initialized by
     * the &lt;code&gt;installUI&lt;/code&gt; method, and reset to null
     * by &lt;code&gt;uninstallUI&lt;/code&gt;.
     *
     * @see #installUI
     * @see #uninstallUI
     */
    protected JSpinner spinner;
    private Handler handler;


    /**
     * The mouse/action listeners that are added to the spinner's
     * arrow buttons.  These listeners are shared by all
     * spinner arrow buttons.
     *
     * @see #createNextButton
     * @see #createPreviousButton
     */
<span class="nc" id="L72">    private static final ArrowButtonHandler nextButtonHandler = new ArrowButtonHandler(&quot;increment&quot;, true);</span>
<span class="nc" id="L73">    private static final ArrowButtonHandler previousButtonHandler = new ArrowButtonHandler(&quot;decrement&quot;, false);</span>
    private PropertyChangeListener propertyChangeListener;


    /**
     * Used by the default LayoutManager class - SpinnerLayout for
     * missing (null) editor/nextButton/previousButton children.
     */
<span class="nc" id="L81">    private static final Dimension zeroSize = new Dimension(0, 0);</span>


    /**
     * Returns a new instance of BasicSpinnerUI.  SpinnerListUI
     * delegates are allocated one per JSpinner.
     *
     * @param c the JSpinner (not used)
     * @see ComponentUI#createUI
     * @return a new BasicSpinnerUI object
     */
    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L93">        return new BasicSpinnerUI();</span>
    }


    private void maybeAdd(Component c, String s) {
<span class="nc bnc" id="L98" title="All 2 branches missed.">        if (c != null) {</span>
<span class="nc" id="L99">            spinner.add(c, s);</span>
        }
<span class="nc" id="L101">    }</span>


    /**
     * Calls &lt;code&gt;installDefaults&lt;/code&gt;, &lt;code&gt;installListeners&lt;/code&gt;,
     * and then adds the components returned by &lt;code&gt;createNextButton&lt;/code&gt;,
     * &lt;code&gt;createPreviousButton&lt;/code&gt;, and &lt;code&gt;createEditor&lt;/code&gt;.
     *
     * @param c the JSpinner
     * @see #installDefaults
     * @see #installListeners
     * @see #createNextButton
     * @see #createPreviousButton
     * @see #createEditor
     */
    public void installUI(JComponent c) {
<span class="nc" id="L117">        this.spinner = (JSpinner)c;</span>
<span class="nc" id="L118">        installDefaults();</span>
<span class="nc" id="L119">        installListeners();</span>
<span class="nc" id="L120">        maybeAdd(createNextButton(), &quot;Next&quot;);</span>
<span class="nc" id="L121">        maybeAdd(createPreviousButton(), &quot;Previous&quot;);</span>
<span class="nc" id="L122">        maybeAdd(createEditor(), &quot;Editor&quot;);</span>
<span class="nc" id="L123">        updateEnabledState();</span>
<span class="nc" id="L124">        installKeyboardActions();</span>
<span class="nc" id="L125">    }</span>


    /**
     * Calls &lt;code&gt;uninstallDefaults&lt;/code&gt;, &lt;code&gt;uninstallListeners&lt;/code&gt;,
     * and then removes all of the spinners children.
     *
     * @param c the JSpinner (not used)
     */
    public void uninstallUI(JComponent c) {
<span class="nc" id="L135">        uninstallDefaults();</span>
<span class="nc" id="L136">        uninstallListeners();</span>
<span class="nc" id="L137">        this.spinner = null;</span>
<span class="nc" id="L138">        c.removeAll();</span>
<span class="nc" id="L139">    }</span>


    /**
     * Initializes &lt;code&gt;PropertyChangeListener&lt;/code&gt; with
     * a shared object that delegates interesting PropertyChangeEvents
     * to protected methods.
     * &lt;p&gt;
     * This method is called by &lt;code&gt;installUI&lt;/code&gt;.
     *
     * @see #replaceEditor
     * @see #uninstallListeners
     */
    protected void installListeners() {
<span class="nc" id="L153">        propertyChangeListener = createPropertyChangeListener();</span>
<span class="nc" id="L154">        spinner.addPropertyChangeListener(propertyChangeListener);</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (DefaultLookup.getBoolean(spinner, this,</span>
            &quot;Spinner.disableOnBoundaryValues&quot;, false)) {
<span class="nc" id="L157">            spinner.addChangeListener(getHandler());</span>
        }
<span class="nc" id="L159">        JComponent editor = spinner.getEditor();</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">        if (editor != null &amp;&amp; editor instanceof JSpinner.DefaultEditor) {</span>
<span class="nc" id="L161">            JTextField tf = ((JSpinner.DefaultEditor)editor).getTextField();</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">            if (tf != null) {</span>
<span class="nc" id="L163">                tf.addFocusListener(nextButtonHandler);</span>
<span class="nc" id="L164">                tf.addFocusListener(previousButtonHandler);</span>
            }
        }
<span class="nc" id="L167">    }</span>


    /**
     * Removes the &lt;code&gt;PropertyChangeListener&lt;/code&gt; added
     * by installListeners.
     * &lt;p&gt;
     * This method is called by &lt;code&gt;uninstallUI&lt;/code&gt;.
     *
     * @see #installListeners
     */
    protected void uninstallListeners() {
<span class="nc" id="L179">        spinner.removePropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L180">        spinner.removeChangeListener(handler);</span>
<span class="nc" id="L181">        JComponent editor = spinner.getEditor();</span>
<span class="nc" id="L182">        removeEditorBorderListener(editor);</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (editor instanceof JSpinner.DefaultEditor) {</span>
<span class="nc" id="L184">            JTextField tf = ((JSpinner.DefaultEditor)editor).getTextField();</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">            if (tf != null) {</span>
<span class="nc" id="L186">                tf.removeFocusListener(nextButtonHandler);</span>
<span class="nc" id="L187">                tf.removeFocusListener(previousButtonHandler);</span>
            }
        }
<span class="nc" id="L190">        propertyChangeListener = null;</span>
<span class="nc" id="L191">        handler = null;</span>
<span class="nc" id="L192">    }</span>


    /**
     * Initialize the &lt;code&gt;JSpinner&lt;/code&gt; &lt;code&gt;border&lt;/code&gt;,
     * &lt;code&gt;foreground&lt;/code&gt;, and &lt;code&gt;background&lt;/code&gt;, properties
     * based on the corresponding &quot;Spinner.*&quot; properties from defaults table.
     * The &lt;code&gt;JSpinners&lt;/code&gt; layout is set to the value returned by
     * &lt;code&gt;createLayout&lt;/code&gt;.  This method is called by &lt;code&gt;installUI&lt;/code&gt;.
     *
     * @see #uninstallDefaults
     * @see #installUI
     * @see #createLayout
     * @see LookAndFeel#installBorder
     * @see LookAndFeel#installColors
     */
    protected void installDefaults() {
<span class="nc" id="L209">        spinner.setLayout(createLayout());</span>
<span class="nc" id="L210">        LookAndFeel.installBorder(spinner, &quot;Spinner.border&quot;);</span>
<span class="nc" id="L211">        LookAndFeel.installColorsAndFont(spinner, &quot;Spinner.background&quot;, &quot;Spinner.foreground&quot;, &quot;Spinner.font&quot;);</span>
<span class="nc" id="L212">        LookAndFeel.installProperty(spinner, &quot;opaque&quot;, Boolean.TRUE);</span>
<span class="nc" id="L213">    }</span>


    /**
     * Sets the &lt;code&gt;JSpinner's&lt;/code&gt; layout manager to null.  This
     * method is called by &lt;code&gt;uninstallUI&lt;/code&gt;.
     *
     * @see #installDefaults
     * @see #uninstallUI
     */
    protected void uninstallDefaults() {
<span class="nc" id="L224">        spinner.setLayout(null);</span>
<span class="nc" id="L225">    }</span>


    private Handler getHandler() {
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L230">            handler = new Handler();</span>
        }
<span class="nc" id="L232">        return handler;</span>
    }


    /**
     * Installs the necessary listeners on the next button, &lt;code&gt;c&lt;/code&gt;,
     * to update the &lt;code&gt;JSpinner&lt;/code&gt; in response to a user gesture.
     *
     * @param c Component to install the listeners on
     * @throws NullPointerException if &lt;code&gt;c&lt;/code&gt; is null.
     * @see #createNextButton
     * @since 1.5
     */
    protected void installNextButtonListeners(Component c) {
<span class="nc" id="L246">        installButtonListeners(c, nextButtonHandler);</span>
<span class="nc" id="L247">    }</span>

    /**
     * Installs the necessary listeners on the previous button, &lt;code&gt;c&lt;/code&gt;,
     * to update the &lt;code&gt;JSpinner&lt;/code&gt; in response to a user gesture.
     *
     * @param c Component to install the listeners on.
     * @throws NullPointerException if &lt;code&gt;c&lt;/code&gt; is null.
     * @see #createPreviousButton
     * @since 1.5
     */
    protected void installPreviousButtonListeners(Component c) {
<span class="nc" id="L259">        installButtonListeners(c, previousButtonHandler);</span>
<span class="nc" id="L260">    }</span>

    private void installButtonListeners(Component c,
                                        ArrowButtonHandler handler) {
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (c instanceof JButton) {</span>
<span class="nc" id="L265">            ((JButton)c).addActionListener(handler);</span>
        }
<span class="nc" id="L267">        c.addMouseListener(handler);</span>
<span class="nc" id="L268">    }</span>

    /**
     * Creates a &lt;code&gt;LayoutManager&lt;/code&gt; that manages the &lt;code&gt;editor&lt;/code&gt;,
     * &lt;code&gt;nextButton&lt;/code&gt;, and &lt;code&gt;previousButton&lt;/code&gt;
     * children of the JSpinner.  These three children must be
     * added with a constraint that identifies their role:
     * &quot;Editor&quot;, &quot;Next&quot;, and &quot;Previous&quot;. The default layout manager
     * can handle the absence of any of these children.
     *
     * @return a LayoutManager for the editor, next button, and previous button.
     * @see #createNextButton
     * @see #createPreviousButton
     * @see #createEditor
     */
    protected LayoutManager createLayout() {
<span class="nc" id="L284">        return getHandler();</span>
    }


    /**
     * Creates a &lt;code&gt;PropertyChangeListener&lt;/code&gt; that can be
     * added to the JSpinner itself.  Typically, this listener
     * will call replaceEditor when the &quot;editor&quot; property changes,
     * since it's the &lt;code&gt;SpinnerUI's&lt;/code&gt; responsibility to
     * add the editor to the JSpinner (and remove the old one).
     * This method is called by &lt;code&gt;installListeners&lt;/code&gt;.
     *
     * @return A PropertyChangeListener for the JSpinner itself
     * @see #installListeners
     */
    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L300">        return getHandler();</span>
    }


    /**
     * Creates a decrement button, i.e. component that replaces the spinner
     * value with the object returned by &lt;code&gt;spinner.getPreviousValue&lt;/code&gt;.
     * By default the &lt;code&gt;previousButton&lt;/code&gt; is a {@code JButton}. If the
     * decrement button is not needed this method should return {@code null}.
     *
     * @return a component that will replace the spinner's value with the
     *     previous value in the sequence, or {@code null}
     * @see #installUI
     * @see #createNextButton
     * @see #installPreviousButtonListeners
     */
    protected Component createPreviousButton() {
<span class="nc" id="L317">        Component c = createArrowButton(SwingConstants.SOUTH);</span>
<span class="nc" id="L318">        c.setName(&quot;Spinner.previousButton&quot;);</span>
<span class="nc" id="L319">        installPreviousButtonListeners(c);</span>
<span class="nc" id="L320">        return c;</span>
    }


    /**
     * Creates an increment button, i.e. component that replaces the spinner
     * value with the object returned by &lt;code&gt;spinner.getNextValue&lt;/code&gt;.
     * By default the &lt;code&gt;nextButton&lt;/code&gt; is a {@code JButton}. If the
     * increment button is not needed this method should return {@code null}.
     *
     * @return a component that will replace the spinner's value with the
     *     next value in the sequence, or {@code null}
     * @see #installUI
     * @see #createPreviousButton
     * @see #installNextButtonListeners
     */
    protected Component createNextButton() {
<span class="nc" id="L337">        Component c = createArrowButton(SwingConstants.NORTH);</span>
<span class="nc" id="L338">        c.setName(&quot;Spinner.nextButton&quot;);</span>
<span class="nc" id="L339">        installNextButtonListeners(c);</span>
<span class="nc" id="L340">        return c;</span>
    }

    private Component createArrowButton(int direction) {
<span class="nc" id="L344">        JButton b = new BasicArrowButton(direction);</span>
<span class="nc" id="L345">        Border buttonBorder = UIManager.getBorder(&quot;Spinner.arrowButtonBorder&quot;);</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (buttonBorder instanceof UIResource) {</span>
            // Wrap the border to avoid having the UIResource be replaced by
            // the ButtonUI. This is the opposite of using BorderUIResource.
<span class="nc" id="L349">            b.setBorder(new CompoundBorder(buttonBorder, null));</span>
        } else {
<span class="nc" id="L351">            b.setBorder(buttonBorder);</span>
        }
<span class="nc" id="L353">        b.setInheritsPopupMenu(true);</span>
<span class="nc" id="L354">        return b;</span>
    }


    /**
     * This method is called by installUI to get the editor component
     * of the &lt;code&gt;JSpinner&lt;/code&gt;.  By default it just returns
     * &lt;code&gt;JSpinner.getEditor()&lt;/code&gt;.  Subclasses can override
     * &lt;code&gt;createEditor&lt;/code&gt; to return a component that contains
     * the spinner's editor or null, if they're going to handle adding
     * the editor to the &lt;code&gt;JSpinner&lt;/code&gt; in an
     * &lt;code&gt;installUI&lt;/code&gt; override.
     * &lt;p&gt;
     * Typically this method would be overridden to wrap the editor
     * with a container with a custom border, since one can't assume
     * that the editors border can be set directly.
     * &lt;p&gt;
     * The &lt;code&gt;replaceEditor&lt;/code&gt; method is called when the spinners
     * editor is changed with &lt;code&gt;JSpinner.setEditor&lt;/code&gt;.  If you've
     * overriden this method, then you'll probably want to override
     * &lt;code&gt;replaceEditor&lt;/code&gt; as well.
     *
     * @return the JSpinners editor JComponent, spinner.getEditor() by default
     * @see #installUI
     * @see #replaceEditor
     * @see JSpinner#getEditor
     */
    protected JComponent createEditor() {
<span class="nc" id="L382">        JComponent editor = spinner.getEditor();</span>
<span class="nc" id="L383">        maybeRemoveEditorBorder(editor);</span>
<span class="nc" id="L384">        installEditorBorderListener(editor);</span>
<span class="nc" id="L385">        editor.setInheritsPopupMenu(true);</span>
<span class="nc" id="L386">        updateEditorAlignment(editor);</span>
<span class="nc" id="L387">        return editor;</span>
    }


    /**
     * Called by the &lt;code&gt;PropertyChangeListener&lt;/code&gt; when the
     * &lt;code&gt;JSpinner&lt;/code&gt; editor property changes.  It's the responsibility
     * of this method to remove the old editor and add the new one.  By
     * default this operation is just:
     * &lt;pre&gt;
     * spinner.remove(oldEditor);
     * spinner.add(newEditor, &quot;Editor&quot;);
     * &lt;/pre&gt;
     * The implementation of &lt;code&gt;replaceEditor&lt;/code&gt; should be coordinated
     * with the &lt;code&gt;createEditor&lt;/code&gt; method.
     *
     * @see #createEditor
     * @see #createPropertyChangeListener
     */
    protected void replaceEditor(JComponent oldEditor, JComponent newEditor) {
<span class="nc" id="L407">        spinner.remove(oldEditor);</span>
<span class="nc" id="L408">        maybeRemoveEditorBorder(newEditor);</span>
<span class="nc" id="L409">        installEditorBorderListener(newEditor);</span>
<span class="nc" id="L410">        newEditor.setInheritsPopupMenu(true);</span>
<span class="nc" id="L411">        spinner.add(newEditor, &quot;Editor&quot;);</span>
<span class="nc" id="L412">    }</span>

    private void updateEditorAlignment(JComponent editor) {
<span class="nc bnc" id="L415" title="All 2 branches missed.">        if (editor instanceof JSpinner.DefaultEditor) {</span>
            // if editor alignment isn't set in LAF, we get 0 (CENTER) here
<span class="nc" id="L417">            int alignment = UIManager.getInt(&quot;Spinner.editorAlignment&quot;);</span>
<span class="nc" id="L418">            JTextField text = ((JSpinner.DefaultEditor)editor).getTextField();</span>
<span class="nc" id="L419">            text.setHorizontalAlignment(alignment);</span>
        }
<span class="nc" id="L421">    }</span>

    /**
     * Remove the border around the inner editor component for LaFs
     * that install an outside border around the spinner,
     */
    private void maybeRemoveEditorBorder(JComponent editor) {
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (!UIManager.getBoolean(&quot;Spinner.editorBorderPainted&quot;)) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (editor instanceof JPanel &amp;&amp;</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">                editor.getBorder() == null &amp;&amp;</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">                editor.getComponentCount() &gt; 0) {</span>

<span class="nc" id="L433">                editor = (JComponent)editor.getComponent(0);</span>
            }

<span class="nc bnc" id="L436" title="All 4 branches missed.">            if (editor != null &amp;&amp; editor.getBorder() instanceof UIResource) {</span>
<span class="nc" id="L437">                editor.setBorder(null);</span>
            }
        }
<span class="nc" id="L440">    }</span>

    /**
     * Remove the border around the inner editor component for LaFs
     * that install an outside border around the spinner,
     */
    private void installEditorBorderListener(JComponent editor) {
<span class="nc bnc" id="L447" title="All 2 branches missed.">        if (!UIManager.getBoolean(&quot;Spinner.editorBorderPainted&quot;)) {</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">            if (editor instanceof JPanel &amp;&amp;</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">                editor.getBorder() == null &amp;&amp;</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">                editor.getComponentCount() &gt; 0) {</span>

<span class="nc" id="L452">                editor = (JComponent)editor.getComponent(0);</span>
            }
<span class="nc bnc" id="L454" title="All 2 branches missed.">            if (editor != null &amp;&amp;</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">                (editor.getBorder() == null ||</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">                 editor.getBorder() instanceof UIResource)) {</span>
<span class="nc" id="L457">                editor.addPropertyChangeListener(getHandler());</span>
            }
        }
<span class="nc" id="L460">    }</span>

    private void removeEditorBorderListener(JComponent editor) {
<span class="nc bnc" id="L463" title="All 2 branches missed.">        if (!UIManager.getBoolean(&quot;Spinner.editorBorderPainted&quot;)) {</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">            if (editor instanceof JPanel &amp;&amp;</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">                editor.getComponentCount() &gt; 0) {</span>

<span class="nc" id="L467">                editor = (JComponent)editor.getComponent(0);</span>
            }
<span class="nc bnc" id="L469" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L470">                editor.removePropertyChangeListener(getHandler());</span>
            }
        }
<span class="nc" id="L473">    }</span>


    /**
     * Updates the enabled state of the children Components based on the
     * enabled state of the &lt;code&gt;JSpinner&lt;/code&gt;.
     */
    private void updateEnabledState() {
<span class="nc" id="L481">        updateEnabledState(spinner, spinner.isEnabled());</span>
<span class="nc" id="L482">    }</span>


    /**
     * Recursively updates the enabled state of the child
     * &lt;code&gt;Component&lt;/code&gt;s of &lt;code&gt;c&lt;/code&gt;.
     */
    private void updateEnabledState(Container c, boolean enabled) {
<span class="nc bnc" id="L490" title="All 2 branches missed.">        for (int counter = c.getComponentCount() - 1; counter &gt;= 0;counter--) {</span>
<span class="nc" id="L491">            Component child = c.getComponent(counter);</span>

<span class="nc bnc" id="L493" title="All 2 branches missed.">            if (DefaultLookup.getBoolean(spinner, this,</span>
                &quot;Spinner.disableOnBoundaryValues&quot;, false)) {
<span class="nc" id="L495">                SpinnerModel model = spinner.getModel();</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">                if (child.getName() == &quot;Spinner.nextButton&quot; &amp;&amp;</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">                    model.getNextValue() == null) {</span>
<span class="nc" id="L498">                    child.setEnabled(false);</span>
                }
<span class="nc bnc" id="L500" title="All 2 branches missed.">                else if (child.getName() == &quot;Spinner.previousButton&quot; &amp;&amp;</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">                         model.getPreviousValue() == null) {</span>
<span class="nc" id="L502">                    child.setEnabled(false);</span>
                }
                else {
<span class="nc" id="L505">                    child.setEnabled(enabled);</span>
                }
<span class="nc" id="L507">            }</span>
            else {
<span class="nc" id="L509">                child.setEnabled(enabled);</span>
            }
<span class="nc bnc" id="L511" title="All 2 branches missed.">            if (child instanceof Container) {</span>
<span class="nc" id="L512">                updateEnabledState((Container)child, enabled);</span>
            }
        }
<span class="nc" id="L515">    }</span>


    /**
     * Installs the keyboard Actions onto the JSpinner.
     *
     * @since 1.5
     */
    protected void installKeyboardActions() {
<span class="nc" id="L524">        InputMap iMap = getInputMap(JComponent.</span>
                                   WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);

<span class="nc" id="L527">        SwingUtilities.replaceUIInputMap(spinner, JComponent.</span>
                                         WHEN_ANCESTOR_OF_FOCUSED_COMPONENT,
                                         iMap);

<span class="nc" id="L531">        LazyActionMap.installLazyActionMap(spinner, BasicSpinnerUI.class,</span>
                &quot;Spinner.actionMap&quot;);
<span class="nc" id="L533">    }</span>

    /**
     * Returns the InputMap to install for &lt;code&gt;condition&lt;/code&gt;.
     */
    private InputMap getInputMap(int condition) {
<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (condition == JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT) {</span>
<span class="nc" id="L540">            return (InputMap)DefaultLookup.get(spinner, this,</span>
                    &quot;Spinner.ancestorInputMap&quot;);
        }
<span class="nc" id="L543">        return null;</span>
    }

    static void loadActionMap(LazyActionMap map) {
<span class="nc" id="L547">        map.put(&quot;increment&quot;, nextButtonHandler);</span>
<span class="nc" id="L548">        map.put(&quot;decrement&quot;, previousButtonHandler);</span>
<span class="nc" id="L549">    }</span>

    /**
     * Returns the baseline.
     *
     * @throws NullPointerException {@inheritDoc}
     * @throws IllegalArgumentException {@inheritDoc}
     * @see javax.swing.JComponent#getBaseline(int, int)
     * @since 1.6
     */
    public int getBaseline(JComponent c, int width, int height) {
<span class="nc" id="L560">        super.getBaseline(c, width, height);</span>
<span class="nc" id="L561">        JComponent editor = spinner.getEditor();</span>
<span class="nc" id="L562">        Insets insets = spinner.getInsets();</span>
<span class="nc" id="L563">        width = width - insets.left - insets.right;</span>
<span class="nc" id="L564">        height = height - insets.top - insets.bottom;</span>
<span class="nc bnc" id="L565" title="All 4 branches missed.">        if (width &gt;= 0 &amp;&amp; height &gt;= 0) {</span>
<span class="nc" id="L566">            int baseline = editor.getBaseline(width, height);</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">            if (baseline &gt;= 0) {</span>
<span class="nc" id="L568">                return insets.top + baseline;</span>
            }
        }
<span class="nc" id="L571">        return -1;</span>
    }

    /**
     * Returns an enum indicating how the baseline of the component
     * changes as the size changes.
     *
     * @throws NullPointerException {@inheritDoc}
     * @see javax.swing.JComponent#getBaseline(int, int)
     * @since 1.6
     */
    public Component.BaselineResizeBehavior getBaselineResizeBehavior(
            JComponent c) {
<span class="nc" id="L584">        super.getBaselineResizeBehavior(c);</span>
<span class="nc" id="L585">        return spinner.getEditor().getBaselineResizeBehavior();</span>
    }

    /**
     * A handler for spinner arrow button mouse and action events.  When
     * a left mouse pressed event occurs we look up the (enabled) spinner
     * that's the source of the event and start the autorepeat timer.  The
     * timer fires action events until any button is released at which
     * point the timer is stopped and the reference to the spinner cleared.
     * The timer doesn't start until after a 300ms delay, so often the
     * source of the initial (and final) action event is just the button
     * logic for mouse released - which means that we're relying on the fact
     * that our mouse listener runs after the buttons mouse listener.
     * &lt;p&gt;
     * Note that one instance of this handler is shared by all slider previous
     * arrow buttons and likewise for all of the next buttons,
     * so it doesn't have any state that persists beyond the limits
     * of a single button pressed/released gesture.
     */
    private static class ArrowButtonHandler extends AbstractAction
                                            implements FocusListener, MouseListener, UIResource {
        final javax.swing.Timer autoRepeatTimer;
        final boolean isNext;
<span class="nc" id="L608">        JSpinner spinner = null;</span>
<span class="nc" id="L609">        JButton arrowButton = null;</span>

        ArrowButtonHandler(String name, boolean isNext) {
<span class="nc" id="L612">            super(name);</span>
<span class="nc" id="L613">            this.isNext = isNext;</span>
<span class="nc" id="L614">            autoRepeatTimer = new javax.swing.Timer(60, this);</span>
<span class="nc" id="L615">            autoRepeatTimer.setInitialDelay(300);</span>
<span class="nc" id="L616">        }</span>

        private JSpinner eventToSpinner(AWTEvent e) {
<span class="nc" id="L619">            Object src = e.getSource();</span>
<span class="nc bnc" id="L620" title="All 4 branches missed.">            while ((src instanceof Component) &amp;&amp; !(src instanceof JSpinner)) {</span>
<span class="nc" id="L621">                src = ((Component)src).getParent();</span>
            }
<span class="nc bnc" id="L623" title="All 2 branches missed.">            return (src instanceof JSpinner) ? (JSpinner)src : null;</span>
        }

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L627">            JSpinner spinner = this.spinner;</span>

<span class="nc bnc" id="L629" title="All 2 branches missed.">            if (!(e.getSource() instanceof javax.swing.Timer)) {</span>
                // Most likely resulting from being in ActionMap.
<span class="nc" id="L631">                spinner = eventToSpinner(e);</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">                if (e.getSource() instanceof JButton) {</span>
<span class="nc" id="L633">                    arrowButton = (JButton)e.getSource();</span>
                }
            } else {
<span class="nc bnc" id="L636" title="All 4 branches missed.">                if (arrowButton!=null &amp;&amp; !arrowButton.getModel().isPressed()</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">                    &amp;&amp; autoRepeatTimer.isRunning()) {</span>
<span class="nc" id="L638">                    autoRepeatTimer.stop();</span>
<span class="nc" id="L639">                    spinner = null;</span>
<span class="nc" id="L640">                    arrowButton = null;</span>
                }
            }
<span class="nc bnc" id="L643" title="All 2 branches missed.">            if (spinner != null) {</span>
                try {
<span class="nc" id="L645">                    int calendarField = getCalendarField(spinner);</span>
<span class="nc" id="L646">                    spinner.commitEdit();</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">                    if (calendarField != -1) {</span>
<span class="nc" id="L648">                        ((SpinnerDateModel)spinner.getModel()).</span>
<span class="nc" id="L649">                                 setCalendarField(calendarField);</span>
                    }
<span class="nc bnc" id="L651" title="All 2 branches missed.">                    Object value = (isNext) ? spinner.getNextValue() :</span>
<span class="nc" id="L652">                               spinner.getPreviousValue();</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">                    if (value != null) {</span>
<span class="nc" id="L654">                        spinner.setValue(value);</span>
<span class="nc" id="L655">                        select(spinner);</span>
                    }
<span class="nc" id="L657">                } catch (IllegalArgumentException iae) {</span>
<span class="nc" id="L658">                    UIManager.getLookAndFeel().provideErrorFeedback(spinner);</span>
<span class="nc" id="L659">                } catch (ParseException pe) {</span>
<span class="nc" id="L660">                    UIManager.getLookAndFeel().provideErrorFeedback(spinner);</span>
<span class="nc" id="L661">                }</span>
            }
<span class="nc" id="L663">        }</span>

        /**
         * If the spinner's editor is a DateEditor, this selects the field
         * associated with the value that is being incremented.
         */
        private void select(JSpinner spinner) {
<span class="nc" id="L670">            JComponent editor = spinner.getEditor();</span>

<span class="nc bnc" id="L672" title="All 2 branches missed.">            if (editor instanceof JSpinner.DateEditor) {</span>
<span class="nc" id="L673">                JSpinner.DateEditor dateEditor = (JSpinner.DateEditor)editor;</span>
<span class="nc" id="L674">                JFormattedTextField ftf = dateEditor.getTextField();</span>
<span class="nc" id="L675">                Format format = dateEditor.getFormat();</span>
                Object value;

<span class="nc bnc" id="L678" title="All 4 branches missed.">                if (format != null &amp;&amp; (value = spinner.getValue()) != null) {</span>
<span class="nc" id="L679">                    SpinnerDateModel model = dateEditor.getModel();</span>
<span class="nc" id="L680">                    DateFormat.Field field = DateFormat.Field.ofCalendarField(</span>
<span class="nc" id="L681">                        model.getCalendarField());</span>

<span class="nc bnc" id="L683" title="All 2 branches missed.">                    if (field != null) {</span>
                        try {
<span class="nc" id="L685">                            AttributedCharacterIterator iterator = format.</span>
<span class="nc" id="L686">                                formatToCharacterIterator(value);</span>
<span class="nc bnc" id="L687" title="All 4 branches missed.">                            if (!select(ftf, iterator, field) &amp;&amp;</span>
                                       field == DateFormat.Field.HOUR0) {
<span class="nc" id="L689">                                select(ftf, iterator, DateFormat.Field.HOUR1);</span>
                            }
                        }
<span class="nc" id="L692">                        catch (IllegalArgumentException iae) {}</span>
                    }
                }
            }
<span class="nc" id="L696">        }</span>

        /**
         * Selects the passed in field, returning true if it is found,
         * false otherwise.
         */
        private boolean select(JFormattedTextField ftf,
                               AttributedCharacterIterator iterator,
                               DateFormat.Field field) {
<span class="nc" id="L705">            int max = ftf.getDocument().getLength();</span>

<span class="nc" id="L707">            iterator.first();</span>
            do {
<span class="nc" id="L709">                Map attrs = iterator.getAttributes();</span>

<span class="nc bnc" id="L711" title="All 4 branches missed.">                if (attrs != null &amp;&amp; attrs.containsKey(field)){</span>
<span class="nc" id="L712">                    int start = iterator.getRunStart(field);</span>
<span class="nc" id="L713">                    int end = iterator.getRunLimit(field);</span>

<span class="nc bnc" id="L715" title="All 8 branches missed.">                    if (start != -1 &amp;&amp; end != -1 &amp;&amp; start &lt;= max &amp;&amp;</span>
                                       end &lt;= max) {
<span class="nc" id="L717">                        ftf.select(start, end);</span>
                    }
<span class="nc" id="L719">                    return true;</span>
                }
<span class="nc bnc" id="L721" title="All 2 branches missed.">            } while (iterator.next() != CharacterIterator.DONE);</span>
<span class="nc" id="L722">            return false;</span>
        }

        /**
         * Returns the calendarField under the start of the selection, or
         * -1 if there is no valid calendar field under the selection (or
         * the spinner isn't editing dates.
         */
        private int getCalendarField(JSpinner spinner) {
<span class="nc" id="L731">            JComponent editor = spinner.getEditor();</span>

<span class="nc bnc" id="L733" title="All 2 branches missed.">            if (editor instanceof JSpinner.DateEditor) {</span>
<span class="nc" id="L734">                JSpinner.DateEditor dateEditor = (JSpinner.DateEditor)editor;</span>
<span class="nc" id="L735">                JFormattedTextField ftf = dateEditor.getTextField();</span>
<span class="nc" id="L736">                int start = ftf.getSelectionStart();</span>
<span class="nc" id="L737">                JFormattedTextField.AbstractFormatter formatter =</span>
<span class="nc" id="L738">                                    ftf.getFormatter();</span>

<span class="nc bnc" id="L740" title="All 2 branches missed.">                if (formatter instanceof InternationalFormatter) {</span>
<span class="nc" id="L741">                    Format.Field[] fields = ((InternationalFormatter)</span>
<span class="nc" id="L742">                                             formatter).getFields(start);</span>

<span class="nc bnc" id="L744" title="All 2 branches missed.">                    for (int counter = 0; counter &lt; fields.length; counter++) {</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">                        if (fields[counter] instanceof DateFormat.Field) {</span>
                            int calendarField;

<span class="nc bnc" id="L748" title="All 2 branches missed.">                            if (fields[counter] == DateFormat.Field.HOUR1) {</span>
<span class="nc" id="L749">                                calendarField = Calendar.HOUR;</span>
                            }
                            else {
<span class="nc" id="L752">                                calendarField = ((DateFormat.Field)</span>
<span class="nc" id="L753">                                        fields[counter]).getCalendarField();</span>
                            }
<span class="nc bnc" id="L755" title="All 2 branches missed.">                            if (calendarField != -1) {</span>
<span class="nc" id="L756">                                return calendarField;</span>
                            }
                        }
                    }
                }
            }
<span class="nc" id="L762">            return -1;</span>
        }

        public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L766" title="All 4 branches missed.">            if (SwingUtilities.isLeftMouseButton(e) &amp;&amp; e.getComponent().isEnabled()) {</span>
<span class="nc" id="L767">                spinner = eventToSpinner(e);</span>
<span class="nc" id="L768">                autoRepeatTimer.start();</span>

<span class="nc" id="L770">                focusSpinnerIfNecessary();</span>
            }
<span class="nc" id="L772">        }</span>

        public void mouseReleased(MouseEvent e) {
<span class="nc" id="L775">            autoRepeatTimer.stop();</span>
<span class="nc" id="L776">            arrowButton = null;</span>
<span class="nc" id="L777">            spinner = null;</span>
<span class="nc" id="L778">        }</span>

        public void mouseClicked(MouseEvent e) {
<span class="nc" id="L781">        }</span>

        public void mouseEntered(MouseEvent e) {
<span class="nc bnc" id="L784" title="All 6 branches missed.">            if (spinner != null &amp;&amp; !autoRepeatTimer.isRunning() &amp;&amp; spinner == eventToSpinner(e)) {</span>
<span class="nc" id="L785">                autoRepeatTimer.start();</span>
            }
<span class="nc" id="L787">        }</span>

        public void mouseExited(MouseEvent e) {
<span class="nc bnc" id="L790" title="All 2 branches missed.">            if (autoRepeatTimer.isRunning()) {</span>
<span class="nc" id="L791">                autoRepeatTimer.stop();</span>
            }
<span class="nc" id="L793">        }</span>

        /**
         * Requests focus on a child of the spinner if the spinner doesn't
         * have focus.
         */
        private void focusSpinnerIfNecessary() {
            Component fo = KeyboardFocusManager.
<span class="nc" id="L801">                              getCurrentKeyboardFocusManager().getFocusOwner();</span>
<span class="nc bnc" id="L802" title="All 4 branches missed.">            if (spinner.isRequestFocusEnabled() &amp;&amp; (</span>
                        fo == null ||
<span class="nc bnc" id="L804" title="All 2 branches missed.">                        !SwingUtilities.isDescendingFrom(fo, spinner))) {</span>
<span class="nc" id="L805">                Container root = spinner;</span>

<span class="nc bnc" id="L807" title="All 2 branches missed.">                if (!root.isFocusCycleRoot()) {</span>
<span class="nc" id="L808">                    root = root.getFocusCycleRootAncestor();</span>
                }
<span class="nc bnc" id="L810" title="All 2 branches missed.">                if (root != null) {</span>
<span class="nc" id="L811">                    FocusTraversalPolicy ftp = root.getFocusTraversalPolicy();</span>
<span class="nc" id="L812">                    Component child = ftp.getComponentAfter(root, spinner);</span>

<span class="nc bnc" id="L814" title="All 4 branches missed.">                    if (child != null &amp;&amp; SwingUtilities.isDescendingFrom(</span>
                                                        child, spinner)) {
<span class="nc" id="L816">                        child.requestFocus();</span>
                    }
                }
            }
<span class="nc" id="L820">        }</span>

        public void focusGained(FocusEvent e) {
<span class="nc" id="L823">        }</span>

        public void focusLost(FocusEvent e) {
<span class="nc bnc" id="L826" title="All 2 branches missed.">            if (spinner == eventToSpinner(e)) {</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">                if (autoRepeatTimer.isRunning()) {</span>
<span class="nc" id="L828">                    autoRepeatTimer.stop();</span>
                }
<span class="nc" id="L830">                spinner = null;</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">                if (arrowButton != null) {</span>
<span class="nc" id="L832">                    ButtonModel model = arrowButton.getModel();</span>
<span class="nc" id="L833">                    model.setPressed(false);</span>
<span class="nc" id="L834">                    model.setArmed(false);</span>
<span class="nc" id="L835">                    arrowButton = null;</span>
                }
            }
<span class="nc" id="L838">        }</span>
    }


<span class="nc" id="L842">    private static class Handler implements LayoutManager,</span>
            PropertyChangeListener, ChangeListener {
        //
        // LayoutManager
        //
<span class="nc" id="L847">        private Component nextButton = null;</span>
<span class="nc" id="L848">        private Component previousButton = null;</span>
<span class="nc" id="L849">        private Component editor = null;</span>

        public void addLayoutComponent(String name, Component c) {
<span class="nc bnc" id="L852" title="All 2 branches missed.">            if (&quot;Next&quot;.equals(name)) {</span>
<span class="nc" id="L853">                nextButton = c;</span>
            }
<span class="nc bnc" id="L855" title="All 2 branches missed.">            else if (&quot;Previous&quot;.equals(name)) {</span>
<span class="nc" id="L856">                previousButton = c;</span>
            }
<span class="nc bnc" id="L858" title="All 2 branches missed.">            else if (&quot;Editor&quot;.equals(name)) {</span>
<span class="nc" id="L859">                editor = c;</span>
            }
<span class="nc" id="L861">        }</span>

        public void removeLayoutComponent(Component c) {
<span class="nc bnc" id="L864" title="All 2 branches missed.">            if (c == nextButton) {</span>
<span class="nc" id="L865">                nextButton = null;</span>
            }
<span class="nc bnc" id="L867" title="All 2 branches missed.">            else if (c == previousButton) {</span>
<span class="nc" id="L868">                previousButton = null;</span>
            }
<span class="nc bnc" id="L870" title="All 2 branches missed.">            else if (c == editor) {</span>
<span class="nc" id="L871">                editor = null;</span>
            }
<span class="nc" id="L873">        }</span>

        private Dimension preferredSize(Component c) {
<span class="nc bnc" id="L876" title="All 2 branches missed.">            return (c == null) ? zeroSize : c.getPreferredSize();</span>
        }

        public Dimension preferredLayoutSize(Container parent) {
<span class="nc" id="L880">            Dimension nextD = preferredSize(nextButton);</span>
<span class="nc" id="L881">            Dimension previousD = preferredSize(previousButton);</span>
<span class="nc" id="L882">            Dimension editorD = preferredSize(editor);</span>

            /* Force the editors height to be a multiple of 2
             */
<span class="nc" id="L886">            editorD.height = ((editorD.height + 1) / 2) * 2;</span>

<span class="nc" id="L888">            Dimension size = new Dimension(editorD.width, editorD.height);</span>
<span class="nc" id="L889">            size.width += Math.max(nextD.width, previousD.width);</span>
<span class="nc" id="L890">            Insets insets = parent.getInsets();</span>
<span class="nc" id="L891">            size.width += insets.left + insets.right;</span>
<span class="nc" id="L892">            size.height += insets.top + insets.bottom;</span>
<span class="nc" id="L893">            return size;</span>
        }

        public Dimension minimumLayoutSize(Container parent) {
<span class="nc" id="L897">            return preferredLayoutSize(parent);</span>
        }

        private void setBounds(Component c, int x, int y, int width, int height) {
<span class="nc bnc" id="L901" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L902">                c.setBounds(x, y, width, height);</span>
            }
<span class="nc" id="L904">        }</span>

        public void layoutContainer(Container parent) {
<span class="nc" id="L907">            int width  = parent.getWidth();</span>
<span class="nc" id="L908">            int height = parent.getHeight();</span>

<span class="nc" id="L910">            Insets insets = parent.getInsets();</span>

<span class="nc bnc" id="L912" title="All 4 branches missed.">            if (nextButton == null &amp;&amp; previousButton == null) {</span>
<span class="nc" id="L913">                setBounds(editor, insets.left,  insets.top, width - insets.left - insets.right,</span>
                        height - insets.top - insets.bottom);

<span class="nc" id="L916">                return;</span>
            }

<span class="nc" id="L919">            Dimension nextD = preferredSize(nextButton);</span>
<span class="nc" id="L920">            Dimension previousD = preferredSize(previousButton);</span>
<span class="nc" id="L921">            int buttonsWidth = Math.max(nextD.width, previousD.width);</span>
<span class="nc" id="L922">            int editorHeight = height - (insets.top + insets.bottom);</span>

            // The arrowButtonInsets value is used instead of the JSpinner's
            // insets if not null. Defining this to be (0, 0, 0, 0) causes the
            // buttons to be aligned with the outer edge of the spinner's
            // border, and leaving it as &quot;null&quot; places the buttons completely
            // inside the spinner's border.
<span class="nc" id="L929">            Insets buttonInsets = UIManager.getInsets(&quot;Spinner.arrowButtonInsets&quot;);</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">            if (buttonInsets == null) {</span>
<span class="nc" id="L931">                buttonInsets = insets;</span>
            }

            /* Deal with the spinner's componentOrientation property.
             */
            int editorX, editorWidth, buttonsX;
<span class="nc bnc" id="L937" title="All 2 branches missed.">            if (parent.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L938">                editorX = insets.left;</span>
<span class="nc" id="L939">                editorWidth = width - insets.left - buttonsWidth - buttonInsets.right;</span>
<span class="nc" id="L940">                buttonsX = width - buttonsWidth - buttonInsets.right;</span>
            } else {
<span class="nc" id="L942">                buttonsX = buttonInsets.left;</span>
<span class="nc" id="L943">                editorX = buttonsX + buttonsWidth;</span>
<span class="nc" id="L944">                editorWidth = width - buttonInsets.left - buttonsWidth - insets.right;</span>
            }

<span class="nc" id="L947">            int nextY = buttonInsets.top;</span>
<span class="nc" id="L948">            int nextHeight = (height / 2) + (height % 2) - nextY;</span>
<span class="nc" id="L949">            int previousY = buttonInsets.top + nextHeight;</span>
<span class="nc" id="L950">            int previousHeight = height - previousY - buttonInsets.bottom;</span>

<span class="nc" id="L952">            setBounds(editor,         editorX,  insets.top, editorWidth, editorHeight);</span>
<span class="nc" id="L953">            setBounds(nextButton,     buttonsX, nextY,      buttonsWidth, nextHeight);</span>
<span class="nc" id="L954">            setBounds(previousButton, buttonsX, previousY,  buttonsWidth, previousHeight);</span>
<span class="nc" id="L955">        }</span>


        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent e)
        {
<span class="nc" id="L963">            String propertyName = e.getPropertyName();</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">            if (e.getSource() instanceof JSpinner) {</span>
<span class="nc" id="L965">                JSpinner spinner = (JSpinner)(e.getSource());</span>
<span class="nc" id="L966">                SpinnerUI spinnerUI = spinner.getUI();</span>

<span class="nc bnc" id="L968" title="All 2 branches missed.">                if (spinnerUI instanceof BasicSpinnerUI) {</span>
<span class="nc" id="L969">                    BasicSpinnerUI ui = (BasicSpinnerUI)spinnerUI;</span>

<span class="nc bnc" id="L971" title="All 2 branches missed.">                    if (&quot;editor&quot;.equals(propertyName)) {</span>
<span class="nc" id="L972">                        JComponent oldEditor = (JComponent)e.getOldValue();</span>
<span class="nc" id="L973">                        JComponent newEditor = (JComponent)e.getNewValue();</span>
<span class="nc" id="L974">                        ui.replaceEditor(oldEditor, newEditor);</span>
<span class="nc" id="L975">                        ui.updateEnabledState();</span>
<span class="nc bnc" id="L976" title="All 2 branches missed.">                        if (oldEditor instanceof JSpinner.DefaultEditor) {</span>
<span class="nc" id="L977">                            JTextField tf =</span>
<span class="nc" id="L978">                                ((JSpinner.DefaultEditor)oldEditor).getTextField();</span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">                            if (tf != null) {</span>
<span class="nc" id="L980">                                tf.removeFocusListener(nextButtonHandler);</span>
<span class="nc" id="L981">                                tf.removeFocusListener(previousButtonHandler);</span>
                            }
                        }
<span class="nc bnc" id="L984" title="All 2 branches missed.">                        if (newEditor instanceof JSpinner.DefaultEditor) {</span>
<span class="nc" id="L985">                            JTextField tf =</span>
<span class="nc" id="L986">                                ((JSpinner.DefaultEditor)newEditor).getTextField();</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">                            if (tf != null) {</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">                                if (tf.getFont() instanceof UIResource) {</span>
<span class="nc" id="L989">                                    tf.setFont(spinner.getFont());</span>
                                }
<span class="nc" id="L991">                                tf.addFocusListener(nextButtonHandler);</span>
<span class="nc" id="L992">                                tf.addFocusListener(previousButtonHandler);</span>
                            }
                        }
<span class="nc" id="L995">                    }</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">                    else if (&quot;enabled&quot;.equals(propertyName) ||</span>
<span class="nc bnc" id="L997" title="All 2 branches missed.">                             &quot;model&quot;.equals(propertyName)) {</span>
<span class="nc" id="L998">                        ui.updateEnabledState();</span>
                    }
<span class="nc bnc" id="L1000" title="All 2 branches missed.">                else if (&quot;font&quot;.equals(propertyName)) {</span>
<span class="nc" id="L1001">                    JComponent editor = spinner.getEditor();</span>
<span class="nc bnc" id="L1002" title="All 4 branches missed.">                    if (editor!=null &amp;&amp; editor instanceof JSpinner.DefaultEditor) {</span>
<span class="nc" id="L1003">                        JTextField tf =</span>
<span class="nc" id="L1004">                            ((JSpinner.DefaultEditor)editor).getTextField();</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">                        if (tf != null) {</span>
<span class="nc bnc" id="L1006" title="All 2 branches missed.">                            if (tf.getFont() instanceof UIResource) {</span>
<span class="nc" id="L1007">                                tf.setFont(spinner.getFont());</span>
                            }
                        }
                    }
<span class="nc" id="L1011">                }</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">                else if (JComponent.TOOL_TIP_TEXT_KEY.equals(propertyName)) {</span>
<span class="nc" id="L1013">                    updateToolTipTextForChildren(spinner);</span>
                }
                }
<span class="nc bnc" id="L1016" title="All 2 branches missed.">            } else if (e.getSource() instanceof JComponent) {</span>
<span class="nc" id="L1017">                JComponent c = (JComponent)e.getSource();</span>
<span class="nc bnc" id="L1018" title="All 2 branches missed.">                if ((c.getParent() instanceof JPanel) &amp;&amp;</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">                    (c.getParent().getParent() instanceof JSpinner) &amp;&amp;</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">                    &quot;border&quot;.equals(propertyName)) {</span>

<span class="nc" id="L1022">                    JSpinner spinner = (JSpinner)c.getParent().getParent();</span>
<span class="nc" id="L1023">                    SpinnerUI spinnerUI = spinner.getUI();</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">                    if (spinnerUI instanceof BasicSpinnerUI) {</span>
<span class="nc" id="L1025">                        BasicSpinnerUI ui = (BasicSpinnerUI)spinnerUI;</span>
<span class="nc" id="L1026">                        ui.maybeRemoveEditorBorder(c);</span>
                    }
                }
            }
<span class="nc" id="L1030">        }</span>

        // Syncronizes the ToolTip text for the components within the spinner
        // to be the same value as the spinner ToolTip text.
        private void updateToolTipTextForChildren(JComponent spinner) {
<span class="nc" id="L1035">            String toolTipText = spinner.getToolTipText();</span>
<span class="nc" id="L1036">            Component[] children = spinner.getComponents();</span>
<span class="nc bnc" id="L1037" title="All 2 branches missed.">            for (int i = 0; i &lt; children.length; i++) {</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">                if (children[i] instanceof JSpinner.DefaultEditor) {</span>
<span class="nc" id="L1039">                    JTextField tf = ((JSpinner.DefaultEditor)children[i]).getTextField();</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">                    if (tf != null) {</span>
<span class="nc" id="L1041">                        tf.setToolTipText(toolTipText);</span>
                    }
<span class="nc bnc" id="L1043" title="All 2 branches missed.">                } else if (children[i] instanceof JComponent) {</span>
<span class="nc" id="L1044">                    ((JComponent)children[i]).setToolTipText( spinner.getToolTipText() );</span>
                }
            }
<span class="nc" id="L1047">        }</span>

        public void stateChanged(ChangeEvent e) {
<span class="nc bnc" id="L1050" title="All 2 branches missed.">            if (e.getSource() instanceof JSpinner) {</span>
<span class="nc" id="L1051">                JSpinner spinner = (JSpinner)e.getSource();</span>
<span class="nc" id="L1052">                SpinnerUI spinnerUI = spinner.getUI();</span>
<span class="nc bnc" id="L1053" title="All 4 branches missed.">                if (DefaultLookup.getBoolean(spinner, spinnerUI,</span>
                    &quot;Spinner.disableOnBoundaryValues&quot;, false) &amp;&amp;
                    spinnerUI instanceof BasicSpinnerUI) {
<span class="nc" id="L1056">                    BasicSpinnerUI ui = (BasicSpinnerUI)spinnerUI;</span>
<span class="nc" id="L1057">                    ui.updateEnabledState();</span>
                }
            }
<span class="nc" id="L1060">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>