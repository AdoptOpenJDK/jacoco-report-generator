<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BasicScrollBarUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicScrollBarUI.java</span></div><h1>BasicScrollBarUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.plaf.basic;


import sun.swing.DefaultLookup;
import sun.swing.UIAction;

import java.awt.*;
import java.awt.event.*;

import java.beans.*;

import javax.swing.*;
import javax.swing.event.*;
import javax.swing.plaf.*;


/**
 * Implementation of ScrollBarUI for the Basic Look and Feel
 *
 * @author Rich Schiavi
 * @author David Kloba
 * @author Hans Muller
 */
<span class="nc bnc" id="L48" title="All 2 branches missed.">public class BasicScrollBarUI</span>
    extends ScrollBarUI implements LayoutManager, SwingConstants
{
    private static final int POSITIVE_SCROLL = 1;
    private static final int NEGATIVE_SCROLL = -1;

    private static final int MIN_SCROLL = 2;
    private static final int MAX_SCROLL = 3;

    // NOTE: DO NOT use this field directly, SynthScrollBarUI assumes you'll
    // call getMinimumThumbSize to access it.
    protected Dimension minimumThumbSize;
    protected Dimension maximumThumbSize;

    protected Color thumbHighlightColor;
    protected Color thumbLightShadowColor;
    protected Color thumbDarkShadowColor;
    protected Color thumbColor;
    protected Color trackColor;
    protected Color trackHighlightColor;

    protected JScrollBar scrollbar;
    protected JButton incrButton;
    protected JButton decrButton;
    protected boolean isDragging;
    protected TrackListener trackListener;
    protected ArrowButtonListener buttonListener;
    protected ModelListener modelListener;

    protected Rectangle thumbRect;
    protected Rectangle trackRect;

    protected int trackHighlight;

    protected static final int NO_HIGHLIGHT = 0;
    protected static final int DECREASE_HIGHLIGHT = 1;
    protected static final int INCREASE_HIGHLIGHT = 2;

    protected ScrollListener scrollListener;
    protected PropertyChangeListener propertyChangeListener;
    protected Timer scrollTimer;

    private final static int scrollSpeedThrottle = 60; // delay in milli seconds

    /** True indicates a middle click will absolutely position the
     * scrollbar. */
    private boolean supportsAbsolutePositioning;

    /**
     * Hint as to what width (when vertical) or height (when horizontal)
     * should be.
     *
     * @since 1.7
     */
    protected int scrollBarWidth;

    private Handler handler;

    private boolean thumbActive;

    /**
     * Determine whether scrollbar layout should use cached value or adjusted
     * value returned by scrollbar's &lt;code&gt;getValue&lt;/code&gt;.
     */
<span class="nc" id="L112">    private boolean useCachedValue = false;</span>
    /**
     * The scrollbar value is cached to save real value if the view is adjusted.
     */
    private int scrollBarValue;

    /**
     * Distance between the increment button and the track. This may be a negative
     * number. If negative, then an overlap between the button and track will occur,
     * which is useful for shaped buttons.
     *
     * @since 1.7
     */
    protected int incrGap;

    /**
     * Distance between the decrement button and the track. This may be a negative
     * number. If negative, then an overlap between the button and track will occur,
     * which is useful for shaped buttons.
     *
     * @since 1.7
     */
    protected int decrGap;

    static void loadActionMap(LazyActionMap map) {
<span class="nc" id="L137">        map.put(new Actions(Actions.POSITIVE_UNIT_INCREMENT));</span>
<span class="nc" id="L138">        map.put(new Actions(Actions.POSITIVE_BLOCK_INCREMENT));</span>
<span class="nc" id="L139">        map.put(new Actions(Actions.NEGATIVE_UNIT_INCREMENT));</span>
<span class="nc" id="L140">        map.put(new Actions(Actions.NEGATIVE_BLOCK_INCREMENT));</span>
<span class="nc" id="L141">        map.put(new Actions(Actions.MIN_SCROLL));</span>
<span class="nc" id="L142">        map.put(new Actions(Actions.MAX_SCROLL));</span>
<span class="nc" id="L143">    }</span>


    public static ComponentUI createUI(JComponent c)    {
<span class="nc" id="L147">        return new BasicScrollBarUI();</span>
    }


    protected void configureScrollBarColors()
    {
<span class="nc" id="L153">        LookAndFeel.installColors(scrollbar, &quot;ScrollBar.background&quot;,</span>
                                  &quot;ScrollBar.foreground&quot;);
<span class="nc" id="L155">        thumbHighlightColor = UIManager.getColor(&quot;ScrollBar.thumbHighlight&quot;);</span>
<span class="nc" id="L156">        thumbLightShadowColor = UIManager.getColor(&quot;ScrollBar.thumbShadow&quot;);</span>
<span class="nc" id="L157">        thumbDarkShadowColor = UIManager.getColor(&quot;ScrollBar.thumbDarkShadow&quot;);</span>
<span class="nc" id="L158">        thumbColor = UIManager.getColor(&quot;ScrollBar.thumb&quot;);</span>
<span class="nc" id="L159">        trackColor = UIManager.getColor(&quot;ScrollBar.track&quot;);</span>
<span class="nc" id="L160">        trackHighlightColor = UIManager.getColor(&quot;ScrollBar.trackHighlight&quot;);</span>
<span class="nc" id="L161">    }</span>


    public void installUI(JComponent c)   {
<span class="nc" id="L165">        scrollbar = (JScrollBar)c;</span>
<span class="nc" id="L166">        thumbRect = new Rectangle(0, 0, 0, 0);</span>
<span class="nc" id="L167">        trackRect = new Rectangle(0, 0, 0, 0);</span>
<span class="nc" id="L168">        installDefaults();</span>
<span class="nc" id="L169">        installComponents();</span>
<span class="nc" id="L170">        installListeners();</span>
<span class="nc" id="L171">        installKeyboardActions();</span>
<span class="nc" id="L172">    }</span>

    public void uninstallUI(JComponent c) {
<span class="nc" id="L175">        scrollbar = (JScrollBar)c;</span>
<span class="nc" id="L176">        uninstallListeners();</span>
<span class="nc" id="L177">        uninstallDefaults();</span>
<span class="nc" id="L178">        uninstallComponents();</span>
<span class="nc" id="L179">        uninstallKeyboardActions();</span>
<span class="nc" id="L180">        thumbRect = null;</span>
<span class="nc" id="L181">        scrollbar = null;</span>
<span class="nc" id="L182">        incrButton = null;</span>
<span class="nc" id="L183">        decrButton = null;</span>
<span class="nc" id="L184">    }</span>


    protected void installDefaults()
    {
<span class="nc" id="L189">        scrollBarWidth = UIManager.getInt(&quot;ScrollBar.width&quot;);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (scrollBarWidth &lt;= 0) {</span>
<span class="nc" id="L191">            scrollBarWidth = 16;</span>
        }
<span class="nc" id="L193">        minimumThumbSize = (Dimension)UIManager.get(&quot;ScrollBar.minimumThumbSize&quot;);</span>
<span class="nc" id="L194">        maximumThumbSize = (Dimension)UIManager.get(&quot;ScrollBar.maximumThumbSize&quot;);</span>

<span class="nc" id="L196">        Boolean absB = (Boolean)UIManager.get(&quot;ScrollBar.allowsAbsolutePositioning&quot;);</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">        supportsAbsolutePositioning = (absB != null) ? absB.booleanValue() :</span>
                                      false;

<span class="nc" id="L200">        trackHighlight = NO_HIGHLIGHT;</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (scrollbar.getLayout() == null ||</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                     (scrollbar.getLayout() instanceof UIResource)) {</span>
<span class="nc" id="L203">            scrollbar.setLayout(this);</span>
        }
<span class="nc" id="L205">        configureScrollBarColors();</span>
<span class="nc" id="L206">        LookAndFeel.installBorder(scrollbar, &quot;ScrollBar.border&quot;);</span>
<span class="nc" id="L207">        LookAndFeel.installProperty(scrollbar, &quot;opaque&quot;, Boolean.TRUE);</span>

<span class="nc" id="L209">        scrollBarValue = scrollbar.getValue();</span>

<span class="nc" id="L211">        incrGap = UIManager.getInt(&quot;ScrollBar.incrementButtonGap&quot;);</span>
<span class="nc" id="L212">        decrGap = UIManager.getInt(&quot;ScrollBar.decrementButtonGap&quot;);</span>

        // TODO this can be removed when incrGap/decrGap become protected
        // handle scaling for sizeVarients for special case components. The
        // key &quot;JComponent.sizeVariant&quot; scales for large/small/mini
        // components are based on Apples LAF
<span class="nc" id="L218">        String scaleKey = (String)scrollbar.getClientProperty(</span>
                &quot;JComponent.sizeVariant&quot;);
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (scaleKey != null){</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">            if (&quot;large&quot;.equals(scaleKey)){</span>
<span class="nc" id="L222">                scrollBarWidth *= 1.15;</span>
<span class="nc" id="L223">                incrGap *= 1.15;</span>
<span class="nc" id="L224">                decrGap *= 1.15;</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">            } else if (&quot;small&quot;.equals(scaleKey)){</span>
<span class="nc" id="L226">                scrollBarWidth *= 0.857;</span>
<span class="nc" id="L227">                incrGap *= 0.857;</span>
<span class="nc" id="L228">                decrGap *= 0.714;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            } else if (&quot;mini&quot;.equals(scaleKey)){</span>
<span class="nc" id="L230">                scrollBarWidth *= 0.714;</span>
<span class="nc" id="L231">                incrGap *= 0.714;</span>
<span class="nc" id="L232">                decrGap *= 0.714;</span>
            }
        }
<span class="nc" id="L235">    }</span>


    protected void installComponents(){
<span class="nc bnc" id="L239" title="All 3 branches missed.">        switch (scrollbar.getOrientation()) {</span>
        case JScrollBar.VERTICAL:
<span class="nc" id="L241">            incrButton = createIncreaseButton(SOUTH);</span>
<span class="nc" id="L242">            decrButton = createDecreaseButton(NORTH);</span>
<span class="nc" id="L243">            break;</span>

        case JScrollBar.HORIZONTAL:
<span class="nc bnc" id="L246" title="All 2 branches missed.">            if (scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L247">                incrButton = createIncreaseButton(EAST);</span>
<span class="nc" id="L248">                decrButton = createDecreaseButton(WEST);</span>
            } else {
<span class="nc" id="L250">                incrButton = createIncreaseButton(WEST);</span>
<span class="nc" id="L251">                decrButton = createDecreaseButton(EAST);</span>
            }
            break;
        }
<span class="nc" id="L255">        scrollbar.add(incrButton);</span>
<span class="nc" id="L256">        scrollbar.add(decrButton);</span>
        // Force the children's enabled state to be updated.
<span class="nc" id="L258">        scrollbar.setEnabled(scrollbar.isEnabled());</span>
<span class="nc" id="L259">    }</span>

    protected void uninstallComponents(){
<span class="nc" id="L262">        scrollbar.remove(incrButton);</span>
<span class="nc" id="L263">        scrollbar.remove(decrButton);</span>
<span class="nc" id="L264">    }</span>


    protected void installListeners(){
<span class="nc" id="L268">        trackListener = createTrackListener();</span>
<span class="nc" id="L269">        buttonListener = createArrowButtonListener();</span>
<span class="nc" id="L270">        modelListener = createModelListener();</span>
<span class="nc" id="L271">        propertyChangeListener = createPropertyChangeListener();</span>

<span class="nc" id="L273">        scrollbar.addMouseListener(trackListener);</span>
<span class="nc" id="L274">        scrollbar.addMouseMotionListener(trackListener);</span>
<span class="nc" id="L275">        scrollbar.getModel().addChangeListener(modelListener);</span>
<span class="nc" id="L276">        scrollbar.addPropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L277">        scrollbar.addFocusListener(getHandler());</span>

<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (incrButton != null) {</span>
<span class="nc" id="L280">            incrButton.addMouseListener(buttonListener);</span>
        }
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (decrButton != null) {</span>
<span class="nc" id="L283">            decrButton.addMouseListener(buttonListener);</span>
        }

<span class="nc" id="L286">        scrollListener = createScrollListener();</span>
<span class="nc" id="L287">        scrollTimer = new Timer(scrollSpeedThrottle, scrollListener);</span>
<span class="nc" id="L288">        scrollTimer.setInitialDelay(300);  // default InitialDelay?</span>
<span class="nc" id="L289">    }</span>


    protected void installKeyboardActions(){
<span class="nc" id="L293">        LazyActionMap.installLazyActionMap(scrollbar, BasicScrollBarUI.class,</span>
                                           &quot;ScrollBar.actionMap&quot;);

<span class="nc" id="L296">        InputMap inputMap = getInputMap(JComponent.WHEN_FOCUSED);</span>
<span class="nc" id="L297">        SwingUtilities.replaceUIInputMap(scrollbar, JComponent.WHEN_FOCUSED,</span>
                                         inputMap);
<span class="nc" id="L299">        inputMap = getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);</span>
<span class="nc" id="L300">        SwingUtilities.replaceUIInputMap(scrollbar,</span>
                   JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT, inputMap);
<span class="nc" id="L302">    }</span>

    protected void uninstallKeyboardActions(){
<span class="nc" id="L305">        SwingUtilities.replaceUIInputMap(scrollbar, JComponent.WHEN_FOCUSED,</span>
                                         null);
<span class="nc" id="L307">        SwingUtilities.replaceUIActionMap(scrollbar, null);</span>
<span class="nc" id="L308">    }</span>

    private InputMap getInputMap(int condition) {
<span class="nc bnc" id="L311" title="All 2 branches missed.">        if (condition == JComponent.WHEN_FOCUSED) {</span>
<span class="nc" id="L312">            InputMap keyMap = (InputMap)DefaultLookup.get(</span>
                        scrollbar, this, &quot;ScrollBar.focusInputMap&quot;);
            InputMap rtlKeyMap;

<span class="nc bnc" id="L316" title="All 2 branches missed.">            if (scrollbar.getComponentOrientation().isLeftToRight() ||</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">                ((rtlKeyMap = (InputMap)DefaultLookup.get(scrollbar, this, &quot;ScrollBar.focusInputMap.RightToLeft&quot;)) == null)) {</span>
<span class="nc" id="L318">                return keyMap;</span>
            } else {
<span class="nc" id="L320">                rtlKeyMap.setParent(keyMap);</span>
<span class="nc" id="L321">                return rtlKeyMap;</span>
            }
        }
<span class="nc bnc" id="L324" title="All 2 branches missed.">        else if (condition == JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT) {</span>
<span class="nc" id="L325">            InputMap keyMap = (InputMap)DefaultLookup.get(</span>
                        scrollbar, this, &quot;ScrollBar.ancestorInputMap&quot;);
            InputMap rtlKeyMap;

<span class="nc bnc" id="L329" title="All 2 branches missed.">            if (scrollbar.getComponentOrientation().isLeftToRight() ||</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">                ((rtlKeyMap = (InputMap)DefaultLookup.get(scrollbar, this, &quot;ScrollBar.ancestorInputMap.RightToLeft&quot;)) == null)) {</span>
<span class="nc" id="L331">                return keyMap;</span>
            } else {
<span class="nc" id="L333">                rtlKeyMap.setParent(keyMap);</span>
<span class="nc" id="L334">                return rtlKeyMap;</span>
            }
        }
<span class="nc" id="L337">        return null;</span>
    }


    protected void uninstallListeners() {
<span class="nc" id="L342">        scrollTimer.stop();</span>
<span class="nc" id="L343">        scrollTimer = null;</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">        if (decrButton != null){</span>
<span class="nc" id="L346">            decrButton.removeMouseListener(buttonListener);</span>
        }
<span class="nc bnc" id="L348" title="All 2 branches missed.">        if (incrButton != null){</span>
<span class="nc" id="L349">            incrButton.removeMouseListener(buttonListener);</span>
        }

<span class="nc" id="L352">        scrollbar.getModel().removeChangeListener(modelListener);</span>
<span class="nc" id="L353">        scrollbar.removeMouseListener(trackListener);</span>
<span class="nc" id="L354">        scrollbar.removeMouseMotionListener(trackListener);</span>
<span class="nc" id="L355">        scrollbar.removePropertyChangeListener(propertyChangeListener);</span>
<span class="nc" id="L356">        scrollbar.removeFocusListener(getHandler());</span>
<span class="nc" id="L357">        handler = null;</span>
<span class="nc" id="L358">    }</span>


    protected void uninstallDefaults(){
<span class="nc" id="L362">        LookAndFeel.uninstallBorder(scrollbar);</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">        if (scrollbar.getLayout() == this) {</span>
<span class="nc" id="L364">            scrollbar.setLayout(null);</span>
        }
<span class="nc" id="L366">    }</span>


    private Handler getHandler() {
<span class="nc bnc" id="L370" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L371">            handler = new Handler();</span>
        }
<span class="nc" id="L373">        return handler;</span>
    }

    protected TrackListener createTrackListener(){
<span class="nc" id="L377">        return new TrackListener();</span>
    }

    protected ArrowButtonListener createArrowButtonListener(){
<span class="nc" id="L381">        return new ArrowButtonListener();</span>
    }

    protected ModelListener createModelListener(){
<span class="nc" id="L385">        return new ModelListener();</span>
    }

    protected ScrollListener createScrollListener(){
<span class="nc" id="L389">        return new ScrollListener();</span>
    }

    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L393">        return getHandler();</span>
    }

    private void updateThumbState(int x, int y) {
<span class="nc" id="L397">        Rectangle rect = getThumbBounds();</span>

<span class="nc" id="L399">        setThumbRollover(rect.contains(x, y));</span>
<span class="nc" id="L400">    }</span>

    /**
     * Sets whether or not the mouse is currently over the thumb.
     *
     * @param active True indicates the thumb is currently active.
     * @since 1.5
     */
    protected void setThumbRollover(boolean active) {
<span class="nc bnc" id="L409" title="All 2 branches missed.">        if (thumbActive != active) {</span>
<span class="nc" id="L410">            thumbActive = active;</span>
<span class="nc" id="L411">            scrollbar.repaint(getThumbBounds());</span>
        }
<span class="nc" id="L413">    }</span>

    /**
     * Returns true if the mouse is currently over the thumb.
     *
     * @return true if the thumb is currently active
     * @since 1.5
     */
    public boolean isThumbRollover() {
<span class="nc" id="L422">        return thumbActive;</span>
    }

    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L426">        paintTrack(g, c, getTrackBounds());</span>
<span class="nc" id="L427">        Rectangle thumbBounds = getThumbBounds();</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">        if (thumbBounds.intersects(g.getClipBounds())) {</span>
<span class="nc" id="L429">            paintThumb(g, c, thumbBounds);</span>
        }
<span class="nc" id="L431">    }</span>


    /**
     * A vertical scrollbar's preferred width is the maximum of
     * preferred widths of the (non &lt;code&gt;null&lt;/code&gt;)
     * increment/decrement buttons,
     * and the minimum width of the thumb. The preferred height is the
     * sum of the preferred heights of the same parts.  The basis for
     * the preferred size of a horizontal scrollbar is similar.
     * &lt;p&gt;
     * The &lt;code&gt;preferredSize&lt;/code&gt; is only computed once, subsequent
     * calls to this method just return a cached size.
     *
     * @param c the &lt;code&gt;JScrollBar&lt;/code&gt; that's delegating this method to us
     * @return the preferred size of a Basic JScrollBar
     * @see #getMaximumSize
     * @see #getMinimumSize
     */
    public Dimension getPreferredSize(JComponent c) {
<span class="nc bnc" id="L451" title="All 2 branches missed.">        return (scrollbar.getOrientation() == JScrollBar.VERTICAL)</span>
            ? new Dimension(scrollBarWidth, 48)
            : new Dimension(48, scrollBarWidth);
    }


    /**
     * @param c The JScrollBar that's delegating this method to us.
     * @return new Dimension(Integer.MAX_VALUE, Integer.MAX_VALUE);
     * @see #getMinimumSize
     * @see #getPreferredSize
     */
    public Dimension getMaximumSize(JComponent c) {
<span class="nc" id="L464">        return new Dimension(Integer.MAX_VALUE, Integer.MAX_VALUE);</span>
    }

    protected JButton createDecreaseButton(int orientation)  {
<span class="nc" id="L468">        return new BasicArrowButton(orientation,</span>
<span class="nc" id="L469">                                    UIManager.getColor(&quot;ScrollBar.thumb&quot;),</span>
<span class="nc" id="L470">                                    UIManager.getColor(&quot;ScrollBar.thumbShadow&quot;),</span>
<span class="nc" id="L471">                                    UIManager.getColor(&quot;ScrollBar.thumbDarkShadow&quot;),</span>
<span class="nc" id="L472">                                    UIManager.getColor(&quot;ScrollBar.thumbHighlight&quot;));</span>
    }

    protected JButton createIncreaseButton(int orientation)  {
<span class="nc" id="L476">        return new BasicArrowButton(orientation,</span>
<span class="nc" id="L477">                                    UIManager.getColor(&quot;ScrollBar.thumb&quot;),</span>
<span class="nc" id="L478">                                    UIManager.getColor(&quot;ScrollBar.thumbShadow&quot;),</span>
<span class="nc" id="L479">                                    UIManager.getColor(&quot;ScrollBar.thumbDarkShadow&quot;),</span>
<span class="nc" id="L480">                                    UIManager.getColor(&quot;ScrollBar.thumbHighlight&quot;));</span>
    }


    protected void paintDecreaseHighlight(Graphics g)
    {
<span class="nc" id="L486">        Insets insets = scrollbar.getInsets();</span>
<span class="nc" id="L487">        Rectangle thumbR = getThumbBounds();</span>
<span class="nc" id="L488">        g.setColor(trackHighlightColor);</span>

<span class="nc bnc" id="L490" title="All 2 branches missed.">        if (scrollbar.getOrientation() == JScrollBar.VERTICAL) {</span>
            //paint the distance between the start of the track and top of the thumb
<span class="nc" id="L492">            int x = insets.left;</span>
<span class="nc" id="L493">            int y = trackRect.y;</span>
<span class="nc" id="L494">            int w = scrollbar.getWidth() - (insets.left + insets.right);</span>
<span class="nc" id="L495">            int h = thumbR.y - y;</span>
<span class="nc" id="L496">            g.fillRect(x, y, w, h);</span>
<span class="nc" id="L497">        } else {</span>
            //if left-to-right, fill the area between the start of the track and
            //the left edge of the thumb. If right-to-left, fill the area between
            //the end of the thumb and end of the track.
            int x, w;
<span class="nc bnc" id="L502" title="All 2 branches missed.">            if (scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L503">               x = trackRect.x;</span>
<span class="nc" id="L504">                w = thumbR.x - x;</span>
            } else {
<span class="nc" id="L506">                x = thumbR.x + thumbR.width;</span>
<span class="nc" id="L507">                w = trackRect.x + trackRect.width - x;</span>
            }
<span class="nc" id="L509">            int y = insets.top;</span>
<span class="nc" id="L510">            int h = scrollbar.getHeight() - (insets.top + insets.bottom);</span>
<span class="nc" id="L511">            g.fillRect(x, y, w, h);</span>
        }
<span class="nc" id="L513">    }</span>


    protected void paintIncreaseHighlight(Graphics g)
    {
<span class="nc" id="L518">        Insets insets = scrollbar.getInsets();</span>
<span class="nc" id="L519">        Rectangle thumbR = getThumbBounds();</span>
<span class="nc" id="L520">        g.setColor(trackHighlightColor);</span>

<span class="nc bnc" id="L522" title="All 2 branches missed.">        if (scrollbar.getOrientation() == JScrollBar.VERTICAL) {</span>
            //fill the area between the bottom of the thumb and the end of the track.
<span class="nc" id="L524">            int x = insets.left;</span>
<span class="nc" id="L525">            int y = thumbR.y + thumbR.height;</span>
<span class="nc" id="L526">            int w = scrollbar.getWidth() - (insets.left + insets.right);</span>
<span class="nc" id="L527">            int h = trackRect.y + trackRect.height - y;</span>
<span class="nc" id="L528">            g.fillRect(x, y, w, h);</span>
<span class="nc" id="L529">        }</span>
        else {
            //if left-to-right, fill the area between the right of the thumb and the
            //end of the track. If right-to-left, then fill the area to the left of
            //the thumb and the start of the track.
            int x, w;
<span class="nc bnc" id="L535" title="All 2 branches missed.">            if (scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L536">                x = thumbR.x + thumbR.width;</span>
<span class="nc" id="L537">                w = trackRect.x + trackRect.width - x;</span>
            } else {
<span class="nc" id="L539">                x = trackRect.x;</span>
<span class="nc" id="L540">                w = thumbR.x - x;</span>
            }
<span class="nc" id="L542">            int y = insets.top;</span>
<span class="nc" id="L543">            int h = scrollbar.getHeight() - (insets.top + insets.bottom);</span>
<span class="nc" id="L544">            g.fillRect(x, y, w, h);</span>
        }
<span class="nc" id="L546">    }</span>


    protected void paintTrack(Graphics g, JComponent c, Rectangle trackBounds)
    {
<span class="nc" id="L551">        g.setColor(trackColor);</span>
<span class="nc" id="L552">        g.fillRect(trackBounds.x, trackBounds.y, trackBounds.width, trackBounds.height);</span>

<span class="nc bnc" id="L554" title="All 2 branches missed.">        if(trackHighlight == DECREASE_HIGHLIGHT)        {</span>
<span class="nc" id="L555">            paintDecreaseHighlight(g);</span>
        }
<span class="nc bnc" id="L557" title="All 2 branches missed.">        else if(trackHighlight == INCREASE_HIGHLIGHT)           {</span>
<span class="nc" id="L558">            paintIncreaseHighlight(g);</span>
        }
<span class="nc" id="L560">    }</span>


    protected void paintThumb(Graphics g, JComponent c, Rectangle thumbBounds)
    {
<span class="nc bnc" id="L565" title="All 4 branches missed.">        if(thumbBounds.isEmpty() || !scrollbar.isEnabled())     {</span>
<span class="nc" id="L566">            return;</span>
        }

<span class="nc" id="L569">        int w = thumbBounds.width;</span>
<span class="nc" id="L570">        int h = thumbBounds.height;</span>

<span class="nc" id="L572">        g.translate(thumbBounds.x, thumbBounds.y);</span>

<span class="nc" id="L574">        g.setColor(thumbDarkShadowColor);</span>
<span class="nc" id="L575">        g.drawRect(0, 0, w-1, h-1);</span>
<span class="nc" id="L576">        g.setColor(thumbColor);</span>
<span class="nc" id="L577">        g.fillRect(0, 0, w-1, h-1);</span>

<span class="nc" id="L579">        g.setColor(thumbHighlightColor);</span>
<span class="nc" id="L580">        g.drawLine(1, 1, 1, h-2);</span>
<span class="nc" id="L581">        g.drawLine(2, 1, w-3, 1);</span>

<span class="nc" id="L583">        g.setColor(thumbLightShadowColor);</span>
<span class="nc" id="L584">        g.drawLine(2, h-2, w-2, h-2);</span>
<span class="nc" id="L585">        g.drawLine(w-2, 1, w-2, h-3);</span>

<span class="nc" id="L587">        g.translate(-thumbBounds.x, -thumbBounds.y);</span>
<span class="nc" id="L588">    }</span>


    /**
     * Returns the smallest acceptable size for the thumb.  If the scrollbar
     * becomes so small that this size isn't available, the thumb will be
     * hidden.
     * &lt;p&gt;
     * &lt;b&gt;Warning &lt;/b&gt;: the value returned by this method should not be
     * be modified, it's a shared static constant.
     *
     * @return The smallest acceptable size for the thumb.
     * @see #getMaximumThumbSize
     */
    protected Dimension getMinimumThumbSize() {
<span class="nc" id="L603">        return minimumThumbSize;</span>
    }

    /**
     * Returns the largest acceptable size for the thumb.  To create a fixed
     * size thumb one make this method and &lt;code&gt;getMinimumThumbSize&lt;/code&gt;
     * return the same value.
     * &lt;p&gt;
     * &lt;b&gt;Warning &lt;/b&gt;: the value returned by this method should not be
     * be modified, it's a shared static constant.
     *
     * @return The largest acceptable size for the thumb.
     * @see #getMinimumThumbSize
     */
    protected Dimension getMaximumThumbSize()   {
<span class="nc" id="L618">        return maximumThumbSize;</span>
    }


    /*
     * LayoutManager Implementation
     */

<span class="nc" id="L626">    public void addLayoutComponent(String name, Component child) {}</span>
<span class="nc" id="L627">    public void removeLayoutComponent(Component child) {}</span>

    public Dimension preferredLayoutSize(Container scrollbarContainer)  {
<span class="nc" id="L630">        return getPreferredSize((JComponent)scrollbarContainer);</span>
    }

    public Dimension minimumLayoutSize(Container scrollbarContainer) {
<span class="nc" id="L634">        return getMinimumSize((JComponent)scrollbarContainer);</span>
    }

    private int getValue(JScrollBar sb) {
<span class="nc bnc" id="L638" title="All 2 branches missed.">        return (useCachedValue) ? scrollBarValue : sb.getValue();</span>
    }

    protected void layoutVScrollbar(JScrollBar sb)
    {
<span class="nc" id="L643">        Dimension sbSize = sb.getSize();</span>
<span class="nc" id="L644">        Insets sbInsets = sb.getInsets();</span>

        /*
         * Width and left edge of the buttons and thumb.
         */
<span class="nc" id="L649">        int itemW = sbSize.width - (sbInsets.left + sbInsets.right);</span>
<span class="nc" id="L650">        int itemX = sbInsets.left;</span>

        /* Nominal locations of the buttons, assuming their preferred
         * size will fit.
         */
<span class="nc" id="L655">        boolean squareButtons = DefaultLookup.getBoolean(</span>
            scrollbar, this, &quot;ScrollBar.squareButtons&quot;, false);
<span class="nc bnc" id="L657" title="All 2 branches missed.">        int decrButtonH = squareButtons ? itemW :</span>
<span class="nc" id="L658">                          decrButton.getPreferredSize().height;</span>
<span class="nc" id="L659">        int decrButtonY = sbInsets.top;</span>

<span class="nc bnc" id="L661" title="All 2 branches missed.">        int incrButtonH = squareButtons ? itemW :</span>
<span class="nc" id="L662">                          incrButton.getPreferredSize().height;</span>
<span class="nc" id="L663">        int incrButtonY = sbSize.height - (sbInsets.bottom + incrButtonH);</span>

        /* The thumb must fit within the height left over after we
         * subtract the preferredSize of the buttons and the insets
         * and the gaps
         */
<span class="nc" id="L669">        int sbInsetsH = sbInsets.top + sbInsets.bottom;</span>
<span class="nc" id="L670">        int sbButtonsH = decrButtonH + incrButtonH;</span>
<span class="nc" id="L671">        int gaps = decrGap + incrGap;</span>
<span class="nc" id="L672">        float trackH = sbSize.height - (sbInsetsH + sbButtonsH) - gaps;</span>

        /* Compute the height and origin of the thumb.   The case
         * where the thumb is at the bottom edge is handled specially
         * to avoid numerical problems in computing thumbY.  Enforce
         * the thumbs min/max dimensions.  If the thumb doesn't
         * fit in the track (trackH) we'll hide it later.
         */
<span class="nc" id="L680">        float min = sb.getMinimum();</span>
<span class="nc" id="L681">        float extent = sb.getVisibleAmount();</span>
<span class="nc" id="L682">        float range = sb.getMaximum() - min;</span>
<span class="nc" id="L683">        float value = getValue(sb);</span>

<span class="nc bnc" id="L685" title="All 2 branches missed.">        int thumbH = (range &lt;= 0)</span>
<span class="nc" id="L686">            ? getMaximumThumbSize().height : (int)(trackH * (extent / range));</span>
<span class="nc" id="L687">        thumbH = Math.max(thumbH, getMinimumThumbSize().height);</span>
<span class="nc" id="L688">        thumbH = Math.min(thumbH, getMaximumThumbSize().height);</span>

<span class="nc" id="L690">        int thumbY = incrButtonY - incrGap - thumbH;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">        if (value &lt; (sb.getMaximum() - sb.getVisibleAmount())) {</span>
<span class="nc" id="L692">            float thumbRange = trackH - thumbH;</span>
<span class="nc" id="L693">            thumbY = (int)(0.5f + (thumbRange * ((value - min) / (range - extent))));</span>
<span class="nc" id="L694">            thumbY +=  decrButtonY + decrButtonH + decrGap;</span>
        }

        /* If the buttons don't fit, allocate half of the available
         * space to each and move the lower one (incrButton) down.
         */
<span class="nc" id="L700">        int sbAvailButtonH = (sbSize.height - sbInsetsH);</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">        if (sbAvailButtonH &lt; sbButtonsH) {</span>
<span class="nc" id="L702">            incrButtonH = decrButtonH = sbAvailButtonH / 2;</span>
<span class="nc" id="L703">            incrButtonY = sbSize.height - (sbInsets.bottom + incrButtonH);</span>
        }
<span class="nc" id="L705">        decrButton.setBounds(itemX, decrButtonY, itemW, decrButtonH);</span>
<span class="nc" id="L706">        incrButton.setBounds(itemX, incrButtonY, itemW, incrButtonH);</span>

        /* Update the trackRect field.
         */
<span class="nc" id="L710">        int itrackY = decrButtonY + decrButtonH + decrGap;</span>
<span class="nc" id="L711">        int itrackH = incrButtonY - incrGap - itrackY;</span>
<span class="nc" id="L712">        trackRect.setBounds(itemX, itrackY, itemW, itrackH);</span>

        /* If the thumb isn't going to fit, zero it's bounds.  Otherwise
         * make sure it fits between the buttons.  Note that setting the
         * thumbs bounds will cause a repaint.
         */
<span class="nc bnc" id="L718" title="All 2 branches missed.">        if(thumbH &gt;= (int)trackH)       {</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">            if (UIManager.getBoolean(&quot;ScrollBar.alwaysShowThumb&quot;)) {</span>
                // This is used primarily for GTK L&amp;F, which expands the
                // thumb to fit the track when it would otherwise be hidden.
<span class="nc" id="L722">                setThumbBounds(itemX, itrackY, itemW, itrackH);</span>
            } else {
                // Other L&amp;F's simply hide the thumb in this case.
<span class="nc" id="L725">                setThumbBounds(0, 0, 0, 0);</span>
            }
        }
        else {
<span class="nc bnc" id="L729" title="All 2 branches missed.">            if ((thumbY + thumbH) &gt; incrButtonY - incrGap) {</span>
<span class="nc" id="L730">                thumbY = incrButtonY - incrGap - thumbH;</span>
            }
<span class="nc bnc" id="L732" title="All 2 branches missed.">            if (thumbY  &lt; (decrButtonY + decrButtonH + decrGap)) {</span>
<span class="nc" id="L733">                thumbY = decrButtonY + decrButtonH + decrGap + 1;</span>
            }
<span class="nc" id="L735">            setThumbBounds(itemX, thumbY, itemW, thumbH);</span>
        }
<span class="nc" id="L737">    }</span>


    protected void layoutHScrollbar(JScrollBar sb)
    {
<span class="nc" id="L742">        Dimension sbSize = sb.getSize();</span>
<span class="nc" id="L743">        Insets sbInsets = sb.getInsets();</span>

        /* Height and top edge of the buttons and thumb.
         */
<span class="nc" id="L747">        int itemH = sbSize.height - (sbInsets.top + sbInsets.bottom);</span>
<span class="nc" id="L748">        int itemY = sbInsets.top;</span>

<span class="nc" id="L750">        boolean ltr = sb.getComponentOrientation().isLeftToRight();</span>

        /* Nominal locations of the buttons, assuming their preferred
         * size will fit.
         */
<span class="nc" id="L755">        boolean squareButtons = DefaultLookup.getBoolean(</span>
            scrollbar, this, &quot;ScrollBar.squareButtons&quot;, false);
<span class="nc bnc" id="L757" title="All 2 branches missed.">        int leftButtonW = squareButtons ? itemH :</span>
<span class="nc" id="L758">                          decrButton.getPreferredSize().width;</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">        int rightButtonW = squareButtons ? itemH :</span>
<span class="nc" id="L760">                          incrButton.getPreferredSize().width;</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">        if (!ltr) {</span>
<span class="nc" id="L762">            int temp = leftButtonW;</span>
<span class="nc" id="L763">            leftButtonW = rightButtonW;</span>
<span class="nc" id="L764">            rightButtonW = temp;</span>
        }
<span class="nc" id="L766">        int leftButtonX = sbInsets.left;</span>
<span class="nc" id="L767">        int rightButtonX = sbSize.width - (sbInsets.right + rightButtonW);</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">        int leftGap = ltr ? decrGap : incrGap;</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">        int rightGap = ltr ? incrGap : decrGap;</span>

        /* The thumb must fit within the width left over after we
         * subtract the preferredSize of the buttons and the insets
         * and the gaps
         */
<span class="nc" id="L775">        int sbInsetsW = sbInsets.left + sbInsets.right;</span>
<span class="nc" id="L776">        int sbButtonsW = leftButtonW + rightButtonW;</span>
<span class="nc" id="L777">        float trackW = sbSize.width - (sbInsetsW + sbButtonsW) - (leftGap + rightGap);</span>

        /* Compute the width and origin of the thumb.  Enforce
         * the thumbs min/max dimensions.  The case where the thumb
         * is at the right edge is handled specially to avoid numerical
         * problems in computing thumbX.  If the thumb doesn't
         * fit in the track (trackH) we'll hide it later.
         */
<span class="nc" id="L785">        float min = sb.getMinimum();</span>
<span class="nc" id="L786">        float max = sb.getMaximum();</span>
<span class="nc" id="L787">        float extent = sb.getVisibleAmount();</span>
<span class="nc" id="L788">        float range = max - min;</span>
<span class="nc" id="L789">        float value = getValue(sb);</span>

<span class="nc bnc" id="L791" title="All 2 branches missed.">        int thumbW = (range &lt;= 0)</span>
<span class="nc" id="L792">            ? getMaximumThumbSize().width : (int)(trackW * (extent / range));</span>
<span class="nc" id="L793">        thumbW = Math.max(thumbW, getMinimumThumbSize().width);</span>
<span class="nc" id="L794">        thumbW = Math.min(thumbW, getMaximumThumbSize().width);</span>

<span class="nc bnc" id="L796" title="All 2 branches missed.">        int thumbX = ltr ? rightButtonX - rightGap - thumbW : leftButtonX + leftButtonW + leftGap;</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">        if (value &lt; (max - sb.getVisibleAmount())) {</span>
<span class="nc" id="L798">            float thumbRange = trackW - thumbW;</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">            if( ltr ) {</span>
<span class="nc" id="L800">                thumbX = (int)(0.5f + (thumbRange * ((value - min) / (range - extent))));</span>
            } else {
<span class="nc" id="L802">                thumbX = (int)(0.5f + (thumbRange * ((max - extent - value) / (range - extent))));</span>
            }
<span class="nc" id="L804">            thumbX += leftButtonX + leftButtonW + leftGap;</span>
        }

        /* If the buttons don't fit, allocate half of the available
         * space to each and move the right one over.
         */
<span class="nc" id="L810">        int sbAvailButtonW = (sbSize.width - sbInsetsW);</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">        if (sbAvailButtonW &lt; sbButtonsW) {</span>
<span class="nc" id="L812">            rightButtonW = leftButtonW = sbAvailButtonW / 2;</span>
<span class="nc" id="L813">            rightButtonX = sbSize.width - (sbInsets.right + rightButtonW + rightGap);</span>
        }

<span class="nc bnc" id="L816" title="All 2 branches missed.">        (ltr ? decrButton : incrButton).setBounds(leftButtonX, itemY, leftButtonW, itemH);</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">        (ltr ? incrButton : decrButton).setBounds(rightButtonX, itemY, rightButtonW, itemH);</span>

        /* Update the trackRect field.
         */
<span class="nc" id="L821">        int itrackX = leftButtonX + leftButtonW + leftGap;</span>
<span class="nc" id="L822">        int itrackW = rightButtonX - rightGap - itrackX;</span>
<span class="nc" id="L823">        trackRect.setBounds(itrackX, itemY, itrackW, itemH);</span>

        /* Make sure the thumb fits between the buttons.  Note
         * that setting the thumbs bounds causes a repaint.
         */
<span class="nc bnc" id="L828" title="All 2 branches missed.">        if (thumbW &gt;= (int)trackW) {</span>
<span class="nc bnc" id="L829" title="All 2 branches missed.">            if (UIManager.getBoolean(&quot;ScrollBar.alwaysShowThumb&quot;)) {</span>
                // This is used primarily for GTK L&amp;F, which expands the
                // thumb to fit the track when it would otherwise be hidden.
<span class="nc" id="L832">                setThumbBounds(itrackX, itemY, itrackW, itemH);</span>
            } else {
                // Other L&amp;F's simply hide the thumb in this case.
<span class="nc" id="L835">                setThumbBounds(0, 0, 0, 0);</span>
            }
        }
        else {
<span class="nc bnc" id="L839" title="All 2 branches missed.">            if (thumbX + thumbW &gt; rightButtonX - rightGap) {</span>
<span class="nc" id="L840">                thumbX = rightButtonX - rightGap - thumbW;</span>
            }
<span class="nc bnc" id="L842" title="All 2 branches missed.">            if (thumbX  &lt; leftButtonX + leftButtonW + leftGap) {</span>
<span class="nc" id="L843">                thumbX = leftButtonX + leftButtonW + leftGap + 1;</span>
            }
<span class="nc" id="L845">            setThumbBounds(thumbX, itemY, thumbW, itemH);</span>
        }
<span class="nc" id="L847">    }</span>

    public void layoutContainer(Container scrollbarContainer)
    {
        /* If the user is dragging the value, we'll assume that the
         * scrollbars layout is OK modulo the thumb which is being
         * handled by the dragging code.
         */
<span class="nc bnc" id="L855" title="All 2 branches missed.">        if (isDragging) {</span>
<span class="nc" id="L856">            return;</span>
        }

<span class="nc" id="L859">        JScrollBar scrollbar = (JScrollBar)scrollbarContainer;</span>
<span class="nc bnc" id="L860" title="All 3 branches missed.">        switch (scrollbar.getOrientation()) {</span>
        case JScrollBar.VERTICAL:
<span class="nc" id="L862">            layoutVScrollbar(scrollbar);</span>
<span class="nc" id="L863">            break;</span>

        case JScrollBar.HORIZONTAL:
<span class="nc" id="L866">            layoutHScrollbar(scrollbar);</span>
            break;
        }
<span class="nc" id="L869">    }</span>


    /**
     * Set the bounds of the thumb and force a repaint that includes
     * the old thumbBounds and the new one.
     *
     * @see #getThumbBounds
     */
    protected void setThumbBounds(int x, int y, int width, int height)
    {
        /* If the thumbs bounds haven't changed, we're done.
         */
<span class="nc bnc" id="L882" title="All 8 branches missed.">        if ((thumbRect.x == x) &amp;&amp;</span>
            (thumbRect.y == y) &amp;&amp;
            (thumbRect.width == width) &amp;&amp;
            (thumbRect.height == height)) {
<span class="nc" id="L886">            return;</span>
        }

        /* Update thumbRect, and repaint the union of x,y,w,h and
         * the old thumbRect.
         */
<span class="nc" id="L892">        int minX = Math.min(x, thumbRect.x);</span>
<span class="nc" id="L893">        int minY = Math.min(y, thumbRect.y);</span>
<span class="nc" id="L894">        int maxX = Math.max(x + width, thumbRect.x + thumbRect.width);</span>
<span class="nc" id="L895">        int maxY = Math.max(y + height, thumbRect.y + thumbRect.height);</span>

<span class="nc" id="L897">        thumbRect.setBounds(x, y, width, height);</span>
<span class="nc" id="L898">        scrollbar.repaint(minX, minY, maxX - minX, maxY - minY);</span>

        // Once there is API to determine the mouse location this will need
        // to be changed.
<span class="nc" id="L902">        setThumbRollover(false);</span>
<span class="nc" id="L903">    }</span>


    /**
     * Return the current size/location of the thumb.
     * &lt;p&gt;
     * &lt;b&gt;Warning &lt;/b&gt;: the value returned by this method should not be
     * be modified, it's a reference to the actual rectangle, not a copy.
     *
     * @return The current size/location of the thumb.
     * @see #setThumbBounds
     */
    protected Rectangle getThumbBounds() {
<span class="nc" id="L916">        return thumbRect;</span>
    }


    /**
     * Returns the current bounds of the track, i.e. the space in between
     * the increment and decrement buttons, less the insets.  The value
     * returned by this method is updated each time the scrollbar is
     * laid out (validated).
     * &lt;p&gt;
     * &lt;b&gt;Warning &lt;/b&gt;: the value returned by this method should not be
     * be modified, it's a reference to the actual rectangle, not a copy.
     *
     * @return the current bounds of the scrollbar track
     * @see #layoutContainer
     */
    protected Rectangle getTrackBounds() {
<span class="nc" id="L933">        return trackRect;</span>
    }

    /*
     * Method for scrolling by a block increment.
     * Added for mouse wheel scrolling support, RFE 4202656.
     */
    static void scrollByBlock(JScrollBar scrollbar, int direction) {
        // This method is called from BasicScrollPaneUI to implement wheel
        // scrolling, and also from scrollByBlock().
<span class="nc" id="L943">            int oldValue = scrollbar.getValue();</span>
<span class="nc" id="L944">            int blockIncrement = scrollbar.getBlockIncrement(direction);</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">            int delta = blockIncrement * ((direction &gt; 0) ? +1 : -1);</span>
<span class="nc" id="L946">            int newValue = oldValue + delta;</span>

            // Check for overflow.
<span class="nc bnc" id="L949" title="All 4 branches missed.">            if (delta &gt; 0 &amp;&amp; newValue &lt; oldValue) {</span>
<span class="nc" id="L950">                newValue = scrollbar.getMaximum();</span>
            }
<span class="nc bnc" id="L952" title="All 4 branches missed.">            else if (delta &lt; 0 &amp;&amp; newValue &gt; oldValue) {</span>
<span class="nc" id="L953">                newValue = scrollbar.getMinimum();</span>
            }

<span class="nc" id="L956">            scrollbar.setValue(newValue);</span>
<span class="nc" id="L957">    }</span>

    protected void scrollByBlock(int direction)
    {
<span class="nc" id="L961">        scrollByBlock(scrollbar, direction);</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">            trackHighlight = direction &gt; 0 ? INCREASE_HIGHLIGHT : DECREASE_HIGHLIGHT;</span>
<span class="nc" id="L963">            Rectangle dirtyRect = getTrackBounds();</span>
<span class="nc" id="L964">            scrollbar.repaint(dirtyRect.x, dirtyRect.y, dirtyRect.width, dirtyRect.height);</span>
<span class="nc" id="L965">    }</span>

    /*
     * Method for scrolling by a unit increment.
     * Added for mouse wheel scrolling support, RFE 4202656.
     *
     * If limitByBlock is set to true, the scrollbar will scroll at least 1
     * unit increment, but will not scroll farther than the block increment.
     * See BasicScrollPaneUI.Handler.mouseWheelMoved().
     */
    static void scrollByUnits(JScrollBar scrollbar, int direction,
                              int units, boolean limitToBlock) {
        // This method is called from BasicScrollPaneUI to implement wheel
        // scrolling, as well as from scrollByUnit().
        int delta;
<span class="nc" id="L980">        int limit = -1;</span>

<span class="nc bnc" id="L982" title="All 2 branches missed.">        if (limitToBlock) {</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">            if (direction &lt; 0) {</span>
<span class="nc" id="L984">                limit = scrollbar.getValue() -</span>
<span class="nc" id="L985">                                         scrollbar.getBlockIncrement(direction);</span>
            }
            else {
<span class="nc" id="L988">                limit = scrollbar.getValue() +</span>
<span class="nc" id="L989">                                         scrollbar.getBlockIncrement(direction);</span>
            }
        }

<span class="nc bnc" id="L993" title="All 2 branches missed.">        for (int i=0; i&lt;units; i++) {</span>
<span class="nc bnc" id="L994" title="All 2 branches missed.">            if (direction &gt; 0) {</span>
<span class="nc" id="L995">                delta = scrollbar.getUnitIncrement(direction);</span>
            }
            else {
<span class="nc" id="L998">                delta = -scrollbar.getUnitIncrement(direction);</span>
            }

<span class="nc" id="L1001">            int oldValue = scrollbar.getValue();</span>
<span class="nc" id="L1002">            int newValue = oldValue + delta;</span>

            // Check for overflow.
<span class="nc bnc" id="L1005" title="All 4 branches missed.">            if (delta &gt; 0 &amp;&amp; newValue &lt; oldValue) {</span>
<span class="nc" id="L1006">                newValue = scrollbar.getMaximum();</span>
            }
<span class="nc bnc" id="L1008" title="All 4 branches missed.">            else if (delta &lt; 0 &amp;&amp; newValue &gt; oldValue) {</span>
<span class="nc" id="L1009">                newValue = scrollbar.getMinimum();</span>
            }
<span class="nc bnc" id="L1011" title="All 2 branches missed.">            if (oldValue == newValue) {</span>
<span class="nc" id="L1012">                break;</span>
            }

<span class="nc bnc" id="L1015" title="All 4 branches missed.">            if (limitToBlock &amp;&amp; i &gt; 0) {</span>
<span class="nc bnc" id="L1016" title="All 4 branches missed.">                assert limit != -1;</span>
<span class="nc bnc" id="L1017" title="All 8 branches missed.">                if ((direction &lt; 0 &amp;&amp; newValue &lt; limit) ||</span>
                    (direction &gt; 0 &amp;&amp; newValue &gt; limit)) {
<span class="nc" id="L1019">                    break;</span>
                }
            }
<span class="nc" id="L1022">            scrollbar.setValue(newValue);</span>
        }
<span class="nc" id="L1024">    }</span>

    protected void scrollByUnit(int direction)  {
<span class="nc" id="L1027">        scrollByUnits(scrollbar, direction, 1, false);</span>
<span class="nc" id="L1028">    }</span>

    /**
     * Indicates whether the user can absolutely position the thumb with
     * a mouse gesture (usually the middle mouse button).
     *
     * @return true if a mouse gesture can absolutely position the thumb
     * @since 1.5
     */
    public boolean getSupportsAbsolutePositioning() {
<span class="nc" id="L1038">        return supportsAbsolutePositioning;</span>
    }

    /**
     * A listener to listen for model changes.
     *
     */
<span class="nc" id="L1045">    protected class ModelListener implements ChangeListener {</span>
        public void stateChanged(ChangeEvent e) {
<span class="nc bnc" id="L1047" title="All 2 branches missed.">            if (!useCachedValue) {</span>
<span class="nc" id="L1048">                scrollBarValue = scrollbar.getValue();</span>
            }
<span class="nc" id="L1050">            layoutContainer(scrollbar);</span>
<span class="nc" id="L1051">            useCachedValue = false;</span>
<span class="nc" id="L1052">        }</span>
    }


    /**
     * Track mouse drags.
     */
<span class="nc" id="L1059">    protected class TrackListener</span>
        extends MouseAdapter implements MouseMotionListener
    {
        protected transient int offset;
        protected transient int currentMouseX, currentMouseY;
<span class="nc" id="L1064">        private transient int direction = +1;</span>

        public void mouseReleased(MouseEvent e)
        {
<span class="nc bnc" id="L1068" title="All 2 branches missed.">            if (isDragging) {</span>
<span class="nc" id="L1069">                updateThumbState(e.getX(), e.getY());</span>
            }
<span class="nc bnc" id="L1071" title="All 2 branches missed.">            if (SwingUtilities.isRightMouseButton(e) ||</span>
<span class="nc bnc" id="L1072" title="All 2 branches missed.">                (!getSupportsAbsolutePositioning() &amp;&amp;</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">                 SwingUtilities.isMiddleMouseButton(e)))</span>
<span class="nc" id="L1074">                return;</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">            if(!scrollbar.isEnabled())</span>
<span class="nc" id="L1076">                return;</span>

<span class="nc" id="L1078">            Rectangle r = getTrackBounds();</span>
<span class="nc" id="L1079">            scrollbar.repaint(r.x, r.y, r.width, r.height);</span>

<span class="nc" id="L1081">            trackHighlight = NO_HIGHLIGHT;</span>
<span class="nc" id="L1082">            isDragging = false;</span>
<span class="nc" id="L1083">            offset = 0;</span>
<span class="nc" id="L1084">            scrollTimer.stop();</span>
<span class="nc" id="L1085">            useCachedValue = true;</span>
<span class="nc" id="L1086">            scrollbar.setValueIsAdjusting(false);</span>
<span class="nc" id="L1087">        }</span>


        /**
         * If the mouse is pressed above the &quot;thumb&quot; component
         * then reduce the scrollbars value by one page (&quot;page up&quot;),
         * otherwise increase it by one page.  If there is no
         * thumb then page up if the mouse is in the upper half
         * of the track.
         */
        public void mousePressed(MouseEvent e)
        {
<span class="nc bnc" id="L1099" title="All 2 branches missed.">            if (SwingUtilities.isRightMouseButton(e) ||</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">                (!getSupportsAbsolutePositioning() &amp;&amp;</span>
<span class="nc bnc" id="L1101" title="All 2 branches missed.">                 SwingUtilities.isMiddleMouseButton(e)))</span>
<span class="nc" id="L1102">                return;</span>
<span class="nc bnc" id="L1103" title="All 2 branches missed.">            if(!scrollbar.isEnabled())</span>
<span class="nc" id="L1104">                return;</span>

<span class="nc bnc" id="L1106" title="All 4 branches missed.">            if (!scrollbar.hasFocus() &amp;&amp; scrollbar.isRequestFocusEnabled()) {</span>
<span class="nc" id="L1107">                scrollbar.requestFocus();</span>
            }

<span class="nc" id="L1110">            useCachedValue = true;</span>
<span class="nc" id="L1111">            scrollbar.setValueIsAdjusting(true);</span>

<span class="nc" id="L1113">            currentMouseX = e.getX();</span>
<span class="nc" id="L1114">            currentMouseY = e.getY();</span>

            // Clicked in the Thumb area?
<span class="nc bnc" id="L1117" title="All 2 branches missed.">            if(getThumbBounds().contains(currentMouseX, currentMouseY)) {</span>
<span class="nc bnc" id="L1118" title="All 3 branches missed.">                switch (scrollbar.getOrientation()) {</span>
                case JScrollBar.VERTICAL:
<span class="nc" id="L1120">                    offset = currentMouseY - getThumbBounds().y;</span>
<span class="nc" id="L1121">                    break;</span>
                case JScrollBar.HORIZONTAL:
<span class="nc" id="L1123">                    offset = currentMouseX - getThumbBounds().x;</span>
                    break;
                }
<span class="nc" id="L1126">                isDragging = true;</span>
<span class="nc" id="L1127">                return;</span>
            }
<span class="nc bnc" id="L1129" title="All 2 branches missed.">            else if (getSupportsAbsolutePositioning() &amp;&amp;</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">                     SwingUtilities.isMiddleMouseButton(e)) {</span>
<span class="nc bnc" id="L1131" title="All 3 branches missed.">                switch (scrollbar.getOrientation()) {</span>
                case JScrollBar.VERTICAL:
<span class="nc" id="L1133">                    offset = getThumbBounds().height / 2;</span>
<span class="nc" id="L1134">                    break;</span>
                case JScrollBar.HORIZONTAL:
<span class="nc" id="L1136">                    offset = getThumbBounds().width / 2;</span>
                    break;
                }
<span class="nc" id="L1139">                isDragging = true;</span>
<span class="nc" id="L1140">                setValueFrom(e);</span>
<span class="nc" id="L1141">                return;</span>
            }
<span class="nc" id="L1143">            isDragging = false;</span>

<span class="nc" id="L1145">            Dimension sbSize = scrollbar.getSize();</span>
<span class="nc" id="L1146">            direction = +1;</span>

<span class="nc bnc" id="L1148" title="All 3 branches missed.">            switch (scrollbar.getOrientation()) {</span>
            case JScrollBar.VERTICAL:
<span class="nc bnc" id="L1150" title="All 2 branches missed.">                if (getThumbBounds().isEmpty()) {</span>
<span class="nc" id="L1151">                    int scrollbarCenter = sbSize.height / 2;</span>
<span class="nc bnc" id="L1152" title="All 2 branches missed.">                    direction = (currentMouseY &lt; scrollbarCenter) ? -1 : +1;</span>
<span class="nc" id="L1153">                } else {</span>
<span class="nc" id="L1154">                    int thumbY = getThumbBounds().y;</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">                    direction = (currentMouseY &lt; thumbY) ? -1 : +1;</span>
                }
<span class="nc" id="L1157">                break;</span>
            case JScrollBar.HORIZONTAL:
<span class="nc bnc" id="L1159" title="All 2 branches missed.">                if (getThumbBounds().isEmpty()) {</span>
<span class="nc" id="L1160">                    int scrollbarCenter = sbSize.width / 2;</span>
<span class="nc bnc" id="L1161" title="All 2 branches missed.">                    direction = (currentMouseX &lt; scrollbarCenter) ? -1 : +1;</span>
<span class="nc" id="L1162">                } else {</span>
<span class="nc" id="L1163">                    int thumbX = getThumbBounds().x;</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">                    direction = (currentMouseX &lt; thumbX) ? -1 : +1;</span>
                }
<span class="nc bnc" id="L1166" title="All 2 branches missed.">                if (!scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1167">                    direction = -direction;</span>
                }
                break;
            }
<span class="nc" id="L1171">            scrollByBlock(direction);</span>

<span class="nc" id="L1173">            scrollTimer.stop();</span>
<span class="nc" id="L1174">            scrollListener.setDirection(direction);</span>
<span class="nc" id="L1175">            scrollListener.setScrollByBlock(true);</span>
<span class="nc" id="L1176">            startScrollTimerIfNecessary();</span>
<span class="nc" id="L1177">        }</span>


        /**
         * Set the models value to the position of the thumb's top of Vertical
         * scrollbar, or the left/right of Horizontal scrollbar in
         * left-to-right/right-to-left scrollbar relative to the origin of the
         * track.
         */
        public void mouseDragged(MouseEvent e) {
<span class="nc bnc" id="L1187" title="All 2 branches missed.">            if (SwingUtilities.isRightMouseButton(e) ||</span>
<span class="nc bnc" id="L1188" title="All 2 branches missed.">                (!getSupportsAbsolutePositioning() &amp;&amp;</span>
<span class="nc bnc" id="L1189" title="All 2 branches missed.">                 SwingUtilities.isMiddleMouseButton(e)))</span>
<span class="nc" id="L1190">                return;</span>
<span class="nc bnc" id="L1191" title="All 4 branches missed.">            if(!scrollbar.isEnabled() || getThumbBounds().isEmpty()) {</span>
<span class="nc" id="L1192">                return;</span>
            }
<span class="nc bnc" id="L1194" title="All 2 branches missed.">            if (isDragging) {</span>
<span class="nc" id="L1195">                setValueFrom(e);</span>
            } else {
<span class="nc" id="L1197">                currentMouseX = e.getX();</span>
<span class="nc" id="L1198">                currentMouseY = e.getY();</span>
<span class="nc" id="L1199">                updateThumbState(currentMouseX, currentMouseY);</span>
<span class="nc" id="L1200">                startScrollTimerIfNecessary();</span>
            }
<span class="nc" id="L1202">        }</span>

        private void setValueFrom(MouseEvent e) {
<span class="nc" id="L1205">            boolean active = isThumbRollover();</span>
<span class="nc" id="L1206">            BoundedRangeModel model = scrollbar.getModel();</span>
<span class="nc" id="L1207">            Rectangle thumbR = getThumbBounds();</span>
            float trackLength;
            int thumbMin, thumbMax, thumbPos;

<span class="nc bnc" id="L1211" title="All 2 branches missed.">            if (scrollbar.getOrientation() == JScrollBar.VERTICAL) {</span>
<span class="nc" id="L1212">                thumbMin = trackRect.y;</span>
<span class="nc" id="L1213">                thumbMax = trackRect.y + trackRect.height - thumbR.height;</span>
<span class="nc" id="L1214">                thumbPos = Math.min(thumbMax, Math.max(thumbMin, (e.getY() - offset)));</span>
<span class="nc" id="L1215">                setThumbBounds(thumbR.x, thumbPos, thumbR.width, thumbR.height);</span>
<span class="nc" id="L1216">                trackLength = getTrackBounds().height;</span>
            }
            else {
<span class="nc" id="L1219">                thumbMin = trackRect.x;</span>
<span class="nc" id="L1220">                thumbMax = trackRect.x + trackRect.width - thumbR.width;</span>
<span class="nc" id="L1221">                thumbPos = Math.min(thumbMax, Math.max(thumbMin, (e.getX() - offset)));</span>
<span class="nc" id="L1222">                setThumbBounds(thumbPos, thumbR.y, thumbR.width, thumbR.height);</span>
<span class="nc" id="L1223">                trackLength = getTrackBounds().width;</span>
            }

            /* Set the scrollbars value.  If the thumb has reached the end of
             * the scrollbar, then just set the value to its maximum.  Otherwise
             * compute the value as accurately as possible.
             */
<span class="nc bnc" id="L1230" title="All 2 branches missed.">            if (thumbPos == thumbMax) {</span>
<span class="nc bnc" id="L1231" title="All 2 branches missed.">                if (scrollbar.getOrientation() == JScrollBar.VERTICAL ||</span>
<span class="nc bnc" id="L1232" title="All 2 branches missed.">                    scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1233">                    scrollbar.setValue(model.getMaximum() - model.getExtent());</span>
                } else {
<span class="nc" id="L1235">                    scrollbar.setValue(model.getMinimum());</span>
                }
            }
            else {
<span class="nc" id="L1239">                float valueMax = model.getMaximum() - model.getExtent();</span>
<span class="nc" id="L1240">                float valueRange = valueMax - model.getMinimum();</span>
<span class="nc" id="L1241">                float thumbValue = thumbPos - thumbMin;</span>
<span class="nc" id="L1242">                float thumbRange = thumbMax - thumbMin;</span>
                int value;
<span class="nc bnc" id="L1244" title="All 2 branches missed.">                if (scrollbar.getOrientation() == JScrollBar.VERTICAL ||</span>
<span class="nc bnc" id="L1245" title="All 2 branches missed.">                    scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1246">                    value = (int)(0.5 + ((thumbValue / thumbRange) * valueRange));</span>
                } else {
<span class="nc" id="L1248">                    value = (int)(0.5 + (((thumbMax - thumbPos) / thumbRange) * valueRange));</span>
                }

<span class="nc" id="L1251">                useCachedValue = true;</span>
<span class="nc" id="L1252">                scrollBarValue = value + model.getMinimum();</span>
<span class="nc" id="L1253">                scrollbar.setValue(adjustValueIfNecessary(scrollBarValue));</span>
            }
<span class="nc" id="L1255">            setThumbRollover(active);</span>
<span class="nc" id="L1256">        }</span>

        private int adjustValueIfNecessary(int value) {
<span class="nc bnc" id="L1259" title="All 2 branches missed.">            if (scrollbar.getParent() instanceof JScrollPane) {</span>
<span class="nc" id="L1260">                JScrollPane scrollpane = (JScrollPane)scrollbar.getParent();</span>
<span class="nc" id="L1261">                JViewport viewport = scrollpane.getViewport();</span>
<span class="nc" id="L1262">                Component view = viewport.getView();</span>
<span class="nc bnc" id="L1263" title="All 2 branches missed.">                if (view instanceof JList) {</span>
<span class="nc" id="L1264">                    JList list = (JList)view;</span>
<span class="nc bnc" id="L1265" title="All 2 branches missed.">                    if (DefaultLookup.getBoolean(list, list.getUI(),</span>
                                                 &quot;List.lockToPositionOnScroll&quot;, false)) {
<span class="nc" id="L1267">                        int adjustedValue = value;</span>
<span class="nc" id="L1268">                        int mode = list.getLayoutOrientation();</span>
<span class="nc" id="L1269">                        int orientation = scrollbar.getOrientation();</span>
<span class="nc bnc" id="L1270" title="All 4 branches missed.">                        if (orientation == JScrollBar.VERTICAL &amp;&amp; mode == JList.VERTICAL) {</span>
<span class="nc" id="L1271">                            int index = list.locationToIndex(new Point(0, value));</span>
<span class="nc" id="L1272">                            Rectangle rect = list.getCellBounds(index, index);</span>
<span class="nc bnc" id="L1273" title="All 2 branches missed.">                            if (rect != null) {</span>
<span class="nc" id="L1274">                                adjustedValue = rect.y;</span>
                            }
                        }
<span class="nc bnc" id="L1277" title="All 6 branches missed.">                        if (orientation == JScrollBar.HORIZONTAL &amp;&amp;</span>
                            (mode == JList.VERTICAL_WRAP || mode == JList.HORIZONTAL_WRAP)) {
<span class="nc bnc" id="L1279" title="All 2 branches missed.">                            if (scrollpane.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L1280">                                int index = list.locationToIndex(new Point(value, 0));</span>
<span class="nc" id="L1281">                                Rectangle rect = list.getCellBounds(index, index);</span>
<span class="nc bnc" id="L1282" title="All 2 branches missed.">                                if (rect != null) {</span>
<span class="nc" id="L1283">                                    adjustedValue = rect.x;</span>
                                }
<span class="nc" id="L1285">                            }</span>
                            else {
<span class="nc" id="L1287">                                Point loc = new Point(value, 0);</span>
<span class="nc" id="L1288">                                int extent = viewport.getExtentSize().width;</span>
<span class="nc" id="L1289">                                loc.x += extent - 1;</span>
<span class="nc" id="L1290">                                int index = list.locationToIndex(loc);</span>
<span class="nc" id="L1291">                                Rectangle rect = list.getCellBounds(index, index);</span>
<span class="nc bnc" id="L1292" title="All 2 branches missed.">                                if (rect != null) {</span>
<span class="nc" id="L1293">                                    adjustedValue = rect.x + rect.width - extent;</span>
                                }
                            }
                        }
<span class="nc" id="L1297">                        value = adjustedValue;</span>

                    }
                }
            }
<span class="nc" id="L1302">            return value;</span>
        }

        private void startScrollTimerIfNecessary() {
<span class="nc bnc" id="L1306" title="All 2 branches missed.">            if (scrollTimer.isRunning()) {</span>
<span class="nc" id="L1307">                return;</span>
            }

<span class="nc" id="L1310">            Rectangle tb = getThumbBounds();</span>

<span class="nc bnc" id="L1312" title="All 3 branches missed.">            switch (scrollbar.getOrientation()) {</span>
            case JScrollBar.VERTICAL:
<span class="nc bnc" id="L1314" title="All 2 branches missed.">                if (direction &gt; 0) {</span>
<span class="nc bnc" id="L1315" title="All 2 branches missed.">                    if (tb.y + tb.height &lt; trackListener.currentMouseY) {</span>
<span class="nc" id="L1316">                        scrollTimer.start();</span>
                    }
<span class="nc bnc" id="L1318" title="All 2 branches missed.">                } else if (tb.y &gt; trackListener.currentMouseY) {</span>
<span class="nc" id="L1319">                    scrollTimer.start();</span>
                }
                break;
            case JScrollBar.HORIZONTAL:
<span class="nc bnc" id="L1323" title="All 6 branches missed.">                if ((direction &gt; 0 &amp;&amp; isMouseAfterThumb())</span>
<span class="nc bnc" id="L1324" title="All 2 branches missed.">                        || (direction &lt; 0 &amp;&amp; isMouseBeforeThumb())) {</span>

<span class="nc" id="L1326">                    scrollTimer.start();</span>
                }
                break;
            }
<span class="nc" id="L1330">        }</span>

        public void mouseMoved(MouseEvent e) {
<span class="nc bnc" id="L1333" title="All 2 branches missed.">            if (!isDragging) {</span>
<span class="nc" id="L1334">                updateThumbState(e.getX(), e.getY());</span>
            }
<span class="nc" id="L1336">        }</span>

        /**
         * Invoked when the mouse exits the scrollbar.
         *
         * @param e MouseEvent further describing the event
         * @since 1.5
         */
        public void mouseExited(MouseEvent e) {
<span class="nc bnc" id="L1345" title="All 2 branches missed.">            if (!isDragging) {</span>
<span class="nc" id="L1346">                setThumbRollover(false);</span>
            }
<span class="nc" id="L1348">        }</span>
    }


    /**
     * Listener for cursor keys.
     */
<span class="nc" id="L1355">    protected class ArrowButtonListener extends MouseAdapter</span>
    {
        // Because we are handling both mousePressed and Actions
        // we need to make sure we don't fire under both conditions.
        // (keyfocus on scrollbars causes action without mousePress
        boolean handledEvent;

        public void mousePressed(MouseEvent e)          {
<span class="nc bnc" id="L1363" title="All 2 branches missed.">            if(!scrollbar.isEnabled()) { return; }</span>
            // not an unmodified left mouse button
            //if(e.getModifiers() != InputEvent.BUTTON1_MASK) {return; }
<span class="nc bnc" id="L1366" title="All 2 branches missed.">            if( ! SwingUtilities.isLeftMouseButton(e)) { return; }</span>

<span class="nc bnc" id="L1368" title="All 2 branches missed.">            int direction = (e.getSource() == incrButton) ? 1 : -1;</span>

<span class="nc" id="L1370">            scrollByUnit(direction);</span>
<span class="nc" id="L1371">            scrollTimer.stop();</span>
<span class="nc" id="L1372">            scrollListener.setDirection(direction);</span>
<span class="nc" id="L1373">            scrollListener.setScrollByBlock(false);</span>
<span class="nc" id="L1374">            scrollTimer.start();</span>

<span class="nc" id="L1376">            handledEvent = true;</span>
<span class="nc bnc" id="L1377" title="All 4 branches missed.">            if (!scrollbar.hasFocus() &amp;&amp; scrollbar.isRequestFocusEnabled()) {</span>
<span class="nc" id="L1378">                scrollbar.requestFocus();</span>
            }
<span class="nc" id="L1380">        }</span>

        public void mouseReleased(MouseEvent e)         {
<span class="nc" id="L1383">            scrollTimer.stop();</span>
<span class="nc" id="L1384">            handledEvent = false;</span>
<span class="nc" id="L1385">            scrollbar.setValueIsAdjusting(false);</span>
<span class="nc" id="L1386">        }</span>
    }


    /**
     * Listener for scrolling events initiated in the
     * &lt;code&gt;ScrollPane&lt;/code&gt;.
     */
    protected class ScrollListener implements ActionListener
    {
<span class="nc" id="L1396">        int direction = +1;</span>
        boolean useBlockIncrement;

<span class="nc" id="L1399">        public ScrollListener() {</span>
<span class="nc" id="L1400">            direction = +1;</span>
<span class="nc" id="L1401">            useBlockIncrement = false;</span>
<span class="nc" id="L1402">        }</span>

<span class="nc" id="L1404">        public ScrollListener(int dir, boolean block)   {</span>
<span class="nc" id="L1405">            direction = dir;</span>
<span class="nc" id="L1406">            useBlockIncrement = block;</span>
<span class="nc" id="L1407">        }</span>

<span class="nc" id="L1409">        public void setDirection(int direction) { this.direction = direction; }</span>
<span class="nc" id="L1410">        public void setScrollByBlock(boolean block) { this.useBlockIncrement = block; }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L1413" title="All 2 branches missed.">            if(useBlockIncrement)       {</span>
<span class="nc" id="L1414">                scrollByBlock(direction);</span>
                // Stop scrolling if the thumb catches up with the mouse
<span class="nc bnc" id="L1416" title="All 2 branches missed.">                if(scrollbar.getOrientation() == JScrollBar.VERTICAL)   {</span>
<span class="nc bnc" id="L1417" title="All 2 branches missed.">                    if(direction &gt; 0)   {</span>
<span class="nc bnc" id="L1418" title="All 2 branches missed.">                        if(getThumbBounds().y + getThumbBounds().height</span>
                                &gt;= trackListener.currentMouseY)
<span class="nc" id="L1420">                                    ((Timer)e.getSource()).stop();</span>
<span class="nc bnc" id="L1421" title="All 2 branches missed.">                    } else if(getThumbBounds().y &lt;= trackListener.currentMouseY)        {</span>
<span class="nc" id="L1422">                        ((Timer)e.getSource()).stop();</span>
                    }
                } else {
<span class="nc bnc" id="L1425" title="All 6 branches missed.">                    if ((direction &gt; 0 &amp;&amp; !isMouseAfterThumb())</span>
<span class="nc bnc" id="L1426" title="All 2 branches missed.">                           || (direction &lt; 0 &amp;&amp; !isMouseBeforeThumb())) {</span>

<span class="nc" id="L1428">                       ((Timer)e.getSource()).stop();</span>
                    }
                }
            } else {
<span class="nc" id="L1432">                scrollByUnit(direction);</span>
            }

<span class="nc bnc" id="L1435" title="All 2 branches missed.">            if(direction &gt; 0</span>
<span class="nc" id="L1436">                &amp;&amp; scrollbar.getValue()+scrollbar.getVisibleAmount()</span>
<span class="nc bnc" id="L1437" title="All 2 branches missed.">                        &gt;= scrollbar.getMaximum())</span>
<span class="nc" id="L1438">                ((Timer)e.getSource()).stop();</span>
<span class="nc bnc" id="L1439" title="All 2 branches missed.">            else if(direction &lt; 0</span>
<span class="nc bnc" id="L1440" title="All 2 branches missed.">                &amp;&amp; scrollbar.getValue() &lt;= scrollbar.getMinimum())</span>
<span class="nc" id="L1441">                ((Timer)e.getSource()).stop();</span>
<span class="nc" id="L1442">        }</span>
    }

    private boolean isMouseLeftOfThumb() {
<span class="nc bnc" id="L1446" title="All 2 branches missed.">        return trackListener.currentMouseX &lt; getThumbBounds().x;</span>
    }

    private boolean isMouseRightOfThumb() {
<span class="nc" id="L1450">        Rectangle tb = getThumbBounds();</span>
<span class="nc bnc" id="L1451" title="All 2 branches missed.">        return trackListener.currentMouseX &gt; tb.x + tb.width;</span>
    }

    private boolean isMouseBeforeThumb() {
<span class="nc bnc" id="L1455" title="All 2 branches missed.">        return scrollbar.getComponentOrientation().isLeftToRight()</span>
<span class="nc" id="L1456">            ? isMouseLeftOfThumb()</span>
<span class="nc" id="L1457">            : isMouseRightOfThumb();</span>
    }

    private boolean isMouseAfterThumb() {
<span class="nc bnc" id="L1461" title="All 2 branches missed.">        return scrollbar.getComponentOrientation().isLeftToRight()</span>
<span class="nc" id="L1462">            ? isMouseRightOfThumb()</span>
<span class="nc" id="L1463">            : isMouseLeftOfThumb();</span>
    }

    private void updateButtonDirections() {
<span class="nc" id="L1467">        int orient = scrollbar.getOrientation();</span>
<span class="nc bnc" id="L1468" title="All 2 branches missed.">        if (scrollbar.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc bnc" id="L1469" title="All 2 branches missed.">            if (incrButton instanceof BasicArrowButton) {</span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">                ((BasicArrowButton)incrButton).setDirection(</span>
                        orient == HORIZONTAL? EAST : SOUTH);
            }
<span class="nc bnc" id="L1473" title="All 2 branches missed.">            if (decrButton instanceof BasicArrowButton) {</span>
<span class="nc bnc" id="L1474" title="All 2 branches missed.">                ((BasicArrowButton)decrButton).setDirection(</span>
                        orient == HORIZONTAL? WEST : NORTH);
            }
        }
        else {
<span class="nc bnc" id="L1479" title="All 2 branches missed.">            if (incrButton instanceof BasicArrowButton) {</span>
<span class="nc bnc" id="L1480" title="All 2 branches missed.">                ((BasicArrowButton)incrButton).setDirection(</span>
                        orient == HORIZONTAL? WEST : SOUTH);
            }
<span class="nc bnc" id="L1483" title="All 2 branches missed.">            if (decrButton instanceof BasicArrowButton) {</span>
<span class="nc bnc" id="L1484" title="All 2 branches missed.">                ((BasicArrowButton)decrButton).setDirection(</span>
                        orient == HORIZONTAL ? EAST : NORTH);
            }
        }
<span class="nc" id="L1488">    }</span>

<span class="nc" id="L1490">    public class PropertyChangeHandler implements PropertyChangeListener</span>
    {
        // NOTE: This class exists only for backward compatibility. All
        // its functionality has been moved into Handler. If you need to add
        // new functionality add it to the Handler, but make sure this
        // class calls into the Handler.

        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L1498">            getHandler().propertyChange(e);</span>
<span class="nc" id="L1499">        }</span>
    }


    /**
     * Used for scrolling the scrollbar.
     */
    private static class Actions extends UIAction {
        private static final String POSITIVE_UNIT_INCREMENT =
                                    &quot;positiveUnitIncrement&quot;;
        private static final String POSITIVE_BLOCK_INCREMENT =
                                    &quot;positiveBlockIncrement&quot;;
        private static final String NEGATIVE_UNIT_INCREMENT =
                                    &quot;negativeUnitIncrement&quot;;
        private static final String NEGATIVE_BLOCK_INCREMENT =
                                    &quot;negativeBlockIncrement&quot;;
        private static final String MIN_SCROLL = &quot;minScroll&quot;;
        private static final String MAX_SCROLL = &quot;maxScroll&quot;;

        Actions(String name) {
<span class="nc" id="L1519">            super(name);</span>
<span class="nc" id="L1520">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1523">            JScrollBar scrollBar = (JScrollBar)e.getSource();</span>
<span class="nc" id="L1524">            String key = getName();</span>
<span class="nc bnc" id="L1525" title="All 2 branches missed.">            if (key == POSITIVE_UNIT_INCREMENT) {</span>
<span class="nc" id="L1526">                scroll(scrollBar, POSITIVE_SCROLL, false);</span>
            }
<span class="nc bnc" id="L1528" title="All 2 branches missed.">            else if (key == POSITIVE_BLOCK_INCREMENT) {</span>
<span class="nc" id="L1529">                scroll(scrollBar, POSITIVE_SCROLL, true);</span>
            }
<span class="nc bnc" id="L1531" title="All 2 branches missed.">            else if (key == NEGATIVE_UNIT_INCREMENT) {</span>
<span class="nc" id="L1532">                scroll(scrollBar, NEGATIVE_SCROLL, false);</span>
            }
<span class="nc bnc" id="L1534" title="All 2 branches missed.">            else if (key == NEGATIVE_BLOCK_INCREMENT) {</span>
<span class="nc" id="L1535">                scroll(scrollBar, NEGATIVE_SCROLL, true);</span>
            }
<span class="nc bnc" id="L1537" title="All 2 branches missed.">            else if (key == MIN_SCROLL) {</span>
<span class="nc" id="L1538">                scroll(scrollBar, BasicScrollBarUI.MIN_SCROLL, true);</span>
            }
<span class="nc bnc" id="L1540" title="All 2 branches missed.">            else if (key == MAX_SCROLL) {</span>
<span class="nc" id="L1541">                scroll(scrollBar, BasicScrollBarUI.MAX_SCROLL, true);</span>
            }
<span class="nc" id="L1543">        }</span>
        private void scroll(JScrollBar scrollBar, int dir, boolean block) {

<span class="nc bnc" id="L1546" title="All 4 branches missed.">            if (dir == NEGATIVE_SCROLL || dir == POSITIVE_SCROLL) {</span>
                int amount;
                // Don't use the BasicScrollBarUI.scrollByXXX methods as we
                // don't want to use an invokeLater to reset the trackHighlight
                // via an invokeLater
<span class="nc bnc" id="L1551" title="All 2 branches missed.">                if (block) {</span>
<span class="nc bnc" id="L1552" title="All 2 branches missed.">                    if (dir == NEGATIVE_SCROLL) {</span>
<span class="nc" id="L1553">                        amount = -1 * scrollBar.getBlockIncrement(-1);</span>
                    }
                    else {
<span class="nc" id="L1556">                        amount = scrollBar.getBlockIncrement(1);</span>
                    }
                }
                else {
<span class="nc bnc" id="L1560" title="All 2 branches missed.">                    if (dir == NEGATIVE_SCROLL) {</span>
<span class="nc" id="L1561">                        amount = -1 * scrollBar.getUnitIncrement(-1);</span>
                    }
                    else {
<span class="nc" id="L1564">                        amount = scrollBar.getUnitIncrement(1);</span>
                    }
                }
<span class="nc" id="L1567">                scrollBar.setValue(scrollBar.getValue() + amount);</span>
<span class="nc" id="L1568">            }</span>
<span class="nc bnc" id="L1569" title="All 2 branches missed.">            else if (dir == BasicScrollBarUI.MIN_SCROLL) {</span>
<span class="nc" id="L1570">                scrollBar.setValue(scrollBar.getMinimum());</span>
            }
<span class="nc bnc" id="L1572" title="All 2 branches missed.">            else if (dir == BasicScrollBarUI.MAX_SCROLL) {</span>
<span class="nc" id="L1573">                scrollBar.setValue(scrollBar.getMaximum());</span>
            }
<span class="nc" id="L1575">        }</span>
    }


    //
    // EventHandler
    //
<span class="nc" id="L1582">    private class Handler implements FocusListener, PropertyChangeListener {</span>
        //
        // FocusListener
        //
        public void focusGained(FocusEvent e) {
<span class="nc" id="L1587">            scrollbar.repaint();</span>
<span class="nc" id="L1588">        }</span>

        public void focusLost(FocusEvent e) {
<span class="nc" id="L1591">            scrollbar.repaint();</span>
<span class="nc" id="L1592">        }</span>


        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L1599">            String propertyName = e.getPropertyName();</span>

<span class="nc bnc" id="L1601" title="All 2 branches missed.">            if (&quot;model&quot; == propertyName) {</span>
<span class="nc" id="L1602">                BoundedRangeModel oldModel = (BoundedRangeModel)e.getOldValue();</span>
<span class="nc" id="L1603">                BoundedRangeModel newModel = (BoundedRangeModel)e.getNewValue();</span>
<span class="nc" id="L1604">                oldModel.removeChangeListener(modelListener);</span>
<span class="nc" id="L1605">                newModel.addChangeListener(modelListener);</span>
<span class="nc" id="L1606">                scrollBarValue = scrollbar.getValue();</span>
<span class="nc" id="L1607">                scrollbar.repaint();</span>
<span class="nc" id="L1608">                scrollbar.revalidate();</span>
<span class="nc bnc" id="L1609" title="All 2 branches missed.">            } else if (&quot;orientation&quot; == propertyName) {</span>
<span class="nc" id="L1610">                updateButtonDirections();</span>
<span class="nc bnc" id="L1611" title="All 2 branches missed.">            } else if (&quot;componentOrientation&quot; == propertyName) {</span>
<span class="nc" id="L1612">                updateButtonDirections();</span>
<span class="nc" id="L1613">                InputMap inputMap = getInputMap(JComponent.WHEN_FOCUSED);</span>
<span class="nc" id="L1614">                SwingUtilities.replaceUIInputMap(scrollbar, JComponent.WHEN_FOCUSED, inputMap);</span>
            }
<span class="nc" id="L1616">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>