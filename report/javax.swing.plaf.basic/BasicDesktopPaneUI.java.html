<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BasicDesktopPaneUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicDesktopPaneUI.java</span></div><h1>BasicDesktopPaneUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import javax.swing.*;
import javax.swing.plaf.*;

import java.beans.*;

import java.awt.event.*;
import java.awt.Dimension;
import java.awt.Insets;
import java.awt.Graphics;
import java.awt.KeyboardFocusManager;
import java.awt.*;
import java.util.Vector;
import sun.swing.DefaultLookup;
import sun.swing.UIAction;
import sun.awt.AppContext;

/**
 * Basic L&amp;amp;F for a desktop.
 *
 * @author Steve Wilson
 */
public class BasicDesktopPaneUI extends DesktopPaneUI {
    // Old actions forward to an instance of this.
<span class="nc" id="L51">    private static final Actions SHARED_ACTION = new Actions();</span>
<span class="nc" id="L52">    private static Dimension minSize = new Dimension(0,0);</span>
<span class="nc" id="L53">    private static Dimension maxSize = new Dimension(Integer.MAX_VALUE,</span>
            Integer.MAX_VALUE);
    private Handler handler;
    private PropertyChangeListener pcl;

    protected JDesktopPane desktop;
    protected DesktopManager desktopManager;

    /**
     * As of Java 2 platform v1.3 this previously undocumented field is no
     * longer used.
     * Key bindings are now defined by the LookAndFeel, please refer to
     * the key bindings specification for further details.
     *
     * @deprecated As of 1.3.
     */
    @Deprecated
    protected KeyStroke minimizeKey;
    /**
     * As of Java 2 platform v1.3 this previously undocumented field is no
     * longer used.
     * Key bindings are now defined by the LookAndFeel, please refer to
     * the key bindings specification for further details.
     *
     * @deprecated As of 1.3.
     */
    @Deprecated
    protected KeyStroke maximizeKey;
    /**
     * As of Java 2 platform v1.3 this previously undocumented field is no
     * longer used.
     * Key bindings are now defined by the LookAndFeel, please refer to
     * the key bindings specification for further details.
     *
     * @deprecated As of 1.3.
     */
    @Deprecated
    protected KeyStroke closeKey;
    /**
     * As of Java 2 platform v1.3 this previously undocumented field is no
     * longer used.
     * Key bindings are now defined by the LookAndFeel, please refer to
     * the key bindings specification for further details.
     *
     * @deprecated As of 1.3.
     */
    @Deprecated
    protected KeyStroke navigateKey;
    /**
     * As of Java 2 platform v1.3 this previously undocumented field is no
     * longer used.
     * Key bindings are now defined by the LookAndFeel, please refer to
     * the key bindings specification for further details.
     *
     * @deprecated As of 1.3.
     */
    @Deprecated
    protected KeyStroke navigateKey2;

    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L113">        return new BasicDesktopPaneUI();</span>
    }

<span class="nc" id="L116">    public BasicDesktopPaneUI() {</span>
<span class="nc" id="L117">    }</span>

    public void installUI(JComponent c)   {
<span class="nc" id="L120">        desktop = (JDesktopPane)c;</span>
<span class="nc" id="L121">        installDefaults();</span>
<span class="nc" id="L122">        installDesktopManager();</span>
<span class="nc" id="L123">        installListeners();</span>
<span class="nc" id="L124">        installKeyboardActions();</span>
<span class="nc" id="L125">    }</span>

    public void uninstallUI(JComponent c) {
<span class="nc" id="L128">        uninstallKeyboardActions();</span>
<span class="nc" id="L129">        uninstallListeners();</span>
<span class="nc" id="L130">        uninstallDesktopManager();</span>
<span class="nc" id="L131">        uninstallDefaults();</span>
<span class="nc" id="L132">        desktop = null;</span>
<span class="nc" id="L133">        handler = null;</span>
<span class="nc" id="L134">    }</span>

    protected void installDefaults() {
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (desktop.getBackground() == null ||</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            desktop.getBackground() instanceof UIResource) {</span>
<span class="nc" id="L139">            desktop.setBackground(UIManager.getColor(&quot;Desktop.background&quot;));</span>
        }
<span class="nc" id="L141">        LookAndFeel.installProperty(desktop, &quot;opaque&quot;, Boolean.TRUE);</span>
<span class="nc" id="L142">    }</span>

<span class="nc" id="L144">    protected void uninstallDefaults() { }</span>

    /**
     * Installs the &lt;code&gt;PropertyChangeListener&lt;/code&gt; returned from
     * &lt;code&gt;createPropertyChangeListener&lt;/code&gt; on the
     * &lt;code&gt;JDesktopPane&lt;/code&gt;.
     *
     * @since 1.5
     * @see #createPropertyChangeListener
     */
    protected void installListeners() {
<span class="nc" id="L155">        pcl = createPropertyChangeListener();</span>
<span class="nc" id="L156">        desktop.addPropertyChangeListener(pcl);</span>
<span class="nc" id="L157">    }</span>

    /**
     * Uninstalls the &lt;code&gt;PropertyChangeListener&lt;/code&gt; returned from
     * &lt;code&gt;createPropertyChangeListener&lt;/code&gt; from the
     * &lt;code&gt;JDesktopPane&lt;/code&gt;.
     *
     * @since 1.5
     * @see #createPropertyChangeListener
     */
    protected void uninstallListeners() {
<span class="nc" id="L168">        desktop.removePropertyChangeListener(pcl);</span>
<span class="nc" id="L169">        pcl = null;</span>
<span class="nc" id="L170">    }</span>

    protected void installDesktopManager() {
<span class="nc" id="L173">        desktopManager = desktop.getDesktopManager();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if(desktopManager == null) {</span>
<span class="nc" id="L175">            desktopManager = new BasicDesktopManager();</span>
<span class="nc" id="L176">            desktop.setDesktopManager(desktopManager);</span>
        }
<span class="nc" id="L178">    }</span>

    protected void uninstallDesktopManager() {
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if(desktop.getDesktopManager() instanceof UIResource) {</span>
<span class="nc" id="L182">            desktop.setDesktopManager(null);</span>
        }
<span class="nc" id="L184">        desktopManager = null;</span>
<span class="nc" id="L185">    }</span>

    protected void installKeyboardActions(){
<span class="nc" id="L188">        InputMap inputMap = getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">        if (inputMap != null) {</span>
<span class="nc" id="L190">            SwingUtilities.replaceUIInputMap(desktop,</span>
                        JComponent.WHEN_IN_FOCUSED_WINDOW, inputMap);
        }
<span class="nc" id="L193">        inputMap = getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">        if (inputMap != null) {</span>
<span class="nc" id="L195">            SwingUtilities.replaceUIInputMap(desktop,</span>
                        JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT,
                        inputMap);
        }

<span class="nc" id="L200">        LazyActionMap.installLazyActionMap(desktop, BasicDesktopPaneUI.class,</span>
                &quot;DesktopPane.actionMap&quot;);
<span class="nc" id="L202">        registerKeyboardActions();</span>
<span class="nc" id="L203">    }</span>

    protected void registerKeyboardActions(){
<span class="nc" id="L206">    }</span>

    protected void unregisterKeyboardActions(){
<span class="nc" id="L209">    }</span>

    InputMap getInputMap(int condition) {
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (condition == JComponent.WHEN_IN_FOCUSED_WINDOW) {</span>
<span class="nc" id="L213">            return createInputMap(condition);</span>
        }
<span class="nc bnc" id="L215" title="All 2 branches missed.">        else if (condition == JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT) {</span>
<span class="nc" id="L216">            return (InputMap)DefaultLookup.get(desktop, this,</span>
                    &quot;Desktop.ancestorInputMap&quot;);
        }
<span class="nc" id="L219">        return null;</span>
    }

    InputMap createInputMap(int condition) {
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (condition == JComponent.WHEN_IN_FOCUSED_WINDOW) {</span>
<span class="nc" id="L224">            Object[] bindings = (Object[])DefaultLookup.get(desktop,</span>
                    this, &quot;Desktop.windowBindings&quot;);

<span class="nc bnc" id="L227" title="All 2 branches missed.">            if (bindings != null) {</span>
<span class="nc" id="L228">                return LookAndFeel.makeComponentInputMap(desktop, bindings);</span>
            }
        }
<span class="nc" id="L231">        return null;</span>
    }

    static void loadActionMap(LazyActionMap map) {
<span class="nc" id="L235">        map.put(new Actions(Actions.RESTORE));</span>
<span class="nc" id="L236">        map.put(new Actions(Actions.CLOSE));</span>
<span class="nc" id="L237">        map.put(new Actions(Actions.MOVE));</span>
<span class="nc" id="L238">        map.put(new Actions(Actions.RESIZE));</span>
<span class="nc" id="L239">        map.put(new Actions(Actions.LEFT));</span>
<span class="nc" id="L240">        map.put(new Actions(Actions.SHRINK_LEFT));</span>
<span class="nc" id="L241">        map.put(new Actions(Actions.RIGHT));</span>
<span class="nc" id="L242">        map.put(new Actions(Actions.SHRINK_RIGHT));</span>
<span class="nc" id="L243">        map.put(new Actions(Actions.UP));</span>
<span class="nc" id="L244">        map.put(new Actions(Actions.SHRINK_UP));</span>
<span class="nc" id="L245">        map.put(new Actions(Actions.DOWN));</span>
<span class="nc" id="L246">        map.put(new Actions(Actions.SHRINK_DOWN));</span>
<span class="nc" id="L247">        map.put(new Actions(Actions.ESCAPE));</span>
<span class="nc" id="L248">        map.put(new Actions(Actions.MINIMIZE));</span>
<span class="nc" id="L249">        map.put(new Actions(Actions.MAXIMIZE));</span>
<span class="nc" id="L250">        map.put(new Actions(Actions.NEXT_FRAME));</span>
<span class="nc" id="L251">        map.put(new Actions(Actions.PREVIOUS_FRAME));</span>
<span class="nc" id="L252">        map.put(new Actions(Actions.NAVIGATE_NEXT));</span>
<span class="nc" id="L253">        map.put(new Actions(Actions.NAVIGATE_PREVIOUS));</span>
<span class="nc" id="L254">    }</span>

    protected void uninstallKeyboardActions(){
<span class="nc" id="L257">      unregisterKeyboardActions();</span>
<span class="nc" id="L258">      SwingUtilities.replaceUIInputMap(desktop, JComponent.</span>
                                     WHEN_IN_FOCUSED_WINDOW, null);
<span class="nc" id="L260">      SwingUtilities.replaceUIInputMap(desktop, JComponent.</span>
                                     WHEN_ANCESTOR_OF_FOCUSED_COMPONENT, null);
<span class="nc" id="L262">      SwingUtilities.replaceUIActionMap(desktop, null);</span>
<span class="nc" id="L263">    }</span>

<span class="nc" id="L265">    public void paint(Graphics g, JComponent c) {}</span>

<span class="nc" id="L267">    public Dimension getPreferredSize(JComponent c) {return null;}</span>

    public Dimension getMinimumSize(JComponent c) {
<span class="nc" id="L270">        return minSize;</span>
        }
    public Dimension getMaximumSize(JComponent c){
<span class="nc" id="L273">        return maxSize;</span>
    }

    /**
     * Returns the &lt;code&gt;PropertyChangeListener&lt;/code&gt; to install on
     * the &lt;code&gt;JDesktopPane&lt;/code&gt;.
     *
     * @since 1.5
     * @return The PropertyChangeListener that will be added to track
     * changes in the desktop pane.
     */
    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L285">        return getHandler();</span>
    }

    private Handler getHandler() {
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L290">            handler = new Handler();</span>
        }
<span class="nc" id="L292">        return handler;</span>
    }

<span class="nc" id="L295">    private class Handler implements PropertyChangeListener {</span>
        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L297">            String propertyName = evt.getPropertyName();</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">            if (&quot;desktopManager&quot; == propertyName) {</span>
<span class="nc" id="L299">                installDesktopManager();</span>
            }
<span class="nc" id="L301">        }</span>
    }

    /**
     * The default DesktopManager installed by the UI.
     */
<span class="nc" id="L307">    private class BasicDesktopManager extends DefaultDesktopManager</span>
            implements UIResource {
    }

    private static class Actions extends UIAction {
<span class="nc" id="L312">        private static String CLOSE = &quot;close&quot;;</span>
<span class="nc" id="L313">        private static String ESCAPE = &quot;escape&quot;;</span>
<span class="nc" id="L314">        private static String MAXIMIZE = &quot;maximize&quot;;</span>
<span class="nc" id="L315">        private static String MINIMIZE = &quot;minimize&quot;;</span>
<span class="nc" id="L316">        private static String MOVE = &quot;move&quot;;</span>
<span class="nc" id="L317">        private static String RESIZE = &quot;resize&quot;;</span>
<span class="nc" id="L318">        private static String RESTORE = &quot;restore&quot;;</span>
<span class="nc" id="L319">        private static String LEFT = &quot;left&quot;;</span>
<span class="nc" id="L320">        private static String RIGHT = &quot;right&quot;;</span>
<span class="nc" id="L321">        private static String UP = &quot;up&quot;;</span>
<span class="nc" id="L322">        private static String DOWN = &quot;down&quot;;</span>
<span class="nc" id="L323">        private static String SHRINK_LEFT = &quot;shrinkLeft&quot;;</span>
<span class="nc" id="L324">        private static String SHRINK_RIGHT = &quot;shrinkRight&quot;;</span>
<span class="nc" id="L325">        private static String SHRINK_UP = &quot;shrinkUp&quot;;</span>
<span class="nc" id="L326">        private static String SHRINK_DOWN = &quot;shrinkDown&quot;;</span>
<span class="nc" id="L327">        private static String NEXT_FRAME = &quot;selectNextFrame&quot;;</span>
<span class="nc" id="L328">        private static String PREVIOUS_FRAME = &quot;selectPreviousFrame&quot;;</span>
<span class="nc" id="L329">        private static String NAVIGATE_NEXT = &quot;navigateNext&quot;;</span>
<span class="nc" id="L330">        private static String NAVIGATE_PREVIOUS = &quot;navigatePrevious&quot;;</span>
<span class="nc" id="L331">        private final int MOVE_RESIZE_INCREMENT = 10;</span>
<span class="nc" id="L332">        private static boolean moving = false;</span>
<span class="nc" id="L333">        private static boolean resizing = false;</span>
<span class="nc" id="L334">        private static JInternalFrame sourceFrame = null;</span>
<span class="nc" id="L335">        private static Component focusOwner = null;</span>

        Actions() {
<span class="nc" id="L338">            super(null);</span>
<span class="nc" id="L339">        }</span>

        Actions(String name) {
<span class="nc" id="L342">            super(name);</span>
<span class="nc" id="L343">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L346">            JDesktopPane dp = (JDesktopPane)e.getSource();</span>
<span class="nc" id="L347">            String key = getName();</span>

<span class="nc bnc" id="L349" title="All 8 branches missed.">            if (CLOSE == key || MAXIMIZE == key || MINIMIZE == key ||</span>
                    RESTORE == key) {
<span class="nc" id="L351">                setState(dp, key);</span>
            }
<span class="nc bnc" id="L353" title="All 2 branches missed.">            else if (ESCAPE == key) {</span>
<span class="nc bnc" id="L354" title="All 4 branches missed.">                if (sourceFrame == dp.getSelectedFrame() &amp;&amp;</span>
                        focusOwner != null) {
<span class="nc" id="L356">                    focusOwner.requestFocus();</span>
                }
<span class="nc" id="L358">                moving = false;</span>
<span class="nc" id="L359">                resizing = false;</span>
<span class="nc" id="L360">                sourceFrame = null;</span>
<span class="nc" id="L361">                focusOwner = null;</span>
            }
<span class="nc bnc" id="L363" title="All 4 branches missed.">            else if (MOVE == key || RESIZE == key) {</span>
<span class="nc" id="L364">                sourceFrame = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">                if (sourceFrame == null) {</span>
<span class="nc" id="L366">                    return;</span>
                }
<span class="nc bnc" id="L368" title="All 2 branches missed.">                moving = (key == MOVE) ? true : false;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                resizing = (key == RESIZE) ? true : false;</span>

                focusOwner = KeyboardFocusManager.
<span class="nc" id="L372">                    getCurrentKeyboardFocusManager().getFocusOwner();</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">                if (!SwingUtilities.isDescendingFrom(focusOwner, sourceFrame)) {</span>
<span class="nc" id="L374">                    focusOwner = null;</span>
                }
<span class="nc" id="L376">                sourceFrame.requestFocus();</span>
            }
<span class="nc bnc" id="L378" title="All 16 branches missed.">            else if (LEFT == key ||</span>
                     RIGHT == key ||
                     UP == key ||
                     DOWN == key ||
                     SHRINK_RIGHT == key ||
                     SHRINK_LEFT == key ||
                     SHRINK_UP == key ||
                     SHRINK_DOWN == key) {
<span class="nc" id="L386">                JInternalFrame c = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L387" title="All 4 branches missed.">                if (sourceFrame == null || c != sourceFrame ||</span>
                        KeyboardFocusManager.
<span class="nc bnc" id="L389" title="All 2 branches missed.">                            getCurrentKeyboardFocusManager().getFocusOwner() !=</span>
                                sourceFrame) {
<span class="nc" id="L391">                    return;</span>
                }
<span class="nc" id="L393">                Insets minOnScreenInsets =</span>
<span class="nc" id="L394">                    UIManager.getInsets(&quot;Desktop.minOnScreenInsets&quot;);</span>
<span class="nc" id="L395">                Dimension size = c.getSize();</span>
<span class="nc" id="L396">                Dimension minSize = c.getMinimumSize();</span>
<span class="nc" id="L397">                int dpWidth = dp.getWidth();</span>
<span class="nc" id="L398">                int dpHeight = dp.getHeight();</span>
                int delta;
<span class="nc" id="L400">                Point loc = c.getLocation();</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">                if (LEFT == key) {</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">                    if (moving) {</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">                        c.setLocation(</span>
                                loc.x + size.width - MOVE_RESIZE_INCREMENT &lt;
                                    minOnScreenInsets.right ?
                                        -size.width + minOnScreenInsets.right :
                                        loc.x - MOVE_RESIZE_INCREMENT,
                                loc.y);
<span class="nc bnc" id="L409" title="All 2 branches missed.">                    } else if (resizing) {</span>
<span class="nc" id="L410">                        c.setLocation(loc.x - MOVE_RESIZE_INCREMENT, loc.y);</span>
<span class="nc" id="L411">                        c.setSize(size.width + MOVE_RESIZE_INCREMENT,</span>
                                size.height);
                    }
<span class="nc bnc" id="L414" title="All 2 branches missed.">                } else if (RIGHT == key) {</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">                    if (moving) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">                        c.setLocation(</span>
                                loc.x + MOVE_RESIZE_INCREMENT &gt;
                                    dpWidth - minOnScreenInsets.left ?
                                        dpWidth - minOnScreenInsets.left :
                                        loc.x + MOVE_RESIZE_INCREMENT,
                                loc.y);
<span class="nc bnc" id="L422" title="All 2 branches missed.">                    } else if (resizing) {</span>
<span class="nc" id="L423">                        c.setSize(size.width + MOVE_RESIZE_INCREMENT,</span>
                                size.height);
                    }
<span class="nc bnc" id="L426" title="All 2 branches missed.">                } else if (UP == key) {</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">                    if (moving) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">                        c.setLocation(loc.x,</span>
                                loc.y + size.height - MOVE_RESIZE_INCREMENT &lt;
                                    minOnScreenInsets.bottom ?
                                        -size.height +
                                            minOnScreenInsets.bottom :
                                        loc.y - MOVE_RESIZE_INCREMENT);
<span class="nc bnc" id="L434" title="All 2 branches missed.">                    } else if (resizing) {</span>
<span class="nc" id="L435">                        c.setLocation(loc.x, loc.y - MOVE_RESIZE_INCREMENT);</span>
<span class="nc" id="L436">                        c.setSize(size.width,</span>
                                size.height + MOVE_RESIZE_INCREMENT);
                    }
<span class="nc bnc" id="L439" title="All 2 branches missed.">                } else if (DOWN == key) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                    if (moving) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                        c.setLocation(loc.x,</span>
                                loc.y + MOVE_RESIZE_INCREMENT &gt;
                                    dpHeight - minOnScreenInsets.top ?
                                        dpHeight - minOnScreenInsets.top :
                                        loc.y + MOVE_RESIZE_INCREMENT);
<span class="nc bnc" id="L446" title="All 2 branches missed.">                    } else if (resizing) {</span>
<span class="nc" id="L447">                        c.setSize(size.width,</span>
                                size.height + MOVE_RESIZE_INCREMENT);
                    }
<span class="nc bnc" id="L450" title="All 4 branches missed.">                } else if (SHRINK_LEFT == key &amp;&amp; resizing) {</span>
                    // Make sure we don't resize less than minimum size.
<span class="nc bnc" id="L452" title="All 2 branches missed.">                    if (minSize.width &lt; (size.width - MOVE_RESIZE_INCREMENT)) {</span>
<span class="nc" id="L453">                        delta = MOVE_RESIZE_INCREMENT;</span>
                    } else {
<span class="nc" id="L455">                        delta = size.width - minSize.width;</span>
                    }

                    // Ensure that we keep the internal frame on the desktop.
<span class="nc bnc" id="L459" title="All 2 branches missed.">                    if (loc.x + size.width - delta &lt; minOnScreenInsets.left) {</span>
<span class="nc" id="L460">                        delta = loc.x + size.width - minOnScreenInsets.left;</span>
                    }
<span class="nc" id="L462">                    c.setSize(size.width - delta, size.height);</span>
<span class="nc bnc" id="L463" title="All 4 branches missed.">                } else if (SHRINK_RIGHT == key &amp;&amp; resizing) {</span>
                    // Make sure we don't resize less than minimum size.
<span class="nc bnc" id="L465" title="All 2 branches missed.">                    if (minSize.width &lt; (size.width - MOVE_RESIZE_INCREMENT)) {</span>
<span class="nc" id="L466">                        delta = MOVE_RESIZE_INCREMENT;</span>
                    } else {
<span class="nc" id="L468">                        delta = size.width - minSize.width;</span>
                    }

                    // Ensure that we keep the internal frame on the desktop.
<span class="nc bnc" id="L472" title="All 2 branches missed.">                    if (loc.x + delta &gt; dpWidth - minOnScreenInsets.right) {</span>
<span class="nc" id="L473">                        delta = (dpWidth - minOnScreenInsets.right) - loc.x;</span>
                    }

<span class="nc" id="L476">                    c.setLocation(loc.x + delta, loc.y);</span>
<span class="nc" id="L477">                    c.setSize(size.width - delta, size.height);</span>
<span class="nc bnc" id="L478" title="All 4 branches missed.">                } else if (SHRINK_UP == key &amp;&amp; resizing) {</span>
                    // Make sure we don't resize less than minimum size.
<span class="nc bnc" id="L480" title="All 2 branches missed.">                    if (minSize.height &lt;</span>
                            (size.height - MOVE_RESIZE_INCREMENT)) {
<span class="nc" id="L482">                        delta = MOVE_RESIZE_INCREMENT;</span>
                    } else {
<span class="nc" id="L484">                        delta = size.height - minSize.height;</span>
                    }

                    // Ensure that we keep the internal frame on the desktop.
<span class="nc bnc" id="L488" title="All 2 branches missed.">                    if (loc.y + size.height - delta &lt;</span>
                            minOnScreenInsets.bottom) {
<span class="nc" id="L490">                        delta = loc.y + size.height - minOnScreenInsets.bottom;</span>
                    }

<span class="nc" id="L493">                    c.setSize(size.width, size.height - delta);</span>
<span class="nc bnc" id="L494" title="All 4 branches missed.">                } else if (SHRINK_DOWN == key  &amp;&amp; resizing) {</span>
                    // Make sure we don't resize less than minimum size.
<span class="nc bnc" id="L496" title="All 2 branches missed.">                    if (minSize.height &lt;</span>
                            (size.height - MOVE_RESIZE_INCREMENT)) {
<span class="nc" id="L498">                        delta = MOVE_RESIZE_INCREMENT;</span>
                    } else {
<span class="nc" id="L500">                        delta = size.height - minSize.height;</span>
                    }

                    // Ensure that we keep the internal frame on the desktop.
<span class="nc bnc" id="L504" title="All 2 branches missed.">                    if (loc.y + delta &gt; dpHeight - minOnScreenInsets.top) {</span>
<span class="nc" id="L505">                        delta = (dpHeight - minOnScreenInsets.top) - loc.y;</span>
                    }

<span class="nc" id="L508">                    c.setLocation(loc.x, loc.y + delta);</span>
<span class="nc" id="L509">                    c.setSize(size.width, size.height - delta);</span>
                }
<span class="nc" id="L511">            }</span>
<span class="nc bnc" id="L512" title="All 4 branches missed.">            else if (NEXT_FRAME == key || PREVIOUS_FRAME == key) {</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">                dp.selectFrame((key == NEXT_FRAME) ? true : false);</span>
            }
<span class="nc bnc" id="L515" title="All 4 branches missed.">            else if (NAVIGATE_NEXT == key ||</span>
                     NAVIGATE_PREVIOUS == key) {
<span class="nc" id="L517">                boolean moveForward = true;</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">                if (NAVIGATE_PREVIOUS == key) {</span>
<span class="nc" id="L519">                    moveForward = false;</span>
                }
<span class="nc" id="L521">                Container cycleRoot = dp.getFocusCycleRootAncestor();</span>

<span class="nc bnc" id="L523" title="All 2 branches missed.">                if (cycleRoot != null) {</span>
<span class="nc" id="L524">                    FocusTraversalPolicy policy =</span>
<span class="nc" id="L525">                        cycleRoot.getFocusTraversalPolicy();</span>
<span class="nc bnc" id="L526" title="All 4 branches missed.">                    if (policy != null &amp;&amp; policy instanceof</span>
                            SortingFocusTraversalPolicy) {
<span class="nc" id="L528">                        SortingFocusTraversalPolicy sPolicy =</span>
                            (SortingFocusTraversalPolicy)policy;
<span class="nc" id="L530">                        boolean idc = sPolicy.getImplicitDownCycleTraversal();</span>
                        try {
<span class="nc" id="L532">                            sPolicy.setImplicitDownCycleTraversal(false);</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">                            if (moveForward) {</span>
                                KeyboardFocusManager.
<span class="nc" id="L535">                                    getCurrentKeyboardFocusManager().</span>
<span class="nc" id="L536">                                        focusNextComponent(dp);</span>
                            } else {
                                KeyboardFocusManager.
<span class="nc" id="L539">                                    getCurrentKeyboardFocusManager().</span>
<span class="nc" id="L540">                                    focusPreviousComponent(dp);</span>
                            }
                        } finally {
<span class="nc" id="L543">                            sPolicy.setImplicitDownCycleTraversal(idc);</span>
<span class="nc" id="L544">                        }</span>
                    }
                }
            }
<span class="nc" id="L548">        }</span>

        private void setState(JDesktopPane dp, String state) {
<span class="nc bnc" id="L551" title="All 2 branches missed.">            if (state == CLOSE) {</span>
<span class="nc" id="L552">                JInternalFrame f = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">                if (f == null) {</span>
<span class="nc" id="L554">                    return;</span>
                }
<span class="nc" id="L556">                f.doDefaultCloseAction();</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">            } else if (state == MAXIMIZE) {</span>
                // maximize the selected frame
<span class="nc" id="L559">                JInternalFrame f = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">                if (f == null) {</span>
<span class="nc" id="L561">                    return;</span>
                }
<span class="nc bnc" id="L563" title="All 2 branches missed.">                if (!f.isMaximum()) {</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">                    if (f.isIcon()) {</span>
                        try {
<span class="nc" id="L566">                            f.setIcon(false);</span>
<span class="nc" id="L567">                            f.setMaximum(true);</span>
<span class="nc" id="L568">                        } catch (PropertyVetoException pve) {}</span>
                    } else {
                        try {
<span class="nc" id="L571">                            f.setMaximum(true);</span>
<span class="nc" id="L572">                        } catch (PropertyVetoException pve) {</span>
<span class="nc" id="L573">                        }</span>
                    }
                }
<span class="nc bnc" id="L576" title="All 2 branches missed.">            } else if (state == MINIMIZE) {</span>
                // minimize the selected frame
<span class="nc" id="L578">                JInternalFrame f = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">                if (f == null) {</span>
<span class="nc" id="L580">                    return;</span>
                }
<span class="nc bnc" id="L582" title="All 2 branches missed.">                if (!f.isIcon()) {</span>
                    try {
<span class="nc" id="L584">                        f.setIcon(true);</span>
<span class="nc" id="L585">                    } catch (PropertyVetoException pve) {</span>
<span class="nc" id="L586">                    }</span>
                }
<span class="nc bnc" id="L588" title="All 2 branches missed.">            } else if (state == RESTORE) {</span>
                // restore the selected minimized or maximized frame
<span class="nc" id="L590">                JInternalFrame f = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">                if (f == null) {</span>
<span class="nc" id="L592">                    return;</span>
                }
                try {
<span class="nc bnc" id="L595" title="All 2 branches missed.">                    if (f.isIcon()) {</span>
<span class="nc" id="L596">                        f.setIcon(false);</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">                    } else if (f.isMaximum()) {</span>
<span class="nc" id="L598">                        f.setMaximum(false);</span>
                    }
<span class="nc" id="L600">                    f.setSelected(true);</span>
<span class="nc" id="L601">                } catch (PropertyVetoException pve) {</span>
<span class="nc" id="L602">                }</span>
            }
<span class="nc" id="L604">        }</span>

        public boolean isEnabled(Object sender) {
<span class="nc bnc" id="L607" title="All 2 branches missed.">            if (sender instanceof JDesktopPane) {</span>
<span class="nc" id="L608">                JDesktopPane dp = (JDesktopPane)sender;</span>
<span class="nc" id="L609">                String action = getName();</span>
<span class="nc bnc" id="L610" title="All 4 branches missed.">                if (action == Actions.NEXT_FRAME ||</span>
                    action == Actions.PREVIOUS_FRAME) {
<span class="nc" id="L612">                    return true;</span>
                }
<span class="nc" id="L614">                JInternalFrame iFrame = dp.getSelectedFrame();</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">                if (iFrame == null) {</span>
<span class="nc" id="L616">                    return false;</span>
<span class="nc bnc" id="L617" title="All 2 branches missed.">                } else if (action == Actions.CLOSE) {</span>
<span class="nc" id="L618">                    return iFrame.isClosable();</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">                } else if (action == Actions.MINIMIZE) {</span>
<span class="nc" id="L620">                    return iFrame.isIconifiable();</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">                } else if (action == Actions.MAXIMIZE) {</span>
<span class="nc" id="L622">                    return iFrame.isMaximizable();</span>
                }
<span class="nc" id="L624">                return true;</span>
            }
<span class="nc" id="L626">            return false;</span>
        }
    }


    /**
     * Handles restoring a minimized or maximized internal frame.
     * @since 1.3
     */
<span class="nc" id="L635">    protected class OpenAction extends AbstractAction {</span>
        public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L637">            JDesktopPane dp = (JDesktopPane)evt.getSource();</span>
<span class="nc" id="L638">            SHARED_ACTION.setState(dp, Actions.RESTORE);</span>
<span class="nc" id="L639">        }</span>

        public boolean isEnabled() {
<span class="nc" id="L642">            return true;</span>
        }
    }

    /**
     * Handles closing an internal frame.
     */
<span class="nc" id="L649">    protected class CloseAction extends AbstractAction {</span>
        public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L651">            JDesktopPane dp = (JDesktopPane)evt.getSource();</span>
<span class="nc" id="L652">            SHARED_ACTION.setState(dp, Actions.CLOSE);</span>
<span class="nc" id="L653">        }</span>

        public boolean isEnabled() {
<span class="nc" id="L656">            JInternalFrame iFrame = desktop.getSelectedFrame();</span>
<span class="nc bnc" id="L657" title="All 2 branches missed.">            if (iFrame != null) {</span>
<span class="nc" id="L658">                return iFrame.isClosable();</span>
            }
<span class="nc" id="L660">            return false;</span>
        }
    }

    /**
     * Handles minimizing an internal frame.
     */
<span class="nc" id="L667">    protected class MinimizeAction extends AbstractAction {</span>
        public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L669">            JDesktopPane dp = (JDesktopPane)evt.getSource();</span>
<span class="nc" id="L670">            SHARED_ACTION.setState(dp, Actions.MINIMIZE);</span>
<span class="nc" id="L671">        }</span>

        public boolean isEnabled() {
<span class="nc" id="L674">            JInternalFrame iFrame = desktop.getSelectedFrame();</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">            if (iFrame != null) {</span>
<span class="nc" id="L676">                return iFrame.isIconifiable();</span>
            }
<span class="nc" id="L678">            return false;</span>
        }
    }

    /**
     * Handles maximizing an internal frame.
     */
<span class="nc" id="L685">    protected class MaximizeAction extends AbstractAction {</span>
        public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L687">            JDesktopPane dp = (JDesktopPane)evt.getSource();</span>
<span class="nc" id="L688">            SHARED_ACTION.setState(dp, Actions.MAXIMIZE);</span>
<span class="nc" id="L689">        }</span>

        public boolean isEnabled() {
<span class="nc" id="L692">            JInternalFrame iFrame = desktop.getSelectedFrame();</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">            if (iFrame != null) {</span>
<span class="nc" id="L694">                return iFrame.isMaximizable();</span>
            }
<span class="nc" id="L696">            return false;</span>
        }
    }

    /**
     * Handles navigating to the next internal frame.
     */
<span class="nc" id="L703">    protected class NavigateAction extends AbstractAction {</span>
        public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L705">            JDesktopPane dp = (JDesktopPane)evt.getSource();</span>
<span class="nc" id="L706">            dp.selectFrame(true);</span>
<span class="nc" id="L707">        }</span>

        public boolean isEnabled() {
<span class="nc" id="L710">            return true;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>