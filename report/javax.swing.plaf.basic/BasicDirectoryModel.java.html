<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BasicDirectoryModel.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicDirectoryModel.java</span></div><h1>BasicDirectoryModel.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2009, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import java.io.File;
import java.util.*;
import java.util.concurrent.Callable;
import javax.swing.*;
import javax.swing.filechooser.*;
import javax.swing.event.*;
import java.beans.*;

import sun.awt.shell.ShellFolder;

/**
 * Basic implementation of a file list.
 *
 * @author Jeff Dinkins
 */
public class BasicDirectoryModel extends AbstractListModel&lt;Object&gt; implements PropertyChangeListener {

<span class="nc" id="L45">    private JFileChooser filechooser = null;</span>
    // PENDING(jeff) pick the size more sensibly
<span class="nc" id="L47">    private Vector&lt;File&gt; fileCache = new Vector&lt;File&gt;(50);</span>
<span class="nc" id="L48">    private LoadFilesThread loadThread = null;</span>
<span class="nc" id="L49">    private Vector&lt;File&gt; files = null;</span>
<span class="nc" id="L50">    private Vector&lt;File&gt; directories = null;</span>
<span class="nc" id="L51">    private int fetchID = 0;</span>

    private PropertyChangeSupport changeSupport;

<span class="nc" id="L55">    private boolean busy = false;</span>

<span class="nc" id="L57">    public BasicDirectoryModel(JFileChooser filechooser) {</span>
<span class="nc" id="L58">        this.filechooser = filechooser;</span>
<span class="nc" id="L59">        validateFileCache();</span>
<span class="nc" id="L60">    }</span>

    public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L63">        String prop = e.getPropertyName();</span>
<span class="nc bnc" id="L64" title="All 10 branches missed.">        if(prop == JFileChooser.DIRECTORY_CHANGED_PROPERTY ||</span>
           prop == JFileChooser.FILE_VIEW_CHANGED_PROPERTY ||
           prop == JFileChooser.FILE_FILTER_CHANGED_PROPERTY ||
           prop == JFileChooser.FILE_HIDING_CHANGED_PROPERTY ||
           prop == JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTY) {
<span class="nc" id="L69">            validateFileCache();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">        } else if (&quot;UI&quot;.equals(prop)) {</span>
<span class="nc" id="L71">            Object old = e.getOldValue();</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">            if (old instanceof BasicFileChooserUI) {</span>
<span class="nc" id="L73">                BasicFileChooserUI ui = (BasicFileChooserUI) old;</span>
<span class="nc" id="L74">                BasicDirectoryModel model = ui.getModel();</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">                if (model != null) {</span>
<span class="nc" id="L76">                    model.invalidateFileCache();</span>
                }
            }
<span class="nc bnc" id="L79" title="All 2 branches missed.">        } else if (&quot;JFileChooserDialogIsClosingProperty&quot;.equals(prop)) {</span>
<span class="nc" id="L80">            invalidateFileCache();</span>
        }
<span class="nc" id="L82">    }</span>

    /**
     * This method is used to interrupt file loading thread.
     */
    public void invalidateFileCache() {
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if (loadThread != null) {</span>
<span class="nc" id="L89">            loadThread.interrupt();</span>
<span class="nc" id="L90">            loadThread.cancelRunnables();</span>
<span class="nc" id="L91">            loadThread = null;</span>
        }
<span class="nc" id="L93">    }</span>

    public Vector&lt;File&gt; getDirectories() {
<span class="nc" id="L96">        synchronized(fileCache) {</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">            if (directories != null) {</span>
<span class="nc" id="L98">                return directories;</span>
            }
<span class="nc" id="L100">            Vector fls = getFiles();</span>
<span class="nc" id="L101">            return directories;</span>
<span class="nc" id="L102">        }</span>
    }

    public Vector&lt;File&gt; getFiles() {
<span class="nc" id="L106">        synchronized(fileCache) {</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">            if (files != null) {</span>
<span class="nc" id="L108">                return files;</span>
            }
<span class="nc" id="L110">            files = new Vector&lt;File&gt;();</span>
<span class="nc" id="L111">            directories = new Vector&lt;File&gt;();</span>
<span class="nc" id="L112">            directories.addElement(filechooser.getFileSystemView().createFileObject(</span>
<span class="nc" id="L113">                filechooser.getCurrentDirectory(), &quot;..&quot;)</span>
            );

<span class="nc bnc" id="L116" title="All 2 branches missed.">            for (int i = 0; i &lt; getSize(); i++) {</span>
<span class="nc" id="L117">                File f = fileCache.get(i);</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">                if (filechooser.isTraversable(f)) {</span>
<span class="nc" id="L119">                    directories.add(f);</span>
                } else {
<span class="nc" id="L121">                    files.add(f);</span>
                }
            }
<span class="nc" id="L124">            return files;</span>
<span class="nc" id="L125">        }</span>
    }

    public void validateFileCache() {
<span class="nc" id="L129">        File currentDirectory = filechooser.getCurrentDirectory();</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (currentDirectory == null) {</span>
<span class="nc" id="L131">            return;</span>
        }
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (loadThread != null) {</span>
<span class="nc" id="L134">            loadThread.interrupt();</span>
<span class="nc" id="L135">            loadThread.cancelRunnables();</span>
        }

<span class="nc" id="L138">        setBusy(true, ++fetchID);</span>

<span class="nc" id="L140">        loadThread = new LoadFilesThread(currentDirectory, fetchID);</span>
<span class="nc" id="L141">        loadThread.start();</span>
<span class="nc" id="L142">    }</span>

    /**
     * Renames a file in the underlying file system.
     *
     * @param oldFile a &lt;code&gt;File&lt;/code&gt; object representing
     *        the existing file
     * @param newFile a &lt;code&gt;File&lt;/code&gt; object representing
     *        the desired new file name
     * @return &lt;code&gt;true&lt;/code&gt; if rename succeeded,
     *        otherwise &lt;code&gt;false&lt;/code&gt;
     * @since 1.4
     */
    public boolean renameFile(File oldFile, File newFile) {
<span class="nc" id="L156">        synchronized(fileCache) {</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (oldFile.renameTo(newFile)) {</span>
<span class="nc" id="L158">                validateFileCache();</span>
<span class="nc" id="L159">                return true;</span>
            }
<span class="nc" id="L161">            return false;</span>
<span class="nc" id="L162">        }</span>
    }


    public void fireContentsChanged() {
        // System.out.println(&quot;BasicDirectoryModel: firecontentschanged&quot;);
<span class="nc" id="L168">        fireContentsChanged(this, 0, getSize()-1);</span>
<span class="nc" id="L169">    }</span>

    public int getSize() {
<span class="nc" id="L172">        return fileCache.size();</span>
    }

    public boolean contains(Object o) {
<span class="nc" id="L176">        return fileCache.contains(o);</span>
    }

    public int indexOf(Object o) {
<span class="nc" id="L180">        return fileCache.indexOf(o);</span>
    }

    public Object getElementAt(int index) {
<span class="nc" id="L184">        return fileCache.get(index);</span>
    }

    /**
     * Obsolete - not used.
     */
    public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L191">    }</span>

    /**
     * Obsolete - not used.
     */
    public void intervalRemoved(ListDataEvent e) {
<span class="nc" id="L197">    }</span>

    protected void sort(Vector&lt;? extends File&gt; v){
<span class="nc" id="L200">        ShellFolder.sort(v);</span>
<span class="nc" id="L201">    }</span>

    // Obsolete - not used
    protected boolean lt(File a, File b) {
        // First ignore case when comparing
<span class="nc" id="L206">        int diff = a.getName().toLowerCase().compareTo(b.getName().toLowerCase());</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        if (diff != 0) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">            return diff &lt; 0;</span>
        } else {
            // May differ in case (e.g. &quot;mail&quot; vs. &quot;Mail&quot;)
<span class="nc bnc" id="L211" title="All 2 branches missed.">            return a.getName().compareTo(b.getName()) &lt; 0;</span>
        }
    }


    class LoadFilesThread extends Thread {
<span class="nc" id="L217">        File currentDirectory = null;</span>
        int fid;
<span class="nc" id="L219">        Vector&lt;DoChangeContents&gt; runnables = new Vector&lt;DoChangeContents&gt;(10);</span>

<span class="nc" id="L221">        public LoadFilesThread(File currentDirectory, int fid) {</span>
<span class="nc" id="L222">            super(&quot;Basic L&amp;F File Loading Thread&quot;);</span>
<span class="nc" id="L223">            this.currentDirectory = currentDirectory;</span>
<span class="nc" id="L224">            this.fid = fid;</span>
<span class="nc" id="L225">        }</span>

        public void run() {
<span class="nc" id="L228">            run0();</span>
<span class="nc" id="L229">            setBusy(false, fid);</span>
<span class="nc" id="L230">        }</span>

        public void run0() {
<span class="nc" id="L233">            FileSystemView fileSystem = filechooser.getFileSystemView();</span>

<span class="nc bnc" id="L235" title="All 2 branches missed.">            if (isInterrupted()) {</span>
<span class="nc" id="L236">                return;</span>
            }

<span class="nc" id="L239">            File[] list = fileSystem.getFiles(currentDirectory, filechooser.isFileHidingEnabled());</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">            if (isInterrupted()) {</span>
<span class="nc" id="L242">                return;</span>
            }

<span class="nc" id="L245">            final Vector&lt;File&gt; newFileCache = new Vector&lt;File&gt;();</span>
<span class="nc" id="L246">            Vector&lt;File&gt; newFiles = new Vector&lt;File&gt;();</span>

            // run through the file list, add directories and selectable files to fileCache
            // Note that this block must be OUTSIDE of Invoker thread because of
            // deadlock possibility with custom synchronized FileSystemView
<span class="nc bnc" id="L251" title="All 2 branches missed.">            for (File file : list) {</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                if (filechooser.accept(file)) {</span>
<span class="nc" id="L253">                    boolean isTraversable = filechooser.isTraversable(file);</span>

<span class="nc bnc" id="L255" title="All 2 branches missed.">                    if (isTraversable) {</span>
<span class="nc" id="L256">                        newFileCache.addElement(file);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">                    } else if (filechooser.isFileSelectionEnabled()) {</span>
<span class="nc" id="L258">                        newFiles.addElement(file);</span>
                    }

<span class="nc bnc" id="L261" title="All 2 branches missed.">                    if (isInterrupted()) {</span>
<span class="nc" id="L262">                        return;</span>
                    }
                }
            }

            // First sort alphabetically by filename
<span class="nc" id="L268">            sort(newFileCache);</span>
<span class="nc" id="L269">            sort(newFiles);</span>

<span class="nc" id="L271">            newFileCache.addAll(newFiles);</span>

            // To avoid loads of synchronizations with Invoker and improve performance we
            // execute the whole block on the COM thread
<span class="nc" id="L275">            DoChangeContents doChangeContents = ShellFolder.invoke(new Callable&lt;DoChangeContents&gt;() {</span>
                public DoChangeContents call() {
<span class="nc" id="L277">                    int newSize = newFileCache.size();</span>
<span class="nc" id="L278">                    int oldSize = fileCache.size();</span>

<span class="nc bnc" id="L280" title="All 2 branches missed.">                    if (newSize &gt; oldSize) {</span>
                        //see if interval is added
<span class="nc" id="L282">                        int start = oldSize;</span>
<span class="nc" id="L283">                        int end = newSize;</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">                        for (int i = 0; i &lt; oldSize; i++) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                            if (!newFileCache.get(i).equals(fileCache.get(i))) {</span>
<span class="nc" id="L286">                                start = i;</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">                                for (int j = i; j &lt; newSize; j++) {</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">                                    if (newFileCache.get(j).equals(fileCache.get(i))) {</span>
<span class="nc" id="L289">                                        end = j;</span>
<span class="nc" id="L290">                                        break;</span>
                                    }
                                }
<span class="nc" id="L293">                                break;</span>
                            }
                        }
<span class="nc bnc" id="L296" title="All 4 branches missed.">                        if (start &gt;= 0 &amp;&amp; end &gt; start</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">                            &amp;&amp; newFileCache.subList(end, newSize).equals(fileCache.subList(start, oldSize))) {</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">                            if (isInterrupted()) {</span>
<span class="nc" id="L299">                                return null;</span>
                            }
<span class="nc" id="L301">                            return new DoChangeContents(newFileCache.subList(start, end), start, null, 0, fid);</span>
                        }
<span class="nc bnc" id="L303" title="All 2 branches missed.">                    } else if (newSize &lt; oldSize) {</span>
                        //see if interval is removed
<span class="nc" id="L305">                        int start = -1;</span>
<span class="nc" id="L306">                        int end = -1;</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">                        for (int i = 0; i &lt; newSize; i++) {</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">                            if (!newFileCache.get(i).equals(fileCache.get(i))) {</span>
<span class="nc" id="L309">                                start = i;</span>
<span class="nc" id="L310">                                end = i + oldSize - newSize;</span>
<span class="nc" id="L311">                                break;</span>
                            }
                        }
<span class="nc bnc" id="L314" title="All 4 branches missed.">                        if (start &gt;= 0 &amp;&amp; end &gt; start</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                            &amp;&amp; fileCache.subList(end, oldSize).equals(newFileCache.subList(start, newSize))) {</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                            if (isInterrupted()) {</span>
<span class="nc" id="L317">                                return null;</span>
                            }
<span class="nc" id="L319">                            return new DoChangeContents(null, 0, new Vector(fileCache.subList(start, end)), start, fid);</span>
                        }
                    }
<span class="nc bnc" id="L322" title="All 2 branches missed.">                    if (!fileCache.equals(newFileCache)) {</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                        if (isInterrupted()) {</span>
<span class="nc" id="L324">                            cancelRunnables(runnables);</span>
                        }
<span class="nc" id="L326">                        return new DoChangeContents(newFileCache, 0, fileCache, 0, fid);</span>
                    }
<span class="nc" id="L328">                    return null;</span>
                }
            });

<span class="nc bnc" id="L332" title="All 2 branches missed.">            if (doChangeContents != null) {</span>
<span class="nc" id="L333">                runnables.addElement(doChangeContents);</span>
<span class="nc" id="L334">                SwingUtilities.invokeLater(doChangeContents);</span>
            }
<span class="nc" id="L336">        }</span>


        public void cancelRunnables(Vector&lt;DoChangeContents&gt; runnables) {
<span class="nc bnc" id="L340" title="All 2 branches missed.">            for (DoChangeContents runnable : runnables) {</span>
<span class="nc" id="L341">                runnable.cancel();</span>
<span class="nc" id="L342">            }</span>
<span class="nc" id="L343">        }</span>

        public void cancelRunnables() {
<span class="nc" id="L346">            cancelRunnables(runnables);</span>
<span class="nc" id="L347">        }</span>
   }


    /**
     * Adds a PropertyChangeListener to the listener list. The listener is
     * registered for all bound properties of this class.
     * &lt;p&gt;
     * If &lt;code&gt;listener&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;,
     * no exception is thrown and no action is performed.
     *
     * @param    listener  the property change listener to be added
     *
     * @see #removePropertyChangeListener
     * @see #getPropertyChangeListeners
     *
     * @since 1.6
     */
    public void addPropertyChangeListener(PropertyChangeListener listener) {
<span class="nc bnc" id="L366" title="All 2 branches missed.">        if (changeSupport == null) {</span>
<span class="nc" id="L367">            changeSupport = new PropertyChangeSupport(this);</span>
        }
<span class="nc" id="L369">        changeSupport.addPropertyChangeListener(listener);</span>
<span class="nc" id="L370">    }</span>

    /**
     * Removes a PropertyChangeListener from the listener list.
     * &lt;p&gt;
     * If listener is null, no exception is thrown and no action is performed.
     *
     * @param listener the PropertyChangeListener to be removed
     *
     * @see #addPropertyChangeListener
     * @see #getPropertyChangeListeners
     *
     * @since 1.6
     */
    public void removePropertyChangeListener(PropertyChangeListener listener) {
<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (changeSupport != null) {</span>
<span class="nc" id="L386">            changeSupport.removePropertyChangeListener(listener);</span>
        }
<span class="nc" id="L388">    }</span>

    /**
     * Returns an array of all the property change listeners
     * registered on this component.
     *
     * @return all of this component's &lt;code&gt;PropertyChangeListener&lt;/code&gt;s
     *         or an empty array if no property change
     *         listeners are currently registered
     *
     * @see      #addPropertyChangeListener
     * @see      #removePropertyChangeListener
     * @see      java.beans.PropertyChangeSupport#getPropertyChangeListeners
     *
     * @since 1.6
     */
    public PropertyChangeListener[] getPropertyChangeListeners() {
<span class="nc bnc" id="L405" title="All 2 branches missed.">        if (changeSupport == null) {</span>
<span class="nc" id="L406">            return new PropertyChangeListener[0];</span>
        }
<span class="nc" id="L408">        return changeSupport.getPropertyChangeListeners();</span>
    }

    /**
     * Support for reporting bound property changes for boolean properties.
     * This method can be called when a bound property has changed and it will
     * send the appropriate PropertyChangeEvent to any registered
     * PropertyChangeListeners.
     *
     * @param propertyName the property whose value has changed
     * @param oldValue the property's previous value
     * @param newValue the property's new value
     *
     * @since 1.6
     */
    protected void firePropertyChange(String propertyName,
                                      Object oldValue, Object newValue) {
<span class="nc bnc" id="L425" title="All 2 branches missed.">        if (changeSupport != null) {</span>
<span class="nc" id="L426">            changeSupport.firePropertyChange(propertyName,</span>
                                             oldValue, newValue);
        }
<span class="nc" id="L429">    }</span>


    /**
     * Set the busy state for the model. The model is considered
     * busy when it is running a separate (interruptable)
     * thread in order to load the contents of a directory.
     */
    private synchronized void setBusy(final boolean busy, int fid) {
<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (fid == fetchID) {</span>
<span class="nc" id="L439">            boolean oldValue = this.busy;</span>
<span class="nc" id="L440">            this.busy = busy;</span>

<span class="nc bnc" id="L442" title="All 4 branches missed.">            if (changeSupport != null &amp;&amp; busy != oldValue) {</span>
<span class="nc" id="L443">                SwingUtilities.invokeLater(new Runnable() {</span>
                    public void run() {
<span class="nc bnc" id="L445" title="All 2 branches missed.">                        firePropertyChange(&quot;busy&quot;, !busy, busy);</span>
<span class="nc" id="L446">                    }</span>
                });
            }
        }
<span class="nc" id="L450">    }</span>


    class DoChangeContents implements Runnable {
        private List&lt;File&gt; addFiles;
        private List&lt;File&gt; remFiles;
<span class="nc" id="L456">        private boolean doFire = true;</span>
        private int fid;
<span class="nc" id="L458">        private int addStart = 0;</span>
<span class="nc" id="L459">        private int remStart = 0;</span>

<span class="nc" id="L461">        public DoChangeContents(List&lt;File&gt; addFiles, int addStart, List&lt;File&gt; remFiles, int remStart, int fid) {</span>
<span class="nc" id="L462">            this.addFiles = addFiles;</span>
<span class="nc" id="L463">            this.addStart = addStart;</span>
<span class="nc" id="L464">            this.remFiles = remFiles;</span>
<span class="nc" id="L465">            this.remStart = remStart;</span>
<span class="nc" id="L466">            this.fid = fid;</span>
<span class="nc" id="L467">        }</span>

        synchronized void cancel() {
<span class="nc" id="L470">                doFire = false;</span>
<span class="nc" id="L471">        }</span>

        public synchronized void run() {
<span class="nc bnc" id="L474" title="All 4 branches missed.">            if (fetchID == fid &amp;&amp; doFire) {</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">                int remSize = (remFiles == null) ? 0 : remFiles.size();</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">                int addSize = (addFiles == null) ? 0 : addFiles.size();</span>
<span class="nc" id="L477">                synchronized(fileCache) {</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">                    if (remSize &gt; 0) {</span>
<span class="nc" id="L479">                        fileCache.removeAll(remFiles);</span>
                    }
<span class="nc bnc" id="L481" title="All 2 branches missed.">                    if (addSize &gt; 0) {</span>
<span class="nc" id="L482">                        fileCache.addAll(addStart, addFiles);</span>
                    }
<span class="nc" id="L484">                    files = null;</span>
<span class="nc" id="L485">                    directories = null;</span>
<span class="nc" id="L486">                }</span>
<span class="nc bnc" id="L487" title="All 4 branches missed.">                if (remSize &gt; 0 &amp;&amp; addSize == 0) {</span>
<span class="nc" id="L488">                    fireIntervalRemoved(BasicDirectoryModel.this, remStart, remStart + remSize - 1);</span>
<span class="nc bnc" id="L489" title="All 6 branches missed.">                } else if (addSize &gt; 0 &amp;&amp; remSize == 0 &amp;&amp; addStart + addSize &lt;= fileCache.size()) {</span>
<span class="nc" id="L490">                    fireIntervalAdded(BasicDirectoryModel.this, addStart, addStart + addSize - 1);</span>
                } else {
<span class="nc" id="L492">                    fireContentsChanged();</span>
                }
            }
<span class="nc" id="L495">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>