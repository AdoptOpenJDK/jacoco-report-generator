<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BasicColorChooserUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.plaf.basic</a> &gt; <span class="el_source">BasicColorChooserUI.java</span></div><h1>BasicColorChooserUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package javax.swing.plaf.basic;

import javax.swing.*;
import javax.swing.colorchooser.*;
import javax.swing.event.*;
import javax.swing.border.*;
import javax.swing.plaf.*;
import java.awt.*;
import java.awt.event.*;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;

import sun.swing.DefaultLookup;

/**
 * Provides the basic look and feel for a JColorChooser.
 * &lt;p&gt;
 * @author Tom Santos
 * @author Steve Wilson
 */

<span class="nc" id="L47">public class BasicColorChooserUI extends ColorChooserUI</span>
{
    /**
     * JColorChooser this BasicColorChooserUI is installed on.
     *
     * @since 1.5
     */
    protected JColorChooser chooser;

    JTabbedPane tabbedPane;
    JPanel singlePanel;

    JPanel previewPanelHolder;
    JComponent previewPanel;
<span class="nc" id="L61">    boolean isMultiPanel = false;</span>
<span class="nc" id="L62">    private static TransferHandler defaultTransferHandler = new ColorTransferHandler();</span>

    protected AbstractColorChooserPanel[] defaultChoosers;

    protected ChangeListener previewListener;
    protected PropertyChangeListener propertyChangeListener;
    private Handler handler;

    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L71">        return new BasicColorChooserUI();</span>
    }

    protected AbstractColorChooserPanel[] createDefaultChoosers() {
<span class="nc" id="L75">        AbstractColorChooserPanel[] panels = ColorChooserComponentFactory.getDefaultChooserPanels();</span>
<span class="nc" id="L76">        return panels;</span>
    }

    protected void uninstallDefaultChoosers() {
<span class="nc" id="L80">        AbstractColorChooserPanel[] choosers = chooser.getChooserPanels();</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">        for( int i = 0 ; i &lt; choosers.length; i++) {</span>
<span class="nc" id="L82">            chooser.removeChooserPanel( choosers[i] );</span>
        }
<span class="nc" id="L84">    }</span>

    public void installUI( JComponent c ) {
<span class="nc" id="L87">        chooser = (JColorChooser)c;</span>

<span class="nc" id="L89">        super.installUI( c );</span>

<span class="nc" id="L91">        installDefaults();</span>
<span class="nc" id="L92">        installListeners();</span>

<span class="nc" id="L94">        tabbedPane = new JTabbedPane();</span>
<span class="nc" id="L95">        tabbedPane.setName(&quot;ColorChooser.tabPane&quot;);</span>
<span class="nc" id="L96">        tabbedPane.setInheritsPopupMenu(true);</span>
<span class="nc" id="L97">        tabbedPane.getAccessibleContext().setAccessibleDescription(tabbedPane.getName());</span>
<span class="nc" id="L98">        singlePanel = new JPanel(new CenterLayout());</span>
<span class="nc" id="L99">        singlePanel.setName(&quot;ColorChooser.panel&quot;);</span>
<span class="nc" id="L100">        singlePanel.setInheritsPopupMenu(true);</span>

<span class="nc" id="L102">        chooser.setLayout( new BorderLayout() );</span>

<span class="nc" id="L104">        defaultChoosers = createDefaultChoosers();</span>
<span class="nc" id="L105">        chooser.setChooserPanels(defaultChoosers);</span>

<span class="nc" id="L107">        previewPanelHolder = new JPanel(new CenterLayout());</span>
<span class="nc" id="L108">        previewPanelHolder.setName(&quot;ColorChooser.previewPanelHolder&quot;);</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (DefaultLookup.getBoolean(chooser, this,</span>
                                  &quot;ColorChooser.showPreviewPanelText&quot;, true)) {
<span class="nc" id="L112">            String previewString = UIManager.getString(</span>
<span class="nc" id="L113">                &quot;ColorChooser.previewText&quot;, chooser.getLocale());</span>
<span class="nc" id="L114">            previewPanelHolder.setBorder(new TitledBorder(previewString));</span>
        }
<span class="nc" id="L116">        previewPanelHolder.setInheritsPopupMenu(true);</span>

<span class="nc" id="L118">        installPreviewPanel();</span>
<span class="nc" id="L119">        chooser.applyComponentOrientation(c.getComponentOrientation());</span>
<span class="nc" id="L120">    }</span>

    public void uninstallUI( JComponent c ) {
<span class="nc" id="L123">        chooser.remove(tabbedPane);</span>
<span class="nc" id="L124">        chooser.remove(singlePanel);</span>
<span class="nc" id="L125">        chooser.remove(previewPanelHolder);</span>

<span class="nc" id="L127">        uninstallDefaultChoosers();</span>
<span class="nc" id="L128">        uninstallListeners();</span>
<span class="nc" id="L129">        uninstallPreviewPanel();</span>
<span class="nc" id="L130">        uninstallDefaults();</span>

<span class="nc" id="L132">        previewPanelHolder = null;</span>
<span class="nc" id="L133">        previewPanel = null;</span>
<span class="nc" id="L134">        defaultChoosers = null;</span>
<span class="nc" id="L135">        chooser = null;</span>
<span class="nc" id="L136">        tabbedPane = null;</span>

<span class="nc" id="L138">        handler = null;</span>
<span class="nc" id="L139">    }</span>

    protected void installPreviewPanel() {
<span class="nc" id="L142">        JComponent previewPanel = this.chooser.getPreviewPanel();</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (previewPanel == null) {</span>
<span class="nc" id="L144">            previewPanel = ColorChooserComponentFactory.getPreviewPanel();</span>
        }
<span class="nc bnc" id="L146" title="All 4 branches missed.">        else if (JPanel.class.equals(previewPanel.getClass()) &amp;&amp; (0 == previewPanel.getComponentCount())) {</span>
<span class="nc" id="L147">            previewPanel = null;</span>
        }
<span class="nc" id="L149">        this.previewPanel = previewPanel;</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (previewPanel != null) {</span>
<span class="nc" id="L151">            chooser.add(previewPanelHolder, BorderLayout.SOUTH);</span>
<span class="nc" id="L152">            previewPanel.setForeground(chooser.getColor());</span>
<span class="nc" id="L153">            previewPanelHolder.add(previewPanel);</span>
<span class="nc" id="L154">            previewPanel.addMouseListener(getHandler());</span>
<span class="nc" id="L155">            previewPanel.setInheritsPopupMenu(true);</span>
        }
<span class="nc" id="L157">    }</span>

    /**
     * Removes installed preview panel from the UI delegate.
     *
     * @since 1.7
     */
    protected void uninstallPreviewPanel() {
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (this.previewPanel != null) {</span>
<span class="nc" id="L166">            this.previewPanel.removeMouseListener(getHandler());</span>
<span class="nc" id="L167">            this.previewPanelHolder.remove(this.previewPanel);</span>
        }
<span class="nc" id="L169">        this.chooser.remove(this.previewPanelHolder);</span>
<span class="nc" id="L170">    }</span>

    protected void installDefaults() {
<span class="nc" id="L173">        LookAndFeel.installColorsAndFont(chooser, &quot;ColorChooser.background&quot;,</span>
                                              &quot;ColorChooser.foreground&quot;,
                                              &quot;ColorChooser.font&quot;);
<span class="nc" id="L176">        LookAndFeel.installProperty(chooser, &quot;opaque&quot;, Boolean.TRUE);</span>
<span class="nc" id="L177">        TransferHandler th = chooser.getTransferHandler();</span>
<span class="nc bnc" id="L178" title="All 4 branches missed.">        if (th == null || th instanceof UIResource) {</span>
<span class="nc" id="L179">            chooser.setTransferHandler(defaultTransferHandler);</span>
        }
<span class="nc" id="L181">    }</span>

    protected void uninstallDefaults() {
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (chooser.getTransferHandler() instanceof UIResource) {</span>
<span class="nc" id="L185">            chooser.setTransferHandler(null);</span>
        }
<span class="nc" id="L187">    }</span>


    protected void installListeners() {
<span class="nc" id="L191">        propertyChangeListener = createPropertyChangeListener();</span>
<span class="nc" id="L192">        chooser.addPropertyChangeListener( propertyChangeListener );</span>

<span class="nc" id="L194">        previewListener = getHandler();</span>
<span class="nc" id="L195">        chooser.getSelectionModel().addChangeListener(previewListener);</span>
<span class="nc" id="L196">    }</span>

    private Handler getHandler() {
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (handler == null) {</span>
<span class="nc" id="L200">            handler = new Handler();</span>
        }
<span class="nc" id="L202">        return handler;</span>
    }

    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L206">        return getHandler();</span>
    }

    protected void uninstallListeners() {
<span class="nc" id="L210">        chooser.removePropertyChangeListener( propertyChangeListener );</span>
<span class="nc" id="L211">        chooser.getSelectionModel().removeChangeListener(previewListener);</span>
<span class="nc" id="L212">        previewListener = null;</span>
<span class="nc" id="L213">    }</span>

    private void selectionChanged(ColorSelectionModel model) {
<span class="nc" id="L216">        JComponent previewPanel = this.chooser.getPreviewPanel();</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">        if (previewPanel != null) {</span>
<span class="nc" id="L218">            previewPanel.setForeground(model.getSelectedColor());</span>
<span class="nc" id="L219">            previewPanel.repaint();</span>
        }
<span class="nc" id="L221">        AbstractColorChooserPanel[] panels = this.chooser.getChooserPanels();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if (panels != null) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">            for (AbstractColorChooserPanel panel : panels) {</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">                if (panel != null) {</span>
<span class="nc" id="L225">                    panel.updateChooser();</span>
                }
            }
        }
<span class="nc" id="L229">    }</span>

<span class="nc" id="L231">    private class Handler implements ChangeListener, MouseListener,</span>
            PropertyChangeListener {
        //
        // ChangeListener
        //
        public void stateChanged(ChangeEvent evt) {
<span class="nc" id="L237">            selectionChanged((ColorSelectionModel) evt.getSource());</span>
<span class="nc" id="L238">        }</span>

        //
        // MouseListener
        public void mousePressed(MouseEvent evt) {
<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (chooser.getDragEnabled()) {</span>
<span class="nc" id="L244">                TransferHandler th = chooser.getTransferHandler();</span>
<span class="nc" id="L245">                th.exportAsDrag(chooser, evt, TransferHandler.COPY);</span>
            }
<span class="nc" id="L247">        }</span>
<span class="nc" id="L248">        public void mouseReleased(MouseEvent evt) {}</span>
<span class="nc" id="L249">        public void mouseClicked(MouseEvent evt) {}</span>
<span class="nc" id="L250">        public void mouseEntered(MouseEvent evt) {}</span>
<span class="nc" id="L251">        public void mouseExited(MouseEvent evt) {}</span>

        //
        // PropertyChangeListener
        //
        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L257">            String prop = evt.getPropertyName();</span>

<span class="nc bnc" id="L259" title="All 2 branches missed.">            if (prop == JColorChooser.CHOOSER_PANELS_PROPERTY) {</span>
<span class="nc" id="L260">                AbstractColorChooserPanel[] oldPanels =</span>
<span class="nc" id="L261">                    (AbstractColorChooserPanel[])evt.getOldValue();</span>
<span class="nc" id="L262">                AbstractColorChooserPanel[] newPanels =</span>
<span class="nc" id="L263">                    (AbstractColorChooserPanel[])evt.getNewValue();</span>

<span class="nc bnc" id="L265" title="All 2 branches missed.">                for (int i = 0; i &lt; oldPanels.length; i++) {  // remove old panels</span>
<span class="nc" id="L266">                   Container wrapper = oldPanels[i].getParent();</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                    if (wrapper != null) {</span>
<span class="nc" id="L268">                      Container parent = wrapper.getParent();</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">                      if (parent != null)</span>
<span class="nc" id="L270">                          parent.remove(wrapper);  // remove from hierarchy</span>
<span class="nc" id="L271">                      oldPanels[i].uninstallChooserPanel(chooser); // uninstall</span>
                    }
                }

<span class="nc" id="L275">                int numNewPanels = newPanels.length;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">                if (numNewPanels == 0) {  // removed all panels and added none</span>
<span class="nc" id="L277">                    chooser.remove(tabbedPane);</span>
<span class="nc" id="L278">                    return;</span>
                }
<span class="nc bnc" id="L280" title="All 2 branches missed.">                else if (numNewPanels == 1) {  // one panel case</span>
<span class="nc" id="L281">                    chooser.remove(tabbedPane);</span>
<span class="nc" id="L282">                    JPanel centerWrapper = new JPanel( new CenterLayout() );</span>
<span class="nc" id="L283">                    centerWrapper.setInheritsPopupMenu(true);</span>
<span class="nc" id="L284">                    centerWrapper.add(newPanels[0]);</span>
<span class="nc" id="L285">                    singlePanel.add(centerWrapper, BorderLayout.CENTER);</span>
<span class="nc" id="L286">                    chooser.add(singlePanel);</span>
<span class="nc" id="L287">                }</span>
                else {   // multi-panel case
<span class="nc bnc" id="L289" title="All 2 branches missed.">                    if ( oldPanels.length &lt; 2 ) {// moving from single to multiple</span>
<span class="nc" id="L290">                        chooser.remove(singlePanel);</span>
<span class="nc" id="L291">                        chooser.add(tabbedPane, BorderLayout.CENTER);</span>
                    }

<span class="nc bnc" id="L294" title="All 2 branches missed.">                    for (int i = 0; i &lt; newPanels.length; i++) {</span>
<span class="nc" id="L295">                        JPanel centerWrapper = new JPanel( new CenterLayout() );</span>
<span class="nc" id="L296">                        centerWrapper.setInheritsPopupMenu(true);</span>
<span class="nc" id="L297">                        String name = newPanels[i].getDisplayName();</span>
<span class="nc" id="L298">                        int mnemonic = newPanels[i].getMnemonic();</span>
<span class="nc" id="L299">                        centerWrapper.add(newPanels[i]);</span>
<span class="nc" id="L300">                        tabbedPane.addTab(name, centerWrapper);</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">                        if (mnemonic &gt; 0) {</span>
<span class="nc" id="L302">                            tabbedPane.setMnemonicAt(i, mnemonic);</span>
<span class="nc" id="L303">                            int index = newPanels[i].getDisplayedMnemonicIndex();</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">                            if (index &gt;= 0) {</span>
<span class="nc" id="L305">                                tabbedPane.setDisplayedMnemonicIndexAt(i, index);</span>
                            }
                        }
                    }
                }
<span class="nc" id="L310">                chooser.applyComponentOrientation(chooser.getComponentOrientation());</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                for (int i = 0; i &lt; newPanels.length; i++) {</span>
<span class="nc" id="L312">                    newPanels[i].installChooserPanel(chooser);</span>
                }
<span class="nc" id="L314">            }</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">            else if (prop == JColorChooser.PREVIEW_PANEL_PROPERTY) {</span>
<span class="nc" id="L316">                uninstallPreviewPanel();</span>
<span class="nc" id="L317">                installPreviewPanel();</span>
            }
<span class="nc bnc" id="L319" title="All 2 branches missed.">            else if (prop == JColorChooser.SELECTION_MODEL_PROPERTY) {</span>
<span class="nc" id="L320">                ColorSelectionModel oldModel = (ColorSelectionModel) evt.getOldValue();</span>
<span class="nc" id="L321">                oldModel.removeChangeListener(previewListener);</span>
<span class="nc" id="L322">                ColorSelectionModel newModel = (ColorSelectionModel) evt.getNewValue();</span>
<span class="nc" id="L323">                newModel.addChangeListener(previewListener);</span>
<span class="nc" id="L324">                selectionChanged(newModel);</span>
<span class="nc" id="L325">            }</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">            else if (prop == &quot;componentOrientation&quot;) {</span>
<span class="nc" id="L327">                ComponentOrientation o =</span>
<span class="nc" id="L328">                    (ComponentOrientation)evt.getNewValue();</span>
<span class="nc" id="L329">                JColorChooser cc = (JColorChooser)evt.getSource();</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">                if (o != (ComponentOrientation)evt.getOldValue()) {</span>
<span class="nc" id="L331">                    cc.applyComponentOrientation(o);</span>
<span class="nc" id="L332">                    cc.updateUI();</span>
                }
            }
<span class="nc" id="L335">        }</span>
    }

    /**
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of {@code BasicColorChooserUI}.
     */
<span class="nc" id="L342">    public class PropertyHandler implements PropertyChangeListener {</span>
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L344">            getHandler().propertyChange(e);</span>
<span class="nc" id="L345">        }</span>
    }

<span class="nc" id="L348">    static class ColorTransferHandler extends TransferHandler implements UIResource {</span>

        ColorTransferHandler() {
<span class="nc" id="L351">            super(&quot;color&quot;);</span>
<span class="nc" id="L352">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>