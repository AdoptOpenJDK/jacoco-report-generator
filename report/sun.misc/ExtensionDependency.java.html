<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ExtensionDependency.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.misc</a> &gt; <span class="el_source">ExtensionDependency.java</span></div><h1>ExtensionDependency.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.misc;

import java.io.File;
import java.io.FilenameFilter;
import java.io.IOException;
import java.io.FileNotFoundException;
import java.util.StringTokenizer;
import java.util.Vector;
import java.util.Enumeration;
import java.util.jar.JarFile;
import java.util.jar.Manifest;
import java.util.jar.Attributes;
import java.util.jar.Attributes.Name;
import java.security.AccessController;
import java.security.PrivilegedAction;
import java.security.PrivilegedExceptionAction;
import java.security.PrivilegedActionException;
import java.net.URL;
import java.net.MalformedURLException;
import sun.net.www.ParseUtil;

/**
 * &lt;p&gt;
 * This class checks dependent extensions a particular jar file may have
 * declared through its manifest attributes.
 * &lt;/p&gt;
 * Jar file declared dependent extensions through the extension-list
 * attribute. The extension-list contains a list of keys used to
 * fetch the other attributes describing the required extension.
 * If key is the extension key declared in the extension-list
 * attribute, the following describing attribute can be found in
 * the manifest :
 * key-Extension-Name:  (Specification package name)
 * key-Specification-Version: (Specification-Version)
 * key-Implementation-Version: (Implementation-Version)
 * key-Implementation-Vendor-Id: (Imlementation-Vendor-Id)
 * key-Implementation-Version: (Implementation version)
 * key-Implementation-URL: (URL to download the requested extension)
 * &lt;p&gt;
 * This class also maintain versioning consistency of installed
 * extensions dependencies declared in jar file manifest.
 * &lt;/p&gt;
 * @author  Jerome Dochez
 */
<span class="nc" id="L70">public class ExtensionDependency {</span>

    /* Callbak interfaces to delegate installation of missing extensions */
    private static Vector&lt;ExtensionInstallationProvider&gt; providers;

    /**
     * &lt;p&gt;
     * Register an ExtensionInstallationProvider. The provider is responsible
     * for handling the installation (upgrade) of any missing extensions.
     * &lt;/p&gt;
     * @param eip ExtensionInstallationProvider implementation
     */
    public synchronized static void addExtensionInstallationProvider
        (ExtensionInstallationProvider eip)
    {
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (providers == null) {</span>
<span class="nc" id="L86">            providers = new Vector&lt;&gt;();</span>
        }
<span class="nc" id="L88">        providers.add(eip);</span>
<span class="nc" id="L89">    }</span>

    /**
     * &lt;p&gt;
     * Unregister a previously installed installation provider
     * &lt;/p&gt;
     */
    public synchronized static void removeExtensionInstallationProvider
        (ExtensionInstallationProvider eip)
    {
<span class="nc" id="L99">        providers.remove(eip);</span>
<span class="nc" id="L100">    }</span>

    /**
     * &lt;p&gt;
     * Checks the dependencies of the jar file on installed extension.
     * &lt;/p&gt;
     * @param jarFile containing the attriutes declaring the dependencies
     */
    public static boolean checkExtensionsDependencies(JarFile jar)
    {
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        if (providers == null) {</span>
            // no need to bother, nobody is registered to install missing
            // extensions
<span class="fc" id="L113">            return true;</span>
        }

        try {
<span class="nc" id="L117">            ExtensionDependency extDep = new ExtensionDependency();</span>
<span class="nc" id="L118">            return extDep.checkExtensions(jar);</span>
<span class="nc" id="L119">        } catch (ExtensionInstallationException e) {</span>
<span class="nc" id="L120">            debug(e.getMessage());</span>
        }
<span class="nc" id="L122">        return false;</span>
    }

    /*
     * Check for all declared required extensions in the jar file
     * manifest.
     */
    protected boolean checkExtensions(JarFile jar)
        throws ExtensionInstallationException
    {
        Manifest man;
        try {
<span class="nc" id="L134">            man = jar.getManifest();</span>
<span class="nc" id="L135">        } catch (IOException e) {</span>
<span class="nc" id="L136">            return false;</span>
<span class="nc" id="L137">        }</span>

<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (man == null) {</span>
            // The applet does not define a manifest file, so
            // we just assume all dependencies are satisfied.
<span class="nc" id="L142">            return true;</span>
        }

<span class="nc" id="L145">        boolean result = true;</span>
<span class="nc" id="L146">        Attributes attr = man.getMainAttributes();</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (attr != null) {</span>
            // Let's get the list of declared dependencies
<span class="nc" id="L149">            String value = attr.getValue(Name.EXTENSION_LIST);</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (value != null) {</span>
<span class="nc" id="L151">                StringTokenizer st = new StringTokenizer(value);</span>
                // Iterate over all declared dependencies
<span class="nc bnc" id="L153" title="All 2 branches missed.">                while (st.hasMoreTokens()) {</span>
<span class="nc" id="L154">                    String extensionName = st.nextToken();</span>
<span class="nc" id="L155">                    debug(&quot;The file &quot; + jar.getName() +</span>
                          &quot; appears to depend on &quot; + extensionName);
                    // Sanity Check
<span class="nc" id="L158">                    String extName = extensionName + &quot;-&quot; +</span>
<span class="nc" id="L159">                        Name.EXTENSION_NAME.toString();</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">                    if (attr.getValue(extName) == null) {</span>
<span class="nc" id="L161">                        debug(&quot;The jar file &quot; + jar.getName() +</span>
                              &quot; appers to depend on &quot;
                              + extensionName + &quot; but does not define the &quot; +
                              extName + &quot; attribute in its manifest &quot;);

                    } else {
<span class="nc bnc" id="L167" title="All 2 branches missed.">                        if (!checkExtension(extensionName, attr)) {</span>
<span class="nc" id="L168">                            debug(&quot;Failed installing &quot; + extensionName);</span>
<span class="nc" id="L169">                            result = false;</span>
                        }
                    }
<span class="nc" id="L172">                }</span>
<span class="nc" id="L173">            } else {</span>
<span class="nc" id="L174">                debug(&quot;No dependencies for &quot; + jar.getName());</span>
            }
        }
<span class="nc" id="L177">        return result;</span>
    }


    /*
     * &lt;p&gt;
     * Check that a particular dependency on an extension is satisfied.
     * &lt;/p&gt;
     * @param extensionName is the key used for the attributes in the manifest
     * @param attr is the attributes of the manifest file
     *
     * @return true if the dependency is satisfied by the installed extensions
     */
    protected synchronized boolean checkExtension(final String extensionName,
                                     final Attributes attr)
        throws ExtensionInstallationException
    {
<span class="nc" id="L194">        debug(&quot;Checking extension &quot; + extensionName);</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (checkExtensionAgainstInstalled(extensionName, attr))</span>
<span class="nc" id="L196">            return true;</span>

<span class="nc" id="L198">        debug(&quot;Extension not currently installed &quot;);</span>
<span class="nc" id="L199">        ExtensionInfo reqInfo = new ExtensionInfo(extensionName, attr);</span>
<span class="nc" id="L200">        return installExtension(reqInfo, null);</span>
    }

    /*
     * &lt;p&gt;
     * Check if a particular extension is part of the currently installed
     * extensions.
     * &lt;/p&gt;
     * @param extensionName is the key for the attributes in the manifest
     * @param attr is the attributes of the manifest
     *
     * @return true if the requested extension is already installed
     */
    boolean checkExtensionAgainstInstalled(String extensionName,
                                           Attributes attr)
        throws ExtensionInstallationException
    {
<span class="nc" id="L217">        File fExtension = checkExtensionExists(extensionName);</span>

<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (fExtension != null) {</span>
        // Extension already installed, just check against this one
            try {
<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (checkExtensionAgainst(extensionName, attr, fExtension))</span>
<span class="nc" id="L223">                    return true;</span>
<span class="nc" id="L224">            } catch (FileNotFoundException e) {</span>
<span class="nc" id="L225">                debugException(e);</span>
<span class="nc" id="L226">            } catch (IOException e) {</span>
<span class="nc" id="L227">                debugException(e);</span>
<span class="nc" id="L228">            }</span>
<span class="nc" id="L229">            return false;</span>

        } else {
        // Not sure if extension is already installed, so check all the
        // installed extension jar files to see if we get a match

            File[] installedExts;

            try {
            // Get the list of installed extension jar files so we can
            // compare the installed versus the requested extension
<span class="nc" id="L240">                installedExts = getInstalledExtensions();</span>
<span class="nc" id="L241">            } catch(IOException e) {</span>
<span class="nc" id="L242">                debugException(e);</span>
<span class="nc" id="L243">                return false;</span>
<span class="nc" id="L244">            }</span>

<span class="nc bnc" id="L246" title="All 2 branches missed.">            for (int i=0;i&lt;installedExts.length;i++) {</span>
                try {
<span class="nc bnc" id="L248" title="All 2 branches missed.">                    if (checkExtensionAgainst(extensionName, attr, installedExts[i]))</span>
<span class="nc" id="L249">                        return true;</span>
<span class="nc" id="L250">                } catch (FileNotFoundException e) {</span>
<span class="nc" id="L251">                    debugException(e);</span>
<span class="nc" id="L252">                } catch (IOException e) {</span>
<span class="nc" id="L253">                    debugException(e);</span>
                    // let's continue with the next installed extension
<span class="nc" id="L255">                }</span>
            }
        }
<span class="nc" id="L258">        return false;</span>
    }

    /*
     * &lt;p&gt;
     * Check if the requested extension described by the attributes
     * in the manifest under the key extensionName is compatible with
     * the jar file.
     * &lt;/p&gt;
     *
     * @param extensionName key in the attribute list
     * @param attr manifest file attributes
     * @param file installed extension jar file to compare the requested
     * extension against.
     */
    protected boolean checkExtensionAgainst(String extensionName,
                                            Attributes attr,
                                            final File file)
        throws IOException,
               FileNotFoundException,
               ExtensionInstallationException
    {

<span class="nc" id="L281">        debug(&quot;Checking extension &quot; + extensionName +</span>
<span class="nc" id="L282">              &quot; against &quot; + file.getName());</span>

        // Load the jar file ...
        Manifest man;
        try {
<span class="nc" id="L287">            man = AccessController.doPrivileged(</span>
<span class="nc" id="L288">                new PrivilegedExceptionAction&lt;Manifest&gt;() {</span>
                    public Manifest run()
                            throws IOException, FileNotFoundException {
<span class="nc bnc" id="L291" title="All 2 branches missed.">                         if (!file.exists())</span>
<span class="nc" id="L292">                             throw new FileNotFoundException(file.getName());</span>
<span class="nc" id="L293">                         JarFile jarFile =  new JarFile(file);</span>
<span class="nc" id="L294">                         return jarFile.getManifest();</span>
                     }
                 });
<span class="nc" id="L297">        } catch(PrivilegedActionException e) {</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">            if (e.getException() instanceof FileNotFoundException)</span>
<span class="nc" id="L299">                throw (FileNotFoundException) e.getException();</span>
<span class="nc" id="L300">            throw (IOException) e.getException();</span>
<span class="nc" id="L301">        }</span>

        // Construct the extension information object
<span class="nc" id="L304">        ExtensionInfo reqInfo = new ExtensionInfo(extensionName, attr);</span>
<span class="nc" id="L305">        debug(&quot;Requested Extension : &quot; + reqInfo);</span>

<span class="nc" id="L307">        int isCompatible = ExtensionInfo.INCOMPATIBLE;</span>
<span class="nc" id="L308">        ExtensionInfo instInfo = null;</span>

<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (man != null) {</span>
<span class="nc" id="L311">            Attributes instAttr = man.getMainAttributes();</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">            if (instAttr != null) {</span>
<span class="nc" id="L313">                instInfo = new ExtensionInfo(null, instAttr);</span>
<span class="nc" id="L314">                debug(&quot;Extension Installed &quot; + instInfo);</span>
<span class="nc" id="L315">                isCompatible = instInfo.isCompatibleWith(reqInfo);</span>
<span class="nc bnc" id="L316" title="All 3 branches missed.">                switch(isCompatible) {</span>
                case ExtensionInfo.COMPATIBLE:
<span class="nc" id="L318">                    debug(&quot;Extensions are compatible&quot;);</span>
<span class="nc" id="L319">                    return true;</span>

                case ExtensionInfo.INCOMPATIBLE:
<span class="nc" id="L322">                    debug(&quot;Extensions are incompatible&quot;);</span>
<span class="nc" id="L323">                    return false;</span>

                default:
                    // everything else
<span class="nc" id="L327">                    debug(&quot;Extensions require an upgrade or vendor switch&quot;);</span>
<span class="nc" id="L328">                    return installExtension(reqInfo, instInfo);</span>

                }
            }
        }
<span class="nc" id="L333">        return false;</span>
    }

    /*
     * &lt;p&gt;
     * An required extension is missing, if an ExtensionInstallationProvider is
     * registered, delegate the installation of that particular extension to it.
     * &lt;/p&gt;
     *
     * @param reqInfo Missing extension information
     * @param instInfo Older installed version information
     *
     * @return true if the installation is successful
     */
    protected boolean installExtension(ExtensionInfo reqInfo,
                                       ExtensionInfo instInfo)
        throws ExtensionInstallationException
    {
        Vector&lt;ExtensionInstallationProvider&gt; currentProviders;
<span class="nc" id="L352">        synchronized(providers) {</span>
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L354">            Vector&lt;ExtensionInstallationProvider&gt; tmp =</span>
<span class="nc" id="L355">                (Vector&lt;ExtensionInstallationProvider&gt;) providers.clone();</span>
<span class="nc" id="L356">            currentProviders = tmp;</span>
<span class="nc" id="L357">        }</span>
<span class="nc" id="L358">        for (Enumeration&lt;ExtensionInstallationProvider&gt; e = currentProviders.elements();</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">                e.hasMoreElements();) {</span>
<span class="nc" id="L360">            ExtensionInstallationProvider eip = e.nextElement();</span>

<span class="nc bnc" id="L362" title="All 2 branches missed.">            if (eip!=null) {</span>
                // delegate the installation to the provider
<span class="nc bnc" id="L364" title="All 2 branches missed.">                if (eip.installExtension(reqInfo, instInfo)) {</span>
<span class="nc" id="L365">                    debug(reqInfo.name + &quot; installation successful&quot;);</span>
                    Launcher.ExtClassLoader cl = (Launcher.ExtClassLoader)
<span class="nc" id="L367">                        Launcher.getLauncher().getClassLoader().getParent();</span>
<span class="nc" id="L368">                    addNewExtensionsToClassLoader(cl);</span>
<span class="nc" id="L369">                    return true;</span>
                }
            }
<span class="nc" id="L372">        }</span>
        // We have tried all of our providers, noone could install this
        // extension, we just return failure at this point
<span class="nc" id="L375">        debug(reqInfo.name + &quot; installation failed&quot;);</span>
<span class="nc" id="L376">        return false;</span>
    }

    /**
     * &lt;p&gt;
     * Checks if the extension, that is specified in the extension-list in
     * the applet jar manifest, is already installed (i.e. exists in the
     * extension directory).
     * &lt;/p&gt;
     *
     * @param extensionName extension name in the extension-list
     *
     * @return the extension if it exists in the extension directory
     */
    private File checkExtensionExists(String extensionName) {
        // Function added to fix bug 4504166
<span class="nc" id="L392">        final String extName = extensionName;</span>
<span class="nc" id="L393">        final String[] fileExt = {&quot;.jar&quot;, &quot;.zip&quot;};</span>

<span class="nc" id="L395">        return AccessController.doPrivileged(</span>
<span class="nc" id="L396">            new PrivilegedAction&lt;File&gt;() {</span>
                public File run() {
                    try {
                        File fExtension;
<span class="nc" id="L400">                        File[] dirs = getExtDirs();</span>

                        // Search the extension directories for the extension that is specified
                        // in the attribute extension-list in the applet jar manifest
<span class="nc bnc" id="L404" title="All 2 branches missed.">                        for (int i=0;i&lt;dirs.length;i++) {</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                            for (int j=0;j&lt;fileExt.length;j++) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">                                if (extName.toLowerCase().endsWith(fileExt[j])) {</span>
<span class="nc" id="L407">                                    fExtension = new File(dirs[i], extName);</span>
                                } else {
<span class="nc" id="L409">                                    fExtension = new File(dirs[i], extName+fileExt[j]);</span>
                                }
<span class="nc" id="L411">                                debug(&quot;checkExtensionExists:fileName &quot; + fExtension.getName());</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">                                if (fExtension.exists()) {</span>
<span class="nc" id="L413">                                    return fExtension;</span>
                                }
                            }
                        }
<span class="nc" id="L417">                        return null;</span>

<span class="nc" id="L419">                    } catch(Exception e) {</span>
<span class="nc" id="L420">                         debugException(e);</span>
<span class="nc" id="L421">                         return null;</span>
                    }
                }
            });
    }

    /**
     * &lt;p&gt;
     * @return the java.ext.dirs property as a list of directory
     * &lt;/p&gt;
     */
    private static File[] getExtDirs() {
<span class="nc" id="L433">        String s = java.security.AccessController.doPrivileged(</span>
                new sun.security.action.GetPropertyAction(&quot;java.ext.dirs&quot;));

        File[] dirs;
<span class="nc bnc" id="L437" title="All 2 branches missed.">        if (s != null) {</span>
<span class="nc" id="L438">            StringTokenizer st =</span>
                new StringTokenizer(s, File.pathSeparator);
<span class="nc" id="L440">            int count = st.countTokens();</span>
<span class="nc" id="L441">            debug(&quot;getExtDirs count &quot; + count);</span>
<span class="nc" id="L442">            dirs = new File[count];</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">            for (int i = 0; i &lt; count; i++) {</span>
<span class="nc" id="L444">                dirs[i] = new File(st.nextToken());</span>
<span class="nc" id="L445">                debug(&quot;getExtDirs dirs[&quot;+i+&quot;] &quot;+ dirs[i]);</span>
            }
<span class="nc" id="L447">        } else {</span>
<span class="nc" id="L448">            dirs = new File[0];</span>
<span class="nc" id="L449">            debug(&quot;getExtDirs dirs &quot; + dirs);</span>
        }
<span class="nc" id="L451">        debug(&quot;getExtDirs dirs.length &quot; + dirs.length);</span>
<span class="nc" id="L452">        return dirs;</span>
    }

    /*
     * &lt;p&gt;
     * Scan the directories and return all files installed in those
     * &lt;/p&gt;
     * @param dirs list of directories to scan
     *
     * @return the list of files installed in all the directories
     */
    private static File[] getExtFiles(File[] dirs) throws IOException {
<span class="nc" id="L464">        Vector&lt;File&gt; urls = new Vector&lt;File&gt;();</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">        for (int i = 0; i &lt; dirs.length; i++) {</span>
<span class="nc" id="L466">            String[] files = dirs[i].list(new JarFilter());</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">            if (files != null) {</span>
<span class="nc" id="L468">                debug(&quot;getExtFiles files.length &quot; + files.length);</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">                for (int j = 0; j &lt; files.length; j++) {</span>
<span class="nc" id="L470">                    File f = new File(dirs[i], files[j]);</span>
<span class="nc" id="L471">                    urls.add(f);</span>
<span class="nc" id="L472">                    debug(&quot;getExtFiles f[&quot;+j+&quot;] &quot;+ f);</span>
                }
            }
        }
<span class="nc" id="L476">        File[] ua = new File[urls.size()];</span>
<span class="nc" id="L477">        urls.copyInto(ua);</span>
<span class="nc" id="L478">        debug(&quot;getExtFiles ua.length &quot; + ua.length);</span>
<span class="nc" id="L479">        return ua;</span>
    }

    /*
     * &lt;p&gt;
     * @return the list of installed extensions jar files
     * &lt;/p&gt;
     */
    private File[] getInstalledExtensions() throws IOException {
<span class="nc" id="L488">        return AccessController.doPrivileged(</span>
<span class="nc" id="L489">            new PrivilegedAction&lt;File[]&gt;() {</span>
                public File[] run() {
                     try {
<span class="nc" id="L492">                         return getExtFiles(getExtDirs());</span>
<span class="nc" id="L493">                     } catch(IOException e) {</span>
<span class="nc" id="L494">                         debug(&quot;Cannot get list of installed extensions&quot;);</span>
<span class="nc" id="L495">                         debugException(e);</span>
<span class="nc" id="L496">                        return new File[0];</span>
                     }
                 }
            });
    }

    /*
     * &lt;p&gt;
     * Add the newly installed jar file to the extension class loader.
     * &lt;/p&gt;
     *
     * @param cl the current installed extension class loader
     *
     * @return true if successful
     */
    private Boolean addNewExtensionsToClassLoader(Launcher.ExtClassLoader cl) {
        try {
<span class="nc" id="L513">            File[] installedExts = getInstalledExtensions();</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">            for (int i=0;i&lt;installedExts.length;i++) {</span>
<span class="nc" id="L515">                final File instFile = installedExts[i];</span>
<span class="nc" id="L516">                URL instURL = AccessController.doPrivileged(</span>
<span class="nc" id="L517">                    new PrivilegedAction&lt;URL&gt;() {</span>
                        public URL run() {
                            try {
<span class="nc" id="L520">                                return ParseUtil.fileToEncodedURL(instFile);</span>
<span class="nc" id="L521">                            } catch (MalformedURLException e) {</span>
<span class="nc" id="L522">                                debugException(e);</span>
<span class="nc" id="L523">                                return null;</span>
                            }
                        }
                    });
<span class="nc bnc" id="L527" title="All 2 branches missed.">                if (instURL != null) {</span>
<span class="nc" id="L528">                    URL[] urls = cl.getURLs();</span>
<span class="nc" id="L529">                    boolean found=false;</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">                    for (int j = 0; j&lt;urls.length; j++) {</span>
<span class="nc" id="L531">                        debug(&quot;URL[&quot;+j+&quot;] is &quot; + urls[j] + &quot; looking for &quot;+</span>
                                           instURL);
<span class="nc bnc" id="L533" title="All 2 branches missed.">                        if (urls[j].toString().compareToIgnoreCase(</span>
<span class="nc" id="L534">                                    instURL.toString())==0) {</span>
<span class="nc" id="L535">                            found=true;</span>
<span class="nc" id="L536">                            debug(&quot;Found !&quot;);</span>
                        }
                    }
<span class="nc bnc" id="L539" title="All 2 branches missed.">                    if (!found) {</span>
<span class="nc" id="L540">                        debug(&quot;Not Found ! adding to the classloader &quot; +</span>
                              instURL);
<span class="nc" id="L542">                        cl.addExtURL(instURL);</span>
                    }
                }
            }
<span class="nc" id="L546">        } catch (MalformedURLException e) {</span>
<span class="nc" id="L547">            e.printStackTrace();</span>
<span class="nc" id="L548">        } catch (IOException e) {</span>
<span class="nc" id="L549">            e.printStackTrace();</span>
            // let's continue with the next installed extension
<span class="nc" id="L551">        }</span>
<span class="nc" id="L552">        return Boolean.TRUE;</span>
    }

    // True to display all debug and trace messages
    static final boolean DEBUG = false;

    private static void debug(String s) {
        if (DEBUG) {
            System.err.println(s);
        }
<span class="nc" id="L562">    }</span>

    private void debugException(Throwable e) {
        if (DEBUG) {
            e.printStackTrace();
        }
<span class="nc" id="L568">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>