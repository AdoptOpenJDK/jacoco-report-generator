<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UnicodeSetIterator.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.text.normalizer</a> &gt; <span class="el_source">UnicodeSetIterator.java</span></div><h1>UnicodeSetIterator.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2005, 2011, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
/*
 *******************************************************************************
 * (C) Copyright IBM Corp. and others, 1996-2009 - All Rights Reserved         *
 *                                                                             *
 * The original version of this source code and documentation is copyrighted   *
 * and owned by IBM, These materials are provided under terms of a License     *
 * Agreement between IBM and Sun. This technology is protected by multiple     *
 * US and International patents. This notice and attribution to IBM may not    *
 * to removed.                                                                 *
 *******************************************************************************
 */

package sun.text.normalizer;

import java.util.Iterator;

/**
 * UnicodeSetIterator iterates over the contents of a UnicodeSet.  It
 * iterates over either code points or code point ranges.  After all
 * code points or ranges have been returned, it returns the
 * multicharacter strings of the UnicodSet, if any.
 *
 * &lt;p&gt;To iterate over code points, use a loop like this:
 * &lt;pre&gt;
 * UnicodeSetIterator it(set);
 * while (set.next()) {
 *   if (set.codepoint != UnicodeSetIterator::IS_STRING) {
 *     processCodepoint(set.codepoint);
 *   } else {
 *     processString(set.string);
 *   }
 * }
 * &lt;/pre&gt;
 *
 * &lt;p&gt;To iterate over code point ranges, use a loop like this:
 * &lt;pre&gt;
 * UnicodeSetIterator it(set);
 * while (set.nextRange()) {
 *   if (set.codepoint != UnicodeSetIterator::IS_STRING) {
 *     processCodepointRange(set.codepoint, set.codepointEnd);
 *   } else {
 *     processString(set.string);
 *   }
 * }
 * &lt;/pre&gt;
 * @author M. Davis
 * @stable ICU 2.0
 */
public class UnicodeSetIterator {

    /**
     * Value of &lt;tt&gt;codepoint&lt;/tt&gt; if the iterator points to a string.
     * If &lt;tt&gt;codepoint == IS_STRING&lt;/tt&gt;, then examine
     * &lt;tt&gt;string&lt;/tt&gt; for the current iteration result.
     * @stable ICU 2.0
     */
<span class="nc" id="L81">    public static int IS_STRING = -1;</span>

    /**
     * Current code point, or the special value &lt;tt&gt;IS_STRING&lt;/tt&gt;, if
     * the iterator points to a string.
     * @stable ICU 2.0
     */
    public int codepoint;

    /**
     * When iterating over ranges using &lt;tt&gt;nextRange()&lt;/tt&gt;,
     * &lt;tt&gt;codepointEnd&lt;/tt&gt; contains the inclusive end of the
     * iteration range, if &lt;tt&gt;codepoint != IS_STRING&lt;/tt&gt;.  If
     * iterating over code points using &lt;tt&gt;next()&lt;/tt&gt;, or if
     * &lt;tt&gt;codepoint == IS_STRING&lt;/tt&gt;, then the value of
     * &lt;tt&gt;codepointEnd&lt;/tt&gt; is undefined.
     * @stable ICU 2.0
     */
    public int codepointEnd;

    /**
     * If &lt;tt&gt;codepoint == IS_STRING&lt;/tt&gt;, then &lt;tt&gt;string&lt;/tt&gt; points
     * to the current string.  If &lt;tt&gt;codepoint != IS_STRING&lt;/tt&gt;, the
     * value of &lt;tt&gt;string&lt;/tt&gt; is undefined.
     * @stable ICU 2.0
     */
    public String string;

    /**
     * Create an iterator over the given set.
     * @param set set to iterate over
     * @stable ICU 2.0
     */
<span class="nc" id="L114">    public UnicodeSetIterator(UnicodeSet set) {</span>
<span class="nc" id="L115">        reset(set);</span>
<span class="nc" id="L116">    }</span>

    /**
     * Returns the next element in the set, either a code point range
     * or a string.  If there are no more elements in the set, return
     * false.  If &lt;tt&gt;codepoint == IS_STRING&lt;/tt&gt;, the value is a
     * string in the &lt;tt&gt;string&lt;/tt&gt; field.  Otherwise the value is a
     * range of one or more code points from &lt;tt&gt;codepoint&lt;/tt&gt; to
     * &lt;tt&gt;codepointeEnd&lt;/tt&gt; inclusive.
     *
     * &lt;p&gt;The order of iteration is all code points ranges in sorted
     * order, followed by all strings sorted order.  Ranges are
     * disjoint and non-contiguous.  &lt;tt&gt;string&lt;/tt&gt; is undefined
     * unless &lt;tt&gt;codepoint == IS_STRING&lt;/tt&gt;.  Do not mix calls to
     * &lt;tt&gt;next()&lt;/tt&gt; and &lt;tt&gt;nextRange()&lt;/tt&gt; without calling
     * &lt;tt&gt;reset()&lt;/tt&gt; between them.  The results of doing so are
     * undefined.
     *
     * @return true if there was another element in the set and this
     * object contains the element.
     * @stable ICU 2.0
     */
    public boolean nextRange() {
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (nextElement &lt;= endElement) {</span>
<span class="nc" id="L140">            codepointEnd = endElement;</span>
<span class="nc" id="L141">            codepoint = nextElement;</span>
<span class="nc" id="L142">            nextElement = endElement+1;</span>
<span class="nc" id="L143">            return true;</span>
        }
<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (range &lt; endRange) {</span>
<span class="nc" id="L146">            loadRange(++range);</span>
<span class="nc" id="L147">            codepointEnd = endElement;</span>
<span class="nc" id="L148">            codepoint = nextElement;</span>
<span class="nc" id="L149">            nextElement = endElement+1;</span>
<span class="nc" id="L150">            return true;</span>
        }

        // stringIterator == null iff there are no string elements remaining

<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (stringIterator == null) return false;</span>
<span class="nc" id="L156">        codepoint = IS_STRING; // signal that value is actually a string</span>
<span class="nc" id="L157">        string = stringIterator.next();</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">        if (!stringIterator.hasNext()) stringIterator = null;</span>
<span class="nc" id="L159">        return true;</span>
    }

    /**
     * Sets this iterator to visit the elements of the given set and
     * resets it to the start of that set.  The iterator is valid only
     * so long as &lt;tt&gt;set&lt;/tt&gt; is valid.
     * @param set the set to iterate over.
     * @stable ICU 2.0
     */
    public void reset(UnicodeSet uset) {
<span class="nc" id="L170">        set = uset;</span>
<span class="nc" id="L171">        reset();</span>
<span class="nc" id="L172">    }</span>

    /**
     * Resets this iterator to the start of the set.
     * @stable ICU 2.0
     */
    public void reset() {
<span class="nc" id="L179">        endRange = set.getRangeCount() - 1;</span>
<span class="nc" id="L180">        range = 0;</span>
<span class="nc" id="L181">        endElement = -1;</span>
<span class="nc" id="L182">        nextElement = 0;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (endRange &gt;= 0) {</span>
<span class="nc" id="L184">            loadRange(range);</span>
        }
<span class="nc" id="L186">        stringIterator = null;</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">        if (set.strings != null) {</span>
<span class="nc" id="L188">            stringIterator = set.strings.iterator();</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">            if (!stringIterator.hasNext()) stringIterator = null;</span>
        }
<span class="nc" id="L191">    }</span>

    // ======================= PRIVATES ===========================

    private UnicodeSet set;
<span class="nc" id="L196">    private int endRange = 0;</span>
<span class="nc" id="L197">    private int range = 0;</span>
    /**
     * @internal
     */
    protected int endElement;
    /**
     * @internal
     */
    protected int nextElement;
<span class="nc" id="L206">    private Iterator&lt;String&gt; stringIterator = null;</span>

    /**
     * Invariant: stringIterator is null when there are no (more) strings remaining
     */

    /**
     * @internal
     */
    protected void loadRange(int aRange) {
<span class="nc" id="L216">        nextElement = set.getRangeStart(aRange);</span>
<span class="nc" id="L217">        endElement = set.getRangeEnd(aRange);</span>
<span class="nc" id="L218">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>