<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>ConnectDialog.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.tools.jconsole</a> &gt; <span class="el_source">ConnectDialog.java</span></div><h1>ConnectDialog.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2004, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.tools.jconsole;

import java.util.List;
import java.awt.*;
import java.awt.event.*;
import java.util.*;

import javax.swing.*;
import javax.swing.border.*;
import javax.swing.event.*;
import javax.swing.plaf.basic.BasicRadioButtonUI;
import javax.swing.table.*;



import static java.awt.BorderLayout.*;
import static javax.swing.ListSelectionModel.*;
import static sun.tools.jconsole.Utilities.*;

@SuppressWarnings(&quot;serial&quot;)
public class ConnectDialog extends InternalDialog
                implements DocumentListener, FocusListener,
                           ItemListener, ListSelectionListener, KeyListener {

    private static final int COL_NAME = 0;
    private static final int COL_PID  = 1;


    JConsole jConsole;
    JTextField userNameTF, passwordTF;
    JRadioButton localRadioButton, remoteRadioButton;
    JLabel localMessageLabel, remoteMessageLabel;
    JTextField remoteTF;
    JButton connectButton, cancelButton;
    JPanel radioButtonPanel;

<span class="nc" id="L62">    private Icon mastheadIcon =</span>
        new MastheadIcon(Messages.CONNECT_DIALOG_MASTHEAD_TITLE);
    private Color hintTextColor, disabledTableCellColor;

    // The table of managed VM (local process)
    JTable vmTable;
<span class="nc" id="L68">    ManagedVmTableModel vmModel = null;</span>

<span class="nc" id="L70">    JScrollPane localTableScrollPane = null;</span>

    private Action connectAction, cancelAction;


    public ConnectDialog(JConsole jConsole) {
<span class="nc" id="L76">        super(jConsole, Messages.CONNECT_DIALOG_TITLE, true);</span>

<span class="nc" id="L78">        this.jConsole = jConsole;</span>
<span class="nc" id="L79">        setAccessibleDescription(this,</span>
                                 Messages.CONNECT_DIALOG_ACCESSIBLE_DESCRIPTION);
<span class="nc" id="L81">        setDefaultCloseOperation(HIDE_ON_CLOSE);</span>
<span class="nc" id="L82">        setResizable(false);</span>
<span class="nc" id="L83">        Container cp = (JComponent)getContentPane();</span>

<span class="nc" id="L85">        radioButtonPanel = new JPanel(new BorderLayout(0, 12));</span>
<span class="nc" id="L86">        radioButtonPanel.setBorder(new EmptyBorder(6, 12, 12, 12));</span>
<span class="nc" id="L87">        ButtonGroup radioButtonGroup = new ButtonGroup();</span>
<span class="nc" id="L88">        JPanel bottomPanel = new JPanel(new BorderLayout());</span>

<span class="nc" id="L90">        statusBar = new JLabel(&quot; &quot;, JLabel.CENTER);</span>
<span class="nc" id="L91">        setAccessibleName(statusBar,</span>
                          Messages.CONNECT_DIALOG_STATUS_BAR_ACCESSIBLE_NAME);

<span class="nc" id="L94">        Font normalLabelFont = statusBar.getFont();</span>
<span class="nc" id="L95">        Font boldLabelFont = normalLabelFont.deriveFont(Font.BOLD);</span>
<span class="nc" id="L96">        Font smallLabelFont = normalLabelFont.deriveFont(normalLabelFont.getSize2D() - 1);</span>

<span class="nc" id="L98">        JLabel mastheadLabel = new JLabel(mastheadIcon);</span>
<span class="nc" id="L99">        setAccessibleName(mastheadLabel,</span>
                          Messages.CONNECT_DIALOG_MASTHEAD_ACCESSIBLE_NAME);

<span class="nc" id="L102">        cp.add(mastheadLabel, NORTH);</span>
<span class="nc" id="L103">        cp.add(radioButtonPanel, CENTER);</span>
<span class="nc" id="L104">        cp.add(bottomPanel, SOUTH);</span>

<span class="nc" id="L106">        createActions();</span>

<span class="nc" id="L108">        remoteTF = new JTextField();</span>
<span class="nc" id="L109">        remoteTF.addActionListener(connectAction);</span>
<span class="nc" id="L110">        remoteTF.getDocument().addDocumentListener(this);</span>
<span class="nc" id="L111">        remoteTF.addFocusListener(this);</span>
<span class="nc" id="L112">        remoteTF.setPreferredSize(remoteTF.getPreferredSize());</span>
<span class="nc" id="L113">        setAccessibleName(remoteTF,</span>
                          Messages.REMOTE_PROCESS_TEXT_FIELD_ACCESSIBLE_NAME);

        //
        // If the VM supports the local attach mechanism (is: Sun
        // implementation) then the Local Process panel is created.
        //
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (JConsole.isLocalAttachAvailable()) {</span>
<span class="nc" id="L121">            vmModel = new ManagedVmTableModel();</span>
<span class="nc" id="L122">            vmTable = new LocalTabJTable(vmModel);</span>
<span class="nc" id="L123">            vmTable.setSelectionMode(SINGLE_SELECTION);</span>
<span class="nc" id="L124">            vmTable.setPreferredScrollableViewportSize(new Dimension(400, 250));</span>
<span class="nc" id="L125">            vmTable.setColumnSelectionAllowed(false);</span>
<span class="nc" id="L126">            vmTable.addFocusListener(this);</span>
<span class="nc" id="L127">            vmTable.getSelectionModel().addListSelectionListener(this);</span>

<span class="nc" id="L129">            TableColumnModel columnModel = vmTable.getColumnModel();</span>

<span class="nc" id="L131">            TableColumn pidColumn = columnModel.getColumn(COL_PID);</span>
<span class="nc" id="L132">            pidColumn.setMaxWidth(getLabelWidth(&quot;9999999&quot;));</span>
<span class="nc" id="L133">            pidColumn.setResizable(false);</span>

<span class="nc" id="L135">            TableColumn cmdLineColumn = columnModel.getColumn(COL_NAME);</span>
<span class="nc" id="L136">            cmdLineColumn.setResizable(false);</span>

<span class="nc" id="L138">            localRadioButton = new JRadioButton(Messages.LOCAL_PROCESS_COLON);</span>
<span class="nc" id="L139">            localRadioButton.setMnemonic(Resources.getMnemonicInt(Messages.LOCAL_PROCESS_COLON));</span>
<span class="nc" id="L140">            localRadioButton.setFont(boldLabelFont);</span>
<span class="nc" id="L141">            localRadioButton.addItemListener(this);</span>
<span class="nc" id="L142">            radioButtonGroup.add(localRadioButton);</span>

<span class="nc" id="L144">            JPanel localPanel = new JPanel(new BorderLayout());</span>

<span class="nc" id="L146">            JPanel localTablePanel = new JPanel(new BorderLayout());</span>

<span class="nc" id="L148">            radioButtonPanel.add(localPanel, NORTH);</span>

<span class="nc" id="L150">            localPanel.add(localRadioButton, NORTH);</span>
<span class="nc" id="L151">            localPanel.add(new Padder(localRadioButton), LINE_START);</span>
<span class="nc" id="L152">            localPanel.add(localTablePanel, CENTER);</span>

<span class="nc" id="L154">            localTableScrollPane = new JScrollPane(vmTable);</span>

<span class="nc" id="L156">            localTablePanel.add(localTableScrollPane, NORTH);</span>

<span class="nc" id="L158">            localMessageLabel = new JLabel(&quot; &quot;);</span>
<span class="nc" id="L159">            localMessageLabel.setFont(smallLabelFont);</span>
<span class="nc" id="L160">            localMessageLabel.setForeground(hintTextColor);</span>
<span class="nc" id="L161">            localTablePanel.add(localMessageLabel, SOUTH);</span>
        }

<span class="nc" id="L164">        remoteRadioButton = new JRadioButton(Messages.REMOTE_PROCESS_COLON);</span>
<span class="nc" id="L165">        remoteRadioButton.setMnemonic(Resources.getMnemonicInt(Messages.REMOTE_PROCESS_COLON));</span>
<span class="nc" id="L166">        remoteRadioButton.setFont(boldLabelFont);</span>
<span class="nc" id="L167">        radioButtonGroup.add(remoteRadioButton);</span>

<span class="nc" id="L169">        JPanel remotePanel = new JPanel(new BorderLayout());</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (localRadioButton != null) {</span>
<span class="nc" id="L171">            remotePanel.add(remoteRadioButton, NORTH);</span>
<span class="nc" id="L172">            remotePanel.add(new Padder(remoteRadioButton), LINE_START);</span>

<span class="nc" id="L174">            Action nextRadioButtonAction =</span>
<span class="nc" id="L175">                new AbstractAction(&quot;nextRadioButton&quot;) {</span>
                    public void actionPerformed(ActionEvent ev) {
<span class="nc" id="L177">                        JRadioButton rb =</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">                            (ev.getSource() == localRadioButton) ? remoteRadioButton</span>
                                                                 : localRadioButton;
<span class="nc" id="L180">                        rb.doClick();</span>
<span class="nc" id="L181">                        rb.requestFocus();</span>
<span class="nc" id="L182">                    }</span>
                };

<span class="nc" id="L185">            localRadioButton.getActionMap().put(&quot;nextRadioButton&quot;, nextRadioButtonAction);</span>
<span class="nc" id="L186">            remoteRadioButton.getActionMap().put(&quot;nextRadioButton&quot;, nextRadioButtonAction);</span>

<span class="nc" id="L188">            localRadioButton.getInputMap().put(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, 0),</span>
                                               &quot;nextRadioButton&quot;);
<span class="nc" id="L190">            remoteRadioButton.getInputMap().put(KeyStroke.getKeyStroke(KeyEvent.VK_UP, 0),</span>
                                                &quot;nextRadioButton&quot;);
<span class="nc" id="L192">        } else {</span>
<span class="nc" id="L193">            JLabel remoteLabel = new JLabel(remoteRadioButton.getText());</span>
<span class="nc" id="L194">            remoteLabel.setFont(boldLabelFont);</span>
<span class="nc" id="L195">            remotePanel.add(remoteLabel, NORTH);</span>
        }
<span class="nc" id="L197">        radioButtonPanel.add(remotePanel, SOUTH);</span>

<span class="nc" id="L199">        JPanel remoteTFPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L200">        remotePanel.add(remoteTFPanel, CENTER);</span>

<span class="nc" id="L202">        remoteTFPanel.add(remoteTF, NORTH);</span>

<span class="nc" id="L204">        remoteMessageLabel = new JLabel(&quot;&lt;html&gt;&quot; + Messages.REMOTE_TF_USAGE + &quot;&lt;/html&gt;&quot;);</span>
<span class="nc" id="L205">        remoteMessageLabel.setFont(smallLabelFont);</span>
<span class="nc" id="L206">        remoteMessageLabel.setForeground(hintTextColor);</span>
<span class="nc" id="L207">        remoteTFPanel.add(remoteMessageLabel, CENTER);</span>

<span class="nc" id="L209">        JPanel userPwdPanel = new JPanel(new FlowLayout(FlowLayout.LEADING, 0, 0));</span>
<span class="nc" id="L210">        userPwdPanel.setBorder(new EmptyBorder(12, 0, 0, 0)); // top padding</span>

<span class="nc bnc" id="L212" title="All 2 branches missed.">        int tfWidth = JConsole.IS_WIN ? 12 : 8;</span>

<span class="nc" id="L214">        userNameTF = new JTextField(tfWidth);</span>
<span class="nc" id="L215">        userNameTF.addActionListener(connectAction);</span>
<span class="nc" id="L216">        userNameTF.getDocument().addDocumentListener(this);</span>
<span class="nc" id="L217">        userNameTF.addFocusListener(this);</span>
<span class="nc" id="L218">        setAccessibleName(userNameTF,</span>
            Messages.USERNAME_ACCESSIBLE_NAME);
        LabeledComponent lc;
<span class="nc" id="L221">        lc = new LabeledComponent(Messages.USERNAME_COLON_,</span>
<span class="nc" id="L222">                                  Resources.getMnemonicInt(Messages.USERNAME_COLON_),</span>
                                  userNameTF);
<span class="nc" id="L224">        lc.label.setFont(boldLabelFont);</span>
<span class="nc" id="L225">        userPwdPanel.add(lc);</span>

<span class="nc" id="L227">        passwordTF = new JPasswordField(tfWidth);</span>
        // Heights differ, so fix here
<span class="nc" id="L229">        passwordTF.setPreferredSize(userNameTF.getPreferredSize());</span>
<span class="nc" id="L230">        passwordTF.addActionListener(connectAction);</span>
<span class="nc" id="L231">        passwordTF.getDocument().addDocumentListener(this);</span>
<span class="nc" id="L232">        passwordTF.addFocusListener(this);</span>
<span class="nc" id="L233">        setAccessibleName(passwordTF,</span>
            Messages.PASSWORD_ACCESSIBLE_NAME);

<span class="nc" id="L236">        lc = new LabeledComponent(Messages.PASSWORD_COLON_,</span>
<span class="nc" id="L237">                                  Resources.getMnemonicInt(Messages.PASSWORD_COLON_),</span>
                                  passwordTF);
<span class="nc" id="L239">        lc.setBorder(new EmptyBorder(0, 12, 0, 0)); // Left padding</span>
<span class="nc" id="L240">        lc.label.setFont(boldLabelFont);</span>
<span class="nc" id="L241">        userPwdPanel.add(lc);</span>

<span class="nc" id="L243">        remoteTFPanel.add(userPwdPanel, SOUTH);</span>

<span class="nc" id="L245">        String connectButtonToolTipText =</span>
            Messages.CONNECT_DIALOG_CONNECT_BUTTON_TOOLTIP;
<span class="nc" id="L247">        connectButton = new JButton(connectAction);</span>
<span class="nc" id="L248">        connectButton.setToolTipText(connectButtonToolTipText);</span>

<span class="nc" id="L250">        cancelButton = new JButton(cancelAction);</span>

<span class="nc" id="L252">        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.TRAILING));</span>
<span class="nc" id="L253">        buttonPanel.setBorder(new EmptyBorder(12, 12, 2, 12));</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">        if (JConsole.IS_GTK) {</span>
<span class="nc" id="L255">            buttonPanel.add(cancelButton);</span>
<span class="nc" id="L256">            buttonPanel.add(connectButton);</span>
        } else {
<span class="nc" id="L258">            buttonPanel.add(connectButton);</span>
<span class="nc" id="L259">            buttonPanel.add(cancelButton);</span>
        }
<span class="nc" id="L261">        bottomPanel.add(buttonPanel, NORTH);</span>

<span class="nc" id="L263">        bottomPanel.add(statusBar, SOUTH);</span>

<span class="nc" id="L265">        updateButtonStates();</span>
<span class="nc" id="L266">        Utilities.updateTransparency(this);</span>
<span class="nc" id="L267">    }</span>

    public void revalidate() {
        // Adjust some colors
<span class="nc" id="L271">        Color disabledForeground = UIManager.getColor(&quot;Label.disabledForeground&quot;);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (disabledForeground == null) {</span>
            // fall back for Nimbus that doesn't support 'Label.disabledForeground'
<span class="nc" id="L274">            disabledForeground = UIManager.getColor(&quot;Label.disabledText&quot;);</span>
        }
<span class="nc" id="L276">        hintTextColor =</span>
<span class="nc" id="L277">            ensureContrast(disabledForeground,</span>
<span class="nc" id="L278">                           UIManager.getColor(&quot;Panel.background&quot;));</span>
<span class="nc" id="L279">        disabledTableCellColor =</span>
<span class="nc" id="L280">            ensureContrast(new Color(0x808080),</span>
<span class="nc" id="L281">                           UIManager.getColor(&quot;Table.background&quot;));</span>

<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (remoteMessageLabel != null) {</span>
<span class="nc" id="L284">            remoteMessageLabel.setForeground(hintTextColor);</span>
            // Update html color setting
<span class="nc" id="L286">            String colorStr =</span>
<span class="nc" id="L287">                String.format(&quot;%06x&quot;, hintTextColor.getRGB() &amp; 0xFFFFFF);</span>
<span class="nc" id="L288">            remoteMessageLabel.setText(&quot;&lt;html&gt;&lt;font color=#&quot; + colorStr + &quot;&gt;&quot; +</span>
                                       Messages.REMOTE_TF_USAGE);
        }
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (localMessageLabel != null) {</span>
<span class="nc" id="L292">            localMessageLabel.setForeground(hintTextColor);</span>
            // Update html color setting
<span class="nc" id="L294">            valueChanged(null);</span>
        }

<span class="nc" id="L297">        super.revalidate();</span>
<span class="nc" id="L298">    }</span>

    private void createActions() {
<span class="nc" id="L301">        connectAction = new AbstractAction(Messages.CONNECT) {</span>
            /* init */ {
<span class="nc" id="L303">                putValue(Action.MNEMONIC_KEY, Resources.getMnemonicInt(Messages.CONNECT));</span>
<span class="nc" id="L304">            }</span>

            public void actionPerformed(ActionEvent ev) {
<span class="nc bnc" id="L307" title="All 4 branches missed.">                if (!isEnabled() || !isVisible()) {</span>
<span class="nc" id="L308">                    return;</span>
                }
<span class="nc" id="L310">                setVisible(false);</span>
<span class="nc" id="L311">                statusBar.setText(&quot;&quot;);</span>

<span class="nc bnc" id="L313" title="All 2 branches missed.">                if (remoteRadioButton.isSelected()) {</span>
<span class="nc" id="L314">                    String txt = remoteTF.getText().trim();</span>
<span class="nc" id="L315">                    String userName = userNameTF.getText().trim();</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                    userName = userName.equals(&quot;&quot;) ? null : userName;</span>
<span class="nc" id="L317">                    String password = passwordTF.getText();</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">                    password = password.equals(&quot;&quot;) ? null : password;</span>
                    try {
<span class="nc bnc" id="L320" title="All 2 branches missed.">                        if (txt.startsWith(JConsole.ROOT_URL)) {</span>
<span class="nc" id="L321">                            String url = txt;</span>
<span class="nc" id="L322">                            jConsole.addUrl(url, userName, password, false);</span>
<span class="nc" id="L323">                            remoteTF.setText(JConsole.ROOT_URL);</span>
<span class="nc" id="L324">                            return;</span>
                        } else {
<span class="nc" id="L326">                            String host = remoteTF.getText().trim();</span>
<span class="nc" id="L327">                            String port = &quot;0&quot;;</span>
<span class="nc" id="L328">                            int index = host.lastIndexOf(&quot;:&quot;);</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">                            if (index &gt;= 0) {</span>
<span class="nc" id="L330">                                port = host.substring(index + 1);</span>
<span class="nc" id="L331">                                host = host.substring(0, index);</span>
                            }
<span class="nc bnc" id="L333" title="All 4 branches missed.">                            if (host.length() &gt; 0 &amp;&amp; port.length() &gt; 0) {</span>
<span class="nc" id="L334">                                int p = Integer.parseInt(port.trim());</span>
<span class="nc" id="L335">                                jConsole.addHost(host, p, userName, password);</span>
<span class="nc" id="L336">                                remoteTF.setText(&quot;&quot;);</span>
<span class="nc" id="L337">                                userNameTF.setText(&quot;&quot;);</span>
<span class="nc" id="L338">                                passwordTF.setText(&quot;&quot;);</span>
<span class="nc" id="L339">                                return;</span>
                            }
                        }
<span class="nc" id="L342">                    } catch (Exception ex) {</span>
<span class="nc" id="L343">                        statusBar.setText(ex.toString());</span>
<span class="nc" id="L344">                    }</span>
<span class="nc" id="L345">                    setVisible(true);</span>
<span class="nc bnc" id="L346" title="All 4 branches missed.">                } else if (localRadioButton != null &amp;&amp; localRadioButton.isSelected()) {</span>
                    // Try to connect to selected VM. If a connection
                    // cannot be established for some reason (the process has
                    // terminated for example) then keep the dialog open showing
                    // the connect error.
                    //
<span class="nc" id="L352">                    int row = vmTable.getSelectedRow();</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">                    if (row &gt;= 0) {</span>
<span class="nc" id="L354">                        jConsole.addVmid(vmModel.vmAt(row));</span>
                    }
<span class="nc" id="L356">                    refresh();</span>
                }
<span class="nc" id="L358">            }</span>
        };

<span class="nc" id="L361">        cancelAction = new AbstractAction(Messages.CANCEL) {</span>
            public void actionPerformed(ActionEvent ev) {
<span class="nc" id="L363">                setVisible(false);</span>
<span class="nc" id="L364">                statusBar.setText(&quot;&quot;);</span>
<span class="nc" id="L365">            }</span>
        };
<span class="nc" id="L367">    }</span>


    // a label used solely for calculating the width
<span class="nc" id="L371">    private static JLabel tmpLabel = new JLabel();</span>
    public static int getLabelWidth(String text) {
<span class="nc" id="L373">        tmpLabel.setText(text);</span>
<span class="nc" id="L374">        return (int) tmpLabel.getPreferredSize().getWidth() + 1;</span>
    }

    private class LocalTabJTable extends JTable {
        ManagedVmTableModel vmModel;
<span class="nc" id="L379">        Border rendererBorder = new EmptyBorder(0, 6, 0, 6);</span>

<span class="nc" id="L381">        public LocalTabJTable(ManagedVmTableModel model) {</span>
<span class="nc" id="L382">            super(model);</span>
<span class="nc" id="L383">            this.vmModel = model;</span>

            // Remove vertical lines, expect for GTK L&amp;F.
            // (because GTK doesn't show header dividers)
<span class="nc bnc" id="L387" title="All 2 branches missed.">            if (!JConsole.IS_GTK) {</span>
<span class="nc" id="L388">                setShowVerticalLines(false);</span>
<span class="nc" id="L389">                setIntercellSpacing(new Dimension(0, 1));</span>
            }

            // Double-click handler
<span class="nc" id="L393">            addMouseListener(new MouseAdapter() {</span>
                public void mouseClicked(MouseEvent evt) {
<span class="nc bnc" id="L395" title="All 2 branches missed.">                    if (evt.getClickCount() == 2) {</span>
<span class="nc" id="L396">                        connectButton.doClick();</span>
                    }
<span class="nc" id="L398">                }</span>
            });

            // Enter should call default action
<span class="nc" id="L402">            getActionMap().put(&quot;connect&quot;, connectAction);</span>
<span class="nc" id="L403">            InputMap inputMap = getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);</span>
<span class="nc" id="L404">            inputMap.put(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, 0), &quot;connect&quot;);</span>
<span class="nc" id="L405">        }</span>

        public String getToolTipText(MouseEvent e) {
<span class="nc" id="L408">            String tip = null;</span>
<span class="nc" id="L409">            java.awt.Point p = e.getPoint();</span>
<span class="nc" id="L410">            int rowIndex = rowAtPoint(p);</span>
<span class="nc" id="L411">            int colIndex = columnAtPoint(p);</span>
<span class="nc" id="L412">            int realColumnIndex = convertColumnIndexToModel(colIndex);</span>

<span class="nc bnc" id="L414" title="All 2 branches missed.">            if (realColumnIndex == COL_NAME) {</span>
<span class="nc" id="L415">                LocalVirtualMachine vmd = vmModel.vmAt(rowIndex);</span>
<span class="nc" id="L416">                tip = vmd.toString();</span>
            }
<span class="nc" id="L418">            return tip;</span>
        }

        public TableCellRenderer getCellRenderer(int row, int column) {
<span class="nc" id="L422">            return new DefaultTableCellRenderer() {</span>
                public Component getTableCellRendererComponent(JTable table,
                                                               Object value,
                                                               boolean isSelected,
                                                               boolean hasFocus,
                                                               int row,
                                                               int column) {
<span class="nc" id="L429">                    Component comp =</span>
<span class="nc" id="L430">                        super.getTableCellRendererComponent(table, value, isSelected,</span>
                                                            hasFocus, row, column);

<span class="nc bnc" id="L433" title="All 2 branches missed.">                    if (!isSelected) {</span>
<span class="nc" id="L434">                        LocalVirtualMachine lvm = vmModel.vmAt(row);</span>
<span class="nc bnc" id="L435" title="All 4 branches missed.">                        if (!lvm.isManageable() &amp;&amp; !lvm.isAttachable()) {</span>
<span class="nc" id="L436">                            comp.setForeground(disabledTableCellColor);</span>
                        }
                    }

<span class="nc bnc" id="L440" title="All 2 branches missed.">                    if (comp instanceof JLabel) {</span>
<span class="nc" id="L441">                        JLabel label = (JLabel)comp;</span>
<span class="nc" id="L442">                        label.setBorder(rendererBorder);</span>

<span class="nc bnc" id="L444" title="All 2 branches missed.">                        if (value instanceof Integer) {</span>
<span class="nc" id="L445">                            label.setHorizontalAlignment(JLabel.RIGHT);</span>
                        }
                    }

<span class="nc" id="L449">                    return comp;</span>
                }
            };
        }
    }

    public void setConnectionParameters(String url,
                                        String host,
                                        int port,
                                        String userName,
                                        String password,
                                        String msg) {
<span class="nc bnc" id="L461" title="All 6 branches missed.">        if ((url != null &amp;&amp; url.length() &gt; 0) ||</span>
<span class="nc bnc" id="L462" title="All 4 branches missed.">            (host != null &amp;&amp; host.length() &gt; 0 &amp;&amp; port &gt; 0)) {</span>

<span class="nc" id="L464">            remoteRadioButton.setSelected(true);</span>
<span class="nc bnc" id="L465" title="All 4 branches missed.">            if (url != null &amp;&amp; url.length() &gt; 0) {</span>
<span class="nc" id="L466">                remoteTF.setText(url);</span>
            } else {
<span class="nc" id="L468">                remoteTF.setText(host+&quot;:&quot;+port);</span>
            }
<span class="nc bnc" id="L470" title="All 2 branches missed.">            userNameTF.setText((userName != null) ? userName : &quot;&quot;);</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">            passwordTF.setText((password != null) ? password : &quot;&quot;);</span>

<span class="nc bnc" id="L473" title="All 2 branches missed.">            statusBar.setText((msg != null) ? msg : &quot;&quot;);</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">            if (getPreferredSize().width &gt; getWidth()) {</span>
<span class="nc" id="L475">                pack();</span>
            }
<span class="nc" id="L477">            remoteTF.requestFocus();</span>
<span class="nc" id="L478">            remoteTF.selectAll();</span>
        }
<span class="nc" id="L480">    }</span>


    public void itemStateChanged(ItemEvent ev) {
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (!localRadioButton.isSelected()) {</span>
<span class="nc" id="L485">            vmTable.getSelectionModel().clearSelection();</span>
        }
<span class="nc" id="L487">        updateButtonStates();</span>
<span class="nc" id="L488">    }</span>

    private void updateButtonStates() {
<span class="nc" id="L491">        boolean connectEnabled = false;</span>

<span class="nc bnc" id="L493" title="All 2 branches missed.">        if (remoteRadioButton.isSelected()) {</span>
<span class="nc" id="L494">            connectEnabled = JConsole.isValidRemoteString(remoteTF.getText());</span>
<span class="nc bnc" id="L495" title="All 4 branches missed.">        } else if (localRadioButton != null &amp;&amp; localRadioButton.isSelected()) {</span>
<span class="nc" id="L496">            int row = vmTable.getSelectedRow();</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">            if (row &gt;= 0) {</span>
<span class="nc" id="L498">                LocalVirtualMachine lvm = vmModel.vmAt(row);</span>
<span class="nc bnc" id="L499" title="All 4 branches missed.">                connectEnabled = (lvm.isManageable() || lvm.isAttachable());</span>
            }
        }

<span class="nc" id="L503">        connectAction.setEnabled(connectEnabled);</span>
<span class="nc" id="L504">    }</span>

    public void insertUpdate(DocumentEvent e) {
<span class="nc" id="L507">        updateButtonStates();</span>
<span class="nc" id="L508">    }</span>

    public void removeUpdate(DocumentEvent e) {
<span class="nc" id="L511">        updateButtonStates();</span>
<span class="nc" id="L512">    }</span>

    public void changedUpdate(DocumentEvent e) {
<span class="nc" id="L515">        updateButtonStates();</span>
<span class="nc" id="L516">    }</span>

    public void focusGained(FocusEvent e) {
<span class="nc" id="L519">        Object source = e.getSource();</span>
<span class="nc" id="L520">        Component opposite = e.getOppositeComponent();</span>

<span class="nc bnc" id="L522" title="All 6 branches missed.">        if (!e.isTemporary() &amp;&amp;</span>
            source instanceof JTextField &amp;&amp;
            opposite instanceof JComponent &amp;&amp;
<span class="nc bnc" id="L525" title="All 2 branches missed.">            SwingUtilities.getRootPane(opposite) == getRootPane()) {</span>

<span class="nc" id="L527">            ((JTextField)source).selectAll();</span>
        }

<span class="nc bnc" id="L530" title="All 2 branches missed.">        if (source == remoteTF) {</span>
<span class="nc" id="L531">            remoteRadioButton.setSelected(true);</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">        } else if (source == vmTable) {</span>
<span class="nc" id="L533">            localRadioButton.setSelected(true);</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">            if (vmModel.getRowCount() == 1) {</span>
                // if there's only one process then select the row
<span class="nc" id="L536">                vmTable.setRowSelectionInterval(0, 0);</span>
            }
        }
<span class="nc" id="L539">        updateButtonStates();</span>
<span class="nc" id="L540">    }</span>

    public void focusLost(FocusEvent e) {
<span class="nc" id="L543">    }</span>

    public void keyTyped(KeyEvent e) {
<span class="nc" id="L546">        char c = e.getKeyChar();</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">        if (c == KeyEvent.VK_ESCAPE) {</span>
<span class="nc" id="L548">            setVisible(false);</span>
<span class="nc bnc" id="L549" title="All 6 branches missed.">        } else if (!(Character.isDigit(c) ||</span>
                     c == KeyEvent.VK_BACK_SPACE ||
                     c == KeyEvent.VK_DELETE)) {
<span class="nc" id="L552">            getToolkit().beep();</span>
<span class="nc" id="L553">            e.consume();</span>
        }
<span class="nc" id="L555">    }</span>

    public void setVisible(boolean b) {
<span class="nc" id="L558">        boolean wasVisible = isVisible();</span>
<span class="nc" id="L559">        super.setVisible(b);</span>
<span class="nc bnc" id="L560" title="All 4 branches missed.">        if (b &amp;&amp; !wasVisible) {</span>
<span class="nc" id="L561">            SwingUtilities.invokeLater(new Runnable() {</span>
                public void run() {
<span class="nc bnc" id="L563" title="All 2 branches missed.">                    if (remoteRadioButton.isSelected()) {</span>
<span class="nc" id="L564">                        remoteTF.requestFocus();</span>
<span class="nc" id="L565">                        remoteTF.selectAll();</span>
                    }
<span class="nc" id="L567">                }</span>
            });
        }
<span class="nc" id="L570">    }</span>

    public void keyPressed(KeyEvent e) {
<span class="nc" id="L573">    }</span>

    public void keyReleased(KeyEvent e) {
<span class="nc" id="L576">    }</span>


    // ListSelectionListener interface
    public void valueChanged(ListSelectionEvent e) {
<span class="nc" id="L581">        updateButtonStates();</span>
<span class="nc" id="L582">        String labelText = &quot; &quot;; // Non-empty to reserve vertical space</span>
<span class="nc" id="L583">        int row = vmTable.getSelectedRow();</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">        if (row &gt;= 0) {</span>
<span class="nc" id="L585">            LocalVirtualMachine lvm = vmModel.vmAt(row);</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">            if (!lvm.isManageable()) {</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (lvm.isAttachable()) {</span>
<span class="nc" id="L588">                    labelText = Messages.MANAGEMENT_WILL_BE_ENABLED;</span>
                } else {
<span class="nc" id="L590">                    labelText = Messages.MANAGEMENT_NOT_ENABLED;</span>
                }
            }
        }
<span class="nc" id="L594">        String colorStr =</span>
<span class="nc" id="L595">            String.format(&quot;%06x&quot;, hintTextColor.getRGB() &amp; 0xFFFFFF);</span>
<span class="nc" id="L596">        localMessageLabel.setText(&quot;&lt;html&gt;&lt;font color=#&quot; + colorStr + &quot;&gt;&quot; + labelText);</span>
<span class="nc" id="L597">    }</span>
    // ----


    // Refresh the list of managed VMs
    public void refresh() {
<span class="nc bnc" id="L603" title="All 2 branches missed.">        if (vmModel != null) {</span>
            // Remember selection
<span class="nc" id="L605">            LocalVirtualMachine selected = null;</span>
<span class="nc" id="L606">            int row = vmTable.getSelectedRow();</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">            if (row &gt;= 0) {</span>
<span class="nc" id="L608">                selected = vmModel.vmAt(row);</span>
            }

<span class="nc" id="L611">            vmModel.refresh();</span>

<span class="nc" id="L613">            int selectRow = -1;</span>
<span class="nc" id="L614">            int n = vmModel.getRowCount();</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">            if (selected != null) {</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">                for (int i = 0; i &lt; n; i++) {</span>
<span class="nc" id="L617">                    LocalVirtualMachine lvm = vmModel.vmAt(i);</span>
<span class="nc bnc" id="L618" title="All 2 branches missed.">                    if (selected.vmid() == lvm.vmid() &amp;&amp;</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">                        selected.toString().equals(lvm.toString())) {</span>

<span class="nc" id="L621">                        selectRow = i;</span>
<span class="nc" id="L622">                        break;</span>
                    }
                }
            }
<span class="nc bnc" id="L626" title="All 2 branches missed.">            if (selectRow &gt; -1) {</span>
<span class="nc" id="L627">                vmTable.setRowSelectionInterval(selectRow, selectRow);</span>
            } else {
<span class="nc" id="L629">                vmTable.getSelectionModel().clearSelection();</span>
            }

<span class="nc" id="L632">            Dimension dim = vmTable.getPreferredSize();</span>

            // Tricky. Reduce height by one to avoid double line at bottom,
            // but that causes a scroll bar to appear, so remove it.
<span class="nc" id="L636">            dim.height = Math.min(dim.height-1, 100);</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">            localTableScrollPane.setVerticalScrollBarPolicy((dim.height &lt; 100)</span>
                                                ? JScrollPane.VERTICAL_SCROLLBAR_NEVER
                                                : JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);
<span class="nc" id="L640">            localTableScrollPane.getViewport().setMinimumSize(dim);</span>
<span class="nc" id="L641">            localTableScrollPane.getViewport().setPreferredSize(dim);</span>
        }
<span class="nc" id="L643">        pack();</span>
<span class="nc" id="L644">        setLocationRelativeTo(jConsole);</span>
<span class="nc" id="L645">    }</span>

    // Represents the list of managed VMs as a tabular data model.
<span class="nc bnc" id="L648" title="All 2 branches missed.">    private static class ManagedVmTableModel extends AbstractTableModel {</span>
<span class="nc" id="L649">        private static String[] columnNames = {</span>
            Messages.COLUMN_NAME,
            Messages.COLUMN_PID,
        };

        private List&lt;LocalVirtualMachine&gt; vmList;

        public int getColumnCount() {
<span class="nc" id="L657">            return columnNames.length;</span>
        }

        public String getColumnName(int col) {
<span class="nc" id="L661">            return columnNames[col];</span>
        }

        public synchronized int getRowCount() {
<span class="nc" id="L665">            return vmList.size();</span>
        }

        public synchronized Object getValueAt(int row, int col) {
<span class="nc bnc" id="L669" title="All 6 branches missed.">            assert col &gt;= 0 &amp;&amp; col &lt;= columnNames.length;</span>
<span class="nc" id="L670">            LocalVirtualMachine vm = vmList.get(row);</span>
<span class="nc bnc" id="L671" title="All 3 branches missed.">            switch (col) {</span>
<span class="nc" id="L672">                case COL_NAME: return vm.displayName();</span>
<span class="nc" id="L673">                case COL_PID:  return vm.vmid();</span>
<span class="nc" id="L674">                default: return null;</span>
            }
        }

        public Class&lt;?&gt; getColumnClass(int column) {
<span class="nc bnc" id="L679" title="All 3 branches missed.">            switch (column) {</span>
<span class="nc" id="L680">                case COL_NAME: return String.class;</span>
<span class="nc" id="L681">                case COL_PID:  return Integer.class;</span>
<span class="nc" id="L682">                default: return super.getColumnClass(column);</span>
            }
        }

<span class="nc" id="L686">        public ManagedVmTableModel() {</span>
<span class="nc" id="L687">            refresh();</span>
<span class="nc" id="L688">        }</span>


        public synchronized LocalVirtualMachine vmAt(int pos) {
<span class="nc" id="L692">            return vmList.get(pos);</span>
        }

        public synchronized void refresh() {
            Map&lt;Integer, LocalVirtualMachine&gt; map =
<span class="nc" id="L697">                LocalVirtualMachine.getAllVirtualMachines();</span>
<span class="nc" id="L698">            vmList = new ArrayList&lt;LocalVirtualMachine&gt;();</span>
<span class="nc" id="L699">            vmList.addAll(map.values());</span>

            // data has changed
<span class="nc" id="L702">            fireTableDataChanged();</span>
<span class="nc" id="L703">        }</span>
    }

    // A blank component that takes up as much space as the
    // button part of a JRadioButton.
    private static class Padder extends JPanel {
        JRadioButton radioButton;

<span class="nc" id="L711">        Padder(JRadioButton radioButton) {</span>
<span class="nc" id="L712">            this.radioButton = radioButton;</span>

<span class="nc" id="L714">            setAccessibleName(this, Messages.BLANK);</span>
<span class="nc" id="L715">        }</span>

        public Dimension getPreferredSize() {
<span class="nc" id="L718">            Rectangle r = getTextRectangle(radioButton);</span>
<span class="nc bnc" id="L719" title="All 4 branches missed.">            int w = (r != null &amp;&amp; r.x &gt; 8) ? r.x : 22;</span>

<span class="nc" id="L721">            return new Dimension(w, 0);</span>
        }

        private static Rectangle getTextRectangle(AbstractButton button) {
<span class="nc" id="L725">            String text = button.getText();</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">            Icon icon = (button.isEnabled()) ? button.getIcon() : button.getDisabledIcon();</span>

<span class="nc bnc" id="L728" title="All 4 branches missed.">            if (icon == null &amp;&amp; button.getUI() instanceof BasicRadioButtonUI) {</span>
<span class="nc" id="L729">                icon = ((BasicRadioButtonUI)button.getUI()).getDefaultIcon();</span>
            }

<span class="nc bnc" id="L732" title="All 4 branches missed.">            if ((icon == null) &amp;&amp; (text == null)) {</span>
<span class="nc" id="L733">                return null;</span>
            }

<span class="nc" id="L736">            Rectangle paintIconR = new Rectangle();</span>
<span class="nc" id="L737">            Rectangle paintTextR = new Rectangle();</span>
<span class="nc" id="L738">            Rectangle paintViewR = new Rectangle();</span>
<span class="nc" id="L739">            Insets paintViewInsets = new Insets(0, 0, 0, 0);</span>

<span class="nc" id="L741">            paintViewInsets = button.getInsets(paintViewInsets);</span>
<span class="nc" id="L742">            paintViewR.x = paintViewInsets.left;</span>
<span class="nc" id="L743">            paintViewR.y = paintViewInsets.top;</span>
<span class="nc" id="L744">            paintViewR.width = button.getWidth() - (paintViewInsets.left + paintViewInsets.right);</span>
<span class="nc" id="L745">            paintViewR.height = button.getHeight() - (paintViewInsets.top + paintViewInsets.bottom);</span>

<span class="nc" id="L747">            Graphics g = button.getGraphics();</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">            if (g == null) {</span>
<span class="nc" id="L749">                return null;</span>
            }
<span class="nc" id="L751">                SwingUtilities.layoutCompoundLabel(button,</span>
<span class="nc" id="L752">                                                   g.getFontMetrics(),</span>
                                                   text,
                                                   icon,
<span class="nc" id="L755">                                                   button.getVerticalAlignment(),</span>
<span class="nc" id="L756">                                                   button.getHorizontalAlignment(),</span>
<span class="nc" id="L757">                                                   button.getVerticalTextPosition(),</span>
<span class="nc" id="L758">                                                   button.getHorizontalTextPosition(),</span>
                                                   paintViewR,
                                                   paintIconR,
                                                   paintTextR,
<span class="nc" id="L762">                                                   button.getIconTextGap());</span>

<span class="nc" id="L764">            return paintTextR;</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>