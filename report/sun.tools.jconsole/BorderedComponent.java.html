<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>BorderedComponent.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">sun.tools.jconsole</a> &gt; <span class="el_source">BorderedComponent.java</span></div><h1>BorderedComponent.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2004, 2012, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package sun.tools.jconsole;

import java.awt.*;
import java.awt.event.*;

import javax.swing.*;
import javax.swing.border.*;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.BasicGraphicsUtils;


import static javax.swing.SwingConstants.*;

import static sun.tools.jconsole.JConsole.*;

@SuppressWarnings(&quot;serial&quot;)
public class BorderedComponent extends JPanel implements ActionListener {
    JButton moreOrLessButton;
    String valueLabelStr;
    JLabel label;
    JComponent comp;
<span class="nc" id="L47">    boolean collapsed = false;</span>

    private Icon collapseIcon;
    private Icon expandIcon;

    private static Image getImage(String name) {
<span class="nc" id="L53">        Toolkit tk = Toolkit.getDefaultToolkit();</span>
<span class="nc" id="L54">        name = &quot;resources/&quot; + name + &quot;.png&quot;;</span>
<span class="nc" id="L55">        return tk.getImage(BorderedComponent.class.getResource(name));</span>
    }

    public BorderedComponent(String text) {
<span class="nc" id="L59">        this(text, null, false);</span>
<span class="nc" id="L60">    }</span>

    public BorderedComponent(String text, JComponent comp) {
<span class="nc" id="L63">        this(text, comp, false);</span>
<span class="nc" id="L64">    }</span>

    public BorderedComponent(String text, JComponent comp, boolean collapsible) {
<span class="nc" id="L67">        super(null);</span>

<span class="nc" id="L69">        this.comp = comp;</span>

        // Only add border if text is not null
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (text != null) {</span>
            TitledBorder border;
<span class="nc bnc" id="L74" title="All 2 branches missed.">            if (collapsible) {</span>
<span class="nc" id="L75">                final JLabel textLabel = new JLabel(text);</span>
<span class="nc" id="L76">                JPanel borderLabel = new JPanel(new FlowLayout(FlowLayout.LEFT, 2, 0)) {</span>
                    public int getBaseline(int w, int h) {
<span class="nc" id="L78">                        Dimension dim = textLabel.getPreferredSize();</span>
<span class="nc" id="L79">                        return textLabel.getBaseline(dim.width, dim.height) + textLabel.getY();</span>
                    }
                };
<span class="nc" id="L82">                borderLabel.add(textLabel);</span>
<span class="nc" id="L83">                border = new LabeledBorder(borderLabel);</span>
<span class="nc" id="L84">                textLabel.setForeground(border.getTitleColor());</span>

<span class="nc bnc" id="L86" title="All 2 branches missed.">                if (IS_WIN) {</span>
<span class="nc" id="L87">                    collapseIcon = new ImageIcon(getImage(&quot;collapse-winlf&quot;));</span>
<span class="nc" id="L88">                    expandIcon = new ImageIcon(getImage(&quot;expand-winlf&quot;));</span>
                } else {
<span class="nc" id="L90">                    collapseIcon = new ArrowIcon(SOUTH, textLabel);</span>
<span class="nc" id="L91">                    expandIcon = new ArrowIcon(EAST, textLabel);</span>
                }

<span class="nc" id="L94">                moreOrLessButton = new JButton(collapseIcon);</span>
<span class="nc" id="L95">                moreOrLessButton.setContentAreaFilled(false);</span>
<span class="nc" id="L96">                moreOrLessButton.setBorderPainted(false);</span>
<span class="nc" id="L97">                moreOrLessButton.setMargin(new Insets(0, 0, 0, 0));</span>
<span class="nc" id="L98">                moreOrLessButton.addActionListener(this);</span>
<span class="nc" id="L99">                String toolTip =</span>
                    Messages.BORDERED_COMPONENT_MORE_OR_LESS_BUTTON_TOOLTIP;
<span class="nc" id="L101">                moreOrLessButton.setToolTipText(toolTip);</span>
<span class="nc" id="L102">                borderLabel.add(moreOrLessButton);</span>
<span class="nc" id="L103">                borderLabel.setSize(borderLabel.getPreferredSize());</span>
<span class="nc" id="L104">                add(borderLabel);</span>
<span class="nc" id="L105">            } else {</span>
<span class="nc" id="L106">                border = new TitledBorder(text);</span>
            }
<span class="nc" id="L108">            setBorder(new CompoundBorder(new FocusBorder(this), border));</span>
<span class="nc" id="L109">        } else {</span>
<span class="nc" id="L110">            setBorder(new FocusBorder(this));</span>
        }
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (comp != null) {</span>
<span class="nc" id="L113">            add(comp);</span>
        }
<span class="nc" id="L115">    }</span>

    public void setComponent(JComponent comp) {
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (this.comp != null) {</span>
<span class="nc" id="L119">            remove(this.comp);</span>
        }
<span class="nc" id="L121">        this.comp = comp;</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if (!collapsed) {</span>
<span class="nc" id="L123">            LayoutManager lm = getLayout();</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">            if (lm instanceof BorderLayout) {</span>
<span class="nc" id="L125">                add(comp, BorderLayout.CENTER);</span>
            } else {
<span class="nc" id="L127">                add(comp);</span>
            }
        }
<span class="nc" id="L130">        revalidate();</span>
<span class="nc" id="L131">    }</span>

    public void setValueLabel(String str) {
<span class="nc" id="L134">        this.valueLabelStr = str;</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (label != null) {</span>
<span class="nc" id="L136">            label.setText(Resources.format(Messages.CURRENT_VALUE,</span>
                                           valueLabelStr));
        }
<span class="nc" id="L139">    }</span>

    public void actionPerformed(ActionEvent ev) {
<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (collapsed) {</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">            if (label != null) {</span>
<span class="nc" id="L144">                remove(label);</span>
            }
<span class="nc" id="L146">            add(comp);</span>
<span class="nc" id="L147">            moreOrLessButton.setIcon(collapseIcon);</span>
        } else {
<span class="nc" id="L149">            remove(comp);</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (valueLabelStr != null) {</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">                if (label == null) {</span>
<span class="nc" id="L152">                    label = new JLabel(Resources.format(Messages.CURRENT_VALUE,</span>
                                                        valueLabelStr));
                }
<span class="nc" id="L155">                add(label);</span>
            }
<span class="nc" id="L157">            moreOrLessButton.setIcon(expandIcon);</span>
        }
<span class="nc bnc" id="L159" title="All 2 branches missed.">        collapsed = !collapsed;</span>

<span class="nc" id="L161">        JComponent container = (JComponent)getParent();</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if (container != null &amp;&amp;</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            container.getLayout() instanceof VariableGridLayout) {</span>

<span class="nc bnc" id="L165" title="All 2 branches missed.">            ((VariableGridLayout)container.getLayout()).setFillRow(this, !collapsed);</span>
<span class="nc" id="L166">            container.revalidate();</span>
        }
<span class="nc" id="L168">    }</span>

    public Dimension getMinimumSize() {
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (getLayout() != null) {</span>
            // A layout manager has been set, so delegate to it
<span class="nc" id="L173">            return super.getMinimumSize();</span>
        }

<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (moreOrLessButton != null) {</span>
<span class="nc" id="L177">            Dimension d = moreOrLessButton.getMinimumSize();</span>
<span class="nc" id="L178">            Insets i = getInsets();</span>
<span class="nc" id="L179">            d.width  += i.left + i.right;</span>
<span class="nc" id="L180">            d.height += i.top + i.bottom;</span>
<span class="nc" id="L181">            return d;</span>
        } else {
<span class="nc" id="L183">            return super.getMinimumSize();</span>
        }
    }

    public void doLayout() {
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (getLayout() != null) {</span>
            // A layout manager has been set, so delegate to it
<span class="nc" id="L190">            super.doLayout();</span>
<span class="nc" id="L191">            return;</span>
        }

<span class="nc" id="L194">        Dimension d = getSize();</span>
<span class="nc" id="L195">        Insets i = getInsets();</span>

<span class="nc bnc" id="L197" title="All 2 branches missed.">        if (collapsed) {</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">            if (label != null) {</span>
<span class="nc" id="L199">                Dimension p = label.getPreferredSize();</span>
<span class="nc" id="L200">                label.setBounds(i.left,</span>
                                i.top + (d.height - i.top - i.bottom - p.height) / 2,
                                p.width,
                                p.height);
<span class="nc" id="L204">            }</span>
        } else {
<span class="nc bnc" id="L206" title="All 2 branches missed.">            if (comp != null) {</span>
<span class="nc" id="L207">                comp.setBounds(i.left,</span>
                               i.top,
                               d.width - i.left - i.right,
                               d.height - i.top - i.bottom);
            }
        }
<span class="nc" id="L213">    }</span>

    private static class ArrowIcon implements Icon {
        private int direction;
        private JLabel textLabel;

<span class="nc" id="L219">        public ArrowIcon(int direction, JLabel textLabel) {</span>
<span class="nc" id="L220">            this.direction = direction;</span>
<span class="nc" id="L221">            this.textLabel = textLabel;</span>
<span class="nc" id="L222">        }</span>

        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L225">            int w = getIconWidth();</span>
<span class="nc" id="L226">            int h = w;</span>
<span class="nc" id="L227">            Polygon p = new Polygon();</span>
<span class="nc bnc" id="L228" title="All 3 branches missed.">            switch (direction) {</span>
              case EAST:
<span class="nc" id="L230">                p.addPoint(x + 2,     y);</span>
<span class="nc" id="L231">                p.addPoint(x + w - 2, y + h / 2);</span>
<span class="nc" id="L232">                p.addPoint(x + 2,     y + h - 1);</span>
<span class="nc" id="L233">                break;</span>

              case SOUTH:
<span class="nc" id="L236">                p.addPoint(x,         y + 2);</span>
<span class="nc" id="L237">                p.addPoint(x + w / 2, y + h - 2);</span>
<span class="nc" id="L238">                p.addPoint(x + w - 1, y + 2);</span>
                break;
            }
<span class="nc" id="L241">            g.fillPolygon(p);</span>
<span class="nc" id="L242">        }</span>

        public int getIconWidth() {
<span class="nc" id="L245">            return getIconHeight();</span>
        }

        public int getIconHeight() {
<span class="nc" id="L249">            Graphics g = textLabel.getGraphics();</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if (g != null) {</span>
<span class="nc" id="L251">                int h = g.getFontMetrics(textLabel.getFont()).getAscent() * 6/10;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                if (h % 2 == 0) {</span>
<span class="nc" id="L253">                    h += 1;     // Make it odd</span>
                }
<span class="nc" id="L255">                return h;</span>
            } else {
<span class="nc" id="L257">                return 7;</span>
            }
        }
    }


    /**
     * A subclass of &lt;code&gt;TitledBorder&lt;/code&gt; which implements an arbitrary border
     * with the addition of a JComponent (JLabel, JPanel, etc) in the
     * default position.
     * &lt;p&gt;
     * If the border property value is not
     * specified in the constructor or by invoking the appropriate
     * set method, the property value will be defined by the current
     * look and feel, using the following property name in the
     * Defaults Table:
     * &lt;ul&gt;
     * &lt;li&gt;&amp;quot;TitledBorder.border&amp;quot;
     * &lt;/ul&gt;
     */
    protected static class LabeledBorder extends TitledBorder {
        protected JComponent label;

<span class="nc" id="L280">        private Point compLoc = new Point();</span>

        /**
         * Creates a LabeledBorder instance.
         *
         * @param label  the label the border should display
         */
        public LabeledBorder(JComponent label)     {
<span class="nc" id="L288">            this(null, label);</span>
<span class="nc" id="L289">        }</span>

        /**
         * Creates a LabeledBorder instance with the specified border
         * and an empty label.
         *
         * @param border  the border
         */
        public LabeledBorder(Border border)       {
<span class="nc" id="L298">            this(border, null);</span>
<span class="nc" id="L299">        }</span>

        /**
         * Creates a LabeledBorder instance with the specified border and
         * label.
         *
         * @param border  the border
         * @param label  the label the border should display
         */
        public LabeledBorder(Border border, JComponent label) {
<span class="nc" id="L309">            super(border);</span>

<span class="nc" id="L311">            this.label = label;</span>

<span class="nc bnc" id="L313" title="All 2 branches missed.">            if (label instanceof JLabel &amp;&amp;</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                label.getForeground() instanceof ColorUIResource) {</span>

<span class="nc" id="L316">                label.setForeground(getTitleColor());</span>
            }

<span class="nc" id="L319">        }</span>

        /**
         * Paints the border for the specified component with the
         * specified position and size.
         * @param c the component for which this border is being painted
         * @param g the paint graphics
         * @param x the x position of the painted border
         * @param y the y position of the painted border
         * @param width the width of the painted border
         * @param height the height of the painted border
         */
        public void paintBorder(Component c, Graphics g, int x, int y, int width, int height) {

<span class="nc" id="L333">            Border border = getBorder();</span>

<span class="nc bnc" id="L335" title="All 2 branches missed.">            if (label == null) {</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">                if (border != null) {</span>
<span class="nc" id="L337">                    border.paintBorder(c, g, x, y, width, height);</span>
                }
<span class="nc" id="L339">                return;</span>
            }

<span class="nc" id="L342">            Rectangle grooveRect = new Rectangle(x + EDGE_SPACING, y + EDGE_SPACING,</span>
                                                 width - (EDGE_SPACING * 2),
                                                 height - (EDGE_SPACING * 2));

<span class="nc" id="L346">            Dimension   labelDim = label.getPreferredSize();</span>
<span class="nc" id="L347">            int baseline = label.getBaseline(labelDim.width, labelDim.height);</span>
<span class="nc" id="L348">            int         ascent = Math.max(0, baseline);</span>
<span class="nc" id="L349">            int         descent = labelDim.height - ascent;</span>
            int         diff;
            Insets      insets;

<span class="nc bnc" id="L353" title="All 2 branches missed.">            if (border != null) {</span>
<span class="nc" id="L354">                insets = border.getBorderInsets(c);</span>
            } else {
<span class="nc" id="L356">                insets = new Insets(0, 0, 0, 0);</span>
            }

<span class="nc" id="L359">            diff = Math.max(0, ascent/2 + TEXT_SPACING - EDGE_SPACING);</span>
<span class="nc" id="L360">            grooveRect.y += diff;</span>
<span class="nc" id="L361">            grooveRect.height -= diff;</span>
<span class="nc" id="L362">            compLoc.y = grooveRect.y + insets.top/2 - (ascent + descent) / 2 - 1;</span>

            int justification;
<span class="nc bnc" id="L365" title="All 2 branches missed.">            if (c.getComponentOrientation().isLeftToRight()) {</span>
<span class="nc" id="L366">                justification = LEFT;</span>
            } else {
<span class="nc" id="L368">                justification = RIGHT;</span>
            }

<span class="nc bnc" id="L371" title="All 3 branches missed.">            switch (justification) {</span>
                case LEFT:
<span class="nc" id="L373">                    compLoc.x = grooveRect.x + TEXT_INSET_H + insets.left;</span>
<span class="nc" id="L374">                    break;</span>
                case RIGHT:
<span class="nc" id="L376">                    compLoc.x = (grooveRect.x + grooveRect.width</span>
                                 - (labelDim.width + TEXT_INSET_H + insets.right));
                    break;
            }

            // If title is positioned in middle of border AND its fontsize
            // is greater than the border's thickness, we'll need to paint
            // the border in sections to leave space for the component's background
            // to show through the title.
            //
<span class="nc bnc" id="L386" title="All 2 branches missed.">            if (border != null) {</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">                if (grooveRect.y &gt; compLoc.y - ascent) {</span>
<span class="nc" id="L388">                    Rectangle clipRect = new Rectangle();</span>

                    // save original clip
<span class="nc" id="L391">                    Rectangle saveClip = g.getClipBounds();</span>

                    // paint strip left of text
<span class="nc" id="L394">                    clipRect.setBounds(saveClip);</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                    if (computeIntersection(clipRect, x, y, compLoc.x-1-x, height)) {</span>
<span class="nc" id="L396">                        g.setClip(clipRect);</span>
<span class="nc" id="L397">                        border.paintBorder(c, g, grooveRect.x, grooveRect.y,</span>
                                      grooveRect.width, grooveRect.height);
                    }

                    // paint strip right of text
<span class="nc" id="L402">                    clipRect.setBounds(saveClip);</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">                    if (computeIntersection(clipRect, compLoc.x+ labelDim.width +1, y,</span>
                                   x+width-(compLoc.x+ labelDim.width +1), height)) {
<span class="nc" id="L405">                        g.setClip(clipRect);</span>
<span class="nc" id="L406">                        border.paintBorder(c, g, grooveRect.x, grooveRect.y,</span>
                                      grooveRect.width, grooveRect.height);
                    }

                    // paint strip below text
<span class="nc" id="L411">                    clipRect.setBounds(saveClip);</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">                    if (computeIntersection(clipRect,</span>
                                            compLoc.x - 1, compLoc.y + ascent + descent,
                                            labelDim.width + 2,
                                            y + height - compLoc.y - ascent - descent)) {
<span class="nc" id="L416">                        g.setClip(clipRect);</span>
<span class="nc" id="L417">                        border.paintBorder(c, g, grooveRect.x, grooveRect.y,</span>
                                  grooveRect.width, grooveRect.height);
                    }

                    // restore clip
<span class="nc" id="L422">                    g.setClip(saveClip);</span>

<span class="nc" id="L424">                } else {</span>
<span class="nc" id="L425">                    border.paintBorder(c, g, grooveRect.x, grooveRect.y,</span>
                                      grooveRect.width, grooveRect.height);
                }

<span class="nc" id="L429">                label.setLocation(compLoc);</span>
<span class="nc" id="L430">                label.setSize(labelDim);</span>
            }
<span class="nc" id="L432">        }</span>

        /**
         * Reinitialize the insets parameter with this Border's current Insets.
         * @param c the component for which this border insets value applies
         * @param insets the object to be reinitialized
         */
        public Insets getBorderInsets(Component c, Insets insets) {
<span class="nc" id="L440">            Border border = getBorder();</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">            if (border != null) {</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">                if (border instanceof AbstractBorder) {</span>
<span class="nc" id="L443">                    ((AbstractBorder)border).getBorderInsets(c, insets);</span>
                } else {
                    // Can't reuse border insets because the Border interface
                    // can't be enhanced.
<span class="nc" id="L447">                    Insets i = border.getBorderInsets(c);</span>
<span class="nc" id="L448">                    insets.top = i.top;</span>
<span class="nc" id="L449">                    insets.right = i.right;</span>
<span class="nc" id="L450">                    insets.bottom = i.bottom;</span>
<span class="nc" id="L451">                    insets.left = i.left;</span>
<span class="nc" id="L452">                }</span>
            } else {
<span class="nc" id="L454">                insets.left = insets.top = insets.right = insets.bottom = 0;</span>
            }

<span class="nc" id="L457">            insets.left += EDGE_SPACING + TEXT_SPACING;</span>
<span class="nc" id="L458">            insets.right += EDGE_SPACING + TEXT_SPACING;</span>
<span class="nc" id="L459">            insets.top += EDGE_SPACING + TEXT_SPACING;</span>
<span class="nc" id="L460">            insets.bottom += EDGE_SPACING + TEXT_SPACING;</span>

<span class="nc bnc" id="L462" title="All 4 branches missed.">            if (c == null || label == null) {</span>
<span class="nc" id="L463">                return insets;</span>
            }

<span class="nc" id="L466">            insets.top += label.getHeight();</span>

<span class="nc" id="L468">            return insets;</span>
        }

        /**
         * Returns the label of the labeled border.
         */
        public JComponent getLabel() {
<span class="nc" id="L475">            return label;</span>
        }


        /**
         * Sets the title of the titled border.
         * param title the title for the border
         */
        public void setLabel(JComponent label) {
<span class="nc" id="L484">            this.label = label;</span>
<span class="nc" id="L485">        }</span>



        /**
         * Returns the minimum dimensions this border requires
         * in order to fully display the border and title.
         * @param c the component where this border will be drawn
         */
        public Dimension getMinimumSize(Component c) {
<span class="nc" id="L495">            Insets insets = getBorderInsets(c);</span>
<span class="nc" id="L496">            Dimension minSize = new Dimension(insets.right + insets.left,</span>
                                              insets.top + insets.bottom);
<span class="nc" id="L498">            minSize.width += label.getWidth();</span>

<span class="nc" id="L500">            return minSize;</span>
        }


        private static boolean computeIntersection(Rectangle dest,
                                                   int rx, int ry, int rw, int rh) {
<span class="nc" id="L506">            int x1 = Math.max(rx, dest.x);</span>
<span class="nc" id="L507">            int x2 = Math.min(rx + rw, dest.x + dest.width);</span>
<span class="nc" id="L508">            int y1 = Math.max(ry, dest.y);</span>
<span class="nc" id="L509">            int y2 = Math.min(ry + rh, dest.y + dest.height);</span>
<span class="nc" id="L510">            dest.x = x1;</span>
<span class="nc" id="L511">            dest.y = y1;</span>
<span class="nc" id="L512">            dest.width = x2 - x1;</span>
<span class="nc" id="L513">            dest.height = y2 - y1;</span>

<span class="nc bnc" id="L515" title="All 4 branches missed.">            if (dest.width &lt;= 0 || dest.height &lt;= 0) {</span>
<span class="nc" id="L516">                return false;</span>
            }
<span class="nc" id="L518">            return true;</span>
        }
    }


    protected static class FocusBorder extends AbstractBorder implements FocusListener {
        private Component comp;
        private Color focusColor;
<span class="nc" id="L526">        private boolean focusLostTemporarily = false;</span>

<span class="nc" id="L528">        public FocusBorder(Component comp) {</span>
<span class="nc" id="L529">            this.comp = comp;</span>

<span class="nc" id="L531">            comp.addFocusListener(this);</span>

            // This is the best guess for a L&amp;F specific color
<span class="nc" id="L534">            focusColor = UIManager.getColor(&quot;TabbedPane.focus&quot;);</span>
<span class="nc" id="L535">        }</span>

        public void paintBorder(Component c, Graphics g, int x, int y, int width, int height) {
<span class="nc bnc" id="L538" title="All 4 branches missed.">            if (comp.hasFocus() || focusLostTemporarily) {</span>
<span class="nc" id="L539">                Color color = g.getColor();</span>
<span class="nc" id="L540">                g.setColor(focusColor);</span>
<span class="nc" id="L541">                BasicGraphicsUtils.drawDashedRect(g, x, y, width, height);</span>
<span class="nc" id="L542">                g.setColor(color);</span>
            }
<span class="nc" id="L544">        }</span>

        public Insets getBorderInsets(Component c, Insets insets) {
<span class="nc" id="L547">            insets.set(2, 2, 2, 2);</span>
<span class="nc" id="L548">            return insets;</span>
        }


        public void focusGained(FocusEvent e) {
<span class="nc" id="L553">            comp.repaint();</span>
<span class="nc" id="L554">        }</span>

        public void focusLost(FocusEvent e) {
            // We will still paint focus even if lost temporarily
<span class="nc" id="L558">            focusLostTemporarily = e.isTemporary();</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">            if (!focusLostTemporarily) {</span>
<span class="nc" id="L560">                comp.repaint();</span>
            }
<span class="nc" id="L562">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>