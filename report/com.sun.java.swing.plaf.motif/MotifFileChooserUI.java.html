<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MotifFileChooserUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.motif</a> &gt; <span class="el_source">MotifFileChooserUI.java</span></div><h1>MotifFileChooserUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.java.swing.plaf.motif;

import javax.swing.*;
import javax.swing.filechooser.*;
import javax.swing.event.*;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.*;
import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.beans.*;
import java.io.File;
import java.io.IOException;
import java.util.*;
import sun.awt.shell.ShellFolder;
import sun.swing.AbstractFilterComboBoxModel;
import sun.swing.SwingUtilities2;

/**
 * Motif FileChooserUI.
 *
 * @author Jeff Dinkins
 */
public class MotifFileChooserUI extends BasicFileChooserUI {

    private FilterComboBoxModel filterComboBoxModel;

<span class="nc" id="L53">    protected JList&lt;File&gt; directoryList = null;</span>
<span class="nc" id="L54">    protected JList&lt;File&gt; fileList = null;</span>

<span class="nc" id="L56">    protected JTextField pathField = null;</span>
<span class="nc" id="L57">    protected JComboBox&lt;FileFilter&gt; filterComboBox = null;</span>
<span class="nc" id="L58">    protected JTextField filenameTextField = null;</span>

<span class="nc" id="L60">    private static final Dimension hstrut10 = new Dimension(10, 1);</span>
<span class="nc" id="L61">    private static final Dimension vstrut10 = new Dimension(1, 10);</span>

<span class="nc" id="L63">    private static final Insets insets = new Insets(10, 10, 10, 10);</span>

<span class="nc" id="L65">    private static Dimension prefListSize = new Dimension(75, 150);</span>

<span class="nc" id="L67">    private static Dimension WITH_ACCELERATOR_PREF_SIZE = new Dimension(650, 450);</span>
<span class="nc" id="L68">    private static Dimension PREF_SIZE = new Dimension(350, 450);</span>
<span class="nc" id="L69">    private static Dimension MIN_SIZE = new Dimension(200, 300);</span>

<span class="nc" id="L71">    private static Dimension PREF_ACC_SIZE = new Dimension(10, 10);</span>
<span class="nc" id="L72">    private static Dimension ZERO_ACC_SIZE = new Dimension(1, 1);</span>

<span class="nc" id="L74">    private static Dimension MAX_SIZE = new Dimension(Short.MAX_VALUE, Short.MAX_VALUE);</span>

<span class="nc" id="L76">    private static final Insets buttonMargin = new Insets(3, 3, 3, 3);</span>

    private JPanel bottomPanel;

    protected JButton approveButton;

<span class="nc" id="L82">    private String enterFolderNameLabelText = null;</span>
<span class="nc" id="L83">    private int enterFolderNameLabelMnemonic = 0;</span>
<span class="nc" id="L84">    private String enterFileNameLabelText = null;</span>
<span class="nc" id="L85">    private int enterFileNameLabelMnemonic = 0;</span>

<span class="nc" id="L87">    private String filesLabelText = null;</span>
<span class="nc" id="L88">    private int filesLabelMnemonic = 0;</span>

<span class="nc" id="L90">    private String foldersLabelText = null;</span>
<span class="nc" id="L91">    private int foldersLabelMnemonic = 0;</span>

<span class="nc" id="L93">    private String pathLabelText = null;</span>
<span class="nc" id="L94">    private int pathLabelMnemonic = 0;</span>

<span class="nc" id="L96">    private String filterLabelText = null;</span>
<span class="nc" id="L97">    private int filterLabelMnemonic = 0;</span>

    private JLabel fileNameLabel;

    private void populateFileNameLabel() {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (getFileChooser().getFileSelectionMode() == JFileChooser.DIRECTORIES_ONLY) {</span>
<span class="nc" id="L103">            fileNameLabel.setText(enterFolderNameLabelText);</span>
<span class="nc" id="L104">            fileNameLabel.setDisplayedMnemonic(enterFolderNameLabelMnemonic);</span>
        } else {
<span class="nc" id="L106">            fileNameLabel.setText(enterFileNameLabelText);</span>
<span class="nc" id="L107">            fileNameLabel.setDisplayedMnemonic(enterFileNameLabelMnemonic);</span>
        }
<span class="nc" id="L109">    }</span>

    private String fileNameString(File file) {
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (file == null) {</span>
<span class="nc" id="L113">            return null;</span>
        } else {
<span class="nc" id="L115">            JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L116" title="All 4 branches missed.">            if (fc.isDirectorySelectionEnabled() &amp;&amp; !fc.isFileSelectionEnabled()) {</span>
<span class="nc" id="L117">                return file.getPath();</span>
            } else {
<span class="nc" id="L119">                return file.getName();</span>
            }
        }
    }

    private String fileNameString(File[] files) {
<span class="nc" id="L125">        StringBuffer buf = new StringBuffer();</span>
<span class="nc bnc" id="L126" title="All 4 branches missed.">        for (int i = 0; files != null &amp;&amp; i &lt; files.length; i++) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">            if (i &gt; 0) {</span>
<span class="nc" id="L128">                buf.append(&quot; &quot;);</span>
            }
<span class="nc bnc" id="L130" title="All 2 branches missed.">            if (files.length &gt; 1) {</span>
<span class="nc" id="L131">                buf.append(&quot;\&quot;&quot;);</span>
            }
<span class="nc" id="L133">            buf.append(fileNameString(files[i]));</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">            if (files.length &gt; 1) {</span>
<span class="nc" id="L135">                buf.append(&quot;\&quot;&quot;);</span>
            }
        }
<span class="nc" id="L138">        return buf.toString();</span>
    }

    public MotifFileChooserUI(JFileChooser filechooser) {
<span class="nc" id="L142">        super(filechooser);</span>
<span class="nc" id="L143">    }</span>

    public String getFileName() {
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if(filenameTextField != null) {</span>
<span class="nc" id="L147">            return filenameTextField.getText();</span>
        } else {
<span class="nc" id="L149">            return null;</span>
        }
    }

    public void setFileName(String filename) {
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if(filenameTextField != null) {</span>
<span class="nc" id="L155">            filenameTextField.setText(filename);</span>
        }
<span class="nc" id="L157">    }</span>

    public String getDirectoryName() {
<span class="nc" id="L160">        return pathField.getText();</span>
    }

    public void setDirectoryName(String dirname) {
<span class="nc" id="L164">        pathField.setText(dirname);</span>
<span class="nc" id="L165">    }</span>

    public void ensureFileIsVisible(JFileChooser fc, File f) {
        // PENDING(jeff)
<span class="nc" id="L169">    }</span>

    public void rescanCurrentDirectory(JFileChooser fc) {
<span class="nc" id="L172">        getModel().validateFileCache();</span>
<span class="nc" id="L173">    }</span>

    public PropertyChangeListener createPropertyChangeListener(JFileChooser fc) {
<span class="nc" id="L176">        return new PropertyChangeListener() {</span>
            public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L178">                String prop = e.getPropertyName();</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">                if(prop.equals(JFileChooser.SELECTED_FILE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L180">                    File f = (File) e.getNewValue();</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">                    if(f != null) {</span>
<span class="nc" id="L182">                        setFileName(getFileChooser().getName(f));</span>
                    }
<span class="nc bnc" id="L184" title="All 2 branches missed.">                } else if (prop.equals(JFileChooser.SELECTED_FILES_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L185">                    File[] files = (File[]) e.getNewValue();</span>
<span class="nc" id="L186">                    JFileChooser fc = getFileChooser();</span>
<span class="nc bnc" id="L187" title="All 8 branches missed.">                    if (files != null &amp;&amp; files.length &gt; 0 &amp;&amp; (files.length &gt; 1 || fc.isDirectorySelectionEnabled()</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                            || !files[0].isDirectory())) {</span>
<span class="nc" id="L189">                        setFileName(fileNameString(files));</span>
                    }
<span class="nc bnc" id="L191" title="All 2 branches missed.">                } else if (prop.equals(JFileChooser.FILE_FILTER_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L192">                    fileList.clearSelection();</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">                } else if(prop.equals(JFileChooser.DIRECTORY_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L194">                    directoryList.clearSelection();</span>
<span class="nc" id="L195">                    ListSelectionModel sm = directoryList.getSelectionModel();</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                    if (sm instanceof DefaultListSelectionModel) {</span>
<span class="nc" id="L197">                        ((DefaultListSelectionModel)sm).moveLeadSelectionIndex(0);</span>
<span class="nc" id="L198">                        sm.setAnchorSelectionIndex(0);</span>
                    }
<span class="nc" id="L200">                    fileList.clearSelection();</span>
<span class="nc" id="L201">                    sm = fileList.getSelectionModel();</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                    if (sm instanceof DefaultListSelectionModel) {</span>
<span class="nc" id="L203">                        ((DefaultListSelectionModel)sm).moveLeadSelectionIndex(0);</span>
<span class="nc" id="L204">                        sm.setAnchorSelectionIndex(0);</span>
                    }
<span class="nc" id="L206">                    File currentDirectory = getFileChooser().getCurrentDirectory();</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">                    if(currentDirectory != null) {</span>
                        try {
<span class="nc" id="L209">                            setDirectoryName(ShellFolder.getNormalizedFile((File)e.getNewValue()).getPath());</span>
<span class="nc" id="L210">                        } catch (IOException ioe) {</span>
<span class="nc" id="L211">                            setDirectoryName(((File)e.getNewValue()).getAbsolutePath());</span>
<span class="nc" id="L212">                        }</span>
<span class="nc bnc" id="L213" title="All 4 branches missed.">                        if ((getFileChooser().getFileSelectionMode() == JFileChooser.DIRECTORIES_ONLY) &amp;&amp; !getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L214">                            setFileName(getDirectoryName());</span>
                        }
                    }
<span class="nc bnc" id="L217" title="All 2 branches missed.">                } else if(prop.equals(JFileChooser.FILE_SELECTION_MODE_CHANGED_PROPERTY)) {</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">                    if (fileNameLabel != null) {</span>
<span class="nc" id="L219">                        populateFileNameLabel();</span>
                    }
<span class="nc" id="L221">                    directoryList.clearSelection();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                } else if (prop.equals(JFileChooser.MULTI_SELECTION_ENABLED_CHANGED_PROPERTY)) {</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                    if(getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L224">                        fileList.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
                    } else {
<span class="nc" id="L226">                        fileList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L227">                        fileList.clearSelection();</span>
<span class="nc" id="L228">                        getFileChooser().setSelectedFiles(null);</span>
                    }
<span class="nc bnc" id="L230" title="All 2 branches missed.">                } else if (prop.equals(JFileChooser.ACCESSORY_CHANGED_PROPERTY)) {</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">                    if(getAccessoryPanel() != null) {</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                        if(e.getOldValue() != null) {</span>
<span class="nc" id="L233">                            getAccessoryPanel().remove((JComponent) e.getOldValue());</span>
                        }
<span class="nc" id="L235">                        JComponent accessory = (JComponent) e.getNewValue();</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">                        if(accessory != null) {</span>
<span class="nc" id="L237">                            getAccessoryPanel().add(accessory, BorderLayout.CENTER);</span>
<span class="nc" id="L238">                            getAccessoryPanel().setPreferredSize(PREF_ACC_SIZE);</span>
<span class="nc" id="L239">                            getAccessoryPanel().setMaximumSize(MAX_SIZE);</span>
                        } else {
<span class="nc" id="L241">                            getAccessoryPanel().setPreferredSize(ZERO_ACC_SIZE);</span>
<span class="nc" id="L242">                            getAccessoryPanel().setMaximumSize(ZERO_ACC_SIZE);</span>
                        }
<span class="nc" id="L244">                    }</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">                } else if (prop.equals(JFileChooser.APPROVE_BUTTON_TEXT_CHANGED_PROPERTY) ||</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">                        prop.equals(JFileChooser.APPROVE_BUTTON_TOOL_TIP_TEXT_CHANGED_PROPERTY) ||</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">                        prop.equals(JFileChooser.DIALOG_TYPE_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L248">                    approveButton.setText(getApproveButtonText(getFileChooser()));</span>
<span class="nc" id="L249">                    approveButton.setToolTipText(getApproveButtonToolTipText(getFileChooser()));</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">                } else if (prop.equals(JFileChooser.CONTROL_BUTTONS_ARE_SHOWN_CHANGED_PROPERTY)) {</span>
<span class="nc" id="L251">                    doControlButtonsChanged(e);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                } else if (prop.equals(&quot;componentOrientation&quot;)) {</span>
<span class="nc" id="L253">                    ComponentOrientation o = (ComponentOrientation)e.getNewValue();</span>
<span class="nc" id="L254">                    JFileChooser cc = (JFileChooser)e.getSource();</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">                    if (o != (ComponentOrientation)e.getOldValue()) {</span>
<span class="nc" id="L256">                        cc.applyComponentOrientation(o);</span>
                    }
                }
<span class="nc" id="L259">            }</span>
        };
    }

    //
    // ComponentUI Interface Implementation methods
    //
    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L267">        return new MotifFileChooserUI((JFileChooser)c);</span>
    }

    public void installUI(JComponent c) {
<span class="nc" id="L271">        super.installUI(c);</span>
<span class="nc" id="L272">    }</span>

    public void uninstallUI(JComponent c) {
<span class="nc" id="L275">        c.removePropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L276">        approveButton.removeActionListener(getApproveSelectionAction());</span>
<span class="nc" id="L277">        filenameTextField.removeActionListener(getApproveSelectionAction());</span>
<span class="nc" id="L278">        super.uninstallUI(c);</span>
<span class="nc" id="L279">    }</span>

    public void installComponents(JFileChooser fc) {
<span class="nc" id="L282">        fc.setLayout(new BorderLayout(10, 10));</span>
<span class="nc" id="L283">        fc.setAlignmentX(JComponent.CENTER_ALIGNMENT);</span>

<span class="nc" id="L285">        JPanel interior = new JPanel() {</span>
            public Insets getInsets() {
<span class="nc" id="L287">                return insets;</span>
            }
        };
<span class="nc" id="L290">        interior.setInheritsPopupMenu(true);</span>
<span class="nc" id="L291">        align(interior);</span>
<span class="nc" id="L292">        interior.setLayout(new BoxLayout(interior, BoxLayout.PAGE_AXIS));</span>

<span class="nc" id="L294">        fc.add(interior, BorderLayout.CENTER);</span>

        // PENDING(jeff) - I18N
<span class="nc" id="L297">        JLabel l = new JLabel(pathLabelText);</span>
<span class="nc" id="L298">        l.setDisplayedMnemonic(pathLabelMnemonic);</span>
<span class="nc" id="L299">        align(l);</span>
<span class="nc" id="L300">        interior.add(l);</span>

<span class="nc" id="L302">        File currentDirectory = fc.getCurrentDirectory();</span>
<span class="nc" id="L303">        String curDirName = null;</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">        if(currentDirectory != null) {</span>
<span class="nc" id="L305">            curDirName = currentDirectory.getPath();</span>
        }
<span class="nc" id="L307">        pathField = new JTextField(curDirName) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L309">                Dimension d = super.getMaximumSize();</span>
<span class="nc" id="L310">                d.height = getPreferredSize().height;</span>
<span class="nc" id="L311">                return d;</span>
            }
        };
<span class="nc" id="L314">        pathField.setInheritsPopupMenu(true);</span>
<span class="nc" id="L315">        l.setLabelFor(pathField);</span>
<span class="nc" id="L316">        align(pathField);</span>

        // Change to folder on return
<span class="nc" id="L319">        pathField.addActionListener(getUpdateAction());</span>
<span class="nc" id="L320">        interior.add(pathField);</span>

<span class="nc" id="L322">        interior.add(Box.createRigidArea(vstrut10));</span>


        // CENTER: left, right accessory
<span class="nc" id="L326">        JPanel centerPanel = new JPanel();</span>
<span class="nc" id="L327">        centerPanel.setLayout(new BoxLayout(centerPanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L328">        align(centerPanel);</span>

        // left panel - Filter &amp; folderList
<span class="nc" id="L331">        JPanel leftPanel = new JPanel();</span>
<span class="nc" id="L332">        leftPanel.setLayout(new BoxLayout(leftPanel, BoxLayout.PAGE_AXIS));</span>
<span class="nc" id="L333">        align(leftPanel);</span>

        // add the filter PENDING(jeff) - I18N
<span class="nc" id="L336">        l = new JLabel(filterLabelText);</span>
<span class="nc" id="L337">        l.setDisplayedMnemonic(filterLabelMnemonic);</span>
<span class="nc" id="L338">        align(l);</span>
<span class="nc" id="L339">        leftPanel.add(l);</span>

<span class="nc" id="L341">        filterComboBox = new JComboBox&lt;FileFilter&gt;() {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L343">                Dimension d = super.getMaximumSize();</span>
<span class="nc" id="L344">                d.height = getPreferredSize().height;</span>
<span class="nc" id="L345">                return d;</span>
            }
        };
<span class="nc" id="L348">        filterComboBox.setInheritsPopupMenu(true);</span>
<span class="nc" id="L349">        l.setLabelFor(filterComboBox);</span>
<span class="nc" id="L350">        filterComboBoxModel = createFilterComboBoxModel();</span>
<span class="nc" id="L351">        filterComboBox.setModel(filterComboBoxModel);</span>
<span class="nc" id="L352">        filterComboBox.setRenderer(createFilterComboBoxRenderer());</span>
<span class="nc" id="L353">        fc.addPropertyChangeListener(filterComboBoxModel);</span>
<span class="nc" id="L354">        align(filterComboBox);</span>
<span class="nc" id="L355">        leftPanel.add(filterComboBox);</span>

        // leftPanel.add(Box.createRigidArea(vstrut10));

        // Add the Folder List PENDING(jeff) - I18N
<span class="nc" id="L360">        l = new JLabel(foldersLabelText);</span>
<span class="nc" id="L361">        l.setDisplayedMnemonic(foldersLabelMnemonic);</span>
<span class="nc" id="L362">        align(l);</span>
<span class="nc" id="L363">        leftPanel.add(l);</span>
<span class="nc" id="L364">        JScrollPane sp = createDirectoryList();</span>
<span class="nc" id="L365">        sp.getVerticalScrollBar().setFocusable(false);</span>
<span class="nc" id="L366">        sp.getHorizontalScrollBar().setFocusable(false);</span>
<span class="nc" id="L367">        sp.setInheritsPopupMenu(true);</span>
<span class="nc" id="L368">        l.setLabelFor(sp.getViewport().getView());</span>
<span class="nc" id="L369">        leftPanel.add(sp);</span>
<span class="nc" id="L370">        leftPanel.setInheritsPopupMenu(true);</span>


        // create files list
<span class="nc" id="L374">        JPanel rightPanel = new JPanel();</span>
<span class="nc" id="L375">        align(rightPanel);</span>
<span class="nc" id="L376">        rightPanel.setLayout(new BoxLayout(rightPanel, BoxLayout.PAGE_AXIS));</span>
<span class="nc" id="L377">        rightPanel.setInheritsPopupMenu(true);</span>

<span class="nc" id="L379">        l = new JLabel(filesLabelText);</span>
<span class="nc" id="L380">        l.setDisplayedMnemonic(filesLabelMnemonic);</span>
<span class="nc" id="L381">        align(l);</span>
<span class="nc" id="L382">        rightPanel.add(l);</span>
<span class="nc" id="L383">        sp = createFilesList();</span>
<span class="nc" id="L384">        l.setLabelFor(sp.getViewport().getView());</span>
<span class="nc" id="L385">        rightPanel.add(sp);</span>
<span class="nc" id="L386">        sp.setInheritsPopupMenu(true);</span>

<span class="nc" id="L388">        centerPanel.add(leftPanel);</span>
<span class="nc" id="L389">        centerPanel.add(Box.createRigidArea(hstrut10));</span>
<span class="nc" id="L390">        centerPanel.add(rightPanel);</span>
<span class="nc" id="L391">        centerPanel.setInheritsPopupMenu(true);</span>

<span class="nc" id="L393">        JComponent accessoryPanel = getAccessoryPanel();</span>
<span class="nc" id="L394">        JComponent accessory = fc.getAccessory();</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">        if(accessoryPanel != null) {</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">            if(accessory == null) {</span>
<span class="nc" id="L397">                accessoryPanel.setPreferredSize(ZERO_ACC_SIZE);</span>
<span class="nc" id="L398">                accessoryPanel.setMaximumSize(ZERO_ACC_SIZE);</span>
            } else {
<span class="nc" id="L400">                getAccessoryPanel().add(accessory, BorderLayout.CENTER);</span>
<span class="nc" id="L401">                accessoryPanel.setPreferredSize(PREF_ACC_SIZE);</span>
<span class="nc" id="L402">                accessoryPanel.setMaximumSize(MAX_SIZE);</span>
            }
<span class="nc" id="L404">            align(accessoryPanel);</span>
<span class="nc" id="L405">            centerPanel.add(accessoryPanel);</span>
<span class="nc" id="L406">            accessoryPanel.setInheritsPopupMenu(true);</span>
        }
<span class="nc" id="L408">        interior.add(centerPanel);</span>
<span class="nc" id="L409">        interior.add(Box.createRigidArea(vstrut10));</span>

        // add the filename field PENDING(jeff) - I18N
<span class="nc" id="L412">        fileNameLabel = new JLabel();</span>
<span class="nc" id="L413">        populateFileNameLabel();</span>
<span class="nc" id="L414">        align(fileNameLabel);</span>
<span class="nc" id="L415">        interior.add(fileNameLabel);</span>

<span class="nc" id="L417">        filenameTextField = new JTextField() {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L419">                Dimension d = super.getMaximumSize();</span>
<span class="nc" id="L420">                d.height = getPreferredSize().height;</span>
<span class="nc" id="L421">                return d;</span>
            }
        };
<span class="nc" id="L424">        filenameTextField.setInheritsPopupMenu(true);</span>
<span class="nc" id="L425">        fileNameLabel.setLabelFor(filenameTextField);</span>
<span class="nc" id="L426">        filenameTextField.addActionListener(getApproveSelectionAction());</span>
<span class="nc" id="L427">        align(filenameTextField);</span>
<span class="nc" id="L428">        filenameTextField.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L429">        interior.add(filenameTextField);</span>

<span class="nc" id="L431">        bottomPanel = getBottomPanel();</span>
<span class="nc" id="L432">        bottomPanel.add(new JSeparator(), BorderLayout.NORTH);</span>

        // Add buttons
<span class="nc" id="L435">        JPanel buttonPanel = new JPanel();</span>
<span class="nc" id="L436">        align(buttonPanel);</span>
<span class="nc" id="L437">        buttonPanel.setLayout(new BoxLayout(buttonPanel, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L438">        buttonPanel.add(Box.createGlue());</span>

<span class="nc" id="L440">        approveButton = new JButton(getApproveButtonText(fc)) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L442">                return new Dimension(MAX_SIZE.width, this.getPreferredSize().height);</span>
            }
        };
<span class="nc" id="L445">        approveButton.setMnemonic(getApproveButtonMnemonic(fc));</span>
<span class="nc" id="L446">        approveButton.setToolTipText(getApproveButtonToolTipText(fc));</span>
<span class="nc" id="L447">        approveButton.setInheritsPopupMenu(true);</span>
<span class="nc" id="L448">        align(approveButton);</span>
<span class="nc" id="L449">        approveButton.setMargin(buttonMargin);</span>
<span class="nc" id="L450">        approveButton.addActionListener(getApproveSelectionAction());</span>
<span class="nc" id="L451">        buttonPanel.add(approveButton);</span>
<span class="nc" id="L452">        buttonPanel.add(Box.createGlue());</span>

<span class="nc" id="L454">        JButton updateButton = new JButton(updateButtonText) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L456">                return new Dimension(MAX_SIZE.width, this.getPreferredSize().height);</span>
            }
        };
<span class="nc" id="L459">        updateButton.setMnemonic(updateButtonMnemonic);</span>
<span class="nc" id="L460">        updateButton.setToolTipText(updateButtonToolTipText);</span>
<span class="nc" id="L461">        updateButton.setInheritsPopupMenu(true);</span>
<span class="nc" id="L462">        align(updateButton);</span>
<span class="nc" id="L463">        updateButton.setMargin(buttonMargin);</span>
<span class="nc" id="L464">        updateButton.addActionListener(getUpdateAction());</span>
<span class="nc" id="L465">        buttonPanel.add(updateButton);</span>
<span class="nc" id="L466">        buttonPanel.add(Box.createGlue());</span>

<span class="nc" id="L468">        JButton cancelButton = new JButton(cancelButtonText) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L470">                return new Dimension(MAX_SIZE.width, this.getPreferredSize().height);</span>
            }
        };
<span class="nc" id="L473">        cancelButton.setMnemonic(cancelButtonMnemonic);</span>
<span class="nc" id="L474">        cancelButton.setToolTipText(cancelButtonToolTipText);</span>
<span class="nc" id="L475">        cancelButton.setInheritsPopupMenu(true);</span>
<span class="nc" id="L476">        align(cancelButton);</span>
<span class="nc" id="L477">        cancelButton.setMargin(buttonMargin);</span>
<span class="nc" id="L478">        cancelButton.addActionListener(getCancelSelectionAction());</span>
<span class="nc" id="L479">        buttonPanel.add(cancelButton);</span>
<span class="nc" id="L480">        buttonPanel.add(Box.createGlue());</span>

<span class="nc" id="L482">        JButton helpButton = new JButton(helpButtonText) {</span>
            public Dimension getMaximumSize() {
<span class="nc" id="L484">                return new Dimension(MAX_SIZE.width, this.getPreferredSize().height);</span>
            }
        };
<span class="nc" id="L487">        helpButton.setMnemonic(helpButtonMnemonic);</span>
<span class="nc" id="L488">        helpButton.setToolTipText(helpButtonToolTipText);</span>
<span class="nc" id="L489">        align(helpButton);</span>
<span class="nc" id="L490">        helpButton.setMargin(buttonMargin);</span>
<span class="nc" id="L491">        helpButton.setEnabled(false);</span>
<span class="nc" id="L492">        helpButton.setInheritsPopupMenu(true);</span>
<span class="nc" id="L493">        buttonPanel.add(helpButton);</span>
<span class="nc" id="L494">        buttonPanel.add(Box.createGlue());</span>
<span class="nc" id="L495">        buttonPanel.setInheritsPopupMenu(true);</span>

<span class="nc" id="L497">        bottomPanel.add(buttonPanel, BorderLayout.SOUTH);</span>
<span class="nc" id="L498">        bottomPanel.setInheritsPopupMenu(true);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (fc.getControlButtonsAreShown()) {</span>
<span class="nc" id="L500">           fc.add(bottomPanel, BorderLayout.SOUTH);</span>
        }
<span class="nc" id="L502">    }</span>

    protected JPanel getBottomPanel() {
<span class="nc bnc" id="L505" title="All 2 branches missed.">        if (bottomPanel == null) {</span>
<span class="nc" id="L506">            bottomPanel = new JPanel(new BorderLayout(0, 4));</span>
        }
<span class="nc" id="L508">        return bottomPanel;</span>
    }

    private void doControlButtonsChanged(PropertyChangeEvent e) {
<span class="nc bnc" id="L512" title="All 2 branches missed.">        if (getFileChooser().getControlButtonsAreShown()) {</span>
<span class="nc" id="L513">            getFileChooser().add(bottomPanel,BorderLayout.SOUTH);</span>
        } else {
<span class="nc" id="L515">            getFileChooser().remove(getBottomPanel());</span>
        }
<span class="nc" id="L517">    }</span>

    public void uninstallComponents(JFileChooser fc) {
<span class="nc" id="L520">        fc.removeAll();</span>
<span class="nc" id="L521">        bottomPanel = null;</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">        if (filterComboBoxModel != null) {</span>
<span class="nc" id="L523">            fc.removePropertyChangeListener(filterComboBoxModel);</span>
        }
<span class="nc" id="L525">    }</span>

    protected void installStrings(JFileChooser fc) {
<span class="nc" id="L528">        super.installStrings(fc);</span>

<span class="nc" id="L530">        Locale l = fc.getLocale();</span>

<span class="nc" id="L532">        enterFolderNameLabelText = UIManager.getString(&quot;FileChooser.enterFolderNameLabelText&quot;,l);</span>
<span class="nc" id="L533">        enterFolderNameLabelMnemonic = getMnemonic(&quot;FileChooser.enterFolderNameLabelMnemonic&quot;, l);</span>
<span class="nc" id="L534">        enterFileNameLabelText = UIManager.getString(&quot;FileChooser.enterFileNameLabelText&quot;,l);</span>
<span class="nc" id="L535">        enterFileNameLabelMnemonic = getMnemonic(&quot;FileChooser.enterFileNameLabelMnemonic&quot;, l);</span>

<span class="nc" id="L537">        filesLabelText = UIManager.getString(&quot;FileChooser.filesLabelText&quot;,l);</span>
<span class="nc" id="L538">        filesLabelMnemonic = getMnemonic(&quot;FileChooser.filesLabelMnemonic&quot;, l);</span>

<span class="nc" id="L540">        foldersLabelText = UIManager.getString(&quot;FileChooser.foldersLabelText&quot;,l);</span>
<span class="nc" id="L541">        foldersLabelMnemonic = getMnemonic(&quot;FileChooser.foldersLabelMnemonic&quot;, l);</span>

<span class="nc" id="L543">        pathLabelText = UIManager.getString(&quot;FileChooser.pathLabelText&quot;,l);</span>
<span class="nc" id="L544">        pathLabelMnemonic = getMnemonic(&quot;FileChooser.pathLabelMnemonic&quot;, l);</span>

<span class="nc" id="L546">        filterLabelText = UIManager.getString(&quot;FileChooser.filterLabelText&quot;,l);</span>
<span class="nc" id="L547">        filterLabelMnemonic = getMnemonic(&quot;FileChooser.filterLabelMnemonic&quot;, l);</span>
<span class="nc" id="L548">    }</span>

    private Integer getMnemonic(String key, Locale l) {
<span class="nc" id="L551">        return SwingUtilities2.getUIDefaultsInt(key, l);</span>
    }

    protected void installIcons(JFileChooser fc) {
        // Since motif doesn't have button icons, leave this empty
        // which overrides the supertype icon loading
<span class="nc" id="L557">    }</span>

    protected void uninstallIcons(JFileChooser fc) {
        // Since motif doesn't have button icons, leave this empty
        // which overrides the supertype icon loading
<span class="nc" id="L562">    }</span>

    protected JScrollPane createFilesList() {
<span class="nc" id="L565">        fileList = new JList&lt;File&gt;();</span>

<span class="nc bnc" id="L567" title="All 2 branches missed.">        if(getFileChooser().isMultiSelectionEnabled()) {</span>
<span class="nc" id="L568">            fileList.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
        } else {
<span class="nc" id="L570">            fileList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
        }

<span class="nc" id="L573">        fileList.setModel(new MotifFileListModel());</span>
<span class="nc" id="L574">        fileList.getSelectionModel().removeSelectionInterval(0, 0);</span>
<span class="nc" id="L575">        fileList.setCellRenderer(new FileCellRenderer());</span>
<span class="nc" id="L576">        fileList.addListSelectionListener(createListSelectionListener(getFileChooser()));</span>
<span class="nc" id="L577">        fileList.addMouseListener(createDoubleClickListener(getFileChooser(), fileList));</span>
<span class="nc" id="L578">        fileList.addMouseListener(new MouseAdapter() {</span>
            public void mouseClicked(MouseEvent e) {
<span class="nc" id="L580">                JFileChooser chooser = getFileChooser();</span>
<span class="nc bnc" id="L581" title="All 4 branches missed.">                if (SwingUtilities.isLeftMouseButton(e) &amp;&amp; !chooser.isMultiSelectionEnabled()) {</span>
<span class="nc" id="L582">                    int index = SwingUtilities2.loc2IndexFileList(fileList, e.getPoint());</span>
<span class="nc bnc" id="L583" title="All 2 branches missed.">                    if (index &gt;= 0) {</span>
<span class="nc" id="L584">                        File file = fileList.getModel().getElementAt(index);</span>
<span class="nc" id="L585">                        setFileName(chooser.getName(file));</span>
                    }
                }
<span class="nc" id="L588">            }</span>
        });
<span class="nc" id="L590">        align(fileList);</span>
<span class="nc" id="L591">        JScrollPane scrollpane = new JScrollPane(fileList);</span>
<span class="nc" id="L592">        scrollpane.setPreferredSize(prefListSize);</span>
<span class="nc" id="L593">        scrollpane.setMaximumSize(MAX_SIZE);</span>
<span class="nc" id="L594">        align(scrollpane);</span>
<span class="nc" id="L595">        fileList.setInheritsPopupMenu(true);</span>
<span class="nc" id="L596">        scrollpane.setInheritsPopupMenu(true);</span>
<span class="nc" id="L597">        return scrollpane;</span>
    }

    protected JScrollPane createDirectoryList() {
<span class="nc" id="L601">        directoryList = new JList&lt;File&gt;();</span>
<span class="nc" id="L602">        align(directoryList);</span>

<span class="nc" id="L604">        directoryList.setCellRenderer(new DirectoryCellRenderer());</span>
<span class="nc" id="L605">        directoryList.setModel(new MotifDirectoryListModel());</span>
<span class="nc" id="L606">        directoryList.getSelectionModel().removeSelectionInterval(0, 0);</span>
<span class="nc" id="L607">        directoryList.addMouseListener(createDoubleClickListener(getFileChooser(), directoryList));</span>
<span class="nc" id="L608">        directoryList.addListSelectionListener(createListSelectionListener(getFileChooser()));</span>
<span class="nc" id="L609">        directoryList.setInheritsPopupMenu(true);</span>

<span class="nc" id="L611">        JScrollPane scrollpane = new JScrollPane(directoryList);</span>
<span class="nc" id="L612">        scrollpane.setMaximumSize(MAX_SIZE);</span>
<span class="nc" id="L613">        scrollpane.setPreferredSize(prefListSize);</span>
<span class="nc" id="L614">        scrollpane.setInheritsPopupMenu(true);</span>
<span class="nc" id="L615">        align(scrollpane);</span>
<span class="nc" id="L616">        return scrollpane;</span>
    }

    public Dimension getPreferredSize(JComponent c) {
<span class="nc" id="L620">        Dimension prefSize =</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">            (getFileChooser().getAccessory() != null) ? WITH_ACCELERATOR_PREF_SIZE : PREF_SIZE;</span>
<span class="nc" id="L622">        Dimension d = c.getLayout().preferredLayoutSize(c);</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if (d != null) {</span>
<span class="nc bnc" id="L624" title="All 4 branches missed.">            return new Dimension(d.width &lt; prefSize.width ? prefSize.width : d.width,</span>
                                 d.height &lt; prefSize.height ? prefSize.height : d.height);
        } else {
<span class="nc" id="L627">            return prefSize;</span>
        }
    }

    public Dimension getMinimumSize(JComponent x)  {
<span class="nc" id="L632">        return MIN_SIZE;</span>
    }

    public Dimension getMaximumSize(JComponent x) {
<span class="nc" id="L636">        return new Dimension(Integer.MAX_VALUE, Integer.MAX_VALUE);</span>
    }

    protected void align(JComponent c) {
<span class="nc" id="L640">        c.setAlignmentX(JComponent.LEFT_ALIGNMENT);</span>
<span class="nc" id="L641">        c.setAlignmentY(JComponent.TOP_ALIGNMENT);</span>
<span class="nc" id="L642">    }</span>

<span class="nc" id="L644">    protected class FileCellRenderer extends DefaultListCellRenderer  {</span>
        public Component getListCellRendererComponent(JList list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {

<span class="nc" id="L648">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>
<span class="nc" id="L649">            setText(getFileChooser().getName((File) value));</span>
<span class="nc" id="L650">            setInheritsPopupMenu(true);</span>
<span class="nc" id="L651">            return this;</span>
        }
    }

<span class="nc" id="L655">    protected class DirectoryCellRenderer extends DefaultListCellRenderer  {</span>
        public Component getListCellRendererComponent(JList list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {

<span class="nc" id="L659">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>
<span class="nc" id="L660">            setText(getFileChooser().getName((File) value));</span>
<span class="nc" id="L661">            setInheritsPopupMenu(true);</span>
<span class="nc" id="L662">            return this;</span>
        }
    }

    protected class MotifDirectoryListModel extends AbstractListModel&lt;File&gt; implements ListDataListener {
<span class="nc" id="L667">        public MotifDirectoryListModel() {</span>
<span class="nc" id="L668">            getModel().addListDataListener(this);</span>
<span class="nc" id="L669">        }</span>

        public int getSize() {
<span class="nc" id="L672">            return getModel().getDirectories().size();</span>
        }

        public File getElementAt(int index) {
<span class="nc" id="L676">            return getModel().getDirectories().elementAt(index);</span>
        }

        public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L680">            fireIntervalAdded(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L681">        }</span>

        public void intervalRemoved(ListDataEvent e) {
<span class="nc" id="L684">            fireIntervalRemoved(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L685">        }</span>

        // PENDING(jeff) - this is inefficient - should sent out
        // incremental adjustment values instead of saying that the
        // whole list has changed.
        public void fireContentsChanged() {
<span class="nc" id="L691">            fireContentsChanged(this, 0, getModel().getDirectories().size()-1);</span>
<span class="nc" id="L692">        }</span>

        // PENDING(jeff) - fire the correct interval changed - currently sending
        // out that everything has changed
        public void contentsChanged(ListDataEvent e) {
<span class="nc" id="L697">            fireContentsChanged();</span>
<span class="nc" id="L698">        }</span>

    }

    protected class MotifFileListModel extends AbstractListModel&lt;File&gt; implements ListDataListener {
<span class="nc" id="L703">        public MotifFileListModel() {</span>
<span class="nc" id="L704">            getModel().addListDataListener(this);</span>
<span class="nc" id="L705">        }</span>

        public int getSize() {
<span class="nc" id="L708">            return getModel().getFiles().size();</span>
        }

        public boolean contains(Object o) {
<span class="nc" id="L712">            return getModel().getFiles().contains(o);</span>
        }

        public int indexOf(Object o) {
<span class="nc" id="L716">            return getModel().getFiles().indexOf(o);</span>
        }

        public File getElementAt(int index) {
<span class="nc" id="L720">            return getModel().getFiles().elementAt(index);</span>
        }

        public void intervalAdded(ListDataEvent e) {
<span class="nc" id="L724">            fireIntervalAdded(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L725">        }</span>

        public void intervalRemoved(ListDataEvent e) {
<span class="nc" id="L728">            fireIntervalRemoved(this, e.getIndex0(), e.getIndex1());</span>
<span class="nc" id="L729">        }</span>

        // PENDING(jeff) - this is inefficient - should sent out
        // incremental adjustment values instead of saying that the
        // whole list has changed.
        public void fireContentsChanged() {
<span class="nc" id="L735">            fireContentsChanged(this, 0, getModel().getFiles().size()-1);</span>
<span class="nc" id="L736">        }</span>

        // PENDING(jeff) - fire the interval changed
        public void contentsChanged(ListDataEvent e) {
<span class="nc" id="L740">            fireContentsChanged();</span>
<span class="nc" id="L741">        }</span>

    }

    //
    // DataModel for Types Comboxbox
    //
    protected FilterComboBoxModel createFilterComboBoxModel() {
<span class="nc" id="L749">        return new FilterComboBoxModel();</span>
    }

    //
    // Renderer for Types ComboBox
    //
    protected FilterComboBoxRenderer createFilterComboBoxRenderer() {
<span class="nc" id="L756">        return new FilterComboBoxRenderer();</span>
    }


    /**
     * Render different type sizes and styles.
     */
<span class="nc" id="L763">    public class FilterComboBoxRenderer extends DefaultListCellRenderer {</span>
        public Component getListCellRendererComponent(JList list,
            Object value, int index, boolean isSelected,
            boolean cellHasFocus) {

<span class="nc" id="L768">            super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>

<span class="nc bnc" id="L770" title="All 4 branches missed.">            if (value != null &amp;&amp; value instanceof FileFilter) {</span>
<span class="nc" id="L771">                setText(((FileFilter)value).getDescription());</span>
            }

<span class="nc" id="L774">            return this;</span>
        }
    }

    /**
     * Data model for a type-face selection combo-box.
     */
<span class="nc" id="L781">    protected class FilterComboBoxModel extends AbstractFilterComboBoxModel {</span>
        protected JFileChooser getFileChooser() {
<span class="nc" id="L783">            return MotifFileChooserUI.this.getFileChooser();</span>
        }
    }

    protected JButton getApproveButton(JFileChooser fc) {
<span class="nc" id="L788">        return approveButton;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>