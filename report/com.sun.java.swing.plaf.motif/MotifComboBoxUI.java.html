<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MotifComboBoxUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.motif</a> &gt; <span class="el_source">MotifComboBoxUI.java</span></div><h1>MotifComboBoxUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package com.sun.java.swing.plaf.motif;

import java.awt.*;
import javax.swing.*;
import javax.swing.plaf.*;
import javax.swing.border.*;
import javax.swing.plaf.basic.*;
import java.io.Serializable;
import java.awt.event.*;
import java.beans.*;

/**
 * ComboBox motif look and feel
 * &lt;p&gt; * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases.  The current serialization support is appropriate
 * for short term storage or RMI between applications running the same
 * version of Swing.  A future release of Swing will provide support for
 * long term persistence.
 *
 * @author Arnaud Weber
 */
<span class="nc" id="L47">public class MotifComboBoxUI extends BasicComboBoxUI implements Serializable {</span>
    Icon arrowIcon;
    static final int HORIZ_MARGIN = 3;

    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L52">        return new MotifComboBoxUI();</span>
    }

    public void installUI(JComponent c) {
<span class="nc" id="L56">        super.installUI(c);</span>
<span class="nc" id="L57">        arrowIcon = new MotifComboBoxArrowIcon(UIManager.getColor(&quot;controlHighlight&quot;),</span>
<span class="nc" id="L58">                                               UIManager.getColor(&quot;controlShadow&quot;),</span>
<span class="nc" id="L59">                                               UIManager.getColor(&quot;control&quot;));</span>

<span class="nc" id="L61">        Runnable initCode = new Runnable() {</span>
            public void run(){
<span class="nc bnc" id="L63" title="All 2 branches missed.">                if ( motifGetEditor() != null ) {</span>
<span class="nc" id="L64">                    motifGetEditor().setBackground( UIManager.getColor( &quot;text&quot; ) );</span>
                }
<span class="nc" id="L66">            }</span>
        };

<span class="nc" id="L69">        SwingUtilities.invokeLater( initCode );</span>
<span class="nc" id="L70">    }</span>

    public Dimension getMinimumSize( JComponent c ) {
<span class="nc bnc" id="L73" title="All 2 branches missed.">        if ( !isMinimumSizeDirty ) {</span>
<span class="nc" id="L74">            return new Dimension( cachedMinimumSize );</span>
        }
        Dimension size;
<span class="nc" id="L77">        Insets insets = getInsets();</span>
<span class="nc" id="L78">        size = getDisplaySize();</span>
<span class="nc" id="L79">        size.height += insets.top + insets.bottom;</span>
<span class="nc" id="L80">        int buttonSize = iconAreaWidth();</span>
<span class="nc" id="L81">        size.width +=  insets.left + insets.right + buttonSize;</span>

<span class="nc" id="L83">        cachedMinimumSize.setSize( size.width, size.height );</span>
<span class="nc" id="L84">        isMinimumSizeDirty = false;</span>

<span class="nc" id="L86">        return size;</span>
    }

    protected ComboPopup createPopup() {
<span class="nc" id="L90">        return new MotifComboPopup( comboBox );</span>
    }

    /**
     * Overriden to empty the MouseMotionListener.
     */
    protected class MotifComboPopup extends BasicComboPopup {

<span class="nc" id="L98">        public MotifComboPopup( JComboBox comboBox ) {</span>
<span class="nc" id="L99">            super( comboBox );</span>
<span class="nc" id="L100">        }</span>

        /**
         * Motif combo popup should not track the mouse in the list.
         */
        public MouseMotionListener createListMouseMotionListener() {
<span class="nc" id="L106">           return new MouseMotionAdapter() {};</span>
        }

        public KeyListener createKeyListener() {
<span class="nc" id="L110">            return super.createKeyListener();</span>
        }

        protected class InvocationKeyHandler extends BasicComboPopup.InvocationKeyHandler {
<span class="nc" id="L114">            protected InvocationKeyHandler() {</span>
<span class="nc" id="L115">                MotifComboPopup.this.super();</span>
<span class="nc" id="L116">            }</span>
        }
    }

    protected void installComponents() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if ( comboBox.isEditable() ) {</span>
<span class="nc" id="L122">            addEditor();</span>
        }

<span class="nc" id="L125">        comboBox.add( currentValuePane );</span>
<span class="nc" id="L126">    }</span>

    protected void uninstallComponents() {
<span class="nc" id="L129">        removeEditor();</span>
<span class="nc" id="L130">        comboBox.removeAll();</span>
<span class="nc" id="L131">    }</span>

    public void paint(Graphics g, JComponent c) {
<span class="nc" id="L134">        boolean hasFocus = comboBox.hasFocus();</span>
        Rectangle r;

<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (comboBox.isEnabled()) {</span>
<span class="nc" id="L138">            g.setColor(comboBox.getBackground());</span>
        } else {
<span class="nc" id="L140">            g.setColor(UIManager.getColor(&quot;ComboBox.disabledBackground&quot;));</span>
        }
<span class="nc" id="L142">        g.fillRect(0,0,c.getWidth(),c.getHeight());</span>

<span class="nc bnc" id="L144" title="All 2 branches missed.">        if ( !comboBox.isEditable() ) {</span>
<span class="nc" id="L145">            r = rectangleForCurrentValue();</span>
<span class="nc" id="L146">            paintCurrentValue(g,r,hasFocus);</span>
        }
<span class="nc" id="L148">        r = rectangleForArrowIcon();</span>
<span class="nc" id="L149">        arrowIcon.paintIcon(c,g,r.x,r.y);</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">        if ( !comboBox.isEditable() ) {</span>
<span class="nc" id="L151">            Border border = comboBox.getBorder();</span>
            Insets in;
<span class="nc bnc" id="L153" title="All 2 branches missed.">            if ( border != null ) {</span>
<span class="nc" id="L154">                in = border.getBorderInsets(comboBox);</span>
            }
            else {
<span class="nc" id="L157">                in = new Insets( 0, 0, 0, 0 );</span>
            }
            // Draw the separation
<span class="nc bnc" id="L160" title="All 2 branches missed.">            if(MotifGraphicsUtils.isLeftToRight(comboBox)) {</span>
<span class="nc" id="L161">                r.x -= (HORIZ_MARGIN + 2);</span>
            }
            else {
<span class="nc" id="L164">                r.x += r.width + HORIZ_MARGIN + 1;</span>
            }
<span class="nc" id="L166">            r.y = in.top;</span>
<span class="nc" id="L167">            r.width = 1;</span>
<span class="nc" id="L168">            r.height = comboBox.getBounds().height - in.bottom - in.top;</span>
<span class="nc" id="L169">            g.setColor(UIManager.getColor(&quot;controlShadow&quot;));</span>
<span class="nc" id="L170">            g.fillRect(r.x,r.y,r.width,r.height);</span>
<span class="nc" id="L171">            r.x++;</span>
<span class="nc" id="L172">            g.setColor(UIManager.getColor(&quot;controlHighlight&quot;));</span>
<span class="nc" id="L173">            g.fillRect(r.x,r.y,r.width,r.height);</span>
        }
<span class="nc" id="L175">    }</span>

    public void paintCurrentValue(Graphics g,Rectangle bounds,boolean hasFocus) {
<span class="nc" id="L178">        ListCellRenderer renderer = comboBox.getRenderer();</span>
        Component c;
        Dimension d;
<span class="nc" id="L181">        c = renderer.getListCellRendererComponent(listBox, comboBox.getSelectedItem(), -1, false, false);</span>
<span class="nc" id="L182">        c.setFont(comboBox.getFont());</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">        if ( comboBox.isEnabled() ) {</span>
<span class="nc" id="L184">            c.setForeground(comboBox.getForeground());</span>
<span class="nc" id="L185">            c.setBackground(comboBox.getBackground());</span>
        }
        else {
<span class="nc" id="L188">            c.setForeground(UIManager.getColor(&quot;ComboBox.disabledForeground&quot;));</span>
<span class="nc" id="L189">            c.setBackground(UIManager.getColor(&quot;ComboBox.disabledBackground&quot;));</span>
        }
<span class="nc" id="L191">        d  = c.getPreferredSize();</span>
<span class="nc" id="L192">        currentValuePane.paintComponent(g,c,comboBox,bounds.x,bounds.y,</span>
                                        bounds.width,d.height);
<span class="nc" id="L194">    }</span>

    protected Rectangle rectangleForArrowIcon() {
<span class="nc" id="L197">        Rectangle b = comboBox.getBounds();</span>
<span class="nc" id="L198">        Border border = comboBox.getBorder();</span>
        Insets in;
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if ( border != null ) {</span>
<span class="nc" id="L201">            in = border.getBorderInsets(comboBox);</span>
        }
        else {
<span class="nc" id="L204">            in = new Insets( 0, 0, 0, 0 );</span>
        }
<span class="nc" id="L206">        b.x = in.left;</span>
<span class="nc" id="L207">        b.y = in.top;</span>
<span class="nc" id="L208">        b.width -= (in.left + in.right);</span>
<span class="nc" id="L209">        b.height -= (in.top + in.bottom);</span>

<span class="nc bnc" id="L211" title="All 2 branches missed.">        if(MotifGraphicsUtils.isLeftToRight(comboBox)) {</span>
<span class="nc" id="L212">            b.x = b.x + b.width - HORIZ_MARGIN - arrowIcon.getIconWidth();</span>
        }
        else {
<span class="nc" id="L215">            b.x += HORIZ_MARGIN;</span>
        }
<span class="nc" id="L217">        b.y = b.y + (b.height - arrowIcon.getIconHeight()) / 2;</span>
<span class="nc" id="L218">        b.width = arrowIcon.getIconWidth();</span>
<span class="nc" id="L219">        b.height = arrowIcon.getIconHeight();</span>
<span class="nc" id="L220">        return b;</span>
    }

    protected Rectangle rectangleForCurrentValue() {
<span class="nc" id="L224">        int width = comboBox.getWidth();</span>
<span class="nc" id="L225">        int height = comboBox.getHeight();</span>
<span class="nc" id="L226">        Insets insets = getInsets();</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">        if(MotifGraphicsUtils.isLeftToRight(comboBox)) {</span>
<span class="nc" id="L228">            return new Rectangle(insets.left, insets.top,</span>
                                 (width - (insets.left + insets.right)) -
<span class="nc" id="L230">                                                        iconAreaWidth(),</span>
                                 height - (insets.top + insets.bottom));
        }
        else {
<span class="nc" id="L234">            return new Rectangle(insets.left + iconAreaWidth(), insets.top,</span>
                                 (width - (insets.left + insets.right)) -
<span class="nc" id="L236">                                                        iconAreaWidth(),</span>
                                 height - (insets.top + insets.bottom));
        }
    }

    public int iconAreaWidth() {
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if ( comboBox.isEditable() )</span>
<span class="nc" id="L243">            return arrowIcon.getIconWidth() + (2 * HORIZ_MARGIN);</span>
        else
<span class="nc" id="L245">            return arrowIcon.getIconWidth() + (3 * HORIZ_MARGIN) + 2;</span>
    }

    public void configureEditor() {
<span class="nc" id="L249">        super.configureEditor();</span>
<span class="nc" id="L250">        editor.setBackground( UIManager.getColor( &quot;text&quot; ) );</span>
<span class="nc" id="L251">    }</span>

    protected LayoutManager createLayoutManager() {
<span class="nc" id="L254">        return new ComboBoxLayoutManager();</span>
    }

    private Component motifGetEditor() {
<span class="nc" id="L258">        return editor;</span>
    }

    /**
     * This inner class is marked &amp;quot;public&amp;quot; due to a compiler bug.
     * This class should be treated as a &amp;quot;protected&amp;quot; inner class.
     * Instantiate it only within subclasses of &lt;JDKUI&gt;.
     */
    public class ComboBoxLayoutManager extends BasicComboBoxUI.ComboBoxLayoutManager {
<span class="nc" id="L267">        public ComboBoxLayoutManager() {</span>
<span class="nc" id="L268">            MotifComboBoxUI.this.super();</span>
<span class="nc" id="L269">        }</span>
        public void layoutContainer(Container parent) {
<span class="nc bnc" id="L271" title="All 2 branches missed.">            if ( motifGetEditor() != null ) {</span>
<span class="nc" id="L272">                Rectangle cvb = rectangleForCurrentValue();</span>
<span class="nc" id="L273">                cvb.x += 1;</span>
<span class="nc" id="L274">                cvb.y += 1;</span>
<span class="nc" id="L275">                cvb.width -= 1;</span>
<span class="nc" id="L276">                cvb.height -= 2;</span>
<span class="nc" id="L277">                motifGetEditor().setBounds(cvb);</span>
            }
<span class="nc" id="L279">        }</span>
    }

    static class MotifComboBoxArrowIcon implements Icon, Serializable {
        private Color lightShadow;
        private Color darkShadow;
        private Color fill;

<span class="nc" id="L287">        public MotifComboBoxArrowIcon(Color lightShadow, Color darkShadow, Color fill) {</span>
<span class="nc" id="L288">            this.lightShadow = lightShadow;</span>
<span class="nc" id="L289">            this.darkShadow = darkShadow;</span>
<span class="nc" id="L290">            this.fill = fill;</span>
<span class="nc" id="L291">        }</span>


        public void paintIcon(Component c, Graphics g, int xo, int yo) {
<span class="nc" id="L295">            int w = getIconWidth();</span>
<span class="nc" id="L296">            int h = getIconHeight();</span>

<span class="nc" id="L298">            g.setColor(lightShadow);</span>
<span class="nc" id="L299">            g.drawLine(xo, yo, xo+w-1, yo);</span>
<span class="nc" id="L300">            g.drawLine(xo, yo+1, xo+w-3, yo+1);</span>
<span class="nc" id="L301">            g.setColor(darkShadow);</span>
<span class="nc" id="L302">            g.drawLine(xo+w-2, yo+1, xo+w-1, yo+1);</span>

<span class="nc bnc" id="L304" title="All 2 branches missed.">            for ( int x = xo+1, y = yo+2, dx = w-6; y+1 &lt; yo+h; y += 2 ) {</span>
<span class="nc" id="L305">                g.setColor(lightShadow);</span>
<span class="nc" id="L306">                g.drawLine(x, y,   x+1, y);</span>
<span class="nc" id="L307">                g.drawLine(x, y+1, x+1, y+1);</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">                if ( dx &gt; 0 ) {</span>
<span class="nc" id="L309">                    g.setColor(fill);</span>
<span class="nc" id="L310">                    g.drawLine(x+2, y,   x+1+dx, y);</span>
<span class="nc" id="L311">                    g.drawLine(x+2, y+1, x+1+dx, y+1);</span>
                }
<span class="nc" id="L313">                g.setColor(darkShadow);</span>
<span class="nc" id="L314">                g.drawLine(x+dx+2, y,   x+dx+3, y);</span>
<span class="nc" id="L315">                g.drawLine(x+dx+2, y+1, x+dx+3, y+1);</span>
<span class="nc" id="L316">                x += 1;</span>
<span class="nc" id="L317">                dx -= 2;</span>
            }

<span class="nc" id="L320">            g.setColor(darkShadow);</span>
<span class="nc" id="L321">            g.drawLine(xo+(w/2), yo+h-1, xo+(w/2), yo+h-1);</span>

<span class="nc" id="L323">        }</span>

        public int getIconWidth() {
<span class="nc" id="L326">            return 11;</span>
        }

        public int getIconHeight() {
<span class="nc" id="L330">            return 11;</span>
        }
    }

    /**
     *{@inheritDoc}
     *
     * @since 1.6
     */
    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L340">        return new MotifPropertyChangeListener();</span>
    }

    /**
     * This class should be made &amp;quot;protected&amp;quot; in future releases.
     */
<span class="nc" id="L346">    private class MotifPropertyChangeListener</span>
            extends BasicComboBoxUI.PropertyChangeHandler {
        public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L349">            super.propertyChange(e);</span>
<span class="nc" id="L350">            String propertyName = e.getPropertyName();</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">            if (propertyName == &quot;enabled&quot;) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                if (comboBox.isEnabled()) {</span>
<span class="nc" id="L353">                    Component editor = motifGetEditor();</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                    if (editor != null) {</span>
<span class="nc" id="L355">                        editor.setBackground(UIManager.getColor(&quot;text&quot;));</span>
                    }
                }
            }
<span class="nc" id="L359">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>