<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>Dialog.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.awt</a> &gt; <span class="el_source">Dialog.java</span></div><h1>Dialog.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1995, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package java.awt;

import java.awt.peer.DialogPeer;
import java.awt.event.*;
import java.io.ObjectInputStream;
import java.io.IOException;
import java.util.Iterator;
import java.util.concurrent.atomic.AtomicLong;
import java.security.AccessController;
import java.security.PrivilegedAction;
import javax.accessibility.*;
import sun.awt.AppContext;
import sun.awt.SunToolkit;
import sun.awt.PeerEvent;
import sun.awt.util.IdentityArrayList;
import sun.awt.util.IdentityLinkedList;
import sun.security.util.SecurityConstants;
import java.security.AccessControlException;

/**
 * A Dialog is a top-level window with a title and a border
 * that is typically used to take some form of input from the user.
 *
 * The size of the dialog includes any area designated for the
 * border.  The dimensions of the border area can be obtained
 * using the &lt;code&gt;getInsets&lt;/code&gt; method, however, since
 * these dimensions are platform-dependent, a valid insets
 * value cannot be obtained until the dialog is made displayable
 * by either calling &lt;code&gt;pack&lt;/code&gt; or &lt;code&gt;show&lt;/code&gt;.
 * Since the border area is included in the overall size of the
 * dialog, the border effectively obscures a portion of the dialog,
 * constraining the area available for rendering and/or displaying
 * subcomponents to the rectangle which has an upper-left corner
 * location of &lt;code&gt;(insets.left, insets.top)&lt;/code&gt;, and has a size of
 * &lt;code&gt;width - (insets.left + insets.right)&lt;/code&gt; by
 * &lt;code&gt;height - (insets.top + insets.bottom)&lt;/code&gt;.
 * &lt;p&gt;
 * The default layout for a dialog is &lt;code&gt;BorderLayout&lt;/code&gt;.
 * &lt;p&gt;
 * A dialog may have its native decorations (i.e. Frame &amp;amp; Titlebar) turned off
 * with &lt;code&gt;setUndecorated&lt;/code&gt;.  This can only be done while the dialog
 * is not {@link Component#isDisplayable() displayable}.
 * &lt;p&gt;
 * A dialog may have another window as its owner when it's constructed.  When
 * the owner window of a visible dialog is minimized, the dialog will
 * automatically be hidden from the user. When the owner window is subsequently
 * restored, the dialog is made visible to the user again.
 * &lt;p&gt;
 * In a multi-screen environment, you can create a &lt;code&gt;Dialog&lt;/code&gt;
 * on a different screen device than its owner.  See {@link java.awt.Frame} for
 * more information.
 * &lt;p&gt;
 * A dialog can be either modeless (the default) or modal.  A modal
 * dialog is one which blocks input to some other top-level windows
 * in the application, except for any windows created with the dialog
 * as their owner. See &lt;a href=&quot;doc-files/Modality.html&quot;&gt;AWT Modality&lt;/a&gt;
 * specification for details.
 * &lt;p&gt;
 * Dialogs are capable of generating the following
 * &lt;code&gt;WindowEvents&lt;/code&gt;:
 * &lt;code&gt;WindowOpened&lt;/code&gt;, &lt;code&gt;WindowClosing&lt;/code&gt;,
 * &lt;code&gt;WindowClosed&lt;/code&gt;, &lt;code&gt;WindowActivated&lt;/code&gt;,
 * &lt;code&gt;WindowDeactivated&lt;/code&gt;, &lt;code&gt;WindowGainedFocus&lt;/code&gt;,
 * &lt;code&gt;WindowLostFocus&lt;/code&gt;.
 *
 * @see WindowEvent
 * @see Window#addWindowListener
 *
 * @author      Sami Shaio
 * @author      Arthur van Hoff
 * @since       JDK1.0
 */
public class Dialog extends Window {

    static {
        /* ensure that the necessary native libraries are loaded */
<span class="nc" id="L101">        Toolkit.loadLibraries();</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (!GraphicsEnvironment.isHeadless()) {</span>
<span class="nc" id="L103">            initIDs();</span>
        }
    }

    /**
     * A dialog's resizable property. Will be true
     * if the Dialog is to be resizable, otherwise
     * it will be false.
     *
     * @serial
     * @see #setResizable(boolean)
     */
<span class="nc" id="L115">    boolean resizable = true;</span>


    /**
     * This field indicates whether the dialog is undecorated.
     * This property can only be changed while the dialog is not displayable.
     * &lt;code&gt;undecorated&lt;/code&gt; will be true if the dialog is
     * undecorated, otherwise it will be false.
     *
     * @serial
     * @see #setUndecorated(boolean)
     * @see #isUndecorated()
     * @see Component#isDisplayable()
     * @since 1.4
     */
<span class="nc" id="L130">    boolean undecorated = false;</span>

<span class="nc" id="L132">    private transient boolean initialized = false;</span>

    /**
     * Modal dialogs block all input to some top-level windows.
     * Whether a particular window is blocked depends on dialog's type
     * of modality; this is called the &quot;scope of blocking&quot;. The
     * &lt;code&gt;ModalityType&lt;/code&gt; enum specifies modal types and their
     * associated scopes.
     *
     * @see Dialog#getModalityType
     * @see Dialog#setModalityType
     * @see Toolkit#isModalityTypeSupported
     *
     * @since 1.6
     */
<span class="nc" id="L147">    public static enum ModalityType {</span>
        /**
         * &lt;code&gt;MODELESS&lt;/code&gt; dialog doesn't block any top-level windows.
         */
<span class="nc" id="L151">        MODELESS,</span>
        /**
         * A &lt;code&gt;DOCUMENT_MODAL&lt;/code&gt; dialog blocks input to all top-level windows
         * from the same document except those from its own child hierarchy.
         * A document is a top-level window without an owner. It may contain child
         * windows that, together with the top-level window are treated as a single
         * solid document. Since every top-level window must belong to some
         * document, its root can be found as the top-nearest window without an owner.
         */
<span class="nc" id="L160">        DOCUMENT_MODAL,</span>
        /**
         * An &lt;code&gt;APPLICATION_MODAL&lt;/code&gt; dialog blocks all top-level windows
         * from the same Java application except those from its own child hierarchy.
         * If there are several applets launched in a browser, they can be
         * treated either as separate applications or a single one. This behavior
         * is implementation-dependent.
         */
<span class="nc" id="L168">        APPLICATION_MODAL,</span>
        /**
         * A &lt;code&gt;TOOLKIT_MODAL&lt;/code&gt; dialog blocks all top-level windows run
         * from the same toolkit except those from its own child hierarchy. If there
         * are several applets launched in a browser, all of them run with the same
         * toolkit; thus, a toolkit-modal dialog displayed by an applet may affect
         * other applets and all windows of the browser instance which embeds the
         * Java runtime environment for this toolkit.
         * Special &lt;code&gt;AWTPermission&lt;/code&gt; &quot;toolkitModality&quot; must be granted to use
         * toolkit-modal dialogs. If a &lt;code&gt;TOOLKIT_MODAL&lt;/code&gt; dialog is being created
         * and this permission is not granted, a &lt;code&gt;SecurityException&lt;/code&gt; will be
         * thrown, and no dialog will be created. If a modality type is being changed
         * to &lt;code&gt;TOOLKIT_MODAL&lt;/code&gt; and this permission is not granted, a
         * &lt;code&gt;SecurityException&lt;/code&gt; will be thrown, and the modality type will
         * be left unchanged.
         */
<span class="nc" id="L184">        TOOLKIT_MODAL</span>
    };

    /**
     * Default modality type for modal dialogs. The default modality type is
     * &lt;code&gt;APPLICATION_MODAL&lt;/code&gt;. Calling the oldstyle &lt;code&gt;setModal(true)&lt;/code&gt;
     * is equal to &lt;code&gt;setModalityType(DEFAULT_MODALITY_TYPE)&lt;/code&gt;.
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog#setModal
     *
     * @since 1.6
     */
<span class="nc" id="L197">    public final static ModalityType DEFAULT_MODALITY_TYPE = ModalityType.APPLICATION_MODAL;</span>

    /**
     * True if this dialog is modal, false is the dialog is modeless.
     * A modal dialog blocks user input to some application top-level
     * windows. This field is kept only for backwards compatibility. Use the
     * {@link Dialog.ModalityType ModalityType} enum instead.
     *
     * @serial
     *
     * @see #isModal
     * @see #setModal
     * @see #getModalityType
     * @see #setModalityType
     * @see ModalityType
     * @see ModalityType#MODELESS
     * @see #DEFAULT_MODALITY_TYPE
     */
    boolean modal;

    /**
     * Modality type of this dialog. If the dialog's modality type is not
     * {@link Dialog.ModalityType#MODELESS ModalityType.MODELESS}, it blocks all
     * user input to some application top-level windows.
     *
     * @serial
     *
     * @see ModalityType
     * @see #getModalityType
     * @see #setModalityType
     *
     * @since 1.6
     */
    ModalityType modalityType;

    /**
     * Any top-level window can be marked not to be blocked by modal
     * dialogs. This is called &quot;modal exclusion&quot;. This enum specifies
     * the possible modal exclusion types.
     *
     * @see Window#getModalExclusionType
     * @see Window#setModalExclusionType
     * @see Toolkit#isModalExclusionTypeSupported
     *
     * @since 1.6
     */
<span class="nc" id="L243">    public static enum ModalExclusionType {</span>
        /**
         * No modal exclusion.
         */
<span class="nc" id="L247">        NO_EXCLUDE,</span>
        /**
         * &lt;code&gt;APPLICATION_EXCLUDE&lt;/code&gt; indicates that a top-level window
         * won't be blocked by any application-modal dialogs. Also, it isn't
         * blocked by document-modal dialogs from outside of its child hierarchy.
         */
<span class="nc" id="L253">        APPLICATION_EXCLUDE,</span>
        /**
         * &lt;code&gt;TOOLKIT_EXCLUDE&lt;/code&gt; indicates that a top-level window
         * won't be blocked by  application-modal or toolkit-modal dialogs. Also,
         * it isn't blocked by document-modal dialogs from outside of its
         * child hierarchy.
         * The &quot;toolkitModality&quot; &lt;code&gt;AWTPermission&lt;/code&gt; must be granted
         * for this exclusion. If an exclusion property is being changed to
         * &lt;code&gt;TOOLKIT_EXCLUDE&lt;/code&gt; and this permission is not granted, a
         * &lt;code&gt;SecurityEcxeption&lt;/code&gt; will be thrown, and the exclusion
         * property will be left unchanged.
         */
<span class="nc" id="L265">        TOOLKIT_EXCLUDE</span>
    };

    /* operations with this list should be synchronized on tree lock*/
<span class="nc" id="L269">    transient static IdentityArrayList&lt;Dialog&gt; modalDialogs = new IdentityArrayList&lt;Dialog&gt;();</span>

<span class="nc" id="L271">    transient IdentityArrayList&lt;Window&gt; blockedWindows = new IdentityArrayList&lt;Window&gt;();</span>

    /**
     * Specifies the title of the Dialog.
     * This field can be null.
     *
     * @serial
     * @see #getTitle()
     * @see #setTitle(String)
     */
    String title;

    private transient ModalEventFilter modalFilter;
    private transient volatile SecondaryLoop secondaryLoop;

    /*
     * Indicates that this dialog is being hidden. This flag is set to true at
     * the beginning of hide() and to false at the end of hide().
     *
     * @see #hide()
     * @see #hideAndDisposePreHandler()
     * @see #hideAndDisposeHandler()
     * @see #shouldBlock()
     */
<span class="nc" id="L295">    transient volatile boolean isInHide = false;</span>

    /*
     * Indicates that this dialog is being disposed. This flag is set to true at
     * the beginning of doDispose() and to false at the end of doDispose().
     *
     * @see #hide()
     * @see #hideAndDisposePreHandler()
     * @see #hideAndDisposeHandler()
     * @see #doDispose()
     */
<span class="nc" id="L306">    transient volatile boolean isInDispose = false;</span>

    private static final String base = &quot;dialog&quot;;
<span class="nc" id="L309">    private static int nameCounter = 0;</span>

    /*
     * JDK 1.1 serialVersionUID
     */
    private static final long serialVersionUID = 5920926903803293709L;

    /**
     * Constructs an initially invisible, modeless &lt;code&gt;Dialog&lt;/code&gt; with
     * the specified owner &lt;code&gt;Frame&lt;/code&gt; and an empty title.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if
     *     this dialog has no owner
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *    &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *    &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see Component#setSize
     * @see Component#setVisible
     */
     public Dialog(Frame owner) {
<span class="nc" id="L332">         this(owner, &quot;&quot;, false);</span>
<span class="nc" id="L333">     }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the specified
     * owner &lt;code&gt;Frame&lt;/code&gt; and modality and an empty title.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if
     *     this dialog has no owner
     * @param modal specifies whether dialog blocks user input to other top-level
     *     windows when shown. If &lt;code&gt;false&lt;/code&gt;, the dialog is &lt;code&gt;MODELESS&lt;/code&gt;;
     *     if &lt;code&gt;true&lt;/code&gt;, the modality type property is set to
     *     &lt;code&gt;DEFAULT_MODALITY_TYPE&lt;/code&gt;
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *    &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog.ModalityType#MODELESS
     * @see java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     */
     public Dialog(Frame owner, boolean modal) {
<span class="nc" id="L358">         this(owner, &quot;&quot;, modal);</span>
<span class="nc" id="L359">     }</span>

    /**
     * Constructs an initially invisible, modeless &lt;code&gt;Dialog&lt;/code&gt; with
     * the specified owner &lt;code&gt;Frame&lt;/code&gt; and title.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if
     *     this dialog has no owner
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no title
     * @exception IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *     &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see Component#setSize
     * @see Component#setVisible
     */
     public Dialog(Frame owner, String title) {
<span class="nc" id="L379">         this(owner, title, false);</span>
<span class="nc" id="L380">     }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Frame&lt;/code&gt;, title and modality.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if
     *     this dialog has no owner
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no title
     * @param modal specifies whether dialog blocks user input to other top-level
     *     windows when shown. If &lt;code&gt;false&lt;/code&gt;, the dialog is &lt;code&gt;MODELESS&lt;/code&gt;;
     *     if &lt;code&gt;true&lt;/code&gt;, the modality type property is set to
     *     &lt;code&gt;DEFAULT_MODALITY_TYPE&lt;/code&gt;
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *    &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *    &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog.ModalityType#MODELESS
     * @see java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see Component#setSize
     * @see Component#setVisible
     */
     public Dialog(Frame owner, String title, boolean modal) {
<span class="nc bnc" id="L409" title="All 2 branches missed.">         this(owner, title, modal ? DEFAULT_MODALITY_TYPE : ModalityType.MODELESS);</span>
<span class="nc" id="L410">     }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the specified owner
     * &lt;code&gt;Frame&lt;/code&gt;, title, modality, and &lt;code&gt;GraphicsConfiguration&lt;/code&gt;.
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no owner
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no title
     * @param modal specifies whether dialog blocks user input to other top-level
     *     windows when shown. If &lt;code&gt;false&lt;/code&gt;, the dialog is &lt;code&gt;MODELESS&lt;/code&gt;;
     *     if &lt;code&gt;true&lt;/code&gt;, the modality type property is set to
     *     &lt;code&gt;DEFAULT_MODALITY_TYPE&lt;/code&gt;
     * @param gc the &lt;code&gt;GraphicsConfiguration&lt;/code&gt; of the target screen device;
     *     if &lt;code&gt;null&lt;/code&gt;, the default system &lt;code&gt;GraphicsConfiguration&lt;/code&gt;
     *     is assumed
     * @exception java.lang.IllegalArgumentException if &lt;code&gt;gc&lt;/code&gt;
     *     is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog.ModalityType#MODELESS
     * @see java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see Component#setSize
     * @see Component#setVisible
     * @since 1.4
     */
     public Dialog(Frame owner, String title, boolean modal,
                   GraphicsConfiguration gc) {
<span class="nc bnc" id="L443" title="All 2 branches missed.">         this(owner, title, modal ? DEFAULT_MODALITY_TYPE : ModalityType.MODELESS, gc);</span>
<span class="nc" id="L444">     }</span>

    /**
     * Constructs an initially invisible, modeless &lt;code&gt;Dialog&lt;/code&gt; with
     * the specified owner &lt;code&gt;Dialog&lt;/code&gt; and an empty title.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if this
     *     dialog has no owner
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *     &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @since 1.2
     */
     public Dialog(Dialog owner) {
<span class="nc" id="L460">         this(owner, &quot;&quot;, false);</span>
<span class="nc" id="L461">     }</span>

    /**
     * Constructs an initially invisible, modeless &lt;code&gt;Dialog&lt;/code&gt;
     * with the specified owner &lt;code&gt;Dialog&lt;/code&gt; and title.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if this
     *     has no owner
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no title
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *     &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @since 1.2
     */
     public Dialog(Dialog owner, String title) {
<span class="nc" id="L480">         this(owner, title, false);</span>
<span class="nc" id="L481">     }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Dialog&lt;/code&gt;, title, and modality.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if this
     *     dialog has no owner
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this
     *     dialog has no title
     * @param modal specifies whether dialog blocks user input to other top-level
     *     windows when shown. If &lt;code&gt;false&lt;/code&gt;, the dialog is &lt;code&gt;MODELESS&lt;/code&gt;;
     *     if &lt;code&gt;true&lt;/code&gt;, the modality type property is set to
     *     &lt;code&gt;DEFAULT_MODALITY_TYPE&lt;/code&gt;
     * @exception IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *    &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *    &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog.ModalityType#MODELESS
     * @see java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     *
     * @since 1.2
     */
     public Dialog(Dialog owner, String title, boolean modal) {
<span class="nc bnc" id="L510" title="All 2 branches missed.">         this(owner, title, modal ? DEFAULT_MODALITY_TYPE : ModalityType.MODELESS);</span>
<span class="nc" id="L511">     }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Dialog&lt;/code&gt;, title, modality and
     * &lt;code&gt;GraphicsConfiguration&lt;/code&gt;.
     *
     * @param owner the owner of the dialog or &lt;code&gt;null&lt;/code&gt; if this
     *     dialog has no owner
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this
     *     dialog has no title
     * @param modal specifies whether dialog blocks user input to other top-level
     *     windows when shown. If &lt;code&gt;false&lt;/code&gt;, the dialog is &lt;code&gt;MODELESS&lt;/code&gt;;
     *     if &lt;code&gt;true&lt;/code&gt;, the modality type property is set to
     *     &lt;code&gt;DEFAULT_MODALITY_TYPE&lt;/code&gt;
     * @param gc the &lt;code&gt;GraphicsConfiguration&lt;/code&gt; of the target screen device;
     *     if &lt;code&gt;null&lt;/code&gt;, the default system &lt;code&gt;GraphicsConfiguration&lt;/code&gt;
     *     is assumed
     * @exception java.lang.IllegalArgumentException if &lt;code&gt;gc&lt;/code&gt;
     *    is not from a screen device
     * @exception HeadlessException when
     *    &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog.ModalityType#MODELESS
     * @see java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see Component#setSize
     * @see Component#setVisible
     *
     * @since 1.4
     */
     public Dialog(Dialog owner, String title, boolean modal,
                   GraphicsConfiguration gc) {
<span class="nc bnc" id="L547" title="All 2 branches missed.">         this(owner, title, modal ? DEFAULT_MODALITY_TYPE : ModalityType.MODELESS, gc);</span>
<span class="nc" id="L548">     }</span>

    /**
     * Constructs an initially invisible, modeless &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Window&lt;/code&gt; and an empty title.
     *
     * @param owner the owner of the dialog. The owner must be an instance of
     *     {@link java.awt.Dialog Dialog}, {@link java.awt.Frame Frame}, any
     *     of their descendents or &lt;code&gt;null&lt;/code&gt;
     *
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;
     *     is not an instance of {@link java.awt.Dialog Dialog} or {@link
     *     java.awt.Frame Frame}
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *     &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.GraphicsEnvironment#isHeadless
     *
     * @since 1.6
     */
    public Dialog(Window owner) {
<span class="nc" id="L571">        this(owner, &quot;&quot;, ModalityType.MODELESS);</span>
<span class="nc" id="L572">    }</span>

    /**
     * Constructs an initially invisible, modeless &lt;code&gt;Dialog&lt;/code&gt; with
     * the specified owner &lt;code&gt;Window&lt;/code&gt; and title.
     *
     * @param owner the owner of the dialog. The owner must be an instance of
     *    {@link java.awt.Dialog Dialog}, {@link java.awt.Frame Frame}, any
     *    of their descendents or &lt;code&gt;null&lt;/code&gt;
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *    has no title
     *
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;
     *    is not an instance of {@link java.awt.Dialog Dialog} or {@link
     *    java.awt.Frame Frame}
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *    &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *    &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     *
     * @see java.awt.GraphicsEnvironment#isHeadless
     *
     * @since 1.6
     */
    public Dialog(Window owner, String title) {
<span class="nc" id="L597">        this(owner, title, ModalityType.MODELESS);</span>
<span class="nc" id="L598">    }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Window&lt;/code&gt; and modality and an empty title.
     *
     * @param owner the owner of the dialog. The owner must be an instance of
     *    {@link java.awt.Dialog Dialog}, {@link java.awt.Frame Frame}, any
     *    of their descendents or &lt;code&gt;null&lt;/code&gt;
     * @param modalityType specifies whether dialog blocks input to other
     *    windows when shown. &lt;code&gt;null&lt;/code&gt; value and unsupported modality
     *    types are equivalent to &lt;code&gt;MODELESS&lt;/code&gt;
     *
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;
     *    is not an instance of {@link java.awt.Dialog Dialog} or {@link
     *    java.awt.Frame Frame}
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *    &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *    &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     * @exception SecurityException if the calling thread does not have permission
     *    to create modal dialogs with the given &lt;code&gt;modalityType&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see java.awt.Toolkit#isModalityTypeSupported
     *
     * @since 1.6
     */
    public Dialog(Window owner, ModalityType modalityType) {
<span class="nc" id="L630">        this(owner, &quot;&quot;, modalityType);</span>
<span class="nc" id="L631">    }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Window&lt;/code&gt;, title and modality.
     *
     * @param owner the owner of the dialog. The owner must be an instance of
     *     {@link java.awt.Dialog Dialog}, {@link java.awt.Frame Frame}, any
     *     of their descendents or &lt;code&gt;null&lt;/code&gt;
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no title
     * @param modalityType specifies whether dialog blocks input to other
     *    windows when shown. &lt;code&gt;null&lt;/code&gt; value and unsupported modality
     *    types are equivalent to &lt;code&gt;MODELESS&lt;/code&gt;
     *
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;
     *     is not an instance of {@link java.awt.Dialog Dialog} or {@link
     *     java.awt.Frame Frame}
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;'s
     *     &lt;code&gt;GraphicsConfiguration&lt;/code&gt; is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     * @exception SecurityException if the calling thread does not have permission
     *     to create modal dialogs with the given &lt;code&gt;modalityType&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see java.awt.Toolkit#isModalityTypeSupported
     *
     * @since 1.6
     */
    public Dialog(Window owner, String title, ModalityType modalityType) {
<span class="nc" id="L665">        super(owner);</span>

<span class="nc bnc" id="L667" title="All 6 branches missed.">        if ((owner != null) &amp;&amp;</span>
            !(owner instanceof Frame) &amp;&amp;
            !(owner instanceof Dialog))
        {
<span class="nc" id="L671">            throw new IllegalArgumentException(&quot;Wrong parent window&quot;);</span>
        }

<span class="nc" id="L674">        this.title = title;</span>
<span class="nc" id="L675">        setModalityType(modalityType);</span>
<span class="nc" id="L676">        SunToolkit.checkAndSetPolicy(this);</span>
<span class="nc" id="L677">        initialized = true;</span>
<span class="nc" id="L678">    }</span>

    /**
     * Constructs an initially invisible &lt;code&gt;Dialog&lt;/code&gt; with the
     * specified owner &lt;code&gt;Window&lt;/code&gt;, title, modality and
     * &lt;code&gt;GraphicsConfiguration&lt;/code&gt;.
     *
     * @param owner the owner of the dialog. The owner must be an instance of
     *     {@link java.awt.Dialog Dialog}, {@link java.awt.Frame Frame}, any
     *     of their descendents or &lt;code&gt;null&lt;/code&gt;
     * @param title the title of the dialog or &lt;code&gt;null&lt;/code&gt; if this dialog
     *     has no title
     * @param modalityType specifies whether dialog blocks input to other
     *    windows when shown. &lt;code&gt;null&lt;/code&gt; value and unsupported modality
     *    types are equivalent to &lt;code&gt;MODELESS&lt;/code&gt;
     * @param gc the &lt;code&gt;GraphicsConfiguration&lt;/code&gt; of the target screen device;
     *     if &lt;code&gt;null&lt;/code&gt;, the default system &lt;code&gt;GraphicsConfiguration&lt;/code&gt;
     *     is assumed
     *
     * @exception java.lang.IllegalArgumentException if the &lt;code&gt;owner&lt;/code&gt;
     *     is not an instance of {@link java.awt.Dialog Dialog} or {@link
     *     java.awt.Frame Frame}
     * @exception java.lang.IllegalArgumentException if &lt;code&gt;gc&lt;/code&gt;
     *     is not from a screen device
     * @exception HeadlessException when
     *     &lt;code&gt;GraphicsEnvironment.isHeadless()&lt;/code&gt; returns &lt;code&gt;true&lt;/code&gt;
     * @exception SecurityException if the calling thread does not have permission
     *     to create modal dialogs with the given &lt;code&gt;modalityType&lt;/code&gt;
     *
     * @see java.awt.Dialog.ModalityType
     * @see java.awt.Dialog#setModal
     * @see java.awt.Dialog#setModalityType
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see java.awt.Toolkit#isModalityTypeSupported
     *
     * @since 1.6
     */
    public Dialog(Window owner, String title, ModalityType modalityType,
                  GraphicsConfiguration gc) {
<span class="nc" id="L717">        super(owner, gc);</span>

<span class="nc bnc" id="L719" title="All 6 branches missed.">        if ((owner != null) &amp;&amp;</span>
            !(owner instanceof Frame) &amp;&amp;
            !(owner instanceof Dialog))
        {
<span class="nc" id="L723">            throw new IllegalArgumentException(&quot;wrong owner window&quot;);</span>
        }

<span class="nc" id="L726">        this.title = title;</span>
<span class="nc" id="L727">        setModalityType(modalityType);</span>
<span class="nc" id="L728">        SunToolkit.checkAndSetPolicy(this);</span>
<span class="nc" id="L729">        initialized = true;</span>
<span class="nc" id="L730">    }</span>

    /**
     * Construct a name for this component.  Called by getName() when the
     * name is null.
     */
    String constructComponentName() {
<span class="nc" id="L737">        synchronized (Dialog.class) {</span>
<span class="nc" id="L738">            return base + nameCounter++;</span>
<span class="nc" id="L739">        }</span>
    }

    /**
     * Makes this Dialog displayable by connecting it to
     * a native screen resource.  Making a dialog displayable will
     * cause any of its children to be made displayable.
     * This method is called internally by the toolkit and should
     * not be called directly by programs.
     * @see Component#isDisplayable
     * @see #removeNotify
     */
    public void addNotify() {
<span class="nc" id="L752">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L753" title="All 4 branches missed.">            if (parent != null &amp;&amp; parent.getPeer() == null) {</span>
<span class="nc" id="L754">                parent.addNotify();</span>
            }

<span class="nc bnc" id="L757" title="All 2 branches missed.">            if (peer == null) {</span>
<span class="nc" id="L758">                peer = getToolkit().createDialog(this);</span>
            }
<span class="nc" id="L760">            super.addNotify();</span>
<span class="nc" id="L761">        }</span>
<span class="nc" id="L762">    }</span>

    /**
     * Indicates whether the dialog is modal.
     * &lt;p&gt;
     * This method is obsolete and is kept for backwards compatibility only.
     * Use {@link #getModalityType getModalityType()} instead.
     *
     * @return    &lt;code&gt;true&lt;/code&gt; if this dialog window is modal;
     *            &lt;code&gt;false&lt;/code&gt; otherwise
     *
     * @see       java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see       java.awt.Dialog.ModalityType#MODELESS
     * @see       java.awt.Dialog#setModal
     * @see       java.awt.Dialog#getModalityType
     * @see       java.awt.Dialog#setModalityType
     */
    public boolean isModal() {
<span class="nc" id="L780">        return isModal_NoClientCode();</span>
    }
    final boolean isModal_NoClientCode() {
<span class="nc bnc" id="L783" title="All 2 branches missed.">        return modalityType != ModalityType.MODELESS;</span>
    }

    /**
     * Specifies whether this dialog should be modal.
     * &lt;p&gt;
     * This method is obsolete and is kept for backwards compatibility only.
     * Use {@link #setModalityType setModalityType()} instead.
     * &lt;p&gt;
     * Note: changing modality of the visible dialog may have no effect
     * until it is hidden and then shown again.
     *
     * @param modal specifies whether dialog blocks input to other windows
     *     when shown; calling to &lt;code&gt;setModal(true)&lt;/code&gt; is equivalent to
     *     &lt;code&gt;setModalityType(Dialog.DEFAULT_MODALITY_TYPE)&lt;/code&gt;, and
     *     calling to &lt;code&gt;setModal(false)&lt;/code&gt; is equvivalent to
     *     &lt;code&gt;setModalityType(Dialog.ModalityType.MODELESS)&lt;/code&gt;
     *
     * @see       java.awt.Dialog#DEFAULT_MODALITY_TYPE
     * @see       java.awt.Dialog.ModalityType#MODELESS
     * @see       java.awt.Dialog#isModal
     * @see       java.awt.Dialog#getModalityType
     * @see       java.awt.Dialog#setModalityType
     *
     * @since     1.1
     */
    public void setModal(boolean modal) {
<span class="nc" id="L810">        this.modal = modal;</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">        setModalityType(modal ? DEFAULT_MODALITY_TYPE : ModalityType.MODELESS);</span>
<span class="nc" id="L812">    }</span>

    /**
     * Returns the modality type of this dialog.
     *
     * @return modality type of this dialog
     *
     * @see java.awt.Dialog#setModalityType
     *
     * @since 1.6
     */
    public ModalityType getModalityType() {
<span class="nc" id="L824">        return modalityType;</span>
    }

    /**
     * Sets the modality type for this dialog. See {@link
     * java.awt.Dialog.ModalityType ModalityType} for possible modality types.
     * &lt;p&gt;
     * If the given modality type is not supported, &lt;code&gt;MODELESS&lt;/code&gt;
     * is used. You may want to call &lt;code&gt;getModalityType()&lt;/code&gt; after calling
     * this method to ensure that the modality type has been set.
     * &lt;p&gt;
     * Note: changing modality of the visible dialog may have no effect
     * until it is hidden and then shown again.
     *
     * @param type specifies whether dialog blocks input to other
     *     windows when shown. &lt;code&gt;null&lt;/code&gt; value and unsupported modality
     *     types are equivalent to &lt;code&gt;MODELESS&lt;/code&gt;
     * @exception SecurityException if the calling thread does not have permission
     *     to create modal dialogs with the given &lt;code&gt;modalityType&lt;/code&gt;
     *
     * @see       java.awt.Dialog#getModalityType
     * @see       java.awt.Toolkit#isModalityTypeSupported
     *
     * @since     1.6
     */
    public void setModalityType(ModalityType type) {
<span class="nc bnc" id="L850" title="All 2 branches missed.">        if (type == null) {</span>
<span class="nc" id="L851">            type = Dialog.ModalityType.MODELESS;</span>
        }
<span class="nc bnc" id="L853" title="All 2 branches missed.">        if (!Toolkit.getDefaultToolkit().isModalityTypeSupported(type)) {</span>
<span class="nc" id="L854">            type = Dialog.ModalityType.MODELESS;</span>
        }
<span class="nc bnc" id="L856" title="All 2 branches missed.">        if (modalityType == type) {</span>
<span class="nc" id="L857">            return;</span>
        }

<span class="nc" id="L860">        checkModalityPermission(type);</span>

<span class="nc" id="L862">        modalityType = type;</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">        modal = (modalityType != ModalityType.MODELESS);</span>
<span class="nc" id="L864">    }</span>

    /**
     * Gets the title of the dialog. The title is displayed in the
     * dialog's border.
     * @return    the title of this dialog window. The title may be
     *            &lt;code&gt;null&lt;/code&gt;.
     * @see       java.awt.Dialog#setTitle
     */
    public String getTitle() {
<span class="nc" id="L874">        return title;</span>
    }

    /**
     * Sets the title of the Dialog.
     * @param title the title displayed in the dialog's border;
         * a null value results in an empty title
     * @see #getTitle
     */
    public void setTitle(String title) {
<span class="nc" id="L884">        String oldTitle = this.title;</span>

<span class="nc" id="L886">        synchronized(this) {</span>
<span class="nc" id="L887">            this.title = title;</span>
<span class="nc" id="L888">            DialogPeer peer = (DialogPeer)this.peer;</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">            if (peer != null) {</span>
<span class="nc" id="L890">                peer.setTitle(title);</span>
            }
<span class="nc" id="L892">        }</span>
<span class="nc" id="L893">        firePropertyChange(&quot;title&quot;, oldTitle, title);</span>
<span class="nc" id="L894">    }</span>

    /**
     * @return true if we actually showed, false if we just called toFront()
     */
    private boolean conditionalShow(Component toFocus, AtomicLong time) {
        boolean retval;

<span class="nc" id="L902">        closeSplashScreen();</span>

<span class="nc" id="L904">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">            if (peer == null) {</span>
<span class="nc" id="L906">                addNotify();</span>
            }
<span class="nc" id="L908">            validateUnconditionally();</span>
<span class="nc bnc" id="L909" title="All 2 branches missed.">            if (visible) {</span>
<span class="nc" id="L910">                toFront();</span>
<span class="nc" id="L911">                retval = false;</span>
            } else {
<span class="nc" id="L913">                visible = retval = true;</span>

                // check if this dialog should be modal blocked BEFORE calling peer.show(),
                // otherwise, a pair of FOCUS_GAINED and FOCUS_LOST may be mistakenly
                // generated for the dialog
<span class="nc bnc" id="L918" title="All 2 branches missed.">                if (!isModal()) {</span>
<span class="nc" id="L919">                    checkShouldBeBlocked(this);</span>
                } else {
<span class="nc" id="L921">                    modalDialogs.add(this);</span>
<span class="nc" id="L922">                    modalShow();</span>
                }

<span class="nc bnc" id="L925" title="All 6 branches missed.">                if (toFocus != null &amp;&amp; time != null &amp;&amp; isFocusable() &amp;&amp;</span>
<span class="nc bnc" id="L926" title="All 4 branches missed.">                    isEnabled() &amp;&amp; !isModalBlocked()) {</span>
                    // keep the KeyEvents from being dispatched
                    // until the focus has been transfered
<span class="nc" id="L929">                    time.set(Toolkit.getEventQueue().getMostRecentKeyEventTime());</span>
<span class="nc" id="L930">                    KeyboardFocusManager.getCurrentKeyboardFocusManager().</span>
<span class="nc" id="L931">                        enqueueKeyEvents(time.get(), toFocus);</span>
                }

                // This call is required as the show() method of the Dialog class
                // does not invoke the super.show(). So wried... :(
<span class="nc" id="L936">                mixOnShowing();</span>

<span class="nc" id="L938">                peer.setVisible(true); // now guaranteed never to block</span>
<span class="nc bnc" id="L939" title="All 2 branches missed.">                if (isModalBlocked()) {</span>
<span class="nc" id="L940">                    modalBlocker.toFront();</span>
                }

<span class="nc" id="L943">                setLocationByPlatform(false);</span>
<span class="nc bnc" id="L944" title="All 2 branches missed.">                for (int i = 0; i &lt; ownedWindowList.size(); i++) {</span>
<span class="nc" id="L945">                    Window child = ownedWindowList.elementAt(i).get();</span>
<span class="nc bnc" id="L946" title="All 4 branches missed.">                    if ((child != null) &amp;&amp; child.showWithParent) {</span>
<span class="nc" id="L947">                        child.show();</span>
<span class="nc" id="L948">                        child.showWithParent = false;</span>
                    }       // endif
                }   // endfor
<span class="nc" id="L951">                Window.updateChildFocusableWindowState(this);</span>

<span class="nc" id="L953">                createHierarchyEvents(HierarchyEvent.HIERARCHY_CHANGED,</span>
                                      this, parent,
                                      HierarchyEvent.SHOWING_CHANGED,
<span class="nc" id="L956">                                      Toolkit.enabledOnToolkit(AWTEvent.HIERARCHY_EVENT_MASK));</span>
<span class="nc bnc" id="L957" title="All 4 branches missed.">                if (componentListener != null ||</span>
                        (eventMask &amp; AWTEvent.COMPONENT_EVENT_MASK) != 0 ||
<span class="nc bnc" id="L959" title="All 2 branches missed.">                        Toolkit.enabledOnToolkit(AWTEvent.COMPONENT_EVENT_MASK)) {</span>
<span class="nc" id="L960">                    ComponentEvent e =</span>
                        new ComponentEvent(this, ComponentEvent.COMPONENT_SHOWN);
<span class="nc" id="L962">                    Toolkit.getEventQueue().postEvent(e);</span>
                }
            }
<span class="nc" id="L965">        }</span>

<span class="nc bnc" id="L967" title="All 4 branches missed.">        if (retval &amp;&amp; (state &amp; OPENED) == 0) {</span>
<span class="nc" id="L968">            postWindowEvent(WindowEvent.WINDOW_OPENED);</span>
<span class="nc" id="L969">            state |= OPENED;</span>
        }

<span class="nc" id="L972">        return retval;</span>
    }

    /**
     * Shows or hides this {@code Dialog} depending on the value of parameter
     * {@code b}.
     * @param b if {@code true}, makes the {@code Dialog} visible,
     * otherwise hides the {@code Dialog}.
     * If the dialog and/or its owner
     * are not yet displayable, both are made displayable.  The
     * dialog will be validated prior to being made visible.
     * If {@code false}, hides the {@code Dialog} and then causes {@code setVisible(true)}
     * to return if it is currently blocked.
     * &lt;p&gt;
     * &lt;b&gt;Notes for modal dialogs&lt;/b&gt;.
     * &lt;ul&gt;
     * &lt;li&gt;{@code setVisible(true)}:  If the dialog is not already
     * visible, this call will not return until the dialog is
     * hidden by calling {@code setVisible(false)} or
     * {@code dispose}.
     * &lt;li&gt;{@code setVisible(false)}:  Hides the dialog and then
     * returns on {@code setVisible(true)} if it is currently blocked.
     * &lt;li&gt;It is OK to call this method from the event dispatching
     * thread because the toolkit ensures that other events are
     * not blocked while this method is blocked.
     * &lt;/ul&gt;
     * @see java.awt.Window#setVisible
     * @see java.awt.Window#dispose
     * @see java.awt.Component#isDisplayable
     * @see java.awt.Component#validate
     * @see java.awt.Dialog#isModal
     */
    public void setVisible(boolean b) {
<span class="nc" id="L1005">        super.setVisible(b);</span>
<span class="nc" id="L1006">    }</span>

   /**
     * Makes the {@code Dialog} visible. If the dialog and/or its owner
     * are not yet displayable, both are made displayable.  The
     * dialog will be validated prior to being made visible.
     * If the dialog is already visible, this will bring the dialog
     * to the front.
     * &lt;p&gt;
     * If the dialog is modal and is not already visible, this call
     * will not return until the dialog is hidden by calling hide or
     * dispose. It is permissible to show modal dialogs from the event
     * dispatching thread because the toolkit will ensure that another
     * event pump runs while the one which invoked this method is blocked.
     * @see Component#hide
     * @see Component#isDisplayable
     * @see Component#validate
     * @see #isModal
     * @see Window#setVisible(boolean)
     * @deprecated As of JDK version 1.5, replaced by
     * {@link #setVisible(boolean) setVisible(boolean)}.
     */
    @Deprecated
    public void show() {
<span class="nc bnc" id="L1030" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L1031">            throw new IllegalStateException(&quot;The dialog component &quot; +</span>
                &quot;has not been initialized properly&quot;);
        }

<span class="nc" id="L1035">        beforeFirstShow = false;</span>
<span class="nc bnc" id="L1036" title="All 2 branches missed.">        if (!isModal()) {</span>
<span class="nc" id="L1037">            conditionalShow(null, null);</span>
        } else {
<span class="nc" id="L1039">            AppContext showAppContext = AppContext.getAppContext();</span>

<span class="nc" id="L1041">            AtomicLong time = new AtomicLong();</span>
<span class="nc" id="L1042">            Component predictedFocusOwner = null;</span>
            try {
<span class="nc" id="L1044">                predictedFocusOwner = getMostRecentFocusOwner();</span>
<span class="nc bnc" id="L1045" title="All 2 branches missed.">                if (conditionalShow(predictedFocusOwner, time)) {</span>
<span class="nc" id="L1046">                    modalFilter = ModalEventFilter.createFilterForDialog(this);</span>
<span class="nc" id="L1047">                    final Conditional cond = new Conditional() {</span>
                        @Override
                        public boolean evaluate() {
<span class="nc bnc" id="L1050" title="All 2 branches missed.">                            return windowClosingException == null;</span>
                        }
                    };

                    // if this dialog is toolkit-modal, the filter should be added
                    // to all EDTs (for all AppContexts)
<span class="nc bnc" id="L1056" title="All 2 branches missed.">                    if (modalityType == ModalityType.TOOLKIT_MODAL) {</span>
<span class="nc" id="L1057">                        Iterator&lt;AppContext&gt; it = AppContext.getAppContexts().iterator();</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">                        while (it.hasNext()) {</span>
<span class="nc" id="L1059">                            AppContext appContext = it.next();</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">                            if (appContext == showAppContext) {</span>
<span class="nc" id="L1061">                                continue;</span>
                            }
<span class="nc" id="L1063">                            EventQueue eventQueue = (EventQueue)appContext.get(AppContext.EVENT_QUEUE_KEY);</span>
                            // it may occur that EDT for appContext hasn't been started yet, so
                            // we post an empty invocation event to trigger EDT initialization
<span class="nc" id="L1066">                            Runnable createEDT = new Runnable() {</span>
<span class="nc" id="L1067">                                public void run() {};</span>
                            };
<span class="nc" id="L1069">                            eventQueue.postEvent(new InvocationEvent(this, createEDT));</span>
<span class="nc" id="L1070">                            EventDispatchThread edt = eventQueue.getDispatchThread();</span>
<span class="nc" id="L1071">                            edt.addEventFilter(modalFilter);</span>
<span class="nc" id="L1072">                        }</span>
                    }

<span class="nc" id="L1075">                    modalityPushed();</span>
                    try {
<span class="nc" id="L1077">                        final EventQueue eventQueue = AccessController.doPrivileged(</span>
<span class="nc" id="L1078">                            new PrivilegedAction&lt;EventQueue&gt;() {</span>
                                public EventQueue run() {
<span class="nc" id="L1080">                                    return Toolkit.getDefaultToolkit().getSystemEventQueue();</span>
                                }
                        });
<span class="nc" id="L1083">                        secondaryLoop = eventQueue.createSecondaryLoop(cond, modalFilter, 0);</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">                        if (!secondaryLoop.enter()) {</span>
<span class="nc" id="L1085">                            secondaryLoop = null;</span>
                        }
                    } finally {
<span class="nc" id="L1088">                        modalityPopped();</span>
<span class="nc" id="L1089">                    }</span>

                    // if this dialog is toolkit-modal, its filter must be removed
                    // from all EDTs (for all AppContexts)
<span class="nc bnc" id="L1093" title="All 2 branches missed.">                    if (modalityType == ModalityType.TOOLKIT_MODAL) {</span>
<span class="nc" id="L1094">                        Iterator&lt;AppContext&gt; it = AppContext.getAppContexts().iterator();</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">                        while (it.hasNext()) {</span>
<span class="nc" id="L1096">                            AppContext appContext = it.next();</span>
<span class="nc bnc" id="L1097" title="All 2 branches missed.">                            if (appContext == showAppContext) {</span>
<span class="nc" id="L1098">                                continue;</span>
                            }
<span class="nc" id="L1100">                            EventQueue eventQueue = (EventQueue)appContext.get(AppContext.EVENT_QUEUE_KEY);</span>
<span class="nc" id="L1101">                            EventDispatchThread edt = eventQueue.getDispatchThread();</span>
<span class="nc" id="L1102">                            edt.removeEventFilter(modalFilter);</span>
<span class="nc" id="L1103">                        }</span>
                    }

<span class="nc bnc" id="L1106" title="All 2 branches missed.">                    if (windowClosingException != null) {</span>
<span class="nc" id="L1107">                        windowClosingException.fillInStackTrace();</span>
<span class="nc" id="L1108">                        throw windowClosingException;</span>
                    }
                }
            } finally {
<span class="nc bnc" id="L1112" title="All 4 branches missed.">                if (predictedFocusOwner != null) {</span>
                    // Restore normal key event dispatching
<span class="nc" id="L1114">                    KeyboardFocusManager.getCurrentKeyboardFocusManager().</span>
<span class="nc" id="L1115">                        dequeueKeyEvents(time.get(), predictedFocusOwner);</span>
                }
            }
        }
<span class="nc" id="L1119">    }</span>

    final void modalityPushed() {
<span class="nc" id="L1122">        Toolkit tk = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L1123" title="All 2 branches missed.">        if (tk instanceof SunToolkit) {</span>
<span class="nc" id="L1124">            SunToolkit stk = (SunToolkit)tk;</span>
<span class="nc" id="L1125">            stk.notifyModalityPushed(this);</span>
        }
<span class="nc" id="L1127">    }</span>

    final void modalityPopped() {
<span class="nc" id="L1130">        Toolkit tk = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L1131" title="All 2 branches missed.">        if (tk instanceof SunToolkit) {</span>
<span class="nc" id="L1132">            SunToolkit stk = (SunToolkit)tk;</span>
<span class="nc" id="L1133">            stk.notifyModalityPopped(this);</span>
        }
<span class="nc" id="L1135">    }</span>

    void interruptBlocking() {
<span class="nc bnc" id="L1138" title="All 2 branches missed.">        if (isModal()) {</span>
<span class="nc" id="L1139">            disposeImpl();</span>
<span class="nc bnc" id="L1140" title="All 2 branches missed.">        } else if (windowClosingException != null) {</span>
<span class="nc" id="L1141">            windowClosingException.fillInStackTrace();</span>
<span class="nc" id="L1142">            windowClosingException.printStackTrace();</span>
<span class="nc" id="L1143">            windowClosingException = null;</span>
        }
<span class="nc" id="L1145">    }</span>

    private void hideAndDisposePreHandler() {
<span class="nc" id="L1148">        isInHide = true;</span>
<span class="nc" id="L1149">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L1150" title="All 2 branches missed.">            if (secondaryLoop != null) {</span>
<span class="nc" id="L1151">                modalHide();</span>
                // dialog can be shown and then disposed before its
                // modal filter is created
<span class="nc bnc" id="L1154" title="All 2 branches missed.">                if (modalFilter != null) {</span>
<span class="nc" id="L1155">                    modalFilter.disable();</span>
                }
<span class="nc" id="L1157">                modalDialogs.remove(this);</span>
            }
<span class="nc" id="L1159">        }</span>
<span class="nc" id="L1160">    }</span>
    private void hideAndDisposeHandler() {
<span class="nc bnc" id="L1162" title="All 2 branches missed.">        if (secondaryLoop != null) {</span>
<span class="nc" id="L1163">            secondaryLoop.exit();</span>
<span class="nc" id="L1164">            secondaryLoop = null;</span>
        }
<span class="nc" id="L1166">        isInHide = false;</span>
<span class="nc" id="L1167">    }</span>

    /**
     * Hides the Dialog and then causes {@code show} to return if it is currently
     * blocked.
     * @see Window#show
     * @see Window#dispose
     * @see Window#setVisible(boolean)
     * @deprecated As of JDK version 1.5, replaced by
     * {@link #setVisible(boolean) setVisible(boolean)}.
     */
    @Deprecated
    public void hide() {
<span class="nc" id="L1180">        hideAndDisposePreHandler();</span>
<span class="nc" id="L1181">        super.hide();</span>
        // fix for 5048370: if hide() is called from super.doDispose(), then
        // hideAndDisposeHandler() should not be called here as it will be called
        // at the end of doDispose()
<span class="nc bnc" id="L1185" title="All 2 branches missed.">        if (!isInDispose) {</span>
<span class="nc" id="L1186">            hideAndDisposeHandler();</span>
        }
<span class="nc" id="L1188">    }</span>

    /**
     * Disposes the Dialog and then causes show() to return if it is currently
     * blocked.
     */
    void doDispose() {
        // fix for 5048370: set isInDispose flag to true to prevent calling
        // to hideAndDisposeHandler() from hide()
<span class="nc" id="L1197">        isInDispose = true;</span>
<span class="nc" id="L1198">        super.doDispose();</span>
<span class="nc" id="L1199">        hideAndDisposeHandler();</span>
<span class="nc" id="L1200">        isInDispose = false;</span>
<span class="nc" id="L1201">    }</span>

    /**
     * {@inheritDoc}
     * &lt;p&gt;
     * If this dialog is modal and blocks some windows, then all of them are
     * also sent to the back to keep them below the blocking dialog.
     *
     * @see java.awt.Window#toBack
     */
    public void toBack() {
<span class="nc" id="L1212">        super.toBack();</span>
<span class="nc bnc" id="L1213" title="All 2 branches missed.">        if (visible) {</span>
<span class="nc" id="L1214">            synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">                for (Window w : blockedWindows) {</span>
<span class="nc" id="L1216">                    w.toBack_NoClientCode();</span>
<span class="nc" id="L1217">                }</span>
<span class="nc" id="L1218">            }</span>
        }
<span class="nc" id="L1220">    }</span>

    /**
     * Indicates whether this dialog is resizable by the user.
     * By default, all dialogs are initially resizable.
     * @return    &lt;code&gt;true&lt;/code&gt; if the user can resize the dialog;
     *            &lt;code&gt;false&lt;/code&gt; otherwise.
     * @see       java.awt.Dialog#setResizable
     */
    public boolean isResizable() {
<span class="nc" id="L1230">        return resizable;</span>
    }

    /**
     * Sets whether this dialog is resizable by the user.
     * @param     resizable &lt;code&gt;true&lt;/code&gt; if the user can
     *                 resize this dialog; &lt;code&gt;false&lt;/code&gt; otherwise.
     * @see       java.awt.Dialog#isResizable
     */
    public void setResizable(boolean resizable) {
<span class="nc" id="L1240">        boolean testvalid = false;</span>

<span class="nc" id="L1242">        synchronized (this) {</span>
<span class="nc" id="L1243">            this.resizable = resizable;</span>
<span class="nc" id="L1244">            DialogPeer peer = (DialogPeer)this.peer;</span>
<span class="nc bnc" id="L1245" title="All 2 branches missed.">            if (peer != null) {</span>
<span class="nc" id="L1246">                peer.setResizable(resizable);</span>
<span class="nc" id="L1247">                testvalid = true;</span>
            }
<span class="nc" id="L1249">        }</span>

        // On some platforms, changing the resizable state affects
        // the insets of the Dialog. If we could, we'd call invalidate()
        // from the peer, but we need to guarantee that we're not holding
        // the Dialog lock when we call invalidate().
<span class="nc bnc" id="L1255" title="All 2 branches missed.">        if (testvalid) {</span>
<span class="nc" id="L1256">            invalidateIfValid();</span>
        }
<span class="nc" id="L1258">    }</span>


    /**
     * Disables or enables decorations for this dialog.
     * &lt;p&gt;
     * This method can only be called while the dialog is not displayable. To
     * make this dialog decorated, it must be opaque and have the default shape,
     * otherwise the {@code IllegalComponentStateException} will be thrown.
     * Refer to {@link Window#setShape}, {@link Window#setOpacity} and {@link
     * Window#setBackground} for details
     *
     * @param  undecorated {@code true} if no dialog decorations are to be
     *         enabled; {@code false} if dialog decorations are to be enabled
     *
     * @throws IllegalComponentStateException if the dialog is displayable
     * @throws IllegalComponentStateException if {@code undecorated} is
     *      {@code false}, and this dialog does not have the default shape
     * @throws IllegalComponentStateException if {@code undecorated} is
     *      {@code false}, and this dialog opacity is less than {@code 1.0f}
     * @throws IllegalComponentStateException if {@code undecorated} is
     *      {@code false}, and the alpha value of this dialog background
     *      color is less than {@code 1.0f}
     *
     * @see    #isUndecorated
     * @see    Component#isDisplayable
     * @see    Window#getShape
     * @see    Window#getOpacity
     * @see    Window#getBackground
     *
     * @since 1.4
     */
    public void setUndecorated(boolean undecorated) {
        /* Make sure we don't run in the middle of peer creation.*/
<span class="nc" id="L1292">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L1293" title="All 2 branches missed.">            if (isDisplayable()) {</span>
<span class="nc" id="L1294">                throw new IllegalComponentStateException(&quot;The dialog is displayable.&quot;);</span>
            }
<span class="nc bnc" id="L1296" title="All 2 branches missed.">            if (!undecorated) {</span>
<span class="nc bnc" id="L1297" title="All 2 branches missed.">                if (getOpacity() &lt; 1.0f) {</span>
<span class="nc" id="L1298">                    throw new IllegalComponentStateException(&quot;The dialog is not opaque&quot;);</span>
                }
<span class="nc bnc" id="L1300" title="All 2 branches missed.">                if (getShape() != null) {</span>
<span class="nc" id="L1301">                    throw new IllegalComponentStateException(&quot;The dialog does not have a default shape&quot;);</span>
                }
<span class="nc" id="L1303">                Color bg = getBackground();</span>
<span class="nc bnc" id="L1304" title="All 4 branches missed.">                if ((bg != null) &amp;&amp; (bg.getAlpha() &lt; 255)) {</span>
<span class="nc" id="L1305">                    throw new IllegalComponentStateException(&quot;The dialog background color is not opaque&quot;);</span>
                }
            }
<span class="nc" id="L1308">            this.undecorated = undecorated;</span>
<span class="nc" id="L1309">        }</span>
<span class="nc" id="L1310">    }</span>

    /**
     * Indicates whether this dialog is undecorated.
     * By default, all dialogs are initially decorated.
     * @return    &lt;code&gt;true&lt;/code&gt; if dialog is undecorated;
     *                        &lt;code&gt;false&lt;/code&gt; otherwise.
     * @see       java.awt.Dialog#setUndecorated
     * @since 1.4
     */
    public boolean isUndecorated() {
<span class="nc" id="L1321">        return undecorated;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public void setOpacity(float opacity) {
<span class="nc" id="L1329">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L1330" title="All 4 branches missed.">            if ((opacity &lt; 1.0f) &amp;&amp; !isUndecorated()) {</span>
<span class="nc" id="L1331">                throw new IllegalComponentStateException(&quot;The dialog is decorated&quot;);</span>
            }
<span class="nc" id="L1333">            super.setOpacity(opacity);</span>
<span class="nc" id="L1334">        }</span>
<span class="nc" id="L1335">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void setShape(Shape shape) {
<span class="nc" id="L1342">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L1343" title="All 4 branches missed.">            if ((shape != null) &amp;&amp; !isUndecorated()) {</span>
<span class="nc" id="L1344">                throw new IllegalComponentStateException(&quot;The dialog is decorated&quot;);</span>
            }
<span class="nc" id="L1346">            super.setShape(shape);</span>
<span class="nc" id="L1347">        }</span>
<span class="nc" id="L1348">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void setBackground(Color bgColor) {
<span class="nc" id="L1355">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L1356" title="All 6 branches missed.">            if ((bgColor != null) &amp;&amp; (bgColor.getAlpha() &lt; 255) &amp;&amp; !isUndecorated()) {</span>
<span class="nc" id="L1357">                throw new IllegalComponentStateException(&quot;The dialog is decorated&quot;);</span>
            }
<span class="nc" id="L1359">            super.setBackground(bgColor);</span>
<span class="nc" id="L1360">        }</span>
<span class="nc" id="L1361">    }</span>

    /**
     * Returns a string representing the state of this dialog. This
     * method is intended to be used only for debugging purposes, and the
     * content and format of the returned string may vary between
     * implementations. The returned string may be empty but may not be
     * &lt;code&gt;null&lt;/code&gt;.
     *
     * @return    the parameter string of this dialog window.
     */
    protected String paramString() {
<span class="nc" id="L1373">        String str = super.paramString() + &quot;,&quot; + modalityType;</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">        if (title != null) {</span>
<span class="nc" id="L1375">            str += &quot;,title=&quot; + title;</span>
        }
<span class="nc" id="L1377">        return str;</span>
    }

    /**
     * Initialize JNI field and method IDs
     */
    private static native void initIDs();

    /*
     * --- Modality support ---
     *
     */

    /*
     * This method is called only for modal dialogs.
     *
     * Goes through the list of all visible top-level windows and
     * divide them into three distinct groups: blockers of this dialog,
     * blocked by this dialog and all others. Then blocks this dialog
     * by first met dialog from the first group (if any) and blocks all
     * the windows from the second group.
     */
    void modalShow() {
        // find all the dialogs that block this one
<span class="nc" id="L1401">        IdentityArrayList&lt;Dialog&gt; blockers = new IdentityArrayList&lt;Dialog&gt;();</span>
<span class="nc bnc" id="L1402" title="All 2 branches missed.">        for (Dialog d : modalDialogs) {</span>
<span class="nc bnc" id="L1403" title="All 2 branches missed.">            if (d.shouldBlock(this)) {</span>
<span class="nc" id="L1404">                Window w = d;</span>
<span class="nc bnc" id="L1405" title="All 4 branches missed.">                while ((w != null) &amp;&amp; (w != this)) {</span>
<span class="nc" id="L1406">                    w = w.getOwner_NoClientCode();</span>
                }
<span class="nc bnc" id="L1408" title="All 6 branches missed.">                if ((w == this) || !shouldBlock(d) || (modalityType.compareTo(d.getModalityType()) &lt; 0)) {</span>
<span class="nc" id="L1409">                    blockers.add(d);</span>
                }
            }
<span class="nc" id="L1412">        }</span>

        // add all blockers' blockers to blockers :)
<span class="nc bnc" id="L1415" title="All 2 branches missed.">        for (int i = 0; i &lt; blockers.size(); i++) {</span>
<span class="nc" id="L1416">            Dialog blocker = blockers.get(i);</span>
<span class="nc bnc" id="L1417" title="All 2 branches missed.">            if (blocker.isModalBlocked()) {</span>
<span class="nc" id="L1418">                Dialog blockerBlocker = blocker.getModalBlocker();</span>
<span class="nc bnc" id="L1419" title="All 2 branches missed.">                if (!blockers.contains(blockerBlocker)) {</span>
<span class="nc" id="L1420">                    blockers.add(i + 1, blockerBlocker);</span>
                }
            }
        }

<span class="nc bnc" id="L1425" title="All 2 branches missed.">        if (blockers.size() &gt; 0) {</span>
<span class="nc" id="L1426">            blockers.get(0).blockWindow(this);</span>
        }

        // find all windows from blockers' hierarchies
<span class="nc" id="L1430">        IdentityArrayList&lt;Window&gt; blockersHierarchies = new IdentityArrayList&lt;Window&gt;(blockers);</span>
<span class="nc" id="L1431">        int k = 0;</span>
<span class="nc bnc" id="L1432" title="All 2 branches missed.">        while (k &lt; blockersHierarchies.size()) {</span>
<span class="nc" id="L1433">            Window w = blockersHierarchies.get(k);</span>
<span class="nc" id="L1434">            Window[] ownedWindows = w.getOwnedWindows_NoClientCode();</span>
<span class="nc bnc" id="L1435" title="All 2 branches missed.">            for (Window win : ownedWindows) {</span>
<span class="nc" id="L1436">                blockersHierarchies.add(win);</span>
            }
<span class="nc" id="L1438">            k++;</span>
<span class="nc" id="L1439">        }</span>

<span class="nc" id="L1441">        java.util.List&lt;Window&gt; toBlock = new IdentityLinkedList&lt;Window&gt;();</span>
        // block all windows from scope of blocking except from blockers' hierarchies
<span class="nc" id="L1443">        IdentityArrayList&lt;Window&gt; unblockedWindows = Window.getAllUnblockedWindows();</span>
<span class="nc bnc" id="L1444" title="All 2 branches missed.">        for (Window w : unblockedWindows) {</span>
<span class="nc bnc" id="L1445" title="All 4 branches missed.">            if (shouldBlock(w) &amp;&amp; !blockersHierarchies.contains(w)) {</span>
<span class="nc bnc" id="L1446" title="All 4 branches missed.">                if ((w instanceof Dialog) &amp;&amp; ((Dialog)w).isModal_NoClientCode()) {</span>
<span class="nc" id="L1447">                    Dialog wd = (Dialog)w;</span>
<span class="nc bnc" id="L1448" title="All 4 branches missed.">                    if (wd.shouldBlock(this) &amp;&amp; (modalDialogs.indexOf(wd) &gt; modalDialogs.indexOf(this))) {</span>
<span class="nc" id="L1449">                        continue;</span>
                    }
                }
<span class="nc" id="L1452">                toBlock.add(w);</span>
            }
<span class="nc" id="L1454">        }</span>
<span class="nc" id="L1455">        blockWindows(toBlock);</span>

<span class="nc bnc" id="L1457" title="All 2 branches missed.">        if (!isModalBlocked()) {</span>
<span class="nc" id="L1458">            updateChildrenBlocking();</span>
        }
<span class="nc" id="L1460">    }</span>

    /*
     * This method is called only for modal dialogs.
     *
     * Unblocks all the windows blocked by this modal dialog. After
     * each of them has been unblocked, it is checked to be blocked by
     * any other modal dialogs.
     */
    void modalHide() {
        // we should unblock all the windows first...
<span class="nc" id="L1471">        IdentityArrayList&lt;Window&gt; save = new IdentityArrayList&lt;Window&gt;();</span>
<span class="nc" id="L1472">        int blockedWindowsCount = blockedWindows.size();</span>
<span class="nc bnc" id="L1473" title="All 2 branches missed.">        for (int i = 0; i &lt; blockedWindowsCount; i++) {</span>
<span class="nc" id="L1474">            Window w = blockedWindows.get(0);</span>
<span class="nc" id="L1475">            save.add(w);</span>
<span class="nc" id="L1476">            unblockWindow(w); // also removes w from blockedWindows</span>
        }
        // ... and only after that check if they should be blocked
        // by another dialogs
<span class="nc bnc" id="L1480" title="All 2 branches missed.">        for (int i = 0; i &lt; blockedWindowsCount; i++) {</span>
<span class="nc" id="L1481">            Window w = save.get(i);</span>
<span class="nc bnc" id="L1482" title="All 4 branches missed.">            if ((w instanceof Dialog) &amp;&amp; ((Dialog)w).isModal_NoClientCode()) {</span>
<span class="nc" id="L1483">                Dialog d = (Dialog)w;</span>
<span class="nc" id="L1484">                d.modalShow();</span>
<span class="nc" id="L1485">            } else {</span>
<span class="nc" id="L1486">                checkShouldBeBlocked(w);</span>
            }
        }
<span class="nc" id="L1489">    }</span>

    /*
     * Returns whether the given top-level window should be blocked by
     * this dialog. Note, that the given window can be also a modal dialog
     * and it should block this dialog, but this method do not take such
     * situations into consideration (such checks are performed in the
     * modalShow() and modalHide() methods).
     *
     * This method should be called on the getTreeLock() lock.
     */
    boolean shouldBlock(Window w) {
<span class="nc bnc" id="L1501" title="All 2 branches missed.">        if (!isVisible_NoClientCode() ||</span>
<span class="nc bnc" id="L1502" title="All 8 branches missed.">            (!w.isVisible_NoClientCode() &amp;&amp; !w.isInShow) ||</span>
            isInHide ||
            (w == this) ||
<span class="nc bnc" id="L1505" title="All 2 branches missed.">            !isModal_NoClientCode())</span>
        {
<span class="nc" id="L1507">            return false;</span>
        }
<span class="nc bnc" id="L1509" title="All 4 branches missed.">        if ((w instanceof Dialog) &amp;&amp; ((Dialog)w).isInHide) {</span>
<span class="nc" id="L1510">            return false;</span>
        }
        // check if w is from children hierarchy
        // fix for 6271546: we should also take into consideration child hierarchies
        // of this dialog's blockers
<span class="nc" id="L1515">        Window blockerToCheck = this;</span>
<span class="nc bnc" id="L1516" title="All 2 branches missed.">        while (blockerToCheck != null) {</span>
<span class="nc" id="L1517">            Component c = w;</span>
<span class="nc bnc" id="L1518" title="All 4 branches missed.">            while ((c != null) &amp;&amp; (c != blockerToCheck)) {</span>
<span class="nc" id="L1519">                c = c.getParent_NoClientCode();</span>
            }
<span class="nc bnc" id="L1521" title="All 2 branches missed.">            if (c == blockerToCheck) {</span>
<span class="nc" id="L1522">                return false;</span>
            }
<span class="nc" id="L1524">            blockerToCheck = blockerToCheck.getModalBlocker();</span>
<span class="nc" id="L1525">        }</span>
<span class="nc bnc" id="L1526" title="All 5 branches missed.">        switch (modalityType) {</span>
            case MODELESS:
<span class="nc" id="L1528">                return false;</span>
            case DOCUMENT_MODAL:
<span class="nc bnc" id="L1530" title="All 2 branches missed.">                if (w.isModalExcluded(ModalExclusionType.APPLICATION_EXCLUDE)) {</span>
                    // application- and toolkit-excluded windows are not blocked by
                    // document-modal dialogs from outside their children hierarchy
<span class="nc" id="L1533">                    Component c = this;</span>
<span class="nc bnc" id="L1534" title="All 4 branches missed.">                    while ((c != null) &amp;&amp; (c != w)) {</span>
<span class="nc" id="L1535">                        c = c.getParent_NoClientCode();</span>
                    }
<span class="nc bnc" id="L1537" title="All 2 branches missed.">                    return c == w;</span>
                } else {
<span class="nc bnc" id="L1539" title="All 2 branches missed.">                    return getDocumentRoot() == w.getDocumentRoot();</span>
                }
            case APPLICATION_MODAL:
<span class="nc bnc" id="L1542" title="All 4 branches missed.">                return !w.isModalExcluded(ModalExclusionType.APPLICATION_EXCLUDE) &amp;&amp;</span>
                    (appContext == w.appContext);
            case TOOLKIT_MODAL:
<span class="nc bnc" id="L1545" title="All 2 branches missed.">                return !w.isModalExcluded(ModalExclusionType.TOOLKIT_EXCLUDE);</span>
        }

<span class="nc" id="L1548">        return false;</span>
    }

    /*
     * Adds the given top-level window to the list of blocked
     * windows for this dialog and marks it as modal blocked.
     * If the window is already blocked by some modal dialog,
     * does nothing.
     */
    void blockWindow(Window w) {
<span class="nc bnc" id="L1558" title="All 2 branches missed.">        if (!w.isModalBlocked()) {</span>
<span class="nc" id="L1559">            w.setModalBlocked(this, true, true);</span>
<span class="nc" id="L1560">            blockedWindows.add(w);</span>
        }
<span class="nc" id="L1562">    }</span>

    void blockWindows(java.util.List&lt;Window&gt; toBlock) {
<span class="nc" id="L1565">        DialogPeer dpeer = (DialogPeer)peer;</span>
<span class="nc bnc" id="L1566" title="All 2 branches missed.">        if (dpeer == null) {</span>
<span class="nc" id="L1567">            return;</span>
        }
<span class="nc" id="L1569">        Iterator&lt;Window&gt; it = toBlock.iterator();</span>
<span class="nc bnc" id="L1570" title="All 2 branches missed.">        while (it.hasNext()) {</span>
<span class="nc" id="L1571">            Window w = it.next();</span>
<span class="nc bnc" id="L1572" title="All 2 branches missed.">            if (!w.isModalBlocked()) {</span>
<span class="nc" id="L1573">                w.setModalBlocked(this, true, false);</span>
            } else {
<span class="nc" id="L1575">                it.remove();</span>
            }
<span class="nc" id="L1577">        }</span>
<span class="nc" id="L1578">        dpeer.blockWindows(toBlock);</span>
<span class="nc" id="L1579">        blockedWindows.addAll(toBlock);</span>
<span class="nc" id="L1580">    }</span>

    /*
     * Removes the given top-level window from the list of blocked
     * windows for this dialog and marks it as unblocked. If the
     * window is not modal blocked, does nothing.
     */
    void unblockWindow(Window w) {
<span class="nc bnc" id="L1588" title="All 4 branches missed.">        if (w.isModalBlocked() &amp;&amp; blockedWindows.contains(w)) {</span>
<span class="nc" id="L1589">            blockedWindows.remove(w);</span>
<span class="nc" id="L1590">            w.setModalBlocked(this, false, true);</span>
        }
<span class="nc" id="L1592">    }</span>

    /*
     * Checks if any other modal dialog D blocks the given window.
     * If such D exists, mark the window as blocked by D.
     */
    static void checkShouldBeBlocked(Window w) {
<span class="nc" id="L1599">        synchronized (w.getTreeLock()) {</span>
<span class="nc bnc" id="L1600" title="All 2 branches missed.">            for (int i = 0; i &lt; modalDialogs.size(); i++) {</span>
<span class="nc" id="L1601">                Dialog modalDialog = modalDialogs.get(i);</span>
<span class="nc bnc" id="L1602" title="All 2 branches missed.">                if (modalDialog.shouldBlock(w)) {</span>
<span class="nc" id="L1603">                    modalDialog.blockWindow(w);</span>
<span class="nc" id="L1604">                    break;</span>
                }
            }
<span class="nc" id="L1607">        }</span>
<span class="nc" id="L1608">    }</span>

    private void checkModalityPermission(ModalityType mt) {
<span class="nc bnc" id="L1611" title="All 2 branches missed.">        if (mt == ModalityType.TOOLKIT_MODAL) {</span>
<span class="nc" id="L1612">            SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L1613" title="All 2 branches missed.">            if (sm != null) {</span>
<span class="nc" id="L1614">                sm.checkPermission(</span>
                    SecurityConstants.AWT.TOOLKIT_MODALITY_PERMISSION
                );
            }
        }
<span class="nc" id="L1619">    }</span>

    private void readObject(ObjectInputStream s)
        throws ClassNotFoundException, IOException, HeadlessException
    {
<span class="nc" id="L1624">        GraphicsEnvironment.checkHeadless();</span>

<span class="nc" id="L1626">        java.io.ObjectInputStream.GetField fields =</span>
<span class="nc" id="L1627">            s.readFields();</span>

<span class="nc" id="L1629">        ModalityType localModalityType = (ModalityType)fields.get(&quot;modalityType&quot;, null);</span>

        try {
<span class="nc" id="L1632">            checkModalityPermission(localModalityType);</span>
<span class="nc" id="L1633">        } catch (AccessControlException ace) {</span>
<span class="nc" id="L1634">            localModalityType = DEFAULT_MODALITY_TYPE;</span>
<span class="nc" id="L1635">        }</span>

        // in 1.5 or earlier modalityType was absent, so use &quot;modal&quot; instead
<span class="nc bnc" id="L1638" title="All 2 branches missed.">        if (localModalityType == null) {</span>
<span class="nc" id="L1639">            this.modal = fields.get(&quot;modal&quot;, false);</span>
<span class="nc" id="L1640">            setModal(modal);</span>
        } else {
<span class="nc" id="L1642">            this.modalityType = localModalityType;</span>
        }

<span class="nc" id="L1645">        this.resizable = fields.get(&quot;resizable&quot;, true);</span>
<span class="nc" id="L1646">        this.undecorated = fields.get(&quot;undecorated&quot;, false);</span>
<span class="nc" id="L1647">        this.title = (String)fields.get(&quot;title&quot;, &quot;&quot;);</span>

<span class="nc" id="L1649">        blockedWindows = new IdentityArrayList&lt;&gt;();</span>

<span class="nc" id="L1651">        SunToolkit.checkAndSetPolicy(this);</span>

<span class="nc" id="L1653">        initialized = true;</span>

<span class="nc" id="L1655">    }</span>

    /*
     * --- Accessibility Support ---
     *
     */

    /**
     * Gets the AccessibleContext associated with this Dialog.
     * For dialogs, the AccessibleContext takes the form of an
     * AccessibleAWTDialog.
     * A new AccessibleAWTDialog instance is created if necessary.
     *
     * @return an AccessibleAWTDialog that serves as the
     *         AccessibleContext of this Dialog
     * @since 1.3
     */
    public AccessibleContext getAccessibleContext() {
<span class="nc bnc" id="L1673" title="All 2 branches missed.">        if (accessibleContext == null) {</span>
<span class="nc" id="L1674">            accessibleContext = new AccessibleAWTDialog();</span>
        }
<span class="nc" id="L1676">        return accessibleContext;</span>
    }

    /**
     * This class implements accessibility support for the
     * &lt;code&gt;Dialog&lt;/code&gt; class.  It provides an implementation of the
     * Java Accessibility API appropriate to dialog user-interface elements.
     * @since 1.3
     */
<span class="nc" id="L1685">    protected class AccessibleAWTDialog extends AccessibleAWTWindow</span>
    {
        /*
         * JDK 1.3 serialVersionUID
         */
        private static final long serialVersionUID = 4837230331833941201L;

        /**
         * Get the role of this object.
         *
         * @return an instance of AccessibleRole describing the role of the
         * object
         * @see AccessibleRole
         */
        public AccessibleRole getAccessibleRole() {
<span class="nc" id="L1700">            return AccessibleRole.DIALOG;</span>
        }

        /**
         * Get the state of this object.
         *
         * @return an instance of AccessibleStateSet containing the current
         * state set of the object
         * @see AccessibleState
         */
        public AccessibleStateSet getAccessibleStateSet() {
<span class="nc" id="L1711">            AccessibleStateSet states = super.getAccessibleStateSet();</span>
<span class="nc bnc" id="L1712" title="All 2 branches missed.">            if (getFocusOwner() != null) {</span>
<span class="nc" id="L1713">                states.add(AccessibleState.ACTIVE);</span>
            }
<span class="nc bnc" id="L1715" title="All 2 branches missed.">            if (isModal()) {</span>
<span class="nc" id="L1716">                states.add(AccessibleState.MODAL);</span>
            }
<span class="nc bnc" id="L1718" title="All 2 branches missed.">            if (isResizable()) {</span>
<span class="nc" id="L1719">                states.add(AccessibleState.RESIZABLE);</span>
            }
<span class="nc" id="L1721">            return states;</span>
        }

    } // inner class AccessibleAWTDialog
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>