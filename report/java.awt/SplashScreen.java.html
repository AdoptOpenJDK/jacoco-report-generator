<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>SplashScreen.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.awt</a> &gt; <span class="el_source">SplashScreen.java</span></div><h1>SplashScreen.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2005, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package java.awt;

import java.io.IOException;
import java.awt.image.*;
import java.net.URL;
import java.net.URLConnection;
import java.io.File;
import sun.util.logging.PlatformLogger;
import sun.awt.image.SunWritableRaster;

/**
 * The splash screen can be displayed at application startup, before the
 * Java Virtual Machine (JVM) starts. The splash screen is displayed as an
 * undecorated window containing an image. You can use GIF, JPEG, or PNG files
 * for the image. Animation is supported for the GIF format, while transparency
 * is supported both for GIF and PNG.  The window is positioned at the center
 * of the screen. The position on multi-monitor systems is not specified. It is
 * platform and implementation dependent.  The splash screen window is closed
 * automatically as soon as the first window is displayed by Swing/AWT (may be
 * also closed manually using the Java API, see below).
 * &lt;P&gt;
 * If your application is packaged in a jar file, you can use the
 * &quot;SplashScreen-Image&quot; option in a manifest file to show a splash screen.
 * Place the image in the jar archive and specify the path in the option.
 * The path should not have a leading slash.
 * &lt;BR&gt;
 * For example, in the &lt;code&gt;manifest.mf&lt;/code&gt; file:
 * &lt;PRE&gt;
 * Manifest-Version: 1.0
 * Main-Class: Test
 * SplashScreen-Image: filename.gif
 * &lt;/PRE&gt;
 * &lt;P&gt;
 * If the Java implementation provides the command-line interface and you run
 * your application by using the command line or a shortcut, use the Java
 * application launcher option to show a splash screen. The Oracle reference
 * implementation allows you to specify the splash screen image location with
 * the {@code -splash:} option.
 * &lt;BR&gt;
 * For example:
 * &lt;PRE&gt;
 * java -splash:filename.gif Test
 * &lt;/PRE&gt;
 * The command line interface has higher precedence over the manifest
 * setting.
 * &lt;p&gt;
 * The splash screen will be displayed as faithfully as possible to present the
 * whole splash screen image given the limitations of the target platform and
 * display.
 * &lt;p&gt;
 * It is implied that the specified image is presented on the screen &quot;as is&quot;,
 * i.e. preserving the exact color values as specified in the image file. Under
 * certain circumstances, though, the presented image may differ, e.g. when
 * applying color dithering to present a 32 bits per pixel (bpp) image on a 16
 * or 8 bpp screen. The native platform display configuration may also affect
 * the colors of the displayed image (e.g.  color profiles, etc.)
 * &lt;p&gt;
 * The {@code SplashScreen} class provides the API for controlling the splash
 * screen. This class may be used to close the splash screen, change the splash
 * screen image, get the splash screen native window position/size, and paint
 * in the splash screen. It cannot be used to create the splash screen. You
 * should use the options provided by the Java implementation for that.
 * &lt;p&gt;
 * This class cannot be instantiated. Only a single instance of this class
 * can exist, and it may be obtained by using the {@link #getSplashScreen()}
 * static method. In case the splash screen has not been created at
 * application startup via the command line or manifest file option,
 * the &lt;code&gt;getSplashScreen&lt;/code&gt; method returns &lt;code&gt;null&lt;/code&gt;.
 *
 * @author Oleg Semenov
 * @since 1.6
 */
public final class SplashScreen {

<span class="nc" id="L99">    SplashScreen(long ptr) { // non-public constructor</span>
<span class="nc" id="L100">        splashPtr = ptr;</span>
<span class="nc" id="L101">    }</span>

    /**
     * Returns the {@code SplashScreen} object used for
     * Java startup splash screen control on systems that support display.
     *
     * @throws UnsupportedOperationException if the splash screen feature is not
     *         supported by the current toolkit
     * @throws HeadlessException if {@code GraphicsEnvironment.isHeadless()}
     *         returns true
     * @return the {@link SplashScreen} instance, or &lt;code&gt;null&lt;/code&gt; if there is
     *         none or it has already been closed
     */
    public static  SplashScreen getSplashScreen() {
<span class="nc" id="L115">        synchronized (SplashScreen.class) {</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">            if (GraphicsEnvironment.isHeadless()) {</span>
<span class="nc" id="L117">                throw new HeadlessException();</span>
            }
            // SplashScreen class is now a singleton
<span class="nc bnc" id="L120" title="All 4 branches missed.">            if (!wasClosed &amp;&amp; theInstance == null) {</span>
<span class="nc" id="L121">                java.security.AccessController.doPrivileged(</span>
<span class="nc" id="L122">                    new java.security.PrivilegedAction&lt;Void&gt;() {</span>
                        public Void run() {
<span class="nc" id="L124">                            System.loadLibrary(&quot;splashscreen&quot;);</span>
<span class="nc" id="L125">                            return null;</span>
                        }
                    });
<span class="nc" id="L128">                long ptr = _getInstance();</span>
<span class="nc bnc" id="L129" title="All 4 branches missed.">                if (ptr != 0 &amp;&amp; _isVisible(ptr)) {</span>
<span class="nc" id="L130">                    theInstance = new SplashScreen(ptr);</span>
                }
            }
<span class="nc" id="L133">            return theInstance;</span>
<span class="nc" id="L134">        }</span>
    }

    /**
     * Changes the splash screen image. The new image is loaded from the
     * specified URL; GIF, JPEG and PNG image formats are supported.
     * The method returns after the image has finished loading and the window
     * has been updated.
     * The splash screen window is resized according to the size of
     * the image and is centered on the screen.
     *
     * @param imageURL the non-&lt;code&gt;null&lt;/code&gt; URL for the new
     *        splash screen image
     * @throws NullPointerException if {@code imageURL} is &lt;code&gt;null&lt;/code&gt;
     * @throws IOException if there was an error while loading the image
     * @throws IllegalStateException if the splash screen has already been
     *         closed
     */
    public void setImageURL(URL imageURL) throws NullPointerException, IOException, IllegalStateException {
<span class="nc" id="L153">        checkVisible();</span>
<span class="nc" id="L154">        URLConnection connection = imageURL.openConnection();</span>
<span class="nc" id="L155">        connection.connect();</span>
<span class="nc" id="L156">        int length = connection.getContentLength();</span>
<span class="nc" id="L157">        java.io.InputStream stream = connection.getInputStream();</span>
<span class="nc" id="L158">        byte[] buf = new byte[length];</span>
<span class="nc" id="L159">        int off = 0;</span>
        while(true) {
            // check for available data
<span class="nc" id="L162">            int available = stream.available();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            if (available &lt;= 0) {</span>
                // no data available... well, let's try reading one byte
                // we'll see what happens then
<span class="nc" id="L166">                available = 1;</span>
            }
            // check for enough room in buffer, realloc if needed
            // the buffer always grows in size 2x minimum
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (off + available &gt; length) {</span>
<span class="nc" id="L171">                length = off*2;</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">                if (off + available &gt; length) {</span>
<span class="nc" id="L173">                    length = available+off;</span>
                }
<span class="nc" id="L175">                byte[] oldBuf = buf;</span>
<span class="nc" id="L176">                buf = new byte[length];</span>
<span class="nc" id="L177">                System.arraycopy(oldBuf, 0, buf, 0, off);</span>
            }
            // now read the data
<span class="nc" id="L180">            int result = stream.read(buf, off, available);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (result &lt; 0) {</span>
<span class="nc" id="L182">                break;</span>
            }
<span class="nc" id="L184">            off += result;</span>
<span class="nc" id="L185">        }</span>
<span class="nc" id="L186">        synchronized(SplashScreen.class) {</span>
<span class="nc" id="L187">            checkVisible();</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">            if (!_setImageData(splashPtr, buf)) {</span>
<span class="nc" id="L189">                throw new IOException(&quot;Bad image format or i/o error when loading image&quot;);</span>
            }
<span class="nc" id="L191">            this.imageURL = imageURL;</span>
<span class="nc" id="L192">        }</span>
<span class="nc" id="L193">    }</span>

    private void checkVisible() {
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (!isVisible()) {</span>
<span class="nc" id="L197">            throw new IllegalStateException(&quot;no splash screen available&quot;);</span>
        }
<span class="nc" id="L199">    }</span>
    /**
     * Returns the current splash screen image.
     *
     * @return URL for the current splash screen image file
     * @throws IllegalStateException if the splash screen has already been closed
     */
    public URL getImageURL() throws IllegalStateException {
<span class="nc" id="L207">        synchronized (SplashScreen.class) {</span>
<span class="nc" id="L208">            checkVisible();</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">            if (imageURL == null) {</span>
                try {
<span class="nc" id="L211">                    String fileName = _getImageFileName(splashPtr);</span>
<span class="nc" id="L212">                    String jarName = _getImageJarName(splashPtr);</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">                    if (fileName != null) {</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">                        if (jarName != null) {</span>
<span class="nc" id="L215">                            imageURL = new URL(&quot;jar:&quot;+(new File(jarName).toURL().toString())+&quot;!/&quot;+fileName);</span>
                        } else {
<span class="nc" id="L217">                            imageURL = new File(fileName).toURL();</span>
                        }
                    }
                }
<span class="nc" id="L221">                catch(java.net.MalformedURLException e) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                    if (log.isLoggable(PlatformLogger.Level.FINE)) {</span>
<span class="nc" id="L223">                        log.fine(&quot;MalformedURLException caught in the getImageURL() method&quot;, e);</span>
                    }
<span class="nc" id="L225">                }</span>
            }
<span class="nc" id="L227">            return imageURL;</span>
<span class="nc" id="L228">        }</span>
    }

    /**
     * Returns the bounds of the splash screen window as a {@link Rectangle}.
     * This may be useful if, for example, you want to replace the splash
     * screen with your window at the same location.
     * &lt;p&gt;
     * You cannot control the size or position of the splash screen.
     * The splash screen size is adjusted automatically when the image changes.
     * &lt;p&gt;
     * The image may contain transparent areas, and thus the reported bounds may
     * be larger than the visible splash screen image on the screen.
     *
     * @return a {@code Rectangle} containing the splash screen bounds
     * @throws IllegalStateException if the splash screen has already been closed
     */
    public Rectangle getBounds() throws IllegalStateException {
<span class="nc" id="L246">        synchronized (SplashScreen.class) {</span>
<span class="nc" id="L247">            checkVisible();</span>
<span class="nc" id="L248">            return _getBounds(splashPtr);</span>
<span class="nc" id="L249">        }</span>
    }

    /**
     * Returns the size of the splash screen window as a {@link Dimension}.
     * This may be useful if, for example,
     * you want to draw on the splash screen overlay surface.
     * &lt;p&gt;
     * You cannot control the size or position of the splash screen.
     * The splash screen size is adjusted automatically when the image changes.
     * &lt;p&gt;
     * The image may contain transparent areas, and thus the reported size may
     * be larger than the visible splash screen image on the screen.
     *
     * @return a {@link Dimension} object indicating the splash screen size
     * @throws IllegalStateException if the splash screen has already been closed
     */
    public Dimension getSize() throws IllegalStateException {
<span class="nc" id="L267">        return getBounds().getSize();</span>
    }

    /**
     * Creates a graphics context (as a {@link Graphics2D} object) for the splash
     * screen overlay image, which allows you to draw over the splash screen.
     * Note that you do not draw on the main image but on the image that is
     * displayed over the main image using alpha blending. Also note that drawing
     * on the overlay image does not necessarily update the contents of splash
     * screen window. You should call {@code update()} on the
     * &lt;code&gt;SplashScreen&lt;/code&gt; when you want the splash screen to be
     * updated immediately.
     * &lt;p&gt;
     * The pixel (0, 0) in the coordinate space of the graphics context
     * corresponds to the origin of the splash screen native window bounds (see
     * {@link #getBounds()}).
     *
     * @return graphics context for the splash screen overlay surface
     * @throws IllegalStateException if the splash screen has already been closed
     */
    public Graphics2D createGraphics() throws IllegalStateException {
<span class="nc" id="L288">        synchronized (SplashScreen.class) {</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">            if (image==null) {</span>
<span class="nc" id="L290">                Dimension dim = getSize();</span>
<span class="nc" id="L291">                image = new BufferedImage(dim.width, dim.height, BufferedImage.TYPE_INT_ARGB);</span>
            }
<span class="nc" id="L293">            return image.createGraphics();</span>
<span class="nc" id="L294">        }</span>
    }

    /**
     * Updates the splash window with current contents of the overlay image.
     *
     * @throws IllegalStateException if the overlay image does not exist;
     *         for example, if {@code createGraphics} has never been called,
     *         or if the splash screen has already been closed
     */
    public void update() throws IllegalStateException {
        BufferedImage image;
<span class="nc" id="L306">        synchronized (SplashScreen.class) {</span>
<span class="nc" id="L307">            checkVisible();</span>
<span class="nc" id="L308">            image = this.image;</span>
<span class="nc" id="L309">        }</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (image == null) {</span>
<span class="nc" id="L311">            throw new IllegalStateException(&quot;no overlay image available&quot;);</span>
        }
<span class="nc" id="L313">        DataBuffer buf = image.getRaster().getDataBuffer();</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (!(buf instanceof DataBufferInt)) {</span>
<span class="nc" id="L315">            throw new AssertionError(&quot;Overlay image DataBuffer is of invalid type == &quot;+buf.getClass().getName());</span>
        }
<span class="nc" id="L317">        int numBanks = buf.getNumBanks();</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (numBanks!=1) {</span>
<span class="nc" id="L319">            throw new AssertionError(&quot;Invalid number of banks ==&quot;+numBanks+&quot; in overlay image DataBuffer&quot;);</span>
        }
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (!(image.getSampleModel() instanceof SinglePixelPackedSampleModel)) {</span>
<span class="nc" id="L322">            throw new AssertionError(&quot;Overlay image has invalid sample model == &quot;+image.getSampleModel().getClass().getName());</span>
        }
<span class="nc" id="L324">        SinglePixelPackedSampleModel sm = (SinglePixelPackedSampleModel)image.getSampleModel();</span>
<span class="nc" id="L325">        int scanlineStride = sm.getScanlineStride();</span>
<span class="nc" id="L326">        Rectangle rect = image.getRaster().getBounds();</span>
        // Note that we steal the data array here, but just for reading
        // so we do not need to mark the DataBuffer dirty...
<span class="nc" id="L329">        int[] data = SunWritableRaster.stealData((DataBufferInt)buf, 0);</span>
<span class="nc" id="L330">        synchronized(SplashScreen.class) {</span>
<span class="nc" id="L331">            checkVisible();</span>
<span class="nc" id="L332">            _update(splashPtr, data, rect.x, rect.y, rect.width, rect.height, scanlineStride);</span>
<span class="nc" id="L333">        }</span>
<span class="nc" id="L334">    }</span>

    /**
     * Hides the splash screen, closes the window, and releases all associated
     * resources.
     *
     * @throws IllegalStateException if the splash screen has already been closed
     */
    public void close() throws IllegalStateException {
<span class="nc" id="L343">        synchronized (SplashScreen.class) {</span>
<span class="nc" id="L344">            checkVisible();</span>
<span class="nc" id="L345">            _close(splashPtr);</span>
<span class="nc" id="L346">            image = null;</span>
<span class="nc" id="L347">            SplashScreen.markClosed();</span>
<span class="nc" id="L348">        }</span>
<span class="nc" id="L349">    }</span>

    static void markClosed() {
<span class="nc" id="L352">        synchronized (SplashScreen.class) {</span>
<span class="nc" id="L353">            wasClosed = true;</span>
<span class="nc" id="L354">            theInstance = null;</span>
<span class="nc" id="L355">        }</span>
<span class="nc" id="L356">    }</span>


    /**
     * Determines whether the splash screen is visible. The splash screen may
     * be hidden using {@link #close()}, it is also hidden automatically when
     * the first AWT/Swing window is made visible.
     * &lt;p&gt;
     * Note that the native platform may delay presenting the splash screen
     * native window on the screen. The return value of {@code true} for this
     * method only guarantees that the conditions to hide the splash screen
     * window have not occurred yet.
     *
     * @return true if the splash screen is visible (has not been closed yet),
     *         false otherwise
     */
    public boolean isVisible() {
<span class="nc" id="L373">        synchronized (SplashScreen.class) {</span>
<span class="nc bnc" id="L374" title="All 4 branches missed.">            return !wasClosed &amp;&amp; _isVisible(splashPtr);</span>
<span class="nc" id="L375">        }</span>
    }

    private BufferedImage image; // overlay image

    private final long splashPtr; // pointer to native Splash structure
<span class="nc" id="L381">    private static boolean wasClosed = false;</span>

    private URL imageURL;

    /**
     * The instance reference for the singleton.
     * (&lt;code&gt;null&lt;/code&gt; if no instance exists yet.)
     *
     * @see #getSplashScreen
     * @see #close
     */
<span class="nc" id="L392">    private static SplashScreen theInstance = null;</span>

<span class="nc" id="L394">    private static final PlatformLogger log = PlatformLogger.getLogger(&quot;java.awt.SplashScreen&quot;);</span>

    private native static void _update(long splashPtr, int[] data, int x, int y, int width, int height, int scanlineStride);
    private native static boolean _isVisible(long splashPtr);
    private native static Rectangle _getBounds(long splashPtr);
    private native static long _getInstance();
    private native static void _close(long splashPtr);
    private native static String _getImageFileName(long splashPtr);
    private native static String _getImageJarName(long SplashPtr);
    private native static boolean _setImageData(long SplashPtr, byte[] data);

};
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>