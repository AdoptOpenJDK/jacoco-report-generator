<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>Desktop.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">java.awt</a> &gt; <span class="el_source">Desktop.java</span></div><h1>Desktop.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2005, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.awt;

import java.io.File;
import java.io.IOException;
import java.net.URISyntaxException;
import java.net.URI;
import java.net.URL;
import java.net.MalformedURLException;
import java.awt.AWTPermission;
import java.awt.GraphicsEnvironment;
import java.awt.HeadlessException;
import java.awt.peer.DesktopPeer;
import sun.awt.SunToolkit;
import sun.awt.HeadlessToolkit;
import java.io.FilePermission;
import sun.security.util.SecurityConstants;

/**
 * The {@code Desktop} class allows a Java application to launch
 * associated applications registered on the native desktop to handle
 * a {@link java.net.URI} or a file.
 *
 * &lt;p&gt; Supported operations include:
 * &lt;ul&gt;
 *   &lt;li&gt;launching the user-default browser to show a specified
 *       URI;&lt;/li&gt;
 *   &lt;li&gt;launching the user-default mail client with an optional
 *       {@code mailto} URI;&lt;/li&gt;
 *   &lt;li&gt;launching a registered application to open, edit or print a
 *       specified file.&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;p&gt; This class provides methods corresponding to these
 * operations. The methods look for the associated application
 * registered on the current platform, and launch it to handle a URI
 * or file. If there is no associated application or the associated
 * application fails to be launched, an exception is thrown.
 *
 * &lt;p&gt; An application is registered to a URI or file type; for
 * example, the {@code &quot;sxi&quot;} file extension is typically registered
 * to StarOffice.  The mechanism of registering, accessing, and
 * launching the associated application is platform-dependent.
 *
 * &lt;p&gt; Each operation is an action type represented by the {@link
 * Desktop.Action} class.
 *
 * &lt;p&gt; Note: when some action is invoked and the associated
 * application is executed, it will be executed on the same system as
 * the one on which the Java application was launched.
 *
 * @since 1.6
 * @author Armin Chen
 * @author George Zhang
 */
public class Desktop {

    /**
     * Represents an action type.  Each platform supports a different
     * set of actions.  You may use the {@link Desktop#isSupported}
     * method to determine if the given action is supported by the
     * current platform.
     * @see java.awt.Desktop#isSupported(java.awt.Desktop.Action)
     * @since 1.6
     */
<span class="nc" id="L90">    public static enum Action {</span>
        /**
         * Represents an &quot;open&quot; action.
         * @see Desktop#open(java.io.File)
         */
<span class="nc" id="L95">        OPEN,</span>
        /**
         * Represents an &quot;edit&quot; action.
         * @see Desktop#edit(java.io.File)
         */
<span class="nc" id="L100">        EDIT,</span>
        /**
         * Represents a &quot;print&quot; action.
         * @see Desktop#print(java.io.File)
         */
<span class="nc" id="L105">        PRINT,</span>
        /**
         * Represents a &quot;mail&quot; action.
         * @see Desktop#mail()
         * @see Desktop#mail(java.net.URI)
         */
<span class="nc" id="L111">        MAIL,</span>
        /**
         * Represents a &quot;browse&quot; action.
         * @see Desktop#browse(java.net.URI)
         */
<span class="nc" id="L116">        BROWSE</span>
    };

    private DesktopPeer peer;

    /**
     * Suppresses default constructor for noninstantiability.
     */
<span class="nc" id="L124">    private Desktop() {</span>
<span class="nc" id="L125">        peer = Toolkit.getDefaultToolkit().createDesktopPeer(this);</span>
<span class="nc" id="L126">    }</span>

    /**
     * Returns the &lt;code&gt;Desktop&lt;/code&gt; instance of the current
     * browser context.  On some platforms the Desktop API may not be
     * supported; use the {@link #isDesktopSupported} method to
     * determine if the current desktop is supported.
     * @return the Desktop instance of the current browser context
     * @throws HeadlessException if {@link
     * GraphicsEnvironment#isHeadless()} returns {@code true}
     * @throws UnsupportedOperationException if this class is not
     * supported on the current platform
     * @see #isDesktopSupported()
     * @see java.awt.GraphicsEnvironment#isHeadless
     */
    public static synchronized Desktop getDesktop(){
<span class="nc bnc" id="L142" title="All 2 branches missed.">        if (GraphicsEnvironment.isHeadless()) throw new HeadlessException();</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (!Desktop.isDesktopSupported()) {</span>
<span class="nc" id="L144">            throw new UnsupportedOperationException(&quot;Desktop API is not &quot; +</span>
                                                    &quot;supported on the current platform&quot;);
        }

<span class="nc" id="L148">        sun.awt.AppContext context = sun.awt.AppContext.getAppContext();</span>
<span class="nc" id="L149">        Desktop desktop = (Desktop)context.get(Desktop.class);</span>

<span class="nc bnc" id="L151" title="All 2 branches missed.">        if (desktop == null) {</span>
<span class="nc" id="L152">            desktop = new Desktop();</span>
<span class="nc" id="L153">            context.put(Desktop.class, desktop);</span>
        }

<span class="nc" id="L156">        return desktop;</span>
    }

    /**
     * Tests whether this class is supported on the current platform.
     * If it's supported, use {@link #getDesktop()} to retrieve an
     * instance.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if this class is supported on the
     *         current platform; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see #getDesktop()
     */
    public static boolean isDesktopSupported(){
<span class="nc" id="L169">        Toolkit defaultToolkit = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (defaultToolkit instanceof SunToolkit) {</span>
<span class="nc" id="L171">            return ((SunToolkit)defaultToolkit).isDesktopSupported();</span>
        }
<span class="nc" id="L173">        return false;</span>
    }

    /**
     * Tests whether an action is supported on the current platform.
     *
     * &lt;p&gt;Even when the platform supports an action, a file or URI may
     * not have a registered application for the action.  For example,
     * most of the platforms support the {@link Desktop.Action#OPEN}
     * action.  But for a specific file, there may not be an
     * application registered to open it.  In this case, {@link
     * #isSupported} may return {@code true}, but the corresponding
     * action method will throw an {@link IOException}.
     *
     * @param action the specified {@link Action}
     * @return &lt;code&gt;true&lt;/code&gt; if the specified action is supported on
     *         the current platform; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see Desktop.Action
     */
    public boolean isSupported(Action action) {
<span class="nc" id="L193">        return peer.isSupported(action);</span>
    }

    /**
     * Checks if the file is a valid file and readable.
     *
     * @throws SecurityException If a security manager exists and its
     *         {@link SecurityManager#checkRead(java.lang.String)} method
     *         denies read access to the file
     * @throws NullPointerException if file is null
     * @throws IllegalArgumentException if file doesn't exist
     */
    private static void checkFileValidation(File file){
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (file == null) throw new NullPointerException(&quot;File must not be null&quot;);</span>

<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (!file.exists()) {</span>
<span class="nc" id="L209">            throw new IllegalArgumentException(&quot;The file: &quot;</span>
<span class="nc" id="L210">                                               + file.getPath() + &quot; doesn't exist.&quot;);</span>
        }

<span class="nc" id="L213">        file.canRead();</span>
<span class="nc" id="L214">    }</span>

    /**
     * Checks if the action type is supported.
     *
     * @param actionType the action type in question
     * @throws UnsupportedOperationException if the specified action type is not
     *         supported on the current platform
     */
    private void checkActionSupport(Action actionType){
<span class="nc bnc" id="L224" title="All 2 branches missed.">        if (!isSupported(actionType)) {</span>
<span class="nc" id="L225">            throw new UnsupportedOperationException(&quot;The &quot; + actionType.name()</span>
                                                    + &quot; action is not supported on the current platform!&quot;);
        }
<span class="nc" id="L228">    }</span>


    /**
     *  Calls to the security manager's &lt;code&gt;checkPermission&lt;/code&gt; method with
     *  an &lt;code&gt;AWTPermission(&quot;showWindowWithoutWarningBanner&quot;)&lt;/code&gt;
     *  permission.
     */
    private void checkAWTPermission(){
<span class="nc" id="L237">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L239">            sm.checkPermission(new AWTPermission(</span>
                                   &quot;showWindowWithoutWarningBanner&quot;));
        }
<span class="nc" id="L242">    }</span>

    /**
     * Launches the associated application to open the file.
     *
     * &lt;p&gt; If the specified file is a directory, the file manager of
     * the current platform is launched to open it.
     *
     * @param file the file to be opened with the associated application
     * @throws NullPointerException if {@code file} is {@code null}
     * @throws IllegalArgumentException if the specified file doesn't
     * exist
     * @throws UnsupportedOperationException if the current platform
     * does not support the {@link Desktop.Action#OPEN} action
     * @throws IOException if the specified file has no associated
     * application or the associated application fails to be launched
     * @throws SecurityException if a security manager exists and its
     * {@link java.lang.SecurityManager#checkRead(java.lang.String)}
     * method denies read access to the file, or it denies the
     * &lt;code&gt;AWTPermission(&quot;showWindowWithoutWarningBanner&quot;)&lt;/code&gt;
     * permission, or the calling thread is not allowed to create a
     * subprocess
     * @see java.awt.AWTPermission
     */
    public void open(File file) throws IOException {
<span class="nc" id="L267">        checkAWTPermission();</span>
<span class="nc" id="L268">        checkExec();</span>
<span class="nc" id="L269">        checkActionSupport(Action.OPEN);</span>
<span class="nc" id="L270">        checkFileValidation(file);</span>

<span class="nc" id="L272">        peer.open(file);</span>
<span class="nc" id="L273">    }</span>

    /**
     * Launches the associated editor application and opens a file for
     * editing.
     *
     * @param file the file to be opened for editing
     * @throws NullPointerException if the specified file is {@code null}
     * @throws IllegalArgumentException if the specified file doesn't
     * exist
     * @throws UnsupportedOperationException if the current platform
     * does not support the {@link Desktop.Action#EDIT} action
     * @throws IOException if the specified file has no associated
     * editor, or the associated application fails to be launched
     * @throws SecurityException if a security manager exists and its
     * {@link java.lang.SecurityManager#checkRead(java.lang.String)}
     * method denies read access to the file, or {@link
     * java.lang.SecurityManager#checkWrite(java.lang.String)} method
     * denies write access to the file, or it denies the
     * &lt;code&gt;AWTPermission(&quot;showWindowWithoutWarningBanner&quot;)&lt;/code&gt;
     * permission, or the calling thread is not allowed to create a
     * subprocess
     * @see java.awt.AWTPermission
     */
    public void edit(File file) throws IOException {
<span class="nc" id="L298">        checkAWTPermission();</span>
<span class="nc" id="L299">        checkExec();</span>
<span class="nc" id="L300">        checkActionSupport(Action.EDIT);</span>
<span class="nc" id="L301">        file.canWrite();</span>
<span class="nc" id="L302">        checkFileValidation(file);</span>

<span class="nc" id="L304">        peer.edit(file);</span>
<span class="nc" id="L305">    }</span>

    /**
     * Prints a file with the native desktop printing facility, using
     * the associated application's print command.
     *
     * @param file the file to be printed
     * @throws NullPointerException if the specified file is {@code
     * null}
     * @throws IllegalArgumentException if the specified file doesn't
     * exist
     * @throws UnsupportedOperationException if the current platform
     *         does not support the {@link Desktop.Action#PRINT} action
     * @throws IOException if the specified file has no associated
     * application that can be used to print it
     * @throws SecurityException if a security manager exists and its
     * {@link java.lang.SecurityManager#checkRead(java.lang.String)}
     * method denies read access to the file, or its {@link
     * java.lang.SecurityManager#checkPrintJobAccess()} method denies
     * the permission to print the file, or the calling thread is not
     * allowed to create a subprocess
     */
    public void print(File file) throws IOException {
<span class="nc" id="L328">        checkExec();</span>
<span class="nc" id="L329">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L331">            sm.checkPrintJobAccess();</span>
        }
<span class="nc" id="L333">        checkActionSupport(Action.PRINT);</span>
<span class="nc" id="L334">        checkFileValidation(file);</span>

<span class="nc" id="L336">        peer.print(file);</span>
<span class="nc" id="L337">    }</span>

    /**
     * Launches the default browser to display a {@code URI}.
     * If the default browser is not able to handle the specified
     * {@code URI}, the application registered for handling
     * {@code URIs} of the specified type is invoked. The application
     * is determined from the protocol and path of the {@code URI}, as
     * defined by the {@code URI} class.
     * &lt;p&gt;
     * If the calling thread does not have the necessary permissions,
     * and this is invoked from within an applet,
     * {@code AppletContext.showDocument()} is used. Similarly, if the calling
     * does not have the necessary permissions, and this is invoked from within
     * a Java Web Started application, {@code BasicService.showDocument()}
     * is used.
     *
     * @param uri the URI to be displayed in the user default browser
     * @throws NullPointerException if {@code uri} is {@code null}
     * @throws UnsupportedOperationException if the current platform
     * does not support the {@link Desktop.Action#BROWSE} action
     * @throws IOException if the user default browser is not found,
     * or it fails to be launched, or the default handler application
     * failed to be launched
     * @throws SecurityException if a security manager exists and it
     * denies the
     * &lt;code&gt;AWTPermission(&quot;showWindowWithoutWarningBanner&quot;)&lt;/code&gt;
     * permission, or the calling thread is not allowed to create a
     * subprocess; and not invoked from within an applet or Java Web Started
     * application
     * @throws IllegalArgumentException if the necessary permissions
     * are not available and the URI can not be converted to a {@code URL}
     * @see java.net.URI
     * @see java.awt.AWTPermission
     * @see java.applet.AppletContext
     */
    public void browse(URI uri) throws IOException {
<span class="nc" id="L374">        SecurityException securityException = null;</span>
        try {
<span class="nc" id="L376">            checkAWTPermission();</span>
<span class="nc" id="L377">            checkExec();</span>
<span class="nc" id="L378">        } catch (SecurityException e) {</span>
<span class="nc" id="L379">            securityException = e;</span>
<span class="nc" id="L380">        }</span>
<span class="nc" id="L381">        checkActionSupport(Action.BROWSE);</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">        if (uri == null) {</span>
<span class="nc" id="L383">            throw new NullPointerException();</span>
        }
<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (securityException == null) {</span>
<span class="nc" id="L386">            peer.browse(uri);</span>
<span class="nc" id="L387">            return;</span>
        }

        // Calling thread doesn't have necessary priviledges.
        // Delegate to DesktopBrowse so that it can work in
        // applet/webstart.
<span class="nc" id="L393">        URL url = null;</span>
        try {
<span class="nc" id="L395">            url = uri.toURL();</span>
<span class="nc" id="L396">        } catch (MalformedURLException e) {</span>
<span class="nc" id="L397">            throw new IllegalArgumentException(&quot;Unable to convert URI to URL&quot;, e);</span>
<span class="nc" id="L398">        }</span>
<span class="nc" id="L399">        sun.awt.DesktopBrowse db = sun.awt.DesktopBrowse.getInstance();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (db == null) {</span>
            // Not in webstart/applet, throw the exception.
<span class="nc" id="L402">            throw securityException;</span>
        }
<span class="nc" id="L404">        db.browse(url);</span>
<span class="nc" id="L405">    }</span>

    /**
     * Launches the mail composing window of the user default mail
     * client.
     *
     * @throws UnsupportedOperationException if the current platform
     * does not support the {@link Desktop.Action#MAIL} action
     * @throws IOException if the user default mail client is not
     * found, or it fails to be launched
     * @throws SecurityException if a security manager exists and it
     * denies the
     * &lt;code&gt;AWTPermission(&quot;showWindowWithoutWarningBanner&quot;)&lt;/code&gt;
     * permission, or the calling thread is not allowed to create a
     * subprocess
     * @see java.awt.AWTPermission
     */
    public void mail() throws IOException {
<span class="nc" id="L423">        checkAWTPermission();</span>
<span class="nc" id="L424">        checkExec();</span>
<span class="nc" id="L425">        checkActionSupport(Action.MAIL);</span>
<span class="nc" id="L426">        URI mailtoURI = null;</span>
        try{
<span class="nc" id="L428">            mailtoURI = new URI(&quot;mailto:?&quot;);</span>
<span class="nc" id="L429">            peer.mail(mailtoURI);</span>
<span class="nc" id="L430">        } catch (URISyntaxException e){</span>
            // won't reach here.
<span class="nc" id="L432">        }</span>
<span class="nc" id="L433">    }</span>

    /**
     * Launches the mail composing window of the user default mail
     * client, filling the message fields specified by a {@code
     * mailto:} URI.
     *
     * &lt;p&gt; A &lt;code&gt;mailto:&lt;/code&gt; URI can specify message fields
     * including &lt;i&gt;&quot;to&quot;&lt;/i&gt;, &lt;i&gt;&quot;cc&quot;&lt;/i&gt;, &lt;i&gt;&quot;subject&quot;&lt;/i&gt;,
     * &lt;i&gt;&quot;body&quot;&lt;/i&gt;, etc.  See &lt;a
     * href=&quot;http://www.ietf.org/rfc/rfc2368.txt&quot;&gt;The mailto URL
     * scheme (RFC 2368)&lt;/a&gt; for the {@code mailto:} URI specification
     * details.
     *
     * @param mailtoURI the specified {@code mailto:} URI
     * @throws NullPointerException if the specified URI is {@code
     * null}
     * @throws IllegalArgumentException if the URI scheme is not
     *         &lt;code&gt;&quot;mailto&quot;&lt;/code&gt;
     * @throws UnsupportedOperationException if the current platform
     * does not support the {@link Desktop.Action#MAIL} action
     * @throws IOException if the user default mail client is not
     * found or fails to be launched
     * @throws SecurityException if a security manager exists and it
     * denies the
     * &lt;code&gt;AWTPermission(&quot;showWindowWithoutWarningBanner&quot;)&lt;/code&gt;
     * permission, or the calling thread is not allowed to create a
     * subprocess
     * @see java.net.URI
     * @see java.awt.AWTPermission
     */
    public  void mail(URI mailtoURI) throws IOException {
<span class="nc" id="L465">        checkAWTPermission();</span>
<span class="nc" id="L466">        checkExec();</span>
<span class="nc" id="L467">        checkActionSupport(Action.MAIL);</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">        if (mailtoURI == null) throw new NullPointerException();</span>

<span class="nc bnc" id="L470" title="All 2 branches missed.">        if (!&quot;mailto&quot;.equalsIgnoreCase(mailtoURI.getScheme())) {</span>
<span class="nc" id="L471">            throw new IllegalArgumentException(&quot;URI scheme is not \&quot;mailto\&quot;&quot;);</span>
        }

<span class="nc" id="L474">        peer.mail(mailtoURI);</span>
<span class="nc" id="L475">    }</span>

    private void checkExec() throws SecurityException {
<span class="nc" id="L478">        SecurityManager sm = System.getSecurityManager();</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">        if (sm != null) {</span>
<span class="nc" id="L480">            sm.checkPermission(new FilePermission(&quot;&lt;&lt;ALL FILES&gt;&gt;&quot;,</span>
                                                  SecurityConstants.FILE_EXECUTE_ACTION));
        }
<span class="nc" id="L483">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>