<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MediaTracker.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">java.awt</a> &gt; <span class="el_source">MediaTracker.java</span></div><h1>MediaTracker.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1995, 2007, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package java.awt;

import java.awt.Component;
import java.awt.Image;
import java.awt.image.ImageObserver;

/**
 * The &lt;code&gt;MediaTracker&lt;/code&gt; class is a utility class to track
 * the status of a number of media objects. Media objects could
 * include audio clips as well as images, though currently only
 * images are supported.
 * &lt;p&gt;
 * To use a media tracker, create an instance of
 * &lt;code&gt;MediaTracker&lt;/code&gt; and call its &lt;code&gt;addImage&lt;/code&gt;
 * method for each image to be tracked. In addition, each image can
 * be assigned a unique identifier. This identifier controls the
 * priority order in which the images are fetched. It can also be used
 * to identify unique subsets of the images that can be waited on
 * independently. Images with a lower ID are loaded in preference to
 * those with a higher ID number.
 *
 * &lt;p&gt;
 *
 * Tracking an animated image
 * might not always be useful
 * due to the multi-part nature of animated image
 * loading and painting,
 * but it is supported.
 * &lt;code&gt;MediaTracker&lt;/code&gt; treats an animated image
 * as completely loaded
 * when the first frame is completely loaded.
 * At that point, the &lt;code&gt;MediaTracker&lt;/code&gt;
 * signals any waiters
 * that the image is completely loaded.
 * If no &lt;code&gt;ImageObserver&lt;/code&gt;s are observing the image
 * when the first frame has finished loading,
 * the image might flush itself
 * to conserve resources
 * (see {@link Image#flush()}).
 *
 * &lt;p&gt;
 * Here is an example of using &lt;code&gt;MediaTracker&lt;/code&gt;:
 * &lt;p&gt;
 * &lt;hr&gt;&lt;blockquote&gt;&lt;pre&gt;
 * import java.applet.Applet;
 * import java.awt.Color;
 * import java.awt.Image;
 * import java.awt.Graphics;
 * import java.awt.MediaTracker;
 *
 * public class ImageBlaster extends Applet implements Runnable {
 *      MediaTracker tracker;
 *      Image bg;
 *      Image anim[] = new Image[5];
 *      int index;
 *      Thread animator;
 *
 *      // Get the images for the background (id == 0)
 *      // and the animation frames (id == 1)
 *      // and add them to the MediaTracker
 *      public void init() {
 *          tracker = new MediaTracker(this);
 *          bg = getImage(getDocumentBase(),
 *                  &quot;images/background.gif&quot;);
 *          tracker.addImage(bg, 0);
 *          for (int i = 0; i &lt; 5; i++) {
 *              anim[i] = getImage(getDocumentBase(),
 *                      &quot;images/anim&quot;+i+&quot;.gif&quot;);
 *              tracker.addImage(anim[i], 1);
 *          }
 *      }
 *
 *      // Start the animation thread.
 *      public void start() {
 *          animator = new Thread(this);
 *          animator.start();
 *      }
 *
 *      // Stop the animation thread.
 *      public void stop() {
 *          animator = null;
 *      }
 *
 *      // Run the animation thread.
 *      // First wait for the background image to fully load
 *      // and paint.  Then wait for all of the animation
 *      // frames to finish loading. Finally, loop and
 *      // increment the animation frame index.
 *      public void run() {
 *          try {
 *              tracker.waitForID(0);
 *              tracker.waitForID(1);
 *          } catch (InterruptedException e) {
 *              return;
 *          }
 *          Thread me = Thread.currentThread();
 *          while (animator == me) {
 *              try {
 *                  Thread.sleep(100);
 *              } catch (InterruptedException e) {
 *                  break;
 *              }
 *              synchronized (this) {
 *                  index++;
 *                  if (index &gt;= anim.length) {
 *                      index = 0;
 *                  }
 *              }
 *              repaint();
 *          }
 *      }
 *
 *      // The background image fills the frame so we
 *      // don't need to clear the applet on repaints.
 *      // Just call the paint method.
 *      public void update(Graphics g) {
 *          paint(g);
 *      }
 *
 *      // Paint a large red rectangle if there are any errors
 *      // loading the images.  Otherwise always paint the
 *      // background so that it appears incrementally as it
 *      // is loading.  Finally, only paint the current animation
 *      // frame if all of the frames (id == 1) are done loading,
 *      // so that we don't get partial animations.
 *      public void paint(Graphics g) {
 *          if ((tracker.statusAll(false) &amp; MediaTracker.ERRORED) != 0) {
 *              g.setColor(Color.red);
 *              g.fillRect(0, 0, size().width, size().height);
 *              return;
 *          }
 *          g.drawImage(bg, 0, 0, this);
 *          if (tracker.statusID(1, false) == MediaTracker.COMPLETE) {
 *              g.drawImage(anim[index], 10, 10, this);
 *          }
 *      }
 * }
 * &lt;/pre&gt;&lt;/blockquote&gt;&lt;hr&gt;
 *
 * @author      Jim Graham
 * @since       JDK1.0
 */
public class MediaTracker implements java.io.Serializable {

    /**
     * A given &lt;code&gt;Component&lt;/code&gt; that will be
     * tracked by a media tracker where the image will
     * eventually be drawn.
     *
     * @serial
     * @see #MediaTracker(Component)
     */
    Component target;
    /**
     * The head of the list of &lt;code&gt;Images&lt;/code&gt; that is being
     * tracked by the &lt;code&gt;MediaTracker&lt;/code&gt;.
     *
     * @serial
     * @see #addImage(Image, int)
     * @see #removeImage(Image)
     */
    MediaEntry head;

    /*
     * JDK 1.1 serialVersionUID
     */
    private static final long serialVersionUID = -483174189758638095L;

    /**
     * Creates a media tracker to track images for a given component.
     * @param     comp the component on which the images
     *                     will eventually be drawn
     */
<span class="nc" id="L199">    public MediaTracker(Component comp) {</span>
<span class="nc" id="L200">        target = comp;</span>
<span class="nc" id="L201">    }</span>

    /**
     * Adds an image to the list of images being tracked by this media
     * tracker. The image will eventually be rendered at its default
     * (unscaled) size.
     * @param     image   the image to be tracked
     * @param     id      an identifier used to track this image
     */
    public void addImage(Image image, int id) {
<span class="nc" id="L211">        addImage(image, id, -1, -1);</span>
<span class="nc" id="L212">    }</span>

    /**
     * Adds a scaled image to the list of images being tracked
     * by this media tracker. The image will eventually be
     * rendered at the indicated width and height.
     *
     * @param     image   the image to be tracked
     * @param     id   an identifier that can be used to track this image
     * @param     w    the width at which the image is rendered
     * @param     h    the height at which the image is rendered
     */
    public synchronized void addImage(Image image, int id, int w, int h) {
<span class="nc" id="L225">        head = MediaEntry.insert(head,</span>
                                 new ImageMediaEntry(this, image, id, w, h));
<span class="nc" id="L227">    }</span>

    /**
     * Flag indicating that media is currently being loaded.
     * @see         java.awt.MediaTracker#statusAll
     * @see         java.awt.MediaTracker#statusID
     */
    public static final int LOADING = 1;

    /**
     * Flag indicating that the downloading of media was aborted.
     * @see         java.awt.MediaTracker#statusAll
     * @see         java.awt.MediaTracker#statusID
     */
    public static final int ABORTED = 2;

    /**
     * Flag indicating that the downloading of media encountered
     * an error.
     * @see         java.awt.MediaTracker#statusAll
     * @see         java.awt.MediaTracker#statusID
     */
    public static final int ERRORED = 4;

    /**
     * Flag indicating that the downloading of media was completed
     * successfully.
     * @see         java.awt.MediaTracker#statusAll
     * @see         java.awt.MediaTracker#statusID
     */
    public static final int COMPLETE = 8;

    static final int DONE = (ABORTED | ERRORED | COMPLETE);

    /**
     * Checks to see if all images being tracked by this media tracker
     * have finished loading.
     * &lt;p&gt;
     * This method does not start loading the images if they are not
     * already loading.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; or &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @return      &lt;code&gt;true&lt;/code&gt; if all images have finished loading,
     *                       have been aborted, or have encountered
     *                       an error; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see         java.awt.MediaTracker#checkAll(boolean)
     * @see         java.awt.MediaTracker#checkID
     * @see         java.awt.MediaTracker#isErrorAny
     * @see         java.awt.MediaTracker#isErrorID
     */
    public boolean checkAll() {
<span class="nc" id="L281">        return checkAll(false, true);</span>
    }

    /**
     * Checks to see if all images being tracked by this media tracker
     * have finished loading.
     * &lt;p&gt;
     * If the value of the &lt;code&gt;load&lt;/code&gt; flag is &lt;code&gt;true&lt;/code&gt;,
     * then this method starts loading any images that are not yet
     * being loaded.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; and &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @param       load   if &lt;code&gt;true&lt;/code&gt;, start loading any
     *                       images that are not yet being loaded
     * @return      &lt;code&gt;true&lt;/code&gt; if all images have finished loading,
     *                       have been aborted, or have encountered
     *                       an error; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see         java.awt.MediaTracker#checkID
     * @see         java.awt.MediaTracker#checkAll()
     * @see         java.awt.MediaTracker#isErrorAny()
     * @see         java.awt.MediaTracker#isErrorID(int)
     */
    public boolean checkAll(boolean load) {
<span class="nc" id="L307">        return checkAll(load, true);</span>
    }

    private synchronized boolean checkAll(boolean load, boolean verify) {
<span class="nc" id="L311">        MediaEntry cur = head;</span>
<span class="nc" id="L312">        boolean done = true;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">            if ((cur.getStatus(load, verify) &amp; DONE) == 0) {</span>
<span class="nc" id="L315">                done = false;</span>
            }
<span class="nc" id="L317">            cur = cur.next;</span>
        }
<span class="nc" id="L319">        return done;</span>
    }

    /**
     * Checks the error status of all of the images.
     * @return   &lt;code&gt;true&lt;/code&gt; if any of the images tracked
     *                  by this media tracker had an error during
     *                  loading; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see      java.awt.MediaTracker#isErrorID
     * @see      java.awt.MediaTracker#getErrorsAny
     */
    public synchronized boolean isErrorAny() {
<span class="nc" id="L331">        MediaEntry cur = head;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">            if ((cur.getStatus(false, true) &amp; ERRORED) != 0) {</span>
<span class="nc" id="L334">                return true;</span>
            }
<span class="nc" id="L336">            cur = cur.next;</span>
        }
<span class="nc" id="L338">        return false;</span>
    }

    /**
     * Returns a list of all media that have encountered an error.
     * @return       an array of media objects tracked by this
     *                        media tracker that have encountered
     *                        an error, or &lt;code&gt;null&lt;/code&gt; if
     *                        there are none with errors
     * @see          java.awt.MediaTracker#isErrorAny
     * @see          java.awt.MediaTracker#getErrorsID
     */
    public synchronized Object[] getErrorsAny() {
<span class="nc" id="L351">        MediaEntry cur = head;</span>
<span class="nc" id="L352">        int numerrors = 0;</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">            if ((cur.getStatus(false, true) &amp; ERRORED) != 0) {</span>
<span class="nc" id="L355">                numerrors++;</span>
            }
<span class="nc" id="L357">            cur = cur.next;</span>
        }
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (numerrors == 0) {</span>
<span class="nc" id="L360">            return null;</span>
        }
<span class="nc" id="L362">        Object errors[] = new Object[numerrors];</span>
<span class="nc" id="L363">        cur = head;</span>
<span class="nc" id="L364">        numerrors = 0;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">            if ((cur.getStatus(false, false) &amp; ERRORED) != 0) {</span>
<span class="nc" id="L367">                errors[numerrors++] = cur.getMedia();</span>
            }
<span class="nc" id="L369">            cur = cur.next;</span>
        }
<span class="nc" id="L371">        return errors;</span>
    }

    /**
     * Starts loading all images tracked by this media tracker. This
     * method waits until all the images being tracked have finished
     * loading.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; or &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @see         java.awt.MediaTracker#waitForID(int)
     * @see         java.awt.MediaTracker#waitForAll(long)
     * @see         java.awt.MediaTracker#isErrorAny
     * @see         java.awt.MediaTracker#isErrorID
     * @exception   InterruptedException  if any thread has
     *                                     interrupted this thread
     */
    public void waitForAll() throws InterruptedException {
<span class="nc" id="L391">        waitForAll(0);</span>
<span class="nc" id="L392">    }</span>

    /**
     * Starts loading all images tracked by this media tracker. This
     * method waits until all the images being tracked have finished
     * loading, or until the length of time specified in milliseconds
     * by the &lt;code&gt;ms&lt;/code&gt; argument has passed.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then
     * that image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; or &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @param       ms       the number of milliseconds to wait
     *                       for the loading to complete
     * @return      &lt;code&gt;true&lt;/code&gt; if all images were successfully
     *                       loaded; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see         java.awt.MediaTracker#waitForID(int)
     * @see         java.awt.MediaTracker#waitForAll(long)
     * @see         java.awt.MediaTracker#isErrorAny
     * @see         java.awt.MediaTracker#isErrorID
     * @exception   InterruptedException  if any thread has
     *                                     interrupted this thread.
     */
    public synchronized boolean waitForAll(long ms)
        throws InterruptedException
    {
<span class="nc" id="L418">        long end = System.currentTimeMillis() + ms;</span>
<span class="nc" id="L419">        boolean first = true;</span>
        while (true) {
<span class="nc" id="L421">            int status = statusAll(first, first);</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">            if ((status &amp; LOADING) == 0) {</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">                return (status == COMPLETE);</span>
            }
<span class="nc" id="L425">            first = false;</span>
            long timeout;
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (ms == 0) {</span>
<span class="nc" id="L428">                timeout = 0;</span>
            } else {
<span class="nc" id="L430">                timeout = end - System.currentTimeMillis();</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">                if (timeout &lt;= 0) {</span>
<span class="nc" id="L432">                    return false;</span>
                }
            }
<span class="nc" id="L435">            wait(timeout);</span>
<span class="nc" id="L436">        }</span>
    }

    /**
     * Calculates and returns the bitwise inclusive &lt;b&gt;OR&lt;/b&gt; of the
     * status of all media that are tracked by this media tracker.
     * &lt;p&gt;
     * Possible flags defined by the
     * &lt;code&gt;MediaTracker&lt;/code&gt; class are &lt;code&gt;LOADING&lt;/code&gt;,
     * &lt;code&gt;ABORTED&lt;/code&gt;, &lt;code&gt;ERRORED&lt;/code&gt;, and
     * &lt;code&gt;COMPLETE&lt;/code&gt;. An image that hasn't started
     * loading has zero as its status.
     * &lt;p&gt;
     * If the value of &lt;code&gt;load&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;, then
     * this method starts loading any images that are not yet being loaded.
     *
     * @param        load   if &lt;code&gt;true&lt;/code&gt;, start loading
     *                            any images that are not yet being loaded
     * @return       the bitwise inclusive &lt;b&gt;OR&lt;/b&gt; of the status of
     *                            all of the media being tracked
     * @see          java.awt.MediaTracker#statusID(int, boolean)
     * @see          java.awt.MediaTracker#LOADING
     * @see          java.awt.MediaTracker#ABORTED
     * @see          java.awt.MediaTracker#ERRORED
     * @see          java.awt.MediaTracker#COMPLETE
     */
    public int statusAll(boolean load) {
<span class="nc" id="L463">        return statusAll(load, true);</span>
    }

    private synchronized int statusAll(boolean load, boolean verify) {
<span class="nc" id="L467">        MediaEntry cur = head;</span>
<span class="nc" id="L468">        int status = 0;</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc" id="L470">            status = status | cur.getStatus(load, verify);</span>
<span class="nc" id="L471">            cur = cur.next;</span>
        }
<span class="nc" id="L473">        return status;</span>
    }

    /**
     * Checks to see if all images tracked by this media tracker that
     * are tagged with the specified identifier have finished loading.
     * &lt;p&gt;
     * This method does not start loading the images if they are not
     * already loading.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; or &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @param       id   the identifier of the images to check
     * @return      &lt;code&gt;true&lt;/code&gt; if all images have finished loading,
     *                       have been aborted, or have encountered
     *                       an error; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see         java.awt.MediaTracker#checkID(int, boolean)
     * @see         java.awt.MediaTracker#checkAll()
     * @see         java.awt.MediaTracker#isErrorAny()
     * @see         java.awt.MediaTracker#isErrorID(int)
     */
    public boolean checkID(int id) {
<span class="nc" id="L497">        return checkID(id, false, true);</span>
    }

    /**
     * Checks to see if all images tracked by this media tracker that
     * are tagged with the specified identifier have finished loading.
     * &lt;p&gt;
     * If the value of the &lt;code&gt;load&lt;/code&gt; flag is &lt;code&gt;true&lt;/code&gt;,
     * then this method starts loading any images that are not yet
     * being loaded.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; or &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @param       id       the identifier of the images to check
     * @param       load     if &lt;code&gt;true&lt;/code&gt;, start loading any
     *                       images that are not yet being loaded
     * @return      &lt;code&gt;true&lt;/code&gt; if all images have finished loading,
     *                       have been aborted, or have encountered
     *                       an error; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see         java.awt.MediaTracker#checkID(int, boolean)
     * @see         java.awt.MediaTracker#checkAll()
     * @see         java.awt.MediaTracker#isErrorAny()
     * @see         java.awt.MediaTracker#isErrorID(int)
     */
    public boolean checkID(int id, boolean load) {
<span class="nc" id="L524">        return checkID(id, load, true);</span>
    }

    private synchronized boolean checkID(int id, boolean load, boolean verify)
    {
<span class="nc" id="L529">        MediaEntry cur = head;</span>
<span class="nc" id="L530">        boolean done = true;</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">            if (cur.getID() == id</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">                &amp;&amp; (cur.getStatus(load, verify) &amp; DONE) == 0)</span>
            {
<span class="nc" id="L535">                done = false;</span>
            }
<span class="nc" id="L537">            cur = cur.next;</span>
        }
<span class="nc" id="L539">        return done;</span>
    }

    /**
     * Checks the error status of all of the images tracked by this
     * media tracker with the specified identifier.
     * @param        id   the identifier of the images to check
     * @return       &lt;code&gt;true&lt;/code&gt; if any of the images with the
     *                          specified identifier had an error during
     *                          loading; &lt;code&gt;false&lt;/code&gt; otherwise
     * @see          java.awt.MediaTracker#isErrorAny
     * @see          java.awt.MediaTracker#getErrorsID
     */
    public synchronized boolean isErrorID(int id) {
<span class="nc" id="L553">        MediaEntry cur = head;</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">            if (cur.getID() == id</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">                &amp;&amp; (cur.getStatus(false, true) &amp; ERRORED) != 0)</span>
            {
<span class="nc" id="L558">                return true;</span>
            }
<span class="nc" id="L560">            cur = cur.next;</span>
        }
<span class="nc" id="L562">        return false;</span>
    }

    /**
     * Returns a list of media with the specified ID that
     * have encountered an error.
     * @param       id   the identifier of the images to check
     * @return      an array of media objects tracked by this media
     *                       tracker with the specified identifier
     *                       that have encountered an error, or
     *                       &lt;code&gt;null&lt;/code&gt; if there are none with errors
     * @see         java.awt.MediaTracker#isErrorID
     * @see         java.awt.MediaTracker#isErrorAny
     * @see         java.awt.MediaTracker#getErrorsAny
     */
    public synchronized Object[] getErrorsID(int id) {
<span class="nc" id="L578">        MediaEntry cur = head;</span>
<span class="nc" id="L579">        int numerrors = 0;</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">            if (cur.getID() == id</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">                &amp;&amp; (cur.getStatus(false, true) &amp; ERRORED) != 0)</span>
            {
<span class="nc" id="L584">                numerrors++;</span>
            }
<span class="nc" id="L586">            cur = cur.next;</span>
        }
<span class="nc bnc" id="L588" title="All 2 branches missed.">        if (numerrors == 0) {</span>
<span class="nc" id="L589">            return null;</span>
        }
<span class="nc" id="L591">        Object errors[] = new Object[numerrors];</span>
<span class="nc" id="L592">        cur = head;</span>
<span class="nc" id="L593">        numerrors = 0;</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">            if (cur.getID() == id</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">                &amp;&amp; (cur.getStatus(false, false) &amp; ERRORED) != 0)</span>
            {
<span class="nc" id="L598">                errors[numerrors++] = cur.getMedia();</span>
            }
<span class="nc" id="L600">            cur = cur.next;</span>
        }
<span class="nc" id="L602">        return errors;</span>
    }

    /**
     * Starts loading all images tracked by this media tracker with the
     * specified identifier. This method waits until all the images with
     * the specified identifier have finished loading.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;isErrorAny&lt;/code&gt; and &lt;code&gt;isErrorID&lt;/code&gt; methods to
     * check for errors.
     * @param         id   the identifier of the images to check
     * @see           java.awt.MediaTracker#waitForAll
     * @see           java.awt.MediaTracker#isErrorAny()
     * @see           java.awt.MediaTracker#isErrorID(int)
     * @exception     InterruptedException  if any thread has
     *                          interrupted this thread.
     */
    public void waitForID(int id) throws InterruptedException {
<span class="nc" id="L622">        waitForID(id, 0);</span>
<span class="nc" id="L623">    }</span>

    /**
     * Starts loading all images tracked by this media tracker with the
     * specified identifier. This method waits until all the images with
     * the specified identifier have finished loading, or until the
     * length of time specified in milliseconds by the &lt;code&gt;ms&lt;/code&gt;
     * argument has passed.
     * &lt;p&gt;
     * If there is an error while loading or scaling an image, then that
     * image is considered to have finished loading. Use the
     * &lt;code&gt;statusID&lt;/code&gt;, &lt;code&gt;isErrorID&lt;/code&gt;, and
     * &lt;code&gt;isErrorAny&lt;/code&gt; methods to check for errors.
     * @param         id   the identifier of the images to check
     * @param         ms   the length of time, in milliseconds, to wait
     *                           for the loading to complete
     * @see           java.awt.MediaTracker#waitForAll
     * @see           java.awt.MediaTracker#waitForID(int)
     * @see           java.awt.MediaTracker#statusID
     * @see           java.awt.MediaTracker#isErrorAny()
     * @see           java.awt.MediaTracker#isErrorID(int)
     * @exception     InterruptedException  if any thread has
     *                          interrupted this thread.
     */
    public synchronized boolean waitForID(int id, long ms)
        throws InterruptedException
    {
<span class="nc" id="L650">        long end = System.currentTimeMillis() + ms;</span>
<span class="nc" id="L651">        boolean first = true;</span>
        while (true) {
<span class="nc" id="L653">            int status = statusID(id, first, first);</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">            if ((status &amp; LOADING) == 0) {</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">                return (status == COMPLETE);</span>
            }
<span class="nc" id="L657">            first = false;</span>
            long timeout;
<span class="nc bnc" id="L659" title="All 2 branches missed.">            if (ms == 0) {</span>
<span class="nc" id="L660">                timeout = 0;</span>
            } else {
<span class="nc" id="L662">                timeout = end - System.currentTimeMillis();</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">                if (timeout &lt;= 0) {</span>
<span class="nc" id="L664">                    return false;</span>
                }
            }
<span class="nc" id="L667">            wait(timeout);</span>
<span class="nc" id="L668">        }</span>
    }

    /**
     * Calculates and returns the bitwise inclusive &lt;b&gt;OR&lt;/b&gt; of the
     * status of all media with the specified identifier that are
     * tracked by this media tracker.
     * &lt;p&gt;
     * Possible flags defined by the
     * &lt;code&gt;MediaTracker&lt;/code&gt; class are &lt;code&gt;LOADING&lt;/code&gt;,
     * &lt;code&gt;ABORTED&lt;/code&gt;, &lt;code&gt;ERRORED&lt;/code&gt;, and
     * &lt;code&gt;COMPLETE&lt;/code&gt;. An image that hasn't started
     * loading has zero as its status.
     * &lt;p&gt;
     * If the value of &lt;code&gt;load&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;, then
     * this method starts loading any images that are not yet being loaded.
     * @param        id   the identifier of the images to check
     * @param        load   if &lt;code&gt;true&lt;/code&gt;, start loading
     *                            any images that are not yet being loaded
     * @return       the bitwise inclusive &lt;b&gt;OR&lt;/b&gt; of the status of
     *                            all of the media with the specified
     *                            identifier that are being tracked
     * @see          java.awt.MediaTracker#statusAll(boolean)
     * @see          java.awt.MediaTracker#LOADING
     * @see          java.awt.MediaTracker#ABORTED
     * @see          java.awt.MediaTracker#ERRORED
     * @see          java.awt.MediaTracker#COMPLETE
     */
    public int statusID(int id, boolean load) {
<span class="nc" id="L697">        return statusID(id, load, true);</span>
    }

    private synchronized int statusID(int id, boolean load, boolean verify) {
<span class="nc" id="L701">        MediaEntry cur = head;</span>
<span class="nc" id="L702">        int status = 0;</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L704" title="All 2 branches missed.">            if (cur.getID() == id) {</span>
<span class="nc" id="L705">                status = status | cur.getStatus(load, verify);</span>
            }
<span class="nc" id="L707">            cur = cur.next;</span>
        }
<span class="nc" id="L709">        return status;</span>
    }

    /**
     * Removes the specified image from this media tracker.
     * All instances of the specified image are removed,
     * regardless of scale or ID.
     * @param   image     the image to be removed
     * @see     java.awt.MediaTracker#removeImage(java.awt.Image, int)
     * @see     java.awt.MediaTracker#removeImage(java.awt.Image, int, int, int)
     * @since   JDK1.1
     */
    public synchronized void removeImage(Image image) {
<span class="nc" id="L722">        MediaEntry cur = head;</span>
<span class="nc" id="L723">        MediaEntry prev = null;</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc" id="L725">            MediaEntry next = cur.next;</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">            if (cur.getMedia() == image) {</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">                if (prev == null) {</span>
<span class="nc" id="L728">                    head = next;</span>
                } else {
<span class="nc" id="L730">                    prev.next = next;</span>
                }
<span class="nc" id="L732">                cur.cancel();</span>
            } else {
<span class="nc" id="L734">                prev = cur;</span>
            }
<span class="nc" id="L736">            cur = next;</span>
<span class="nc" id="L737">        }</span>
<span class="nc" id="L738">        notifyAll();    // Notify in case remaining images are &quot;done&quot;.</span>
<span class="nc" id="L739">    }</span>

    /**
     * Removes the specified image from the specified tracking
     * ID of this media tracker.
     * All instances of &lt;code&gt;Image&lt;/code&gt; being tracked
     * under the specified ID are removed regardless of scale.
     * @param      image the image to be removed
     * @param      id the tracking ID from which to remove the image
     * @see        java.awt.MediaTracker#removeImage(java.awt.Image)
     * @see        java.awt.MediaTracker#removeImage(java.awt.Image, int, int, int)
     * @since      JDK1.1
     */
    public synchronized void removeImage(Image image, int id) {
<span class="nc" id="L753">        MediaEntry cur = head;</span>
<span class="nc" id="L754">        MediaEntry prev = null;</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc" id="L756">            MediaEntry next = cur.next;</span>
<span class="nc bnc" id="L757" title="All 4 branches missed.">            if (cur.getID() == id &amp;&amp; cur.getMedia() == image) {</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">                if (prev == null) {</span>
<span class="nc" id="L759">                    head = next;</span>
                } else {
<span class="nc" id="L761">                    prev.next = next;</span>
                }
<span class="nc" id="L763">                cur.cancel();</span>
            } else {
<span class="nc" id="L765">                prev = cur;</span>
            }
<span class="nc" id="L767">            cur = next;</span>
<span class="nc" id="L768">        }</span>
<span class="nc" id="L769">        notifyAll();    // Notify in case remaining images are &quot;done&quot;.</span>
<span class="nc" id="L770">    }</span>

    /**
     * Removes the specified image with the specified
     * width, height, and ID from this media tracker.
     * Only the specified instance (with any duplicates) is removed.
     * @param   image the image to be removed
     * @param   id the tracking ID from which to remove the image
     * @param   width the width to remove (-1 for unscaled)
     * @param   height the height to remove (-1 for unscaled)
     * @see     java.awt.MediaTracker#removeImage(java.awt.Image)
     * @see     java.awt.MediaTracker#removeImage(java.awt.Image, int)
     * @since   JDK1.1
     */
    public synchronized void removeImage(Image image, int id,
                                         int width, int height) {
<span class="nc" id="L786">        MediaEntry cur = head;</span>
<span class="nc" id="L787">        MediaEntry prev = null;</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc" id="L789">            MediaEntry next = cur.next;</span>
<span class="nc bnc" id="L790" title="All 4 branches missed.">            if (cur.getID() == id &amp;&amp; cur instanceof ImageMediaEntry</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">                &amp;&amp; ((ImageMediaEntry) cur).matches(image, width, height))</span>
            {
<span class="nc bnc" id="L793" title="All 2 branches missed.">                if (prev == null) {</span>
<span class="nc" id="L794">                    head = next;</span>
                } else {
<span class="nc" id="L796">                    prev.next = next;</span>
                }
<span class="nc" id="L798">                cur.cancel();</span>
            } else {
<span class="nc" id="L800">                prev = cur;</span>
            }
<span class="nc" id="L802">            cur = next;</span>
<span class="nc" id="L803">        }</span>
<span class="nc" id="L804">        notifyAll();    // Notify in case remaining images are &quot;done&quot;.</span>
<span class="nc" id="L805">    }</span>

    synchronized void setDone() {
<span class="nc" id="L808">        notifyAll();</span>
<span class="nc" id="L809">    }</span>
}

abstract class MediaEntry {
    MediaTracker tracker;
    int ID;
    MediaEntry next;

    int status;
    boolean cancelled;

<span class="nc" id="L820">    MediaEntry(MediaTracker mt, int id) {</span>
<span class="nc" id="L821">        tracker = mt;</span>
<span class="nc" id="L822">        ID = id;</span>
<span class="nc" id="L823">    }</span>

    abstract Object getMedia();

    static MediaEntry insert(MediaEntry head, MediaEntry me) {
<span class="nc" id="L828">        MediaEntry cur = head;</span>
<span class="nc" id="L829">        MediaEntry prev = null;</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">        while (cur != null) {</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">            if (cur.ID &gt; me.ID) {</span>
<span class="nc" id="L832">                break;</span>
            }
<span class="nc" id="L834">            prev = cur;</span>
<span class="nc" id="L835">            cur = cur.next;</span>
        }
<span class="nc" id="L837">        me.next = cur;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">        if (prev == null) {</span>
<span class="nc" id="L839">            head = me;</span>
        } else {
<span class="nc" id="L841">            prev.next = me;</span>
        }
<span class="nc" id="L843">        return head;</span>
    }

    int getID() {
<span class="nc" id="L847">        return ID;</span>
    }

    abstract void startLoad();

    void cancel() {
<span class="nc" id="L853">        cancelled = true;</span>
<span class="nc" id="L854">    }</span>

    static final int LOADING = MediaTracker.LOADING;
    static final int ABORTED = MediaTracker.ABORTED;
    static final int ERRORED = MediaTracker.ERRORED;
    static final int COMPLETE = MediaTracker.COMPLETE;

    static final int LOADSTARTED = (LOADING | ERRORED | COMPLETE);
    static final int DONE = (ABORTED | ERRORED | COMPLETE);

    synchronized int getStatus(boolean doLoad, boolean doVerify) {
<span class="nc bnc" id="L865" title="All 4 branches missed.">        if (doLoad &amp;&amp; ((status &amp; LOADSTARTED) == 0)) {</span>
<span class="nc" id="L866">            status = (status &amp; ~ABORTED) | LOADING;</span>
<span class="nc" id="L867">            startLoad();</span>
        }
<span class="nc" id="L869">        return status;</span>
    }

    void setStatus(int flag) {
<span class="nc" id="L873">        synchronized (this) {</span>
<span class="nc" id="L874">            status = flag;</span>
<span class="nc" id="L875">        }</span>
<span class="nc" id="L876">        tracker.setDone();</span>
<span class="nc" id="L877">    }</span>
}

class ImageMediaEntry extends MediaEntry implements ImageObserver,
java.io.Serializable {
    Image image;
    int width;
    int height;

    /*
     * JDK 1.1 serialVersionUID
     */
    private static final long serialVersionUID = 4739377000350280650L;

    ImageMediaEntry(MediaTracker mt, Image img, int c, int w, int h) {
<span class="nc" id="L892">        super(mt, c);</span>
<span class="nc" id="L893">        image = img;</span>
<span class="nc" id="L894">        width = w;</span>
<span class="nc" id="L895">        height = h;</span>
<span class="nc" id="L896">    }</span>

    boolean matches(Image img, int w, int h) {
<span class="nc bnc" id="L899" title="All 6 branches missed.">        return (image == img &amp;&amp; width == w &amp;&amp; height == h);</span>
    }

    Object getMedia() {
<span class="nc" id="L903">        return image;</span>
    }

    synchronized int getStatus(boolean doLoad, boolean doVerify) {
<span class="nc bnc" id="L907" title="All 2 branches missed.">        if (doVerify) {</span>
<span class="nc" id="L908">            int flags = tracker.target.checkImage(image, width, height, null);</span>
<span class="nc" id="L909">            int s = parseflags(flags);</span>
<span class="nc bnc" id="L910" title="All 2 branches missed.">            if (s == 0) {</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">                if ((status &amp; (ERRORED | COMPLETE)) != 0) {</span>
<span class="nc" id="L912">                    setStatus(ABORTED);</span>
                }
<span class="nc bnc" id="L914" title="All 2 branches missed.">            } else if (s != status) {</span>
<span class="nc" id="L915">                setStatus(s);</span>
            }
        }
<span class="nc" id="L918">        return super.getStatus(doLoad, doVerify);</span>
    }

    void startLoad() {
<span class="nc bnc" id="L922" title="All 2 branches missed.">        if (tracker.target.prepareImage(image, width, height, this)) {</span>
<span class="nc" id="L923">            setStatus(COMPLETE);</span>
        }
<span class="nc" id="L925">    }</span>

    int parseflags(int infoflags) {
<span class="nc bnc" id="L928" title="All 2 branches missed.">        if ((infoflags &amp; ERROR) != 0) {</span>
<span class="nc" id="L929">            return ERRORED;</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">        } else if ((infoflags &amp; ABORT) != 0) {</span>
<span class="nc" id="L931">            return ABORTED;</span>
<span class="nc bnc" id="L932" title="All 2 branches missed.">        } else if ((infoflags &amp; (ALLBITS | FRAMEBITS)) != 0) {</span>
<span class="nc" id="L933">            return COMPLETE;</span>
        }
<span class="nc" id="L935">        return 0;</span>
    }

    public boolean imageUpdate(Image img, int infoflags,
                               int x, int y, int w, int h) {
<span class="nc bnc" id="L940" title="All 2 branches missed.">        if (cancelled) {</span>
<span class="nc" id="L941">            return false;</span>
        }
<span class="nc" id="L943">        int s = parseflags(infoflags);</span>
<span class="nc bnc" id="L944" title="All 4 branches missed.">        if (s != 0 &amp;&amp; s != status) {</span>
<span class="nc" id="L945">            setStatus(s);</span>
        }
<span class="nc bnc" id="L947" title="All 2 branches missed.">        return ((status &amp; LOADING) != 0);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>