<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MenuBar.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">java.awt</a> &gt; <span class="el_source">MenuBar.java</span></div><h1>MenuBar.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1995, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package java.awt;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.util.Vector;
import java.util.Enumeration;
import sun.awt.AWTAccessor;
import java.awt.peer.MenuBarPeer;
import java.awt.event.KeyEvent;
import javax.accessibility.*;

/**
 * The &lt;code&gt;MenuBar&lt;/code&gt; class encapsulates the platform's
 * concept of a menu bar bound to a frame. In order to associate
 * the menu bar with a &lt;code&gt;Frame&lt;/code&gt; object, call the
 * frame's &lt;code&gt;setMenuBar&lt;/code&gt; method.
 * &lt;p&gt;
 * &lt;A NAME=&quot;mbexample&quot;&gt;&lt;/A&gt;&lt;!-- target for cross references --&gt;
 * This is what a menu bar might look like:
 * &lt;p&gt;
 * &lt;img src=&quot;doc-files/MenuBar-1.gif&quot;
 * alt=&quot;Diagram of MenuBar containing 2 menus: Examples and Options.
 * Examples menu is expanded showing items: Basic, Simple, Check, and More Examples.&quot;
 * style=&quot;float:center; margin: 7px 10px;&quot;&gt;
 * &lt;p&gt;
 * A menu bar handles keyboard shortcuts for menu items, passing them
 * along to its child menus.
 * (Keyboard shortcuts, which are optional, provide the user with
 * an alternative to the mouse for invoking a menu item and the
 * action that is associated with it.)
 * Each menu item can maintain an instance of &lt;code&gt;MenuShortcut&lt;/code&gt;.
 * The &lt;code&gt;MenuBar&lt;/code&gt; class defines several methods,
 * {@link MenuBar#shortcuts} and
 * {@link MenuBar#getShortcutMenuItem}
 * that retrieve information about the shortcuts a given
 * menu bar is managing.
 *
 * @author Sami Shaio
 * @see        java.awt.Frame
 * @see        java.awt.Frame#setMenuBar(java.awt.MenuBar)
 * @see        java.awt.Menu
 * @see        java.awt.MenuItem
 * @see        java.awt.MenuShortcut
 * @since      JDK1.0
 */
public class MenuBar extends MenuComponent implements MenuContainer, Accessible {

    static {
        /* ensure that the necessary native libraries are loaded */
<span class="nc" id="L74">        Toolkit.loadLibraries();</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">        if (!GraphicsEnvironment.isHeadless()) {</span>
<span class="nc" id="L76">            initIDs();</span>
        }
<span class="nc" id="L78">        AWTAccessor.setMenuBarAccessor(</span>
<span class="nc" id="L79">            new AWTAccessor.MenuBarAccessor() {</span>
                public Menu getHelpMenu(MenuBar menuBar) {
<span class="nc" id="L81">                    return menuBar.helpMenu;</span>
                }

                public Vector&lt;Menu&gt; getMenus(MenuBar menuBar) {
<span class="nc" id="L85">                    return menuBar.menus;</span>
                }
            });
    }

    /**
     * This field represents a vector of the
     * actual menus that will be part of the MenuBar.
     *
     * @serial
     * @see #countMenus()
     */
<span class="nc" id="L97">    Vector&lt;Menu&gt; menus = new Vector&lt;&gt;();</span>

    /**
     * This menu is a special menu dedicated to
     * help.  The one thing to note about this menu
     * is that on some platforms it appears at the
     * right edge of the menubar.
     *
     * @serial
     * @see #getHelpMenu()
     * @see #setHelpMenu(Menu)
     */
    Menu helpMenu;

    private static final String base = &quot;menubar&quot;;
<span class="nc" id="L112">    private static int nameCounter = 0;</span>

    /*
     * JDK 1.1 serialVersionUID
     */
     private static final long serialVersionUID = -4930327919388951260L;

    /**
     * Creates a new menu bar.
     * @exception HeadlessException if GraphicsEnvironment.isHeadless()
     * returns true.
     * @see java.awt.GraphicsEnvironment#isHeadless
     */
<span class="nc" id="L125">    public MenuBar() throws HeadlessException {</span>
<span class="nc" id="L126">    }</span>

    /**
     * Construct a name for this MenuComponent.  Called by getName() when
     * the name is null.
     */
    String constructComponentName() {
<span class="nc" id="L133">        synchronized (MenuBar.class) {</span>
<span class="nc" id="L134">            return base + nameCounter++;</span>
<span class="nc" id="L135">        }</span>
    }

    /**
     * Creates the menu bar's peer.  The peer allows us to change the
     * appearance of the menu bar without changing any of the menu bar's
     * functionality.
     */
    public void addNotify() {
<span class="nc" id="L144">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            if (peer == null)</span>
<span class="nc" id="L146">                peer = Toolkit.getDefaultToolkit().createMenuBar(this);</span>

<span class="nc" id="L148">            int nmenus = getMenuCount();</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">            for (int i = 0 ; i &lt; nmenus ; i++) {</span>
<span class="nc" id="L150">                getMenu(i).addNotify();</span>
            }
<span class="nc" id="L152">        }</span>
<span class="nc" id="L153">    }</span>

    /**
     * Removes the menu bar's peer.  The peer allows us to change the
     * appearance of the menu bar without changing any of the menu bar's
     * functionality.
     */
    public void removeNotify() {
<span class="nc" id="L161">        synchronized (getTreeLock()) {</span>
<span class="nc" id="L162">            int nmenus = getMenuCount();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            for (int i = 0 ; i &lt; nmenus ; i++) {</span>
<span class="nc" id="L164">                getMenu(i).removeNotify();</span>
            }
<span class="nc" id="L166">            super.removeNotify();</span>
<span class="nc" id="L167">        }</span>
<span class="nc" id="L168">    }</span>

    /**
     * Gets the help menu on the menu bar.
     * @return    the help menu on this menu bar.
     */
    public Menu getHelpMenu() {
<span class="nc" id="L175">        return helpMenu;</span>
    }

    /**
     * Sets the specified menu to be this menu bar's help menu.
     * If this menu bar has an existing help menu, the old help menu is
     * removed from the menu bar, and replaced with the specified menu.
     * @param m    the menu to be set as the help menu
     */
    public void setHelpMenu(Menu m) {
<span class="nc" id="L185">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (helpMenu == m) {</span>
<span class="nc" id="L187">                return;</span>
            }
<span class="nc bnc" id="L189" title="All 2 branches missed.">            if (helpMenu != null) {</span>
<span class="nc" id="L190">                remove(helpMenu);</span>
            }
<span class="nc bnc" id="L192" title="All 2 branches missed.">            if (m.parent != this) {</span>
<span class="nc" id="L193">                add(m);</span>
            }
<span class="nc" id="L195">            helpMenu = m;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if (m != null) {</span>
<span class="nc" id="L197">                m.isHelpMenu = true;</span>
<span class="nc" id="L198">                m.parent = this;</span>
<span class="nc" id="L199">                MenuBarPeer peer = (MenuBarPeer)this.peer;</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">                if (peer != null) {</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                    if (m.peer == null) {</span>
<span class="nc" id="L202">                        m.addNotify();</span>
                    }
<span class="nc" id="L204">                    peer.addHelpMenu(m);</span>
                }
            }
<span class="nc" id="L207">        }</span>
<span class="nc" id="L208">    }</span>

    /**
     * Adds the specified menu to the menu bar.
     * If the menu has been part of another menu bar,
     * removes it from that menu bar.
     *
     * @param        m   the menu to be added
     * @return       the menu added
     * @see          java.awt.MenuBar#remove(int)
     * @see          java.awt.MenuBar#remove(java.awt.MenuComponent)
     */
    public Menu add(Menu m) {
<span class="nc" id="L221">        synchronized (getTreeLock()) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">            if (m.parent != null) {</span>
<span class="nc" id="L223">                m.parent.remove(m);</span>
            }
<span class="nc" id="L225">            menus.addElement(m);</span>
<span class="nc" id="L226">            m.parent = this;</span>

<span class="nc" id="L228">            MenuBarPeer peer = (MenuBarPeer)this.peer;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            if (peer != null) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                if (m.peer == null) {</span>
<span class="nc" id="L231">                    m.addNotify();</span>
                }
<span class="nc" id="L233">                peer.addMenu(m);</span>
            }
<span class="nc" id="L235">            return m;</span>
<span class="nc" id="L236">        }</span>
    }

    /**
     * Removes the menu located at the specified
     * index from this menu bar.
     * @param        index   the position of the menu to be removed.
     * @see          java.awt.MenuBar#add(java.awt.Menu)
     */
    public void remove(int index) {
<span class="nc" id="L246">        synchronized (getTreeLock()) {</span>
<span class="nc" id="L247">            Menu m = getMenu(index);</span>
<span class="nc" id="L248">            menus.removeElementAt(index);</span>
<span class="nc" id="L249">            MenuBarPeer peer = (MenuBarPeer)this.peer;</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if (peer != null) {</span>
<span class="nc" id="L251">                m.removeNotify();</span>
<span class="nc" id="L252">                m.parent = null;</span>
<span class="nc" id="L253">                peer.delMenu(index);</span>
            }
<span class="nc" id="L255">        }</span>
<span class="nc" id="L256">    }</span>

    /**
     * Removes the specified menu component from this menu bar.
     * @param        m the menu component to be removed.
     * @see          java.awt.MenuBar#add(java.awt.Menu)
     */
    public void remove(MenuComponent m) {
<span class="nc" id="L264">        synchronized (getTreeLock()) {</span>
<span class="nc" id="L265">            int index = menus.indexOf(m);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">            if (index &gt;= 0) {</span>
<span class="nc" id="L267">                remove(index);</span>
            }
<span class="nc" id="L269">        }</span>
<span class="nc" id="L270">    }</span>

    /**
     * Gets the number of menus on the menu bar.
     * @return     the number of menus on the menu bar.
     * @since      JDK1.1
     */
    public int getMenuCount() {
<span class="nc" id="L278">        return countMenus();</span>
    }

    /**
     * @deprecated As of JDK version 1.1,
     * replaced by &lt;code&gt;getMenuCount()&lt;/code&gt;.
     */
    @Deprecated
    public int countMenus() {
<span class="nc" id="L287">        return getMenuCountImpl();</span>
    }

    /*
     * This is called by the native code, so client code can't
     * be called on the toolkit thread.
     */
    final int getMenuCountImpl() {
<span class="nc" id="L295">        return menus.size();</span>
    }

    /**
     * Gets the specified menu.
     * @param      i the index position of the menu to be returned.
     * @return     the menu at the specified index of this menu bar.
     */
    public Menu getMenu(int i) {
<span class="nc" id="L304">        return getMenuImpl(i);</span>
    }

    /*
     * This is called by the native code, so client code can't
     * be called on the toolkit thread.
     */
    final Menu getMenuImpl(int i) {
<span class="nc" id="L312">        return menus.elementAt(i);</span>
    }

    /**
     * Gets an enumeration of all menu shortcuts this menu bar
     * is managing.
     * @return      an enumeration of menu shortcuts that this
     *                      menu bar is managing.
     * @see         java.awt.MenuShortcut
     * @since       JDK1.1
     */
    public synchronized Enumeration&lt;MenuShortcut&gt; shortcuts() {
<span class="nc" id="L324">        Vector&lt;MenuShortcut&gt; shortcuts = new Vector&lt;&gt;();</span>
<span class="nc" id="L325">        int nmenus = getMenuCount();</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">        for (int i = 0 ; i &lt; nmenus ; i++) {</span>
<span class="nc" id="L327">            Enumeration&lt;MenuShortcut&gt; e = getMenu(i).shortcuts();</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">            while (e.hasMoreElements()) {</span>
<span class="nc" id="L329">                shortcuts.addElement(e.nextElement());</span>
            }
        }
<span class="nc" id="L332">        return shortcuts.elements();</span>
    }

    /**
     * Gets the instance of &lt;code&gt;MenuItem&lt;/code&gt; associated
     * with the specified &lt;code&gt;MenuShortcut&lt;/code&gt; object,
     * or &lt;code&gt;null&lt;/code&gt; if none of the menu items being managed
     * by this menu bar is associated with the specified menu
     * shortcut.
     * @param        s the specified menu shortcut.
     * @see          java.awt.MenuItem
     * @see          java.awt.MenuShortcut
     * @since        JDK1.1
     */
     public MenuItem getShortcutMenuItem(MenuShortcut s) {
<span class="nc" id="L347">        int nmenus = getMenuCount();</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">        for (int i = 0 ; i &lt; nmenus ; i++) {</span>
<span class="nc" id="L349">            MenuItem mi = getMenu(i).getShortcutMenuItem(s);</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">            if (mi != null) {</span>
<span class="nc" id="L351">                return mi;</span>
            }
        }
<span class="nc" id="L354">        return null;  // MenuShortcut wasn't found</span>
     }

    /*
     * Post an ACTION_EVENT to the target of the MenuPeer
     * associated with the specified keyboard event (on
     * keydown).  Returns true if there is an associated
     * keyboard event.
     */
    boolean handleShortcut(KeyEvent e) {
        // Is it a key event?
<span class="nc" id="L365">        int id = e.getID();</span>
<span class="nc bnc" id="L366" title="All 4 branches missed.">        if (id != KeyEvent.KEY_PRESSED &amp;&amp; id != KeyEvent.KEY_RELEASED) {</span>
<span class="nc" id="L367">            return false;</span>
        }

        // Is the accelerator modifier key pressed?
<span class="nc" id="L371">        int accelKey = Toolkit.getDefaultToolkit().getMenuShortcutKeyMask();</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if ((e.getModifiers() &amp; accelKey) == 0) {</span>
<span class="nc" id="L373">            return false;</span>
        }

        // Pass MenuShortcut on to child menus.
<span class="nc" id="L377">        int nmenus = getMenuCount();</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">        for (int i = 0 ; i &lt; nmenus ; i++) {</span>
<span class="nc" id="L379">            Menu m = getMenu(i);</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">            if (m.handleShortcut(e)) {</span>
<span class="nc" id="L381">                return true;</span>
            }
        }
<span class="nc" id="L384">        return false;</span>
    }

    /**
     * Deletes the specified menu shortcut.
     * @param     s the menu shortcut to delete.
     * @since     JDK1.1
     */
    public void deleteShortcut(MenuShortcut s) {
<span class="nc" id="L393">        int nmenus = getMenuCount();</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">        for (int i = 0 ; i &lt; nmenus ; i++) {</span>
<span class="nc" id="L395">            getMenu(i).deleteShortcut(s);</span>
        }
<span class="nc" id="L397">    }</span>

    /* Serialization support.  Restore the (transient) parent
     * fields of Menubar menus here.
     */

    /**
     * The MenuBar's serialized data version.
     *
     * @serial
     */
<span class="nc" id="L408">    private int menuBarSerializedDataVersion = 1;</span>

    /**
     * Writes default serializable fields to stream.
     *
     * @param s the &lt;code&gt;ObjectOutputStream&lt;/code&gt; to write
     * @see AWTEventMulticaster#save(ObjectOutputStream, String, EventListener)
     * @see #readObject(java.io.ObjectInputStream)
     */
    private void writeObject(java.io.ObjectOutputStream s)
      throws java.lang.ClassNotFoundException,
             java.io.IOException
    {
<span class="nc" id="L421">      s.defaultWriteObject();</span>
<span class="nc" id="L422">    }</span>

    /**
     * Reads the &lt;code&gt;ObjectInputStream&lt;/code&gt;.
     * Unrecognized keys or values will be ignored.
     *
     * @param s the &lt;code&gt;ObjectInputStream&lt;/code&gt; to read
     * @exception HeadlessException if
     *   &lt;code&gt;GraphicsEnvironment.isHeadless&lt;/code&gt; returns
     *   &lt;code&gt;true&lt;/code&gt;
     * @see java.awt.GraphicsEnvironment#isHeadless
     * @see #writeObject(java.io.ObjectOutputStream)
     */
    private void readObject(ObjectInputStream s)
      throws ClassNotFoundException, IOException, HeadlessException
    {
      // HeadlessException will be thrown from MenuComponent's readObject
<span class="nc" id="L439">      s.defaultReadObject();</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">      for (int i = 0; i &lt; menus.size(); i++) {</span>
<span class="nc" id="L441">        Menu m = menus.elementAt(i);</span>
<span class="nc" id="L442">        m.parent = this;</span>
      }
<span class="nc" id="L444">    }</span>

    /**
     * Initialize JNI field and method IDs
     */
    private static native void initIDs();


/////////////////
// Accessibility support
////////////////

    /**
     * Gets the AccessibleContext associated with this MenuBar.
     * For menu bars, the AccessibleContext takes the form of an
     * AccessibleAWTMenuBar.
     * A new AccessibleAWTMenuBar instance is created if necessary.
     *
     * @return an AccessibleAWTMenuBar that serves as the
     *         AccessibleContext of this MenuBar
     * @since 1.3
     */
    public AccessibleContext getAccessibleContext() {
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (accessibleContext == null) {</span>
<span class="nc" id="L468">            accessibleContext = new AccessibleAWTMenuBar();</span>
        }
<span class="nc" id="L470">        return accessibleContext;</span>
    }

    /**
     * Defined in MenuComponent. Overridden here.
     */
    int getAccessibleChildIndex(MenuComponent child) {
<span class="nc" id="L477">        return menus.indexOf(child);</span>
    }

    /**
     * Inner class of MenuBar used to provide default support for
     * accessibility.  This class is not meant to be used directly by
     * application developers, but is instead meant only to be
     * subclassed by menu component developers.
     * &lt;p&gt;
     * This class implements accessibility support for the
     * &lt;code&gt;MenuBar&lt;/code&gt; class.  It provides an implementation of the
     * Java Accessibility API appropriate to menu bar user-interface elements.
     * @since 1.3
     */
<span class="nc" id="L491">    protected class AccessibleAWTMenuBar extends AccessibleAWTMenuComponent</span>
    {
        /*
         * JDK 1.3 serialVersionUID
         */
        private static final long serialVersionUID = -8577604491830083815L;

        /**
         * Get the role of this object.
         *
         * @return an instance of AccessibleRole describing the role of the
         * object
         * @since 1.4
         */
        public AccessibleRole getAccessibleRole() {
<span class="nc" id="L506">            return AccessibleRole.MENU_BAR;</span>
        }

    } // class AccessibleAWTMenuBar

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>