<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WindowsComboBoxUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.windows</a> &gt; <span class="el_source">WindowsComboBoxUI.java</span></div><h1>WindowsComboBoxUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.java.swing.plaf.windows;

import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeEvent;
import javax.swing.plaf.basic.*;
import javax.swing.plaf.*;
import javax.swing.border.*;
import javax.swing.*;
import java.awt.event.*;
import java.awt.*;

import static com.sun.java.swing.plaf.windows.TMSchema.Part;
import static com.sun.java.swing.plaf.windows.TMSchema.State;
import static com.sun.java.swing.plaf.windows.XPStyle.Skin;
import sun.swing.DefaultLookup;
import sun.swing.StringUIClientPropertyKey;


/**
 * Windows combo box.
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases.  The current serialization support is appropriate
 * for short term storage or RMI between applications running the same
 * version of Swing.  A future release of Swing will provide support for
 * long term persistence.
 *
 * @author Tom Santos
 * @author Igor Kushnirskiy
 */

<span class="nc" id="L58">public class WindowsComboBoxUI extends BasicComboBoxUI {</span>

<span class="nc" id="L60">    private static final MouseListener rolloverListener =</span>
<span class="nc" id="L61">        new MouseAdapter() {</span>
            private void handleRollover(MouseEvent e, boolean isRollover) {
<span class="nc" id="L63">                JComboBox comboBox = getComboBox(e);</span>
<span class="nc" id="L64">                WindowsComboBoxUI comboBoxUI = getWindowsComboBoxUI(e);</span>
<span class="nc bnc" id="L65" title="All 4 branches missed.">                if (comboBox == null || comboBoxUI == null) {</span>
<span class="nc" id="L66">                    return;</span>
                }
<span class="nc bnc" id="L68" title="All 2 branches missed.">                if (! comboBox.isEditable()) {</span>
                    //mouse over editable ComboBox does not switch rollover
                    //for the arrow button
<span class="nc" id="L71">                    ButtonModel m = null;</span>
<span class="nc bnc" id="L72" title="All 2 branches missed.">                    if (comboBoxUI.arrowButton != null) {</span>
<span class="nc" id="L73">                        m = comboBoxUI.arrowButton.getModel();</span>
                    }
<span class="nc bnc" id="L75" title="All 2 branches missed.">                    if (m != null ) {</span>
<span class="nc" id="L76">                        m.setRollover(isRollover);</span>
                    }
                }
<span class="nc" id="L79">                comboBoxUI.isRollover = isRollover;</span>
<span class="nc" id="L80">                comboBox.repaint();</span>
<span class="nc" id="L81">            }</span>

            public void mouseEntered(MouseEvent e) {
<span class="nc" id="L84">                handleRollover(e, true);</span>
<span class="nc" id="L85">            }</span>

            public void mouseExited(MouseEvent e) {
<span class="nc" id="L88">                handleRollover(e, false);</span>
<span class="nc" id="L89">            }</span>

            private JComboBox getComboBox(MouseEvent event) {
<span class="nc" id="L92">                Object source = event.getSource();</span>
<span class="nc" id="L93">                JComboBox rv = null;</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">                if (source instanceof JComboBox) {</span>
<span class="nc" id="L95">                    rv = (JComboBox) source;</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">                } else if (source instanceof XPComboBoxButton) {</span>
<span class="nc" id="L97">                    rv = ((XPComboBoxButton) source)</span>
<span class="nc" id="L98">                        .getWindowsComboBoxUI().comboBox;</span>
                }
<span class="nc" id="L100">                return rv;</span>
            }

            private WindowsComboBoxUI getWindowsComboBoxUI(MouseEvent event) {
<span class="nc" id="L104">                JComboBox comboBox = getComboBox(event);</span>
<span class="nc" id="L105">                WindowsComboBoxUI rv = null;</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">                if (comboBox != null</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">                    &amp;&amp; comboBox.getUI() instanceof WindowsComboBoxUI) {</span>
<span class="nc" id="L108">                    rv = (WindowsComboBoxUI) comboBox.getUI();</span>
                }
<span class="nc" id="L110">                return rv;</span>
            }

        };
<span class="nc" id="L114">    private boolean isRollover = false;</span>

<span class="nc" id="L116">    private static final PropertyChangeListener componentOrientationListener =</span>
<span class="nc" id="L117">        new PropertyChangeListener() {</span>
            public void propertyChange(PropertyChangeEvent e) {
<span class="nc" id="L119">                String propertyName = e.getPropertyName();</span>
<span class="nc" id="L120">                Object source = null;</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">                if (&quot;componentOrientation&quot; == propertyName</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">                    &amp;&amp; (source = e.getSource()) instanceof JComboBox</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">                    &amp;&amp; ((JComboBox) source).getUI() instanceof</span>
                      WindowsComboBoxUI) {
<span class="nc" id="L125">                    JComboBox comboBox = (JComboBox) source;</span>
<span class="nc" id="L126">                    WindowsComboBoxUI comboBoxUI = (WindowsComboBoxUI) comboBox.getUI();</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">                    if (comboBoxUI.arrowButton instanceof XPComboBoxButton) {</span>
<span class="nc" id="L128">                        ((XPComboBoxButton) comboBoxUI.arrowButton).setPart(</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">                                    (comboBox.getComponentOrientation() ==</span>
                                       ComponentOrientation.RIGHT_TO_LEFT)
                                    ? Part.CP_DROPDOWNBUTTONLEFT
                                    : Part.CP_DROPDOWNBUTTONRIGHT);
                            }
                        }
<span class="nc" id="L135">                    }</span>
                };

    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L139">        return new WindowsComboBoxUI();</span>
    }

    public void installUI( JComponent c ) {
<span class="nc" id="L143">        super.installUI( c );</span>
<span class="nc" id="L144">        isRollover = false;</span>
<span class="nc" id="L145">        comboBox.setRequestFocusEnabled( true );</span>
<span class="nc bnc" id="L146" title="All 4 branches missed.">        if (XPStyle.getXP() != null &amp;&amp; arrowButton != null) {</span>
            //we can not do it in installListeners because arrowButton
            //is initialized after installListeners is invoked
<span class="nc" id="L149">            comboBox.addMouseListener(rolloverListener);</span>
<span class="nc" id="L150">            arrowButton.addMouseListener(rolloverListener);</span>
        }
<span class="nc" id="L152">    }</span>

    public void uninstallUI(JComponent c ) {
<span class="nc" id="L155">        comboBox.removeMouseListener(rolloverListener);</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if(arrowButton != null) {</span>
<span class="nc" id="L157">            arrowButton.removeMouseListener(rolloverListener);</span>
        }
<span class="nc" id="L159">        super.uninstallUI( c );</span>
<span class="nc" id="L160">    }</span>

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    @Override
    protected void installListeners() {
<span class="nc" id="L168">        super.installListeners();</span>
<span class="nc" id="L169">        XPStyle xp = XPStyle.getXP();</span>
        //button glyph for LTR and RTL combobox might differ
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (xp != null</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">              &amp;&amp; xp.isSkinDefined(comboBox, Part.CP_DROPDOWNBUTTONRIGHT)) {</span>
<span class="nc" id="L173">            comboBox.addPropertyChangeListener(&quot;componentOrientation&quot;,</span>
                                               componentOrientationListener);
        }
<span class="nc" id="L176">    }</span>

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    @Override
    protected void uninstallListeners() {
<span class="nc" id="L184">        super.uninstallListeners();</span>
<span class="nc" id="L185">        comboBox.removePropertyChangeListener(&quot;componentOrientation&quot;,</span>
                                              componentOrientationListener);
<span class="nc" id="L187">    }</span>

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    protected void configureEditor() {
<span class="nc" id="L194">        super.configureEditor();</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L196">            editor.addMouseListener(rolloverListener);</span>
        }
<span class="nc" id="L198">    }</span>

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    protected void unconfigureEditor() {
<span class="nc" id="L205">        super.unconfigureEditor();</span>
<span class="nc" id="L206">        editor.removeMouseListener(rolloverListener);</span>
<span class="nc" id="L207">    }</span>

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    public void paint(Graphics g, JComponent c) {
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L215">            paintXPComboBoxBackground(g, c);</span>
        }
<span class="nc" id="L217">        super.paint(g, c);</span>
<span class="nc" id="L218">    }</span>

    State getXPComboBoxState(JComponent c) {
<span class="nc" id="L221">        State state = State.NORMAL;</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">        if (!c.isEnabled()) {</span>
<span class="nc" id="L223">            state = State.DISABLED;</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">        } else if (isPopupVisible(comboBox)) {</span>
<span class="nc" id="L225">            state = State.PRESSED;</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">        } else if (isRollover) {</span>
<span class="nc" id="L227">            state = State.HOT;</span>
        }
<span class="nc" id="L229">        return state;</span>
    }

    private void paintXPComboBoxBackground(Graphics g, JComponent c) {
<span class="nc" id="L233">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc" id="L234">        State state = getXPComboBoxState(c);</span>
<span class="nc" id="L235">        Skin skin = null;</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">        if (! comboBox.isEditable()</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">              &amp;&amp; xp.isSkinDefined(c, Part.CP_READONLY)) {</span>
<span class="nc" id="L238">            skin = xp.getSkin(c, Part.CP_READONLY);</span>
        }
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (skin == null) {</span>
<span class="nc" id="L241">            skin = xp.getSkin(c, Part.CP_COMBOBOX);</span>
        }
<span class="nc" id="L243">        skin.paintSkin(g, 0, 0, c.getWidth(), c.getHeight(), state);</span>
<span class="nc" id="L244">    }</span>

    /**
     * If necessary paints the currently selected item.
     *
     * @param g Graphics to paint to
     * @param bounds Region to paint current value to
     * @param hasFocus whether or not the JComboBox has focus
     * @throws NullPointerException if any of the arguments are null.
     * @since 1.5
     */
    public void paintCurrentValue(Graphics g, Rectangle bounds,
                                  boolean hasFocus) {
<span class="nc" id="L257">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if ( xp != null) {</span>
<span class="nc" id="L259">            bounds.x += 2;</span>
<span class="nc" id="L260">            bounds.y += 2;</span>
<span class="nc" id="L261">            bounds.width -= 4;</span>
<span class="nc" id="L262">            bounds.height -= 4;</span>
        } else {
<span class="nc" id="L264">            bounds.x += 1;</span>
<span class="nc" id="L265">            bounds.y += 1;</span>
<span class="nc" id="L266">            bounds.width -= 2;</span>
<span class="nc" id="L267">            bounds.height -= 2;</span>
        }
<span class="nc bnc" id="L269" title="All 4 branches missed.">        if (! comboBox.isEditable()</span>
            &amp;&amp; xp != null
<span class="nc bnc" id="L271" title="All 2 branches missed.">            &amp;&amp; xp.isSkinDefined(comboBox, Part.CP_READONLY)) {</span>
            // On vista for READNLY ComboBox
            // color for currentValue is the same as for any other item

            // mostly copied from javax.swing.plaf.basic.BasicComboBoxUI.paintCurrentValue
<span class="nc" id="L276">            ListCellRenderer renderer = comboBox.getRenderer();</span>
            Component c;
<span class="nc bnc" id="L278" title="All 4 branches missed.">            if ( hasFocus &amp;&amp; !isPopupVisible(comboBox) ) {</span>
<span class="nc" id="L279">                c = renderer.getListCellRendererComponent(</span>
                        listBox,
<span class="nc" id="L281">                        comboBox.getSelectedItem(),</span>
                        -1,
                        true,
                        false );
            } else {
<span class="nc" id="L286">                c = renderer.getListCellRendererComponent(</span>
                        listBox,
<span class="nc" id="L288">                        comboBox.getSelectedItem(),</span>
                        -1,
                        false,
                        false );
            }
<span class="nc" id="L293">            c.setFont(comboBox.getFont());</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">            if ( comboBox.isEnabled() ) {</span>
<span class="nc" id="L295">                c.setForeground(comboBox.getForeground());</span>
<span class="nc" id="L296">                c.setBackground(comboBox.getBackground());</span>
            } else {
<span class="nc" id="L298">                c.setForeground(DefaultLookup.getColor(</span>
                         comboBox, this, &quot;ComboBox.disabledForeground&quot;, null));
<span class="nc" id="L300">                c.setBackground(DefaultLookup.getColor(</span>
                         comboBox, this, &quot;ComboBox.disabledBackground&quot;, null));
            }
<span class="nc" id="L303">            boolean shouldValidate = false;</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">            if (c instanceof JPanel)  {</span>
<span class="nc" id="L305">                shouldValidate = true;</span>
            }
<span class="nc" id="L307">            currentValuePane.paintComponent(g, c, comboBox, bounds.x, bounds.y,</span>
                                            bounds.width, bounds.height, shouldValidate);

<span class="nc" id="L310">        } else {</span>
<span class="nc" id="L311">            super.paintCurrentValue(g, bounds, hasFocus);</span>
        }
<span class="nc" id="L313">    }</span>

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    public void paintCurrentValueBackground(Graphics g, Rectangle bounds,
                                            boolean hasFocus) {
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (XPStyle.getXP() == null) {</span>
<span class="nc" id="L322">            super.paintCurrentValueBackground(g, bounds, hasFocus);</span>
        }
<span class="nc" id="L324">    }</span>

    public Dimension getMinimumSize( JComponent c ) {
<span class="nc" id="L327">        Dimension d = super.getMinimumSize(c);</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L329">            d.width += 5;</span>
        } else {
<span class="nc" id="L331">            d.width += 4;</span>
        }
<span class="nc" id="L333">        d.height += 2;</span>
<span class="nc" id="L334">        return d;</span>
    }

    /**
     * Creates a layout manager for managing the components which make up the
     * combo box.
     *
     * @return an instance of a layout manager
     */
    protected LayoutManager createLayoutManager() {
<span class="nc" id="L344">        return new BasicComboBoxUI.ComboBoxLayoutManager() {</span>
            public void layoutContainer(Container parent) {
<span class="nc" id="L346">                super.layoutContainer(parent);</span>

<span class="nc bnc" id="L348" title="All 4 branches missed.">                if (XPStyle.getXP() != null &amp;&amp; arrowButton != null) {</span>
<span class="nc" id="L349">                    Dimension d = parent.getSize();</span>
<span class="nc" id="L350">                    Insets insets = getInsets();</span>
<span class="nc" id="L351">                    int buttonWidth = arrowButton.getPreferredSize().width;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                    arrowButton.setBounds(WindowsGraphicsUtils.isLeftToRight((JComboBox)parent)</span>
                                          ? (d.width - insets.right - buttonWidth)
                                          : insets.left,
                                          insets.top,
                                          buttonWidth, d.height - insets.top - insets.bottom);
                }
<span class="nc" id="L358">            }</span>
        };
    }

    protected void installKeyboardActions() {
<span class="nc" id="L363">        super.installKeyboardActions();</span>
<span class="nc" id="L364">    }</span>

    protected ComboPopup createPopup() {
<span class="nc" id="L367">        return super.createPopup();</span>
    }

    /**
     * Creates the default editor that will be used in editable combo boxes.
     * A default editor will be used only if an editor has not been
     * explicitly set with &lt;code&gt;setEditor&lt;/code&gt;.
     *
     * @return a &lt;code&gt;ComboBoxEditor&lt;/code&gt; used for the combo box
     * @see javax.swing.JComboBox#setEditor
     */
    protected ComboBoxEditor createEditor() {
<span class="nc" id="L379">        return new WindowsComboBoxEditor();</span>
    }

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    @Override
    protected ListCellRenderer createRenderer() {
<span class="nc" id="L388">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L389" title="All 4 branches missed.">        if (xp != null &amp;&amp; xp.isSkinDefined(comboBox, Part.CP_READONLY)) {</span>
<span class="nc" id="L390">            return new WindowsComboBoxRenderer();</span>
        } else {
<span class="nc" id="L392">            return super.createRenderer();</span>
        }
    }

    /**
     * Creates an button which will be used as the control to show or hide
     * the popup portion of the combo box.
     *
     * @return a button which represents the popup control
     */
    protected JButton createArrowButton() {
<span class="nc bnc" id="L403" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L404">            return new XPComboBoxButton();</span>
        } else {
<span class="nc" id="L406">            return super.createArrowButton();</span>
        }
    }

    private class XPComboBoxButton extends XPStyle.GlyphButton {
<span class="nc" id="L411">        public XPComboBoxButton() {</span>
<span class="nc" id="L412">            super(null,</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">                  (! XPStyle.getXP().isSkinDefined(comboBox, Part.CP_DROPDOWNBUTTONRIGHT))</span>
                   ? Part.CP_DROPDOWNBUTTON
<span class="nc bnc" id="L415" title="All 2 branches missed.">                   : (comboBox.getComponentOrientation() == ComponentOrientation.RIGHT_TO_LEFT)</span>
                     ? Part.CP_DROPDOWNBUTTONLEFT
                     : Part.CP_DROPDOWNBUTTONRIGHT
                  );
<span class="nc" id="L419">            setRequestFocusEnabled(false);</span>
<span class="nc" id="L420">        }</span>

        @Override
        protected State getState() {
            State rv;
<span class="nc" id="L425">            rv = super.getState();</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">            if (rv != State.DISABLED</span>
<span class="nc bnc" id="L427" title="All 4 branches missed.">                &amp;&amp; comboBox != null &amp;&amp; ! comboBox.isEditable()</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">                &amp;&amp; XPStyle.getXP().isSkinDefined(comboBox,</span>
                                                 Part.CP_DROPDOWNBUTTONRIGHT)) {
                /*
                 * for non editable ComboBoxes Vista seems to have the
                 * same glyph for all non DISABLED states
                 */
<span class="nc" id="L434">                rv = State.NORMAL;</span>
            }
<span class="nc" id="L436">            return rv;</span>
        }

        public Dimension getPreferredSize() {
<span class="nc" id="L440">            return new Dimension(17, 21);</span>
        }

        void setPart(Part part) {
<span class="nc" id="L444">            setPart(comboBox, part);</span>
<span class="nc" id="L445">        }</span>

        WindowsComboBoxUI getWindowsComboBoxUI() {
<span class="nc" id="L448">            return WindowsComboBoxUI.this;</span>
        }
    }


    /**
     * Subclassed to add Windows specific Key Bindings.
     * This class is now obsolete and doesn't do anything.
     * Only included for backwards API compatibility.
     * Do not call or override.
     *
     * @deprecated As of Java 2 platform v1.4.
     */
    @Deprecated
    protected class WindowsComboPopup extends BasicComboPopup {

<span class="nc" id="L464">        public WindowsComboPopup( JComboBox cBox ) {</span>
<span class="nc" id="L465">            super( cBox );</span>
<span class="nc" id="L466">        }</span>

        protected KeyListener createKeyListener() {
<span class="nc" id="L469">            return new InvocationKeyHandler();</span>
        }

        protected class InvocationKeyHandler extends BasicComboPopup.InvocationKeyHandler {
<span class="nc" id="L473">            protected InvocationKeyHandler() {</span>
<span class="nc" id="L474">                WindowsComboPopup.this.super();</span>
<span class="nc" id="L475">            }</span>
        }
    }


    /**
     * Subclassed to highlight selected item in an editable combo box.
     */
<span class="nc" id="L483">    public static class WindowsComboBoxEditor</span>
        extends BasicComboBoxEditor.UIResource {

        /**
         * {@inheritDoc}
         * @since 1.6
         */
        protected JTextField createEditorComponent() {
<span class="nc" id="L491">            JTextField editor = super.createEditorComponent();</span>
<span class="nc" id="L492">            Border border = (Border)UIManager.get(&quot;ComboBox.editorBorder&quot;);</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">            if (border != null) {</span>
<span class="nc" id="L494">                editor.setBorder(border);</span>
            }
<span class="nc" id="L496">            editor.setOpaque(false);</span>
<span class="nc" id="L497">            return editor;</span>
        }

        public void setItem(Object item) {
<span class="nc" id="L501">            super.setItem(item);</span>
<span class="nc" id="L502">            Object focus = KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();</span>
<span class="nc bnc" id="L503" title="All 4 branches missed.">            if ((focus == editor) || (focus == editor.getParent())) {</span>
<span class="nc" id="L504">                editor.selectAll();</span>
            }
<span class="nc" id="L506">        }</span>
    }

    /**
     * Subclassed to set opacity {@code false} on the renderer
     * and to show border for focused cells.
     */
<span class="nc" id="L513">    private static class WindowsComboBoxRenderer</span>
          extends BasicComboBoxRenderer.UIResource {
<span class="nc" id="L515">        private static final Object BORDER_KEY</span>
            = new StringUIClientPropertyKey(&quot;BORDER_KEY&quot;);
<span class="nc" id="L517">        private static final Border NULL_BORDER = new EmptyBorder(0, 0, 0, 0);</span>
        /**
         * {@inheritDoc}
         */
        @Override
        public Component getListCellRendererComponent(
                                                 JList list,
                                                 Object value,
                                                 int index,
                                                 boolean isSelected,
                                                 boolean cellHasFocus) {
<span class="nc" id="L528">            Component rv =</span>
<span class="nc" id="L529">                super.getListCellRendererComponent(list, value, index,</span>
                                                   isSelected, cellHasFocus);
<span class="nc bnc" id="L531" title="All 2 branches missed.">            if (rv instanceof JComponent) {</span>
<span class="nc" id="L532">                JComponent component = (JComponent) rv;</span>
<span class="nc bnc" id="L533" title="All 4 branches missed.">                if (index == -1 &amp;&amp; isSelected) {</span>
<span class="nc" id="L534">                    Border border = component.getBorder();</span>
<span class="nc" id="L535">                    Border dashedBorder =</span>
<span class="nc" id="L536">                        new WindowsBorders.DashedBorder(list.getForeground());</span>
<span class="nc" id="L537">                    component.setBorder(dashedBorder);</span>
                    //store current border in client property if needed
<span class="nc bnc" id="L539" title="All 2 branches missed.">                    if (component.getClientProperty(BORDER_KEY) == null) {</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">                        component.putClientProperty(BORDER_KEY,</span>
                                       (border == null) ? NULL_BORDER : border);
                    }
<span class="nc" id="L543">                } else {</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">                    if (component.getBorder() instanceof</span>
                          WindowsBorders.DashedBorder) {
<span class="nc" id="L546">                        Object storedBorder = component.getClientProperty(BORDER_KEY);</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">                        if (storedBorder instanceof Border) {</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">                            component.setBorder(</span>
                                (storedBorder == NULL_BORDER) ? null
                                    : (Border) storedBorder);
                        }
<span class="nc" id="L552">                        component.putClientProperty(BORDER_KEY, null);</span>
                    }
                }
<span class="nc bnc" id="L555" title="All 2 branches missed.">                if (index == -1) {</span>
<span class="nc" id="L556">                    component.setOpaque(false);</span>
<span class="nc" id="L557">                    component.setForeground(list.getForeground());</span>
                } else {
<span class="nc" id="L559">                    component.setOpaque(true);</span>
                }
            }
<span class="nc" id="L562">            return rv;</span>
        }

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>