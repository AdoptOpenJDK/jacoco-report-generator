<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WindowsIconFactory.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.windows</a> &gt; <span class="el_source">WindowsIconFactory.java</span></div><h1>WindowsIconFactory.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2013, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.java.swing.plaf.windows;

import javax.swing.*;
import javax.swing.plaf.ButtonUI;
import javax.swing.plaf.UIResource;

import java.awt.*;
import java.io.Serializable;

import static com.sun.java.swing.plaf.windows.TMSchema.*;
import static com.sun.java.swing.plaf.windows.XPStyle.Skin;

import sun.swing.MenuItemCheckIconFactory;

/**
 * Factory object that can vend Icons appropriate for the Windows L &amp; F.
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases.  The current serialization support is appropriate
 * for short term storage or RMI between applications running the same
 * version of Swing.  A future release of Swing will provide support for
 * long term persistence.
 *
 * @author David Kloba
 * @author Georges Saab
 * @author Rich Schiavi
 */
<span class="nc" id="L54">public class WindowsIconFactory implements Serializable</span>
{
    private static Icon frame_closeIcon;
    private static Icon frame_iconifyIcon;
    private static Icon frame_maxIcon;
    private static Icon frame_minIcon;
    private static Icon frame_resizeIcon;
    private static Icon checkBoxIcon;
    private static Icon radioButtonIcon;
    private static Icon checkBoxMenuItemIcon;
    private static Icon radioButtonMenuItemIcon;
    private static Icon menuItemCheckIcon;
    private static Icon menuItemArrowIcon;
    private static Icon menuArrowIcon;
    private static VistaMenuItemCheckIconFactory menuItemCheckIconFactory;

    public static Icon getMenuItemCheckIcon() {
<span class="nc bnc" id="L71" title="All 2 branches missed.">        if (menuItemCheckIcon == null) {</span>
<span class="nc" id="L72">            menuItemCheckIcon = new MenuItemCheckIcon();</span>
        }
<span class="nc" id="L74">        return menuItemCheckIcon;</span>
    }

    public static Icon getMenuItemArrowIcon() {
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if (menuItemArrowIcon == null) {</span>
<span class="nc" id="L79">            menuItemArrowIcon = new MenuItemArrowIcon();</span>
        }
<span class="nc" id="L81">        return menuItemArrowIcon;</span>
    }

    public static Icon getMenuArrowIcon() {
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (menuArrowIcon == null) {</span>
<span class="nc" id="L86">            menuArrowIcon = new MenuArrowIcon();</span>
        }
<span class="nc" id="L88">        return menuArrowIcon;</span>
    }

    public static Icon getCheckBoxIcon() {
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (checkBoxIcon == null) {</span>
<span class="nc" id="L93">            checkBoxIcon = new CheckBoxIcon();</span>
        }
<span class="nc" id="L95">        return checkBoxIcon;</span>
    }

    public static Icon getRadioButtonIcon() {
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if (radioButtonIcon == null) {</span>
<span class="nc" id="L100">            radioButtonIcon = new RadioButtonIcon();</span>
        }
<span class="nc" id="L102">        return radioButtonIcon;</span>
    }

    public static Icon getCheckBoxMenuItemIcon() {
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (checkBoxMenuItemIcon == null) {</span>
<span class="nc" id="L107">            checkBoxMenuItemIcon = new CheckBoxMenuItemIcon();</span>
        }
<span class="nc" id="L109">        return checkBoxMenuItemIcon;</span>
    }

    public static Icon getRadioButtonMenuItemIcon() {
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (radioButtonMenuItemIcon == null) {</span>
<span class="nc" id="L114">            radioButtonMenuItemIcon = new RadioButtonMenuItemIcon();</span>
        }
<span class="nc" id="L116">        return radioButtonMenuItemIcon;</span>
    }

    static
    synchronized VistaMenuItemCheckIconFactory getMenuItemCheckIconFactory() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (menuItemCheckIconFactory == null) {</span>
<span class="nc" id="L122">            menuItemCheckIconFactory =</span>
                new VistaMenuItemCheckIconFactory();
        }
<span class="nc" id="L125">        return menuItemCheckIconFactory;</span>
    }

    public static Icon createFrameCloseIcon() {
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (frame_closeIcon == null) {</span>
<span class="nc" id="L130">            frame_closeIcon = new FrameButtonIcon(Part.WP_CLOSEBUTTON);</span>
        }
<span class="nc" id="L132">        return frame_closeIcon;</span>
    }

    public static Icon createFrameIconifyIcon() {
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (frame_iconifyIcon == null) {</span>
<span class="nc" id="L137">            frame_iconifyIcon = new FrameButtonIcon(Part.WP_MINBUTTON);</span>
        }
<span class="nc" id="L139">        return frame_iconifyIcon;</span>
    }

    public static Icon createFrameMaximizeIcon() {
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (frame_maxIcon == null) {</span>
<span class="nc" id="L144">            frame_maxIcon = new FrameButtonIcon(Part.WP_MAXBUTTON);</span>
        }
<span class="nc" id="L146">        return frame_maxIcon;</span>
    }

    public static Icon createFrameMinimizeIcon() {
<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (frame_minIcon == null) {</span>
<span class="nc" id="L151">            frame_minIcon = new FrameButtonIcon(Part.WP_RESTOREBUTTON);</span>
        }
<span class="nc" id="L153">        return frame_minIcon;</span>
    }

    public static Icon createFrameResizeIcon() {
<span class="nc bnc" id="L157" title="All 2 branches missed.">        if(frame_resizeIcon == null)</span>
<span class="nc" id="L158">            frame_resizeIcon = new ResizeIcon();</span>
<span class="nc" id="L159">        return frame_resizeIcon;</span>
    }


    private static class FrameButtonIcon implements Icon, Serializable {
        private Part part;

<span class="nc" id="L166">        private FrameButtonIcon(Part part) {</span>
<span class="nc" id="L167">            this.part = part;</span>
<span class="nc" id="L168">        }</span>

        public void paintIcon(Component c, Graphics g, int x0, int y0) {
<span class="nc" id="L171">            int width = getIconWidth();</span>
<span class="nc" id="L172">            int height = getIconHeight();</span>

<span class="nc" id="L174">            XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L176">                Skin skin = xp.getSkin(c, part);</span>
<span class="nc" id="L177">                AbstractButton b = (AbstractButton)c;</span>
<span class="nc" id="L178">                ButtonModel model = b.getModel();</span>

                // Find out if frame is inactive
<span class="nc" id="L181">                JInternalFrame jif = (JInternalFrame)SwingUtilities.</span>
<span class="nc" id="L182">                                        getAncestorOfClass(JInternalFrame.class, b);</span>
<span class="nc bnc" id="L183" title="All 4 branches missed.">                boolean jifSelected = (jif != null &amp;&amp; jif.isSelected());</span>

                State state;
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if (jifSelected) {</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">                    if (!model.isEnabled()) {</span>
<span class="nc" id="L188">                        state = State.DISABLED;</span>
<span class="nc bnc" id="L189" title="All 4 branches missed.">                    } else if (model.isArmed() &amp;&amp; model.isPressed()) {</span>
<span class="nc" id="L190">                        state = State.PUSHED;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                    } else if (model.isRollover()) {</span>
<span class="nc" id="L192">                        state = State.HOT;</span>
                    } else {
<span class="nc" id="L194">                        state = State.NORMAL;</span>
                    }
                } else {
<span class="nc bnc" id="L197" title="All 2 branches missed.">                    if (!model.isEnabled()) {</span>
<span class="nc" id="L198">                        state = State.INACTIVEDISABLED;</span>
<span class="nc bnc" id="L199" title="All 4 branches missed.">                    } else if (model.isArmed() &amp;&amp; model.isPressed()) {</span>
<span class="nc" id="L200">                        state = State.INACTIVEPUSHED;</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                    } else if (model.isRollover()) {</span>
<span class="nc" id="L202">                        state = State.INACTIVEHOT;</span>
                    } else {
<span class="nc" id="L204">                        state = State.INACTIVENORMAL;</span>
                    }
                }
<span class="nc" id="L207">                skin.paintSkin(g, 0, 0, width, height, state);</span>
<span class="nc" id="L208">            } else {</span>
<span class="nc" id="L209">                g.setColor(Color.black);</span>
<span class="nc" id="L210">                int x = width / 12 + 2;</span>
<span class="nc" id="L211">                int y = height / 5;</span>
<span class="nc" id="L212">                int h = height - y * 2 - 1;</span>
<span class="nc" id="L213">                int w = width * 3/4 -3;</span>
<span class="nc" id="L214">                int thickness2 = Math.max(height / 8, 2);</span>
<span class="nc" id="L215">                int thickness  = Math.max(width / 15, 1);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">                if (part == Part.WP_CLOSEBUTTON) {</span>
                    int lineWidth;
<span class="nc bnc" id="L218" title="All 2 branches missed.">                    if      (width &gt; 47) lineWidth = 6;</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">                    else if (width &gt; 37) lineWidth = 5;</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">                    else if (width &gt; 26) lineWidth = 4;</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                    else if (width &gt; 16) lineWidth = 3;</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                    else if (width &gt; 12) lineWidth = 2;</span>
<span class="nc" id="L223">                    else                 lineWidth = 1;</span>
<span class="nc" id="L224">                    y = height / 12 + 2;</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">                    if (lineWidth == 1) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                        if (w % 2 == 1) { x++; w++; }</span>
<span class="nc" id="L227">                        g.drawLine(x,     y, x+w-2, y+w-2);</span>
<span class="nc" id="L228">                        g.drawLine(x+w-2, y, x,     y+w-2);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                    } else if (lineWidth == 2) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                        if (w &gt; 6) { x++; w--; }</span>
<span class="nc" id="L231">                        g.drawLine(x,     y, x+w-2, y+w-2);</span>
<span class="nc" id="L232">                        g.drawLine(x+w-2, y, x,     y+w-2);</span>
<span class="nc" id="L233">                        g.drawLine(x+1,   y, x+w-1, y+w-2);</span>
<span class="nc" id="L234">                        g.drawLine(x+w-1, y, x+1,   y+w-2);</span>
                    } else {
<span class="nc" id="L236">                        x += 2; y++; w -= 2;</span>
<span class="nc" id="L237">                        g.drawLine(x,     y,   x+w-1, y+w-1);</span>
<span class="nc" id="L238">                        g.drawLine(x+w-1, y,   x,     y+w-1);</span>
<span class="nc" id="L239">                        g.drawLine(x+1,   y,   x+w-1, y+w-2);</span>
<span class="nc" id="L240">                        g.drawLine(x+w-2, y,   x,     y+w-2);</span>
<span class="nc" id="L241">                        g.drawLine(x,     y+1, x+w-2, y+w-1);</span>
<span class="nc" id="L242">                        g.drawLine(x+w-1, y+1, x+1,   y+w-1);</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                        for (int i = 4; i &lt;= lineWidth; i++) {</span>
<span class="nc" id="L244">                            g.drawLine(x+i-2,   y,     x+w-1,   y+w-i+1);</span>
<span class="nc" id="L245">                            g.drawLine(x,       y+i-2, x+w-i+1, y+w-1);</span>
<span class="nc" id="L246">                            g.drawLine(x+w-i+1, y,     x,       y+w-i+1);</span>
<span class="nc" id="L247">                            g.drawLine(x+w-1,   y+i-2, x+i-2,   y+w-1);</span>
                        }
                    }
<span class="nc bnc" id="L250" title="All 2 branches missed.">                } else if (part == Part.WP_MINBUTTON) {</span>
<span class="nc" id="L251">                    g.fillRect(x, y+h-thickness2, w-w/3, thickness2);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                } else if (part == Part.WP_MAXBUTTON) {</span>
<span class="nc" id="L253">                    g.fillRect(x, y, w, thickness2);</span>
<span class="nc" id="L254">                    g.fillRect(x, y, thickness, h);</span>
<span class="nc" id="L255">                    g.fillRect(x+w-thickness, y, thickness, h);</span>
<span class="nc" id="L256">                    g.fillRect(x, y+h-thickness, w, thickness);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">                } else if (part == Part.WP_RESTOREBUTTON) {</span>
<span class="nc" id="L258">                    g.fillRect(x+w/3, y, w-w/3, thickness2);</span>
<span class="nc" id="L259">                    g.fillRect(x+w/3, y, thickness, h/3);</span>
<span class="nc" id="L260">                    g.fillRect(x+w-thickness, y, thickness, h-h/3);</span>
<span class="nc" id="L261">                    g.fillRect(x+w-w/3, y+h-h/3-thickness, w/3, thickness);</span>

<span class="nc" id="L263">                    g.fillRect(x, y+h/3, w-w/3, thickness2);</span>
<span class="nc" id="L264">                    g.fillRect(x, y+h/3, thickness, h-h/3);</span>
<span class="nc" id="L265">                    g.fillRect(x+w-w/3-thickness, y+h/3, thickness, h-h/3);</span>
<span class="nc" id="L266">                    g.fillRect(x, y+h-thickness, w-w/3, thickness);</span>
                }
            }
<span class="nc" id="L269">        }</span>

        public int getIconWidth() {
            int width;
<span class="nc bnc" id="L273" title="All 2 branches missed.">            if (XPStyle.getXP() != null) {</span>
                // Fix for XP bug where sometimes these sizes aren't updated properly
                // Assume for now that height is correct and derive width using the
                // ratio from the uxtheme part
<span class="nc" id="L277">                width = UIManager.getInt(&quot;InternalFrame.titleButtonHeight&quot;) -2;</span>
<span class="nc" id="L278">                Dimension d = XPStyle.getPartSize(Part.WP_CLOSEBUTTON, State.NORMAL);</span>
<span class="nc bnc" id="L279" title="All 6 branches missed.">                if (d != null &amp;&amp; d.width != 0 &amp;&amp; d.height != 0) {</span>
<span class="nc" id="L280">                    width = (int) ((float) width * d.width / d.height);</span>
                }
<span class="nc" id="L282">            } else {</span>
<span class="nc" id="L283">                width = UIManager.getInt(&quot;InternalFrame.titleButtonWidth&quot;) -2;</span>
            }
<span class="nc bnc" id="L285" title="All 2 branches missed.">            if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L286">                width -= 2;</span>
            }
<span class="nc" id="L288">            return width;</span>
        }

        public int getIconHeight() {
<span class="nc" id="L292">            int height = UIManager.getInt(&quot;InternalFrame.titleButtonHeight&quot;)-4;</span>
<span class="nc" id="L293">            return height;</span>
        }
    }



<span class="nc" id="L299">        private static class ResizeIcon implements Icon, Serializable {</span>
            public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L301">                g.setColor(UIManager.getColor(&quot;InternalFrame.resizeIconHighlight&quot;));</span>
<span class="nc" id="L302">                g.drawLine(0, 11, 11, 0);</span>
<span class="nc" id="L303">                g.drawLine(4, 11, 11, 4);</span>
<span class="nc" id="L304">                g.drawLine(8, 11, 11, 8);</span>

<span class="nc" id="L306">                g.setColor(UIManager.getColor(&quot;InternalFrame.resizeIconShadow&quot;));</span>
<span class="nc" id="L307">                g.drawLine(1, 11, 11, 1);</span>
<span class="nc" id="L308">                g.drawLine(2, 11, 11, 2);</span>
<span class="nc" id="L309">                g.drawLine(5, 11, 11, 5);</span>
<span class="nc" id="L310">                g.drawLine(6, 11, 11, 6);</span>
<span class="nc" id="L311">                g.drawLine(9, 11, 11, 9);</span>
<span class="nc" id="L312">                g.drawLine(10, 11, 11, 10);</span>
<span class="nc" id="L313">            }</span>
<span class="nc" id="L314">            public int getIconWidth() { return 13; }</span>
<span class="nc" id="L315">            public int getIconHeight() { return 13; }</span>
        };

<span class="nc" id="L318">    private static class CheckBoxIcon implements Icon, Serializable</span>
    {
        final static int csize = 13;
        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L322">            JCheckBox cb = (JCheckBox) c;</span>
<span class="nc" id="L323">            ButtonModel model = cb.getModel();</span>
<span class="nc" id="L324">            XPStyle xp = XPStyle.getXP();</span>

<span class="nc bnc" id="L326" title="All 2 branches missed.">            if (xp != null) {</span>
                State state;
<span class="nc bnc" id="L328" title="All 2 branches missed.">                if (model.isSelected()) {</span>
<span class="nc" id="L329">                    state = State.CHECKEDNORMAL;</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">                    if (!model.isEnabled()) {</span>
<span class="nc" id="L331">                        state = State.CHECKEDDISABLED;</span>
<span class="nc bnc" id="L332" title="All 4 branches missed.">                    } else if (model.isPressed() &amp;&amp; model.isArmed()) {</span>
<span class="nc" id="L333">                        state = State.CHECKEDPRESSED;</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">                    } else if (model.isRollover()) {</span>
<span class="nc" id="L335">                        state = State.CHECKEDHOT;</span>
                    }
                } else {
<span class="nc" id="L338">                    state = State.UNCHECKEDNORMAL;</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">                    if (!model.isEnabled()) {</span>
<span class="nc" id="L340">                        state = State.UNCHECKEDDISABLED;</span>
<span class="nc bnc" id="L341" title="All 4 branches missed.">                    } else if (model.isPressed() &amp;&amp; model.isArmed()) {</span>
<span class="nc" id="L342">                        state = State.UNCHECKEDPRESSED;</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                    } else if (model.isRollover()) {</span>
<span class="nc" id="L344">                        state = State.UNCHECKEDHOT;</span>
                    }
                }
<span class="nc" id="L347">                Part part = Part.BP_CHECKBOX;</span>
<span class="nc" id="L348">                xp.getSkin(c, part).paintSkin(g, x, y, state);</span>
<span class="nc" id="L349">            } else {</span>
                // outer bevel
<span class="nc bnc" id="L351" title="All 2 branches missed.">                if(!cb.isBorderPaintedFlat()) {</span>
                    // Outer top/left
<span class="nc" id="L353">                    g.setColor(UIManager.getColor(&quot;CheckBox.shadow&quot;));</span>
<span class="nc" id="L354">                    g.drawLine(x, y, x+11, y);</span>
<span class="nc" id="L355">                    g.drawLine(x, y+1, x, y+11);</span>

                    // Outer bottom/right
<span class="nc" id="L358">                    g.setColor(UIManager.getColor(&quot;CheckBox.highlight&quot;));</span>
<span class="nc" id="L359">                    g.drawLine(x+12, y, x+12, y+12);</span>
<span class="nc" id="L360">                    g.drawLine(x, y+12, x+11, y+12);</span>

                    // Inner top.left
<span class="nc" id="L363">                    g.setColor(UIManager.getColor(&quot;CheckBox.darkShadow&quot;));</span>
<span class="nc" id="L364">                    g.drawLine(x+1, y+1, x+10, y+1);</span>
<span class="nc" id="L365">                    g.drawLine(x+1, y+2, x+1, y+10);</span>

                    // Inner bottom/right
<span class="nc" id="L368">                    g.setColor(UIManager.getColor(&quot;CheckBox.light&quot;));</span>
<span class="nc" id="L369">                    g.drawLine(x+1, y+11, x+11, y+11);</span>
<span class="nc" id="L370">                    g.drawLine(x+11, y+1, x+11, y+10);</span>

                    // inside box
<span class="nc bnc" id="L373" title="All 6 branches missed.">                    if((model.isPressed() &amp;&amp; model.isArmed()) || !model.isEnabled()) {</span>
<span class="nc" id="L374">                        g.setColor(UIManager.getColor(&quot;CheckBox.background&quot;));</span>
                    } else {
<span class="nc" id="L376">                        g.setColor(UIManager.getColor(&quot;CheckBox.interiorBackground&quot;));</span>
                    }
<span class="nc" id="L378">                    g.fillRect(x+2, y+2, csize-4, csize-4);</span>
                } else {
<span class="nc" id="L380">                    g.setColor(UIManager.getColor(&quot;CheckBox.shadow&quot;));</span>
<span class="nc" id="L381">                    g.drawRect(x+1, y+1, csize-3, csize-3);</span>

<span class="nc bnc" id="L383" title="All 6 branches missed.">                    if((model.isPressed() &amp;&amp; model.isArmed()) || !model.isEnabled()) {</span>
<span class="nc" id="L384">                        g.setColor(UIManager.getColor(&quot;CheckBox.background&quot;));</span>
                    } else {
<span class="nc" id="L386">                        g.setColor(UIManager.getColor(&quot;CheckBox.interiorBackground&quot;));</span>
                    }
<span class="nc" id="L388">                    g.fillRect(x+2, y+2, csize-4, csize-4);</span>
                }

<span class="nc bnc" id="L391" title="All 2 branches missed.">                if(model.isEnabled()) {</span>
<span class="nc" id="L392">                    g.setColor(UIManager.getColor(&quot;CheckBox.foreground&quot;));</span>
                } else {
<span class="nc" id="L394">                    g.setColor(UIManager.getColor(&quot;CheckBox.shadow&quot;));</span>
                }

                // paint check
<span class="nc bnc" id="L398" title="All 2 branches missed.">                if (model.isSelected()) {</span>
<span class="nc" id="L399">                    g.drawLine(x+9, y+3, x+9, y+3);</span>
<span class="nc" id="L400">                    g.drawLine(x+8, y+4, x+9, y+4);</span>
<span class="nc" id="L401">                    g.drawLine(x+7, y+5, x+9, y+5);</span>
<span class="nc" id="L402">                    g.drawLine(x+6, y+6, x+8, y+6);</span>
<span class="nc" id="L403">                    g.drawLine(x+3, y+7, x+7, y+7);</span>
<span class="nc" id="L404">                    g.drawLine(x+4, y+8, x+6, y+8);</span>
<span class="nc" id="L405">                    g.drawLine(x+5, y+9, x+5, y+9);</span>
<span class="nc" id="L406">                    g.drawLine(x+3, y+5, x+3, y+5);</span>
<span class="nc" id="L407">                    g.drawLine(x+3, y+6, x+4, y+6);</span>
                }
            }
<span class="nc" id="L410">        }</span>

        public int getIconWidth() {
<span class="nc" id="L413">            XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L415">                return xp.getSkin(null, Part.BP_CHECKBOX).getWidth();</span>
            } else {
<span class="nc" id="L417">                return csize;</span>
            }
        }

        public int getIconHeight() {
<span class="nc" id="L422">            XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L424">                return xp.getSkin(null, Part.BP_CHECKBOX).getHeight();</span>
            } else {
<span class="nc" id="L426">                return csize;</span>
            }
        }
    }

<span class="nc" id="L431">    private static class RadioButtonIcon implements Icon, UIResource, Serializable</span>
    {
        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L434">            AbstractButton b = (AbstractButton) c;</span>
<span class="nc" id="L435">            ButtonModel model = b.getModel();</span>
<span class="nc" id="L436">            XPStyle xp = XPStyle.getXP();</span>

<span class="nc bnc" id="L438" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L439">                Part part = Part.BP_RADIOBUTTON;</span>
<span class="nc" id="L440">                Skin skin = xp.getSkin(b, part);</span>
                State state;
<span class="nc" id="L442">                int index = 0;</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">                if (model.isSelected()) {</span>
<span class="nc" id="L444">                    state = State.CHECKEDNORMAL;</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">                    if (!model.isEnabled()) {</span>
<span class="nc" id="L446">                        state = State.CHECKEDDISABLED;</span>
<span class="nc bnc" id="L447" title="All 4 branches missed.">                    } else if (model.isPressed() &amp;&amp; model.isArmed()) {</span>
<span class="nc" id="L448">                        state = State.CHECKEDPRESSED;</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">                    } else if (model.isRollover()) {</span>
<span class="nc" id="L450">                        state = State.CHECKEDHOT;</span>
                    }
                } else {
<span class="nc" id="L453">                    state = State.UNCHECKEDNORMAL;</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">                    if (!model.isEnabled()) {</span>
<span class="nc" id="L455">                        state = State.UNCHECKEDDISABLED;</span>
<span class="nc bnc" id="L456" title="All 4 branches missed.">                    } else if (model.isPressed() &amp;&amp; model.isArmed()) {</span>
<span class="nc" id="L457">                        state = State.UNCHECKEDPRESSED;</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                    } else if (model.isRollover()) {</span>
<span class="nc" id="L459">                        state = State.UNCHECKEDHOT;</span>
                    }
                }
<span class="nc" id="L462">                skin.paintSkin(g, x, y, state);</span>
<span class="nc" id="L463">            } else {</span>
                // fill interior
<span class="nc bnc" id="L465" title="All 6 branches missed.">                if((model.isPressed() &amp;&amp; model.isArmed()) || !model.isEnabled()) {</span>
<span class="nc" id="L466">                    g.setColor(UIManager.getColor(&quot;RadioButton.background&quot;));</span>
                } else {
<span class="nc" id="L468">                    g.setColor(UIManager.getColor(&quot;RadioButton.interiorBackground&quot;));</span>
                }
<span class="nc" id="L470">                g.fillRect(x+2, y+2, 8, 8);</span>


                    // outter left arc
<span class="nc" id="L474">                g.setColor(UIManager.getColor(&quot;RadioButton.shadow&quot;));</span>
<span class="nc" id="L475">                g.drawLine(x+4, y+0, x+7, y+0);</span>
<span class="nc" id="L476">                g.drawLine(x+2, y+1, x+3, y+1);</span>
<span class="nc" id="L477">                g.drawLine(x+8, y+1, x+9, y+1);</span>
<span class="nc" id="L478">                g.drawLine(x+1, y+2, x+1, y+3);</span>
<span class="nc" id="L479">                g.drawLine(x+0, y+4, x+0, y+7);</span>
<span class="nc" id="L480">                g.drawLine(x+1, y+8, x+1, y+9);</span>

                // outter right arc
<span class="nc" id="L483">                g.setColor(UIManager.getColor(&quot;RadioButton.highlight&quot;));</span>
<span class="nc" id="L484">                g.drawLine(x+2, y+10, x+3, y+10);</span>
<span class="nc" id="L485">                g.drawLine(x+4, y+11, x+7, y+11);</span>
<span class="nc" id="L486">                g.drawLine(x+8, y+10, x+9, y+10);</span>
<span class="nc" id="L487">                g.drawLine(x+10, y+9, x+10, y+8);</span>
<span class="nc" id="L488">                g.drawLine(x+11, y+7, x+11, y+4);</span>
<span class="nc" id="L489">                g.drawLine(x+10, y+3, x+10, y+2);</span>


                // inner left arc
<span class="nc" id="L493">                g.setColor(UIManager.getColor(&quot;RadioButton.darkShadow&quot;));</span>
<span class="nc" id="L494">                g.drawLine(x+4, y+1, x+7, y+1);</span>
<span class="nc" id="L495">                g.drawLine(x+2, y+2, x+3, y+2);</span>
<span class="nc" id="L496">                g.drawLine(x+8, y+2, x+9, y+2);</span>
<span class="nc" id="L497">                g.drawLine(x+2, y+3, x+2, y+3);</span>
<span class="nc" id="L498">                g.drawLine(x+1, y+4, x+1, y+7);</span>
<span class="nc" id="L499">                g.drawLine(x+2, y+8, x+2, y+8);</span>


                // inner right arc
<span class="nc" id="L503">                g.setColor(UIManager.getColor(&quot;RadioButton.light&quot;));</span>
<span class="nc" id="L504">                g.drawLine(x+2,  y+9,  x+3,  y+9);</span>
<span class="nc" id="L505">                g.drawLine(x+4,  y+10, x+7,  y+10);</span>
<span class="nc" id="L506">                g.drawLine(x+8,  y+9,  x+9,  y+9);</span>
<span class="nc" id="L507">                g.drawLine(x+9,  y+8,  x+9,  y+8);</span>
<span class="nc" id="L508">                g.drawLine(x+10, y+7,  x+10, y+4);</span>
<span class="nc" id="L509">                g.drawLine(x+9,  y+3,  x+9,  y+3);</span>


                 // indicate whether selected or not
<span class="nc bnc" id="L513" title="All 2 branches missed.">                if (model.isSelected()) {</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">                    if (model.isEnabled()) {</span>
<span class="nc" id="L515">                        g.setColor(UIManager.getColor(&quot;RadioButton.foreground&quot;));</span>
                    } else {
<span class="nc" id="L517">                        g.setColor(UIManager.getColor(&quot;RadioButton.shadow&quot;));</span>
                    }
<span class="nc" id="L519">                    g.fillRect(x+4, y+5, 4, 2);</span>
<span class="nc" id="L520">                    g.fillRect(x+5, y+4, 2, 4);</span>
                }
            }
<span class="nc" id="L523">        }</span>

        public int getIconWidth() {
<span class="nc" id="L526">            XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L528">                return xp.getSkin(null, Part.BP_RADIOBUTTON).getWidth();</span>
            } else {
<span class="nc" id="L530">                return 13;</span>
            }
        }

        public int getIconHeight() {
<span class="nc" id="L535">            XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L537">                return xp.getSkin(null, Part.BP_RADIOBUTTON).getHeight();</span>
            } else {
<span class="nc" id="L539">                return 13;</span>
            }
        }
    } // end class RadioButtonIcon


<span class="nc" id="L545">    private static class CheckBoxMenuItemIcon implements Icon, UIResource, Serializable</span>
    {
        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L548">            AbstractButton b = (AbstractButton) c;</span>
<span class="nc" id="L549">            ButtonModel model = b.getModel();</span>
<span class="nc" id="L550">            boolean isSelected = model.isSelected();</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">            if (isSelected) {</span>
<span class="nc" id="L552">                y = y - getIconHeight() / 2;</span>
<span class="nc" id="L553">                g.drawLine(x+9, y+3, x+9, y+3);</span>
<span class="nc" id="L554">                g.drawLine(x+8, y+4, x+9, y+4);</span>
<span class="nc" id="L555">                g.drawLine(x+7, y+5, x+9, y+5);</span>
<span class="nc" id="L556">                g.drawLine(x+6, y+6, x+8, y+6);</span>
<span class="nc" id="L557">                g.drawLine(x+3, y+7, x+7, y+7);</span>
<span class="nc" id="L558">                g.drawLine(x+4, y+8, x+6, y+8);</span>
<span class="nc" id="L559">                g.drawLine(x+5, y+9, x+5, y+9);</span>
<span class="nc" id="L560">                g.drawLine(x+3, y+5, x+3, y+5);</span>
<span class="nc" id="L561">                g.drawLine(x+3, y+6, x+4, y+6);</span>
            }
<span class="nc" id="L563">        }</span>
<span class="nc" id="L564">        public int getIconWidth() { return 9; }</span>
<span class="nc" id="L565">        public int getIconHeight() { return 9; }</span>

    } // End class CheckBoxMenuItemIcon


<span class="nc" id="L570">    private static class RadioButtonMenuItemIcon implements Icon, UIResource, Serializable</span>
    {
        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L573">            AbstractButton b = (AbstractButton) c;</span>
<span class="nc" id="L574">            ButtonModel model = b.getModel();</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">            if (b.isSelected() == true) {</span>
<span class="nc" id="L576">               g.fillRoundRect(x+3,y+3, getIconWidth()-6, getIconHeight()-6,</span>
                               4, 4);
            }
<span class="nc" id="L579">        }</span>
<span class="nc" id="L580">        public int getIconWidth() { return 12; }</span>
<span class="nc" id="L581">        public int getIconHeight() { return 12; }</span>

    } // End class RadioButtonMenuItemIcon


<span class="nc" id="L586">    private static class MenuItemCheckIcon implements Icon, UIResource, Serializable{</span>
        public void paintIcon(Component c, Graphics g, int x, int y) {
            /* For debugging:
               Color oldColor = g.getColor();
            g.setColor(Color.orange);
            g.fill3DRect(x,y,getIconWidth(), getIconHeight(), true);
            g.setColor(oldColor);
            */
<span class="nc" id="L594">        }</span>
<span class="nc" id="L595">        public int getIconWidth() { return 9; }</span>
<span class="nc" id="L596">        public int getIconHeight() { return 9; }</span>

    } // End class MenuItemCheckIcon

<span class="nc" id="L600">    private static class MenuItemArrowIcon implements Icon, UIResource, Serializable {</span>
        public void paintIcon(Component c, Graphics g, int x, int y) {
            /* For debugging:
            Color oldColor = g.getColor();
            g.setColor(Color.green);
            g.fill3DRect(x,y,getIconWidth(), getIconHeight(), true);
            g.setColor(oldColor);
            */
<span class="nc" id="L608">        }</span>
<span class="nc" id="L609">        public int getIconWidth() { return 4; }</span>
<span class="nc" id="L610">        public int getIconHeight() { return 8; }</span>

    } // End class MenuItemArrowIcon

<span class="nc" id="L614">    private static class MenuArrowIcon implements Icon, UIResource, Serializable {</span>
        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc bnc" id="L616" title="All 2 branches missed.">            if (WindowsMenuItemUI.isVistaPainting()) {</span>
<span class="nc" id="L617">                XPStyle xp = XPStyle.getXP();</span>
<span class="nc" id="L618">                State state = State.NORMAL;</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">                if (c instanceof JMenuItem) {</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">                    state = ((JMenuItem) c).getModel().isEnabled()</span>
                    ? State.NORMAL : State.DISABLED;
                }
<span class="nc" id="L623">                Skin skin = xp.getSkin(c, Part.MP_POPUPSUBMENU);</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">                if (WindowsGraphicsUtils.isLeftToRight(c)) {</span>
<span class="nc" id="L625">                    skin.paintSkin(g, x, y, state);</span>
                } else {
<span class="nc" id="L627">                    Graphics2D g2d = (Graphics2D)g.create();</span>
<span class="nc" id="L628">                    g2d.translate(x + skin.getWidth(), y);</span>
<span class="nc" id="L629">                    g2d.scale(-1, 1);</span>
<span class="nc" id="L630">                    skin.paintSkin(g2d, 0, 0, state);</span>
<span class="nc" id="L631">                    g2d.dispose();</span>
                }
<span class="nc" id="L633">            } else {</span>
<span class="nc" id="L634">                g.translate(x,y);</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">                if( WindowsGraphicsUtils.isLeftToRight(c) ) {</span>
<span class="nc" id="L636">                    g.drawLine( 0, 0, 0, 7 );</span>
<span class="nc" id="L637">                    g.drawLine( 1, 1, 1, 6 );</span>
<span class="nc" id="L638">                    g.drawLine( 2, 2, 2, 5 );</span>
<span class="nc" id="L639">                    g.drawLine( 3, 3, 3, 4 );</span>
                } else {
<span class="nc" id="L641">                    g.drawLine( 4, 0, 4, 7 );</span>
<span class="nc" id="L642">                    g.drawLine( 3, 1, 3, 6 );</span>
<span class="nc" id="L643">                    g.drawLine( 2, 2, 2, 5 );</span>
<span class="nc" id="L644">                    g.drawLine( 1, 3, 1, 4 );</span>
                }
<span class="nc" id="L646">                g.translate(-x,-y);</span>
            }
<span class="nc" id="L648">        }</span>
        public int getIconWidth() {
<span class="nc bnc" id="L650" title="All 2 branches missed.">            if (WindowsMenuItemUI.isVistaPainting()) {</span>
<span class="nc" id="L651">                Skin skin = XPStyle.getXP().getSkin(null, Part.MP_POPUPSUBMENU);</span>
<span class="nc" id="L652">                return skin.getWidth();</span>
            } else {
<span class="nc" id="L654">                return 4;</span>
            }
        }
        public int getIconHeight() {
<span class="nc bnc" id="L658" title="All 2 branches missed.">            if (WindowsMenuItemUI.isVistaPainting()) {</span>
<span class="nc" id="L659">                Skin skin = XPStyle.getXP().getSkin(null, Part.MP_POPUPSUBMENU);</span>
<span class="nc" id="L660">                return skin.getHeight();</span>
            } else {
<span class="nc" id="L662">                return 8;</span>
            }
        }
    } // End class MenuArrowIcon

<span class="nc" id="L667">    static class VistaMenuItemCheckIconFactory</span>
           implements MenuItemCheckIconFactory {
        private static final int OFFSET = 3;

        public Icon getIcon(JMenuItem component) {
<span class="nc" id="L672">            return new VistaMenuItemCheckIcon(component);</span>
        }

        public boolean isCompatible(Object icon, String prefix) {
<span class="nc bnc" id="L676" title="All 2 branches missed.">            return icon instanceof VistaMenuItemCheckIcon</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">              &amp;&amp; ((VistaMenuItemCheckIcon) icon).type == getType(prefix);</span>
        }

        public Icon getIcon(String type) {
<span class="nc" id="L681">            return new VistaMenuItemCheckIcon(type);</span>
        }

        static int getIconWidth() {
<span class="nc" id="L685">            return XPStyle.getXP().getSkin(null, Part.MP_POPUPCHECK).getWidth()</span>
                + 2 * OFFSET;
        }

        private static Class&lt;? extends JMenuItem&gt; getType(Component c) {
<span class="nc" id="L690">            Class&lt;? extends JMenuItem&gt; rv = null;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">            if (c instanceof JCheckBoxMenuItem) {</span>
<span class="nc" id="L692">                rv = JCheckBoxMenuItem.class;</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">            } else if (c instanceof JRadioButtonMenuItem) {</span>
<span class="nc" id="L694">                rv = JRadioButtonMenuItem.class;</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">            } else if (c instanceof JMenu) {</span>
<span class="nc" id="L696">                rv = JMenu.class;</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">            } else if (c instanceof JMenuItem) {</span>
<span class="nc" id="L698">                rv = JMenuItem.class;</span>
            }
<span class="nc" id="L700">            return rv;</span>
        }

        private static Class&lt;? extends JMenuItem&gt; getType(String type) {
<span class="nc" id="L704">            Class&lt;? extends JMenuItem&gt; rv = null;</span>
<span class="nc bnc" id="L705" title="All 2 branches missed.">            if (type == &quot;CheckBoxMenuItem&quot;) {</span>
<span class="nc" id="L706">                rv = JCheckBoxMenuItem.class;</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">            } else if (type == &quot;RadioButtonMenuItem&quot;) {</span>
<span class="nc" id="L708">                rv = JRadioButtonMenuItem.class;</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">            } else if (type == &quot;Menu&quot;) {</span>
<span class="nc" id="L710">                rv = JMenu.class;</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">            } else if (type == &quot;MenuItem&quot;) {</span>
<span class="nc" id="L712">                rv = JMenuItem.class;</span>
            } else {
                // this should never happen
<span class="nc" id="L715">                rv = JMenuItem.class;</span>
            }
<span class="nc" id="L717">            return rv;</span>
        }

        /**
         * CheckIcon for JMenuItem, JMenu, JCheckBoxMenuItem and
         * JRadioButtonMenuItem.
         * Note: to be used on Vista only.
         */
<span class="nc bnc" id="L725" title="All 2 branches missed.">        private static class VistaMenuItemCheckIcon</span>
              implements Icon, UIResource, Serializable {

            private final JMenuItem menuItem;
            private final Class&lt;? extends JMenuItem&gt; type;

<span class="nc" id="L731">            VistaMenuItemCheckIcon(JMenuItem menuItem) {</span>
<span class="nc" id="L732">                this.type = getType(menuItem);</span>
<span class="nc" id="L733">                this.menuItem = menuItem;</span>
<span class="nc" id="L734">            }</span>
<span class="nc" id="L735">            VistaMenuItemCheckIcon(String type) {</span>
<span class="nc" id="L736">                this.type = getType(type);</span>
<span class="nc" id="L737">                this.menuItem = null;</span>
<span class="nc" id="L738">            }</span>

            public int getIconHeight() {
<span class="nc" id="L741">                Icon lafIcon = getLaFIcon();</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">                if (lafIcon != null) {</span>
<span class="nc" id="L743">                    return lafIcon.getIconHeight();</span>
                }
<span class="nc" id="L745">                Icon icon = getIcon();</span>
<span class="nc" id="L746">                int height = 0;</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">                if (icon != null) {</span>
<span class="nc" id="L748">                    height = icon.getIconHeight() + 2 * OFFSET;</span>
                } else {
                    Skin skin =
<span class="nc" id="L751">                        XPStyle.getXP().getSkin(null, Part.MP_POPUPCHECK);</span>
<span class="nc" id="L752">                    height = skin.getHeight() + 2 * OFFSET;</span>
                }
<span class="nc" id="L754">                return height;</span>
            }

            public int getIconWidth() {
<span class="nc" id="L758">                Icon lafIcon = getLaFIcon();</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">                if (lafIcon != null) {</span>
<span class="nc" id="L760">                    return lafIcon.getIconWidth();</span>
                }
<span class="nc" id="L762">                Icon icon = getIcon();</span>
<span class="nc" id="L763">                int width = 0;</span>
<span class="nc bnc" id="L764" title="All 2 branches missed.">                if (icon != null) {</span>
<span class="nc" id="L765">                    width = icon.getIconWidth() + 2 * OFFSET;</span>
                } else {
<span class="nc" id="L767">                    width = VistaMenuItemCheckIconFactory.getIconWidth();</span>
                }
<span class="nc" id="L769">                return width;</span>
            }

            public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L773">                Icon lafIcon = getLaFIcon();</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">                if (lafIcon != null) {</span>
<span class="nc" id="L775">                    lafIcon.paintIcon(c, g, x, y);</span>
<span class="nc" id="L776">                    return;</span>
                }
<span class="nc bnc" id="L778" title="All 6 branches missed.">                assert menuItem == null || c == menuItem;</span>
<span class="nc" id="L779">                Icon icon = getIcon();</span>
<span class="nc bnc" id="L780" title="All 4 branches missed.">                if (type == JCheckBoxMenuItem.class</span>
                      || type == JRadioButtonMenuItem.class) {
<span class="nc" id="L782">                    AbstractButton b = (AbstractButton) c;</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">                    if (b.isSelected()) {</span>
<span class="nc" id="L784">                        Part backgroundPart = Part.MP_POPUPCHECKBACKGROUND;</span>
<span class="nc" id="L785">                        Part part = Part.MP_POPUPCHECK;</span>
                        State backgroundState;
                        State state;
<span class="nc bnc" id="L788" title="All 2 branches missed.">                        if (isEnabled(c, null)) {</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">                            backgroundState =</span>
                                (icon != null) ? State.BITMAP : State.NORMAL;
<span class="nc bnc" id="L791" title="All 2 branches missed.">                            state = (type == JRadioButtonMenuItem.class)</span>
                              ? State.BULLETNORMAL
                              : State.CHECKMARKNORMAL;
                        } else {
<span class="nc" id="L795">                            backgroundState = State.DISABLEDPUSHED;</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">                            state =</span>
                                (type == JRadioButtonMenuItem.class)
                                  ? State.BULLETDISABLED
                                  : State.CHECKMARKDISABLED;
                        }
                        Skin skin;
<span class="nc" id="L802">                        XPStyle xp = XPStyle.getXP();</span>
<span class="nc" id="L803">                        skin =  xp.getSkin(c, backgroundPart);</span>
<span class="nc" id="L804">                        skin.paintSkin(g, x, y,</span>
<span class="nc" id="L805">                            getIconWidth(), getIconHeight(), backgroundState);</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">                        if (icon == null) {</span>
<span class="nc" id="L807">                            skin = xp.getSkin(c, part);</span>
<span class="nc" id="L808">                            skin.paintSkin(g, x + OFFSET, y + OFFSET, state);</span>
                        }
                    }
                }
<span class="nc bnc" id="L812" title="All 2 branches missed.">                if (icon != null) {</span>
<span class="nc" id="L813">                    icon.paintIcon(c, g, x + OFFSET, y + OFFSET);</span>
                }
<span class="nc" id="L815">            }</span>
            private static WindowsMenuItemUIAccessor getAccessor(
                    JMenuItem menuItem) {
<span class="nc" id="L818">                WindowsMenuItemUIAccessor rv = null;</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">                ButtonUI uiObject = (menuItem != null) ? menuItem.getUI()</span>
                        : null;
<span class="nc bnc" id="L821" title="All 2 branches missed.">                if (uiObject instanceof WindowsMenuItemUI) {</span>
<span class="nc" id="L822">                    rv = ((WindowsMenuItemUI) uiObject).accessor;</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">                } else if (uiObject instanceof WindowsMenuUI) {</span>
<span class="nc" id="L824">                    rv = ((WindowsMenuUI) uiObject).accessor;</span>
<span class="nc bnc" id="L825" title="All 2 branches missed.">                } else if (uiObject instanceof WindowsCheckBoxMenuItemUI) {</span>
<span class="nc" id="L826">                    rv = ((WindowsCheckBoxMenuItemUI) uiObject).accessor;</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">                } else if (uiObject instanceof WindowsRadioButtonMenuItemUI) {</span>
<span class="nc" id="L828">                    rv = ((WindowsRadioButtonMenuItemUI) uiObject).accessor;</span>
                }
<span class="nc" id="L830">                return rv;</span>
            }

            private static boolean isEnabled(Component  c, State state) {
<span class="nc bnc" id="L834" title="All 4 branches missed.">                if (state == null &amp;&amp; c instanceof JMenuItem) {</span>
<span class="nc" id="L835">                    WindowsMenuItemUIAccessor accessor =</span>
<span class="nc" id="L836">                        getAccessor((JMenuItem) c);</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">                    if (accessor != null) {</span>
<span class="nc" id="L838">                        state = accessor.getState((JMenuItem) c);</span>
                    }
                }
<span class="nc bnc" id="L841" title="All 2 branches missed.">                if (state == null) {</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">                    if (c != null) {</span>
<span class="nc" id="L843">                        return c.isEnabled();</span>
                    } else {
<span class="nc" id="L845">                        return true;</span>
                    }
                } else {
<span class="nc bnc" id="L848" title="All 6 branches missed.">                    return (state != State.DISABLED)</span>
                        &amp;&amp; (state != State.DISABLEDHOT)
                        &amp;&amp; (state != State.DISABLEDPUSHED);
                }
            }
            private Icon getIcon() {
<span class="nc" id="L854">                Icon rv = null;</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">                if (menuItem == null) {</span>
<span class="nc" id="L856">                    return rv;</span>
                }
<span class="nc" id="L858">                WindowsMenuItemUIAccessor accessor =</span>
<span class="nc" id="L859">                    getAccessor(menuItem);</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">                State state = (accessor != null) ? accessor.getState(menuItem)</span>
                        : null;
<span class="nc bnc" id="L862" title="All 2 branches missed.">                if (isEnabled(menuItem, null)) {</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">                    if (state == State.PUSHED) {</span>
<span class="nc" id="L864">                        rv = menuItem.getPressedIcon();</span>
                    } else {
<span class="nc" id="L866">                        rv = menuItem.getIcon();</span>
                    }
                } else {
<span class="nc" id="L869">                    rv = menuItem.getDisabledIcon();</span>
                }
<span class="nc" id="L871">                return rv;</span>
            }
            /**
             * Check if developer changed icon in the UI table.
             *
             * @return the icon to use or {@code null} if the current one is to
             * be used
             */
            private Icon getLaFIcon() {
                // use icon from the UI table if it does not match this one.
<span class="nc" id="L881">                Icon rv = (Icon) UIManager.getDefaults().get(typeToString(type));</span>
<span class="nc bnc" id="L882" title="All 4 branches missed.">                if (rv instanceof VistaMenuItemCheckIcon</span>
                      &amp;&amp; ((VistaMenuItemCheckIcon) rv).type == type) {
<span class="nc" id="L884">                    rv = null;</span>
                }
<span class="nc" id="L886">                return rv;</span>
            }

            private static String typeToString(
                    Class&lt;? extends JMenuItem&gt; type) {
<span class="nc bnc" id="L891" title="All 10 branches missed.">                assert type == JMenuItem.class</span>
                    || type == JMenu.class
                    || type == JCheckBoxMenuItem.class
                    || type == JRadioButtonMenuItem.class;
<span class="nc" id="L895">                StringBuilder sb = new StringBuilder(type.getName());</span>
                // remove package name, dot and the first character
<span class="nc" id="L897">                sb.delete(0, sb.lastIndexOf(&quot;J&quot;) + 1);</span>
<span class="nc" id="L898">                sb.append(&quot;.checkIcon&quot;);</span>
<span class="nc" id="L899">                return sb.toString();</span>
            }
        }
    } // End class VistaMenuItemCheckIconFactory
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>