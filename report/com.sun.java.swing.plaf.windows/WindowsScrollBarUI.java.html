<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>WindowsScrollBarUI.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.windows</a> &gt; <span class="el_source">WindowsScrollBarUI.java</span></div><h1>WindowsScrollBarUI.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.java.swing.plaf.windows;

import java.awt.*;
import java.awt.event.*;
import java.awt.image.*;
import java.lang.ref.*;
import java.util.*;
import javax.swing.plaf.basic.*;
import javax.swing.*;
import javax.swing.plaf.ComponentUI;

import static com.sun.java.swing.plaf.windows.TMSchema.*;
import static com.sun.java.swing.plaf.windows.XPStyle.Skin;


/**
 * Windows rendition of the component.
 * &lt;p&gt;
 * &lt;strong&gt;Warning:&lt;/strong&gt;
 * Serialized objects of this class will not be compatible with
 * future Swing releases.  The current serialization support is appropriate
 * for short term storage or RMI between applications running the same
 * version of Swing.  A future release of Swing will provide support for
 * long term persistence.
 */
<span class="nc" id="L51">public class WindowsScrollBarUI extends BasicScrollBarUI {</span>
    private Grid thumbGrid;
    private Grid highlightGrid;

    /**
     * Creates a UI for a JScrollBar.
     *
     * @param c the text field
     * @return the UI
     */
    public static ComponentUI createUI(JComponent c) {
<span class="nc" id="L62">        return new WindowsScrollBarUI();</span>
    }

    protected void installDefaults() {
<span class="nc" id="L66">        super.installDefaults();</span>

<span class="nc bnc" id="L68" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L69">            scrollbar.setBorder(null);</span>
        }
<span class="nc" id="L71">    }</span>

    public void uninstallUI(JComponent c) {
<span class="nc" id="L74">        super.uninstallUI(c);</span>
<span class="nc" id="L75">        thumbGrid = highlightGrid = null;</span>
<span class="nc" id="L76">    }</span>

    protected void configureScrollBarColors() {
<span class="nc" id="L79">        super.configureScrollBarColors();</span>
<span class="nc" id="L80">        Color color = UIManager.getColor(&quot;ScrollBar.trackForeground&quot;);</span>
<span class="nc bnc" id="L81" title="All 4 branches missed.">        if (color != null &amp;&amp; trackColor != null) {</span>
<span class="nc" id="L82">            thumbGrid = Grid.getGrid(color, trackColor);</span>
        }

<span class="nc" id="L85">        color = UIManager.getColor(&quot;ScrollBar.trackHighlightForeground&quot;);</span>
<span class="nc bnc" id="L86" title="All 4 branches missed.">        if (color != null &amp;&amp; trackHighlightColor != null) {</span>
<span class="nc" id="L87">            highlightGrid = Grid.getGrid(color, trackHighlightColor);</span>
        }
<span class="nc" id="L89">    }</span>

    protected JButton createDecreaseButton(int orientation)  {
<span class="nc" id="L92">        return new WindowsArrowButton(orientation,</span>
<span class="nc" id="L93">                                    UIManager.getColor(&quot;ScrollBar.thumb&quot;),</span>
<span class="nc" id="L94">                                    UIManager.getColor(&quot;ScrollBar.thumbShadow&quot;),</span>
<span class="nc" id="L95">                                    UIManager.getColor(&quot;ScrollBar.thumbDarkShadow&quot;),</span>
<span class="nc" id="L96">                                    UIManager.getColor(&quot;ScrollBar.thumbHighlight&quot;));</span>
    }

    protected JButton createIncreaseButton(int orientation)  {
<span class="nc" id="L100">        return new WindowsArrowButton(orientation,</span>
<span class="nc" id="L101">                                    UIManager.getColor(&quot;ScrollBar.thumb&quot;),</span>
<span class="nc" id="L102">                                    UIManager.getColor(&quot;ScrollBar.thumbShadow&quot;),</span>
<span class="nc" id="L103">                                    UIManager.getColor(&quot;ScrollBar.thumbDarkShadow&quot;),</span>
<span class="nc" id="L104">                                    UIManager.getColor(&quot;ScrollBar.thumbHighlight&quot;));</span>
    }

    /**
     * {@inheritDoc}
     * @since 1.6
     */
    @Override
    protected ArrowButtonListener createArrowButtonListener(){
        // we need to repaint the entire scrollbar because state change for each
        // button causes a state change for the thumb and other button on Vista
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if(XPStyle.isVista()) {</span>
<span class="nc" id="L116">            return new ArrowButtonListener() {</span>
                public void mouseEntered(MouseEvent evt) {
<span class="nc" id="L118">                    repaint();</span>
<span class="nc" id="L119">                    super.mouseEntered(evt);</span>
<span class="nc" id="L120">                }</span>
                public void mouseExited(MouseEvent evt) {
<span class="nc" id="L122">                    repaint();</span>
<span class="nc" id="L123">                    super.mouseExited(evt);</span>
<span class="nc" id="L124">                }</span>
                private void repaint() {
<span class="nc" id="L126">                    scrollbar.repaint();</span>
<span class="nc" id="L127">                }</span>
            };
        } else {
<span class="nc" id="L130">            return super.createArrowButtonListener();</span>
        }
    }

    protected void paintTrack(Graphics g, JComponent c, Rectangle trackBounds){
<span class="nc bnc" id="L135" title="All 2 branches missed.">        boolean v = (scrollbar.getOrientation() == JScrollBar.VERTICAL);</span>

<span class="nc" id="L137">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (xp != null) {</span>
<span class="nc" id="L139">            JScrollBar sb = (JScrollBar)c;</span>
<span class="nc" id="L140">            State state = State.NORMAL;</span>
            // Pending: Implement rollover (hot) and pressed
<span class="nc bnc" id="L142" title="All 2 branches missed.">            if (!sb.isEnabled()) {</span>
<span class="nc" id="L143">                state = State.DISABLED;</span>
            }
<span class="nc bnc" id="L145" title="All 2 branches missed.">            Part part = v ? Part.SBP_LOWERTRACKVERT : Part.SBP_LOWERTRACKHORZ;</span>
<span class="nc" id="L146">            xp.getSkin(sb, part).paintSkin(g, trackBounds, state);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        } else if (thumbGrid == null) {</span>
<span class="nc" id="L148">            super.paintTrack(g, c, trackBounds);</span>
        }
        else {
<span class="nc" id="L151">            thumbGrid.paint(g, trackBounds.x, trackBounds.y, trackBounds.width,</span>
                            trackBounds.height);
<span class="nc bnc" id="L153" title="All 2 branches missed.">            if (trackHighlight == DECREASE_HIGHLIGHT) {</span>
<span class="nc" id="L154">                paintDecreaseHighlight(g);</span>
            }
<span class="nc bnc" id="L156" title="All 2 branches missed.">            else if (trackHighlight == INCREASE_HIGHLIGHT) {</span>
<span class="nc" id="L157">                paintIncreaseHighlight(g);</span>
            }
        }
<span class="nc" id="L160">    }</span>

    protected void paintThumb(Graphics g, JComponent c, Rectangle thumbBounds) {
<span class="nc bnc" id="L163" title="All 2 branches missed.">        boolean v = (scrollbar.getOrientation() == JScrollBar.VERTICAL);</span>

<span class="nc" id="L165">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (xp != null) {</span>
<span class="nc" id="L167">            JScrollBar sb = (JScrollBar)c;</span>
<span class="nc" id="L168">            State state = State.NORMAL;</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (!sb.isEnabled()) {</span>
<span class="nc" id="L170">                state = State.DISABLED;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">            } else if (isDragging) {</span>
<span class="nc" id="L172">                state = State.PRESSED;</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            } else if (isThumbRollover()) {</span>
<span class="nc" id="L174">                state = State.HOT;</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            } else if (XPStyle.isVista()) {</span>
<span class="nc bnc" id="L176" title="All 6 branches missed.">                if ((incrButton != null &amp;&amp; incrButton.getModel().isRollover()) ||</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                    (decrButton != null &amp;&amp; decrButton.getModel().isRollover())) {</span>
<span class="nc" id="L178">                    state = State.HOVER;</span>
                }
            }
            // Paint thumb
<span class="nc bnc" id="L182" title="All 2 branches missed.">            Part thumbPart = v ? Part.SBP_THUMBBTNVERT : Part.SBP_THUMBBTNHORZ;</span>
<span class="nc" id="L183">            xp.getSkin(sb, thumbPart).paintSkin(g, thumbBounds, state);</span>
            // Paint gripper
<span class="nc bnc" id="L185" title="All 2 branches missed.">            Part gripperPart = v ? Part.SBP_GRIPPERVERT : Part.SBP_GRIPPERHORZ;</span>
<span class="nc" id="L186">            Skin skin = xp.getSkin(sb, gripperPart);</span>
<span class="nc" id="L187">            Insets gripperInsets = xp.getMargin(c, thumbPart, null, Prop.CONTENTMARGINS);</span>
<span class="nc bnc" id="L188" title="All 4 branches missed.">            if (gripperInsets == null ||</span>
                (v &amp;&amp; (thumbBounds.height - gripperInsets.top -
<span class="nc bnc" id="L190" title="All 4 branches missed.">                       gripperInsets.bottom &gt;= skin.getHeight())) ||</span>
                (!v &amp;&amp; (thumbBounds.width - gripperInsets.left -
<span class="nc bnc" id="L192" title="All 2 branches missed.">                        gripperInsets.right &gt;= skin.getWidth()))) {</span>
<span class="nc" id="L193">                skin.paintSkin(g,</span>
<span class="nc" id="L194">                               thumbBounds.x + (thumbBounds.width  - skin.getWidth()) / 2,</span>
<span class="nc" id="L195">                               thumbBounds.y + (thumbBounds.height - skin.getHeight()) / 2,</span>
<span class="nc" id="L196">                               skin.getWidth(), skin.getHeight(), state);</span>
            }
<span class="nc" id="L198">        } else {</span>
<span class="nc" id="L199">            super.paintThumb(g, c, thumbBounds);</span>
        }
<span class="nc" id="L201">    }</span>


    protected void paintDecreaseHighlight(Graphics g) {
<span class="nc bnc" id="L205" title="All 2 branches missed.">        if (highlightGrid == null) {</span>
<span class="nc" id="L206">            super.paintDecreaseHighlight(g);</span>
        }
        else {
<span class="nc" id="L209">            Insets insets = scrollbar.getInsets();</span>
<span class="nc" id="L210">            Rectangle thumbR = getThumbBounds();</span>
            int x, y, w, h;

<span class="nc bnc" id="L213" title="All 2 branches missed.">            if (scrollbar.getOrientation() == JScrollBar.VERTICAL) {</span>
<span class="nc" id="L214">                x = insets.left;</span>
<span class="nc" id="L215">                y = decrButton.getY() + decrButton.getHeight();</span>
<span class="nc" id="L216">                w = scrollbar.getWidth() - (insets.left + insets.right);</span>
<span class="nc" id="L217">                h = thumbR.y - y;</span>
            }
            else {
<span class="nc" id="L220">                x = decrButton.getX() + decrButton.getHeight();</span>
<span class="nc" id="L221">                y = insets.top;</span>
<span class="nc" id="L222">                w = thumbR.x - x;</span>
<span class="nc" id="L223">                h = scrollbar.getHeight() - (insets.top + insets.bottom);</span>
            }
<span class="nc" id="L225">            highlightGrid.paint(g, x, y, w, h);</span>
        }
<span class="nc" id="L227">    }</span>


    protected void paintIncreaseHighlight(Graphics g) {
<span class="nc bnc" id="L231" title="All 2 branches missed.">        if (highlightGrid == null) {</span>
<span class="nc" id="L232">            super.paintDecreaseHighlight(g);</span>
        }
        else {
<span class="nc" id="L235">            Insets insets = scrollbar.getInsets();</span>
<span class="nc" id="L236">            Rectangle thumbR = getThumbBounds();</span>
            int x, y, w, h;

<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (scrollbar.getOrientation() == JScrollBar.VERTICAL) {</span>
<span class="nc" id="L240">                x = insets.left;</span>
<span class="nc" id="L241">                y = thumbR.y + thumbR.height;</span>
<span class="nc" id="L242">                w = scrollbar.getWidth() - (insets.left + insets.right);</span>
<span class="nc" id="L243">                h = incrButton.getY() - y;</span>
            }
            else {
<span class="nc" id="L246">                x = thumbR.x + thumbR.width;</span>
<span class="nc" id="L247">                y = insets.top;</span>
<span class="nc" id="L248">                w = incrButton.getX() - x;</span>
<span class="nc" id="L249">                h = scrollbar.getHeight() - (insets.top + insets.bottom);</span>
            }
<span class="nc" id="L251">            highlightGrid.paint(g, x, y, w, h);</span>
        }
<span class="nc" id="L253">    }</span>


    /**
     * {@inheritDoc}
     * @since 1.6
     */
    @Override
    protected void setThumbRollover(boolean active) {
<span class="nc" id="L262">        boolean old = isThumbRollover();</span>
<span class="nc" id="L263">        super.setThumbRollover(active);</span>
        // we need to repaint the entire scrollbar because state change for thumb
        // causes state change for incr and decr buttons on Vista
<span class="nc bnc" id="L266" title="All 4 branches missed.">        if(XPStyle.isVista() &amp;&amp; active != old) {</span>
<span class="nc" id="L267">            scrollbar.repaint();</span>
        }
<span class="nc" id="L269">    }</span>

    /**
     * WindowsArrowButton is used for the buttons to position the
     * document up/down. It differs from BasicArrowButton in that the
     * preferred size is always a square.
     */
    private class WindowsArrowButton extends BasicArrowButton {

        public WindowsArrowButton(int direction, Color background, Color shadow,
<span class="nc" id="L279">                         Color darkShadow, Color highlight) {</span>
<span class="nc" id="L280">            super(direction, background, shadow, darkShadow, highlight);</span>
<span class="nc" id="L281">        }</span>

<span class="nc" id="L283">        public WindowsArrowButton(int direction) {</span>
<span class="nc" id="L284">            super(direction);</span>
<span class="nc" id="L285">        }</span>

        public void paint(Graphics g) {
<span class="nc" id="L288">            XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L290">                ButtonModel model = getModel();</span>
<span class="nc" id="L291">                Skin skin = xp.getSkin(this, Part.SBP_ARROWBTN);</span>
<span class="nc" id="L292">                State state = null;</span>

<span class="nc bnc" id="L294" title="All 4 branches missed.">                boolean jointRollover = XPStyle.isVista() &amp;&amp; (isThumbRollover() ||</span>
<span class="nc bnc" id="L295" title="All 4 branches missed.">                    (this == incrButton &amp;&amp; decrButton.getModel().isRollover()) ||</span>
<span class="nc bnc" id="L296" title="All 4 branches missed.">                    (this == decrButton &amp;&amp; incrButton.getModel().isRollover()));</span>

                // normal, rollover, pressed, disabled
<span class="nc bnc" id="L299" title="All 4 branches missed.">                if (model.isArmed() &amp;&amp; model.isPressed()) {</span>
<span class="nc bnc" id="L300" title="All 5 branches missed.">                    switch (direction) {</span>
<span class="nc" id="L301">                        case NORTH: state = State.UPPRESSED;    break;</span>
<span class="nc" id="L302">                        case SOUTH: state = State.DOWNPRESSED;  break;</span>
<span class="nc" id="L303">                        case WEST:  state = State.LEFTPRESSED;  break;</span>
<span class="nc" id="L304">                        case EAST:  state = State.RIGHTPRESSED; break;</span>
                    }
<span class="nc bnc" id="L306" title="All 2 branches missed.">                } else if (!model.isEnabled()) {</span>
<span class="nc bnc" id="L307" title="All 5 branches missed.">                    switch (direction) {</span>
<span class="nc" id="L308">                        case NORTH: state = State.UPDISABLED;    break;</span>
<span class="nc" id="L309">                        case SOUTH: state = State.DOWNDISABLED;  break;</span>
<span class="nc" id="L310">                        case WEST:  state = State.LEFTDISABLED;  break;</span>
<span class="nc" id="L311">                        case EAST:  state = State.RIGHTDISABLED; break;</span>
                    }
<span class="nc bnc" id="L313" title="All 4 branches missed.">                } else if (model.isRollover() || model.isPressed()) {</span>
<span class="nc bnc" id="L314" title="All 5 branches missed.">                    switch (direction) {</span>
<span class="nc" id="L315">                        case NORTH: state = State.UPHOT;    break;</span>
<span class="nc" id="L316">                        case SOUTH: state = State.DOWNHOT;  break;</span>
<span class="nc" id="L317">                        case WEST:  state = State.LEFTHOT;  break;</span>
<span class="nc" id="L318">                        case EAST:  state = State.RIGHTHOT; break;</span>
                    }
<span class="nc bnc" id="L320" title="All 2 branches missed.">                } else if (jointRollover) {</span>
<span class="nc bnc" id="L321" title="All 5 branches missed.">                    switch (direction) {</span>
<span class="nc" id="L322">                        case NORTH: state = State.UPHOVER;    break;</span>
<span class="nc" id="L323">                        case SOUTH: state = State.DOWNHOVER;  break;</span>
<span class="nc" id="L324">                        case WEST:  state = State.LEFTHOVER;  break;</span>
<span class="nc" id="L325">                        case EAST:  state = State.RIGHTHOVER; break;</span>
                    }
                } else {
<span class="nc bnc" id="L328" title="All 5 branches missed.">                    switch (direction) {</span>
<span class="nc" id="L329">                        case NORTH: state = State.UPNORMAL;    break;</span>
<span class="nc" id="L330">                        case SOUTH: state = State.DOWNNORMAL;  break;</span>
<span class="nc" id="L331">                        case WEST:  state = State.LEFTNORMAL;  break;</span>
<span class="nc" id="L332">                        case EAST:  state = State.RIGHTNORMAL; break;</span>
                    }
                }

<span class="nc" id="L336">                skin.paintSkin(g, 0, 0, getWidth(), getHeight(), state);</span>
<span class="nc" id="L337">            } else {</span>
<span class="nc" id="L338">                super.paint(g);</span>
            }
<span class="nc" id="L340">        }</span>

        public Dimension getPreferredSize() {
<span class="nc" id="L343">            int size = 16;</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">            if (scrollbar != null) {</span>
<span class="nc bnc" id="L345" title="All 3 branches missed.">                switch (scrollbar.getOrientation()) {</span>
                case JScrollBar.VERTICAL:
<span class="nc" id="L347">                    size = scrollbar.getWidth();</span>
<span class="nc" id="L348">                    break;</span>
                case JScrollBar.HORIZONTAL:
<span class="nc" id="L350">                    size = scrollbar.getHeight();</span>
                    break;
                }
<span class="nc" id="L353">                size = Math.max(size, 5);</span>
            }
<span class="nc" id="L355">            return new Dimension(size, size);</span>
        }
    }


    /**
     * This should be pulled out into its own class if more classes need to
     * use it.
     * &lt;p&gt;
     * Grid is used to draw the track for windows scrollbars. Grids
     * are cached in a HashMap, with the key being the rgb components
     * of the foreground/background colors. Further the Grid is held through
     * a WeakRef so that it can be freed when no longer needed. As the
     * Grid is rather expensive to draw, it is drawn in a BufferedImage.
     */
<span class="nc" id="L370">    private static class Grid {</span>
        private static final int BUFFER_SIZE = 64;
        private static HashMap&lt;String, WeakReference&lt;Grid&gt;&gt; map;

        private BufferedImage image;

        static {
<span class="nc" id="L377">            map = new HashMap&lt;String, WeakReference&lt;Grid&gt;&gt;();</span>
<span class="nc" id="L378">        }</span>

        public static Grid getGrid(Color fg, Color bg) {
<span class="nc" id="L381">            String key = fg.getRGB() + &quot; &quot; + bg.getRGB();</span>
<span class="nc" id="L382">            WeakReference&lt;Grid&gt; ref = map.get(key);</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">            Grid grid = (ref == null) ? null : ref.get();</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">            if (grid == null) {</span>
<span class="nc" id="L385">                grid = new Grid(fg, bg);</span>
<span class="nc" id="L386">                map.put(key, new WeakReference&lt;Grid&gt;(grid));</span>
            }
<span class="nc" id="L388">            return grid;</span>
        }

<span class="nc" id="L391">        public Grid(Color fg, Color bg) {</span>
<span class="nc" id="L392">            int cmap[] = { fg.getRGB(), bg.getRGB() };</span>
<span class="nc" id="L393">            IndexColorModel icm = new IndexColorModel(8, 2, cmap, 0, false, -1,</span>
                                                      DataBuffer.TYPE_BYTE);
<span class="nc" id="L395">            image = new BufferedImage(BUFFER_SIZE, BUFFER_SIZE,</span>
                                      BufferedImage.TYPE_BYTE_INDEXED, icm);
<span class="nc" id="L397">            Graphics g = image.getGraphics();</span>
            try {
<span class="nc" id="L399">                g.setClip(0, 0, BUFFER_SIZE, BUFFER_SIZE);</span>
<span class="nc" id="L400">                paintGrid(g, fg, bg);</span>
            }
            finally {
<span class="nc" id="L403">                g.dispose();</span>
<span class="nc" id="L404">            }</span>
<span class="nc" id="L405">        }</span>

        /**
         * Paints the grid into the specified Graphics at the specified
         * location.
         */
        public void paint(Graphics g, int x, int y, int w, int h) {
<span class="nc" id="L412">            Rectangle clipRect = g.getClipBounds();</span>
<span class="nc" id="L413">            int minX = Math.max(x, clipRect.x);</span>
<span class="nc" id="L414">            int minY = Math.max(y, clipRect.y);</span>
<span class="nc" id="L415">            int maxX = Math.min(clipRect.x + clipRect.width, x + w);</span>
<span class="nc" id="L416">            int maxY = Math.min(clipRect.y + clipRect.height, y + h);</span>

<span class="nc bnc" id="L418" title="All 4 branches missed.">            if (maxX &lt;= minX || maxY &lt;= minY) {</span>
<span class="nc" id="L419">                return;</span>
            }
<span class="nc" id="L421">            int xOffset = (minX - x) % 2;</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">            for (int xCounter = minX; xCounter &lt; maxX;</span>
<span class="nc" id="L423">                 xCounter += BUFFER_SIZE) {</span>
<span class="nc" id="L424">                int yOffset = (minY - y) % 2;</span>
<span class="nc" id="L425">                int width = Math.min(BUFFER_SIZE - xOffset,</span>
                                     maxX - xCounter);

<span class="nc bnc" id="L428" title="All 2 branches missed.">                for (int yCounter = minY; yCounter &lt; maxY;</span>
<span class="nc" id="L429">                     yCounter += BUFFER_SIZE) {</span>
<span class="nc" id="L430">                    int height = Math.min(BUFFER_SIZE - yOffset,</span>
                                          maxY - yCounter);

<span class="nc" id="L433">                    g.drawImage(image, xCounter, yCounter,</span>
                                xCounter + width, yCounter + height,
                                xOffset, yOffset,
                                xOffset + width, yOffset + height, null);
<span class="nc bnc" id="L437" title="All 2 branches missed.">                    if (yOffset != 0) {</span>
<span class="nc" id="L438">                        yCounter -= yOffset;</span>
<span class="nc" id="L439">                        yOffset = 0;</span>
                    }
                }
<span class="nc bnc" id="L442" title="All 2 branches missed.">                if (xOffset != 0) {</span>
<span class="nc" id="L443">                    xCounter -= xOffset;</span>
<span class="nc" id="L444">                    xOffset = 0;</span>
                }
            }
<span class="nc" id="L447">        }</span>

        /**
         * Actually renders the grid into the Graphics &lt;code&gt;g&lt;/code&gt;.
         */
        private void paintGrid(Graphics g, Color fg, Color bg) {
<span class="nc" id="L453">            Rectangle clipRect = g.getClipBounds();</span>
<span class="nc" id="L454">            g.setColor(bg);</span>
<span class="nc" id="L455">            g.fillRect(clipRect.x, clipRect.y, clipRect.width,</span>
                       clipRect.height);
<span class="nc" id="L457">            g.setColor(fg);</span>
<span class="nc" id="L458">            g.translate(clipRect.x, clipRect.y);</span>
<span class="nc" id="L459">            int width = clipRect.width;</span>
<span class="nc" id="L460">            int height = clipRect.height;</span>
<span class="nc" id="L461">            int xCounter = clipRect.x % 2;</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">            for (int end = width - height; xCounter &lt; end; xCounter += 2) {</span>
<span class="nc" id="L463">                g.drawLine(xCounter, 0, xCounter + height, height);</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">            for (int end = width; xCounter &lt; end; xCounter += 2) {</span>
<span class="nc" id="L466">                g.drawLine(xCounter, 0, width, width - xCounter);</span>
            }

<span class="nc bnc" id="L469" title="All 2 branches missed.">            int yCounter = ((clipRect.x % 2) == 0) ? 2 : 1;</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">            for (int end = height - width; yCounter &lt; end; yCounter += 2) {</span>
<span class="nc" id="L471">                g.drawLine(0, yCounter, width, yCounter + width);</span>
            }
<span class="nc bnc" id="L473" title="All 2 branches missed.">            for (int end = height; yCounter &lt; end; yCounter += 2) {</span>
<span class="nc" id="L474">                g.drawLine(0, yCounter, height - yCounter, height);</span>
            }
<span class="nc" id="L476">            g.translate(-clipRect.x, -clipRect.y);</span>
<span class="nc" id="L477">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>