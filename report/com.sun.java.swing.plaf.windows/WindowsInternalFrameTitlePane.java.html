<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>WindowsInternalFrameTitlePane.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.java.swing.plaf.windows</a> &gt; <span class="el_source">WindowsInternalFrameTitlePane.java</span></div><h1>WindowsInternalFrameTitlePane.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2001, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */

package com.sun.java.swing.plaf.windows;

import sun.swing.SwingUtilities2;

import javax.swing.*;
import javax.swing.border.*;
import javax.swing.UIManager;
import javax.swing.plaf.*;
import javax.swing.plaf.basic.BasicInternalFrameTitlePane;
import java.awt.*;
import java.awt.event.*;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.beans.PropertyVetoException;

import static com.sun.java.swing.plaf.windows.TMSchema.*;
import static com.sun.java.swing.plaf.windows.XPStyle.Skin;

public class WindowsInternalFrameTitlePane extends BasicInternalFrameTitlePane {
    private Color selectedTitleGradientColor;
    private Color notSelectedTitleGradientColor;
    private JPopupMenu systemPopupMenu;
    private JLabel systemLabel;

    private Font titleFont;
    private int titlePaneHeight;
    private int buttonWidth, buttonHeight;
    private boolean hotTrackingOn;

    public WindowsInternalFrameTitlePane(JInternalFrame f) {
<span class="nc" id="L56">        super(f);</span>
<span class="nc" id="L57">    }</span>

    protected void addSubComponents() {
<span class="nc" id="L60">        add(systemLabel);</span>
<span class="nc" id="L61">        add(iconButton);</span>
<span class="nc" id="L62">        add(maxButton);</span>
<span class="nc" id="L63">        add(closeButton);</span>
<span class="nc" id="L64">    }</span>

    protected void installDefaults() {
<span class="nc" id="L67">        super.installDefaults();</span>

<span class="nc" id="L69">        titlePaneHeight = UIManager.getInt(&quot;InternalFrame.titlePaneHeight&quot;);</span>
<span class="nc" id="L70">        buttonWidth     = UIManager.getInt(&quot;InternalFrame.titleButtonWidth&quot;)  - 4;</span>
<span class="nc" id="L71">        buttonHeight    = UIManager.getInt(&quot;InternalFrame.titleButtonHeight&quot;) - 4;</span>

<span class="nc" id="L73">        Object obj      = UIManager.get(&quot;InternalFrame.titleButtonToolTipsOn&quot;);</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">        hotTrackingOn = (obj instanceof Boolean) ? (Boolean)obj : true;</span>


<span class="nc bnc" id="L77" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
            // Fix for XP bug where sometimes these sizes aren't updated properly
            // Assume for now that height is correct and derive width using the
            // ratio from the uxtheme part
<span class="nc" id="L81">            buttonWidth = buttonHeight;</span>
<span class="nc" id="L82">            Dimension d = XPStyle.getPartSize(Part.WP_CLOSEBUTTON, State.NORMAL);</span>
<span class="nc bnc" id="L83" title="All 6 branches missed.">            if (d != null &amp;&amp; d.width != 0 &amp;&amp; d.height != 0) {</span>
<span class="nc" id="L84">                buttonWidth = (int) ((float) buttonWidth * d.width / d.height);</span>
            }
<span class="nc" id="L86">        } else {</span>
<span class="nc" id="L87">            buttonWidth += 2;</span>
<span class="nc" id="L88">            selectedTitleGradientColor =</span>
<span class="nc" id="L89">                    UIManager.getColor(&quot;InternalFrame.activeTitleGradient&quot;);</span>
<span class="nc" id="L90">            notSelectedTitleGradientColor =</span>
<span class="nc" id="L91">                    UIManager.getColor(&quot;InternalFrame.inactiveTitleGradient&quot;);</span>
<span class="nc" id="L92">            Color activeBorderColor =</span>
<span class="nc" id="L93">                    UIManager.getColor(&quot;InternalFrame.activeBorderColor&quot;);</span>
<span class="nc" id="L94">            setBorder(BorderFactory.createLineBorder(activeBorderColor, 1));</span>
        }
<span class="nc" id="L96">    }</span>

    protected void uninstallListeners() {
        // Get around protected method in superclass
<span class="nc" id="L100">        super.uninstallListeners();</span>
<span class="nc" id="L101">    }</span>

    protected void createButtons() {
<span class="nc" id="L104">        super.createButtons();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (XPStyle.getXP() != null) {</span>
<span class="nc" id="L106">            iconButton.setContentAreaFilled(false);</span>
<span class="nc" id="L107">            maxButton.setContentAreaFilled(false);</span>
<span class="nc" id="L108">            closeButton.setContentAreaFilled(false);</span>
        }
<span class="nc" id="L110">    }</span>

    protected void setButtonIcons() {
<span class="nc" id="L113">        super.setButtonIcons();</span>

<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (!hotTrackingOn) {</span>
<span class="nc" id="L116">            iconButton.setToolTipText(null);</span>
<span class="nc" id="L117">            maxButton.setToolTipText(null);</span>
<span class="nc" id="L118">            closeButton.setToolTipText(null);</span>
        }
<span class="nc" id="L120">    }</span>


    public void paintComponent(Graphics g)  {
<span class="nc" id="L124">        XPStyle xp = XPStyle.getXP();</span>

<span class="nc" id="L126">        paintTitleBackground(g);</span>

<span class="nc" id="L128">        String title = frame.getTitle();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (title != null) {</span>
<span class="nc" id="L130">            boolean isSelected = frame.isSelected();</span>
<span class="nc" id="L131">            Font oldFont = g.getFont();</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">            Font newFont = (titleFont != null) ? titleFont : getFont();</span>
<span class="nc" id="L133">            g.setFont(newFont);</span>

            // Center text vertically.
<span class="nc" id="L136">            FontMetrics fm = SwingUtilities2.getFontMetrics(frame, g, newFont);</span>
<span class="nc" id="L137">            int baseline = (getHeight() + fm.getAscent() - fm.getLeading() -</span>
<span class="nc" id="L138">                    fm.getDescent()) / 2;</span>

<span class="nc" id="L140">            Rectangle lastIconBounds = new Rectangle(0, 0, 0, 0);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">            if (frame.isIconifiable()) {</span>
<span class="nc" id="L142">                lastIconBounds = iconButton.getBounds();</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">            } else if (frame.isMaximizable()) {</span>
<span class="nc" id="L144">                lastIconBounds = maxButton.getBounds();</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">            } else if (frame.isClosable()) {</span>
<span class="nc" id="L146">                lastIconBounds = closeButton.getBounds();</span>
            }

            int titleX;
            int titleW;
<span class="nc" id="L151">            int gap = 2;</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">            if (WindowsGraphicsUtils.isLeftToRight(frame)) {</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                if (lastIconBounds.x == 0) { // There are no icons</span>
<span class="nc" id="L154">                    lastIconBounds.x = frame.getWidth() - frame.getInsets().right;</span>
                }
<span class="nc" id="L156">                titleX = systemLabel.getX() + systemLabel.getWidth() + gap;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                if (xp != null) {</span>
<span class="nc" id="L158">                    titleX += 2;</span>
                }
<span class="nc" id="L160">                titleW = lastIconBounds.x - titleX - gap;</span>
            } else {
<span class="nc bnc" id="L162" title="All 2 branches missed.">                if (lastIconBounds.x == 0) { // There are no icons</span>
<span class="nc" id="L163">                    lastIconBounds.x = frame.getInsets().left;</span>
                }
<span class="nc" id="L165">                titleW = SwingUtilities2.stringWidth(frame, fm, title);</span>
<span class="nc" id="L166">                int minTitleX = lastIconBounds.x + lastIconBounds.width + gap;</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                if (xp != null) {</span>
<span class="nc" id="L168">                    minTitleX += 2;</span>
                }
<span class="nc" id="L170">                int availableWidth = systemLabel.getX() - gap - minTitleX;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                if (availableWidth &gt; titleW) {</span>
<span class="nc" id="L172">                    titleX = systemLabel.getX() - gap - titleW;</span>
                } else {
<span class="nc" id="L174">                    titleX = minTitleX;</span>
<span class="nc" id="L175">                    titleW = availableWidth;</span>
                }
            }
<span class="nc" id="L178">            title = getTitle(frame.getTitle(), fm, titleW);</span>

<span class="nc bnc" id="L180" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L181">                String shadowType = null;</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">                if (isSelected) {</span>
<span class="nc" id="L183">                    shadowType = xp.getString(this, Part.WP_CAPTION,</span>
                                              State.ACTIVE, Prop.TEXTSHADOWTYPE);
                }
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if (&quot;single&quot;.equalsIgnoreCase(shadowType)) {</span>
<span class="nc" id="L187">                    Point shadowOffset = xp.getPoint(this, Part.WP_WINDOW, State.ACTIVE,</span>
                                                     Prop.TEXTSHADOWOFFSET);
<span class="nc" id="L189">                    Color shadowColor  = xp.getColor(this, Part.WP_WINDOW, State.ACTIVE,</span>
                                                     Prop.TEXTSHADOWCOLOR, null);
<span class="nc bnc" id="L191" title="All 4 branches missed.">                    if (shadowOffset != null &amp;&amp; shadowColor != null) {</span>
<span class="nc" id="L192">                        g.setColor(shadowColor);</span>
<span class="nc" id="L193">                        SwingUtilities2.drawString(frame, g, title,</span>
                                     titleX + shadowOffset.x,
                                     baseline + shadowOffset.y);
                    }
                }
            }
<span class="nc bnc" id="L199" title="All 2 branches missed.">            g.setColor(isSelected ? selectedTextColor : notSelectedTextColor);</span>
<span class="nc" id="L200">            SwingUtilities2.drawString(frame, g, title, titleX, baseline);</span>
<span class="nc" id="L201">            g.setFont(oldFont);</span>
        }
<span class="nc" id="L203">    }</span>

    public Dimension getPreferredSize() {
<span class="nc" id="L206">        return getMinimumSize();</span>
    }

    public Dimension getMinimumSize() {
<span class="nc" id="L210">        Dimension d = new Dimension(super.getMinimumSize());</span>
<span class="nc" id="L211">        d.height = titlePaneHeight + 2;</span>

<span class="nc" id="L213">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (xp != null) {</span>
            // Note: Don't know how to calculate height on XP,
            // the captionbarheight is 25 but native caption is 30 (maximized 26)
<span class="nc bnc" id="L217" title="All 2 branches missed.">            if (frame.isMaximum()) {</span>
<span class="nc" id="L218">                d.height -= 1;</span>
            } else {
<span class="nc" id="L220">                d.height += 3;</span>
            }
        }
<span class="nc" id="L223">        return d;</span>
    }

    protected void paintTitleBackground(Graphics g) {
<span class="nc" id="L227">        XPStyle xp = XPStyle.getXP();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">        if (xp != null) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            Part part = frame.isIcon() ? Part.WP_MINCAPTION</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                                       : (frame.isMaximum() ? Part.WP_MAXCAPTION</span>
                                                            : Part.WP_CAPTION);
<span class="nc bnc" id="L232" title="All 2 branches missed.">            State state = frame.isSelected() ? State.ACTIVE : State.INACTIVE;</span>
<span class="nc" id="L233">            Skin skin = xp.getSkin(this, part);</span>
<span class="nc" id="L234">            skin.paintSkin(g, 0,  0, getWidth(), getHeight(), state);</span>
<span class="nc" id="L235">        } else {</span>
<span class="nc" id="L236">            Boolean gradientsOn = (Boolean)LookAndFeel.getDesktopPropertyValue(</span>
<span class="nc" id="L237">                &quot;win.frame.captionGradientsOn&quot;, Boolean.valueOf(false));</span>
<span class="nc bnc" id="L238" title="All 4 branches missed.">            if (gradientsOn.booleanValue() &amp;&amp; g instanceof Graphics2D) {</span>
<span class="nc" id="L239">                Graphics2D g2 = (Graphics2D)g;</span>
<span class="nc" id="L240">                Paint savePaint = g2.getPaint();</span>

<span class="nc" id="L242">                boolean isSelected = frame.isSelected();</span>
<span class="nc" id="L243">                int w = getWidth();</span>

<span class="nc bnc" id="L245" title="All 2 branches missed.">                if (isSelected) {</span>
<span class="nc" id="L246">                    GradientPaint titleGradient = new GradientPaint(0,0,</span>
                            selectedTitleColor,
                            (int)(w*.75),0,
                            selectedTitleGradientColor);
<span class="nc" id="L250">                    g2.setPaint(titleGradient);</span>
<span class="nc" id="L251">                } else {</span>
<span class="nc" id="L252">                    GradientPaint titleGradient = new GradientPaint(0,0,</span>
                            notSelectedTitleColor,
                            (int)(w*.75),0,
                            notSelectedTitleGradientColor);
<span class="nc" id="L256">                    g2.setPaint(titleGradient);</span>
                }
<span class="nc" id="L258">                g2.fillRect(0, 0, getWidth(), getHeight());</span>
<span class="nc" id="L259">                g2.setPaint(savePaint);</span>
<span class="nc" id="L260">            } else {</span>
<span class="nc" id="L261">                super.paintTitleBackground(g);</span>
            }
        }
<span class="nc" id="L264">    }</span>

    protected void assembleSystemMenu() {
<span class="nc" id="L267">        systemPopupMenu = new JPopupMenu();</span>
<span class="nc" id="L268">        addSystemMenuItems(systemPopupMenu);</span>
<span class="nc" id="L269">        enableActions();</span>
<span class="nc" id="L270">        systemLabel = new JLabel(frame.getFrameIcon()) {</span>
            protected void paintComponent(Graphics g) {
<span class="nc" id="L272">                int x = 0;</span>
<span class="nc" id="L273">                int y = 0;</span>
<span class="nc" id="L274">                int w = getWidth();</span>
<span class="nc" id="L275">                int h = getHeight();</span>
<span class="nc" id="L276">                g = g.create();  // Create scratch graphics</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">                if (isOpaque()) {</span>
<span class="nc" id="L278">                    g.setColor(getBackground());</span>
<span class="nc" id="L279">                    g.fillRect(0, 0, w, h);</span>
                }
<span class="nc" id="L281">                Icon icon = getIcon();</span>
                int iconWidth;
                int iconHeight;
<span class="nc bnc" id="L284" title="All 2 branches missed.">                if (icon != null &amp;&amp;</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                    (iconWidth = icon.getIconWidth()) &gt; 0 &amp;&amp;</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">                    (iconHeight = icon.getIconHeight()) &gt; 0) {</span>

                    // Set drawing scale to make icon scale to our desired size
                    double drawScale;
<span class="nc bnc" id="L290" title="All 2 branches missed.">                    if (iconWidth &gt; iconHeight) {</span>
                        // Center icon vertically
<span class="nc" id="L292">                        y = (h - w*iconHeight/iconWidth) / 2;</span>
<span class="nc" id="L293">                        drawScale = w / (double)iconWidth;</span>
                    } else {
                        // Center icon horizontally
<span class="nc" id="L296">                        x = (w - h*iconWidth/iconHeight) / 2;</span>
<span class="nc" id="L297">                        drawScale = h / (double)iconHeight;</span>
                    }
<span class="nc" id="L299">                    ((Graphics2D)g).translate(x, y);</span>
<span class="nc" id="L300">                    ((Graphics2D)g).scale(drawScale, drawScale);</span>
<span class="nc" id="L301">                    icon.paintIcon(this, g, 0, 0);</span>
                }
<span class="nc" id="L303">                g.dispose();</span>
<span class="nc" id="L304">            }</span>
        };
<span class="nc" id="L306">        systemLabel.addMouseListener(new MouseAdapter() {</span>
            public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L308" title="All 4 branches missed.">                if (e.getClickCount() == 2 &amp;&amp; frame.isClosable() &amp;&amp;</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                    !frame.isIcon()) {</span>
<span class="nc" id="L310">                    systemPopupMenu.setVisible(false);</span>
<span class="nc" id="L311">                    frame.doDefaultCloseAction();</span>
                }
                else {
<span class="nc" id="L314">                    super.mouseClicked(e);</span>
                }
<span class="nc" id="L316">            }</span>
            public void mousePressed(MouseEvent e) {
                try {
<span class="nc" id="L319">                    frame.setSelected(true);</span>
<span class="nc" id="L320">                } catch(PropertyVetoException pve) {</span>
<span class="nc" id="L321">                }</span>
<span class="nc" id="L322">                showSystemPopupMenu(e.getComponent());</span>
<span class="nc" id="L323">            }</span>
        });
<span class="nc" id="L325">    }</span>

    protected void addSystemMenuItems(JPopupMenu menu) {
<span class="nc" id="L328">        JMenuItem mi = menu.add(restoreAction);</span>
<span class="nc" id="L329">        mi.setMnemonic(getButtonMnemonic(&quot;restore&quot;));</span>
<span class="nc" id="L330">        mi = menu.add(moveAction);</span>
<span class="nc" id="L331">        mi.setMnemonic(getButtonMnemonic(&quot;move&quot;));</span>
<span class="nc" id="L332">        mi = menu.add(sizeAction);</span>
<span class="nc" id="L333">        mi.setMnemonic(getButtonMnemonic(&quot;size&quot;));</span>
<span class="nc" id="L334">        mi = menu.add(iconifyAction);</span>
<span class="nc" id="L335">        mi.setMnemonic(getButtonMnemonic(&quot;minimize&quot;));</span>
<span class="nc" id="L336">        mi = menu.add(maximizeAction);</span>
<span class="nc" id="L337">        mi.setMnemonic(getButtonMnemonic(&quot;maximize&quot;));</span>
<span class="nc" id="L338">        menu.add(new JSeparator());</span>
<span class="nc" id="L339">        mi = menu.add(closeAction);</span>
<span class="nc" id="L340">        mi.setMnemonic(getButtonMnemonic(&quot;close&quot;));</span>
<span class="nc" id="L341">    }</span>

    private static int getButtonMnemonic(String button) {
        try {
<span class="nc" id="L345">            return Integer.parseInt(UIManager.getString(</span>
                    &quot;InternalFrameTitlePane.&quot; + button + &quot;Button.mnemonic&quot;));
<span class="nc" id="L347">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L348">            return -1;</span>
        }
    }

    protected void showSystemMenu(){
<span class="nc" id="L353">        showSystemPopupMenu(systemLabel);</span>
<span class="nc" id="L354">    }</span>

    private void showSystemPopupMenu(Component invoker){
<span class="nc" id="L357">        Dimension dim = new Dimension();</span>
<span class="nc" id="L358">        Border border = frame.getBorder();</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (border != null) {</span>
<span class="nc" id="L360">            dim.width += border.getBorderInsets(frame).left +</span>
<span class="nc" id="L361">                border.getBorderInsets(frame).right;</span>
<span class="nc" id="L362">            dim.height += border.getBorderInsets(frame).bottom +</span>
<span class="nc" id="L363">                border.getBorderInsets(frame).top;</span>
        }
<span class="nc bnc" id="L365" title="All 2 branches missed.">        if (!frame.isIcon()) {</span>
<span class="nc" id="L366">            systemPopupMenu.show(invoker,</span>
<span class="nc" id="L367">                getX() - dim.width,</span>
<span class="nc" id="L368">                getY() + getHeight() - dim.height);</span>
        } else {
<span class="nc" id="L370">            systemPopupMenu.show(invoker,</span>
<span class="nc" id="L371">                getX() - dim.width,</span>
<span class="nc" id="L372">                getY() - systemPopupMenu.getPreferredSize().height -</span>
                     dim.height);
        }
<span class="nc" id="L375">    }</span>

    protected PropertyChangeListener createPropertyChangeListener() {
<span class="nc" id="L378">        return new WindowsPropertyChangeHandler();</span>
    }

    protected LayoutManager createLayout() {
<span class="nc" id="L382">        return new WindowsTitlePaneLayout();</span>
    }

    public class WindowsTitlePaneLayout extends BasicInternalFrameTitlePane.TitlePaneLayout {
<span class="nc" id="L386">        private Insets captionMargin = null;</span>
<span class="nc" id="L387">        private Insets contentMargin = null;</span>
<span class="nc" id="L388">        private XPStyle xp = XPStyle.getXP();</span>

<span class="nc" id="L390">        WindowsTitlePaneLayout() {</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc" id="L392">                Component c = WindowsInternalFrameTitlePane.this;</span>
<span class="nc" id="L393">                captionMargin = xp.getMargin(c, Part.WP_CAPTION, null, Prop.CAPTIONMARGINS);</span>
<span class="nc" id="L394">                contentMargin = xp.getMargin(c, Part.WP_CAPTION, null, Prop.CONTENTMARGINS);</span>
            }
<span class="nc bnc" id="L396" title="All 2 branches missed.">            if (captionMargin == null) {</span>
<span class="nc" id="L397">                captionMargin = new Insets(0, 2, 0, 2);</span>
            }
<span class="nc bnc" id="L399" title="All 2 branches missed.">            if (contentMargin == null) {</span>
<span class="nc" id="L400">                contentMargin = new Insets(0, 0, 0, 0);</span>
            }
<span class="nc" id="L402">        }</span>

        private int layoutButton(JComponent button, Part part,
                                 int x, int y, int w, int h, int gap,
                                 boolean leftToRight) {
<span class="nc bnc" id="L407" title="All 2 branches missed.">            if (!leftToRight) {</span>
<span class="nc" id="L408">                x -= w;</span>
            }
<span class="nc" id="L410">            button.setBounds(x, y, w, h);</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">            if (leftToRight) {</span>
<span class="nc" id="L412">                x += w + 2;</span>
            } else {
<span class="nc" id="L414">                x -= 2;</span>
            }
<span class="nc" id="L416">            return x;</span>
        }

        public void layoutContainer(Container c) {
<span class="nc" id="L420">            boolean leftToRight = WindowsGraphicsUtils.isLeftToRight(frame);</span>
            int x, y;
<span class="nc" id="L422">            int w = getWidth();</span>
<span class="nc" id="L423">            int h = getHeight();</span>

            // System button
            // Note: this icon is square, but the buttons aren't always.
<span class="nc bnc" id="L427" title="All 2 branches missed.">            int iconSize = (xp != null) ? (h-2)*6/10 : h-4;</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">                x = (leftToRight) ? captionMargin.left + 2 : w - captionMargin.right - 2;</span>
            } else {
<span class="nc bnc" id="L431" title="All 2 branches missed.">                x = (leftToRight) ? captionMargin.left : w - captionMargin.right;</span>
            }
<span class="nc" id="L433">            y = (h - iconSize) / 2;</span>
<span class="nc" id="L434">            layoutButton(systemLabel, Part.WP_SYSBUTTON,</span>
                         x, y, iconSize, iconSize, 0,
                         leftToRight);

            // Right hand buttons
<span class="nc bnc" id="L439" title="All 2 branches missed.">            if (xp != null) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                x = (leftToRight) ? w - captionMargin.right - 2 : captionMargin.left + 2;</span>
<span class="nc" id="L441">                y = 1;  // XP seems to ignore margins and offset here</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">                if (frame.isMaximum()) {</span>
<span class="nc" id="L443">                    y += 1;</span>
                } else {
<span class="nc" id="L445">                    y += 5;</span>
                }
            } else {
<span class="nc bnc" id="L448" title="All 2 branches missed.">                x = (leftToRight) ? w - captionMargin.right : captionMargin.left;</span>
<span class="nc" id="L449">                y = (h - buttonHeight) / 2;</span>
            }

<span class="nc bnc" id="L452" title="All 2 branches missed.">            if(frame.isClosable()) {</span>
<span class="nc" id="L453">                x = layoutButton(closeButton, Part.WP_CLOSEBUTTON,</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">                                 x, y, buttonWidth, buttonHeight, 2,</span>
                                 !leftToRight);
            }

<span class="nc bnc" id="L458" title="All 2 branches missed.">            if(frame.isMaximizable()) {</span>
<span class="nc" id="L459">                x = layoutButton(maxButton, Part.WP_MAXBUTTON,</span>
<span class="nc bnc" id="L460" title="All 4 branches missed.">                                 x, y, buttonWidth, buttonHeight, (xp != null) ? 2 : 0,</span>
                                 !leftToRight);
            }

<span class="nc bnc" id="L464" title="All 2 branches missed.">            if(frame.isIconifiable()) {</span>
<span class="nc" id="L465">                layoutButton(iconButton, Part.WP_MINBUTTON,</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">                             x, y, buttonWidth, buttonHeight, 0,</span>
                             !leftToRight);
            }
<span class="nc" id="L469">        }</span>
    } // end WindowsTitlePaneLayout

<span class="nc" id="L472">    public class WindowsPropertyChangeHandler extends PropertyChangeHandler {</span>
        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L474">            String prop = evt.getPropertyName();</span>

            // Update the internal frame icon for the system menu.
<span class="nc bnc" id="L477" title="All 2 branches missed.">            if (JInternalFrame.FRAME_ICON_PROPERTY.equals(prop) &amp;&amp;</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">                    systemLabel != null) {</span>
<span class="nc" id="L479">                systemLabel.setIcon(frame.getFrameIcon());</span>
            }

<span class="nc" id="L482">            super.propertyChange(evt);</span>
<span class="nc" id="L483">        }</span>
    }

    /**
     * A versatile Icon implementation which can take an array of Icon
     * instances (typically &lt;code&gt;ImageIcon&lt;/code&gt;s) and choose one that gives the best
     * quality for a given Graphics2D scale factor when painting.
     * &lt;p&gt;
     * The class is public so it can be instantiated by UIDefaults.ProxyLazyValue.
     * &lt;p&gt;
     * Note: We assume here that icons are square.
     */
    public static class ScalableIconUIResource implements Icon, UIResource {
        // We can use an arbitrary size here because we scale to it in paintIcon()
        private static final int SIZE = 16;

        private Icon[] icons;

        /**
         * @params objects an array of Icon or UIDefaults.LazyValue
         * &lt;p&gt;
         * The constructor is public so it can be called by UIDefaults.ProxyLazyValue.
         */
<span class="nc" id="L506">        public ScalableIconUIResource(Object[] objects) {</span>
<span class="nc" id="L507">            this.icons = new Icon[objects.length];</span>

<span class="nc bnc" id="L509" title="All 2 branches missed.">            for (int i = 0; i &lt; objects.length; i++) {</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                if (objects[i] instanceof UIDefaults.LazyValue) {</span>
<span class="nc" id="L511">                    icons[i] = (Icon)((UIDefaults.LazyValue)objects[i]).createValue(null);</span>
                } else {
<span class="nc" id="L513">                    icons[i] = (Icon)objects[i];</span>
                }
            }
<span class="nc" id="L516">        }</span>

        /**
         * @return the &lt;code&gt;Icon&lt;/code&gt; closest to the requested size
         */
        protected Icon getBestIcon(int size) {
<span class="nc bnc" id="L522" title="All 4 branches missed.">            if (icons != null &amp;&amp; icons.length &gt; 0) {</span>
<span class="nc" id="L523">                int bestIndex = 0;</span>
<span class="nc" id="L524">                int minDiff = Integer.MAX_VALUE;</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">                for (int i=0; i &lt; icons.length; i++) {</span>
<span class="nc" id="L526">                    Icon icon = icons[i];</span>
                    int iconSize;
<span class="nc bnc" id="L528" title="All 4 branches missed.">                    if (icon != null &amp;&amp; (iconSize = icon.getIconWidth()) &gt; 0) {</span>
<span class="nc" id="L529">                        int diff = Math.abs(iconSize - size);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">                        if (diff &lt; minDiff) {</span>
<span class="nc" id="L531">                            minDiff = diff;</span>
<span class="nc" id="L532">                            bestIndex = i;</span>
                        }
                    }
                }
<span class="nc" id="L536">                return icons[bestIndex];</span>
            } else {
<span class="nc" id="L538">                return null;</span>
            }
        }

        public void paintIcon(Component c, Graphics g, int x, int y) {
<span class="nc" id="L543">            Graphics2D g2d = (Graphics2D)g.create();</span>
            // Calculate how big our drawing area is in pixels
            // Assume we are square
<span class="nc" id="L546">            int size = getIconWidth();</span>
<span class="nc" id="L547">            double scale = g2d.getTransform().getScaleX();</span>
<span class="nc" id="L548">            Icon icon = getBestIcon((int)(size * scale));</span>
            int iconSize;
<span class="nc bnc" id="L550" title="All 4 branches missed.">            if (icon != null &amp;&amp; (iconSize = icon.getIconWidth()) &gt; 0) {</span>
                // Set drawing scale to make icon act true to our reported size
<span class="nc" id="L552">                double drawScale = size / (double)iconSize;</span>
<span class="nc" id="L553">                g2d.translate(x, y);</span>
<span class="nc" id="L554">                g2d.scale(drawScale, drawScale);</span>
<span class="nc" id="L555">                icon.paintIcon(c, g2d, 0, 0);</span>
            }
<span class="nc" id="L557">            g2d.dispose();</span>
<span class="nc" id="L558">        }</span>

        public int getIconWidth() {
<span class="nc" id="L561">            return SIZE;</span>
        }

        public int getIconHeight() {
<span class="nc" id="L565">            return SIZE;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>