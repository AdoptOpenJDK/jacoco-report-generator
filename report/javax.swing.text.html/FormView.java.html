<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FormView.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.text.html</a> &gt; <span class="el_source">FormView.java</span></div><h1>FormView.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.text.html;

import java.net.*;
import java.io.*;
import java.awt.*;
import java.awt.event.*;
import java.util.*;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.text.*;

/**
 * Component decorator that implements the view interface
 * for form elements, &amp;lt;input&amp;gt;, &amp;lt;textarea&amp;gt;,
 * and &amp;lt;select&amp;gt;.  The model for the component is stored
 * as an attribute of the the element (using StyleConstants.ModelAttribute),
 * and is used to build the component of the view.  The type
 * of the model is assumed to of the type that would be set by
 * &lt;code&gt;HTMLDocument.HTMLReader.FormAction&lt;/code&gt;.  If there are
 * multiple views mapped over the document, they will share the
 * embedded component models.
 * &lt;p&gt;
 * The following table shows what components get built
 * by this view.
 * &lt;table summary=&quot;shows what components get built by this view&quot;&gt;
 * &lt;tr&gt;
 *   &lt;th&gt;Element Type&lt;/th&gt;
 *   &lt;th&gt;Component built&lt;/th&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type button&lt;/td&gt;
 *   &lt;td&gt;JButton&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type checkbox&lt;/td&gt;
 *   &lt;td&gt;JCheckBox&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type image&lt;/td&gt;
 *   &lt;td&gt;JButton&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type password&lt;/td&gt;
 *   &lt;td&gt;JPasswordField&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type radio&lt;/td&gt;
 *   &lt;td&gt;JRadioButton&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type reset&lt;/td&gt;
 *   &lt;td&gt;JButton&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type submit&lt;/td&gt;
 *   &lt;td&gt;JButton&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type text&lt;/td&gt;
 *   &lt;td&gt;JTextField&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;select, size &amp;gt; 1 or multiple attribute defined&lt;/td&gt;
 *   &lt;td&gt;JList in a JScrollPane&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;select, size unspecified or 1&lt;/td&gt;
 *   &lt;td&gt;JComboBox&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;textarea&lt;/td&gt;
 *   &lt;td&gt;JTextArea in a JScrollPane&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 *   &lt;td&gt;input, type file&lt;/td&gt;
 *   &lt;td&gt;JTextField&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;/table&gt;
 *
 * @author Timothy Prinzing
 * @author Sunita Mani
 */
public class FormView extends ComponentView implements ActionListener {

    /**
     * If a value attribute is not specified for a FORM input element
     * of type &quot;submit&quot;, then this default string is used.
     *
     * @deprecated As of 1.3, value now comes from UIManager property
     *             FormView.submitButtonText
     */
    @Deprecated
<span class="nc" id="L117">    public static final String SUBMIT = new String(&quot;Submit Query&quot;);</span>
    /**
     * If a value attribute is not specified for a FORM input element
     * of type &quot;reset&quot;, then this default string is used.
     *
     * @deprecated As of 1.3, value comes from UIManager UIManager property
     *             FormView.resetButtonText
     */
    @Deprecated
<span class="nc" id="L126">    public static final String RESET = new String(&quot;Reset&quot;);</span>

    /**
     * Document attribute name for storing POST data. JEditorPane.getPostData()
     * uses the same name, should be kept in sync.
     */
    final static String PostDataProperty = &quot;javax.swing.JEditorPane.postdata&quot;;

    /**
     * Used to indicate if the maximum span should be the same as the
     * preferred span. This is used so that the Component's size doesn't
     * change if there is extra room on a line. The first bit is used for
     * the X direction, and the second for the y direction.
     */
    private short maxIsPreferred;

    /**
     * Creates a new FormView object.
     *
     * @param elem the element to decorate
     */
    public FormView(Element elem) {
<span class="nc" id="L148">        super(elem);</span>
<span class="nc" id="L149">    }</span>

    /**
     * Create the component.  This is basically a
     * big switch statement based upon the tag type
     * and html attributes of the associated element.
     */
    protected Component createComponent() {
<span class="nc" id="L157">        AttributeSet attr = getElement().getAttributes();</span>
<span class="nc" id="L158">        HTML.Tag t = (HTML.Tag)</span>
<span class="nc" id="L159">            attr.getAttribute(StyleConstants.NameAttribute);</span>
<span class="nc" id="L160">        JComponent c = null;</span>
<span class="nc" id="L161">        Object model = attr.getAttribute(StyleConstants.ModelAttribute);</span>

        // Remove listeners previously registered in shared model
        // when a new UI component is replaced.  See bug 7189299.
<span class="nc" id="L165">        removeStaleListenerForModel(model);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (t == HTML.Tag.INPUT) {</span>
<span class="nc" id="L167">            c = createInputComponent(attr, model);</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        } else if (t == HTML.Tag.SELECT) {</span>

<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (model instanceof OptionListModel) {</span>

<span class="nc" id="L172">                JList list = new JList((ListModel) model);</span>
<span class="nc" id="L173">                int size = HTML.getIntegerAttributeValue(attr,</span>
                                                         HTML.Attribute.SIZE,
                                                         1);
<span class="nc" id="L176">                list.setVisibleRowCount(size);</span>
<span class="nc" id="L177">                list.setSelectionModel((ListSelectionModel)model);</span>
<span class="nc" id="L178">                c = new JScrollPane(list);</span>
<span class="nc" id="L179">            } else {</span>
<span class="nc" id="L180">                c = new JComboBox((ComboBoxModel) model);</span>
<span class="nc" id="L181">                maxIsPreferred = 3;</span>
            }
<span class="nc bnc" id="L183" title="All 2 branches missed.">        } else if (t == HTML.Tag.TEXTAREA) {</span>
<span class="nc" id="L184">            JTextArea area = new JTextArea((Document) model);</span>
<span class="nc" id="L185">            int rows = HTML.getIntegerAttributeValue(attr,</span>
                                                     HTML.Attribute.ROWS,
                                                     1);
<span class="nc" id="L188">            area.setRows(rows);</span>
<span class="nc" id="L189">            int cols = HTML.getIntegerAttributeValue(attr,</span>
                                                     HTML.Attribute.COLS,
                                                     20);
<span class="nc" id="L192">            maxIsPreferred = 3;</span>
<span class="nc" id="L193">            area.setColumns(cols);</span>
<span class="nc" id="L194">            c = new JScrollPane(area,</span>
                                JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,
                                JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
        }

<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (c != null) {</span>
<span class="nc" id="L200">            c.setAlignmentY(1.0f);</span>
        }
<span class="nc" id="L202">        return c;</span>
    }


    /**
     * Creates a component for an &amp;lt;INPUT&amp;gt; element based on the
     * value of the &quot;type&quot; attribute.
     *
     * @param set of attributes associated with the &amp;lt;INPUT&amp;gt; element.
     * @param model the value of the StyleConstants.ModelAttribute
     * @return the component.
     */
    private JComponent createInputComponent(AttributeSet attr, Object model) {
<span class="nc" id="L215">        JComponent c = null;</span>
<span class="nc" id="L216">        String type = (String) attr.getAttribute(HTML.Attribute.TYPE);</span>

<span class="nc bnc" id="L218" title="All 4 branches missed.">        if (type.equals(&quot;submit&quot;) || type.equals(&quot;reset&quot;)) {</span>
<span class="nc" id="L219">            String value = (String)</span>
<span class="nc" id="L220">                attr.getAttribute(HTML.Attribute.VALUE);</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (type.equals(&quot;submit&quot;)) {</span>
<span class="nc" id="L223">                    value = UIManager.getString(&quot;FormView.submitButtonText&quot;);</span>
                } else {
<span class="nc" id="L225">                    value = UIManager.getString(&quot;FormView.resetButtonText&quot;);</span>
                }
            }
<span class="nc" id="L228">            JButton button = new JButton(value);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L230">                button.setModel((ButtonModel)model);</span>
<span class="nc" id="L231">                button.addActionListener(this);</span>
            }
<span class="nc" id="L233">            c = button;</span>
<span class="nc" id="L234">            maxIsPreferred = 3;</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">        } else if (type.equals(&quot;image&quot;)) {</span>
<span class="nc" id="L236">            String srcAtt = (String) attr.getAttribute(HTML.Attribute.SRC);</span>
            JButton button;
            try {
<span class="nc" id="L239">                URL base = ((HTMLDocument)getElement().getDocument()).getBase();</span>
<span class="nc" id="L240">                URL srcURL = new URL(base, srcAtt);</span>
<span class="nc" id="L241">                Icon icon = new ImageIcon(srcURL);</span>
<span class="nc" id="L242">                button  = new JButton(icon);</span>
<span class="nc" id="L243">            } catch (MalformedURLException e) {</span>
<span class="nc" id="L244">                button = new JButton(srcAtt);</span>
<span class="nc" id="L245">            }</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L247">                button.setModel((ButtonModel)model);</span>
<span class="nc" id="L248">                button.addMouseListener(new MouseEventListener());</span>
            }
<span class="nc" id="L250">            c = button;</span>
<span class="nc" id="L251">            maxIsPreferred = 3;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">        } else if (type.equals(&quot;checkbox&quot;)) {</span>
<span class="nc" id="L253">            c = new JCheckBox();</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L255">                ((JCheckBox)c).setModel((JToggleButton.ToggleButtonModel) model);</span>
            }
<span class="nc" id="L257">            maxIsPreferred = 3;</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">        } else if (type.equals(&quot;radio&quot;)) {</span>
<span class="nc" id="L259">            c = new JRadioButton();</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L261">                ((JRadioButton)c).setModel((JToggleButton.ToggleButtonModel)model);</span>
            }
<span class="nc" id="L263">            maxIsPreferred = 3;</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">        } else if (type.equals(&quot;text&quot;)) {</span>
<span class="nc" id="L265">            int size = HTML.getIntegerAttributeValue(attr,</span>
                                                     HTML.Attribute.SIZE,
                                                     -1);
            JTextField field;
<span class="nc bnc" id="L269" title="All 2 branches missed.">            if (size &gt; 0) {</span>
<span class="nc" id="L270">                field = new JTextField();</span>
<span class="nc" id="L271">                field.setColumns(size);</span>
            }
            else {
<span class="nc" id="L274">                field = new JTextField();</span>
<span class="nc" id="L275">                field.setColumns(20);</span>
            }
<span class="nc" id="L277">            c = field;</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L279">                field.setDocument((Document) model);</span>
            }
<span class="nc" id="L281">            field.addActionListener(this);</span>
<span class="nc" id="L282">            maxIsPreferred = 3;</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        } else if (type.equals(&quot;password&quot;)) {</span>
<span class="nc" id="L284">            JPasswordField field = new JPasswordField();</span>
<span class="nc" id="L285">            c = field;</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L287">                field.setDocument((Document) model);</span>
            }
<span class="nc" id="L289">            int size = HTML.getIntegerAttributeValue(attr,</span>
                                                     HTML.Attribute.SIZE,
                                                     -1);
<span class="nc bnc" id="L292" title="All 2 branches missed.">            field.setColumns((size &gt; 0) ? size : 20);</span>
<span class="nc" id="L293">            field.addActionListener(this);</span>
<span class="nc" id="L294">            maxIsPreferred = 3;</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">        } else if (type.equals(&quot;file&quot;)) {</span>
<span class="nc" id="L296">            JTextField field = new JTextField();</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">            if (model != null) {</span>
<span class="nc" id="L298">                field.setDocument((Document)model);</span>
            }
<span class="nc" id="L300">            int size = HTML.getIntegerAttributeValue(attr, HTML.Attribute.SIZE,</span>
                                                     -1);
<span class="nc bnc" id="L302" title="All 2 branches missed.">            field.setColumns((size &gt; 0) ? size : 20);</span>
<span class="nc" id="L303">            JButton browseButton = new JButton(UIManager.getString</span>
<span class="nc" id="L304">                                           (&quot;FormView.browseFileButtonText&quot;));</span>
<span class="nc" id="L305">            Box box = Box.createHorizontalBox();</span>
<span class="nc" id="L306">            box.add(field);</span>
<span class="nc" id="L307">            box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L308">            box.add(browseButton);</span>
<span class="nc" id="L309">            browseButton.addActionListener(new BrowseFileAction(</span>
                                           attr, (Document)model));
<span class="nc" id="L311">            c = box;</span>
<span class="nc" id="L312">            maxIsPreferred = 3;</span>
        }
<span class="nc" id="L314">        return c;</span>
    }

    private void removeStaleListenerForModel(Object model) {
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (model instanceof DefaultButtonModel) {</span>
            // case of JButton whose model is DefaultButtonModel
            // Need to remove stale ActionListener, ChangeListener and
            // ItemListener that are instance of AbstractButton$Handler.
<span class="nc" id="L322">            DefaultButtonModel buttonModel = (DefaultButtonModel) model;</span>
<span class="nc" id="L323">            String listenerClass = &quot;javax.swing.AbstractButton$Handler&quot;;</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">            for (ActionListener listener : buttonModel.getActionListeners()) {</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">                if (listenerClass.equals(listener.getClass().getName())) {</span>
<span class="nc" id="L326">                    buttonModel.removeActionListener(listener);</span>
                }
            }
<span class="nc bnc" id="L329" title="All 2 branches missed.">            for (ChangeListener listener : buttonModel.getChangeListeners()) {</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">                if (listenerClass.equals(listener.getClass().getName())) {</span>
<span class="nc" id="L331">                    buttonModel.removeChangeListener(listener);</span>
                }
            }
<span class="nc bnc" id="L334" title="All 2 branches missed.">            for (ItemListener listener : buttonModel.getItemListeners()) {</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">                if (listenerClass.equals(listener.getClass().getName())) {</span>
<span class="nc" id="L336">                    buttonModel.removeItemListener(listener);</span>
                }
            }
<span class="nc bnc" id="L339" title="All 2 branches missed.">        } else if (model instanceof AbstractListModel) {</span>
            // case of JComboBox and JList
            // For JList, the stale ListDataListener is instance
            // BasicListUI$Handler.
            // For JComboBox, there are 2 stale ListDataListeners, which are
            // BasicListUI$Handler and BasicComboBoxUI$Handler.
<span class="nc" id="L345">            AbstractListModel listModel = (AbstractListModel) model;</span>
<span class="nc" id="L346">            String listenerClass1 =</span>
                    &quot;javax.swing.plaf.basic.BasicListUI$Handler&quot;;
<span class="nc" id="L348">            String listenerClass2 =</span>
                    &quot;javax.swing.plaf.basic.BasicComboBoxUI$Handler&quot;;
<span class="nc bnc" id="L350" title="All 2 branches missed.">            for (ListDataListener listener : listModel.getListDataListeners()) {</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">                if (listenerClass1.equals(listener.getClass().getName())</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                        || listenerClass2.equals(listener.getClass().getName()))</span>
                {
<span class="nc" id="L354">                    listModel.removeListDataListener(listener);</span>
                }
            }
<span class="nc bnc" id="L357" title="All 2 branches missed.">        } else if (model instanceof AbstractDocument) {</span>
            // case of JPasswordField, JTextField and JTextArea
            // All have 2 stale DocumentListeners.
<span class="nc" id="L360">            String listenerClass1 =</span>
                    &quot;javax.swing.plaf.basic.BasicTextUI$UpdateHandler&quot;;
<span class="nc" id="L362">            String listenerClass2 =</span>
                    &quot;javax.swing.text.DefaultCaret$Handler&quot;;
<span class="nc" id="L364">            AbstractDocument docModel = (AbstractDocument) model;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">            for (DocumentListener listener : docModel.getDocumentListeners()) {</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                if (listenerClass1.equals(listener.getClass().getName())</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                        || listenerClass2.equals(listener.getClass().getName()))</span>
                {
<span class="nc" id="L369">                    docModel.removeDocumentListener(listener);</span>
                }
            }
        }
<span class="nc" id="L373">    }</span>

    /**
     * Determines the maximum span for this view along an
     * axis. For certain components, the maximum and preferred span are the
     * same. For others this will return the value
     * returned by Component.getMaximumSize along the
     * axis of interest.
     *
     * @param axis may be either View.X_AXIS or View.Y_AXIS
     * @return   the span the view would like to be rendered into &amp;gt;= 0.
     *           Typically the view is told to render into the span
     *           that is returned, although there is no guarantee.
     *           The parent may choose to resize or break the view.
     * @exception IllegalArgumentException for an invalid axis
     */
    public float getMaximumSpan(int axis) {
<span class="nc bnc" id="L390" title="All 3 branches missed.">        switch (axis) {</span>
        case View.X_AXIS:
<span class="nc bnc" id="L392" title="All 2 branches missed.">            if ((maxIsPreferred &amp; 1) == 1) {</span>
<span class="nc" id="L393">                super.getMaximumSpan(axis);</span>
<span class="nc" id="L394">                return getPreferredSpan(axis);</span>
            }
<span class="nc" id="L396">            return super.getMaximumSpan(axis);</span>
        case View.Y_AXIS:
<span class="nc bnc" id="L398" title="All 2 branches missed.">            if ((maxIsPreferred &amp; 2) == 2) {</span>
<span class="nc" id="L399">                super.getMaximumSpan(axis);</span>
<span class="nc" id="L400">                return getPreferredSpan(axis);</span>
            }
<span class="nc" id="L402">            return super.getMaximumSpan(axis);</span>
        default:
            break;
        }
<span class="nc" id="L406">        return super.getMaximumSpan(axis);</span>
    }


    /**
     * Responsible for processing the ActionEvent.
     * If the element associated with the FormView,
     * has a type of &quot;submit&quot;, &quot;reset&quot;, &quot;text&quot; or &quot;password&quot;
     * then the action is processed.  In the case of a &quot;submit&quot;
     * the form is submitted.  In the case of a &quot;reset&quot;
     * the form is reset to its original state.
     * In the case of &quot;text&quot; or &quot;password&quot;, if the
     * element is the last one of type &quot;text&quot; or &quot;password&quot;,
     * the form is submitted.  Otherwise, focus is transferred
     * to the next component in the form.
     *
     * @param evt the ActionEvent.
     */
    public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L425">        Element element = getElement();</span>
<span class="nc" id="L426">        StringBuilder dataBuffer = new StringBuilder();</span>
<span class="nc" id="L427">        HTMLDocument doc = (HTMLDocument)getDocument();</span>
<span class="nc" id="L428">        AttributeSet attr = element.getAttributes();</span>

<span class="nc" id="L430">        String type = (String) attr.getAttribute(HTML.Attribute.TYPE);</span>

<span class="nc bnc" id="L432" title="All 2 branches missed.">        if (type.equals(&quot;submit&quot;)) {</span>
<span class="nc" id="L433">            getFormData(dataBuffer);</span>
<span class="nc" id="L434">            submitData(dataBuffer.toString());</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">        } else if (type.equals(&quot;reset&quot;)) {</span>
<span class="nc" id="L436">            resetForm();</span>
<span class="nc bnc" id="L437" title="All 4 branches missed.">        } else if (type.equals(&quot;text&quot;) || type.equals(&quot;password&quot;)) {</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">            if (isLastTextOrPasswordField()) {</span>
<span class="nc" id="L439">                getFormData(dataBuffer);</span>
<span class="nc" id="L440">                submitData(dataBuffer.toString());</span>
            } else {
<span class="nc" id="L442">                getComponent().transferFocus();</span>
            }
        }
<span class="nc" id="L445">    }</span>


    /**
     * This method is responsible for submitting the form data.
     * A thread is forked to undertake the submission.
     */
    protected void submitData(String data) {
<span class="nc" id="L453">        Element form = getFormElement();</span>
<span class="nc" id="L454">        AttributeSet attrs = form.getAttributes();</span>
<span class="nc" id="L455">        HTMLDocument doc = (HTMLDocument) form.getDocument();</span>
<span class="nc" id="L456">        URL base = doc.getBase();</span>

<span class="nc" id="L458">        String target = (String) attrs.getAttribute(HTML.Attribute.TARGET);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">        if (target == null) {</span>
<span class="nc" id="L460">            target = &quot;_self&quot;;</span>
        }

<span class="nc" id="L463">        String method = (String) attrs.getAttribute(HTML.Attribute.METHOD);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">        if (method == null) {</span>
<span class="nc" id="L465">            method = &quot;GET&quot;;</span>
        }
<span class="nc" id="L467">        method = method.toLowerCase();</span>
<span class="nc" id="L468">        boolean isPostMethod = method.equals(&quot;post&quot;);</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (isPostMethod) {</span>
<span class="nc" id="L470">            storePostData(doc, target, data);</span>
        }

<span class="nc" id="L473">        String action = (String) attrs.getAttribute(HTML.Attribute.ACTION);</span>
        URL actionURL;
        try {
<span class="nc bnc" id="L476" title="All 2 branches missed.">            actionURL = (action == null)</span>
<span class="nc" id="L477">                ? new URL(base.getProtocol(), base.getHost(),</span>
<span class="nc" id="L478">                                        base.getPort(), base.getFile())</span>
                : new URL(base, action);
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (!isPostMethod) {</span>
<span class="nc" id="L481">                String query = data.toString();</span>
<span class="nc" id="L482">                actionURL = new URL(actionURL + &quot;?&quot; + query);</span>
            }
<span class="nc" id="L484">        } catch (MalformedURLException e) {</span>
<span class="nc" id="L485">            actionURL = null;</span>
<span class="nc" id="L486">        }</span>
<span class="nc" id="L487">        final JEditorPane c = (JEditorPane) getContainer();</span>
<span class="nc" id="L488">        HTMLEditorKit kit = (HTMLEditorKit) c.getEditorKit();</span>

<span class="nc" id="L490">        FormSubmitEvent formEvent = null;</span>
<span class="nc bnc" id="L491" title="All 4 branches missed.">        if (!kit.isAutoFormSubmission() || doc.isFrameDocument()) {</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">            FormSubmitEvent.MethodType methodType = isPostMethod</span>
                    ? FormSubmitEvent.MethodType.POST
                    : FormSubmitEvent.MethodType.GET;
<span class="nc" id="L495">            formEvent = new FormSubmitEvent(</span>
                    FormView.this, HyperlinkEvent.EventType.ACTIVATED,
                    actionURL, form, target, methodType, data);

        }
        // setPage() may take significant time so schedule it to run later.
<span class="nc" id="L501">        final FormSubmitEvent fse = formEvent;</span>
<span class="nc" id="L502">        final URL url = actionURL;</span>
<span class="nc" id="L503">        SwingUtilities.invokeLater(new Runnable() {</span>
            public void run() {
<span class="nc bnc" id="L505" title="All 2 branches missed.">                if (fse != null) {</span>
<span class="nc" id="L506">                    c.fireHyperlinkUpdate(fse);</span>
                } else {
                    try {
<span class="nc" id="L509">                        c.setPage(url);</span>
<span class="nc" id="L510">                    } catch (IOException e) {</span>
<span class="nc" id="L511">                        UIManager.getLookAndFeel().provideErrorFeedback(c);</span>
<span class="nc" id="L512">                    }</span>
                }
<span class="nc" id="L514">            }</span>
        });
<span class="nc" id="L516">    }</span>

    private void storePostData(HTMLDocument doc, String target, String data) {

        /* POST data is stored into the document property named by constant
         * PostDataProperty from where it is later retrieved by method
         * JEditorPane.getPostData().  If the current document is in a frame,
         * the data is initially put into the toplevel (frameset) document
         * property (named &lt;PostDataProperty&gt;.&lt;Target frame name&gt;).  It is the
         * responsibility of FrameView which updates the target frame
         * to move data from the frameset document property into the frame
         * document property.
         */

<span class="nc" id="L530">        Document propDoc = doc;</span>
<span class="nc" id="L531">        String propName = PostDataProperty;</span>

<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (doc.isFrameDocument()) {</span>
            // find the top-most JEditorPane holding the frameset view.
<span class="nc" id="L535">            FrameView.FrameEditorPane p =</span>
<span class="nc" id="L536">                    (FrameView.FrameEditorPane) getContainer();</span>
<span class="nc" id="L537">            FrameView v = p.getFrameView();</span>
<span class="nc" id="L538">            JEditorPane c = v.getOutermostJEditorPane();</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L540">                propDoc = c.getDocument();</span>
<span class="nc" id="L541">                propName += (&quot;.&quot; + target);</span>
            }
        }

<span class="nc" id="L545">        propDoc.putProperty(propName, data);</span>
<span class="nc" id="L546">    }</span>

    /**
     * MouseEventListener class to handle form submissions when
     * an input with type equal to image is clicked on.
     * A MouseListener is necessary since along with the image
     * data the coordinates associated with the mouse click
     * need to be submitted.
     */
<span class="nc" id="L555">    protected class MouseEventListener extends MouseAdapter {</span>

        public void mouseReleased(MouseEvent evt) {
<span class="nc" id="L558">            String imageData = getImageData(evt.getPoint());</span>
<span class="nc" id="L559">            imageSubmit(imageData);</span>
<span class="nc" id="L560">        }</span>
    }

    /**
     * This method is called to submit a form in response
     * to a click on an image -- an &amp;lt;INPUT&amp;gt; form
     * element of type &quot;image&quot;.
     *
     * @param imageData the mouse click coordinates.
     */
    protected void imageSubmit(String imageData) {

<span class="nc" id="L572">        StringBuilder dataBuffer = new StringBuilder();</span>
<span class="nc" id="L573">        Element elem = getElement();</span>
<span class="nc" id="L574">        HTMLDocument hdoc = (HTMLDocument)elem.getDocument();</span>
<span class="nc" id="L575">        getFormData(dataBuffer);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">        if (dataBuffer.length() &gt; 0) {</span>
<span class="nc" id="L577">            dataBuffer.append('&amp;');</span>
        }
<span class="nc" id="L579">        dataBuffer.append(imageData);</span>
<span class="nc" id="L580">        submitData(dataBuffer.toString());</span>
<span class="nc" id="L581">        return;</span>
    }

    /**
     * Extracts the value of the name attribute
     * associated with the input element of type
     * image.  If name is defined it is encoded using
     * the URLEncoder.encode() method and the
     * image data is returned in the following format:
     *      name + &quot;.x&quot; +&quot;=&quot;+ x +&quot;&amp;&quot;+ name +&quot;.y&quot;+&quot;=&quot;+ y
     * otherwise,
     *      &quot;x=&quot;+ x +&quot;&amp;y=&quot;+ y
     *
     * @param point associated with the mouse click.
     * @return the image data.
     */
    private String getImageData(Point point) {

<span class="nc" id="L599">        String mouseCoords = point.x + &quot;:&quot; + point.y;</span>
<span class="nc" id="L600">        int sep = mouseCoords.indexOf(':');</span>
<span class="nc" id="L601">        String x = mouseCoords.substring(0, sep);</span>
<span class="nc" id="L602">        String y = mouseCoords.substring(++sep);</span>
<span class="nc" id="L603">        String name = (String) getElement().getAttributes().getAttribute(HTML.Attribute.NAME);</span>

        String data;
<span class="nc bnc" id="L606" title="All 4 branches missed.">        if (name == null || name.equals(&quot;&quot;)) {</span>
<span class="nc" id="L607">            data = &quot;x=&quot;+ x +&quot;&amp;y=&quot;+ y;</span>
        } else {
<span class="nc" id="L609">            name = URLEncoder.encode(name);</span>
<span class="nc" id="L610">            data = name + &quot;.x&quot; +&quot;=&quot;+ x +&quot;&amp;&quot;+ name +&quot;.y&quot;+&quot;=&quot;+ y;</span>
        }
<span class="nc" id="L612">        return data;</span>
    }


    /**
     * The following methods provide functionality required to
     * iterate over a the elements of the form and in the case
     * of a form submission, extract the data from each model
     * that is associated with each form element, and in the
     * case of reset, reinitialize the each model to its
     * initial state.
     */


    /**
     * Returns the Element representing the &lt;code&gt;FORM&lt;/code&gt;.
     */
    private Element getFormElement() {
<span class="nc" id="L630">        Element elem = getElement();</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">        while (elem != null) {</span>
<span class="nc" id="L632">            if (elem.getAttributes().getAttribute</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">                (StyleConstants.NameAttribute) == HTML.Tag.FORM) {</span>
<span class="nc" id="L634">                return elem;</span>
            }
<span class="nc" id="L636">            elem = elem.getParentElement();</span>
        }
<span class="nc" id="L638">        return null;</span>
    }

    /**
     * Iterates over the
     * element hierarchy, extracting data from the
     * models associated with the relevant form elements.
     * &quot;Relevant&quot; means the form elements that are part
     * of the same form whose element triggered the submit
     * action.
     *
     * @param buffer        the buffer that contains that data to submit
     * @param targetElement the element that triggered the
     *                      form submission
     */
    private void getFormData(StringBuilder buffer) {
<span class="nc" id="L654">        Element formE = getFormElement();</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        if (formE != null) {</span>
<span class="nc" id="L656">            ElementIterator it = new ElementIterator(formE);</span>
            Element next;

<span class="nc bnc" id="L659" title="All 2 branches missed.">            while ((next = it.next()) != null) {</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">                if (isControl(next)) {</span>
<span class="nc" id="L661">                    String type = (String)next.getAttributes().getAttribute</span>
<span class="nc" id="L662">                                       (HTML.Attribute.TYPE);</span>

<span class="nc bnc" id="L664" title="All 4 branches missed.">                    if (type != null &amp;&amp; type.equals(&quot;submit&quot;) &amp;&amp;</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">                        next != getElement()) {</span>
                        // do nothing - this submit is not the trigger
<span class="nc bnc" id="L667" title="All 4 branches missed.">                    } else if (type == null || !type.equals(&quot;image&quot;)) {</span>
                        // images only result in data if they triggered
                        // the submit and they require that the mouse click
                        // coords be appended to the data.  Hence its
                        // processing is handled by the view.
<span class="nc" id="L672">                        loadElementDataIntoBuffer(next, buffer);</span>
                    }
<span class="nc" id="L674">                }</span>
            }
        }
<span class="nc" id="L677">    }</span>

    /**
     * Loads the data
     * associated with the element into the buffer.
     * The format in which data is appended depends
     * on the type of the form element.  Essentially
     * data is loaded in name/value pairs.
     *
     */
    private void loadElementDataIntoBuffer(Element elem, StringBuilder buffer) {

<span class="nc" id="L689">        AttributeSet attr = elem.getAttributes();</span>
<span class="nc" id="L690">        String name = (String)attr.getAttribute(HTML.Attribute.NAME);</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">        if (name == null) {</span>
<span class="nc" id="L692">            return;</span>
        }
<span class="nc" id="L694">        String value = null;</span>
<span class="nc" id="L695">        HTML.Tag tag = (HTML.Tag)elem.getAttributes().getAttribute</span>
<span class="nc" id="L696">                                  (StyleConstants.NameAttribute);</span>

<span class="nc bnc" id="L698" title="All 2 branches missed.">        if (tag == HTML.Tag.INPUT) {</span>
<span class="nc" id="L699">            value = getInputElementData(attr);</span>
<span class="nc bnc" id="L700" title="All 2 branches missed.">        } else if (tag ==  HTML.Tag.TEXTAREA) {</span>
<span class="nc" id="L701">            value = getTextAreaData(attr);</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">        } else if (tag == HTML.Tag.SELECT) {</span>
<span class="nc" id="L703">            loadSelectData(attr, buffer);</span>
        }

<span class="nc bnc" id="L706" title="All 4 branches missed.">        if (name != null &amp;&amp; value != null) {</span>
<span class="nc" id="L707">            appendBuffer(buffer, name, value);</span>
        }
<span class="nc" id="L709">    }</span>


    /**
     * Returns the data associated with an &amp;lt;INPUT&amp;gt; form
     * element.  The value of &quot;type&quot; attributes is
     * used to determine the type of the model associated
     * with the element and then the relevant data is
     * extracted.
     */
    private String getInputElementData(AttributeSet attr) {

<span class="nc" id="L721">        Object model = attr.getAttribute(StyleConstants.ModelAttribute);</span>
<span class="nc" id="L722">        String type = (String) attr.getAttribute(HTML.Attribute.TYPE);</span>
<span class="nc" id="L723">        String value = null;</span>

<span class="nc bnc" id="L725" title="All 4 branches missed.">        if (type.equals(&quot;text&quot;) || type.equals(&quot;password&quot;)) {</span>
<span class="nc" id="L726">            Document doc = (Document)model;</span>
            try {
<span class="nc" id="L728">                value = doc.getText(0, doc.getLength());</span>
<span class="nc" id="L729">            } catch (BadLocationException e) {</span>
<span class="nc" id="L730">                value = null;</span>
<span class="nc" id="L731">            }</span>
<span class="nc bnc" id="L732" title="All 4 branches missed.">        } else if (type.equals(&quot;submit&quot;) || type.equals(&quot;hidden&quot;)) {</span>
<span class="nc" id="L733">            value = (String) attr.getAttribute(HTML.Attribute.VALUE);</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L735">                value = &quot;&quot;;</span>
            }
<span class="nc bnc" id="L737" title="All 4 branches missed.">        } else if (type.equals(&quot;radio&quot;) || type.equals(&quot;checkbox&quot;)) {</span>
<span class="nc" id="L738">            ButtonModel m = (ButtonModel)model;</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">            if (m.isSelected()) {</span>
<span class="nc" id="L740">                value = (String) attr.getAttribute(HTML.Attribute.VALUE);</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">                if (value == null) {</span>
<span class="nc" id="L742">                    value = &quot;on&quot;;</span>
                }
            }
<span class="nc bnc" id="L745" title="All 2 branches missed.">        } else if (type.equals(&quot;file&quot;)) {</span>
<span class="nc" id="L746">            Document doc = (Document)model;</span>
            String path;

            try {
<span class="nc" id="L750">                path = doc.getText(0, doc.getLength());</span>
<span class="nc" id="L751">            } catch (BadLocationException e) {</span>
<span class="nc" id="L752">                path = null;</span>
<span class="nc" id="L753">            }</span>
<span class="nc bnc" id="L754" title="All 4 branches missed.">            if (path != null &amp;&amp; path.length() &gt; 0) {</span>
<span class="nc" id="L755">                value = path;</span>
            }
        }
<span class="nc" id="L758">        return value;</span>
    }

    /**
     * Returns the data associated with the &amp;lt;TEXTAREA&amp;gt; form
     * element.  This is done by getting the text stored in the
     * Document model.
     */
    private String getTextAreaData(AttributeSet attr) {
<span class="nc" id="L767">        Document doc = (Document)attr.getAttribute(StyleConstants.ModelAttribute);</span>
        try {
<span class="nc" id="L769">            return doc.getText(0, doc.getLength());</span>
<span class="nc" id="L770">        } catch (BadLocationException e) {</span>
<span class="nc" id="L771">            return null;</span>
        }
    }


    /**
     * Loads the buffer with the data associated with the Select
     * form element.  Basically, only items that are selected
     * and have their name attribute set are added to the buffer.
     */
    private void loadSelectData(AttributeSet attr, StringBuilder buffer) {

<span class="nc" id="L783">        String name = (String)attr.getAttribute(HTML.Attribute.NAME);</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">        if (name == null) {</span>
<span class="nc" id="L785">            return;</span>
        }
<span class="nc" id="L787">        Object m = attr.getAttribute(StyleConstants.ModelAttribute);</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">        if (m instanceof OptionListModel) {</span>
<span class="nc" id="L789">            OptionListModel&lt;Option&gt; model = (OptionListModel&lt;Option&gt;) m;</span>

<span class="nc bnc" id="L791" title="All 2 branches missed.">            for (int i = 0; i &lt; model.getSize(); i++) {</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">                if (model.isSelectedIndex(i)) {</span>
<span class="nc" id="L793">                    Option option = model.getElementAt(i);</span>
<span class="nc" id="L794">                    appendBuffer(buffer, name, option.getValue());</span>
                }
            }
<span class="nc bnc" id="L797" title="All 2 branches missed.">        } else if (m instanceof ComboBoxModel) {</span>
<span class="nc" id="L798">            ComboBoxModel model = (ComboBoxModel)m;</span>
<span class="nc" id="L799">            Option option = (Option)model.getSelectedItem();</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">            if (option != null) {</span>
<span class="nc" id="L801">                appendBuffer(buffer, name, option.getValue());</span>
            }
        }
<span class="nc" id="L804">    }</span>

    /**
     * Appends name / value pairs into the
     * buffer.  Both names and values are encoded using the
     * URLEncoder.encode() method before being added to the
     * buffer.
     */
    private void appendBuffer(StringBuilder buffer, String name, String value) {
<span class="nc bnc" id="L813" title="All 2 branches missed.">        if (buffer.length() &gt; 0) {</span>
<span class="nc" id="L814">            buffer.append('&amp;');</span>
        }
<span class="nc" id="L816">        String encodedName = URLEncoder.encode(name);</span>
<span class="nc" id="L817">        buffer.append(encodedName);</span>
<span class="nc" id="L818">        buffer.append('=');</span>
<span class="nc" id="L819">        String encodedValue = URLEncoder.encode(value);</span>
<span class="nc" id="L820">        buffer.append(encodedValue);</span>
<span class="nc" id="L821">    }</span>

    /**
     * Returns true if the Element &lt;code&gt;elem&lt;/code&gt; represents a control.
     */
    private boolean isControl(Element elem) {
<span class="nc" id="L827">        return elem.isLeaf();</span>
    }

    /**
     * Iterates over the element hierarchy to determine if
     * the element parameter, which is assumed to be an
     * &amp;lt;INPUT&amp;gt; element of type password or text, is the last
     * one of either kind, in the form to which it belongs.
     */
    boolean isLastTextOrPasswordField() {
<span class="nc" id="L837">        Element parent = getFormElement();</span>
<span class="nc" id="L838">        Element elem = getElement();</span>

<span class="nc bnc" id="L840" title="All 2 branches missed.">        if (parent != null) {</span>
<span class="nc" id="L841">            ElementIterator it = new ElementIterator(parent);</span>
            Element next;
<span class="nc" id="L843">            boolean found = false;</span>

<span class="nc bnc" id="L845" title="All 2 branches missed.">            while ((next = it.next()) != null) {</span>
<span class="nc bnc" id="L846" title="All 2 branches missed.">                if (next == elem) {</span>
<span class="nc" id="L847">                    found = true;</span>
                }
<span class="nc bnc" id="L849" title="All 4 branches missed.">                else if (found &amp;&amp; isControl(next)) {</span>
<span class="nc" id="L850">                    AttributeSet elemAttr = next.getAttributes();</span>

<span class="nc" id="L852">                    if (HTMLDocument.matchNameAttribute</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">                                     (elemAttr, HTML.Tag.INPUT)) {</span>
<span class="nc" id="L854">                        String type = (String)elemAttr.getAttribute</span>
<span class="nc" id="L855">                                                  (HTML.Attribute.TYPE);</span>

<span class="nc bnc" id="L857" title="All 4 branches missed.">                        if (&quot;text&quot;.equals(type) || &quot;password&quot;.equals(type)) {</span>
<span class="nc" id="L858">                            return false;</span>
                        }
                    }
<span class="nc" id="L861">                }</span>
            }
        }
<span class="nc" id="L864">        return true;</span>
    }

    /**
     * Resets the form
     * to its initial state by reinitializing the models
     * associated with each form element to their initial
     * values.
     *
     * param elem the element that triggered the reset
     */
    void resetForm() {
<span class="nc" id="L876">        Element parent = getFormElement();</span>

<span class="nc bnc" id="L878" title="All 2 branches missed.">        if (parent != null) {</span>
<span class="nc" id="L879">            ElementIterator it = new ElementIterator(parent);</span>
            Element next;

<span class="nc bnc" id="L882" title="All 2 branches missed.">            while((next = it.next()) != null) {</span>
<span class="nc bnc" id="L883" title="All 2 branches missed.">                if (isControl(next)) {</span>
<span class="nc" id="L884">                    AttributeSet elemAttr = next.getAttributes();</span>
<span class="nc" id="L885">                    Object m = elemAttr.getAttribute(StyleConstants.</span>
                                                     ModelAttribute);
<span class="nc bnc" id="L887" title="All 2 branches missed.">                    if (m instanceof TextAreaDocument) {</span>
<span class="nc" id="L888">                        TextAreaDocument doc = (TextAreaDocument)m;</span>
<span class="nc" id="L889">                        doc.reset();</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">                    } else if (m instanceof PlainDocument) {</span>
                        try {
<span class="nc" id="L892">                            PlainDocument doc =  (PlainDocument)m;</span>
<span class="nc" id="L893">                            doc.remove(0, doc.getLength());</span>
<span class="nc" id="L894">                            if (HTMLDocument.matchNameAttribute</span>
<span class="nc bnc" id="L895" title="All 2 branches missed.">                                             (elemAttr, HTML.Tag.INPUT)) {</span>
<span class="nc" id="L896">                                String value = (String)elemAttr.</span>
<span class="nc" id="L897">                                           getAttribute(HTML.Attribute.VALUE);</span>
<span class="nc bnc" id="L898" title="All 2 branches missed.">                                if (value != null) {</span>
<span class="nc" id="L899">                                    doc.insertString(0, value, null);</span>
                                }
                            }
<span class="nc" id="L902">                        } catch (BadLocationException e) {</span>
<span class="nc" id="L903">                        }</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">                    } else if (m instanceof OptionListModel) {</span>
<span class="nc" id="L905">                        OptionListModel model = (OptionListModel) m;</span>
<span class="nc" id="L906">                        int size = model.getSize();</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">                        for (int i = 0; i &lt; size; i++) {</span>
<span class="nc" id="L908">                            model.removeIndexInterval(i, i);</span>
                        }
<span class="nc" id="L910">                        BitSet selectionRange = model.getInitialSelection();</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">                        for (int i = 0; i &lt; selectionRange.size(); i++) {</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">                            if (selectionRange.get(i)) {</span>
<span class="nc" id="L913">                                model.addSelectionInterval(i, i);</span>
                            }
                        }
<span class="nc bnc" id="L916" title="All 2 branches missed.">                    } else if (m instanceof OptionComboBoxModel) {</span>
<span class="nc" id="L917">                        OptionComboBoxModel model = (OptionComboBoxModel) m;</span>
<span class="nc" id="L918">                        Option option = model.getInitialSelection();</span>
<span class="nc bnc" id="L919" title="All 2 branches missed.">                        if (option != null) {</span>
<span class="nc" id="L920">                            model.setSelectedItem(option);</span>
                        }
<span class="nc bnc" id="L922" title="All 2 branches missed.">                    } else if (m instanceof JToggleButton.ToggleButtonModel) {</span>
<span class="nc" id="L923">                        boolean checked = ((String)elemAttr.getAttribute</span>
<span class="nc bnc" id="L924" title="All 2 branches missed.">                                           (HTML.Attribute.CHECKED) != null);</span>
<span class="nc" id="L925">                        JToggleButton.ToggleButtonModel model =</span>
                                        (JToggleButton.ToggleButtonModel)m;
<span class="nc" id="L927">                        model.setSelected(checked);</span>
                    }
<span class="nc" id="L929">                }</span>
            }
        }
<span class="nc" id="L932">    }</span>


    /**
     * BrowseFileAction is used for input type == file. When the user
     * clicks the button a JFileChooser is brought up allowing the user
     * to select a file in the file system. The resulting path to the selected
     * file is set in the text field (actually an instance of Document).
     */
    private class BrowseFileAction implements ActionListener {
        private AttributeSet attrs;
        private Document model;

<span class="nc" id="L945">        BrowseFileAction(AttributeSet attrs, Document model) {</span>
<span class="nc" id="L946">            this.attrs = attrs;</span>
<span class="nc" id="L947">            this.model = model;</span>
<span class="nc" id="L948">        }</span>

        public void actionPerformed(ActionEvent ae) {
            // PENDING: When mime support is added to JFileChooser use the
            // accept value of attrs.
<span class="nc" id="L953">            JFileChooser fc = new JFileChooser();</span>
<span class="nc" id="L954">            fc.setMultiSelectionEnabled(false);</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">            if (fc.showOpenDialog(getContainer()) ==</span>
                  JFileChooser.APPROVE_OPTION) {
<span class="nc" id="L957">                File selected = fc.getSelectedFile();</span>

<span class="nc bnc" id="L959" title="All 2 branches missed.">                if (selected != null) {</span>
                    try {
<span class="nc bnc" id="L961" title="All 2 branches missed.">                        if (model.getLength() &gt; 0) {</span>
<span class="nc" id="L962">                            model.remove(0, model.getLength());</span>
                        }
<span class="nc" id="L964">                        model.insertString(0, selected.getPath(), null);</span>
<span class="nc" id="L965">                    } catch (BadLocationException ble) {}</span>
                }
            }
<span class="nc" id="L968">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>