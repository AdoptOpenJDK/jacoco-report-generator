<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>HRuleView.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.text.html</a> &gt; <span class="el_source">HRuleView.java</span></div><h1>HRuleView.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.text.html;

import java.awt.*;
import javax.swing.event.DocumentEvent;
import javax.swing.text.*;
import java.util.Enumeration;
import java.lang.Integer;

/**
 * A view implementation to display an html horizontal
 * rule.
 *
 * @author  Timothy Prinzing
 * @author  Sara Swanson
 */
class HRuleView extends View  {

    /**
     * Creates a new view that represents an &amp;lt;hr&amp;gt; element.
     *
     * @param elem the element to create a view for
     */
    public HRuleView(Element elem) {
<span class="nc" id="L48">        super(elem);</span>
<span class="nc" id="L49">        setPropertiesFromAttributes();</span>
<span class="nc" id="L50">    }</span>

    /**
     * Update any cached values that come from attributes.
     */
    protected void setPropertiesFromAttributes() {
<span class="nc" id="L56">        StyleSheet sheet = ((HTMLDocument)getDocument()).getStyleSheet();</span>
<span class="nc" id="L57">        AttributeSet eAttr = getElement().getAttributes();</span>
<span class="nc" id="L58">        attr = sheet.getViewAttributes(this);</span>

<span class="nc" id="L60">        alignment = StyleConstants.ALIGN_CENTER;</span>
<span class="nc" id="L61">        size = 0;</span>
<span class="nc" id="L62">        noshade = null;</span>
<span class="nc" id="L63">        widthValue = null;</span>

<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (attr != null) {</span>
            // getAlignment() returns ALIGN_LEFT by default, and HR should
            // use ALIGN_CENTER by default, so we check if the alignment
            // attribute is actually defined
<span class="nc bnc" id="L69" title="All 2 branches missed.">            if (attr.getAttribute(StyleConstants.Alignment) != null) {</span>
<span class="nc" id="L70">                alignment = StyleConstants.getAlignment(attr);</span>
            }

<span class="nc" id="L73">            noshade = (String)eAttr.getAttribute(HTML.Attribute.NOSHADE);</span>
<span class="nc" id="L74">            Object value = eAttr.getAttribute(HTML.Attribute.SIZE);</span>
<span class="nc bnc" id="L75" title="All 4 branches missed.">            if (value != null &amp;&amp; (value instanceof String)) {</span>
                try {
<span class="nc" id="L77">                    size = Integer.parseInt((String)value);</span>
<span class="nc" id="L78">                } catch (NumberFormatException e) {</span>
<span class="nc" id="L79">                    size = 1;</span>
<span class="nc" id="L80">                }</span>
            }
<span class="nc" id="L82">            value = attr.getAttribute(CSS.Attribute.WIDTH);</span>
<span class="nc bnc" id="L83" title="All 4 branches missed.">            if (value != null &amp;&amp; (value instanceof CSS.LengthValue)) {</span>
<span class="nc" id="L84">                widthValue = (CSS.LengthValue)value;</span>
            }
<span class="nc" id="L86">            topMargin = getLength(CSS.Attribute.MARGIN_TOP, attr);</span>
<span class="nc" id="L87">            bottomMargin = getLength(CSS.Attribute.MARGIN_BOTTOM, attr);</span>
<span class="nc" id="L88">            leftMargin = getLength(CSS.Attribute.MARGIN_LEFT, attr);</span>
<span class="nc" id="L89">            rightMargin = getLength(CSS.Attribute.MARGIN_RIGHT, attr);</span>
<span class="nc" id="L90">        }</span>
        else {
<span class="nc" id="L92">            topMargin = bottomMargin = leftMargin = rightMargin = 0;</span>
        }
<span class="nc" id="L94">        size = Math.max(2, size);</span>
<span class="nc" id="L95">    }</span>

    // This will be removed and centralized at some point, need to unify this
    // and avoid private classes.
    private float getLength(CSS.Attribute key, AttributeSet a) {
<span class="nc" id="L100">        CSS.LengthValue lv = (CSS.LengthValue) a.getAttribute(key);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">        float len = (lv != null) ? lv.getValue() : 0;</span>
<span class="nc" id="L102">        return len;</span>
    }

    // --- View methods ---------------------------------------------

    /**
     * Paints the view.
     *
     * @param g the graphics context
     * @param a the allocation region for the view
     * @see View#paint
     */
    public void paint(Graphics g, Shape a) {
<span class="nc bnc" id="L115" title="All 2 branches missed.">        Rectangle alloc = (a instanceof Rectangle) ? (Rectangle)a :</span>
<span class="nc" id="L116">                          a.getBounds();</span>
<span class="nc" id="L117">        int x = 0;</span>
<span class="nc" id="L118">        int y = alloc.y + SPACE_ABOVE + (int)topMargin;</span>
<span class="nc" id="L119">        int width = alloc.width - (int)(leftMargin + rightMargin);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (widthValue != null) {</span>
<span class="nc" id="L121">            width = (int)widthValue.getValue((float)width);</span>
        }
<span class="nc" id="L123">        int height = alloc.height - (SPACE_ABOVE + SPACE_BELOW +</span>
                                     (int)topMargin + (int)bottomMargin);
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (size &gt; 0)</span>
<span class="nc" id="L126">                height = size;</span>

        // Align the rule horizontally.
<span class="nc bnc" id="L129" title="All 3 branches missed.">        switch (alignment) {</span>
        case StyleConstants.ALIGN_CENTER:
<span class="nc" id="L131">            x = alloc.x + (alloc.width / 2) - (width / 2);</span>
<span class="nc" id="L132">            break;</span>
        case StyleConstants.ALIGN_RIGHT:
<span class="nc" id="L134">            x = alloc.x + alloc.width - width - (int)rightMargin;</span>
<span class="nc" id="L135">            break;</span>
        case StyleConstants.ALIGN_LEFT:
        default:
<span class="nc" id="L138">            x = alloc.x + (int)leftMargin;</span>
            break;
        }

        // Paint either a shaded rule or a solid line.
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (noshade != null) {</span>
<span class="nc" id="L144">            g.setColor(Color.black);</span>
<span class="nc" id="L145">            g.fillRect(x, y, width, height);</span>
        }
        else {
<span class="nc" id="L148">            Color bg = getContainer().getBackground();</span>
            Color bottom, top;
<span class="nc bnc" id="L150" title="All 4 branches missed.">            if (bg == null || bg.equals(Color.white)) {</span>
<span class="nc" id="L151">                top = Color.darkGray;</span>
<span class="nc" id="L152">                bottom = Color.lightGray;</span>
            }
            else {
<span class="nc" id="L155">                top = Color.darkGray;</span>
<span class="nc" id="L156">                bottom = Color.white;</span>
            }
<span class="nc" id="L158">            g.setColor(bottom);</span>
<span class="nc" id="L159">            g.drawLine(x + width - 1, y, x + width - 1, y + height - 1);</span>
<span class="nc" id="L160">            g.drawLine(x, y + height - 1, x + width - 1, y + height - 1);</span>
<span class="nc" id="L161">            g.setColor(top);</span>
<span class="nc" id="L162">            g.drawLine(x, y, x + width - 1, y);</span>
<span class="nc" id="L163">            g.drawLine(x, y, x, y + height - 1);</span>
        }

<span class="nc" id="L166">    }</span>


    /**
     * Calculates the desired shape of the rule... this is
     * basically the preferred size of the border.
     *
     * @param axis may be either X_AXIS or Y_AXIS
     * @return the desired span
     * @see View#getPreferredSpan
     */
    public float getPreferredSpan(int axis) {
<span class="nc bnc" id="L178" title="All 3 branches missed.">        switch (axis) {</span>
        case View.X_AXIS:
<span class="nc" id="L180">            return 1;</span>
        case View.Y_AXIS:
<span class="nc bnc" id="L182" title="All 2 branches missed.">            if (size &gt; 0) {</span>
<span class="nc" id="L183">                return size + SPACE_ABOVE + SPACE_BELOW + topMargin +</span>
                    bottomMargin;
            } else {
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if (noshade != null) {</span>
<span class="nc" id="L187">                    return 2 + SPACE_ABOVE + SPACE_BELOW + topMargin +</span>
                        bottomMargin;
                } else {
<span class="nc" id="L190">                    return SPACE_ABOVE + SPACE_BELOW + topMargin +bottomMargin;</span>
                }
            }
        default:
<span class="nc" id="L194">            throw new IllegalArgumentException(&quot;Invalid axis: &quot; + axis);</span>
        }
    }

    /**
     * Gets the resize weight for the axis.
     * The rule is: rigid vertically and flexible horizontally.
     *
     * @param axis may be either X_AXIS or Y_AXIS
     * @return the weight
     */
    public int getResizeWeight(int axis) {
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (axis == View.X_AXIS) {</span>
<span class="nc" id="L207">                return 1;</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">        } else if (axis == View.Y_AXIS) {</span>
<span class="nc" id="L209">                return 0;</span>
        } else {
<span class="nc" id="L211">            return 0;</span>
        }
    }

    /**
     * Determines how attractive a break opportunity in
     * this view is.  This is implemented to request a forced break.
     *
     * @param axis may be either View.X_AXIS or View.Y_AXIS
     * @param pos the potential location of the start of the
     *   broken view (greater than or equal to zero).
     *   This may be useful for calculating tab
     *   positions.
     * @param len specifies the relative length from &lt;em&gt;pos&lt;/em&gt;
     *   where a potential break is desired. The value must be greater
     *   than or equal to zero.
     * @return the weight, which should be a value between
     *   ForcedBreakWeight and BadBreakWeight.
     */
    public int getBreakWeight(int axis, float pos, float len) {
<span class="nc bnc" id="L231" title="All 2 branches missed.">        if (axis == X_AXIS) {</span>
<span class="nc" id="L232">            return ForcedBreakWeight;</span>
        }
<span class="nc" id="L234">        return BadBreakWeight;</span>
    }

    public View breakView(int axis, int offset, float pos, float len) {
<span class="nc" id="L238">        return null;</span>
    }

    /**
     * Provides a mapping from the document model coordinate space
     * to the coordinate space of the view mapped to it.
     *
     * @param pos the position to convert
     * @param a the allocated region to render into
     * @return the bounding box of the given position
     * @exception BadLocationException  if the given position does not
     * represent a valid location in the associated document
     * @see View#modelToView
     */
    public Shape modelToView(int pos, Shape a, Position.Bias b) throws BadLocationException {
<span class="nc" id="L253">        int p0 = getStartOffset();</span>
<span class="nc" id="L254">        int p1 = getEndOffset();</span>
<span class="nc bnc" id="L255" title="All 4 branches missed.">        if ((pos &gt;= p0) &amp;&amp; (pos &lt;= p1)) {</span>
<span class="nc" id="L256">            Rectangle r = a.getBounds();</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">            if (pos == p1) {</span>
<span class="nc" id="L258">                r.x += r.width;</span>
            }
<span class="nc" id="L260">            r.width = 0;</span>
<span class="nc" id="L261">            return r;</span>
        }
<span class="nc" id="L263">        return null;</span>
    }

    /**
     * Provides a mapping from the view coordinate space to the logical
     * coordinate space of the model.
     *
     * @param x the X coordinate
     * @param y the Y coordinate
     * @param a the allocated region to render into
     * @return the location within the model that best represents the
     *  given point of view
     * @see View#viewToModel
     */
    public int viewToModel(float x, float y, Shape a, Position.Bias[] bias) {
<span class="nc" id="L278">        Rectangle alloc = (Rectangle) a;</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (x &lt; alloc.x + (alloc.width / 2)) {</span>
<span class="nc" id="L280">            bias[0] = Position.Bias.Forward;</span>
<span class="nc" id="L281">            return getStartOffset();</span>
        }
<span class="nc" id="L283">        bias[0] = Position.Bias.Backward;</span>
<span class="nc" id="L284">        return getEndOffset();</span>
    }

    /**
     * Fetches the attributes to use when rendering.  This is
     * implemented to multiplex the attributes specified in the
     * model with a StyleSheet.
     */
    public AttributeSet getAttributes() {
<span class="nc" id="L293">        return attr;</span>
    }

    public void changedUpdate(DocumentEvent changes, Shape a, ViewFactory f) {
<span class="nc" id="L297">        super.changedUpdate(changes, a, f);</span>
<span class="nc" id="L298">        int pos = changes.getOffset();</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">        if (pos &lt;= getStartOffset() &amp;&amp; (pos + changes.getLength()) &gt;=</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">            getEndOffset()) {</span>
<span class="nc" id="L301">            setPropertiesFromAttributes();</span>
        }
<span class="nc" id="L303">    }</span>

    // --- variables ------------------------------------------------

    private float topMargin;
    private float bottomMargin;
    private float leftMargin;
    private float rightMargin;
<span class="nc" id="L311">    private int alignment = StyleConstants.ALIGN_CENTER;</span>
<span class="nc" id="L312">    private String noshade = null;</span>
<span class="nc" id="L313">    private int size = 0;</span>
    private CSS.LengthValue widthValue;

    private static final int SPACE_ABOVE = 3;
    private static final int SPACE_BELOW = 3;

    /** View Attributes. */
    private AttributeSet attr;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>