<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>CSS.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JDK</a> &gt; <a href="index.html" class="el_package">javax.swing.text.html</a> &gt; <span class="el_source">CSS.java</span></div><h1>CSS.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1998, 2008, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.text.html;

import java.awt.Color;
import java.awt.Font;
import java.awt.GraphicsEnvironment;
import java.awt.Toolkit;
import java.awt.HeadlessException;
import java.awt.Image;
import java.io.*;
import java.lang.reflect.Method;
import java.net.URL;
import java.net.MalformedURLException;
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Vector;
import java.util.Locale;
import javax.swing.ImageIcon;
import javax.swing.SizeRequirements;
import javax.swing.text.*;

/**
 * Defines a set of
 * &lt;a href=&quot;http://www.w3.org/TR/REC-CSS1&quot;&gt;CSS attributes&lt;/a&gt;
 * as a typesafe enumeration.  The HTML View implementations use
 * CSS attributes to determine how they will render. This also defines
 * methods to map between CSS/HTML/StyleConstants. Any shorthand
 * properties, such as font, are mapped to the intrinsic properties.
 * &lt;p&gt;The following describes the CSS properties that are supported by the
 * rendering engine:
 * &lt;ul&gt;&lt;li&gt;font-family
 *   &lt;li&gt;font-style
 *   &lt;li&gt;font-size (supports relative units)
 *   &lt;li&gt;font-weight
 *   &lt;li&gt;font
 *   &lt;li&gt;color
 *   &lt;li&gt;background-color (with the exception of transparent)
 *   &lt;li&gt;background-image
 *   &lt;li&gt;background-repeat
 *   &lt;li&gt;background-position
 *   &lt;li&gt;background
 *   &lt;li&gt;text-decoration (with the exception of blink and overline)
 *   &lt;li&gt;vertical-align (only sup and super)
 *   &lt;li&gt;text-align (justify is treated as center)
 *   &lt;li&gt;margin-top
 *   &lt;li&gt;margin-right
 *   &lt;li&gt;margin-bottom
 *   &lt;li&gt;margin-left
 *   &lt;li&gt;margin
 *   &lt;li&gt;padding-top
 *   &lt;li&gt;padding-right
 *   &lt;li&gt;padding-bottom
 *   &lt;li&gt;padding-left
 *   &lt;li&gt;padding
 *   &lt;li&gt;border-top-style
 *   &lt;li&gt;border-right-style
 *   &lt;li&gt;border-bottom-style
 *   &lt;li&gt;border-left-style
 *   &lt;li&gt;border-style (only supports inset, outset and none)
 *   &lt;li&gt;border-top-color
 *   &lt;li&gt;border-right-color
 *   &lt;li&gt;border-bottom-color
 *   &lt;li&gt;border-left-color
 *   &lt;li&gt;border-color
 *   &lt;li&gt;list-style-image
 *   &lt;li&gt;list-style-type
 *   &lt;li&gt;list-style-position
 * &lt;/ul&gt;
 * The following are modeled, but currently not rendered.
 * &lt;ul&gt;&lt;li&gt;font-variant
 *   &lt;li&gt;background-attachment (background always treated as scroll)
 *   &lt;li&gt;word-spacing
 *   &lt;li&gt;letter-spacing
 *   &lt;li&gt;text-indent
 *   &lt;li&gt;text-transform
 *   &lt;li&gt;line-height
 *   &lt;li&gt;border-top-width (this is used to indicate if a border should be used)
 *   &lt;li&gt;border-right-width
 *   &lt;li&gt;border-bottom-width
 *   &lt;li&gt;border-left-width
 *   &lt;li&gt;border-width
 *   &lt;li&gt;border-top
 *   &lt;li&gt;border-right
 *   &lt;li&gt;border-bottom
 *   &lt;li&gt;border-left
 *   &lt;li&gt;border
 *   &lt;li&gt;width
 *   &lt;li&gt;height
 *   &lt;li&gt;float
 *   &lt;li&gt;clear
 *   &lt;li&gt;display
 *   &lt;li&gt;white-space
 *   &lt;li&gt;list-style
 * &lt;/ul&gt;
 * &lt;p&gt;&lt;b&gt;Note: for the time being we do not fully support relative units,
 * unless noted, so that
 * p { margin-top: 10% } will be treated as if no margin-top was specified.&lt;/b&gt;
 *
 * @author  Timothy Prinzing
 * @author  Scott Violet
 * @see StyleSheet
 */
public class CSS implements Serializable {

    /**
     * Definitions to be used as a key on AttributeSet's
     * that might hold CSS attributes.  Since this is a
     * closed set (i.e. defined exactly by the specification),
     * it is final and cannot be extended.
     */
    public static final class Attribute {

<span class="nc" id="L136">        private Attribute(String name, String defaultValue, boolean inherited) {</span>
<span class="nc" id="L137">            this.name = name;</span>
<span class="nc" id="L138">            this.defaultValue = defaultValue;</span>
<span class="nc" id="L139">            this.inherited = inherited;</span>
<span class="nc" id="L140">        }</span>

        /**
         * The string representation of the attribute.  This
         * should exactly match the string specified in the
         * CSS specification.
         */
        public String toString() {
<span class="nc" id="L148">            return name;</span>
        }

        /**
         * Fetch the default value for the attribute.
         * If there is no default value (such as for
         * composite attributes), null will be returned.
         */
        public String getDefaultValue() {
<span class="nc" id="L157">            return defaultValue;</span>
        }

        /**
         * Indicates if the attribute should be inherited
         * from the parent or not.
         */
        public boolean isInherited() {
<span class="nc" id="L165">            return inherited;</span>
        }

        private String name;
        private String defaultValue;
        private boolean inherited;


<span class="nc" id="L173">        public static final Attribute BACKGROUND =</span>
            new Attribute(&quot;background&quot;, null, false);

<span class="nc" id="L176">        public static final Attribute BACKGROUND_ATTACHMENT =</span>
            new Attribute(&quot;background-attachment&quot;, &quot;scroll&quot;, false);

<span class="nc" id="L179">        public static final Attribute BACKGROUND_COLOR =</span>
            new Attribute(&quot;background-color&quot;, &quot;transparent&quot;, false);

<span class="nc" id="L182">        public static final Attribute BACKGROUND_IMAGE =</span>
            new Attribute(&quot;background-image&quot;, &quot;none&quot;, false);

<span class="nc" id="L185">        public static final Attribute BACKGROUND_POSITION =</span>
            new Attribute(&quot;background-position&quot;, null, false);

<span class="nc" id="L188">        public static final Attribute BACKGROUND_REPEAT =</span>
            new Attribute(&quot;background-repeat&quot;, &quot;repeat&quot;, false);

<span class="nc" id="L191">        public static final Attribute BORDER =</span>
            new Attribute(&quot;border&quot;, null, false);

<span class="nc" id="L194">        public static final Attribute BORDER_BOTTOM =</span>
            new Attribute(&quot;border-bottom&quot;, null, false);

<span class="nc" id="L197">        public static final Attribute BORDER_BOTTOM_COLOR =</span>
            new Attribute(&quot;border-bottom-color&quot;, null, false);

<span class="nc" id="L200">        public static final Attribute BORDER_BOTTOM_STYLE =</span>
            new Attribute(&quot;border-bottom-style&quot;, &quot;none&quot;, false);

<span class="nc" id="L203">        public static final Attribute BORDER_BOTTOM_WIDTH =</span>
            new Attribute(&quot;border-bottom-width&quot;, &quot;medium&quot;, false);

<span class="nc" id="L206">        public static final Attribute BORDER_COLOR =</span>
            new Attribute(&quot;border-color&quot;, null, false);

<span class="nc" id="L209">        public static final Attribute BORDER_LEFT =</span>
            new Attribute(&quot;border-left&quot;, null, false);

<span class="nc" id="L212">        public static final Attribute BORDER_LEFT_COLOR =</span>
            new Attribute(&quot;border-left-color&quot;, null, false);

<span class="nc" id="L215">        public static final Attribute BORDER_LEFT_STYLE =</span>
            new Attribute(&quot;border-left-style&quot;, &quot;none&quot;, false);

<span class="nc" id="L218">        public static final Attribute BORDER_LEFT_WIDTH =</span>
            new Attribute(&quot;border-left-width&quot;, &quot;medium&quot;, false);

<span class="nc" id="L221">        public static final Attribute BORDER_RIGHT =</span>
            new Attribute(&quot;border-right&quot;, null, false);

<span class="nc" id="L224">        public static final Attribute BORDER_RIGHT_COLOR =</span>
            new Attribute(&quot;border-right-color&quot;, null, false);

<span class="nc" id="L227">        public static final Attribute BORDER_RIGHT_STYLE =</span>
            new Attribute(&quot;border-right-style&quot;, &quot;none&quot;, false);

<span class="nc" id="L230">        public static final Attribute BORDER_RIGHT_WIDTH =</span>
            new Attribute(&quot;border-right-width&quot;, &quot;medium&quot;, false);

<span class="nc" id="L233">        public static final Attribute BORDER_STYLE =</span>
            new Attribute(&quot;border-style&quot;, &quot;none&quot;, false);

<span class="nc" id="L236">        public static final Attribute BORDER_TOP =</span>
            new Attribute(&quot;border-top&quot;, null, false);

<span class="nc" id="L239">        public static final Attribute BORDER_TOP_COLOR =</span>
            new Attribute(&quot;border-top-color&quot;, null, false);

<span class="nc" id="L242">        public static final Attribute BORDER_TOP_STYLE =</span>
            new Attribute(&quot;border-top-style&quot;, &quot;none&quot;, false);

<span class="nc" id="L245">        public static final Attribute BORDER_TOP_WIDTH =</span>
            new Attribute(&quot;border-top-width&quot;, &quot;medium&quot;, false);

<span class="nc" id="L248">        public static final Attribute BORDER_WIDTH =</span>
            new Attribute(&quot;border-width&quot;, &quot;medium&quot;, false);

<span class="nc" id="L251">        public static final Attribute CLEAR =</span>
            new Attribute(&quot;clear&quot;, &quot;none&quot;, false);

<span class="nc" id="L254">        public static final Attribute COLOR =</span>
            new Attribute(&quot;color&quot;, &quot;black&quot;, true);

<span class="nc" id="L257">        public static final Attribute DISPLAY =</span>
            new Attribute(&quot;display&quot;, &quot;block&quot;, false);

<span class="nc" id="L260">        public static final Attribute FLOAT =</span>
            new Attribute(&quot;float&quot;, &quot;none&quot;, false);

<span class="nc" id="L263">        public static final Attribute FONT =</span>
            new Attribute(&quot;font&quot;, null, true);

<span class="nc" id="L266">        public static final Attribute FONT_FAMILY =</span>
            new Attribute(&quot;font-family&quot;, null, true);

<span class="nc" id="L269">        public static final Attribute FONT_SIZE =</span>
            new Attribute(&quot;font-size&quot;, &quot;medium&quot;, true);

<span class="nc" id="L272">        public static final Attribute FONT_STYLE =</span>
            new Attribute(&quot;font-style&quot;, &quot;normal&quot;, true);

<span class="nc" id="L275">        public static final Attribute FONT_VARIANT =</span>
            new Attribute(&quot;font-variant&quot;, &quot;normal&quot;, true);

<span class="nc" id="L278">        public static final Attribute FONT_WEIGHT =</span>
            new Attribute(&quot;font-weight&quot;, &quot;normal&quot;, true);

<span class="nc" id="L281">        public static final Attribute HEIGHT =</span>
            new Attribute(&quot;height&quot;, &quot;auto&quot;, false);

<span class="nc" id="L284">        public static final Attribute LETTER_SPACING =</span>
            new Attribute(&quot;letter-spacing&quot;, &quot;normal&quot;, true);

<span class="nc" id="L287">        public static final Attribute LINE_HEIGHT =</span>
            new Attribute(&quot;line-height&quot;, &quot;normal&quot;, true);

<span class="nc" id="L290">        public static final Attribute LIST_STYLE =</span>
            new Attribute(&quot;list-style&quot;, null, true);

<span class="nc" id="L293">        public static final Attribute LIST_STYLE_IMAGE =</span>
            new Attribute(&quot;list-style-image&quot;, &quot;none&quot;, true);

<span class="nc" id="L296">        public static final Attribute LIST_STYLE_POSITION =</span>
            new Attribute(&quot;list-style-position&quot;, &quot;outside&quot;, true);

<span class="nc" id="L299">        public static final Attribute LIST_STYLE_TYPE =</span>
            new Attribute(&quot;list-style-type&quot;, &quot;disc&quot;, true);

<span class="nc" id="L302">        public static final Attribute MARGIN =</span>
            new Attribute(&quot;margin&quot;, null, false);

<span class="nc" id="L305">        public static final Attribute MARGIN_BOTTOM =</span>
            new Attribute(&quot;margin-bottom&quot;, &quot;0&quot;, false);

<span class="nc" id="L308">        public static final Attribute MARGIN_LEFT =</span>
            new Attribute(&quot;margin-left&quot;, &quot;0&quot;, false);

<span class="nc" id="L311">        public static final Attribute MARGIN_RIGHT =</span>
            new Attribute(&quot;margin-right&quot;, &quot;0&quot;, false);

        /*
         * made up css attributes to describe orientation depended
         * margins. used for &lt;dir&gt;, &lt;menu&gt;, &lt;ul&gt; etc. see
         * 5088268 for more details
         */
<span class="nc" id="L319">        static final Attribute MARGIN_LEFT_LTR =</span>
            new Attribute(&quot;margin-left-ltr&quot;,
<span class="nc" id="L321">                          Integer.toString(Integer.MIN_VALUE), false);</span>

<span class="nc" id="L323">        static final Attribute MARGIN_LEFT_RTL =</span>
            new Attribute(&quot;margin-left-rtl&quot;,
<span class="nc" id="L325">                          Integer.toString(Integer.MIN_VALUE), false);</span>

<span class="nc" id="L327">        static final Attribute MARGIN_RIGHT_LTR =</span>
            new Attribute(&quot;margin-right-ltr&quot;,
<span class="nc" id="L329">                          Integer.toString(Integer.MIN_VALUE), false);</span>

<span class="nc" id="L331">        static final Attribute MARGIN_RIGHT_RTL =</span>
            new Attribute(&quot;margin-right-rtl&quot;,
<span class="nc" id="L333">                          Integer.toString(Integer.MIN_VALUE), false);</span>


<span class="nc" id="L336">        public static final Attribute MARGIN_TOP =</span>
            new Attribute(&quot;margin-top&quot;, &quot;0&quot;, false);

<span class="nc" id="L339">        public static final Attribute PADDING =</span>
            new Attribute(&quot;padding&quot;, null, false);

<span class="nc" id="L342">        public static final Attribute PADDING_BOTTOM =</span>
            new Attribute(&quot;padding-bottom&quot;, &quot;0&quot;, false);

<span class="nc" id="L345">        public static final Attribute PADDING_LEFT =</span>
            new Attribute(&quot;padding-left&quot;, &quot;0&quot;, false);

<span class="nc" id="L348">        public static final Attribute PADDING_RIGHT =</span>
            new Attribute(&quot;padding-right&quot;, &quot;0&quot;, false);

<span class="nc" id="L351">        public static final Attribute PADDING_TOP =</span>
            new Attribute(&quot;padding-top&quot;, &quot;0&quot;, false);

<span class="nc" id="L354">        public static final Attribute TEXT_ALIGN =</span>
            new Attribute(&quot;text-align&quot;, null, true);

<span class="nc" id="L357">        public static final Attribute TEXT_DECORATION =</span>
            new Attribute(&quot;text-decoration&quot;, &quot;none&quot;, true);

<span class="nc" id="L360">        public static final Attribute TEXT_INDENT =</span>
            new Attribute(&quot;text-indent&quot;, &quot;0&quot;, true);

<span class="nc" id="L363">        public static final Attribute TEXT_TRANSFORM =</span>
            new Attribute(&quot;text-transform&quot;, &quot;none&quot;, true);

<span class="nc" id="L366">        public static final Attribute VERTICAL_ALIGN =</span>
            new Attribute(&quot;vertical-align&quot;, &quot;baseline&quot;, false);

<span class="nc" id="L369">        public static final Attribute WORD_SPACING =</span>
            new Attribute(&quot;word-spacing&quot;, &quot;normal&quot;, true);

<span class="nc" id="L372">        public static final Attribute WHITE_SPACE =</span>
            new Attribute(&quot;white-space&quot;, &quot;normal&quot;, true);

<span class="nc" id="L375">        public static final Attribute WIDTH =</span>
            new Attribute(&quot;width&quot;, &quot;auto&quot;, false);

<span class="nc" id="L378">        /*public*/ static final Attribute BORDER_SPACING =</span>
            new Attribute(&quot;border-spacing&quot;, &quot;0&quot;, true);

<span class="nc" id="L381">        /*public*/ static final Attribute CAPTION_SIDE =</span>
            new Attribute(&quot;caption-side&quot;, &quot;left&quot;, true);

        // All possible CSS attribute keys.
<span class="nc" id="L385">        static final Attribute[] allAttributes = {</span>
            BACKGROUND, BACKGROUND_ATTACHMENT, BACKGROUND_COLOR,
            BACKGROUND_IMAGE, BACKGROUND_POSITION, BACKGROUND_REPEAT,
            BORDER, BORDER_BOTTOM, BORDER_BOTTOM_WIDTH, BORDER_COLOR,
            BORDER_LEFT, BORDER_LEFT_WIDTH, BORDER_RIGHT, BORDER_RIGHT_WIDTH,
            BORDER_STYLE, BORDER_TOP, BORDER_TOP_WIDTH, BORDER_WIDTH,
            BORDER_TOP_STYLE, BORDER_RIGHT_STYLE, BORDER_BOTTOM_STYLE,
            BORDER_LEFT_STYLE,
            BORDER_TOP_COLOR, BORDER_RIGHT_COLOR, BORDER_BOTTOM_COLOR,
            BORDER_LEFT_COLOR,
            CLEAR, COLOR, DISPLAY, FLOAT, FONT, FONT_FAMILY, FONT_SIZE,
            FONT_STYLE, FONT_VARIANT, FONT_WEIGHT, HEIGHT, LETTER_SPACING,
            LINE_HEIGHT, LIST_STYLE, LIST_STYLE_IMAGE, LIST_STYLE_POSITION,
            LIST_STYLE_TYPE, MARGIN, MARGIN_BOTTOM, MARGIN_LEFT, MARGIN_RIGHT,
            MARGIN_TOP, PADDING, PADDING_BOTTOM, PADDING_LEFT, PADDING_RIGHT,
            PADDING_TOP, TEXT_ALIGN, TEXT_DECORATION, TEXT_INDENT, TEXT_TRANSFORM,
            VERTICAL_ALIGN, WORD_SPACING, WHITE_SPACE, WIDTH,
            BORDER_SPACING, CAPTION_SIDE,
            MARGIN_LEFT_LTR, MARGIN_LEFT_RTL, MARGIN_RIGHT_LTR, MARGIN_RIGHT_RTL
        };

<span class="nc" id="L406">        private static final Attribute[] ALL_MARGINS =</span>
                { MARGIN_TOP, MARGIN_RIGHT, MARGIN_BOTTOM, MARGIN_LEFT };
<span class="nc" id="L408">        private static final Attribute[] ALL_PADDING =</span>
                { PADDING_TOP, PADDING_RIGHT, PADDING_BOTTOM, PADDING_LEFT };
<span class="nc" id="L410">        private static final Attribute[] ALL_BORDER_WIDTHS =</span>
                { BORDER_TOP_WIDTH, BORDER_RIGHT_WIDTH, BORDER_BOTTOM_WIDTH,
                  BORDER_LEFT_WIDTH };
<span class="nc" id="L413">        private static final Attribute[] ALL_BORDER_STYLES =</span>
                { BORDER_TOP_STYLE, BORDER_RIGHT_STYLE, BORDER_BOTTOM_STYLE,
                  BORDER_LEFT_STYLE };
<span class="nc" id="L416">        private static final Attribute[] ALL_BORDER_COLORS =</span>
                { BORDER_TOP_COLOR, BORDER_RIGHT_COLOR, BORDER_BOTTOM_COLOR,
                  BORDER_LEFT_COLOR };

    }

    static final class Value {

<span class="nc" id="L424">        private Value(String name) {</span>
<span class="nc" id="L425">            this.name = name;</span>
<span class="nc" id="L426">        }</span>

        /**
         * The string representation of the attribute.  This
         * should exactly match the string specified in the
         * CSS specification.
         */
        public String toString() {
<span class="nc" id="L434">            return name;</span>
        }

<span class="nc" id="L437">        static final Value INHERITED = new Value(&quot;inherited&quot;);</span>
<span class="nc" id="L438">        static final Value NONE = new Value(&quot;none&quot;);</span>
<span class="nc" id="L439">        static final Value HIDDEN = new Value(&quot;hidden&quot;);</span>
<span class="nc" id="L440">        static final Value DOTTED = new Value(&quot;dotted&quot;);</span>
<span class="nc" id="L441">        static final Value DASHED = new Value(&quot;dashed&quot;);</span>
<span class="nc" id="L442">        static final Value SOLID = new Value(&quot;solid&quot;);</span>
<span class="nc" id="L443">        static final Value DOUBLE = new Value(&quot;double&quot;);</span>
<span class="nc" id="L444">        static final Value GROOVE = new Value(&quot;groove&quot;);</span>
<span class="nc" id="L445">        static final Value RIDGE = new Value(&quot;ridge&quot;);</span>
<span class="nc" id="L446">        static final Value INSET = new Value(&quot;inset&quot;);</span>
<span class="nc" id="L447">        static final Value OUTSET = new Value(&quot;outset&quot;);</span>
        // Lists.
<span class="nc" id="L449">        static final Value DISC = new Value(&quot;disc&quot;);</span>
<span class="nc" id="L450">        static final Value CIRCLE = new Value(&quot;circle&quot;);</span>
<span class="nc" id="L451">        static final Value SQUARE = new Value(&quot;square&quot;);</span>
<span class="nc" id="L452">        static final Value DECIMAL = new Value(&quot;decimal&quot;);</span>
<span class="nc" id="L453">        static final Value LOWER_ROMAN = new Value(&quot;lower-roman&quot;);</span>
<span class="nc" id="L454">        static final Value UPPER_ROMAN = new Value(&quot;upper-roman&quot;);</span>
<span class="nc" id="L455">        static final Value LOWER_ALPHA = new Value(&quot;lower-alpha&quot;);</span>
<span class="nc" id="L456">        static final Value UPPER_ALPHA = new Value(&quot;upper-alpha&quot;);</span>
        // background-repeat
<span class="nc" id="L458">        static final Value BACKGROUND_NO_REPEAT = new Value(&quot;no-repeat&quot;);</span>
<span class="nc" id="L459">        static final Value BACKGROUND_REPEAT = new Value(&quot;repeat&quot;);</span>
<span class="nc" id="L460">        static final Value BACKGROUND_REPEAT_X = new Value(&quot;repeat-x&quot;);</span>
<span class="nc" id="L461">        static final Value BACKGROUND_REPEAT_Y = new Value(&quot;repeat-y&quot;);</span>
        // background-attachment
<span class="nc" id="L463">        static final Value BACKGROUND_SCROLL = new Value(&quot;scroll&quot;);</span>
<span class="nc" id="L464">        static final Value BACKGROUND_FIXED = new Value(&quot;fixed&quot;);</span>

        private String name;

<span class="nc" id="L468">        static final Value[] allValues = {</span>
            INHERITED, NONE, DOTTED, DASHED, SOLID, DOUBLE, GROOVE,
            RIDGE, INSET, OUTSET, DISC, CIRCLE, SQUARE, DECIMAL,
            LOWER_ROMAN, UPPER_ROMAN, LOWER_ALPHA, UPPER_ALPHA,
            BACKGROUND_NO_REPEAT, BACKGROUND_REPEAT,
            BACKGROUND_REPEAT_X, BACKGROUND_REPEAT_Y,
            BACKGROUND_FIXED, BACKGROUND_FIXED
        };
    }

<span class="nc" id="L478">    public CSS() {</span>
<span class="nc" id="L479">        baseFontSize = baseFontSizeIndex + 1;</span>
        // setup the css conversion table
<span class="nc" id="L481">        valueConvertor = new Hashtable&lt;Object, Object&gt;();</span>
<span class="nc" id="L482">        valueConvertor.put(CSS.Attribute.FONT_SIZE, new FontSize());</span>
<span class="nc" id="L483">        valueConvertor.put(CSS.Attribute.FONT_FAMILY, new FontFamily());</span>
<span class="nc" id="L484">        valueConvertor.put(CSS.Attribute.FONT_WEIGHT, new FontWeight());</span>
<span class="nc" id="L485">        Object bs = new BorderStyle();</span>
<span class="nc" id="L486">        valueConvertor.put(CSS.Attribute.BORDER_TOP_STYLE, bs);</span>
<span class="nc" id="L487">        valueConvertor.put(CSS.Attribute.BORDER_RIGHT_STYLE, bs);</span>
<span class="nc" id="L488">        valueConvertor.put(CSS.Attribute.BORDER_BOTTOM_STYLE, bs);</span>
<span class="nc" id="L489">        valueConvertor.put(CSS.Attribute.BORDER_LEFT_STYLE, bs);</span>
<span class="nc" id="L490">        Object cv = new ColorValue();</span>
<span class="nc" id="L491">        valueConvertor.put(CSS.Attribute.COLOR, cv);</span>
<span class="nc" id="L492">        valueConvertor.put(CSS.Attribute.BACKGROUND_COLOR, cv);</span>
<span class="nc" id="L493">        valueConvertor.put(CSS.Attribute.BORDER_TOP_COLOR, cv);</span>
<span class="nc" id="L494">        valueConvertor.put(CSS.Attribute.BORDER_RIGHT_COLOR, cv);</span>
<span class="nc" id="L495">        valueConvertor.put(CSS.Attribute.BORDER_BOTTOM_COLOR, cv);</span>
<span class="nc" id="L496">        valueConvertor.put(CSS.Attribute.BORDER_LEFT_COLOR, cv);</span>
<span class="nc" id="L497">        Object lv = new LengthValue();</span>
<span class="nc" id="L498">        valueConvertor.put(CSS.Attribute.MARGIN_TOP, lv);</span>
<span class="nc" id="L499">        valueConvertor.put(CSS.Attribute.MARGIN_BOTTOM, lv);</span>
<span class="nc" id="L500">        valueConvertor.put(CSS.Attribute.MARGIN_LEFT, lv);</span>
<span class="nc" id="L501">        valueConvertor.put(CSS.Attribute.MARGIN_LEFT_LTR, lv);</span>
<span class="nc" id="L502">        valueConvertor.put(CSS.Attribute.MARGIN_LEFT_RTL, lv);</span>
<span class="nc" id="L503">        valueConvertor.put(CSS.Attribute.MARGIN_RIGHT, lv);</span>
<span class="nc" id="L504">        valueConvertor.put(CSS.Attribute.MARGIN_RIGHT_LTR, lv);</span>
<span class="nc" id="L505">        valueConvertor.put(CSS.Attribute.MARGIN_RIGHT_RTL, lv);</span>
<span class="nc" id="L506">        valueConvertor.put(CSS.Attribute.PADDING_TOP, lv);</span>
<span class="nc" id="L507">        valueConvertor.put(CSS.Attribute.PADDING_BOTTOM, lv);</span>
<span class="nc" id="L508">        valueConvertor.put(CSS.Attribute.PADDING_LEFT, lv);</span>
<span class="nc" id="L509">        valueConvertor.put(CSS.Attribute.PADDING_RIGHT, lv);</span>
<span class="nc" id="L510">        Object bv = new BorderWidthValue(null, 0);</span>
<span class="nc" id="L511">        valueConvertor.put(CSS.Attribute.BORDER_TOP_WIDTH, bv);</span>
<span class="nc" id="L512">        valueConvertor.put(CSS.Attribute.BORDER_BOTTOM_WIDTH, bv);</span>
<span class="nc" id="L513">        valueConvertor.put(CSS.Attribute.BORDER_LEFT_WIDTH, bv);</span>
<span class="nc" id="L514">        valueConvertor.put(CSS.Attribute.BORDER_RIGHT_WIDTH, bv);</span>
<span class="nc" id="L515">        Object nlv = new LengthValue(true);</span>
<span class="nc" id="L516">        valueConvertor.put(CSS.Attribute.TEXT_INDENT, nlv);</span>
<span class="nc" id="L517">        valueConvertor.put(CSS.Attribute.WIDTH, lv);</span>
<span class="nc" id="L518">        valueConvertor.put(CSS.Attribute.HEIGHT, lv);</span>
<span class="nc" id="L519">        valueConvertor.put(CSS.Attribute.BORDER_SPACING, lv);</span>
<span class="nc" id="L520">        Object sv = new StringValue();</span>
<span class="nc" id="L521">        valueConvertor.put(CSS.Attribute.FONT_STYLE, sv);</span>
<span class="nc" id="L522">        valueConvertor.put(CSS.Attribute.TEXT_DECORATION, sv);</span>
<span class="nc" id="L523">        valueConvertor.put(CSS.Attribute.TEXT_ALIGN, sv);</span>
<span class="nc" id="L524">        valueConvertor.put(CSS.Attribute.VERTICAL_ALIGN, sv);</span>
<span class="nc" id="L525">        Object valueMapper = new CssValueMapper();</span>
<span class="nc" id="L526">        valueConvertor.put(CSS.Attribute.LIST_STYLE_TYPE,</span>
                           valueMapper);
<span class="nc" id="L528">        valueConvertor.put(CSS.Attribute.BACKGROUND_IMAGE,</span>
                           new BackgroundImage());
<span class="nc" id="L530">        valueConvertor.put(CSS.Attribute.BACKGROUND_POSITION,</span>
                           new BackgroundPosition());
<span class="nc" id="L532">        valueConvertor.put(CSS.Attribute.BACKGROUND_REPEAT,</span>
                           valueMapper);
<span class="nc" id="L534">        valueConvertor.put(CSS.Attribute.BACKGROUND_ATTACHMENT,</span>
                           valueMapper);
<span class="nc" id="L536">        Object generic = new CssValue();</span>
<span class="nc" id="L537">        int n = CSS.Attribute.allAttributes.length;</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc" id="L539">            CSS.Attribute key = CSS.Attribute.allAttributes[i];</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">            if (valueConvertor.get(key) == null) {</span>
<span class="nc" id="L541">                valueConvertor.put(key, generic);</span>
            }
        }
<span class="nc" id="L544">    }</span>

    /**
     * Sets the base font size. &lt;code&gt;sz&lt;/code&gt; is a CSS value, and is
     * not necessarily the point size. Use getPointSize to determine the
     * point size corresponding to &lt;code&gt;sz&lt;/code&gt;.
     */
    void setBaseFontSize(int sz) {
<span class="nc bnc" id="L552" title="All 2 branches missed.">        if (sz &lt; 1)</span>
<span class="nc" id="L553">          baseFontSize = 0;</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        else if (sz &gt; 7)</span>
<span class="nc" id="L555">          baseFontSize = 7;</span>
        else
<span class="nc" id="L557">          baseFontSize = sz;</span>
<span class="nc" id="L558">    }</span>

    /**
     * Sets the base font size from the passed in string.
     */
    void setBaseFontSize(String size) {
        int relSize, absSize, diff;

<span class="nc bnc" id="L566" title="All 2 branches missed.">        if (size != null) {</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">            if (size.startsWith(&quot;+&quot;)) {</span>
<span class="nc" id="L568">                relSize = Integer.valueOf(size.substring(1)).intValue();</span>
<span class="nc" id="L569">                setBaseFontSize(baseFontSize + relSize);</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">            } else if (size.startsWith(&quot;-&quot;)) {</span>
<span class="nc" id="L571">                relSize = -Integer.valueOf(size.substring(1)).intValue();</span>
<span class="nc" id="L572">                setBaseFontSize(baseFontSize + relSize);</span>
            } else {
<span class="nc" id="L574">                setBaseFontSize(Integer.valueOf(size).intValue());</span>
            }
        }
<span class="nc" id="L577">    }</span>

    /**
     * Returns the base font size.
     */
    int getBaseFontSize() {
<span class="nc" id="L583">        return baseFontSize;</span>
    }

    /**
     * Parses the CSS property &lt;code&gt;key&lt;/code&gt; with value
     * &lt;code&gt;value&lt;/code&gt; placing the result in &lt;code&gt;att&lt;/code&gt;.
     */
    void addInternalCSSValue(MutableAttributeSet attr,
                             CSS.Attribute key, String value) {
<span class="nc bnc" id="L592" title="All 2 branches missed.">        if (key == CSS.Attribute.FONT) {</span>
<span class="nc" id="L593">            ShorthandFontParser.parseShorthandFont(this, value, attr);</span>
        }
<span class="nc bnc" id="L595" title="All 2 branches missed.">        else if (key == CSS.Attribute.BACKGROUND) {</span>
<span class="nc" id="L596">            ShorthandBackgroundParser.parseShorthandBackground</span>
<span class="nc" id="L597">                               (this, value, attr);</span>
        }
<span class="nc bnc" id="L599" title="All 2 branches missed.">        else if (key == CSS.Attribute.MARGIN) {</span>
<span class="nc" id="L600">            ShorthandMarginParser.parseShorthandMargin(this, value, attr,</span>
<span class="nc" id="L601">                                           CSS.Attribute.ALL_MARGINS);</span>
        }
<span class="nc bnc" id="L603" title="All 2 branches missed.">        else if (key == CSS.Attribute.PADDING) {</span>
<span class="nc" id="L604">            ShorthandMarginParser.parseShorthandMargin(this, value, attr,</span>
<span class="nc" id="L605">                                           CSS.Attribute.ALL_PADDING);</span>
        }
<span class="nc bnc" id="L607" title="All 2 branches missed.">        else if (key == CSS.Attribute.BORDER_WIDTH) {</span>
<span class="nc" id="L608">            ShorthandMarginParser.parseShorthandMargin(this, value, attr,</span>
<span class="nc" id="L609">                                           CSS.Attribute.ALL_BORDER_WIDTHS);</span>
        }
<span class="nc bnc" id="L611" title="All 2 branches missed.">        else if (key == CSS.Attribute.BORDER_COLOR) {</span>
<span class="nc" id="L612">            ShorthandMarginParser.parseShorthandMargin(this, value, attr,</span>
<span class="nc" id="L613">                                            CSS.Attribute.ALL_BORDER_COLORS);</span>
        }
<span class="nc bnc" id="L615" title="All 2 branches missed.">        else if (key == CSS.Attribute.BORDER_STYLE) {</span>
<span class="nc" id="L616">            ShorthandMarginParser.parseShorthandMargin(this, value, attr,</span>
<span class="nc" id="L617">                                            CSS.Attribute.ALL_BORDER_STYLES);</span>
        }
<span class="nc bnc" id="L619" title="All 10 branches missed.">        else if ((key == CSS.Attribute.BORDER) ||</span>
                   (key == CSS.Attribute.BORDER_TOP) ||
                   (key == CSS.Attribute.BORDER_RIGHT) ||
                   (key == CSS.Attribute.BORDER_BOTTOM) ||
                   (key == CSS.Attribute.BORDER_LEFT)) {
<span class="nc" id="L624">            ShorthandBorderParser.parseShorthandBorder(attr, key, value);</span>
        }
        else {
<span class="nc" id="L627">            Object iValue = getInternalCSSValue(key, value);</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">            if (iValue != null) {</span>
<span class="nc" id="L629">                attr.addAttribute(key, iValue);</span>
            }
        }
<span class="nc" id="L632">    }</span>

    /**
     * Gets the internal CSS representation of &lt;code&gt;value&lt;/code&gt; which is
     * a CSS value of the CSS attribute named &lt;code&gt;key&lt;/code&gt;. The receiver
     * should not modify &lt;code&gt;value&lt;/code&gt;, and the first &lt;code&gt;count&lt;/code&gt;
     * strings are valid.
     */
    Object getInternalCSSValue(CSS.Attribute key, String value) {
<span class="nc" id="L641">        CssValue conv = (CssValue) valueConvertor.get(key);</span>
<span class="nc" id="L642">        Object r = conv.parseCssValue(value);</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">        return r != null ? r : conv.parseCssValue(key.getDefaultValue());</span>
    }

    /**
     * Maps from a StyleConstants to a CSS Attribute.
     */
    Attribute styleConstantsKeyToCSSKey(StyleConstants sc) {
<span class="nc" id="L650">        return styleConstantToCssMap.get(sc);</span>
    }

    /**
     * Maps from a StyleConstants value to a CSS value.
     */
    Object styleConstantsValueToCSSValue(StyleConstants sc,
                                         Object styleValue) {
<span class="nc" id="L658">        Attribute cssKey = styleConstantsKeyToCSSKey(sc);</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">        if (cssKey != null) {</span>
<span class="nc" id="L660">            CssValue conv = (CssValue)valueConvertor.get(cssKey);</span>
<span class="nc" id="L661">            return conv.fromStyleConstants(sc, styleValue);</span>
        }
<span class="nc" id="L663">        return null;</span>
    }

    /**
     * Converts the passed in CSS value to a StyleConstants value.
     * &lt;code&gt;key&lt;/code&gt; identifies the CSS attribute being mapped.
     */
    Object cssValueToStyleConstantsValue(StyleConstants key, Object value) {
<span class="nc bnc" id="L671" title="All 2 branches missed.">        if (value instanceof CssValue) {</span>
<span class="nc" id="L672">            return ((CssValue)value).toStyleConstants(key, null);</span>
        }
<span class="nc" id="L674">        return null;</span>
    }

    /**
     * Returns the font for the values in the passed in AttributeSet.
     * It is assumed the keys will be CSS.Attribute keys.
     * &lt;code&gt;sc&lt;/code&gt; is the StyleContext that will be messaged to get
     * the font once the size, name and style have been determined.
     */
    Font getFont(StyleContext sc, AttributeSet a, int defaultSize, StyleSheet ss) {
<span class="nc" id="L684">        ss = getStyleSheet(ss);</span>
<span class="nc" id="L685">        int size = getFontSize(a, defaultSize, ss);</span>

        /*
         * If the vertical alignment is set to either superscirpt or
         * subscript we reduce the font size by 2 points.
         */
<span class="nc" id="L691">        StringValue vAlignV = (StringValue)a.getAttribute</span>
<span class="nc" id="L692">                              (CSS.Attribute.VERTICAL_ALIGN);</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">        if ((vAlignV != null)) {</span>
<span class="nc" id="L694">            String vAlign = vAlignV.toString();</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">            if ((vAlign.indexOf(&quot;sup&quot;) &gt;= 0) ||</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">                (vAlign.indexOf(&quot;sub&quot;) &gt;= 0)) {</span>
<span class="nc" id="L697">                size -= 2;</span>
            }
        }

<span class="nc" id="L701">        FontFamily familyValue = (FontFamily)a.getAttribute</span>
<span class="nc" id="L702">                                            (CSS.Attribute.FONT_FAMILY);</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">        String family = (familyValue != null) ? familyValue.getValue() :</span>
                                  Font.SANS_SERIF;
<span class="nc" id="L705">        int style = Font.PLAIN;</span>
<span class="nc" id="L706">        FontWeight weightValue = (FontWeight) a.getAttribute</span>
<span class="nc" id="L707">                                  (CSS.Attribute.FONT_WEIGHT);</span>
<span class="nc bnc" id="L708" title="All 4 branches missed.">        if ((weightValue != null) &amp;&amp; (weightValue.getValue() &gt; 400)) {</span>
<span class="nc" id="L709">            style |= Font.BOLD;</span>
        }
<span class="nc" id="L711">        Object fs = a.getAttribute(CSS.Attribute.FONT_STYLE);</span>
<span class="nc bnc" id="L712" title="All 4 branches missed.">        if ((fs != null) &amp;&amp; (fs.toString().indexOf(&quot;italic&quot;) &gt;= 0)) {</span>
<span class="nc" id="L713">            style |= Font.ITALIC;</span>
        }
<span class="nc bnc" id="L715" title="All 2 branches missed.">        if (family.equalsIgnoreCase(&quot;monospace&quot;)) {</span>
<span class="nc" id="L716">            family = Font.MONOSPACED;</span>
        }
<span class="nc" id="L718">        Font f = sc.getFont(family, style, size);</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if (f == null</span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">            || (f.getFamily().equals(Font.DIALOG)</span>
<span class="nc bnc" id="L721" title="All 2 branches missed.">                &amp;&amp; ! family.equalsIgnoreCase(Font.DIALOG))) {</span>
<span class="nc" id="L722">            family = Font.SANS_SERIF;</span>
<span class="nc" id="L723">            f = sc.getFont(family, style, size);</span>
        }
<span class="nc" id="L725">        return f;</span>
    }

    static int getFontSize(AttributeSet attr, int defaultSize, StyleSheet ss) {
        // PENDING(prinz) this is a 1.1 based implementation, need to also
        // have a 1.2 version.
<span class="nc" id="L731">        FontSize sizeValue = (FontSize)attr.getAttribute(CSS.Attribute.</span>
                                                         FONT_SIZE);

<span class="nc bnc" id="L734" title="All 2 branches missed.">        return (sizeValue != null) ? sizeValue.getValue(attr, ss)</span>
                                   : defaultSize;
    }

    /**
     * Takes a set of attributes and turn it into a color
     * specification.  This might be used to specify things
     * like brighter, more hue, etc.
     * This will return null if there is no value for &lt;code&gt;key&lt;/code&gt;.
     *
     * @param key CSS.Attribute identifying where color is stored.
     * @param a the set of attributes
     * @return the color
     */
    Color getColor(AttributeSet a, CSS.Attribute key) {
<span class="nc" id="L749">        ColorValue cv = (ColorValue) a.getAttribute(key);</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">        if (cv != null) {</span>
<span class="nc" id="L751">            return cv.getValue();</span>
        }
<span class="nc" id="L753">        return null;</span>
    }

    /**
     * Returns the size of a font from the passed in string.
     *
     * @param size CSS string describing font size
     * @param baseFontSize size to use for relative units.
     */
    float getPointSize(String size, StyleSheet ss) {
        int relSize, absSize, diff, index;
<span class="nc" id="L764">        ss = getStyleSheet(ss);</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">        if (size != null) {</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">            if (size.startsWith(&quot;+&quot;)) {</span>
<span class="nc" id="L767">                relSize = Integer.valueOf(size.substring(1)).intValue();</span>
<span class="nc" id="L768">                return getPointSize(baseFontSize + relSize, ss);</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">            } else if (size.startsWith(&quot;-&quot;)) {</span>
<span class="nc" id="L770">                relSize = -Integer.valueOf(size.substring(1)).intValue();</span>
<span class="nc" id="L771">                return getPointSize(baseFontSize + relSize, ss);</span>
            } else {
<span class="nc" id="L773">                absSize = Integer.valueOf(size).intValue();</span>
<span class="nc" id="L774">                return getPointSize(absSize, ss);</span>
            }
        }
<span class="nc" id="L777">        return 0;</span>
    }

    /**
     * Returns the length of the attribute in &lt;code&gt;a&lt;/code&gt; with
     * key &lt;code&gt;key&lt;/code&gt;.
     */
    float getLength(AttributeSet a, CSS.Attribute key, StyleSheet ss) {
<span class="nc" id="L785">        ss = getStyleSheet(ss);</span>
<span class="nc" id="L786">        LengthValue lv = (LengthValue) a.getAttribute(key);</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">        boolean isW3CLengthUnits = (ss == null) ? false : ss.isW3CLengthUnits();</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">        float len = (lv != null) ? lv.getValue(isW3CLengthUnits) : 0;</span>
<span class="nc" id="L789">        return len;</span>
    }

    /**
     * Convert a set of HTML attributes to an equivalent
     * set of CSS attributes.
     *
     * @param htmlAttrSet AttributeSet containing the HTML attributes.
     * @return AttributeSet containing the corresponding CSS attributes.
     *        The AttributeSet will be empty if there are no mapping
     *        CSS attributes.
     */
    AttributeSet translateHTMLToCSS(AttributeSet htmlAttrSet) {
<span class="nc" id="L802">        MutableAttributeSet cssAttrSet = new SimpleAttributeSet();</span>
<span class="nc" id="L803">        Element elem = (Element)htmlAttrSet;</span>
<span class="nc" id="L804">        HTML.Tag tag = getHTMLTag(htmlAttrSet);</span>
<span class="nc bnc" id="L805" title="All 4 branches missed.">        if ((tag == HTML.Tag.TD) || (tag == HTML.Tag.TH)) {</span>
            // translate border width into the cells, if it has non-zero value.
<span class="nc" id="L807">            AttributeSet tableAttr = elem.getParentElement().</span>
<span class="nc" id="L808">                                     getParentElement().getAttributes();</span>

<span class="nc" id="L810">            int borderWidth = getTableBorder(tableAttr);</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">            if (borderWidth &gt; 0) {</span>
                // If table contains the BORDER attribute cells should have border width equals 1
<span class="nc" id="L813">                translateAttribute(HTML.Attribute.BORDER, &quot;1&quot;, cssAttrSet);</span>
            }
<span class="nc" id="L815">            String pad = (String)tableAttr.getAttribute(HTML.Attribute.CELLPADDING);</span>
<span class="nc bnc" id="L816" title="All 2 branches missed.">            if (pad != null) {</span>
<span class="nc" id="L817">                LengthValue v =</span>
<span class="nc" id="L818">                    (LengthValue)getInternalCSSValue(CSS.Attribute.PADDING_TOP, pad);</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">                v.span = (v.span &lt; 0) ? 0 : v.span;</span>
<span class="nc" id="L820">                cssAttrSet.addAttribute(CSS.Attribute.PADDING_TOP, v);</span>
<span class="nc" id="L821">                cssAttrSet.addAttribute(CSS.Attribute.PADDING_BOTTOM, v);</span>
<span class="nc" id="L822">                cssAttrSet.addAttribute(CSS.Attribute.PADDING_LEFT, v);</span>
<span class="nc" id="L823">                cssAttrSet.addAttribute(CSS.Attribute.PADDING_RIGHT, v);</span>
            }
        }
<span class="nc bnc" id="L826" title="All 2 branches missed.">        if (elem.isLeaf()) {</span>
<span class="nc" id="L827">            translateEmbeddedAttributes(htmlAttrSet, cssAttrSet);</span>
        } else {
<span class="nc" id="L829">            translateAttributes(tag, htmlAttrSet, cssAttrSet);</span>
        }
<span class="nc bnc" id="L831" title="All 2 branches missed.">        if (tag == HTML.Tag.CAPTION) {</span>
            /*
             * Navigator uses ALIGN for caption placement and IE uses VALIGN.
             */
<span class="nc" id="L835">            Object v = htmlAttrSet.getAttribute(HTML.Attribute.ALIGN);</span>
<span class="nc bnc" id="L836" title="All 6 branches missed.">            if ((v != null) &amp;&amp; (v.equals(&quot;top&quot;) || v.equals(&quot;bottom&quot;))) {</span>
<span class="nc" id="L837">                cssAttrSet.addAttribute(CSS.Attribute.CAPTION_SIDE, v);</span>
<span class="nc" id="L838">                cssAttrSet.removeAttribute(CSS.Attribute.TEXT_ALIGN);</span>
            } else {
<span class="nc" id="L840">                v = htmlAttrSet.getAttribute(HTML.Attribute.VALIGN);</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">                if (v != null) {</span>
<span class="nc" id="L842">                    cssAttrSet.addAttribute(CSS.Attribute.CAPTION_SIDE, v);</span>
                }
            }
        }
<span class="nc" id="L846">        return cssAttrSet;</span>
    }

    private static int getTableBorder(AttributeSet tableAttr) {
<span class="nc" id="L850">        String borderValue = (String) tableAttr.getAttribute(HTML.Attribute.BORDER);</span>

<span class="nc bnc" id="L852" title="All 4 branches missed.">        if (borderValue == HTML.NULL_ATTRIBUTE_VALUE || &quot;&quot;.equals(borderValue)) {</span>
            // Some browsers accept &lt;TABLE BORDER&gt; and &lt;TABLE BORDER=&quot;&quot;&gt; with the same semantics as BORDER=1
<span class="nc" id="L854">            return 1;</span>
        }

        try {
<span class="nc" id="L858">            return Integer.parseInt(borderValue);</span>
<span class="nc" id="L859">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L860">            return 0;</span>
        }
    }

<span class="nc" id="L864">    private static final Hashtable&lt;String, Attribute&gt; attributeMap = new Hashtable&lt;String, Attribute&gt;();</span>
<span class="nc" id="L865">    private static final Hashtable&lt;String, Value&gt; valueMap = new Hashtable&lt;String, Value&gt;();</span>

    /**
     * The hashtable and the static initalization block below,
     * set up a mapping from well-known HTML attributes to
     * CSS attributes.  For the most part, there is a 1-1 mapping
     * between the two.  However in the case of certain HTML
     * attributes for example HTML.Attribute.VSPACE or
     * HTML.Attribute.HSPACE, end up mapping to two CSS.Attribute's.
     * Therefore, the value associated with each HTML.Attribute.
     * key ends up being an array of CSS.Attribute.* objects.
     */
<span class="nc" id="L877">    private static final Hashtable&lt;HTML.Attribute, CSS.Attribute[]&gt; htmlAttrToCssAttrMap = new Hashtable&lt;HTML.Attribute, CSS.Attribute[]&gt;(20);</span>

    /**
     * The hashtable and static initialization that follows sets
     * up a translation from StyleConstants (i.e. the &lt;em&gt;well known&lt;/em&gt;
     * attributes) to the associated CSS attributes.
     */
<span class="nc" id="L884">    private static final Hashtable&lt;Object, Attribute&gt; styleConstantToCssMap = new Hashtable&lt;Object, Attribute&gt;(17);</span>
    /** Maps from HTML value to a CSS value. Used in internal mapping. */
<span class="nc" id="L886">    private static final Hashtable&lt;String, CSS.Value&gt; htmlValueToCssValueMap = new Hashtable&lt;String, CSS.Value&gt;(8);</span>
    /** Maps from CSS value (string) to internal value. */
<span class="nc" id="L888">    private static final Hashtable&lt;String, CSS.Value&gt; cssValueToInternalValueMap = new Hashtable&lt;String, CSS.Value&gt;(13);</span>

    static {
        // load the attribute map
<span class="nc bnc" id="L892" title="All 2 branches missed.">        for (int i = 0; i &lt; Attribute.allAttributes.length; i++ ) {</span>
<span class="nc" id="L893">            attributeMap.put(Attribute.allAttributes[i].toString(),</span>
                             Attribute.allAttributes[i]);
        }
        // load the value map
<span class="nc bnc" id="L897" title="All 2 branches missed.">        for (int i = 0; i &lt; Value.allValues.length; i++ ) {</span>
<span class="nc" id="L898">            valueMap.put(Value.allValues[i].toString(),</span>
                             Value.allValues[i]);
        }

<span class="nc" id="L902">        htmlAttrToCssAttrMap.put(HTML.Attribute.COLOR,</span>
                                 new CSS.Attribute[]{CSS.Attribute.COLOR});
<span class="nc" id="L904">        htmlAttrToCssAttrMap.put(HTML.Attribute.TEXT,</span>
                                 new CSS.Attribute[]{CSS.Attribute.COLOR});
<span class="nc" id="L906">        htmlAttrToCssAttrMap.put(HTML.Attribute.CLEAR,</span>
                                 new CSS.Attribute[]{CSS.Attribute.CLEAR});
<span class="nc" id="L908">        htmlAttrToCssAttrMap.put(HTML.Attribute.BACKGROUND,</span>
                                 new CSS.Attribute[]{CSS.Attribute.BACKGROUND_IMAGE});
<span class="nc" id="L910">        htmlAttrToCssAttrMap.put(HTML.Attribute.BGCOLOR,</span>
                                 new CSS.Attribute[]{CSS.Attribute.BACKGROUND_COLOR});
<span class="nc" id="L912">        htmlAttrToCssAttrMap.put(HTML.Attribute.WIDTH,</span>
                                 new CSS.Attribute[]{CSS.Attribute.WIDTH});
<span class="nc" id="L914">        htmlAttrToCssAttrMap.put(HTML.Attribute.HEIGHT,</span>
                                 new CSS.Attribute[]{CSS.Attribute.HEIGHT});
<span class="nc" id="L916">        htmlAttrToCssAttrMap.put(HTML.Attribute.BORDER,</span>
                                 new CSS.Attribute[]{CSS.Attribute.BORDER_TOP_WIDTH, CSS.Attribute.BORDER_RIGHT_WIDTH, CSS.Attribute.BORDER_BOTTOM_WIDTH, CSS.Attribute.BORDER_LEFT_WIDTH});
<span class="nc" id="L918">        htmlAttrToCssAttrMap.put(HTML.Attribute.CELLPADDING,</span>
                                 new CSS.Attribute[]{CSS.Attribute.PADDING});
<span class="nc" id="L920">        htmlAttrToCssAttrMap.put(HTML.Attribute.CELLSPACING,</span>
                                 new CSS.Attribute[]{CSS.Attribute.BORDER_SPACING});
<span class="nc" id="L922">        htmlAttrToCssAttrMap.put(HTML.Attribute.MARGINWIDTH,</span>
                                 new CSS.Attribute[]{CSS.Attribute.MARGIN_LEFT,
                                                     CSS.Attribute.MARGIN_RIGHT});
<span class="nc" id="L925">        htmlAttrToCssAttrMap.put(HTML.Attribute.MARGINHEIGHT,</span>
                                 new CSS.Attribute[]{CSS.Attribute.MARGIN_TOP,
                                                     CSS.Attribute.MARGIN_BOTTOM});
<span class="nc" id="L928">        htmlAttrToCssAttrMap.put(HTML.Attribute.HSPACE,</span>
                                 new CSS.Attribute[]{CSS.Attribute.PADDING_LEFT,
                                                     CSS.Attribute.PADDING_RIGHT});
<span class="nc" id="L931">        htmlAttrToCssAttrMap.put(HTML.Attribute.VSPACE,</span>
                                 new CSS.Attribute[]{CSS.Attribute.PADDING_BOTTOM,
                                                     CSS.Attribute.PADDING_TOP});
<span class="nc" id="L934">        htmlAttrToCssAttrMap.put(HTML.Attribute.FACE,</span>
                                 new CSS.Attribute[]{CSS.Attribute.FONT_FAMILY});
<span class="nc" id="L936">        htmlAttrToCssAttrMap.put(HTML.Attribute.SIZE,</span>
                                 new CSS.Attribute[]{CSS.Attribute.FONT_SIZE});
<span class="nc" id="L938">        htmlAttrToCssAttrMap.put(HTML.Attribute.VALIGN,</span>
                                 new CSS.Attribute[]{CSS.Attribute.VERTICAL_ALIGN});
<span class="nc" id="L940">        htmlAttrToCssAttrMap.put(HTML.Attribute.ALIGN,</span>
                                 new CSS.Attribute[]{CSS.Attribute.VERTICAL_ALIGN,
                                                     CSS.Attribute.TEXT_ALIGN,
                                                     CSS.Attribute.FLOAT});
<span class="nc" id="L944">        htmlAttrToCssAttrMap.put(HTML.Attribute.TYPE,</span>
                                 new CSS.Attribute[]{CSS.Attribute.LIST_STYLE_TYPE});
<span class="nc" id="L946">        htmlAttrToCssAttrMap.put(HTML.Attribute.NOWRAP,</span>
                                 new CSS.Attribute[]{CSS.Attribute.WHITE_SPACE});

        // initialize StyleConstants mapping
<span class="nc" id="L950">        styleConstantToCssMap.put(StyleConstants.FontFamily,</span>
                                  CSS.Attribute.FONT_FAMILY);
<span class="nc" id="L952">        styleConstantToCssMap.put(StyleConstants.FontSize,</span>
                                  CSS.Attribute.FONT_SIZE);
<span class="nc" id="L954">        styleConstantToCssMap.put(StyleConstants.Bold,</span>
                                  CSS.Attribute.FONT_WEIGHT);
<span class="nc" id="L956">        styleConstantToCssMap.put(StyleConstants.Italic,</span>
                                  CSS.Attribute.FONT_STYLE);
<span class="nc" id="L958">        styleConstantToCssMap.put(StyleConstants.Underline,</span>
                                  CSS.Attribute.TEXT_DECORATION);
<span class="nc" id="L960">        styleConstantToCssMap.put(StyleConstants.StrikeThrough,</span>
                                  CSS.Attribute.TEXT_DECORATION);
<span class="nc" id="L962">        styleConstantToCssMap.put(StyleConstants.Superscript,</span>
                                  CSS.Attribute.VERTICAL_ALIGN);
<span class="nc" id="L964">        styleConstantToCssMap.put(StyleConstants.Subscript,</span>
                                  CSS.Attribute.VERTICAL_ALIGN);
<span class="nc" id="L966">        styleConstantToCssMap.put(StyleConstants.Foreground,</span>
                                  CSS.Attribute.COLOR);
<span class="nc" id="L968">        styleConstantToCssMap.put(StyleConstants.Background,</span>
                                  CSS.Attribute.BACKGROUND_COLOR);
<span class="nc" id="L970">        styleConstantToCssMap.put(StyleConstants.FirstLineIndent,</span>
                                  CSS.Attribute.TEXT_INDENT);
<span class="nc" id="L972">        styleConstantToCssMap.put(StyleConstants.LeftIndent,</span>
                                  CSS.Attribute.MARGIN_LEFT);
<span class="nc" id="L974">        styleConstantToCssMap.put(StyleConstants.RightIndent,</span>
                                  CSS.Attribute.MARGIN_RIGHT);
<span class="nc" id="L976">        styleConstantToCssMap.put(StyleConstants.SpaceAbove,</span>
                                  CSS.Attribute.MARGIN_TOP);
<span class="nc" id="L978">        styleConstantToCssMap.put(StyleConstants.SpaceBelow,</span>
                                  CSS.Attribute.MARGIN_BOTTOM);
<span class="nc" id="L980">        styleConstantToCssMap.put(StyleConstants.Alignment,</span>
                                  CSS.Attribute.TEXT_ALIGN);

        // HTML-&gt;CSS
<span class="nc" id="L984">        htmlValueToCssValueMap.put(&quot;disc&quot;, CSS.Value.DISC);</span>
<span class="nc" id="L985">        htmlValueToCssValueMap.put(&quot;square&quot;, CSS.Value.SQUARE);</span>
<span class="nc" id="L986">        htmlValueToCssValueMap.put(&quot;circle&quot;, CSS.Value.CIRCLE);</span>
<span class="nc" id="L987">        htmlValueToCssValueMap.put(&quot;1&quot;, CSS.Value.DECIMAL);</span>
<span class="nc" id="L988">        htmlValueToCssValueMap.put(&quot;a&quot;, CSS.Value.LOWER_ALPHA);</span>
<span class="nc" id="L989">        htmlValueToCssValueMap.put(&quot;A&quot;, CSS.Value.UPPER_ALPHA);</span>
<span class="nc" id="L990">        htmlValueToCssValueMap.put(&quot;i&quot;, CSS.Value.LOWER_ROMAN);</span>
<span class="nc" id="L991">        htmlValueToCssValueMap.put(&quot;I&quot;, CSS.Value.UPPER_ROMAN);</span>

        // CSS-&gt; internal CSS
<span class="nc" id="L994">        cssValueToInternalValueMap.put(&quot;none&quot;, CSS.Value.NONE);</span>
<span class="nc" id="L995">        cssValueToInternalValueMap.put(&quot;disc&quot;, CSS.Value.DISC);</span>
<span class="nc" id="L996">        cssValueToInternalValueMap.put(&quot;square&quot;, CSS.Value.SQUARE);</span>
<span class="nc" id="L997">        cssValueToInternalValueMap.put(&quot;circle&quot;, CSS.Value.CIRCLE);</span>
<span class="nc" id="L998">        cssValueToInternalValueMap.put(&quot;decimal&quot;, CSS.Value.DECIMAL);</span>
<span class="nc" id="L999">        cssValueToInternalValueMap.put(&quot;lower-roman&quot;, CSS.Value.LOWER_ROMAN);</span>
<span class="nc" id="L1000">        cssValueToInternalValueMap.put(&quot;upper-roman&quot;, CSS.Value.UPPER_ROMAN);</span>
<span class="nc" id="L1001">        cssValueToInternalValueMap.put(&quot;lower-alpha&quot;, CSS.Value.LOWER_ALPHA);</span>
<span class="nc" id="L1002">        cssValueToInternalValueMap.put(&quot;upper-alpha&quot;, CSS.Value.UPPER_ALPHA);</span>
<span class="nc" id="L1003">        cssValueToInternalValueMap.put(&quot;repeat&quot;, CSS.Value.BACKGROUND_REPEAT);</span>
<span class="nc" id="L1004">        cssValueToInternalValueMap.put(&quot;no-repeat&quot;,</span>
                                       CSS.Value.BACKGROUND_NO_REPEAT);
<span class="nc" id="L1006">        cssValueToInternalValueMap.put(&quot;repeat-x&quot;,</span>
                                       CSS.Value.BACKGROUND_REPEAT_X);
<span class="nc" id="L1008">        cssValueToInternalValueMap.put(&quot;repeat-y&quot;,</span>
                                       CSS.Value.BACKGROUND_REPEAT_Y);
<span class="nc" id="L1010">        cssValueToInternalValueMap.put(&quot;scroll&quot;,</span>
                                       CSS.Value.BACKGROUND_SCROLL);
<span class="nc" id="L1012">        cssValueToInternalValueMap.put(&quot;fixed&quot;,</span>
                                       CSS.Value.BACKGROUND_FIXED);

        // Register all the CSS attribute keys for archival/unarchival
<span class="nc" id="L1016">        Object[] keys = CSS.Attribute.allAttributes;</span>
        try {
<span class="nc bnc" id="L1018" title="All 2 branches missed.">            for (Object key : keys) {</span>
<span class="nc" id="L1019">                StyleContext.registerStaticAttributeKey(key);</span>
            }
<span class="nc" id="L1021">        } catch (Throwable e) {</span>
<span class="nc" id="L1022">            e.printStackTrace();</span>
<span class="nc" id="L1023">        }</span>

        // Register all the CSS Values for archival/unarchival
<span class="nc" id="L1026">        keys = CSS.Value.allValues;</span>
        try {
<span class="nc bnc" id="L1028" title="All 2 branches missed.">            for (Object key : keys) {</span>
<span class="nc" id="L1029">                StyleContext.registerStaticAttributeKey(key);</span>
            }
<span class="nc" id="L1031">        } catch (Throwable e) {</span>
<span class="nc" id="L1032">            e.printStackTrace();</span>
<span class="nc" id="L1033">        }</span>
    }

    /**
     * Return the set of all possible CSS attribute keys.
     */
    public static Attribute[] getAllAttributeKeys() {
<span class="nc" id="L1040">        Attribute[] keys = new Attribute[Attribute.allAttributes.length];</span>
<span class="nc" id="L1041">        System.arraycopy(Attribute.allAttributes, 0, keys, 0, Attribute.allAttributes.length);</span>
<span class="nc" id="L1042">        return keys;</span>
    }

    /**
     * Translates a string to a &lt;code&gt;CSS.Attribute&lt;/code&gt; object.
     * This will return &lt;code&gt;null&lt;/code&gt; if there is no attribute
     * by the given name.
     *
     * @param name the name of the CSS attribute to fetch the
     *  typesafe enumeration for
     * @return the &lt;code&gt;CSS.Attribute&lt;/code&gt; object,
     *  or &lt;code&gt;null&lt;/code&gt; if the string
     *  doesn't represent a valid attribute key
     */
    public static final Attribute getAttribute(String name) {
<span class="nc" id="L1057">        return attributeMap.get(name);</span>
    }

    /**
     * Translates a string to a &lt;code&gt;CSS.Value&lt;/code&gt; object.
     * This will return &lt;code&gt;null&lt;/code&gt; if there is no value
     * by the given name.
     *
     * @param name the name of the CSS value to fetch the
     *  typesafe enumeration for
     * @return the &lt;code&gt;CSS.Value&lt;/code&gt; object,
     *  or &lt;code&gt;null&lt;/code&gt; if the string
     *  doesn't represent a valid CSS value name; this does
     *  not mean that it doesn't represent a valid CSS value
     */
    static final Value getValue(String name) {
<span class="nc" id="L1073">        return valueMap.get(name);</span>
    }


    //
    // Conversion related methods/classes
    //

    /**
     * Returns a URL for the given CSS url string. If relative,
     * &lt;code&gt;base&lt;/code&gt; is used as the parent. If a valid URL can not
     * be found, this will not throw a MalformedURLException, instead
     * null will be returned.
     */
    static URL getURL(URL base, String cssString) {
<span class="nc bnc" id="L1088" title="All 2 branches missed.">        if (cssString == null) {</span>
<span class="nc" id="L1089">            return null;</span>
        }
<span class="nc bnc" id="L1091" title="All 2 branches missed.">        if (cssString.startsWith(&quot;url(&quot;) &amp;&amp;</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">            cssString.endsWith(&quot;)&quot;)) {</span>
<span class="nc" id="L1093">            cssString = cssString.substring(4, cssString.length() - 1);</span>
        }
        // Absolute first
        try {
<span class="nc" id="L1097">            URL url = new URL(cssString);</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">            if (url != null) {</span>
<span class="nc" id="L1099">                return url;</span>
            }
<span class="nc" id="L1101">        } catch (MalformedURLException mue) {</span>
<span class="nc" id="L1102">        }</span>
        // Then relative
<span class="nc bnc" id="L1104" title="All 2 branches missed.">        if (base != null) {</span>
            // Relative URL, try from base
            try {
<span class="nc" id="L1107">                URL url = new URL(base, cssString);</span>
<span class="nc" id="L1108">                return url;</span>
            }
<span class="nc" id="L1110">            catch (MalformedURLException muee) {</span>
            }
        }
<span class="nc" id="L1113">        return null;</span>
    }

    /**
     * Converts a type Color to a hex string
     * in the format &quot;#RRGGBB&quot;
     */
    static String colorToHex(Color color) {

<span class="nc" id="L1122">      String colorstr = &quot;#&quot;;</span>

      // Red
<span class="nc" id="L1125">      String str = Integer.toHexString(color.getRed());</span>
<span class="nc bnc" id="L1126" title="All 2 branches missed.">      if (str.length() &gt; 2)</span>
<span class="nc" id="L1127">        str = str.substring(0, 2);</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">      else if (str.length() &lt; 2)</span>
<span class="nc" id="L1129">        colorstr += &quot;0&quot; + str;</span>
      else
<span class="nc" id="L1131">        colorstr += str;</span>

      // Green
<span class="nc" id="L1134">      str = Integer.toHexString(color.getGreen());</span>
<span class="nc bnc" id="L1135" title="All 2 branches missed.">      if (str.length() &gt; 2)</span>
<span class="nc" id="L1136">        str = str.substring(0, 2);</span>
<span class="nc bnc" id="L1137" title="All 2 branches missed.">      else if (str.length() &lt; 2)</span>
<span class="nc" id="L1138">        colorstr += &quot;0&quot; + str;</span>
      else
<span class="nc" id="L1140">        colorstr += str;</span>

      // Blue
<span class="nc" id="L1143">      str = Integer.toHexString(color.getBlue());</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">      if (str.length() &gt; 2)</span>
<span class="nc" id="L1145">        str = str.substring(0, 2);</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">      else if (str.length() &lt; 2)</span>
<span class="nc" id="L1147">        colorstr += &quot;0&quot; + str;</span>
      else
<span class="nc" id="L1149">        colorstr += str;</span>

<span class="nc" id="L1151">      return colorstr;</span>
    }

     /**
      * Convert a &quot;#FFFFFF&quot; hex string to a Color.
      * If the color specification is bad, an attempt
      * will be made to fix it up.
      */
    static final Color hexToColor(String value) {
        String digits;
<span class="nc" id="L1161">        int n = value.length();</span>
<span class="nc bnc" id="L1162" title="All 2 branches missed.">        if (value.startsWith(&quot;#&quot;)) {</span>
<span class="nc" id="L1163">            digits = value.substring(1, Math.min(value.length(), 7));</span>
        } else {
<span class="nc" id="L1165">            digits = value;</span>
        }
<span class="nc" id="L1167">        String hstr = &quot;0x&quot; + digits;</span>
        Color c;
        try {
<span class="nc" id="L1170">            c = Color.decode(hstr);</span>
<span class="nc" id="L1171">        } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L1172">            c = null;</span>
<span class="nc" id="L1173">        }</span>
<span class="nc" id="L1174">         return c;</span>
     }

    /**
     * Convert a color string such as &quot;RED&quot; or &quot;#NNNNNN&quot; or &quot;rgb(r, g, b)&quot;
     * to a Color.
     */
    static Color stringToColor(String str) {
      Color color;

<span class="nc bnc" id="L1184" title="All 2 branches missed.">      if (str == null) {</span>
<span class="nc" id="L1185">          return null;</span>
      }
<span class="nc bnc" id="L1187" title="All 2 branches missed.">      if (str.length() == 0)</span>
<span class="nc" id="L1188">        color = Color.black;</span>
<span class="nc bnc" id="L1189" title="All 2 branches missed.">      else if (str.startsWith(&quot;rgb(&quot;)) {</span>
<span class="nc" id="L1190">          color = parseRGB(str);</span>
      }
<span class="nc bnc" id="L1192" title="All 2 branches missed.">      else if (str.charAt(0) == '#')</span>
<span class="nc" id="L1193">        color = hexToColor(str);</span>
<span class="nc bnc" id="L1194" title="All 2 branches missed.">      else if (str.equalsIgnoreCase(&quot;Black&quot;))</span>
<span class="nc" id="L1195">        color = hexToColor(&quot;#000000&quot;);</span>
<span class="nc bnc" id="L1196" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Silver&quot;))</span>
<span class="nc" id="L1197">        color = hexToColor(&quot;#C0C0C0&quot;);</span>
<span class="nc bnc" id="L1198" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Gray&quot;))</span>
<span class="nc" id="L1199">        color = hexToColor(&quot;#808080&quot;);</span>
<span class="nc bnc" id="L1200" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;White&quot;))</span>
<span class="nc" id="L1201">        color = hexToColor(&quot;#FFFFFF&quot;);</span>
<span class="nc bnc" id="L1202" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Maroon&quot;))</span>
<span class="nc" id="L1203">        color = hexToColor(&quot;#800000&quot;);</span>
<span class="nc bnc" id="L1204" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Red&quot;))</span>
<span class="nc" id="L1205">        color = hexToColor(&quot;#FF0000&quot;);</span>
<span class="nc bnc" id="L1206" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Purple&quot;))</span>
<span class="nc" id="L1207">        color = hexToColor(&quot;#800080&quot;);</span>
<span class="nc bnc" id="L1208" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Fuchsia&quot;))</span>
<span class="nc" id="L1209">        color = hexToColor(&quot;#FF00FF&quot;);</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Green&quot;))</span>
<span class="nc" id="L1211">        color = hexToColor(&quot;#008000&quot;);</span>
<span class="nc bnc" id="L1212" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Lime&quot;))</span>
<span class="nc" id="L1213">        color = hexToColor(&quot;#00FF00&quot;);</span>
<span class="nc bnc" id="L1214" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Olive&quot;))</span>
<span class="nc" id="L1215">        color = hexToColor(&quot;#808000&quot;);</span>
<span class="nc bnc" id="L1216" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Yellow&quot;))</span>
<span class="nc" id="L1217">        color = hexToColor(&quot;#FFFF00&quot;);</span>
<span class="nc bnc" id="L1218" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Navy&quot;))</span>
<span class="nc" id="L1219">        color = hexToColor(&quot;#000080&quot;);</span>
<span class="nc bnc" id="L1220" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Blue&quot;))</span>
<span class="nc" id="L1221">        color = hexToColor(&quot;#0000FF&quot;);</span>
<span class="nc bnc" id="L1222" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Teal&quot;))</span>
<span class="nc" id="L1223">        color = hexToColor(&quot;#008080&quot;);</span>
<span class="nc bnc" id="L1224" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Aqua&quot;))</span>
<span class="nc" id="L1225">        color = hexToColor(&quot;#00FFFF&quot;);</span>
<span class="nc bnc" id="L1226" title="All 2 branches missed.">      else if(str.equalsIgnoreCase(&quot;Orange&quot;))</span>
<span class="nc" id="L1227">        color = hexToColor(&quot;#FF8000&quot;);</span>
      else
<span class="nc" id="L1229">          color = hexToColor(str); // sometimes get specified without leading #</span>
<span class="nc" id="L1230">      return color;</span>
    }

    /**
     * Parses a String in the format &lt;code&gt;rgb(r, g, b)&lt;/code&gt; where
     * each of the Color components is either an integer, or a floating number
     * with a % after indicating a percentage value of 255. Values are
     * constrained to fit with 0-255. The resulting Color is returned.
     */
    private static Color parseRGB(String string) {
        // Find the next numeric char
<span class="nc" id="L1241">        int[] index = new int[1];</span>

<span class="nc" id="L1243">        index[0] = 4;</span>
<span class="nc" id="L1244">        int red = getColorComponent(string, index);</span>
<span class="nc" id="L1245">        int green = getColorComponent(string, index);</span>
<span class="nc" id="L1246">        int blue = getColorComponent(string, index);</span>

<span class="nc" id="L1248">        return new Color(red, green, blue);</span>
    }

    /**
     * Returns the next integer value from &lt;code&gt;string&lt;/code&gt; starting
     * at &lt;code&gt;index[0]&lt;/code&gt;. The value can either can an integer, or
     * a percentage (floating number ending with %), in which case it is
     * multiplied by 255.
     */
    private static int getColorComponent(String string, int[] index) {
<span class="nc" id="L1258">        int length = string.length();</span>
        char aChar;

        // Skip non-decimal chars
<span class="nc bnc" id="L1262" title="All 4 branches missed.">        while(index[0] &lt; length &amp;&amp; (aChar = string.charAt(index[0])) != '-' &amp;&amp;</span>
<span class="nc bnc" id="L1263" title="All 4 branches missed.">              !Character.isDigit(aChar) &amp;&amp; aChar != '.') {</span>
<span class="nc" id="L1264">            index[0]++;</span>
        }

<span class="nc" id="L1267">        int start = index[0];</span>

<span class="nc bnc" id="L1269" title="All 4 branches missed.">        if (start &lt; length &amp;&amp; string.charAt(index[0]) == '-') {</span>
<span class="nc" id="L1270">            index[0]++;</span>
        }
<span class="nc bnc" id="L1272" title="All 2 branches missed.">        while(index[0] &lt; length &amp;&amp;</span>
<span class="nc bnc" id="L1273" title="All 2 branches missed.">                         Character.isDigit(string.charAt(index[0]))) {</span>
<span class="nc" id="L1274">            index[0]++;</span>
        }
<span class="nc bnc" id="L1276" title="All 4 branches missed.">        if (index[0] &lt; length &amp;&amp; string.charAt(index[0]) == '.') {</span>
            // Decimal value
<span class="nc" id="L1278">            index[0]++;</span>
<span class="nc bnc" id="L1279" title="All 2 branches missed.">            while(index[0] &lt; length &amp;&amp;</span>
<span class="nc bnc" id="L1280" title="All 2 branches missed.">                  Character.isDigit(string.charAt(index[0]))) {</span>
<span class="nc" id="L1281">                index[0]++;</span>
            }
        }
<span class="nc bnc" id="L1284" title="All 2 branches missed.">        if (start != index[0]) {</span>
            try {
<span class="nc" id="L1286">                float value = Float.parseFloat(string.substring</span>
<span class="nc" id="L1287">                                               (start, index[0]));</span>

<span class="nc bnc" id="L1289" title="All 4 branches missed.">                if (index[0] &lt; length &amp;&amp; string.charAt(index[0]) == '%') {</span>
<span class="nc" id="L1290">                    index[0]++;</span>
<span class="nc" id="L1291">                    value = value * 255f / 100f;</span>
                }
<span class="nc" id="L1293">                return Math.min(255, Math.max(0, (int)value));</span>
<span class="nc" id="L1294">            } catch (NumberFormatException nfe) {</span>
                // Treat as 0
            }
        }
<span class="nc" id="L1298">        return 0;</span>
    }

    static int getIndexOfSize(float pt, int[] sizeMap) {
<span class="nc bnc" id="L1302" title="All 2 branches missed.">        for (int i = 0; i &lt; sizeMap.length; i ++ )</span>
<span class="nc bnc" id="L1303" title="All 2 branches missed.">                if (pt &lt;= sizeMap[i])</span>
<span class="nc" id="L1304">                        return i + 1;</span>
<span class="nc" id="L1305">        return sizeMap.length;</span>
    }

    static int getIndexOfSize(float pt, StyleSheet ss) {
<span class="nc bnc" id="L1309" title="All 2 branches missed.">        int[] sizeMap = (ss != null) ? ss.getSizeMap() :</span>
            StyleSheet.sizeMapDefault;
<span class="nc" id="L1311">        return getIndexOfSize(pt, sizeMap);</span>
    }


    /**
     * @return an array of all the strings in &lt;code&gt;value&lt;/code&gt;
     *         that are separated by whitespace.
     */
    static String[] parseStrings(String value) {
        int         current, last;
<span class="nc bnc" id="L1321" title="All 2 branches missed.">        int         length = (value == null) ? 0 : value.length();</span>
<span class="nc" id="L1322">        Vector&lt;String&gt; temp = new Vector&lt;String&gt;(4);</span>

<span class="nc" id="L1324">        current = 0;</span>
<span class="nc bnc" id="L1325" title="All 2 branches missed.">        while (current &lt; length) {</span>
            // Skip ws
<span class="nc bnc" id="L1327" title="All 2 branches missed.">            while (current &lt; length &amp;&amp; Character.isWhitespace</span>
<span class="nc bnc" id="L1328" title="All 2 branches missed.">                   (value.charAt(current))) {</span>
<span class="nc" id="L1329">                current++;</span>
            }
<span class="nc" id="L1331">            last = current;</span>
<span class="nc bnc" id="L1332" title="All 2 branches missed.">            while (current &lt; length &amp;&amp; !Character.isWhitespace</span>
<span class="nc bnc" id="L1333" title="All 2 branches missed.">                   (value.charAt(current))) {</span>
<span class="nc" id="L1334">                current++;</span>
            }
<span class="nc bnc" id="L1336" title="All 2 branches missed.">            if (last != current) {</span>
<span class="nc" id="L1337">                temp.addElement(value.substring(last, current));</span>
            }
<span class="nc" id="L1339">            current++;</span>
        }
<span class="nc" id="L1341">        String[] retValue = new String[temp.size()];</span>
<span class="nc" id="L1342">        temp.copyInto(retValue);</span>
<span class="nc" id="L1343">        return retValue;</span>
    }

    /**
     * Return the point size, given a size index. Legal HTML index sizes
     * are 1-7.
     */
    float getPointSize(int index, StyleSheet ss) {
<span class="nc" id="L1351">        ss = getStyleSheet(ss);</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">        int[] sizeMap = (ss != null) ? ss.getSizeMap() :</span>
            StyleSheet.sizeMapDefault;
<span class="nc" id="L1354">        --index;</span>
<span class="nc bnc" id="L1355" title="All 2 branches missed.">        if (index &lt; 0)</span>
<span class="nc" id="L1356">          return sizeMap[0];</span>
<span class="nc bnc" id="L1357" title="All 2 branches missed.">        else if (index &gt; sizeMap.length - 1)</span>
<span class="nc" id="L1358">          return sizeMap[sizeMap.length - 1];</span>
        else
<span class="nc" id="L1360">          return sizeMap[index];</span>
    }


    private void translateEmbeddedAttributes(AttributeSet htmlAttrSet,
                                             MutableAttributeSet cssAttrSet) {
<span class="nc" id="L1366">        Enumeration keys = htmlAttrSet.getAttributeNames();</span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">        if (htmlAttrSet.getAttribute(StyleConstants.NameAttribute) ==</span>
            HTML.Tag.HR) {
            // HR needs special handling due to us treating it as a leaf.
<span class="nc" id="L1370">            translateAttributes(HTML.Tag.HR, htmlAttrSet, cssAttrSet);</span>
        }
<span class="nc bnc" id="L1372" title="All 2 branches missed.">        while (keys.hasMoreElements()) {</span>
<span class="nc" id="L1373">            Object key = keys.nextElement();</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">            if (key instanceof HTML.Tag) {</span>
<span class="nc" id="L1375">                HTML.Tag tag = (HTML.Tag)key;</span>
<span class="nc" id="L1376">                Object o = htmlAttrSet.getAttribute(tag);</span>
<span class="nc bnc" id="L1377" title="All 4 branches missed.">                if (o != null &amp;&amp; o instanceof AttributeSet) {</span>
<span class="nc" id="L1378">                    translateAttributes(tag, (AttributeSet)o, cssAttrSet);</span>
                }
<span class="nc bnc" id="L1380" title="All 2 branches missed.">            } else if (key instanceof CSS.Attribute) {</span>
<span class="nc" id="L1381">                cssAttrSet.addAttribute(key, htmlAttrSet.getAttribute(key));</span>
            }
<span class="nc" id="L1383">        }</span>
<span class="nc" id="L1384">    }</span>

    private void translateAttributes(HTML.Tag tag,
                                            AttributeSet htmlAttrSet,
                                            MutableAttributeSet cssAttrSet) {
<span class="nc" id="L1389">        Enumeration names = htmlAttrSet.getAttributeNames();</span>
<span class="nc bnc" id="L1390" title="All 2 branches missed.">        while (names.hasMoreElements()) {</span>
<span class="nc" id="L1391">            Object name = names.nextElement();</span>

<span class="nc bnc" id="L1393" title="All 2 branches missed.">            if (name instanceof HTML.Attribute) {</span>
<span class="nc" id="L1394">                HTML.Attribute key = (HTML.Attribute)name;</span>

                /*
                 * HTML.Attribute.ALIGN needs special processing.
                 * It can map to to 1 of many(3) possible CSS attributes
                 * depending on the nature of the tag the attribute is
                 * part off and depending on the value of the attribute.
                 */
<span class="nc bnc" id="L1402" title="All 2 branches missed.">                if (key == HTML.Attribute.ALIGN) {</span>
<span class="nc" id="L1403">                    String htmlAttrValue = (String)htmlAttrSet.getAttribute(HTML.Attribute.ALIGN);</span>
<span class="nc bnc" id="L1404" title="All 2 branches missed.">                    if (htmlAttrValue != null) {</span>
<span class="nc" id="L1405">                        CSS.Attribute cssAttr = getCssAlignAttribute(tag, htmlAttrSet);</span>
<span class="nc bnc" id="L1406" title="All 2 branches missed.">                        if (cssAttr != null) {</span>
<span class="nc" id="L1407">                            Object o = getCssValue(cssAttr, htmlAttrValue);</span>
<span class="nc bnc" id="L1408" title="All 2 branches missed.">                            if (o != null) {</span>
<span class="nc" id="L1409">                                cssAttrSet.addAttribute(cssAttr, o);</span>
                            }
                        }
                    }
<span class="nc" id="L1413">                } else {</span>
<span class="nc bnc" id="L1414" title="All 4 branches missed.">                    if (key == HTML.Attribute.SIZE &amp;&amp; !isHTMLFontTag(tag)) {</span>
                        /*
                         * The html size attribute has a mapping in the CSS world only
                         * if it is par of a font or base font tag.
                         */
<span class="nc bnc" id="L1419" title="All 4 branches missed.">                    } else if (tag == HTML.Tag.TABLE &amp;&amp; key == HTML.Attribute.BORDER) {</span>
<span class="nc" id="L1420">                        int borderWidth = getTableBorder(htmlAttrSet);</span>

<span class="nc bnc" id="L1422" title="All 2 branches missed.">                        if (borderWidth &gt; 0) {</span>
<span class="nc" id="L1423">                            translateAttribute(HTML.Attribute.BORDER, Integer.toString(borderWidth), cssAttrSet);</span>
                        }
<span class="nc" id="L1425">                    } else {</span>
<span class="nc" id="L1426">                        translateAttribute(key, (String) htmlAttrSet.getAttribute(key), cssAttrSet);</span>
                    }
                }
<span class="nc bnc" id="L1429" title="All 2 branches missed.">            } else if (name instanceof CSS.Attribute) {</span>
<span class="nc" id="L1430">                cssAttrSet.addAttribute(name, htmlAttrSet.getAttribute(name));</span>
            }
<span class="nc" id="L1432">        }</span>
<span class="nc" id="L1433">    }</span>

    private void translateAttribute(HTML.Attribute key,
                                           String htmlAttrValue,
                                           MutableAttributeSet cssAttrSet) {
        /*
         * In the case of all remaining HTML.Attribute's they
         * map to 1 or more CCS.Attribute.
         */
<span class="nc" id="L1442">        CSS.Attribute[] cssAttrList = getCssAttribute(key);</span>

<span class="nc bnc" id="L1444" title="All 4 branches missed.">        if (cssAttrList == null || htmlAttrValue == null) {</span>
<span class="nc" id="L1445">            return;</span>
        }
<span class="nc bnc" id="L1447" title="All 2 branches missed.">        for (Attribute cssAttr : cssAttrList) {</span>
<span class="nc" id="L1448">            Object o = getCssValue(cssAttr, htmlAttrValue);</span>
<span class="nc bnc" id="L1449" title="All 2 branches missed.">            if (o != null) {</span>
<span class="nc" id="L1450">                cssAttrSet.addAttribute(cssAttr , o);</span>
            }
        }
<span class="nc" id="L1453">    }</span>

    /**
     * Given a CSS.Attribute object and its corresponding HTML.Attribute's
     * value, this method returns a CssValue object to associate with the
     * CSS attribute.
     *
     * @param the CSS.Attribute
     * @param a String containing the value associated HTML.Attribtue.
     */
    Object getCssValue(CSS.Attribute cssAttr, String htmlAttrValue) {
<span class="nc" id="L1464">        CssValue value = (CssValue)valueConvertor.get(cssAttr);</span>
<span class="nc" id="L1465">        Object o = value.parseHtmlValue(htmlAttrValue);</span>
<span class="nc" id="L1466">        return o;</span>
    }

    /**
     * Maps an HTML.Attribute object to its appropriate CSS.Attributes.
     *
     * @param HTML.Attribute
     * @return CSS.Attribute[]
     */
    private CSS.Attribute[] getCssAttribute(HTML.Attribute hAttr) {
<span class="nc" id="L1476">        return htmlAttrToCssAttrMap.get(hAttr);</span>
    }

    /**
     * Maps HTML.Attribute.ALIGN to either:
     *     CSS.Attribute.TEXT_ALIGN
     *     CSS.Attribute.FLOAT
     *     CSS.Attribute.VERTICAL_ALIGN
     * based on the tag associated with the attribute and the
     * value of the attribute.
     *
     * @param AttributeSet containing HTML attributes.
     * @return CSS.Attribute mapping for HTML.Attribute.ALIGN.
     */
    private CSS.Attribute getCssAlignAttribute(HTML.Tag tag,
                                                   AttributeSet htmlAttrSet) {
<span class="nc" id="L1492">        return CSS.Attribute.TEXT_ALIGN;</span>
/*
        String htmlAttrValue = (String)htmlAttrSet.getAttribute(HTML.Attribute.ALIGN);
        CSS.Attribute cssAttr = CSS.Attribute.TEXT_ALIGN;
        if (htmlAttrValue != null &amp;&amp; htmlAttrSet instanceof Element) {
            Element elem = (Element)htmlAttrSet;
            if (!elem.isLeaf() &amp;&amp; tag.isBlock() &amp;&amp; validTextAlignValue(htmlAttrValue)) {
                return CSS.Attribute.TEXT_ALIGN;
            } else if (isFloater(htmlAttrValue)) {
                return CSS.Attribute.FLOAT;
            } else if (elem.isLeaf()) {
                return CSS.Attribute.VERTICAL_ALIGN;
            }
        }
        return null;
        */
    }

    /**
     * Fetches the tag associated with the HTML AttributeSet.
     *
     * @param  AttributeSet containing the HTML attributes.
     * @return HTML.Tag
     */
    private HTML.Tag getHTMLTag(AttributeSet htmlAttrSet) {
<span class="nc" id="L1517">        Object o = htmlAttrSet.getAttribute(StyleConstants.NameAttribute);</span>
<span class="nc bnc" id="L1518" title="All 2 branches missed.">        if (o instanceof HTML.Tag) {</span>
<span class="nc" id="L1519">            HTML.Tag tag = (HTML.Tag) o;</span>
<span class="nc" id="L1520">            return tag;</span>
        }
<span class="nc" id="L1522">        return null;</span>
    }


    private boolean isHTMLFontTag(HTML.Tag tag) {
<span class="nc bnc" id="L1527" title="All 6 branches missed.">        return (tag != null &amp;&amp; ((tag == HTML.Tag.FONT) || (tag == HTML.Tag.BASEFONT)));</span>
    }


    private boolean isFloater(String alignValue) {
<span class="nc bnc" id="L1532" title="All 4 branches missed.">        return (alignValue.equals(&quot;left&quot;) || alignValue.equals(&quot;right&quot;));</span>
    }

    private boolean validTextAlignValue(String alignValue) {
<span class="nc bnc" id="L1536" title="All 4 branches missed.">        return (isFloater(alignValue) || alignValue.equals(&quot;center&quot;));</span>
    }

    /**
     * Base class to CSS values in the attribute sets.  This
     * is intended to act as a convertor to/from other attribute
     * formats.
     * &lt;p&gt;
     * The CSS parser uses the parseCssValue method to convert
     * a string to whatever format is appropriate a given key
     * (i.e. these convertors are stored in a map using the
     * CSS.Attribute as a key and the CssValue as the value).
     * &lt;p&gt;
     * The HTML to CSS conversion process first converts the
     * HTML.Attribute to a CSS.Attribute, and then calls
     * the parseHtmlValue method on the value of the HTML
     * attribute to produce the corresponding CSS value.
     * &lt;p&gt;
     * The StyleConstants to CSS conversion process first
     * converts the StyleConstants attribute to a
     * CSS.Attribute, and then calls the fromStyleConstants
     * method to convert the StyleConstants value to a
     * CSS value.
     * &lt;p&gt;
     * The CSS to StyleConstants conversion process first
     * converts the StyleConstants attribute to a
     * CSS.Attribute, and then calls the toStyleConstants
     * method to convert the CSS value to a StyleConstants
     * value.
     */
<span class="nc" id="L1566">    static class CssValue implements Serializable {</span>

        /**
         * Convert a CSS value string to the internal format
         * (for fast processing) used in the attribute sets.
         * The fallback storage for any value that we don't
         * have a special binary format for is a String.
         */
        Object parseCssValue(String value) {
<span class="nc" id="L1575">            return value;</span>
        }

        /**
         * Convert an HTML attribute value to a CSS attribute
         * value.  If there is no conversion, return null.
         * This is implemented to simply forward to the CSS
         * parsing by default (since some of the attribute
         * values are the same).  If the attribute value
         * isn't recognized as a CSS value it is generally
         * returned as null.
         */
        Object parseHtmlValue(String value) {
<span class="nc" id="L1588">            return parseCssValue(value);</span>
        }

        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion,
         * returns &lt;code&gt;null&lt;/code&gt;.  By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc" id="L1603">            return null;</span>
        }

        /**
         * Converts a CSS attribute value to a
         * &lt;code&gt;StyleConstants&lt;/code&gt;
         * value.  If there is no conversion, returns
         * &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param v the view containing &lt;code&gt;AttributeSet&lt;/code&gt;
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc" id="L1619">            return null;</span>
        }

        /**
         * Return the CSS format of the value
         */
        public String toString() {
<span class="nc" id="L1626">            return svalue;</span>
        }

        /**
         * The value as a string... before conversion to a
         * binary format.
         */
        String svalue;
    }

    /**
     * By default CSS attributes are represented as simple
     * strings.  They also have no conversion to/from
     * StyleConstants by default. This class represents the
     * value as a string (via the superclass), but
     * provides StyleConstants conversion support for the
     * CSS attributes that are held as strings.
     */
<span class="nc" id="L1644">    static class StringValue extends CssValue {</span>

        /**
         * Convert a CSS value string to the internal format
         * (for fast processing) used in the attribute sets.
         * This produces a StringValue, so that it can be
         * used to convert from CSS to StyleConstants values.
         */
        Object parseCssValue(String value) {
<span class="nc" id="L1653">            StringValue sv = new StringValue();</span>
<span class="nc" id="L1654">            sv.svalue = value;</span>
<span class="nc" id="L1655">            return sv;</span>
        }

        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion
         * returns &lt;code&gt;null&lt;/code&gt;.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc bnc" id="L1670" title="All 2 branches missed.">            if (key == StyleConstants.Italic) {</span>
<span class="nc bnc" id="L1671" title="All 2 branches missed.">                if (value.equals(Boolean.TRUE)) {</span>
<span class="nc" id="L1672">                    return parseCssValue(&quot;italic&quot;);</span>
                }
<span class="nc" id="L1674">                return parseCssValue(&quot;&quot;);</span>
<span class="nc bnc" id="L1675" title="All 2 branches missed.">            } else if (key == StyleConstants.Underline) {</span>
<span class="nc bnc" id="L1676" title="All 2 branches missed.">                if (value.equals(Boolean.TRUE)) {</span>
<span class="nc" id="L1677">                    return parseCssValue(&quot;underline&quot;);</span>
                }
<span class="nc" id="L1679">                return parseCssValue(&quot;&quot;);</span>
<span class="nc bnc" id="L1680" title="All 2 branches missed.">            } else if (key == StyleConstants.Alignment) {</span>
<span class="nc" id="L1681">                int align = ((Integer)value).intValue();</span>
                String ta;
<span class="nc bnc" id="L1683" title="All 5 branches missed.">                switch(align) {</span>
                case StyleConstants.ALIGN_LEFT:
<span class="nc" id="L1685">                    ta = &quot;left&quot;;</span>
<span class="nc" id="L1686">                    break;</span>
                case StyleConstants.ALIGN_RIGHT:
<span class="nc" id="L1688">                    ta = &quot;right&quot;;</span>
<span class="nc" id="L1689">                    break;</span>
                case StyleConstants.ALIGN_CENTER:
<span class="nc" id="L1691">                    ta = &quot;center&quot;;</span>
<span class="nc" id="L1692">                    break;</span>
                case StyleConstants.ALIGN_JUSTIFIED:
<span class="nc" id="L1694">                    ta = &quot;justify&quot;;</span>
<span class="nc" id="L1695">                    break;</span>
                default:
<span class="nc" id="L1697">                    ta = &quot;left&quot;;</span>
                }
<span class="nc" id="L1699">                return parseCssValue(ta);</span>
<span class="nc bnc" id="L1700" title="All 2 branches missed.">            } else if (key == StyleConstants.StrikeThrough) {</span>
<span class="nc bnc" id="L1701" title="All 2 branches missed.">                if (value.equals(Boolean.TRUE)) {</span>
<span class="nc" id="L1702">                    return parseCssValue(&quot;line-through&quot;);</span>
                }
<span class="nc" id="L1704">                return parseCssValue(&quot;&quot;);</span>
<span class="nc bnc" id="L1705" title="All 2 branches missed.">            } else if (key == StyleConstants.Superscript) {</span>
<span class="nc bnc" id="L1706" title="All 2 branches missed.">                if (value.equals(Boolean.TRUE)) {</span>
<span class="nc" id="L1707">                    return parseCssValue(&quot;super&quot;);</span>
                }
<span class="nc" id="L1709">                return parseCssValue(&quot;&quot;);</span>
<span class="nc bnc" id="L1710" title="All 2 branches missed.">            } else if (key == StyleConstants.Subscript) {</span>
<span class="nc bnc" id="L1711" title="All 2 branches missed.">                if (value.equals(Boolean.TRUE)) {</span>
<span class="nc" id="L1712">                    return parseCssValue(&quot;sub&quot;);</span>
                }
<span class="nc" id="L1714">                return parseCssValue(&quot;&quot;);</span>
            }
<span class="nc" id="L1716">            return null;</span>
        }

        /**
         * Converts a CSS attribute value to a
         * &lt;code&gt;StyleConstants&lt;/code&gt; value.
         * If there is no conversion, returns &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc bnc" id="L1730" title="All 2 branches missed.">            if (key == StyleConstants.Italic) {</span>
<span class="nc bnc" id="L1731" title="All 2 branches missed.">                if (svalue.indexOf(&quot;italic&quot;) &gt;= 0) {</span>
<span class="nc" id="L1732">                    return Boolean.TRUE;</span>
                }
<span class="nc" id="L1734">                return Boolean.FALSE;</span>
<span class="nc bnc" id="L1735" title="All 2 branches missed.">            } else if (key == StyleConstants.Underline) {</span>
<span class="nc bnc" id="L1736" title="All 2 branches missed.">                if (svalue.indexOf(&quot;underline&quot;) &gt;= 0) {</span>
<span class="nc" id="L1737">                    return Boolean.TRUE;</span>
                }
<span class="nc" id="L1739">                return Boolean.FALSE;</span>
<span class="nc bnc" id="L1740" title="All 2 branches missed.">            } else if (key == StyleConstants.Alignment) {</span>
<span class="nc bnc" id="L1741" title="All 2 branches missed.">                if (svalue.equals(&quot;right&quot;)) {</span>
<span class="nc" id="L1742">                    return new Integer(StyleConstants.ALIGN_RIGHT);</span>
<span class="nc bnc" id="L1743" title="All 2 branches missed.">                } else if (svalue.equals(&quot;center&quot;)) {</span>
<span class="nc" id="L1744">                    return new Integer(StyleConstants.ALIGN_CENTER);</span>
<span class="nc bnc" id="L1745" title="All 2 branches missed.">                } else if  (svalue.equals(&quot;justify&quot;)) {</span>
<span class="nc" id="L1746">                    return new Integer(StyleConstants.ALIGN_JUSTIFIED);</span>
                }
<span class="nc" id="L1748">                return new Integer(StyleConstants.ALIGN_LEFT);</span>
<span class="nc bnc" id="L1749" title="All 2 branches missed.">            } else if (key == StyleConstants.StrikeThrough) {</span>
<span class="nc bnc" id="L1750" title="All 2 branches missed.">                if (svalue.indexOf(&quot;line-through&quot;) &gt;= 0) {</span>
<span class="nc" id="L1751">                    return Boolean.TRUE;</span>
                }
<span class="nc" id="L1753">                return Boolean.FALSE;</span>
<span class="nc bnc" id="L1754" title="All 2 branches missed.">            } else if (key == StyleConstants.Superscript) {</span>
<span class="nc bnc" id="L1755" title="All 2 branches missed.">                if (svalue.indexOf(&quot;super&quot;) &gt;= 0) {</span>
<span class="nc" id="L1756">                    return Boolean.TRUE;</span>
                }
<span class="nc" id="L1758">                return Boolean.FALSE;</span>
<span class="nc bnc" id="L1759" title="All 2 branches missed.">            } else if (key == StyleConstants.Subscript) {</span>
<span class="nc bnc" id="L1760" title="All 2 branches missed.">                if (svalue.indexOf(&quot;sub&quot;) &gt;= 0) {</span>
<span class="nc" id="L1761">                    return Boolean.TRUE;</span>
                }
<span class="nc" id="L1763">                return Boolean.FALSE;</span>
            }
<span class="nc" id="L1765">            return null;</span>
        }

        // Used by ViewAttributeSet
        boolean isItalic() {
<span class="nc bnc" id="L1770" title="All 2 branches missed.">            return (svalue.indexOf(&quot;italic&quot;) != -1);</span>
        }

        boolean isStrike() {
<span class="nc bnc" id="L1774" title="All 2 branches missed.">            return (svalue.indexOf(&quot;line-through&quot;) != -1);</span>
        }

        boolean isUnderline() {
<span class="nc bnc" id="L1778" title="All 2 branches missed.">            return (svalue.indexOf(&quot;underline&quot;) != -1);</span>
        }

        boolean isSub() {
<span class="nc bnc" id="L1782" title="All 2 branches missed.">            return (svalue.indexOf(&quot;sub&quot;) != -1);</span>
        }

        boolean isSup() {
<span class="nc bnc" id="L1786" title="All 2 branches missed.">            return (svalue.indexOf(&quot;sup&quot;) != -1);</span>
        }
    }

    /**
     * Represents a value for the CSS.FONT_SIZE attribute.
     * The binary format of the value can be one of several
     * types.  If the type is Float,
     * the value is specified in terms of point or
     * percentage, depending upon the ending of the
     * associated string.
     * If the type is Integer, the value is specified
     * in terms of a size index.
     */
<span class="nc" id="L1800">    class FontSize extends CssValue {</span>

        /**
         * Returns the size in points.  This is ultimately
         * what we need for the purpose of creating/fetching
         * a Font object.
         *
         * @param a the attribute set the value is being
         *  requested from.  We may need to walk up the
         *  resolve hierarchy if it's relative.
         */
        int getValue(AttributeSet a, StyleSheet ss) {
<span class="nc" id="L1812">            ss = getStyleSheet(ss);</span>
<span class="nc bnc" id="L1813" title="All 2 branches missed.">            if (index) {</span>
                // it's an index, translate from size table
<span class="nc" id="L1815">                return Math.round(getPointSize((int) value, ss));</span>
            }
<span class="nc bnc" id="L1817" title="All 2 branches missed.">            else if (lu == null) {</span>
<span class="nc" id="L1818">                return Math.round(value);</span>
            }
            else {
<span class="nc bnc" id="L1821" title="All 2 branches missed.">                if (lu.type == 0) {</span>
<span class="nc bnc" id="L1822" title="All 2 branches missed.">                    boolean isW3CLengthUnits = (ss == null) ? false : ss.isW3CLengthUnits();</span>
<span class="nc" id="L1823">                    return Math.round(lu.getValue(isW3CLengthUnits));</span>
                }
<span class="nc bnc" id="L1825" title="All 2 branches missed.">                if (a != null) {</span>
<span class="nc" id="L1826">                    AttributeSet resolveParent = a.getResolveParent();</span>

<span class="nc bnc" id="L1828" title="All 2 branches missed.">                    if (resolveParent != null) {</span>
<span class="nc" id="L1829">                        int pValue = StyleConstants.getFontSize(resolveParent);</span>

                        float retValue;
<span class="nc bnc" id="L1832" title="All 4 branches missed.">                        if (lu.type == 1 || lu.type == 3) {</span>
<span class="nc" id="L1833">                            retValue = lu.value * (float)pValue;</span>
                        }
                        else {
<span class="nc" id="L1836">                            retValue = lu.value + (float)pValue;</span>
                        }
<span class="nc" id="L1838">                        return Math.round(retValue);</span>
                    }
                }
                // a is null, or no resolve parent.
<span class="nc" id="L1842">                return 12;</span>
            }
        }

        Object parseCssValue(String value) {
<span class="nc" id="L1847">            FontSize fs = new FontSize();</span>
<span class="nc" id="L1848">            fs.svalue = value;</span>
            try {
<span class="nc bnc" id="L1850" title="All 2 branches missed.">                if (value.equals(&quot;xx-small&quot;)) {</span>
<span class="nc" id="L1851">                    fs.value = 1;</span>
<span class="nc" id="L1852">                    fs.index = true;</span>
<span class="nc bnc" id="L1853" title="All 2 branches missed.">                } else if (value.equals(&quot;x-small&quot;)) {</span>
<span class="nc" id="L1854">                    fs.value = 2;</span>
<span class="nc" id="L1855">                    fs.index = true;</span>
<span class="nc bnc" id="L1856" title="All 2 branches missed.">                } else if (value.equals(&quot;small&quot;)) {</span>
<span class="nc" id="L1857">                    fs.value = 3;</span>
<span class="nc" id="L1858">                    fs.index = true;</span>
<span class="nc bnc" id="L1859" title="All 2 branches missed.">                } else if (value.equals(&quot;medium&quot;)) {</span>
<span class="nc" id="L1860">                    fs.value = 4;</span>
<span class="nc" id="L1861">                    fs.index = true;</span>
<span class="nc bnc" id="L1862" title="All 2 branches missed.">                } else if (value.equals(&quot;large&quot;)) {</span>
<span class="nc" id="L1863">                    fs.value = 5;</span>
<span class="nc" id="L1864">                    fs.index = true;</span>
<span class="nc bnc" id="L1865" title="All 2 branches missed.">                } else if (value.equals(&quot;x-large&quot;)) {</span>
<span class="nc" id="L1866">                    fs.value = 6;</span>
<span class="nc" id="L1867">                    fs.index = true;</span>
<span class="nc bnc" id="L1868" title="All 2 branches missed.">                } else if (value.equals(&quot;xx-large&quot;)) {</span>
<span class="nc" id="L1869">                    fs.value = 7;</span>
<span class="nc" id="L1870">                    fs.index = true;</span>
                } else {
<span class="nc" id="L1872">                    fs.lu = new LengthUnit(value, (short)1, 1f);</span>
                }
                // relative sizes, larger | smaller (adjust from parent by
                // 1.5 pixels)
                // em, ex refer to parent sizes
                // lengths: pt, mm, cm, pc, in, px
                //          em (font height 3em would be 3 times font height)
                //          ex (height of X)
                // lengths are (+/-) followed by a number and two letter
                // unit identifier
<span class="nc" id="L1882">            } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L1883">                fs = null;</span>
<span class="nc" id="L1884">            }</span>
<span class="nc" id="L1885">            return fs;</span>
        }

        Object parseHtmlValue(String value) {
<span class="nc bnc" id="L1889" title="All 4 branches missed.">            if ((value == null) || (value.length() == 0)) {</span>
<span class="nc" id="L1890">                return null;</span>
            }
<span class="nc" id="L1892">            FontSize fs = new FontSize();</span>
<span class="nc" id="L1893">            fs.svalue = value;</span>

            try {
                /*
                 * relative sizes in the size attribute are relative
                 * to the &lt;basefont&gt;'s size.
                 */
<span class="nc" id="L1900">                int baseFontSize = getBaseFontSize();</span>
<span class="nc bnc" id="L1901" title="All 2 branches missed.">                if (value.charAt(0) == '+') {</span>
<span class="nc" id="L1902">                    int relSize = Integer.valueOf(value.substring(1)).intValue();</span>
<span class="nc" id="L1903">                    fs.value = baseFontSize + relSize;</span>
<span class="nc" id="L1904">                    fs.index = true;</span>
<span class="nc bnc" id="L1905" title="All 2 branches missed.">                } else if (value.charAt(0) == '-') {</span>
<span class="nc" id="L1906">                    int relSize = -Integer.valueOf(value.substring(1)).intValue();</span>
<span class="nc" id="L1907">                    fs.value = baseFontSize + relSize;</span>
<span class="nc" id="L1908">                    fs.index = true;</span>
<span class="nc" id="L1909">                } else {</span>
<span class="nc" id="L1910">                    fs.value = Integer.parseInt(value);</span>
<span class="nc bnc" id="L1911" title="All 2 branches missed.">                    if (fs.value &gt; 7) {</span>
<span class="nc" id="L1912">                        fs.value = 7;</span>
<span class="nc bnc" id="L1913" title="All 2 branches missed.">                    } else if (fs.value &lt; 0) {</span>
<span class="nc" id="L1914">                        fs.value = 0;</span>
                    }
<span class="nc" id="L1916">                    fs.index = true;</span>
                }

<span class="nc" id="L1919">            } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L1920">                fs = null;</span>
<span class="nc" id="L1921">            }</span>
<span class="nc" id="L1922">            return fs;</span>
        }

        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion
         * returns &lt;code&gt;null&lt;/code&gt;.  By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc bnc" id="L1937" title="All 2 branches missed.">            if (value instanceof Number) {</span>
<span class="nc" id="L1938">                FontSize fs = new FontSize();</span>

<span class="nc" id="L1940">                fs.value = getIndexOfSize(((Number)value).floatValue(), StyleSheet.sizeMapDefault);</span>
<span class="nc" id="L1941">                fs.svalue = Integer.toString((int)fs.value);</span>
<span class="nc" id="L1942">                fs.index = true;</span>
<span class="nc" id="L1943">                return fs;</span>
            }
<span class="nc" id="L1945">            return parseCssValue(value.toString());</span>
        }

        /**
         * Converts a CSS attribute value to a &lt;code&gt;StyleConstants&lt;/code&gt;
         * value.  If there is no conversion, returns &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc bnc" id="L1958" title="All 2 branches missed.">            if (v != null) {</span>
<span class="nc" id="L1959">                return Integer.valueOf(getValue(v.getAttributes(), null));</span>
            }
<span class="nc" id="L1961">            return Integer.valueOf(getValue(null, null));</span>
        }

        float value;
        boolean index;
        LengthUnit lu;
    }

<span class="nc" id="L1969">    static class FontFamily extends CssValue {</span>

        /**
         * Returns the font family to use.
         */
        String getValue() {
<span class="nc" id="L1975">            return family;</span>
        }

        Object parseCssValue(String value) {
<span class="nc" id="L1979">            int cIndex = value.indexOf(',');</span>
<span class="nc" id="L1980">            FontFamily ff = new FontFamily();</span>
<span class="nc" id="L1981">            ff.svalue = value;</span>
<span class="nc" id="L1982">            ff.family = null;</span>

<span class="nc bnc" id="L1984" title="All 2 branches missed.">            if (cIndex == -1) {</span>
<span class="nc" id="L1985">                setFontName(ff, value);</span>
            }
            else {
<span class="nc" id="L1988">                boolean done = false;</span>
                int lastIndex;
<span class="nc" id="L1990">                int length = value.length();</span>
<span class="nc" id="L1991">                cIndex = 0;</span>
<span class="nc bnc" id="L1992" title="All 2 branches missed.">                while (!done) {</span>
                    // skip ws.
<span class="nc bnc" id="L1994" title="All 2 branches missed.">                    while (cIndex &lt; length &amp;&amp;</span>
<span class="nc bnc" id="L1995" title="All 2 branches missed.">                           Character.isWhitespace(value.charAt(cIndex)))</span>
<span class="nc" id="L1996">                        cIndex++;</span>
                    // Find next ','
<span class="nc" id="L1998">                    lastIndex = cIndex;</span>
<span class="nc" id="L1999">                    cIndex = value.indexOf(',', cIndex);</span>
<span class="nc bnc" id="L2000" title="All 2 branches missed.">                    if (cIndex == -1) {</span>
<span class="nc" id="L2001">                        cIndex = length;</span>
                    }
<span class="nc bnc" id="L2003" title="All 2 branches missed.">                    if (lastIndex &lt; length) {</span>
<span class="nc bnc" id="L2004" title="All 2 branches missed.">                        if (lastIndex != cIndex) {</span>
<span class="nc" id="L2005">                            int lastCharIndex = cIndex;</span>
<span class="nc bnc" id="L2006" title="All 4 branches missed.">                            if (cIndex &gt; 0 &amp;&amp; value.charAt(cIndex - 1) == ' '){</span>
<span class="nc" id="L2007">                                lastCharIndex--;</span>
                            }
<span class="nc" id="L2009">                            setFontName(ff, value.substring</span>
<span class="nc" id="L2010">                                        (lastIndex, lastCharIndex));</span>
<span class="nc bnc" id="L2011" title="All 2 branches missed.">                            done = (ff.family != null);</span>
                        }
<span class="nc" id="L2013">                        cIndex++;</span>
                    }
                    else {
<span class="nc" id="L2016">                        done = true;</span>
                    }
                }
            }
<span class="nc bnc" id="L2020" title="All 2 branches missed.">            if (ff.family == null) {</span>
<span class="nc" id="L2021">                ff.family = Font.SANS_SERIF;</span>
            }
<span class="nc" id="L2023">            return ff;</span>
        }

        private void setFontName(FontFamily ff, String fontName) {
<span class="nc" id="L2027">            ff.family = fontName;</span>
<span class="nc" id="L2028">        }</span>

        Object parseHtmlValue(String value) {
            // TBD
<span class="nc" id="L2032">            return parseCssValue(value);</span>
        }

        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion
         * returns &lt;code&gt;null&lt;/code&gt;.  By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc" id="L2047">            return parseCssValue(value.toString());</span>
        }

        /**
         * Converts a CSS attribute value to a &lt;code&gt;StyleConstants&lt;/code&gt;
         * value.  If there is no conversion, returns &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc" id="L2060">            return family;</span>
        }

        String family;
    }

<span class="nc" id="L2066">    static class FontWeight extends CssValue {</span>

        int getValue() {
<span class="nc" id="L2069">            return weight;</span>
        }

        Object parseCssValue(String value) {
<span class="nc" id="L2073">            FontWeight fw = new FontWeight();</span>
<span class="nc" id="L2074">            fw.svalue = value;</span>
<span class="nc bnc" id="L2075" title="All 2 branches missed.">            if (value.equals(&quot;bold&quot;)) {</span>
<span class="nc" id="L2076">                fw.weight = 700;</span>
<span class="nc bnc" id="L2077" title="All 2 branches missed.">            } else if (value.equals(&quot;normal&quot;)) {</span>
<span class="nc" id="L2078">                fw.weight = 400;</span>
            } else {
                // PENDING(prinz) add support for relative values
                try {
<span class="nc" id="L2082">                    fw.weight = Integer.parseInt(value);</span>
<span class="nc" id="L2083">                } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L2084">                    fw = null;</span>
<span class="nc" id="L2085">                }</span>
            }
<span class="nc" id="L2087">            return fw;</span>
        }

        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion
         * returns &lt;code&gt;null&lt;/code&gt;.  By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc bnc" id="L2102" title="All 2 branches missed.">            if (value.equals(Boolean.TRUE)) {</span>
<span class="nc" id="L2103">                return parseCssValue(&quot;bold&quot;);</span>
            }
<span class="nc" id="L2105">            return parseCssValue(&quot;normal&quot;);</span>
        }

        /**
         * Converts a CSS attribute value to a &lt;code&gt;StyleConstants&lt;/code&gt;
         * value.  If there is no conversion, returns &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc bnc" id="L2118" title="All 2 branches missed.">            return (weight &gt; 500) ? Boolean.TRUE : Boolean.FALSE;</span>
        }

        boolean isBold() {
<span class="nc bnc" id="L2122" title="All 2 branches missed.">            return (weight &gt; 500);</span>
        }

        int weight;
    }

<span class="nc" id="L2128">    static class ColorValue extends CssValue {</span>

        /**
         * Returns the color to use.
         */
        Color getValue() {
<span class="nc" id="L2134">            return c;</span>
        }

        Object parseCssValue(String value) {

<span class="nc" id="L2139">            Color c = stringToColor(value);</span>
<span class="nc bnc" id="L2140" title="All 2 branches missed.">            if (c != null) {</span>
<span class="nc" id="L2141">                ColorValue cv = new ColorValue();</span>
<span class="nc" id="L2142">                cv.svalue = value;</span>
<span class="nc" id="L2143">                cv.c = c;</span>
<span class="nc" id="L2144">                return cv;</span>
            }
<span class="nc" id="L2146">            return null;</span>
        }

        Object parseHtmlValue(String value) {
<span class="nc" id="L2150">            return parseCssValue(value);</span>
        }

        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion
         * returns &lt;code&gt;null&lt;/code&gt;.  By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc" id="L2165">            ColorValue colorValue = new ColorValue();</span>
<span class="nc" id="L2166">            colorValue.c = (Color)value;</span>
<span class="nc" id="L2167">            colorValue.svalue = colorToHex(colorValue.c);</span>
<span class="nc" id="L2168">            return colorValue;</span>
        }

        /**
         * Converts a CSS attribute value to a &lt;code&gt;StyleConstants&lt;/code&gt;
         * value.  If there is no conversion, returns &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc" id="L2181">            return c;</span>
        }

        Color c;
    }

<span class="nc" id="L2187">    static class BorderStyle extends CssValue {</span>

        CSS.Value getValue() {
<span class="nc" id="L2190">            return style;</span>
        }

        Object parseCssValue(String value) {
<span class="nc" id="L2194">            CSS.Value cssv = CSS.getValue(value);</span>
<span class="nc bnc" id="L2195" title="All 2 branches missed.">            if (cssv != null) {</span>
<span class="nc bnc" id="L2196" title="All 18 branches missed.">                if ((cssv == CSS.Value.INSET) ||</span>
                    (cssv == CSS.Value.OUTSET) ||
                    (cssv == CSS.Value.NONE) ||
                    (cssv == CSS.Value.DOTTED) ||
                    (cssv == CSS.Value.DASHED) ||
                    (cssv == CSS.Value.SOLID) ||
                    (cssv == CSS.Value.DOUBLE) ||
                    (cssv == CSS.Value.GROOVE) ||
                    (cssv == CSS.Value.RIDGE)) {

<span class="nc" id="L2206">                    BorderStyle bs = new BorderStyle();</span>
<span class="nc" id="L2207">                    bs.svalue = value;</span>
<span class="nc" id="L2208">                    bs.style = cssv;</span>
<span class="nc" id="L2209">                    return bs;</span>
                }
            }
<span class="nc" id="L2212">            return null;</span>
        }

        private void writeObject(java.io.ObjectOutputStream s)
                     throws IOException {
<span class="nc" id="L2217">            s.defaultWriteObject();</span>
<span class="nc bnc" id="L2218" title="All 2 branches missed.">            if (style == null) {</span>
<span class="nc" id="L2219">                s.writeObject(null);</span>
            }
            else {
<span class="nc" id="L2222">                s.writeObject(style.toString());</span>
            }
<span class="nc" id="L2224">        }</span>

        private void readObject(ObjectInputStream s)
                throws ClassNotFoundException, IOException {
<span class="nc" id="L2228">            s.defaultReadObject();</span>
<span class="nc" id="L2229">            Object value = s.readObject();</span>
<span class="nc bnc" id="L2230" title="All 2 branches missed.">            if (value != null) {</span>
<span class="nc" id="L2231">                style = CSS.getValue((String)value);</span>
            }
<span class="nc" id="L2233">        }</span>

        // CSS.Values are static, don't archive it.
        transient private CSS.Value style;
    }

    static class LengthValue extends CssValue {

        /**
         * if this length value may be negative.
         */
        boolean mayBeNegative;

        LengthValue() {
<span class="nc" id="L2247">            this(false);</span>
<span class="nc" id="L2248">        }</span>

<span class="nc" id="L2250">        LengthValue(boolean mayBeNegative) {</span>
<span class="nc" id="L2251">            this.mayBeNegative = mayBeNegative;</span>
<span class="nc" id="L2252">        }</span>

        /**
         * Returns the length (span) to use.
         */
        float getValue() {
<span class="nc" id="L2258">            return getValue(false);</span>
        }

        float getValue(boolean isW3CLengthUnits) {
<span class="nc" id="L2262">            return getValue(0, isW3CLengthUnits);</span>
        }

        /**
         * Returns the length (span) to use. If the value represents
         * a percentage, it is scaled based on &lt;code&gt;currentValue&lt;/code&gt;.
         */
        float getValue(float currentValue) {
<span class="nc" id="L2270">            return getValue(currentValue, false);</span>
        }
        float getValue(float currentValue, boolean isW3CLengthUnits) {
<span class="nc bnc" id="L2273" title="All 2 branches missed.">            if (percentage) {</span>
<span class="nc" id="L2274">                return span * currentValue;</span>
            }
<span class="nc" id="L2276">            return LengthUnit.getValue(span, units, isW3CLengthUnits);</span>
        }

        /**
         * Returns true if the length represents a percentage of the
         * containing box.
         */
        boolean isPercentage() {
<span class="nc" id="L2284">            return percentage;</span>
        }

        Object parseCssValue(String value) {
            LengthValue lv;
            try {
                // Assume pixels
<span class="nc" id="L2291">                float absolute = Float.valueOf(value).floatValue();</span>
<span class="nc" id="L2292">                lv = new LengthValue();</span>
<span class="nc" id="L2293">                lv.span = absolute;</span>
<span class="nc" id="L2294">            } catch (NumberFormatException nfe) {</span>
                // Not pixels, use LengthUnit
<span class="nc" id="L2296">                LengthUnit lu = new LengthUnit(value,</span>
                                               LengthUnit.UNINITALIZED_LENGTH,
                                               0);

                // PENDING: currently, we only support absolute values and
                // percentages.
<span class="nc bnc" id="L2302" title="All 3 branches missed.">                switch (lu.type) {</span>
                case 0:
                    // Absolute
<span class="nc" id="L2305">                    lv = new LengthValue();</span>
<span class="nc bnc" id="L2306" title="All 2 branches missed.">                    lv.span =</span>
<span class="nc" id="L2307">                        (mayBeNegative) ? lu.value : Math.max(0, lu.value);</span>
<span class="nc" id="L2308">                    lv.units = lu.units;</span>
<span class="nc" id="L2309">                    break;</span>
                case 1:
                    // %
<span class="nc" id="L2312">                    lv = new LengthValue();</span>
<span class="nc" id="L2313">                    lv.span = Math.max(0, Math.min(1, lu.value));</span>
<span class="nc" id="L2314">                    lv.percentage = true;</span>
<span class="nc" id="L2315">                    break;</span>
                default:
<span class="nc" id="L2317">                    return null;</span>
                }
<span class="nc" id="L2319">            }</span>
<span class="nc" id="L2320">            lv.svalue = value;</span>
<span class="nc" id="L2321">            return lv;</span>
        }

        Object parseHtmlValue(String value) {
<span class="nc bnc" id="L2325" title="All 2 branches missed.">            if (value.equals(HTML.NULL_ATTRIBUTE_VALUE)) {</span>
<span class="nc" id="L2326">                value = &quot;1&quot;;</span>
            }
<span class="nc" id="L2328">            return parseCssValue(value);</span>
        }
        /**
         * Converts a &lt;code&gt;StyleConstants&lt;/code&gt; attribute value to
         * a CSS attribute value.  If there is no conversion,
         * returns &lt;code&gt;null&lt;/code&gt;.  By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @param value the value of a &lt;code&gt;StyleConstants&lt;/code&gt;
         *   attribute to be converted
         * @return the CSS value that represents the
         *   &lt;code&gt;StyleConstants&lt;/code&gt; value
         */
        Object fromStyleConstants(StyleConstants key, Object value) {
<span class="nc" id="L2342">            LengthValue v = new LengthValue();</span>
<span class="nc" id="L2343">            v.svalue = value.toString();</span>
<span class="nc" id="L2344">            v.span = ((Float)value).floatValue();</span>
<span class="nc" id="L2345">            return v;</span>
        }

        /**
         * Converts a CSS attribute value to a &lt;code&gt;StyleConstants&lt;/code&gt;
         * value.  If there is no conversion, returns &lt;code&gt;null&lt;/code&gt;.
         * By default, there is no conversion.
         *
         * @param key the &lt;code&gt;StyleConstants&lt;/code&gt; attribute
         * @return the &lt;code&gt;StyleConstants&lt;/code&gt; attribute value that
         *   represents the CSS attribute value
         */
        Object toStyleConstants(StyleConstants key, View v) {
<span class="nc" id="L2358">            return new Float(getValue(false));</span>
        }

        /** If true, span is a percentage value, and that to determine
         * the length another value needs to be passed in. */
        boolean percentage;
        /** Either the absolute value (percentage == false) or
         * a percentage value. */
        float span;

<span class="nc" id="L2368">        String units = null;</span>
    }


    /**
     * BorderWidthValue is used to model BORDER_XXX_WIDTH and adds support
     * for the thin/medium/thick values.
     */
    static class BorderWidthValue extends LengthValue {
<span class="nc" id="L2377">        BorderWidthValue(String svalue, int index) {</span>
<span class="nc" id="L2378">            this.svalue = svalue;</span>
<span class="nc" id="L2379">            span = values[index];</span>
<span class="nc" id="L2380">            percentage = false;</span>
<span class="nc" id="L2381">        }</span>

        Object parseCssValue(String value) {
<span class="nc bnc" id="L2384" title="All 2 branches missed.">            if (value != null) {</span>
<span class="nc bnc" id="L2385" title="All 2 branches missed.">                if (value.equals(&quot;thick&quot;)) {</span>
<span class="nc" id="L2386">                    return new BorderWidthValue(value, 2);</span>
                }
<span class="nc bnc" id="L2388" title="All 2 branches missed.">                else if (value.equals(&quot;medium&quot;)) {</span>
<span class="nc" id="L2389">                    return new BorderWidthValue(value, 1);</span>
                }
<span class="nc bnc" id="L2391" title="All 2 branches missed.">                else if (value.equals(&quot;thin&quot;)) {</span>
<span class="nc" id="L2392">                    return new BorderWidthValue(value, 0);</span>
                }
            }
            // Assume its a length.
<span class="nc" id="L2396">            return super.parseCssValue(value);</span>
        }

        Object parseHtmlValue(String value) {
<span class="nc bnc" id="L2400" title="All 2 branches missed.">            if (value == HTML.NULL_ATTRIBUTE_VALUE) {</span>
<span class="nc" id="L2401">                return parseCssValue(&quot;medium&quot;);</span>
            }
<span class="nc" id="L2403">            return parseCssValue(value);</span>
        }

        /** Values used to represent border width. */
<span class="nc" id="L2407">        private static final float[] values = { 1, 2, 4 };</span>
   }


    /**
     * Handles uniquing of CSS values, like lists, and background image
     * repeating.
     */
<span class="nc" id="L2415">    static class CssValueMapper extends CssValue {</span>
        Object parseCssValue(String value) {
<span class="nc" id="L2417">            Object retValue = cssValueToInternalValueMap.get(value);</span>
<span class="nc bnc" id="L2418" title="All 2 branches missed.">            if (retValue == null) {</span>
<span class="nc" id="L2419">                retValue = cssValueToInternalValueMap.get(value.toLowerCase());</span>
            }
<span class="nc" id="L2421">            return retValue;</span>
        }


        Object parseHtmlValue(String value) {
<span class="nc" id="L2426">            Object retValue = htmlValueToCssValueMap.get(value);</span>
<span class="nc bnc" id="L2427" title="All 2 branches missed.">            if (retValue == null) {</span>
<span class="nc" id="L2428">                retValue = htmlValueToCssValueMap.get(value.toLowerCase());</span>
            }
<span class="nc" id="L2430">            return retValue;</span>
        }
    }


    /**
     * Used for background images, to represent the position.
     */
<span class="nc" id="L2438">    static class BackgroundPosition extends CssValue {</span>
        float horizontalPosition;
        float verticalPosition;
        // bitmask: bit 0, horizontal relative, bit 1 horizontal relative to
        // font size, 2 vertical relative to size, 3 vertical relative to
        // font size.
        //
        short relative;

        Object parseCssValue(String value) {
            // 'top left' and 'left top' both mean the same as '0% 0%'.
            // 'top', 'top center' and 'center top' mean the same as '50% 0%'.
            // 'right top' and 'top right' mean the same as '100% 0%'.
            // 'left', 'left center' and 'center left' mean the same as
            //        '0% 50%'.
            // 'center' and 'center center' mean the same as '50% 50%'.
            // 'right', 'right center' and 'center right' mean the same as
            //        '100% 50%'.
            // 'bottom left' and 'left bottom' mean the same as '0% 100%'.
            // 'bottom', 'bottom center' and 'center bottom' mean the same as
            //        '50% 100%'.
            // 'bottom right' and 'right bottom' mean the same as '100% 100%'.
<span class="nc" id="L2460">            String[]  strings = CSS.parseStrings(value);</span>
<span class="nc" id="L2461">            int count = strings.length;</span>
<span class="nc" id="L2462">            BackgroundPosition bp = new BackgroundPosition();</span>
<span class="nc" id="L2463">            bp.relative = 5;</span>
<span class="nc" id="L2464">            bp.svalue = value;</span>

<span class="nc bnc" id="L2466" title="All 2 branches missed.">            if (count &gt; 0) {</span>
                // bit 0 for vert, 1 hor, 2 for center
<span class="nc" id="L2468">                short found = 0;</span>
<span class="nc" id="L2469">                int index = 0;</span>
<span class="nc bnc" id="L2470" title="All 2 branches missed.">                while (index &lt; count) {</span>
                    // First, check for keywords
<span class="nc" id="L2472">                    String string = strings[index++];</span>
<span class="nc bnc" id="L2473" title="All 2 branches missed.">                    if (string.equals(&quot;center&quot;)) {</span>
<span class="nc" id="L2474">                        found |= 4;</span>
<span class="nc" id="L2475">                        continue;</span>
                    }
                    else {
<span class="nc bnc" id="L2478" title="All 2 branches missed.">                        if ((found &amp; 1) == 0) {</span>
<span class="nc bnc" id="L2479" title="All 2 branches missed.">                            if (string.equals(&quot;top&quot;)) {</span>
<span class="nc" id="L2480">                                found |= 1;</span>
                            }
<span class="nc bnc" id="L2482" title="All 2 branches missed.">                            else if (string.equals(&quot;bottom&quot;)) {</span>
<span class="nc" id="L2483">                                found |= 1;</span>
<span class="nc" id="L2484">                                bp.verticalPosition = 1;</span>
<span class="nc" id="L2485">                                continue;</span>
                            }
                        }
<span class="nc bnc" id="L2488" title="All 2 branches missed.">                        if ((found &amp; 2) == 0) {</span>
<span class="nc bnc" id="L2489" title="All 2 branches missed.">                            if (string.equals(&quot;left&quot;)) {</span>
<span class="nc" id="L2490">                                found |= 2;</span>
<span class="nc" id="L2491">                                bp.horizontalPosition = 0;</span>
                            }
<span class="nc bnc" id="L2493" title="All 2 branches missed.">                            else if (string.equals(&quot;right&quot;)) {</span>
<span class="nc" id="L2494">                                found |= 2;</span>
<span class="nc" id="L2495">                                bp.horizontalPosition = 1;</span>
                            }
                        }
                    }
<span class="nc" id="L2499">                }</span>
<span class="nc bnc" id="L2500" title="All 2 branches missed.">                if (found != 0) {</span>
<span class="nc bnc" id="L2501" title="All 2 branches missed.">                    if ((found &amp; 1) == 1) {</span>
<span class="nc bnc" id="L2502" title="All 2 branches missed.">                        if ((found &amp; 2) == 0) {</span>
                            // vert and no horiz.
<span class="nc" id="L2504">                            bp.horizontalPosition = .5f;</span>
                        }
                    }
<span class="nc bnc" id="L2507" title="All 2 branches missed.">                    else if ((found &amp; 2) == 2) {</span>
                        // horiz and no vert.
<span class="nc" id="L2509">                        bp.verticalPosition = .5f;</span>
                    }
                    else {
                        // no horiz, no vert, but center
<span class="nc" id="L2513">                        bp.horizontalPosition = bp.verticalPosition = .5f;</span>
                    }
                }
                else {
                    // Assume lengths
<span class="nc" id="L2518">                    LengthUnit lu = new LengthUnit(strings[0], (short)0, 0f);</span>

<span class="nc bnc" id="L2520" title="All 2 branches missed.">                    if (lu.type == 0) {</span>
<span class="nc" id="L2521">                        bp.horizontalPosition = lu.value;</span>
<span class="nc" id="L2522">                        bp.relative = (short)(1 ^ bp.relative);</span>
                    }
<span class="nc bnc" id="L2524" title="All 2 branches missed.">                    else if (lu.type == 1) {</span>
<span class="nc" id="L2525">                        bp.horizontalPosition = lu.value;</span>
                    }
<span class="nc bnc" id="L2527" title="All 2 branches missed.">                    else if (lu.type == 3) {</span>
<span class="nc" id="L2528">                        bp.horizontalPosition = lu.value;</span>
<span class="nc" id="L2529">                        bp.relative = (short)((1 ^ bp.relative) | 2);</span>
                    }
<span class="nc bnc" id="L2531" title="All 2 branches missed.">                    if (count &gt; 1) {</span>
<span class="nc" id="L2532">                        lu = new LengthUnit(strings[1], (short)0, 0f);</span>

<span class="nc bnc" id="L2534" title="All 2 branches missed.">                        if (lu.type == 0) {</span>
<span class="nc" id="L2535">                            bp.verticalPosition = lu.value;</span>
<span class="nc" id="L2536">                            bp.relative = (short)(4 ^ bp.relative);</span>
                        }
<span class="nc bnc" id="L2538" title="All 2 branches missed.">                        else if (lu.type == 1) {</span>
<span class="nc" id="L2539">                            bp.verticalPosition = lu.value;</span>
                        }
<span class="nc bnc" id="L2541" title="All 2 branches missed.">                        else if (lu.type == 3) {</span>
<span class="nc" id="L2542">                            bp.verticalPosition = lu.value;</span>
<span class="nc" id="L2543">                            bp.relative = (short)((4 ^ bp.relative) | 8);</span>
                        }
                    }
                    else {
<span class="nc" id="L2547">                        bp.verticalPosition = .5f;</span>
                    }
                }
            }
<span class="nc" id="L2551">            return bp;</span>
        }

        boolean isHorizontalPositionRelativeToSize() {
<span class="nc bnc" id="L2555" title="All 2 branches missed.">            return ((relative &amp; 1) == 1);</span>
        }

        boolean isHorizontalPositionRelativeToFontSize() {
<span class="nc bnc" id="L2559" title="All 2 branches missed.">            return ((relative &amp; 2) == 2);</span>
        }

        float getHorizontalPosition() {
<span class="nc" id="L2563">            return horizontalPosition;</span>
        }

        boolean isVerticalPositionRelativeToSize() {
<span class="nc bnc" id="L2567" title="All 2 branches missed.">            return ((relative &amp; 4) == 4);</span>
        }

        boolean isVerticalPositionRelativeToFontSize() {
<span class="nc bnc" id="L2571" title="All 2 branches missed.">            return ((relative &amp; 8) == 8);</span>
        }

        float getVerticalPosition() {
<span class="nc" id="L2575">            return verticalPosition;</span>
        }
    }


    /**
     * Used for BackgroundImages.
     */
<span class="nc" id="L2583">    static class BackgroundImage extends CssValue {</span>
        private boolean    loadedImage;
        private ImageIcon  image;

        Object parseCssValue(String value) {
<span class="nc" id="L2588">            BackgroundImage retValue = new BackgroundImage();</span>
<span class="nc" id="L2589">            retValue.svalue = value;</span>
<span class="nc" id="L2590">            return retValue;</span>
        }

        Object parseHtmlValue(String value) {
<span class="nc" id="L2594">            return parseCssValue(value);</span>
        }

        // PENDING: this base is wrong for linked style sheets.
        ImageIcon getImage(URL base) {
<span class="nc bnc" id="L2599" title="All 2 branches missed.">            if (!loadedImage) {</span>
<span class="nc" id="L2600">                synchronized(this) {</span>
<span class="nc bnc" id="L2601" title="All 2 branches missed.">                    if (!loadedImage) {</span>
<span class="nc" id="L2602">                        URL url = CSS.getURL(base, svalue);</span>
<span class="nc" id="L2603">                        loadedImage = true;</span>
<span class="nc bnc" id="L2604" title="All 2 branches missed.">                        if (url != null) {</span>
<span class="nc" id="L2605">                            image = new ImageIcon();</span>
<span class="nc" id="L2606">                            Image tmpImg = Toolkit.getDefaultToolkit().createImage(url);</span>
<span class="nc bnc" id="L2607" title="All 2 branches missed.">                            if (tmpImg != null) {</span>
<span class="nc" id="L2608">                                image.setImage(tmpImg);</span>
                            }
                        }
                    }
<span class="nc" id="L2612">                }</span>
            }
<span class="nc" id="L2614">            return image;</span>
        }
    }

    /**
     * Parses a length value, this is used internally, and never added
     * to an AttributeSet or returned to the developer.
     */
    static class LengthUnit implements Serializable {
<span class="nc" id="L2623">        static Hashtable&lt;String, Float&gt; lengthMapping = new Hashtable&lt;String, Float&gt;(6);</span>
<span class="nc" id="L2624">        static Hashtable&lt;String, Float&gt; w3cLengthMapping = new Hashtable&lt;String, Float&gt;(6);</span>
        static {
<span class="nc" id="L2626">            lengthMapping.put(&quot;pt&quot;, new Float(1f));</span>
            // Not sure about 1.3, determined by experiementation.
<span class="nc" id="L2628">            lengthMapping.put(&quot;px&quot;, new Float(1.3f));</span>
<span class="nc" id="L2629">            lengthMapping.put(&quot;mm&quot;, new Float(2.83464f));</span>
<span class="nc" id="L2630">            lengthMapping.put(&quot;cm&quot;, new Float(28.3464f));</span>
<span class="nc" id="L2631">            lengthMapping.put(&quot;pc&quot;, new Float(12f));</span>
<span class="nc" id="L2632">            lengthMapping.put(&quot;in&quot;, new Float(72f));</span>
<span class="nc" id="L2633">            int res = 72;</span>
            try {
<span class="nc" id="L2635">                res = Toolkit.getDefaultToolkit().getScreenResolution();</span>
<span class="nc" id="L2636">            } catch (HeadlessException e) {</span>
<span class="nc" id="L2637">            }</span>
            // mapping according to the CSS2 spec
<span class="nc" id="L2639">            w3cLengthMapping.put(&quot;pt&quot;, new Float(res/72f));</span>
<span class="nc" id="L2640">            w3cLengthMapping.put(&quot;px&quot;, new Float(1f));</span>
<span class="nc" id="L2641">            w3cLengthMapping.put(&quot;mm&quot;, new Float(res/25.4f));</span>
<span class="nc" id="L2642">            w3cLengthMapping.put(&quot;cm&quot;, new Float(res/2.54f));</span>
<span class="nc" id="L2643">            w3cLengthMapping.put(&quot;pc&quot;, new Float(res/6f));</span>
<span class="nc" id="L2644">            w3cLengthMapping.put(&quot;in&quot;, new Float(res));</span>
<span class="nc" id="L2645">        }</span>

<span class="nc" id="L2647">        LengthUnit(String value, short defaultType, float defaultValue) {</span>
<span class="nc" id="L2648">            parse(value, defaultType, defaultValue);</span>
<span class="nc" id="L2649">        }</span>

        void parse(String value, short defaultType, float defaultValue) {
<span class="nc" id="L2652">            type = defaultType;</span>
<span class="nc" id="L2653">            this.value = defaultValue;</span>

<span class="nc" id="L2655">            int length = value.length();</span>
<span class="nc bnc" id="L2656" title="All 4 branches missed.">            if (length &gt; 0 &amp;&amp; value.charAt(length - 1) == '%') {</span>
                try {
<span class="nc" id="L2658">                    this.value = Float.valueOf(value.substring(0, length - 1)).</span>
<span class="nc" id="L2659">                                               floatValue() / 100.0f;</span>
<span class="nc" id="L2660">                    type = 1;</span>
                }
<span class="nc" id="L2662">                catch (NumberFormatException nfe) { }</span>
            }
<span class="nc bnc" id="L2664" title="All 2 branches missed.">            if (length &gt;= 2) {</span>
<span class="nc" id="L2665">                units = value.substring(length - 2, length);</span>
<span class="nc" id="L2666">                Float scale = lengthMapping.get(units);</span>
<span class="nc bnc" id="L2667" title="All 2 branches missed.">                if (scale != null) {</span>
                    try {
<span class="nc" id="L2669">                        this.value = Float.valueOf(value.substring(0,</span>
<span class="nc" id="L2670">                               length - 2)).floatValue();</span>
<span class="nc" id="L2671">                        type = 0;</span>
                    }
<span class="nc" id="L2673">                    catch (NumberFormatException nfe) { }</span>
                }
<span class="nc bnc" id="L2675" title="All 2 branches missed.">                else if (units.equals(&quot;em&quot;) ||</span>
<span class="nc bnc" id="L2676" title="All 2 branches missed.">                         units.equals(&quot;ex&quot;)) {</span>
                    try {
<span class="nc" id="L2678">                        this.value = Float.valueOf(value.substring(0,</span>
<span class="nc" id="L2679">                                      length - 2)).floatValue();</span>
<span class="nc" id="L2680">                        type = 3;</span>
                    }
<span class="nc" id="L2682">                    catch (NumberFormatException nfe) { }</span>
                }
<span class="nc bnc" id="L2684" title="All 2 branches missed.">                else if (value.equals(&quot;larger&quot;)) {</span>
<span class="nc" id="L2685">                    this.value = 2f;</span>
<span class="nc" id="L2686">                    type = 2;</span>
                }
<span class="nc bnc" id="L2688" title="All 2 branches missed.">                else if (value.equals(&quot;smaller&quot;)) {</span>
<span class="nc" id="L2689">                    this.value = -2;</span>
<span class="nc" id="L2690">                    type = 2;</span>
                }
                else {
                    // treat like points.
                    try {
<span class="nc" id="L2695">                        this.value = Float.valueOf(value).floatValue();</span>
<span class="nc" id="L2696">                        type = 0;</span>
<span class="nc" id="L2697">                    } catch (NumberFormatException nfe) {}</span>
                }
<span class="nc" id="L2699">            }</span>
<span class="nc bnc" id="L2700" title="All 2 branches missed.">            else if (length &gt; 0) {</span>
                // treat like points.
                try {
<span class="nc" id="L2703">                    this.value = Float.valueOf(value).floatValue();</span>
<span class="nc" id="L2704">                    type = 0;</span>
<span class="nc" id="L2705">                } catch (NumberFormatException nfe) {}</span>
            }
<span class="nc" id="L2707">        }</span>

        float getValue(boolean w3cLengthUnits) {
<span class="nc bnc" id="L2710" title="All 2 branches missed.">            Hashtable&lt;String, Float&gt; mapping = (w3cLengthUnits) ? w3cLengthMapping : lengthMapping;</span>
<span class="nc" id="L2711">            float scale = 1;</span>
<span class="nc bnc" id="L2712" title="All 2 branches missed.">            if (units != null) {</span>
<span class="nc" id="L2713">                Float scaleFloat = mapping.get(units);</span>
<span class="nc bnc" id="L2714" title="All 2 branches missed.">                if (scaleFloat != null) {</span>
<span class="nc" id="L2715">                    scale = scaleFloat.floatValue();</span>
                }
            }
<span class="nc" id="L2718">            return this.value * scale;</span>

        }

        static float getValue(float value, String units, Boolean w3cLengthUnits) {
<span class="nc bnc" id="L2723" title="All 2 branches missed.">            Hashtable&lt;String, Float&gt; mapping = (w3cLengthUnits) ? w3cLengthMapping : lengthMapping;</span>
<span class="nc" id="L2724">            float scale = 1;</span>
<span class="nc bnc" id="L2725" title="All 2 branches missed.">            if (units != null) {</span>
<span class="nc" id="L2726">                Float scaleFloat = mapping.get(units);</span>
<span class="nc bnc" id="L2727" title="All 2 branches missed.">                if (scaleFloat != null) {</span>
<span class="nc" id="L2728">                    scale = scaleFloat.floatValue();</span>
                }
            }
<span class="nc" id="L2731">            return value * scale;</span>
        }

        public String toString() {
<span class="nc" id="L2735">            return type + &quot; &quot; + value;</span>
        }

        // 0 - value indicates real value
        // 1 - % value, value relative to depends upon key.
        //     50% will have a value = .5
        // 2 - add value to parent value.
        // 3 - em/ex relative to font size of element (except for
        //     font-size, which is relative to parent).
        short type;
        float value;
<span class="nc" id="L2746">        String units = null;</span>


        static final short UNINITALIZED_LENGTH = (short)10;
    }


    /**
     * Class used to parse font property. The font property is shorthand
     * for the other font properties. This expands the properties, placing
     * them in the attributeset.
     */
<span class="nc" id="L2758">    static class ShorthandFontParser {</span>
        /**
         * Parses the shorthand font string &lt;code&gt;value&lt;/code&gt;, placing the
         * result in &lt;code&gt;attr&lt;/code&gt;.
         */
        static void parseShorthandFont(CSS css, String value,
                                       MutableAttributeSet attr) {
            // font is of the form:
            // [ &lt;font-style&gt; || &lt;font-variant&gt; || &lt;font-weight&gt; ]? &lt;font-size&gt;
            //   [ / &lt;line-height&gt; ]? &lt;font-family&gt;
<span class="nc" id="L2768">            String[]   strings = CSS.parseStrings(value);</span>
<span class="nc" id="L2769">            int        count = strings.length;</span>
<span class="nc" id="L2770">            int        index = 0;</span>
            // bitmask, 1 for style, 2 for variant, 3 for weight
<span class="nc" id="L2772">            short      found = 0;</span>
<span class="nc" id="L2773">            int        maxC = Math.min(3, count);</span>

            // Check for font-style font-variant font-weight
<span class="nc bnc" id="L2776" title="All 2 branches missed.">            while (index &lt; maxC) {</span>
<span class="nc bnc" id="L2777" title="All 4 branches missed.">                if ((found &amp; 1) == 0 &amp;&amp; isFontStyle(strings[index])) {</span>
<span class="nc" id="L2778">                    css.addInternalCSSValue(attr, CSS.Attribute.FONT_STYLE,</span>
                                            strings[index++]);
<span class="nc" id="L2780">                    found |= 1;</span>
                }
<span class="nc bnc" id="L2782" title="All 4 branches missed.">                else if ((found &amp; 2) == 0 &amp;&amp; isFontVariant(strings[index])) {</span>
<span class="nc" id="L2783">                    css.addInternalCSSValue(attr, CSS.Attribute.FONT_VARIANT,</span>
                                            strings[index++]);
<span class="nc" id="L2785">                    found |= 2;</span>
                }
<span class="nc bnc" id="L2787" title="All 4 branches missed.">                else if ((found &amp; 4) == 0 &amp;&amp; isFontWeight(strings[index])) {</span>
<span class="nc" id="L2788">                    css.addInternalCSSValue(attr, CSS.Attribute.FONT_WEIGHT,</span>
                                            strings[index++]);
<span class="nc" id="L2790">                    found |= 4;</span>
                }
<span class="nc bnc" id="L2792" title="All 2 branches missed.">                else if (strings[index].equals(&quot;normal&quot;)) {</span>
<span class="nc" id="L2793">                    index++;</span>
                }
                else {
                    break;
                }
            }
<span class="nc bnc" id="L2799" title="All 2 branches missed.">            if ((found &amp; 1) == 0) {</span>
<span class="nc" id="L2800">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_STYLE,</span>
                                        &quot;normal&quot;);
            }
<span class="nc bnc" id="L2803" title="All 2 branches missed.">            if ((found &amp; 2) == 0) {</span>
<span class="nc" id="L2804">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_VARIANT,</span>
                                        &quot;normal&quot;);
            }
<span class="nc bnc" id="L2807" title="All 2 branches missed.">            if ((found &amp; 4) == 0) {</span>
<span class="nc" id="L2808">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_WEIGHT,</span>
                                        &quot;normal&quot;);
            }

            // string at index should be the font-size
<span class="nc bnc" id="L2813" title="All 2 branches missed.">            if (index &lt; count) {</span>
<span class="nc" id="L2814">                String fontSize = strings[index];</span>
<span class="nc" id="L2815">                int slashIndex = fontSize.indexOf('/');</span>

<span class="nc bnc" id="L2817" title="All 2 branches missed.">                if (slashIndex != -1) {</span>
<span class="nc" id="L2818">                    fontSize = fontSize.substring(0, slashIndex);</span>
<span class="nc" id="L2819">                    strings[index] = strings[index].substring(slashIndex);</span>
                }
                else {
<span class="nc" id="L2822">                    index++;</span>
                }
<span class="nc" id="L2824">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_SIZE,</span>
                                        fontSize);
<span class="nc" id="L2826">            }</span>
            else {
<span class="nc" id="L2828">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_SIZE,</span>
                                        &quot;medium&quot;);
            }

            // Check for line height
<span class="nc bnc" id="L2833" title="All 4 branches missed.">            if (index &lt; count &amp;&amp; strings[index].startsWith(&quot;/&quot;)) {</span>
<span class="nc" id="L2834">                String lineHeight = null;</span>
<span class="nc bnc" id="L2835" title="All 2 branches missed.">                if (strings[index].equals(&quot;/&quot;)) {</span>
<span class="nc bnc" id="L2836" title="All 2 branches missed.">                    if (++index &lt; count) {</span>
<span class="nc" id="L2837">                        lineHeight = strings[index++];</span>
                    }
                }
                else {
<span class="nc" id="L2841">                    lineHeight = strings[index++].substring(1);</span>
                }
                // line height
<span class="nc bnc" id="L2844" title="All 2 branches missed.">                if (lineHeight != null) {</span>
<span class="nc" id="L2845">                    css.addInternalCSSValue(attr, CSS.Attribute.LINE_HEIGHT,</span>
                                            lineHeight);
                }
                else {
<span class="nc" id="L2849">                    css.addInternalCSSValue(attr, CSS.Attribute.LINE_HEIGHT,</span>
                                            &quot;normal&quot;);
                }
<span class="nc" id="L2852">            }</span>
            else {
<span class="nc" id="L2854">                css.addInternalCSSValue(attr, CSS.Attribute.LINE_HEIGHT,</span>
                                        &quot;normal&quot;);
            }

            // remainder of strings are font-family
<span class="nc bnc" id="L2859" title="All 2 branches missed.">            if (index &lt; count) {</span>
<span class="nc" id="L2860">                String family = strings[index++];</span>

<span class="nc bnc" id="L2862" title="All 2 branches missed.">                while (index &lt; count) {</span>
<span class="nc" id="L2863">                    family += &quot; &quot; + strings[index++];</span>
                }
<span class="nc" id="L2865">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_FAMILY,</span>
                                        family);
<span class="nc" id="L2867">            }</span>
            else {
<span class="nc" id="L2869">                css.addInternalCSSValue(attr, CSS.Attribute.FONT_FAMILY,</span>
                                        Font.SANS_SERIF);
            }
<span class="nc" id="L2872">        }</span>

        private static boolean isFontStyle(String string) {
<span class="nc bnc" id="L2875" title="All 2 branches missed.">            return (string.equals(&quot;italic&quot;) ||</span>
<span class="nc bnc" id="L2876" title="All 2 branches missed.">                    string.equals(&quot;oblique&quot;));</span>
        }

        private static boolean isFontVariant(String string) {
<span class="nc" id="L2880">            return (string.equals(&quot;small-caps&quot;));</span>
        }

        private static boolean isFontWeight(String string) {
<span class="nc bnc" id="L2884" title="All 4 branches missed.">            if (string.equals(&quot;bold&quot;) || string.equals(&quot;bolder&quot;) ||</span>
<span class="nc bnc" id="L2885" title="All 4 branches missed.">                string.equals(&quot;italic&quot;) || string.equals(&quot;lighter&quot;)) {</span>
<span class="nc" id="L2886">                return true;</span>
            }
            // test for 100-900
<span class="nc bnc" id="L2889" title="All 2 branches missed.">            return (string.length() == 3 &amp;&amp;</span>
<span class="nc bnc" id="L2890" title="All 4 branches missed.">                    string.charAt(0) &gt;= '1' &amp;&amp; string.charAt(0) &lt;= '9' &amp;&amp;</span>
<span class="nc bnc" id="L2891" title="All 4 branches missed.">                    string.charAt(1) == '0' &amp;&amp; string.charAt(2) == '0');</span>
        }

    }


    /**
     * Parses the background property into its intrinsic values.
     */
<span class="nc" id="L2900">    static class ShorthandBackgroundParser {</span>
        /**
         * Parses the shorthand font string &lt;code&gt;value&lt;/code&gt;, placing the
         * result in &lt;code&gt;attr&lt;/code&gt;.
         */
        static void parseShorthandBackground(CSS css, String value,
                                             MutableAttributeSet attr) {
<span class="nc" id="L2907">            String[] strings = parseStrings(value);</span>
<span class="nc" id="L2908">            int count = strings.length;</span>
<span class="nc" id="L2909">            int index = 0;</span>
            // bitmask: 0 for image, 1 repeat, 2 attachment, 3 position,
            //          4 color
<span class="nc" id="L2912">            short found = 0;</span>

<span class="nc bnc" id="L2914" title="All 2 branches missed.">            while (index &lt; count) {</span>
<span class="nc" id="L2915">                String string = strings[index++];</span>
<span class="nc bnc" id="L2916" title="All 4 branches missed.">                if ((found &amp; 1) == 0 &amp;&amp; isImage(string)) {</span>
<span class="nc" id="L2917">                    css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                            BACKGROUND_IMAGE, string);
<span class="nc" id="L2919">                    found |= 1;</span>
                }
<span class="nc bnc" id="L2921" title="All 4 branches missed.">                else if ((found &amp; 2) == 0 &amp;&amp; isRepeat(string)) {</span>
<span class="nc" id="L2922">                    css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                            BACKGROUND_REPEAT, string);
<span class="nc" id="L2924">                    found |= 2;</span>
                }
<span class="nc bnc" id="L2926" title="All 4 branches missed.">                else if ((found &amp; 4) == 0 &amp;&amp; isAttachment(string)) {</span>
<span class="nc" id="L2927">                    css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                            BACKGROUND_ATTACHMENT, string);
<span class="nc" id="L2929">                    found |= 4;</span>
                }
<span class="nc bnc" id="L2931" title="All 4 branches missed.">                else if ((found &amp; 8) == 0 &amp;&amp; isPosition(string)) {</span>
<span class="nc bnc" id="L2932" title="All 4 branches missed.">                    if (index &lt; count &amp;&amp; isPosition(strings[index])) {</span>
<span class="nc" id="L2933">                        css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                                BACKGROUND_POSITION,
                                                string + &quot; &quot; +
                                                strings[index++]);
                    }
                    else {
<span class="nc" id="L2939">                        css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                                BACKGROUND_POSITION, string);
                    }
<span class="nc" id="L2942">                    found |= 8;</span>
                }
<span class="nc bnc" id="L2944" title="All 4 branches missed.">                else if ((found &amp; 16) == 0 &amp;&amp; isColor(string)) {</span>
<span class="nc" id="L2945">                    css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                            BACKGROUND_COLOR, string);
<span class="nc" id="L2947">                    found |= 16;</span>
                }
<span class="nc" id="L2949">            }</span>
<span class="nc bnc" id="L2950" title="All 2 branches missed.">            if ((found &amp; 1) == 0) {</span>
<span class="nc" id="L2951">                css.addInternalCSSValue(attr, CSS.Attribute.BACKGROUND_IMAGE,</span>
                                        null);
            }
<span class="nc bnc" id="L2954" title="All 2 branches missed.">            if ((found &amp; 2) == 0) {</span>
<span class="nc" id="L2955">                css.addInternalCSSValue(attr, CSS.Attribute.BACKGROUND_REPEAT,</span>
                                        &quot;repeat&quot;);
            }
<span class="nc bnc" id="L2958" title="All 2 branches missed.">            if ((found &amp; 4) == 0) {</span>
<span class="nc" id="L2959">                css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                        BACKGROUND_ATTACHMENT, &quot;scroll&quot;);
            }
<span class="nc bnc" id="L2962" title="All 2 branches missed.">            if ((found &amp; 8) == 0) {</span>
<span class="nc" id="L2963">                css.addInternalCSSValue(attr, CSS.Attribute.</span>
                                        BACKGROUND_POSITION, null);
            }
            // Currently, there is no good way to express this.
            /*
            if ((found &amp; 16) == 0) {
                css.addInternalCSSValue(attr, CSS.Attribute.BACKGROUND_COLOR,
                                        null);
            }
            */
<span class="nc" id="L2973">        }</span>

        static boolean isImage(String string) {
<span class="nc bnc" id="L2976" title="All 4 branches missed.">            return (string.startsWith(&quot;url(&quot;) &amp;&amp; string.endsWith(&quot;)&quot;));</span>
        }

        static boolean isRepeat(String string) {
<span class="nc bnc" id="L2980" title="All 4 branches missed.">            return (string.equals(&quot;repeat-x&quot;) || string.equals(&quot;repeat-y&quot;) ||</span>
<span class="nc bnc" id="L2981" title="All 4 branches missed.">                    string.equals(&quot;repeat&quot;) || string.equals(&quot;no-repeat&quot;));</span>
        }

        static boolean isAttachment(String string) {
<span class="nc bnc" id="L2985" title="All 4 branches missed.">            return (string.equals(&quot;fixed&quot;) || string.equals(&quot;scroll&quot;));</span>
        }

        static boolean isPosition(String string) {
<span class="nc bnc" id="L2989" title="All 4 branches missed.">            return (string.equals(&quot;top&quot;) || string.equals(&quot;bottom&quot;) ||</span>
<span class="nc bnc" id="L2990" title="All 4 branches missed.">                    string.equals(&quot;left&quot;) || string.equals(&quot;right&quot;) ||</span>
<span class="nc bnc" id="L2991" title="All 2 branches missed.">                    string.equals(&quot;center&quot;) ||</span>
<span class="nc bnc" id="L2992" title="All 2 branches missed.">                    (string.length() &gt; 0 &amp;&amp;</span>
<span class="nc bnc" id="L2993" title="All 2 branches missed.">                     Character.isDigit(string.charAt(0))));</span>
        }

        static boolean isColor(String string) {
<span class="nc bnc" id="L2997" title="All 2 branches missed.">            return (CSS.stringToColor(string) != null);</span>
        }
    }


    /**
     * Used to parser margin and padding.
     */
<span class="nc" id="L3005">    static class ShorthandMarginParser {</span>
        /**
         * Parses the shorthand margin/padding/border string
         * &lt;code&gt;value&lt;/code&gt;, placing the result in &lt;code&gt;attr&lt;/code&gt;.
         * &lt;code&gt;names&lt;/code&gt; give the 4 instrinsic property names.
         */
        static void parseShorthandMargin(CSS css, String value,
                                         MutableAttributeSet attr,
                                         CSS.Attribute[] names) {
<span class="nc" id="L3014">            String[] strings = parseStrings(value);</span>
<span class="nc" id="L3015">            int count = strings.length;</span>
<span class="nc" id="L3016">            int index = 0;</span>
<span class="nc bnc" id="L3017" title="All 5 branches missed.">            switch (count) {</span>
            case 0:
                // empty string
<span class="nc" id="L3020">                return;</span>
            case 1:
                // Identifies all values.
<span class="nc bnc" id="L3023" title="All 2 branches missed.">                for (int counter = 0; counter &lt; 4; counter++) {</span>
<span class="nc" id="L3024">                    css.addInternalCSSValue(attr, names[counter], strings[0]);</span>
                }
<span class="nc" id="L3026">                break;</span>
            case 2:
                // 0 &amp; 2 = strings[0], 1 &amp; 3 = strings[1]
<span class="nc" id="L3029">                css.addInternalCSSValue(attr, names[0], strings[0]);</span>
<span class="nc" id="L3030">                css.addInternalCSSValue(attr, names[2], strings[0]);</span>
<span class="nc" id="L3031">                css.addInternalCSSValue(attr, names[1], strings[1]);</span>
<span class="nc" id="L3032">                css.addInternalCSSValue(attr, names[3], strings[1]);</span>
<span class="nc" id="L3033">                break;</span>
            case 3:
<span class="nc" id="L3035">                css.addInternalCSSValue(attr, names[0], strings[0]);</span>
<span class="nc" id="L3036">                css.addInternalCSSValue(attr, names[1], strings[1]);</span>
<span class="nc" id="L3037">                css.addInternalCSSValue(attr, names[2], strings[2]);</span>
<span class="nc" id="L3038">                css.addInternalCSSValue(attr, names[3], strings[1]);</span>
<span class="nc" id="L3039">                break;</span>
            default:
<span class="nc bnc" id="L3041" title="All 2 branches missed.">                for (int counter = 0; counter &lt; 4; counter++) {</span>
<span class="nc" id="L3042">                    css.addInternalCSSValue(attr, names[counter],</span>
                                            strings[counter]);
                }
                break;
            }
<span class="nc" id="L3047">        }</span>
    }

<span class="nc" id="L3050">    static class ShorthandBorderParser {</span>
<span class="nc" id="L3051">        static Attribute[] keys = {</span>
            Attribute.BORDER_TOP, Attribute.BORDER_RIGHT,
            Attribute.BORDER_BOTTOM, Attribute.BORDER_LEFT,
        };

        static void parseShorthandBorder(MutableAttributeSet attributes,
                                            CSS.Attribute key, String value) {
<span class="nc" id="L3058">            Object[] parts = new Object[CSSBorder.PARSERS.length];</span>
<span class="nc" id="L3059">            String[] strings = parseStrings(value);</span>
<span class="nc bnc" id="L3060" title="All 2 branches missed.">            for (String s : strings) {</span>
<span class="nc" id="L3061">                boolean valid = false;</span>
<span class="nc bnc" id="L3062" title="All 2 branches missed.">                for (int i = 0; i &lt; parts.length; i++) {</span>
<span class="nc" id="L3063">                    Object v = CSSBorder.PARSERS[i].parseCssValue(s);</span>
<span class="nc bnc" id="L3064" title="All 2 branches missed.">                    if (v != null) {</span>
<span class="nc bnc" id="L3065" title="All 2 branches missed.">                        if (parts[i] == null) {</span>
<span class="nc" id="L3066">                            parts[i] = v;</span>
<span class="nc" id="L3067">                            valid = true;</span>
                        }
                        break;
                    }
                }
<span class="nc bnc" id="L3072" title="All 2 branches missed.">                if (!valid) {</span>
                    // Part is non-parseable or occurred more than once.
<span class="nc" id="L3074">                    return;</span>
                }
            }

            // Unspecified parts get default values.
<span class="nc bnc" id="L3079" title="All 2 branches missed.">            for (int i = 0; i &lt; parts.length; i++) {</span>
<span class="nc bnc" id="L3080" title="All 2 branches missed.">                if (parts[i] == null) {</span>
<span class="nc" id="L3081">                    parts[i] = CSSBorder.DEFAULTS[i];</span>
                }
            }

            // Dispatch collected values to individual properties.
<span class="nc bnc" id="L3086" title="All 2 branches missed.">            for (int i = 0; i &lt; keys.length; i++) {</span>
<span class="nc bnc" id="L3087" title="All 4 branches missed.">                if ((key == Attribute.BORDER) || (key == keys[i])) {</span>
<span class="nc bnc" id="L3088" title="All 2 branches missed.">                    for (int k = 0; k &lt; parts.length; k++) {</span>
<span class="nc" id="L3089">                        attributes.addAttribute(</span>
                                        CSSBorder.ATTRIBUTES[k][i], parts[k]);
                    }
                }
            }
<span class="nc" id="L3094">        }</span>
    }

    /**
     * Calculate the requirements needed to tile the requirements
     * given by the iterator that would be tiled.  The calculation
     * takes into consideration margin and border spacing.
     */
    static SizeRequirements calculateTiledRequirements(LayoutIterator iter, SizeRequirements r) {
<span class="nc" id="L3103">        long minimum = 0;</span>
<span class="nc" id="L3104">        long maximum = 0;</span>
<span class="nc" id="L3105">        long preferred = 0;</span>
<span class="nc" id="L3106">        int lastMargin = 0;</span>
<span class="nc" id="L3107">        int totalSpacing = 0;</span>
<span class="nc" id="L3108">        int n = iter.getCount();</span>
<span class="nc bnc" id="L3109" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc" id="L3110">            iter.setIndex(i);</span>
<span class="nc" id="L3111">            int margin0 = lastMargin;</span>
<span class="nc" id="L3112">            int margin1 = (int) iter.getLeadingCollapseSpan();</span>
<span class="nc" id="L3113">            totalSpacing += Math.max(margin0, margin1);</span>
<span class="nc" id="L3114">            preferred += (int) iter.getPreferredSpan(0);</span>
<span class="nc" id="L3115">            minimum += iter.getMinimumSpan(0);</span>
<span class="nc" id="L3116">            maximum += iter.getMaximumSpan(0);</span>

<span class="nc" id="L3118">            lastMargin = (int) iter.getTrailingCollapseSpan();</span>
        }
<span class="nc" id="L3120">        totalSpacing += lastMargin;</span>
<span class="nc" id="L3121">        totalSpacing += 2 * iter.getBorderWidth();</span>

        // adjust for the spacing area
<span class="nc" id="L3124">        minimum += totalSpacing;</span>
<span class="nc" id="L3125">        preferred += totalSpacing;</span>
<span class="nc" id="L3126">        maximum += totalSpacing;</span>

        // set return value
<span class="nc bnc" id="L3129" title="All 2 branches missed.">        if (r == null) {</span>
<span class="nc" id="L3130">            r = new SizeRequirements();</span>
        }
<span class="nc bnc" id="L3132" title="All 2 branches missed.">        r.minimum = (minimum &gt; Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)minimum;</span>
<span class="nc bnc" id="L3133" title="All 2 branches missed.">        r.preferred = (preferred &gt; Integer.MAX_VALUE) ? Integer.MAX_VALUE :(int) preferred;</span>
<span class="nc bnc" id="L3134" title="All 2 branches missed.">        r.maximum = (maximum &gt; Integer.MAX_VALUE) ? Integer.MAX_VALUE :(int) maximum;</span>
<span class="nc" id="L3135">        return r;</span>
    }

    /**
     * Calculate a tiled layout for the given iterator.
     * This should be done collapsing the neighboring
     * margins to be a total of the maximum of the two
     * neighboring margin areas as described in the CSS spec.
     */
    static void calculateTiledLayout(LayoutIterator iter, int targetSpan) {

        /*
         * first pass, calculate the preferred sizes, adjustments needed because
         * of margin collapsing, and the flexibility to adjust the sizes.
         */
<span class="nc" id="L3150">        long preferred = 0;</span>
        long currentPreferred;
<span class="nc" id="L3152">        int lastMargin = 0;</span>
<span class="nc" id="L3153">        int totalSpacing = 0;</span>
<span class="nc" id="L3154">        int n = iter.getCount();</span>
<span class="nc" id="L3155">        int adjustmentWeightsCount = LayoutIterator.WorstAdjustmentWeight + 1;</span>
        //max gain we can get adjusting elements with adjustmentWeight &lt;= i
<span class="nc" id="L3157">        long gain[] = new long[adjustmentWeightsCount];</span>
        //max loss we can get adjusting elements with adjustmentWeight &lt;= i
<span class="nc" id="L3159">        long loss[] = new long[adjustmentWeightsCount];</span>

<span class="nc bnc" id="L3161" title="All 2 branches missed.">        for (int i = 0; i &lt; adjustmentWeightsCount; i++) {</span>
<span class="nc" id="L3162">            gain[i] = loss[i] = 0;</span>
        }
<span class="nc bnc" id="L3164" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc" id="L3165">            iter.setIndex(i);</span>
<span class="nc" id="L3166">            int margin0 = lastMargin;</span>
<span class="nc" id="L3167">            int margin1 = (int) iter.getLeadingCollapseSpan();</span>

<span class="nc" id="L3169">            iter.setOffset(Math.max(margin0, margin1));</span>
<span class="nc" id="L3170">            totalSpacing += iter.getOffset();</span>

<span class="nc" id="L3172">            currentPreferred = (long)iter.getPreferredSpan(targetSpan);</span>
<span class="nc" id="L3173">            iter.setSpan((int) currentPreferred);</span>
<span class="nc" id="L3174">            preferred += currentPreferred;</span>
<span class="nc" id="L3175">            gain[iter.getAdjustmentWeight()] +=</span>
<span class="nc" id="L3176">                (long)iter.getMaximumSpan(targetSpan) - currentPreferred;</span>
<span class="nc" id="L3177">            loss[iter.getAdjustmentWeight()] +=</span>
<span class="nc" id="L3178">                currentPreferred - (long)iter.getMinimumSpan(targetSpan);</span>
<span class="nc" id="L3179">            lastMargin = (int) iter.getTrailingCollapseSpan();</span>
        }
<span class="nc" id="L3181">        totalSpacing += lastMargin;</span>
<span class="nc" id="L3182">        totalSpacing += 2 * iter.getBorderWidth();</span>

<span class="nc bnc" id="L3184" title="All 2 branches missed.">        for (int i = 1; i &lt; adjustmentWeightsCount; i++) {</span>
<span class="nc" id="L3185">            gain[i] += gain[i - 1];</span>
<span class="nc" id="L3186">            loss[i] += loss[i - 1];</span>
        }

        /*
         * Second pass, expand or contract by as much as possible to reach
         * the target span.  This takes the margin collapsing into account
         * prior to adjusting the span.
         */

        // determine the adjustment to be made
<span class="nc" id="L3196">        int allocated = targetSpan - totalSpacing;</span>
<span class="nc" id="L3197">        long desiredAdjustment = allocated - preferred;</span>
<span class="nc bnc" id="L3198" title="All 2 branches missed.">        long adjustmentsArray[] = (desiredAdjustment &gt; 0) ? gain : loss;</span>
<span class="nc" id="L3199">        desiredAdjustment = Math.abs(desiredAdjustment);</span>
<span class="nc" id="L3200">        int adjustmentLevel = 0;</span>
<span class="nc bnc" id="L3201" title="All 2 branches missed.">        for (;adjustmentLevel &lt;= LayoutIterator.WorstAdjustmentWeight;</span>
<span class="nc" id="L3202">             adjustmentLevel++) {</span>
            // adjustmentsArray[] is sorted. I do not bother about
            // binary search though
<span class="nc bnc" id="L3205" title="All 2 branches missed.">            if (adjustmentsArray[adjustmentLevel] &gt;= desiredAdjustment) {</span>
<span class="nc" id="L3206">                break;</span>
            }
        }
<span class="nc" id="L3209">        float adjustmentFactor = 0.0f;</span>
<span class="nc bnc" id="L3210" title="All 2 branches missed.">        if (adjustmentLevel &lt;= LayoutIterator.WorstAdjustmentWeight) {</span>
<span class="nc bnc" id="L3211" title="All 2 branches missed.">            desiredAdjustment -= (adjustmentLevel &gt; 0) ?</span>
                adjustmentsArray[adjustmentLevel - 1] : 0;
<span class="nc bnc" id="L3213" title="All 2 branches missed.">            if (desiredAdjustment != 0) {</span>
<span class="nc bnc" id="L3214" title="All 2 branches missed.">                float maximumAdjustment =</span>
                    adjustmentsArray[adjustmentLevel] -
                    ((adjustmentLevel &gt; 0) ?
                     adjustmentsArray[adjustmentLevel - 1] : 0
                     );
<span class="nc" id="L3219">                adjustmentFactor = desiredAdjustment / maximumAdjustment;</span>
            }
        }
        // make the adjustments
<span class="nc" id="L3223">        int totalOffset = (int)iter.getBorderWidth();</span>
<span class="nc bnc" id="L3224" title="All 2 branches missed.">        for (int i = 0; i &lt; n; i++) {</span>
<span class="nc" id="L3225">            iter.setIndex(i);</span>
<span class="nc" id="L3226">            iter.setOffset( iter.getOffset() + totalOffset);</span>
<span class="nc bnc" id="L3227" title="All 2 branches missed.">            if (iter.getAdjustmentWeight() &lt; adjustmentLevel) {</span>
<span class="nc bnc" id="L3228" title="All 2 branches missed.">                iter.setSpan((int)</span>
                             ((allocated &gt; preferred) ?
<span class="nc" id="L3230">                              Math.floor(iter.getMaximumSpan(targetSpan)) :</span>
<span class="nc" id="L3231">                              Math.ceil(iter.getMinimumSpan(targetSpan))</span>
                              )
                             );
<span class="nc bnc" id="L3234" title="All 2 branches missed.">            } else if (iter.getAdjustmentWeight() == adjustmentLevel) {</span>
<span class="nc bnc" id="L3235" title="All 2 branches missed.">                int availableSpan = (allocated &gt; preferred) ?</span>
<span class="nc" id="L3236">                    (int) iter.getMaximumSpan(targetSpan) - iter.getSpan() :</span>
<span class="nc" id="L3237">                    iter.getSpan() - (int) iter.getMinimumSpan(targetSpan);</span>
<span class="nc" id="L3238">                int adj = (int)Math.floor(adjustmentFactor * availableSpan);</span>
<span class="nc bnc" id="L3239" title="All 2 branches missed.">                iter.setSpan(iter.getSpan() +</span>
                             ((allocated &gt; preferred) ? adj : -adj));
            }
<span class="nc" id="L3242">            totalOffset = (int) Math.min((long) iter.getOffset() +</span>
<span class="nc" id="L3243">                                         (long) iter.getSpan(),</span>
                                         Integer.MAX_VALUE);
        }

        // while rounding we could lose several pixels.
<span class="nc" id="L3248">        int roundError = targetSpan - totalOffset -</span>
<span class="nc" id="L3249">            (int)iter.getTrailingCollapseSpan() -</span>
<span class="nc" id="L3250">            (int)iter.getBorderWidth();</span>
<span class="nc bnc" id="L3251" title="All 2 branches missed.">        int adj = (roundError &gt; 0) ? 1 : -1;</span>
<span class="nc" id="L3252">        roundError *= adj;</span>

<span class="nc" id="L3254">        boolean canAdjust = true;</span>
<span class="nc bnc" id="L3255" title="All 4 branches missed.">        while (roundError &gt; 0 &amp;&amp; canAdjust) {</span>
            // check for infinite loop
<span class="nc" id="L3257">            canAdjust = false;</span>
<span class="nc" id="L3258">            int offsetAdjust = 0;</span>
            // try to distribute roundError. one pixel per cell
<span class="nc bnc" id="L3260" title="All 2 branches missed.">            for (int i = 0; i &lt; n; i++) {</span>
<span class="nc" id="L3261">                iter.setIndex(i);</span>
<span class="nc" id="L3262">                iter.setOffset(iter.getOffset() + offsetAdjust);</span>
<span class="nc" id="L3263">                int curSpan = iter.getSpan();</span>
<span class="nc bnc" id="L3264" title="All 2 branches missed.">                if (roundError &gt; 0) {</span>
<span class="nc bnc" id="L3265" title="All 2 branches missed.">                    int boundGap = (adj &gt; 0) ?</span>
<span class="nc" id="L3266">                        (int)Math.floor(iter.getMaximumSpan(targetSpan)) - curSpan :</span>
<span class="nc" id="L3267">                        curSpan - (int)Math.ceil(iter.getMinimumSpan(targetSpan));</span>
<span class="nc bnc" id="L3268" title="All 2 branches missed.">                    if (boundGap &gt;= 1) {</span>
<span class="nc" id="L3269">                        canAdjust = true;</span>
<span class="nc" id="L3270">                        iter.setSpan(curSpan + adj);</span>
<span class="nc" id="L3271">                        offsetAdjust += adj;</span>
<span class="nc" id="L3272">                        roundError--;</span>
                    }
                }
            }
<span class="nc" id="L3276">        }</span>
<span class="nc" id="L3277">    }</span>

    /**
     * An iterator to express the requirements to use when computing
     * layout.
     */
    interface LayoutIterator {

        void setOffset(int offs);

        int getOffset();

        void setSpan(int span);

        int getSpan();

        int getCount();

        void setIndex(int i);

        float getMinimumSpan(float parentSpan);

        float getPreferredSpan(float parentSpan);

        float getMaximumSpan(float parentSpan);

        int getAdjustmentWeight(); //0 is the best weight WorstAdjustmentWeight is a worst one

        //float getAlignment();

        float getBorderWidth();

        float getLeadingCollapseSpan();

        float getTrailingCollapseSpan();
        public static final int WorstAdjustmentWeight = 2;
    }

    //
    // Serialization support
    //

    private void writeObject(java.io.ObjectOutputStream s)
        throws IOException
    {
<span class="nc" id="L3322">        s.defaultWriteObject();</span>

        // Determine what values in valueConvertor need to be written out.
<span class="nc" id="L3325">        Enumeration keys = valueConvertor.keys();</span>
<span class="nc" id="L3326">        s.writeInt(valueConvertor.size());</span>
<span class="nc bnc" id="L3327" title="All 2 branches missed.">        if (keys != null) {</span>
<span class="nc bnc" id="L3328" title="All 2 branches missed.">            while (keys.hasMoreElements()) {</span>
<span class="nc" id="L3329">                Object key = keys.nextElement();</span>
<span class="nc" id="L3330">                Object value = valueConvertor.get(key);</span>
<span class="nc bnc" id="L3331" title="All 2 branches missed.">                if (!(key instanceof Serializable) &amp;&amp;</span>
<span class="nc bnc" id="L3332" title="All 2 branches missed.">                    (key = StyleContext.getStaticAttributeKey(key)) == null) {</span>
                    // Should we throw an exception here?
<span class="nc" id="L3334">                    key = null;</span>
<span class="nc" id="L3335">                    value = null;</span>
                }
<span class="nc bnc" id="L3337" title="All 2 branches missed.">                else if (!(value instanceof Serializable) &amp;&amp;</span>
<span class="nc bnc" id="L3338" title="All 2 branches missed.">                    (value = StyleContext.getStaticAttributeKey(value)) == null){</span>
                    // Should we throw an exception here?
<span class="nc" id="L3340">                    key = null;</span>
<span class="nc" id="L3341">                    value = null;</span>
                }
<span class="nc" id="L3343">                s.writeObject(key);</span>
<span class="nc" id="L3344">                s.writeObject(value);</span>
<span class="nc" id="L3345">            }</span>
        }
<span class="nc" id="L3347">    }</span>

    private void readObject(ObjectInputStream s)
      throws ClassNotFoundException, IOException
    {
<span class="nc" id="L3352">        s.defaultReadObject();</span>
        // Reconstruct the hashtable.
<span class="nc" id="L3354">        int numValues = s.readInt();</span>
<span class="nc" id="L3355">        valueConvertor = new Hashtable&lt;Object, Object&gt;(Math.max(1, numValues));</span>
<span class="nc bnc" id="L3356" title="All 2 branches missed.">        while (numValues-- &gt; 0) {</span>
<span class="nc" id="L3357">            Object key = s.readObject();</span>
<span class="nc" id="L3358">            Object value = s.readObject();</span>
<span class="nc" id="L3359">            Object staticKey = StyleContext.getStaticAttribute(key);</span>
<span class="nc bnc" id="L3360" title="All 2 branches missed.">            if (staticKey != null) {</span>
<span class="nc" id="L3361">                key = staticKey;</span>
            }
<span class="nc" id="L3363">            Object staticValue = StyleContext.getStaticAttribute(value);</span>
<span class="nc bnc" id="L3364" title="All 2 branches missed.">            if (staticValue != null) {</span>
<span class="nc" id="L3365">                value = staticValue;</span>
            }
<span class="nc bnc" id="L3367" title="All 4 branches missed.">            if (key != null &amp;&amp; value != null) {</span>
<span class="nc" id="L3368">                valueConvertor.put(key, value);</span>
            }
<span class="nc" id="L3370">        }</span>
<span class="nc" id="L3371">    }</span>


    /*
     * we need StyleSheet for resolving lenght units. (see
     * isW3CLengthUnits)
     * we can not pass stylesheet for handling relative sizes. (do not
     * think changing public API is necessary)
     * CSS is not likely to be accessed from more then one thread.
     * Having local storage for StyleSheet for resolving relative
     * sizes is safe
     *
     * idk 08/30/2004
     */
    private StyleSheet getStyleSheet(StyleSheet ss) {
<span class="nc bnc" id="L3386" title="All 2 branches missed.">        if (ss != null) {</span>
<span class="nc" id="L3387">            styleSheet = ss;</span>
        }
<span class="nc" id="L3389">        return styleSheet;</span>
    }
    //
    // Instance variables
    //

    /** Maps from CSS key to CssValue. */
    private transient Hashtable&lt;Object, Object&gt; valueConvertor;

    /** Size used for relative units. */
    private int baseFontSize;

<span class="nc" id="L3401">    private transient StyleSheet styleSheet = null;</span>

<span class="nc" id="L3403">    static int baseFontSizeIndex = 3;</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>