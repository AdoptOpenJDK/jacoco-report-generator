<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ResourceResolverSpi.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">com.sun.org.apache.xml.internal.security.utils.resolver</a> &gt; <span class="el_source">ResourceResolverSpi.java</span></div><h1>ResourceResolverSpi.java</h1><pre class="source lang-java linenums">/*
 * reserved comment block
 * DO NOT REMOVE OR ALTER!
 */
/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
package com.sun.org.apache.xml.internal.security.utils.resolver;

import java.util.HashMap;
import java.util.Map;

import com.sun.org.apache.xml.internal.security.signature.XMLSignatureInput;
import org.w3c.dom.Attr;

/**
 * During reference validation, we have to retrieve resources from somewhere.
 *
 * @author $Author: coheigea $
 */
<span class="nc" id="L36">public abstract class ResourceResolverSpi {</span>

    /** {@link org.apache.commons.logging} logging facility */
<span class="nc" id="L39">    private static java.util.logging.Logger log =</span>
<span class="nc" id="L40">        java.util.logging.Logger.getLogger(ResourceResolverSpi.class.getName());</span>

    /** Field properties */
<span class="nc" id="L43">    protected java.util.Map&lt;String, String&gt; properties = null;</span>

    /**
     * Deprecated - used to carry state about whether resolution was being done in a secure fashion,
     * but was not thread safe, so the resolution information is now passed as parameters to methods.
     *
     * @deprecated Secure validation flag is now passed to methods.
     */
<span class="nc" id="L51">    @Deprecated</span>
    protected final boolean secureValidation = true;

    /**
     * This is the workhorse method used to resolve resources.
     *
     * @param uri
     * @param BaseURI
     * @return the resource wrapped around a XMLSignatureInput
     *
     * @throws ResourceResolverException
     *
     * @deprecated New clients should override {@link #engineResolveURI(ResourceResolverContext)}
     */
    @Deprecated
    public XMLSignatureInput engineResolve(Attr uri, String BaseURI)
        throws ResourceResolverException {
<span class="nc" id="L68">        throw new UnsupportedOperationException();</span>
    }

    /**
     * This is the workhorse method used to resolve resources.
     * @param context Context to use to resolve resources.
     *
     * @return the resource wrapped around a XMLSignatureInput
     *
     * @throws ResourceResolverException
     */
    public XMLSignatureInput engineResolveURI(ResourceResolverContext context)
        throws ResourceResolverException {
        // The default implementation, to preserve backwards compatibility in the
        // test cases, calls the old resolver API.
<span class="nc" id="L83">        return engineResolve(context.attr, context.baseUri);</span>
    }

    /**
     * Method engineSetProperty
     *
     * @param key
     * @param value
     */
    public void engineSetProperty(String key, String value) {
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if (properties == null) {</span>
<span class="nc" id="L94">            properties = new HashMap&lt;String, String&gt;();</span>
        }
<span class="nc" id="L96">        properties.put(key, value);</span>
<span class="nc" id="L97">    }</span>

    /**
     * Method engineGetProperty
     *
     * @param key
     * @return the value of the property
     */
    public String engineGetProperty(String key) {
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (properties == null) {</span>
<span class="nc" id="L107">            return null;</span>
        }
<span class="nc" id="L109">        return properties.get(key);</span>
    }

    /**
     *
     * @param newProperties
     */
    public void engineAddProperies(Map&lt;String, String&gt; newProperties) {
<span class="nc bnc" id="L117" title="All 4 branches missed.">        if (newProperties != null &amp;&amp; !newProperties.isEmpty()) {</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">            if (properties == null) {</span>
<span class="nc" id="L119">                properties = new HashMap&lt;String, String&gt;();</span>
            }
<span class="nc" id="L121">            properties.putAll(newProperties);</span>
        }
<span class="nc" id="L123">    }</span>

    /**
     * Tells if the implementation does can be reused by several threads safely.
     * It normally means that the implementation does not have any member, or there is
     * member change between engineCanResolve &amp; engineResolve invocations. Or it maintains all
     * member info in ThreadLocal methods.
     */
    public boolean engineIsThreadSafe() {
<span class="nc" id="L132">        return false;</span>
    }

    /**
     * This method helps the {@link ResourceResolver} to decide whether a
     * {@link ResourceResolverSpi} is able to perform the requested action.
     *
     * @param uri
     * @param BaseURI
     * @return true if the engine can resolve the uri
     *
     * @deprecated See {@link #engineCanResolveURI(ResourceResolverContext)}
     */
    @Deprecated
    public boolean engineCanResolve(Attr uri, String BaseURI) {
        // This method used to be abstract, so any calls to &quot;super&quot; are bogus.
<span class="nc" id="L148">        throw new UnsupportedOperationException();</span>
    }

    /**
     * This method helps the {@link ResourceResolver} to decide whether a
     * {@link ResourceResolverSpi} is able to perform the requested action.
     *
     * &lt;p&gt;New clients should override this method, and not override {@link #engineCanResolve(Attr, String)}
     * &lt;/p&gt;
     * @param context Context in which to do resolution.
     * @return true if the engine can resolve the uri
     */
    public boolean engineCanResolveURI(ResourceResolverContext context) {
        // To preserve backward compatibility with existing resolvers that might override the old method,
        // call the old deprecated API.
<span class="nc" id="L163">        return engineCanResolve( context.attr, context.baseUri );</span>
    }

    /**
     * Method engineGetPropertyKeys
     *
     * @return the property keys
     */
    public String[] engineGetPropertyKeys() {
<span class="nc" id="L172">        return new String[0];</span>
    }

    /**
     * Method understandsProperty
     *
     * @param propertyToTest
     * @return true if understands the property
     */
    public boolean understandsProperty(String propertyToTest) {
<span class="nc" id="L182">        String[] understood = this.engineGetPropertyKeys();</span>

<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (understood != null) {</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">            for (int i = 0; i &lt; understood.length; i++) {</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if (understood[i].equals(propertyToTest)) {</span>
<span class="nc" id="L187">                    return true;</span>
                }
            }
        }

<span class="nc" id="L192">        return false;</span>
    }


    /**
     * Fixes a platform dependent filename to standard URI form.
     *
     * @param str The string to fix.
     *
     * @return Returns the fixed URI string.
     */
    public static String fixURI(String str) {

        // handle platform dependent strings
<span class="nc" id="L206">        str = str.replace(java.io.File.separatorChar, '/');</span>

<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (str.length() &gt;= 4) {</span>

            // str =~ /^\W:\/([^/])/ # to speak perl ;-))
<span class="nc" id="L211">            char ch0 = Character.toUpperCase(str.charAt(0));</span>
<span class="nc" id="L212">            char ch1 = str.charAt(1);</span>
<span class="nc" id="L213">            char ch2 = str.charAt(2);</span>
<span class="nc" id="L214">            char ch3 = str.charAt(3);</span>
<span class="nc bnc" id="L215" title="All 10 branches missed.">            boolean isDosFilename = ((('A' &lt;= ch0) &amp;&amp; (ch0 &lt;= 'Z'))</span>
                &amp;&amp; (ch1 == ':') &amp;&amp; (ch2 == '/')
                &amp;&amp; (ch3 != '/'));

<span class="nc bnc" id="L219" title="All 4 branches missed.">            if (isDosFilename &amp;&amp; log.isLoggable(java.util.logging.Level.FINE)) {</span>
<span class="nc" id="L220">                log.log(java.util.logging.Level.FINE, &quot;Found DOS filename: &quot; + str);</span>
            }
        }

        // Windows fix
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (str.length() &gt;= 2) {</span>
<span class="nc" id="L226">            char ch1 = str.charAt(1);</span>

<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (ch1 == ':') {</span>
<span class="nc" id="L229">                char ch0 = Character.toUpperCase(str.charAt(0));</span>

<span class="nc bnc" id="L231" title="All 4 branches missed.">                if (('A' &lt;= ch0) &amp;&amp; (ch0 &lt;= 'Z')) {</span>
<span class="nc" id="L232">                    str = &quot;/&quot; + str;</span>
                }
            }
        }

        // done
<span class="nc" id="L238">        return str;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>