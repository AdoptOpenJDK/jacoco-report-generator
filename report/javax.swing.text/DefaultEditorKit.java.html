<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>DefaultEditorKit.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.text</a> &gt; <span class="el_source">DefaultEditorKit.java</span></div><h1>DefaultEditorKit.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2010, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.text;

import sun.awt.SunToolkit;

import java.io.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.text.*;
import javax.swing.Action;
import javax.swing.KeyStroke;
import javax.swing.SwingConstants;
import javax.swing.UIManager;

/**
 * This is the set of things needed by a text component
 * to be a reasonably functioning editor for some &lt;em&gt;type&lt;/em&gt;
 * of text document.  This implementation provides a default
 * implementation which treats text as plain text and
 * provides a minimal set of actions for a simple editor.
 * &lt;p&gt;
 * &lt;dl&gt;
 * &lt;dt&gt;&lt;b&gt;&lt;font size=+1&gt;Newlines&lt;/font&gt;&lt;/b&gt;
 * &lt;dd&gt;
 * There are two properties which deal with newlines.  The
 * system property, &lt;code&gt;line.separator&lt;/code&gt;, is defined to be
 * platform-dependent, either &quot;\n&quot;, &quot;\r&quot;, or &quot;\r\n&quot;.  There is also
 * a property defined in &lt;code&gt;DefaultEditorKit&lt;/code&gt;, called
 * &lt;a href=#EndOfLineStringProperty&gt;&lt;code&gt;EndOfLineStringProperty&lt;/code&gt;&lt;/a&gt;,
 * which is defined automatically when a document is loaded, to be
 * the first occurrence of any of the newline characters.
 * When a document is loaded, &lt;code&gt;EndOfLineStringProperty&lt;/code&gt;
 * is set appropriately, and when the document is written back out, the
 * &lt;code&gt;EndOfLineStringProperty&lt;/code&gt; is used.  But while the document
 * is in memory, the &quot;\n&quot; character is used to define a
 * newline, regardless of how the newline is defined when
 * the document is on disk.  Therefore, for searching purposes,
 * &quot;\n&quot; should always be used.  When a new document is created,
 * and the &lt;code&gt;EndOfLineStringProperty&lt;/code&gt; has not been defined,
 * it will use the System property when writing out the
 * document.
 * &lt;p&gt;Note that &lt;code&gt;EndOfLineStringProperty&lt;/code&gt; is set
 * on the &lt;code&gt;Document&lt;/code&gt; using the &lt;code&gt;get/putProperty&lt;/code&gt;
 * methods.  Subclasses may override this behavior.
 *
 * &lt;/dl&gt;
 *
 * @author  Timothy Prinzing
 */
public class DefaultEditorKit extends EditorKit {

    /**
     * default constructor for DefaultEditorKit
     */
<span class="nc" id="L78">    public DefaultEditorKit() {</span>
<span class="nc" id="L79">    }</span>

    /**
     * Gets the MIME type of the data that this
     * kit represents support for.  The default
     * is &lt;code&gt;text/plain&lt;/code&gt;.
     *
     * @return the type
     */
    public String getContentType() {
<span class="nc" id="L89">        return &quot;text/plain&quot;;</span>
    }

    /**
     * Fetches a factory that is suitable for producing
     * views of any models that are produced by this
     * kit.  The default is to have the UI produce the
     * factory, so this method has no implementation.
     *
     * @return the view factory
     */
    public ViewFactory getViewFactory() {
<span class="nc" id="L101">        return null;</span>
    }

    /**
     * Fetches the set of commands that can be used
     * on a text component that is using a model and
     * view produced by this kit.
     *
     * @return the command list
     */
    public Action[] getActions() {
<span class="nc" id="L112">        return defaultActions;</span>
    }

    /**
     * Fetches a caret that can navigate through views
     * produced by the associated ViewFactory.
     *
     * @return the caret
     */
    public Caret createCaret() {
<span class="nc" id="L122">        return null;</span>
    }

    /**
     * Creates an uninitialized text storage model (PlainDocument)
     * that is appropriate for this type of editor.
     *
     * @return the model
     */
    public Document createDefaultDocument() {
<span class="nc" id="L132">        return new PlainDocument();</span>
    }

    /**
     * Inserts content from the given stream which is expected
     * to be in a format appropriate for this kind of content
     * handler.
     *
     * @param in  The stream to read from
     * @param doc The destination for the insertion.
     * @param pos The location in the document to place the
     *   content &amp;gt;=0.
     * @exception IOException on any I/O error
     * @exception BadLocationException if pos represents an invalid
     *   location within the document.
     */
    public void read(InputStream in, Document doc, int pos)
        throws IOException, BadLocationException {

<span class="nc" id="L151">        read(new InputStreamReader(in), doc, pos);</span>
<span class="nc" id="L152">    }</span>

    /**
     * Writes content from a document to the given stream
     * in a format appropriate for this kind of content handler.
     *
     * @param out The stream to write to
     * @param doc The source for the write.
     * @param pos The location in the document to fetch the
     *   content &amp;gt;=0.
     * @param len The amount to write out &amp;gt;=0.
     * @exception IOException on any I/O error
     * @exception BadLocationException if pos represents an invalid
     *   location within the document.
     */
    public void write(OutputStream out, Document doc, int pos, int len)
        throws IOException, BadLocationException {
<span class="nc" id="L169">        OutputStreamWriter osw = new OutputStreamWriter(out);</span>

<span class="nc" id="L171">        write(osw, doc, pos, len);</span>
<span class="nc" id="L172">        osw.flush();</span>
<span class="nc" id="L173">    }</span>

    /**
     * Gets the input attributes for the pane. This method exists for
     * the benefit of StyledEditorKit so that the read method will
     * pick up the correct attributes to apply to inserted text.
     * This class's implementation simply returns null.
     *
     * @return null
     */
    MutableAttributeSet getInputAttributes() {
<span class="nc" id="L184">        return null;</span>
    }

    /**
     * Inserts content from the given stream, which will be
     * treated as plain text.
     *
     * @param in  The stream to read from
     * @param doc The destination for the insertion.
     * @param pos The location in the document to place the
     *   content &amp;gt;=0.
     * @exception IOException on any I/O error
     * @exception BadLocationException if pos represents an invalid
     *   location within the document.
     */
    public void read(Reader in, Document doc, int pos)
        throws IOException, BadLocationException {

<span class="nc" id="L202">        char[] buff = new char[4096];</span>
        int nch;
<span class="nc" id="L204">        boolean lastWasCR = false;</span>
<span class="nc" id="L205">        boolean isCRLF = false;</span>
<span class="nc" id="L206">        boolean isCR = false;</span>
        int last;
<span class="nc bnc" id="L208" title="All 2 branches missed.">        boolean wasEmpty = (doc.getLength() == 0);</span>
<span class="nc" id="L209">        AttributeSet attr = getInputAttributes();</span>

        // Read in a block at a time, mapping \r\n to \n, as well as single
        // \r's to \n's. If a \r\n is encountered, \r\n will be set as the
        // newline string for the document, if \r is encountered it will
        // be set as the newline character, otherwise the newline property
        // for the document will be removed.
<span class="nc bnc" id="L216" title="All 2 branches missed.">        while ((nch = in.read(buff, 0, buff.length)) != -1) {</span>
<span class="nc" id="L217">            last = 0;</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">            for(int counter = 0; counter &lt; nch; counter++) {</span>
<span class="nc bnc" id="L219" title="All 3 branches missed.">                switch(buff[counter]) {</span>
                case '\r':
<span class="nc bnc" id="L221" title="All 2 branches missed.">                    if (lastWasCR) {</span>
<span class="nc" id="L222">                        isCR = true;</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                        if (counter == 0) {</span>
<span class="nc" id="L224">                            doc.insertString(pos, &quot;\n&quot;, attr);</span>
<span class="nc" id="L225">                            pos++;</span>
                        }
                        else {
<span class="nc" id="L228">                            buff[counter - 1] = '\n';</span>
                        }
                    }
                    else {
<span class="nc" id="L232">                        lastWasCR = true;</span>
                    }
<span class="nc" id="L234">                    break;</span>
                case '\n':
<span class="nc bnc" id="L236" title="All 2 branches missed.">                    if (lastWasCR) {</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">                        if (counter &gt; (last + 1)) {</span>
<span class="nc" id="L238">                            doc.insertString(pos, new String(buff, last,</span>
                                            counter - last - 1), attr);
<span class="nc" id="L240">                            pos += (counter - last - 1);</span>
                        }
                        // else nothing to do, can skip \r, next write will
                        // write \n
<span class="nc" id="L244">                        lastWasCR = false;</span>
<span class="nc" id="L245">                        last = counter;</span>
<span class="nc" id="L246">                        isCRLF = true;</span>
                    }
                    break;
                default:
<span class="nc bnc" id="L250" title="All 2 branches missed.">                    if (lastWasCR) {</span>
<span class="nc" id="L251">                        isCR = true;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">                        if (counter == 0) {</span>
<span class="nc" id="L253">                            doc.insertString(pos, &quot;\n&quot;, attr);</span>
<span class="nc" id="L254">                            pos++;</span>
                        }
                        else {
<span class="nc" id="L257">                            buff[counter - 1] = '\n';</span>
                        }
<span class="nc" id="L259">                        lastWasCR = false;</span>
                    }
                    break;
                }
            }
<span class="nc bnc" id="L264" title="All 2 branches missed.">            if (last &lt; nch) {</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                if(lastWasCR) {</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                    if (last &lt; (nch - 1)) {</span>
<span class="nc" id="L267">                        doc.insertString(pos, new String(buff, last,</span>
                                         nch - last - 1), attr);
<span class="nc" id="L269">                        pos += (nch - last - 1);</span>
                    }
                }
                else {
<span class="nc" id="L273">                    doc.insertString(pos, new String(buff, last,</span>
                                     nch - last), attr);
<span class="nc" id="L275">                    pos += (nch - last);</span>
                }
            }
        }
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (lastWasCR) {</span>
<span class="nc" id="L280">            doc.insertString(pos, &quot;\n&quot;, attr);</span>
<span class="nc" id="L281">            isCR = true;</span>
        }
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (wasEmpty) {</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">            if (isCRLF) {</span>
<span class="nc" id="L285">                doc.putProperty(EndOfLineStringProperty, &quot;\r\n&quot;);</span>
            }
<span class="nc bnc" id="L287" title="All 2 branches missed.">            else if (isCR) {</span>
<span class="nc" id="L288">                doc.putProperty(EndOfLineStringProperty, &quot;\r&quot;);</span>
            }
            else {
<span class="nc" id="L291">                doc.putProperty(EndOfLineStringProperty, &quot;\n&quot;);</span>
            }
        }
<span class="nc" id="L294">    }</span>

    /**
     * Writes content from a document to the given stream
     * as plain text.
     *
     * @param out  The stream to write to
     * @param doc The source for the write.
     * @param pos The location in the document to fetch the
     *   content from &amp;gt;=0.
     * @param len The amount to write out &amp;gt;=0.
     * @exception IOException on any I/O error
     * @exception BadLocationException if pos is not within 0 and
     *   the length of the document.
     */
    public void write(Writer out, Document doc, int pos, int len)
        throws IOException, BadLocationException {

<span class="nc bnc" id="L312" title="All 4 branches missed.">        if ((pos &lt; 0) || ((pos + len) &gt; doc.getLength())) {</span>
<span class="nc" id="L313">            throw new BadLocationException(&quot;DefaultEditorKit.write&quot;, pos);</span>
        }
<span class="nc" id="L315">        Segment data = new Segment();</span>
<span class="nc" id="L316">        int nleft = len;</span>
<span class="nc" id="L317">        int offs = pos;</span>
<span class="nc" id="L318">        Object endOfLineProperty = doc.getProperty(EndOfLineStringProperty);</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">        if (endOfLineProperty == null) {</span>
            try {
<span class="nc" id="L321">                endOfLineProperty = System.getProperty(&quot;line.separator&quot;);</span>
<span class="nc" id="L322">            } catch (SecurityException se) { }</span>
        }
        String endOfLine;
<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (endOfLineProperty instanceof String) {</span>
<span class="nc" id="L326">            endOfLine = (String)endOfLineProperty;</span>
        }
        else {
<span class="nc" id="L329">            endOfLine = null;</span>
        }
<span class="nc bnc" id="L331" title="All 4 branches missed.">        if (endOfLineProperty != null &amp;&amp; !endOfLine.equals(&quot;\n&quot;)) {</span>
            // There is an end of line string that isn't \n, have to iterate
            // through and find all \n's and translate to end of line string.
<span class="nc bnc" id="L334" title="All 2 branches missed.">            while (nleft &gt; 0) {</span>
<span class="nc" id="L335">                int n = Math.min(nleft, 4096);</span>
<span class="nc" id="L336">                doc.getText(offs, n, data);</span>
<span class="nc" id="L337">                int last = data.offset;</span>
<span class="nc" id="L338">                char[] array = data.array;</span>
<span class="nc" id="L339">                int maxCounter = last + data.count;</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">                for (int counter = last; counter &lt; maxCounter; counter++) {</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                    if (array[counter] == '\n') {</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">                        if (counter &gt; last) {</span>
<span class="nc" id="L343">                            out.write(array, last, counter - last);</span>
                        }
<span class="nc" id="L345">                        out.write(endOfLine);</span>
<span class="nc" id="L346">                        last = counter + 1;</span>
                    }
                }
<span class="nc bnc" id="L349" title="All 2 branches missed.">                if (maxCounter &gt; last) {</span>
<span class="nc" id="L350">                    out.write(array, last, maxCounter - last);</span>
                }
<span class="nc" id="L352">                offs += n;</span>
<span class="nc" id="L353">                nleft -= n;</span>
<span class="nc" id="L354">            }</span>
        }
        else {
            // Just write out text, will already have \n, no mapping to
            // do.
<span class="nc bnc" id="L359" title="All 2 branches missed.">            while (nleft &gt; 0) {</span>
<span class="nc" id="L360">                int n = Math.min(nleft, 4096);</span>
<span class="nc" id="L361">                doc.getText(offs, n, data);</span>
<span class="nc" id="L362">                out.write(data.array, data.offset, data.count);</span>
<span class="nc" id="L363">                offs += n;</span>
<span class="nc" id="L364">                nleft -= n;</span>
<span class="nc" id="L365">            }</span>
        }
<span class="nc" id="L367">        out.flush();</span>
<span class="nc" id="L368">    }</span>


    /**
     * When reading a document if a CRLF is encountered a property
     * with this name is added and the value will be &quot;\r\n&quot;.
     */
    public static final String EndOfLineStringProperty = &quot;__EndOfLine__&quot;;

    // --- names of well-known actions ---------------------------

    /**
     * Name of the action to place content into the associated
     * document.  If there is a selection, it is removed before
     * the new content is added.
     * @see #getActions
     */
    public static final String insertContentAction = &quot;insert-content&quot;;

    /**
     * Name of the action to place a line/paragraph break into
     * the document.  If there is a selection, it is removed before
     * the break is added.
     * @see #getActions
     */
    public static final String insertBreakAction = &quot;insert-break&quot;;

    /**
     * Name of the action to place a tab character into
     * the document.  If there is a selection, it is removed before
     * the tab is added.
     * @see #getActions
     */
    public static final String insertTabAction = &quot;insert-tab&quot;;

    /**
     * Name of the action to delete the character of content that
     * precedes the current caret position.
     * @see #getActions
     */
    public static final String deletePrevCharAction = &quot;delete-previous&quot;;

    /**
     * Name of the action to delete the character of content that
     * follows the current caret position.
     * @see #getActions
     */
    public static final String deleteNextCharAction = &quot;delete-next&quot;;

    /**
     * Name of the action to delete the word that
     * follows the beginning of the selection.
     * @see #getActions
     * @see JTextComponent#getSelectionStart
     * @since 1.6
     */
    public static final String deleteNextWordAction = &quot;delete-next-word&quot;;

    /**
     * Name of the action to delete the word that
     * precedes the beginning of the selection.
     * @see #getActions
     * @see JTextComponent#getSelectionStart
     * @since 1.6
     */
    public static final String deletePrevWordAction = &quot;delete-previous-word&quot;;

    /**
     * Name of the action to set the editor into read-only
     * mode.
     * @see #getActions
     */
    public static final String readOnlyAction = &quot;set-read-only&quot;;

    /**
     * Name of the action to set the editor into writeable
     * mode.
     * @see #getActions
     */
    public static final String writableAction = &quot;set-writable&quot;;

    /**
     * Name of the action to cut the selected region
     * and place the contents into the system clipboard.
     * @see JTextComponent#cut
     * @see #getActions
     */
    public static final String cutAction = &quot;cut-to-clipboard&quot;;

    /**
     * Name of the action to copy the selected region
     * and place the contents into the system clipboard.
     * @see JTextComponent#copy
     * @see #getActions
     */
    public static final String copyAction = &quot;copy-to-clipboard&quot;;

    /**
     * Name of the action to paste the contents of the
     * system clipboard into the selected region, or before the
     * caret if nothing is selected.
     * @see JTextComponent#paste
     * @see #getActions
     */
    public static final String pasteAction = &quot;paste-from-clipboard&quot;;

    /**
     * Name of the action to create a beep.
     * @see #getActions
     */
    public static final String beepAction = &quot;beep&quot;;

    /**
     * Name of the action to page up vertically.
     * @see #getActions
     */
    public static final String pageUpAction = &quot;page-up&quot;;

    /**
     * Name of the action to page down vertically.
     * @see #getActions
     */
    public static final String pageDownAction = &quot;page-down&quot;;

    /**
     * Name of the action to page up vertically, and move the
     * selection.
     * @see #getActions
     */
    /*public*/ static final String selectionPageUpAction = &quot;selection-page-up&quot;;

    /**
     * Name of the action to page down vertically, and move the
     * selection.
     * @see #getActions
     */
    /*public*/ static final String selectionPageDownAction = &quot;selection-page-down&quot;;

    /**
     * Name of the action to page left horizontally, and move the
     * selection.
     * @see #getActions
     */
    /*public*/ static final String selectionPageLeftAction = &quot;selection-page-left&quot;;

    /**
     * Name of the action to page right horizontally, and move the
     * selection.
     * @see #getActions
     */
    /*public*/ static final String selectionPageRightAction = &quot;selection-page-right&quot;;

    /**
     * Name of the Action for moving the caret
     * logically forward one position.
     * @see #getActions
     */
    public static final String forwardAction = &quot;caret-forward&quot;;

    /**
     * Name of the Action for moving the caret
     * logically backward one position.
     * @see #getActions
     */
    public static final String backwardAction = &quot;caret-backward&quot;;

    /**
     * Name of the Action for extending the selection
     * by moving the caret logically forward one position.
     * @see #getActions
     */
    public static final String selectionForwardAction = &quot;selection-forward&quot;;

    /**
     * Name of the Action for extending the selection
     * by moving the caret logically backward one position.
     * @see #getActions
     */
    public static final String selectionBackwardAction = &quot;selection-backward&quot;;

    /**
     * Name of the Action for moving the caret
     * logically upward one position.
     * @see #getActions
     */
    public static final String upAction = &quot;caret-up&quot;;

    /**
     * Name of the Action for moving the caret
     * logically downward one position.
     * @see #getActions
     */
    public static final String downAction = &quot;caret-down&quot;;

    /**
     * Name of the Action for moving the caret
     * logically upward one position, extending the selection.
     * @see #getActions
     */
    public static final String selectionUpAction = &quot;selection-up&quot;;

    /**
     * Name of the Action for moving the caret
     * logically downward one position, extending the selection.
     * @see #getActions
     */
    public static final String selectionDownAction = &quot;selection-down&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of a word.
     * @see #getActions
     */
    public static final String beginWordAction = &quot;caret-begin-word&quot;;

    /**
     * Name of the Action for moving the caret
     * to the end of a word.
     * @see #getActions
     */
    public static final String endWordAction = &quot;caret-end-word&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of a word, extending the selection.
     * @see #getActions
     */
    public static final String selectionBeginWordAction = &quot;selection-begin-word&quot;;

    /**
     * Name of the Action for moving the caret
     * to the end of a word, extending the selection.
     * @see #getActions
     */
    public static final String selectionEndWordAction = &quot;selection-end-word&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret to the
     * beginning of the previous word.
     * @see #getActions
     */
    public static final String previousWordAction = &quot;caret-previous-word&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret to the
     * beginning of the next word.
     * @see #getActions
     */
    public static final String nextWordAction = &quot;caret-next-word&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the selection to the
     * beginning of the previous word, extending the selection.
     * @see #getActions
     */
    public static final String selectionPreviousWordAction = &quot;selection-previous-word&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the selection to the
     * beginning of the next word, extending the selection.
     * @see #getActions
     */
    public static final String selectionNextWordAction = &quot;selection-next-word&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of a line.
     * @see #getActions
     */
    public static final String beginLineAction = &quot;caret-begin-line&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the end of a line.
     * @see #getActions
     */
    public static final String endLineAction = &quot;caret-end-line&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of a line, extending the selection.
     * @see #getActions
     */
    public static final String selectionBeginLineAction = &quot;selection-begin-line&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the end of a line, extending the selection.
     * @see #getActions
     */
    public static final String selectionEndLineAction = &quot;selection-end-line&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of a paragraph.
     * @see #getActions
     */
    public static final String beginParagraphAction = &quot;caret-begin-paragraph&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the end of a paragraph.
     * @see #getActions
     */
    public static final String endParagraphAction = &quot;caret-end-paragraph&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of a paragraph, extending the selection.
     * @see #getActions
     */
    public static final String selectionBeginParagraphAction = &quot;selection-begin-paragraph&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the end of a paragraph, extending the selection.
     * @see #getActions
     */
    public static final String selectionEndParagraphAction = &quot;selection-end-paragraph&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of the document.
     * @see #getActions
     */
    public static final String beginAction = &quot;caret-begin&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the end of the document.
     * @see #getActions
     */
    public static final String endAction = &quot;caret-end&quot;;

    /**
     * Name of the &lt;code&gt;Action&lt;/code&gt; for moving the caret
     * to the beginning of the document.
     * @see #getActions
     */
    public static final String selectionBeginAction = &quot;selection-begin&quot;;

    /**
     * Name of the Action for moving the caret
     * to the end of the document.
     * @see #getActions
     */
    public static final String selectionEndAction = &quot;selection-end&quot;;

    /**
     * Name of the Action for selecting a word around the caret.
     * @see #getActions
     */
    public static final String selectWordAction = &quot;select-word&quot;;

    /**
     * Name of the Action for selecting a line around the caret.
     * @see #getActions
     */
    public static final String selectLineAction = &quot;select-line&quot;;

    /**
     * Name of the Action for selecting a paragraph around the caret.
     * @see #getActions
     */
    public static final String selectParagraphAction = &quot;select-paragraph&quot;;

    /**
     * Name of the Action for selecting the entire document
     * @see #getActions
     */
    public static final String selectAllAction = &quot;select-all&quot;;

    /**
     * Name of the Action for removing selection
     * @see #getActions
     */
    /*public*/ static final String unselectAction = &quot;unselect&quot;;

    /**
     * Name of the Action for toggling the component's orientation.
     * @see #getActions
     */
    /*public*/ static final String toggleComponentOrientationAction
        = &quot;toggle-componentOrientation&quot;;

    /**
     * Name of the action that is executed by default if
     * a &lt;em&gt;key typed event&lt;/em&gt; is received and there
     * is no keymap entry.
     * @see #getActions
     */
    public static final String defaultKeyTypedAction = &quot;default-typed&quot;;

    // --- Action implementations ---------------------------------

<span class="nc" id="L763">    private static final Action[] defaultActions = {</span>
        new InsertContentAction(), new DeletePrevCharAction(),
        new DeleteNextCharAction(), new ReadOnlyAction(),
        new DeleteWordAction(deletePrevWordAction),
        new DeleteWordAction(deleteNextWordAction),
        new WritableAction(), new CutAction(),
        new CopyAction(), new PasteAction(),
        new VerticalPageAction(pageUpAction, -1, false),
        new VerticalPageAction(pageDownAction, 1, false),
        new VerticalPageAction(selectionPageUpAction, -1, true),
        new VerticalPageAction(selectionPageDownAction, 1, true),
        new PageAction(selectionPageLeftAction, true, true),
        new PageAction(selectionPageRightAction, false, true),
        new InsertBreakAction(), new BeepAction(),
        new NextVisualPositionAction(forwardAction, false,
                                     SwingConstants.EAST),
        new NextVisualPositionAction(backwardAction, false,
                                     SwingConstants.WEST),
        new NextVisualPositionAction(selectionForwardAction, true,
                                     SwingConstants.EAST),
        new NextVisualPositionAction(selectionBackwardAction, true,
                                     SwingConstants.WEST),
        new NextVisualPositionAction(upAction, false,
                                     SwingConstants.NORTH),
        new NextVisualPositionAction(downAction, false,
                                     SwingConstants.SOUTH),
        new NextVisualPositionAction(selectionUpAction, true,
                                     SwingConstants.NORTH),
        new NextVisualPositionAction(selectionDownAction, true,
                                     SwingConstants.SOUTH),
        new BeginWordAction(beginWordAction, false),
        new EndWordAction(endWordAction, false),
        new BeginWordAction(selectionBeginWordAction, true),
        new EndWordAction(selectionEndWordAction, true),
        new PreviousWordAction(previousWordAction, false),
        new NextWordAction(nextWordAction, false),
        new PreviousWordAction(selectionPreviousWordAction, true),
        new NextWordAction(selectionNextWordAction, true),
        new BeginLineAction(beginLineAction, false),
        new EndLineAction(endLineAction, false),
        new BeginLineAction(selectionBeginLineAction, true),
        new EndLineAction(selectionEndLineAction, true),
        new BeginParagraphAction(beginParagraphAction, false),
        new EndParagraphAction(endParagraphAction, false),
        new BeginParagraphAction(selectionBeginParagraphAction, true),
        new EndParagraphAction(selectionEndParagraphAction, true),
        new BeginAction(beginAction, false),
        new EndAction(endAction, false),
        new BeginAction(selectionBeginAction, true),
        new EndAction(selectionEndAction, true),
        new DefaultKeyTypedAction(), new InsertTabAction(),
        new SelectWordAction(), new SelectLineAction(),
        new SelectParagraphAction(), new SelectAllAction(),
        new UnselectAction(), new ToggleComponentOrientationAction(),
        new DumpModelAction()
    };

    /**
     * The action that is executed by default if
     * a &lt;em&gt;key typed event&lt;/em&gt; is received and there
     * is no keymap entry.  There is a variation across
     * different VM's in what gets sent as a &lt;em&gt;key typed&lt;/em&gt;
     * event, and this action tries to filter out the undesired
     * events.  This filters the control characters and those
     * with the ALT modifier.  It allows Control-Alt sequences
     * through as these form legitimate unicode characters on
     * some PC keyboards.
     * &lt;p&gt;
     * If the event doesn't get filtered, it will try to insert
     * content into the text editor.  The content is fetched
     * from the command string of the ActionEvent.  The text
     * entry is done through the &lt;code&gt;replaceSelection&lt;/code&gt;
     * method on the target text component.  This is the
     * action that will be fired for most text entry tasks.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#defaultKeyTypedAction
     * @see DefaultEditorKit#getActions
     * @see Keymap#setDefaultAction
     * @see Keymap#getDefaultAction
     */
    public static class DefaultKeyTypedAction extends TextAction {

        /**
         * Creates this object with the appropriate identifier.
         */
        public DefaultKeyTypedAction() {
<span class="nc" id="L858">            super(defaultKeyTypedAction);</span>
<span class="nc" id="L859">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L867">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L868" title="All 4 branches missed.">            if ((target != null) &amp;&amp; (e != null)) {</span>
<span class="nc bnc" id="L869" title="All 4 branches missed.">                if ((! target.isEditable()) || (! target.isEnabled())) {</span>
<span class="nc" id="L870">                    return;</span>
                }
<span class="nc" id="L872">                String content = e.getActionCommand();</span>
<span class="nc" id="L873">                int mod = e.getModifiers();</span>
<span class="nc bnc" id="L874" title="All 4 branches missed.">                if ((content != null) &amp;&amp; (content.length() &gt; 0)) {</span>
<span class="nc" id="L875">                    boolean isPrintableMask = true;</span>
<span class="nc" id="L876">                    Toolkit tk = Toolkit.getDefaultToolkit();</span>
<span class="nc bnc" id="L877" title="All 2 branches missed.">                    if (tk instanceof SunToolkit) {</span>
<span class="nc" id="L878">                        isPrintableMask = ((SunToolkit)tk).isPrintableCharacterModifiersMask(mod);</span>
                    }

<span class="nc bnc" id="L881" title="All 2 branches missed.">                    if (isPrintableMask) {</span>
<span class="nc" id="L882">                        char c = content.charAt(0);</span>
<span class="nc bnc" id="L883" title="All 4 branches missed.">                        if ((c &gt;= 0x20) &amp;&amp; (c != 0x7F)) {</span>
<span class="nc" id="L884">                            target.replaceSelection(content);</span>
                        }
                    }
                }
            }
<span class="nc" id="L889">        }</span>
    }

    /**
     * Places content into the associated document.
     * If there is a selection, it is removed before
     * the new content is added.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#insertContentAction
     * @see DefaultEditorKit#getActions
     */
    public static class InsertContentAction extends TextAction {

        /**
         * Creates this object with the appropriate identifier.
         */
        public InsertContentAction() {
<span class="nc" id="L915">            super(insertContentAction);</span>
<span class="nc" id="L916">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L924">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L925" title="All 4 branches missed.">            if ((target != null) &amp;&amp; (e != null)) {</span>
<span class="nc bnc" id="L926" title="All 4 branches missed.">                if ((! target.isEditable()) || (! target.isEnabled())) {</span>
<span class="nc" id="L927">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L928">                    return;</span>
                }
<span class="nc" id="L930">                String content = e.getActionCommand();</span>
<span class="nc bnc" id="L931" title="All 2 branches missed.">                if (content != null) {</span>
<span class="nc" id="L932">                    target.replaceSelection(content);</span>
                } else {
<span class="nc" id="L934">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
                }
            }
<span class="nc" id="L937">        }</span>
    }

    /**
     * Places a line/paragraph break into the document.
     * If there is a selection, it is removed before
     * the break is added.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#insertBreakAction
     * @see DefaultEditorKit#getActions
     */
    public static class InsertBreakAction extends TextAction {

        /**
         * Creates this object with the appropriate identifier.
         */
        public InsertBreakAction() {
<span class="nc" id="L963">            super(insertBreakAction);</span>
<span class="nc" id="L964">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L972">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L973" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc bnc" id="L974" title="All 4 branches missed.">                if ((! target.isEditable()) || (! target.isEnabled())) {</span>
<span class="nc" id="L975">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L976">                    return;</span>
                }
<span class="nc" id="L978">                target.replaceSelection(&quot;\n&quot;);</span>
            }
<span class="nc" id="L980">        }</span>
    }

    /**
     * Places a tab character into the document. If there
     * is a selection, it is removed before the tab is added.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#insertTabAction
     * @see DefaultEditorKit#getActions
     */
    public static class InsertTabAction extends TextAction {

        /**
         * Creates this object with the appropriate identifier.
         */
        public InsertTabAction() {
<span class="nc" id="L1005">            super(insertTabAction);</span>
<span class="nc" id="L1006">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1014">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1015" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc bnc" id="L1016" title="All 4 branches missed.">                if ((! target.isEditable()) || (! target.isEnabled())) {</span>
<span class="nc" id="L1017">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L1018">                    return;</span>
                }
<span class="nc" id="L1020">                target.replaceSelection(&quot;\t&quot;);</span>
            }
<span class="nc" id="L1022">        }</span>
    }

    /*
     * Deletes the character of content that precedes the
     * current caret position.
     * @see DefaultEditorKit#deletePrevCharAction
     * @see DefaultEditorKit#getActions
     */
    static class DeletePrevCharAction extends TextAction {

        /**
         * Creates this object with the appropriate identifier.
         */
        DeletePrevCharAction() {
<span class="nc" id="L1037">            super(deletePrevCharAction);</span>
<span class="nc" id="L1038">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1046">            JTextComponent target = getTextComponent(e);</span>
<span class="nc" id="L1047">            boolean beep = true;</span>
<span class="nc bnc" id="L1048" title="All 4 branches missed.">            if ((target != null) &amp;&amp; (target.isEditable())) {</span>
                try {
<span class="nc" id="L1050">                    Document doc = target.getDocument();</span>
<span class="nc" id="L1051">                    Caret caret = target.getCaret();</span>
<span class="nc" id="L1052">                    int dot = caret.getDot();</span>
<span class="nc" id="L1053">                    int mark = caret.getMark();</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">                    if (dot != mark) {</span>
<span class="nc" id="L1055">                        doc.remove(Math.min(dot, mark), Math.abs(dot - mark));</span>
<span class="nc" id="L1056">                        beep = false;</span>
<span class="nc bnc" id="L1057" title="All 2 branches missed.">                    } else if (dot &gt; 0) {</span>
<span class="nc" id="L1058">                        int delChars = 1;</span>

<span class="nc bnc" id="L1060" title="All 2 branches missed.">                        if (dot &gt; 1) {</span>
<span class="nc" id="L1061">                            String dotChars = doc.getText(dot - 2, 2);</span>
<span class="nc" id="L1062">                            char c0 = dotChars.charAt(0);</span>
<span class="nc" id="L1063">                            char c1 = dotChars.charAt(1);</span>

<span class="nc bnc" id="L1065" title="All 8 branches missed.">                            if (c0 &gt;= '\uD800' &amp;&amp; c0 &lt;= '\uDBFF' &amp;&amp;</span>
                                c1 &gt;= '\uDC00' &amp;&amp; c1 &lt;= '\uDFFF') {
<span class="nc" id="L1067">                                delChars = 2;</span>
                            }
                        }

<span class="nc" id="L1071">                        doc.remove(dot - delChars, delChars);</span>
<span class="nc" id="L1072">                        beep = false;</span>
                    }
<span class="nc" id="L1074">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L1075">                }</span>
            }
<span class="nc bnc" id="L1077" title="All 2 branches missed.">            if (beep) {</span>
<span class="nc" id="L1078">                UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
            }
<span class="nc" id="L1080">        }</span>
    }

    /*
     * Deletes the character of content that follows the
     * current caret position.
     * @see DefaultEditorKit#deleteNextCharAction
     * @see DefaultEditorKit#getActions
     */
    static class DeleteNextCharAction extends TextAction {

        /* Create this object with the appropriate identifier. */
        DeleteNextCharAction() {
<span class="nc" id="L1093">            super(deleteNextCharAction);</span>
<span class="nc" id="L1094">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1098">            JTextComponent target = getTextComponent(e);</span>
<span class="nc" id="L1099">            boolean beep = true;</span>
<span class="nc bnc" id="L1100" title="All 4 branches missed.">            if ((target != null) &amp;&amp; (target.isEditable())) {</span>
                try {
<span class="nc" id="L1102">                    Document doc = target.getDocument();</span>
<span class="nc" id="L1103">                    Caret caret = target.getCaret();</span>
<span class="nc" id="L1104">                    int dot = caret.getDot();</span>
<span class="nc" id="L1105">                    int mark = caret.getMark();</span>
<span class="nc bnc" id="L1106" title="All 2 branches missed.">                    if (dot != mark) {</span>
<span class="nc" id="L1107">                        doc.remove(Math.min(dot, mark), Math.abs(dot - mark));</span>
<span class="nc" id="L1108">                        beep = false;</span>
<span class="nc bnc" id="L1109" title="All 2 branches missed.">                    } else if (dot &lt; doc.getLength()) {</span>
<span class="nc" id="L1110">                        int delChars = 1;</span>

<span class="nc bnc" id="L1112" title="All 2 branches missed.">                        if (dot &lt; doc.getLength() - 1) {</span>
<span class="nc" id="L1113">                            String dotChars = doc.getText(dot, 2);</span>
<span class="nc" id="L1114">                            char c0 = dotChars.charAt(0);</span>
<span class="nc" id="L1115">                            char c1 = dotChars.charAt(1);</span>

<span class="nc bnc" id="L1117" title="All 8 branches missed.">                            if (c0 &gt;= '\uD800' &amp;&amp; c0 &lt;= '\uDBFF' &amp;&amp;</span>
                                c1 &gt;= '\uDC00' &amp;&amp; c1 &lt;= '\uDFFF') {
<span class="nc" id="L1119">                                delChars = 2;</span>
                            }
                        }

<span class="nc" id="L1123">                        doc.remove(dot, delChars);</span>
<span class="nc" id="L1124">                        beep = false;</span>
                    }
<span class="nc" id="L1126">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L1127">                }</span>
            }
<span class="nc bnc" id="L1129" title="All 2 branches missed.">            if (beep) {</span>
<span class="nc" id="L1130">                UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
            }
<span class="nc" id="L1132">        }</span>
    }


    /*
     * Deletes the word that precedes/follows the beginning of the selection.
     * @see DefaultEditorKit#getActions
     */
<span class="nc bnc" id="L1140" title="All 2 branches missed.">    static class DeleteWordAction extends TextAction {</span>
        DeleteWordAction(String name) {
<span class="nc" id="L1142">            super(name);</span>
<span class="nc bnc" id="L1143" title="All 6 branches missed.">            assert (name == deletePrevWordAction)</span>
                || (name == deleteNextWordAction);
<span class="nc" id="L1145">        }</span>
        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1152">            final JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1153" title="All 4 branches missed.">            if ((target != null) &amp;&amp; (e != null)) {</span>
<span class="nc bnc" id="L1154" title="All 4 branches missed.">                if ((! target.isEditable()) || (! target.isEnabled())) {</span>
<span class="nc" id="L1155">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L1156">                    return;</span>
                }
<span class="nc" id="L1158">                boolean beep = true;</span>
                try {
<span class="nc" id="L1160">                    final int start = target.getSelectionStart();</span>
<span class="nc" id="L1161">                    final Element line =</span>
<span class="nc" id="L1162">                        Utilities.getParagraphElement(target, start);</span>
                    int end;
<span class="nc bnc" id="L1164" title="All 2 branches missed.">                    if (deleteNextWordAction == getValue(Action.NAME)) {</span>
<span class="nc" id="L1165">                        end = Utilities.</span>
<span class="nc" id="L1166">                            getNextWordInParagraph(target, line, start, false);</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">                        if (end == java.text.BreakIterator.DONE) {</span>
                            //last word in the paragraph
<span class="nc" id="L1169">                            final int endOfLine = line.getEndOffset();</span>
<span class="nc bnc" id="L1170" title="All 2 branches missed.">                            if (start == endOfLine - 1) {</span>
                                //for last position remove last \n
<span class="nc" id="L1172">                                end = endOfLine;</span>
                            } else {
                                //remove to the end of the paragraph
<span class="nc" id="L1175">                                end = endOfLine - 1;</span>
                            }
<span class="nc" id="L1177">                        }</span>
                    } else {
<span class="nc" id="L1179">                        end = Utilities.</span>
<span class="nc" id="L1180">                            getPrevWordInParagraph(target, line, start);</span>
<span class="nc bnc" id="L1181" title="All 2 branches missed.">                        if (end == java.text.BreakIterator.DONE) {</span>
                            //there is no previous word in the paragraph
<span class="nc" id="L1183">                            final int startOfLine = line.getStartOffset();</span>
<span class="nc bnc" id="L1184" title="All 2 branches missed.">                            if (start == startOfLine) {</span>
                                //for first position remove previous \n
<span class="nc" id="L1186">                                end = startOfLine - 1;</span>
                            } else {
                                //remove to the start of the paragraph
<span class="nc" id="L1189">                                end = startOfLine;</span>
                            }
                        }
                    }
<span class="nc" id="L1193">                    int offs = Math.min(start, end);</span>
<span class="nc" id="L1194">                    int len = Math.abs(end - start);</span>
<span class="nc bnc" id="L1195" title="All 2 branches missed.">                    if (offs &gt;= 0) {</span>
<span class="nc" id="L1196">                        target.getDocument().remove(offs, len);</span>
<span class="nc" id="L1197">                        beep = false;</span>
                    }
<span class="nc" id="L1199">                } catch (BadLocationException ignore) {</span>
<span class="nc" id="L1200">                }</span>
<span class="nc bnc" id="L1201" title="All 2 branches missed.">                if (beep) {</span>
<span class="nc" id="L1202">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
                }
            }
<span class="nc" id="L1205">        }</span>
    }


    /*
     * Sets the editor into read-only mode.
     * @see DefaultEditorKit#readOnlyAction
     * @see DefaultEditorKit#getActions
     */
    static class ReadOnlyAction extends TextAction {

        /* Create this object with the appropriate identifier. */
        ReadOnlyAction() {
<span class="nc" id="L1218">            super(readOnlyAction);</span>
<span class="nc" id="L1219">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1227">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1228" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1229">                target.setEditable(false);</span>
            }
<span class="nc" id="L1231">        }</span>
    }

    /*
     * Sets the editor into writeable mode.
     * @see DefaultEditorKit#writableAction
     * @see DefaultEditorKit#getActions
     */
    static class WritableAction extends TextAction {

        /* Create this object with the appropriate identifier. */
        WritableAction() {
<span class="nc" id="L1243">            super(writableAction);</span>
<span class="nc" id="L1244">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1252">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1254">                target.setEditable(true);</span>
            }
<span class="nc" id="L1256">        }</span>
    }

    /**
     * Cuts the selected region and place its contents
     * into the system clipboard.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#cutAction
     * @see DefaultEditorKit#getActions
     */
    public static class CutAction extends TextAction {

        /** Create this object with the appropriate identifier. */
        public CutAction() {
<span class="nc" id="L1279">            super(cutAction);</span>
<span class="nc" id="L1280">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1288">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1289" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1290">                target.cut();</span>
            }
<span class="nc" id="L1292">        }</span>
    }

    /**
     * Copies the selected region and place its contents
     * into the system clipboard.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#copyAction
     * @see DefaultEditorKit#getActions
     */
    public static class CopyAction extends TextAction {

        /** Create this object with the appropriate identifier. */
        public CopyAction() {
<span class="nc" id="L1315">            super(copyAction);</span>
<span class="nc" id="L1316">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1324">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1325" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1326">                target.copy();</span>
            }
<span class="nc" id="L1328">        }</span>
    }

    /**
     * Pastes the contents of the system clipboard into the
     * selected region, or before the caret if nothing is
     * selected.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#pasteAction
     * @see DefaultEditorKit#getActions
     */
    public static class PasteAction extends TextAction {

        /** Create this object with the appropriate identifier. */
        public PasteAction() {
<span class="nc" id="L1352">            super(pasteAction);</span>
<span class="nc" id="L1353">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1361">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1362" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1363">                target.paste();</span>
            }
<span class="nc" id="L1365">        }</span>
    }

    /**
     * Creates a beep.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     *
     * @see DefaultEditorKit#beepAction
     * @see DefaultEditorKit#getActions
     */
    public static class BeepAction extends TextAction {

        /** Create this object with the appropriate identifier. */
        public BeepAction() {
<span class="nc" id="L1387">            super(beepAction);</span>
<span class="nc" id="L1388">        }</span>

        /**
         * The operation to perform when this action is triggered.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1396">            JTextComponent target = getTextComponent(e);</span>
<span class="nc" id="L1397">            UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L1398">        }</span>
    }

    /**
     * Scrolls up/down vertically.  The select version of this action extends
     * the selection, instead of simply moving the caret.
     *
     * @see DefaultEditorKit#pageUpAction
     * @see DefaultEditorKit#pageDownAction
     * @see DefaultEditorKit#getActions
     */
    static class VerticalPageAction extends TextAction {

        /** Create this object with the appropriate identifier. */
        public VerticalPageAction(String nm, int direction, boolean select) {
<span class="nc" id="L1413">            super(nm);</span>
<span class="nc" id="L1414">            this.select = select;</span>
<span class="nc" id="L1415">            this.direction = direction;</span>
<span class="nc" id="L1416">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1420">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1421" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1422">                Rectangle visible = target.getVisibleRect();</span>
<span class="nc" id="L1423">                Rectangle newVis = new Rectangle(visible);</span>
<span class="nc" id="L1424">                int selectedIndex = target.getCaretPosition();</span>
<span class="nc" id="L1425">                int scrollAmount = direction *</span>
<span class="nc" id="L1426">                        target.getScrollableBlockIncrement(</span>
                                  visible, SwingConstants.VERTICAL, direction);
<span class="nc" id="L1428">                int initialY = visible.y;</span>
<span class="nc" id="L1429">                Caret caret = target.getCaret();</span>
<span class="nc" id="L1430">                Point magicPosition = caret.getMagicCaretPosition();</span>

<span class="nc bnc" id="L1432" title="All 2 branches missed.">                if (selectedIndex != -1) {</span>
                    try {
<span class="nc" id="L1434">                        Rectangle dotBounds = target.modelToView(</span>
                                                     selectedIndex);
<span class="nc bnc" id="L1436" title="All 2 branches missed.">                        int x = (magicPosition != null) ? magicPosition.x :</span>
                                                          dotBounds.x;
<span class="nc" id="L1438">                        int h = dotBounds.height;</span>
<span class="nc bnc" id="L1439" title="All 2 branches missed.">                        if (h &gt; 0) {</span>
                            // We want to scroll by a multiple of caret height,
                            // rounding towards lower integer
<span class="nc" id="L1442">                            scrollAmount = scrollAmount / h * h;</span>
                        }
<span class="nc" id="L1444">                        newVis.y = constrainY(target,</span>
                                initialY + scrollAmount, visible.height);

                        int newIndex;

<span class="nc bnc" id="L1449" title="All 2 branches missed.">                        if (visible.contains(dotBounds.x, dotBounds.y)) {</span>
                            // Dot is currently visible, base the new
                            // location off the old, or
<span class="nc" id="L1452">                            newIndex = target.viewToModel(</span>
<span class="nc" id="L1453">                                new Point(x, constrainY(target,</span>
                                          dotBounds.y + scrollAmount, 0)));
                        }
                        else {
                            // Dot isn't visible, choose the top or the bottom
                            // for the new location.
<span class="nc bnc" id="L1459" title="All 2 branches missed.">                            if (direction == -1) {</span>
<span class="nc" id="L1460">                                newIndex = target.viewToModel(new Point(</span>
                                    x, newVis.y));
                            }
                            else {
<span class="nc" id="L1464">                                newIndex = target.viewToModel(new Point(</span>
                                    x, newVis.y + visible.height));
                            }
                        }
<span class="nc" id="L1468">                        newIndex = constrainOffset(target, newIndex);</span>
<span class="nc bnc" id="L1469" title="All 2 branches missed.">                        if (newIndex != selectedIndex) {</span>
                            // Make sure the new visible location contains
                            // the location of dot, otherwise Caret will
                            // cause an additional scroll.
<span class="nc" id="L1473">                            int newY = getAdjustedY(target, newVis, newIndex);</span>

<span class="nc bnc" id="L1475" title="All 8 branches missed.">                            if (direction == -1 &amp;&amp; newY &lt;= initialY || direction == 1 &amp;&amp; newY &gt;= initialY) {</span>
                                // Change index and correct newVis.y only if won't cause scrolling upward
<span class="nc" id="L1477">                                newVis.y = newY;</span>

<span class="nc bnc" id="L1479" title="All 2 branches missed.">                                if (select) {</span>
<span class="nc" id="L1480">                                    target.moveCaretPosition(newIndex);</span>
                                } else {
<span class="nc" id="L1482">                                    target.setCaretPosition(newIndex);</span>
                                }
                            }
                        }
<span class="nc" id="L1486">                    } catch (BadLocationException ble) { }</span>
                } else {
<span class="nc" id="L1488">                    newVis.y = constrainY(target,</span>
                            initialY + scrollAmount, visible.height);
                }
<span class="nc bnc" id="L1491" title="All 2 branches missed.">                if (magicPosition != null) {</span>
<span class="nc" id="L1492">                    caret.setMagicCaretPosition(magicPosition);</span>
                }
<span class="nc" id="L1494">                target.scrollRectToVisible(newVis);</span>
            }
<span class="nc" id="L1496">        }</span>

        /**
         * Makes sure &lt;code&gt;y&lt;/code&gt; is a valid location in
         * &lt;code&gt;target&lt;/code&gt;.
         */
        private int constrainY(JTextComponent target, int y, int vis) {
<span class="nc bnc" id="L1503" title="All 2 branches missed.">            if (y &lt; 0) {</span>
<span class="nc" id="L1504">                y = 0;</span>
            }
<span class="nc bnc" id="L1506" title="All 2 branches missed.">            else if (y + vis &gt; target.getHeight()) {</span>
<span class="nc" id="L1507">                y = Math.max(0, target.getHeight() - vis);</span>
            }
<span class="nc" id="L1509">            return y;</span>
        }

        /**
         * Ensures that &lt;code&gt;offset&lt;/code&gt; is a valid offset into the
         * model for &lt;code&gt;text&lt;/code&gt;.
         */
        private int constrainOffset(JTextComponent text, int offset) {
<span class="nc" id="L1517">            Document doc = text.getDocument();</span>

<span class="nc bnc" id="L1519" title="All 4 branches missed.">            if ((offset != 0) &amp;&amp; (offset &gt; doc.getLength())) {</span>
<span class="nc" id="L1520">                offset = doc.getLength();</span>
            }
<span class="nc bnc" id="L1522" title="All 2 branches missed.">            if (offset  &lt; 0) {</span>
<span class="nc" id="L1523">                offset = 0;</span>
            }
<span class="nc" id="L1525">            return offset;</span>
        }

        /**
         * Returns adjustsed {@code y} position that indicates the location to scroll to
         * after selecting &lt;code&gt;index&lt;/code&gt;.
         */
        private int getAdjustedY(JTextComponent text, Rectangle visible, int index) {
<span class="nc" id="L1533">            int result = visible.y;</span>

            try {
<span class="nc" id="L1536">                Rectangle dotBounds = text.modelToView(index);</span>

<span class="nc bnc" id="L1538" title="All 2 branches missed.">                if (dotBounds.y &lt; visible.y) {</span>
<span class="nc" id="L1539">                    result = dotBounds.y;</span>
                } else {
<span class="nc bnc" id="L1541" title="All 4 branches missed.">                    if ((dotBounds.y &gt; visible.y + visible.height) ||</span>
                            (dotBounds.y + dotBounds.height &gt; visible.y + visible.height)) {
<span class="nc" id="L1543">                        result = dotBounds.y + dotBounds.height - visible.height;</span>
                    }
                }
<span class="nc" id="L1546">            } catch (BadLocationException ble) {</span>
<span class="nc" id="L1547">            }</span>

<span class="nc" id="L1549">            return result;</span>
        }

        /**
         * Adjusts the Rectangle to contain the bounds of the character at
         * &lt;code&gt;index&lt;/code&gt; in response to a page up.
         */
        private boolean select;

        /**
         * Direction to scroll, 1 is down, -1 is up.
         */
        private int direction;
    }


    /**
     * Pages one view to the left or right.
     */
    static class PageAction extends TextAction {

        /** Create this object with the appropriate identifier. */
        public PageAction(String nm, boolean left, boolean select) {
<span class="nc" id="L1572">            super(nm);</span>
<span class="nc" id="L1573">            this.select = select;</span>
<span class="nc" id="L1574">            this.left = left;</span>
<span class="nc" id="L1575">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1579">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1580" title="All 2 branches missed.">            if (target != null) {</span>
                int selectedIndex;
<span class="nc" id="L1582">                Rectangle visible = new Rectangle();</span>
<span class="nc" id="L1583">                target.computeVisibleRect(visible);</span>
<span class="nc bnc" id="L1584" title="All 2 branches missed.">                if (left) {</span>
<span class="nc" id="L1585">                    visible.x = Math.max(0, visible.x - visible.width);</span>
                }
                else {
<span class="nc" id="L1588">                    visible.x += visible.width;</span>
                }

<span class="nc" id="L1591">                selectedIndex = target.getCaretPosition();</span>
<span class="nc bnc" id="L1592" title="All 2 branches missed.">                if(selectedIndex != -1) {</span>
<span class="nc bnc" id="L1593" title="All 2 branches missed.">                    if (left) {</span>
<span class="nc" id="L1594">                        selectedIndex = target.viewToModel</span>
<span class="nc" id="L1595">                            (new Point(visible.x, visible.y));</span>
                    }
                    else {
<span class="nc" id="L1598">                        selectedIndex = target.viewToModel</span>
<span class="nc" id="L1599">                            (new Point(visible.x + visible.width - 1,</span>
                                       visible.y + visible.height - 1));
                    }
<span class="nc" id="L1602">                    Document doc = target.getDocument();</span>
<span class="nc bnc" id="L1603" title="All 2 branches missed.">                    if ((selectedIndex != 0) &amp;&amp;</span>
<span class="nc bnc" id="L1604" title="All 2 branches missed.">                        (selectedIndex  &gt; (doc.getLength()-1))) {</span>
<span class="nc" id="L1605">                        selectedIndex = doc.getLength()-1;</span>
                    }
<span class="nc bnc" id="L1607" title="All 2 branches missed.">                    else if(selectedIndex  &lt; 0) {</span>
<span class="nc" id="L1608">                        selectedIndex = 0;</span>
                    }
<span class="nc bnc" id="L1610" title="All 2 branches missed.">                    if (select)</span>
<span class="nc" id="L1611">                        target.moveCaretPosition(selectedIndex);</span>
                    else
<span class="nc" id="L1613">                        target.setCaretPosition(selectedIndex);</span>
                }
            }
<span class="nc" id="L1616">        }</span>

        private boolean select;
        private boolean left;
    }

    static class DumpModelAction extends TextAction {

        DumpModelAction() {
<span class="nc" id="L1625">            super(&quot;dump-model&quot;);</span>
<span class="nc" id="L1626">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1629">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1630" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1631">                Document d = target.getDocument();</span>
<span class="nc bnc" id="L1632" title="All 2 branches missed.">                if (d instanceof AbstractDocument) {</span>
<span class="nc" id="L1633">                    ((AbstractDocument) d).dump(System.err);</span>
                }
            }
<span class="nc" id="L1636">        }</span>
    }

    /*
     * Action to move the selection by way of the
     * getNextVisualPositionFrom method. Constructor indicates direction
     * to use.
     */
    static class NextVisualPositionAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        NextVisualPositionAction(String nm, boolean select, int direction) {
<span class="nc" id="L1653">            super(nm);</span>
<span class="nc" id="L1654">            this.select = select;</span>
<span class="nc" id="L1655">            this.direction = direction;</span>
<span class="nc" id="L1656">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1660">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1661" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1662">                Caret caret = target.getCaret();</span>
<span class="nc bnc" id="L1663" title="All 2 branches missed.">                DefaultCaret bidiCaret = (caret instanceof DefaultCaret) ?</span>
                                              (DefaultCaret)caret : null;
<span class="nc" id="L1665">                int dot = caret.getDot();</span>
<span class="nc" id="L1666">                Position.Bias[] bias = new Position.Bias[1];</span>
<span class="nc" id="L1667">                Point magicPosition = caret.getMagicCaretPosition();</span>

                try {
<span class="nc bnc" id="L1670" title="All 6 branches missed.">                    if(magicPosition == null &amp;&amp;</span>
                       (direction == SwingConstants.NORTH ||
                        direction == SwingConstants.SOUTH)) {
<span class="nc bnc" id="L1673" title="All 2 branches missed.">                        Rectangle r = (bidiCaret != null) ?</span>
<span class="nc" id="L1674">                                target.getUI().modelToView(target, dot,</span>
<span class="nc" id="L1675">                                                      bidiCaret.getDotBias()) :</span>
<span class="nc" id="L1676">                                target.modelToView(dot);</span>
<span class="nc" id="L1677">                        magicPosition = new Point(r.x, r.y);</span>
                    }

<span class="nc" id="L1680">                    NavigationFilter filter = target.getNavigationFilter();</span>

<span class="nc bnc" id="L1682" title="All 2 branches missed.">                    if (filter != null) {</span>
<span class="nc bnc" id="L1683" title="All 2 branches missed.">                        dot = filter.getNextVisualPositionFrom</span>
<span class="nc" id="L1684">                                     (target, dot, (bidiCaret != null) ?</span>
<span class="nc" id="L1685">                                      bidiCaret.getDotBias() :</span>
                                      Position.Bias.Forward, direction, bias);
                    }
                    else {
<span class="nc bnc" id="L1689" title="All 2 branches missed.">                        dot = target.getUI().getNextVisualPositionFrom</span>
<span class="nc" id="L1690">                                     (target, dot, (bidiCaret != null) ?</span>
<span class="nc" id="L1691">                                      bidiCaret.getDotBias() :</span>
                                      Position.Bias.Forward, direction, bias);
                    }
<span class="nc bnc" id="L1694" title="All 2 branches missed.">                    if(bias[0] == null) {</span>
<span class="nc" id="L1695">                        bias[0] = Position.Bias.Forward;</span>
                    }
<span class="nc bnc" id="L1697" title="All 2 branches missed.">                    if(bidiCaret != null) {</span>
<span class="nc bnc" id="L1698" title="All 2 branches missed.">                        if (select) {</span>
<span class="nc" id="L1699">                            bidiCaret.moveDot(dot, bias[0]);</span>
                        } else {
<span class="nc" id="L1701">                            bidiCaret.setDot(dot, bias[0]);</span>
                        }
                    }
                    else {
<span class="nc bnc" id="L1705" title="All 2 branches missed.">                        if (select) {</span>
<span class="nc" id="L1706">                            caret.moveDot(dot);</span>
                        } else {
<span class="nc" id="L1708">                            caret.setDot(dot);</span>
                        }
                    }
<span class="nc bnc" id="L1711" title="All 6 branches missed.">                    if(magicPosition != null &amp;&amp;</span>
                       (direction == SwingConstants.NORTH ||
                        direction == SwingConstants.SOUTH)) {
<span class="nc" id="L1714">                        target.getCaret().setMagicCaretPosition(magicPosition);</span>
                    }
<span class="nc" id="L1716">                } catch (BadLocationException ex) {</span>
<span class="nc" id="L1717">                }</span>
            }
<span class="nc" id="L1719">        }</span>

        private boolean select;
        private int direction;
    }

    /*
     * Position the caret to the beginning of the word.
     * @see DefaultEditorKit#beginWordAction
     * @see DefaultEditorKit#selectBeginWordAction
     * @see DefaultEditorKit#getActions
     */
    static class BeginWordAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        BeginWordAction(String nm, boolean select) {
<span class="nc" id="L1740">            super(nm);</span>
<span class="nc" id="L1741">            this.select = select;</span>
<span class="nc" id="L1742">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1746">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1747" title="All 2 branches missed.">            if (target != null) {</span>
                try {
<span class="nc" id="L1749">                    int offs = target.getCaretPosition();</span>
<span class="nc" id="L1750">                    int begOffs = Utilities.getWordStart(target, offs);</span>
<span class="nc bnc" id="L1751" title="All 2 branches missed.">                    if (select) {</span>
<span class="nc" id="L1752">                        target.moveCaretPosition(begOffs);</span>
                    } else {
<span class="nc" id="L1754">                        target.setCaretPosition(begOffs);</span>
                    }
<span class="nc" id="L1756">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L1757">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L1758">                }</span>
            }
<span class="nc" id="L1760">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the end of the word.
     * @see DefaultEditorKit#endWordAction
     * @see DefaultEditorKit#selectEndWordAction
     * @see DefaultEditorKit#getActions
     */
    static class EndWordAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        EndWordAction(String nm, boolean select) {
<span class="nc" id="L1780">            super(nm);</span>
<span class="nc" id="L1781">            this.select = select;</span>
<span class="nc" id="L1782">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1786">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1787" title="All 2 branches missed.">            if (target != null) {</span>
                try {
<span class="nc" id="L1789">                    int offs = target.getCaretPosition();</span>
<span class="nc" id="L1790">                    int endOffs = Utilities.getWordEnd(target, offs);</span>
<span class="nc bnc" id="L1791" title="All 2 branches missed.">                    if (select) {</span>
<span class="nc" id="L1792">                        target.moveCaretPosition(endOffs);</span>
                    } else {
<span class="nc" id="L1794">                        target.setCaretPosition(endOffs);</span>
                    }
<span class="nc" id="L1796">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L1797">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L1798">                }</span>
            }
<span class="nc" id="L1800">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the beginning of the previous word.
     * @see DefaultEditorKit#previousWordAction
     * @see DefaultEditorKit#selectPreviousWordAction
     * @see DefaultEditorKit#getActions
     */
    static class PreviousWordAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        PreviousWordAction(String nm, boolean select) {
<span class="nc" id="L1820">            super(nm);</span>
<span class="nc" id="L1821">            this.select = select;</span>
<span class="nc" id="L1822">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1826">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1827" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1828">                int offs = target.getCaretPosition();</span>
<span class="nc" id="L1829">                boolean failed = false;</span>
                try {
<span class="nc" id="L1831">                    Element curPara =</span>
<span class="nc" id="L1832">                            Utilities.getParagraphElement(target, offs);</span>
<span class="nc" id="L1833">                    offs = Utilities.getPreviousWord(target, offs);</span>
<span class="nc bnc" id="L1834" title="All 2 branches missed.">                    if(offs &lt; curPara.getStartOffset()) {</span>
                        // we should first move to the end of the
                        // previous paragraph (bug #4278839)
<span class="nc" id="L1837">                        offs = Utilities.getParagraphElement(target, offs).</span>
<span class="nc" id="L1838">                                getEndOffset() - 1;</span>
                    }
<span class="nc" id="L1840">                } catch (BadLocationException bl) {</span>
<span class="nc bnc" id="L1841" title="All 2 branches missed.">                    if (offs != 0) {</span>
<span class="nc" id="L1842">                        offs = 0;</span>
                    }
                    else {
<span class="nc" id="L1845">                        failed = true;</span>
                    }
<span class="nc" id="L1847">                }</span>
<span class="nc bnc" id="L1848" title="All 2 branches missed.">                if (!failed) {</span>
<span class="nc bnc" id="L1849" title="All 2 branches missed.">                    if (select) {</span>
<span class="nc" id="L1850">                        target.moveCaretPosition(offs);</span>
                    } else {
<span class="nc" id="L1852">                        target.setCaretPosition(offs);</span>
                    }
                }
                else {
<span class="nc" id="L1856">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
                }
            }
<span class="nc" id="L1859">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the next of the word.
     * @see DefaultEditorKit#nextWordAction
     * @see DefaultEditorKit#selectNextWordAction
     * @see DefaultEditorKit#getActions
     */
    static class NextWordAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        NextWordAction(String nm, boolean select) {
<span class="nc" id="L1879">            super(nm);</span>
<span class="nc" id="L1880">            this.select = select;</span>
<span class="nc" id="L1881">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1885">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1886" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L1887">                int offs = target.getCaretPosition();</span>
<span class="nc" id="L1888">                boolean failed = false;</span>
<span class="nc" id="L1889">                int oldOffs = offs;</span>
<span class="nc" id="L1890">                Element curPara =</span>
<span class="nc" id="L1891">                        Utilities.getParagraphElement(target, offs);</span>
                try {
<span class="nc" id="L1893">                    offs = Utilities.getNextWord(target, offs);</span>
<span class="nc bnc" id="L1894" title="All 2 branches missed.">                    if(offs &gt;= curPara.getEndOffset() &amp;&amp;</span>
<span class="nc bnc" id="L1895" title="All 2 branches missed.">                            oldOffs != curPara.getEndOffset() - 1) {</span>
                        // we should first move to the end of current
                        // paragraph (bug #4278839)
<span class="nc" id="L1898">                        offs = curPara.getEndOffset() - 1;</span>
                    }
<span class="nc" id="L1900">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L1901">                    int end = target.getDocument().getLength();</span>
<span class="nc bnc" id="L1902" title="All 2 branches missed.">                    if (offs != end) {</span>
<span class="nc bnc" id="L1903" title="All 2 branches missed.">                        if(oldOffs != curPara.getEndOffset() - 1) {</span>
<span class="nc" id="L1904">                            offs = curPara.getEndOffset() - 1;</span>
                        } else {
<span class="nc" id="L1906">                        offs = end;</span>
                    }
                    }
                    else {
<span class="nc" id="L1910">                        failed = true;</span>
                    }
<span class="nc" id="L1912">                }</span>
<span class="nc bnc" id="L1913" title="All 2 branches missed.">                if (!failed) {</span>
<span class="nc bnc" id="L1914" title="All 2 branches missed.">                    if (select) {</span>
<span class="nc" id="L1915">                        target.moveCaretPosition(offs);</span>
                    } else {
<span class="nc" id="L1917">                        target.setCaretPosition(offs);</span>
                    }
                }
                else {
<span class="nc" id="L1921">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
                }
            }
<span class="nc" id="L1924">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the beginning of the line.
     * @see DefaultEditorKit#beginLineAction
     * @see DefaultEditorKit#selectBeginLineAction
     * @see DefaultEditorKit#getActions
     */
    static class BeginLineAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        BeginLineAction(String nm, boolean select) {
<span class="nc" id="L1944">            super(nm);</span>
<span class="nc" id="L1945">            this.select = select;</span>
<span class="nc" id="L1946">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1950">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1951" title="All 2 branches missed.">            if (target != null) {</span>
                try {
<span class="nc" id="L1953">                    int offs = target.getCaretPosition();</span>
<span class="nc" id="L1954">                    int begOffs = Utilities.getRowStart(target, offs);</span>
<span class="nc bnc" id="L1955" title="All 2 branches missed.">                    if (select) {</span>
<span class="nc" id="L1956">                        target.moveCaretPosition(begOffs);</span>
                    } else {
<span class="nc" id="L1958">                        target.setCaretPosition(begOffs);</span>
                    }
<span class="nc" id="L1960">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L1961">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L1962">                }</span>
            }
<span class="nc" id="L1964">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the end of the line.
     * @see DefaultEditorKit#endLineAction
     * @see DefaultEditorKit#selectEndLineAction
     * @see DefaultEditorKit#getActions
     */
    static class EndLineAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        EndLineAction(String nm, boolean select) {
<span class="nc" id="L1984">            super(nm);</span>
<span class="nc" id="L1985">            this.select = select;</span>
<span class="nc" id="L1986">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L1990">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L1991" title="All 2 branches missed.">            if (target != null) {</span>
                try {
<span class="nc" id="L1993">                    int offs = target.getCaretPosition();</span>
<span class="nc" id="L1994">                    int endOffs = Utilities.getRowEnd(target, offs);</span>
<span class="nc bnc" id="L1995" title="All 2 branches missed.">                    if (select) {</span>
<span class="nc" id="L1996">                        target.moveCaretPosition(endOffs);</span>
                    } else {
<span class="nc" id="L1998">                        target.setCaretPosition(endOffs);</span>
                    }
<span class="nc" id="L2000">                } catch (BadLocationException bl) {</span>
<span class="nc" id="L2001">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L2002">                }</span>
            }
<span class="nc" id="L2004">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the beginning of the paragraph.
     * @see DefaultEditorKit#beginParagraphAction
     * @see DefaultEditorKit#selectBeginParagraphAction
     * @see DefaultEditorKit#getActions
     */
    static class BeginParagraphAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        BeginParagraphAction(String nm, boolean select) {
<span class="nc" id="L2024">            super(nm);</span>
<span class="nc" id="L2025">            this.select = select;</span>
<span class="nc" id="L2026">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2030">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2031" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L2032">                int offs = target.getCaretPosition();</span>
<span class="nc" id="L2033">                Element elem = Utilities.getParagraphElement(target, offs);</span>
<span class="nc" id="L2034">                offs = elem.getStartOffset();</span>
<span class="nc bnc" id="L2035" title="All 2 branches missed.">                if (select) {</span>
<span class="nc" id="L2036">                    target.moveCaretPosition(offs);</span>
                } else {
<span class="nc" id="L2038">                    target.setCaretPosition(offs);</span>
                }
            }
<span class="nc" id="L2041">        }</span>

        private boolean select;
    }

    /*
     * Position the caret to the end of the paragraph.
     * @see DefaultEditorKit#endParagraphAction
     * @see DefaultEditorKit#selectEndParagraphAction
     * @see DefaultEditorKit#getActions
     */
    static class EndParagraphAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        EndParagraphAction(String nm, boolean select) {
<span class="nc" id="L2061">            super(nm);</span>
<span class="nc" id="L2062">            this.select = select;</span>
<span class="nc" id="L2063">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2067">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2068" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L2069">                int offs = target.getCaretPosition();</span>
<span class="nc" id="L2070">                Element elem = Utilities.getParagraphElement(target, offs);</span>
<span class="nc" id="L2071">                offs = Math.min(target.getDocument().getLength(),</span>
<span class="nc" id="L2072">                                elem.getEndOffset());</span>
<span class="nc bnc" id="L2073" title="All 2 branches missed.">                if (select) {</span>
<span class="nc" id="L2074">                    target.moveCaretPosition(offs);</span>
                } else {
<span class="nc" id="L2076">                    target.setCaretPosition(offs);</span>
                }
            }
<span class="nc" id="L2079">        }</span>

        private boolean select;
    }

    /*
     * Move the caret to the beginning of the document.
     * @see DefaultEditorKit#beginAction
     * @see DefaultEditorKit#getActions
     */
    static class BeginAction extends TextAction {

        /* Create this object with the appropriate identifier. */
        BeginAction(String nm, boolean select) {
<span class="nc" id="L2093">            super(nm);</span>
<span class="nc" id="L2094">            this.select = select;</span>
<span class="nc" id="L2095">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2099">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2100" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc bnc" id="L2101" title="All 2 branches missed.">                if (select) {</span>
<span class="nc" id="L2102">                    target.moveCaretPosition(0);</span>
                } else {
<span class="nc" id="L2104">                    target.setCaretPosition(0);</span>
                }
            }
<span class="nc" id="L2107">        }</span>

        private boolean select;
    }

    /*
     * Move the caret to the end of the document.
     * @see DefaultEditorKit#endAction
     * @see DefaultEditorKit#getActions
     */
    static class EndAction extends TextAction {

        /* Create this object with the appropriate identifier. */
        EndAction(String nm, boolean select) {
<span class="nc" id="L2121">            super(nm);</span>
<span class="nc" id="L2122">            this.select = select;</span>
<span class="nc" id="L2123">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2127">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2128" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L2129">                Document doc = target.getDocument();</span>
<span class="nc" id="L2130">                int dot = doc.getLength();</span>
<span class="nc bnc" id="L2131" title="All 2 branches missed.">                if (select) {</span>
<span class="nc" id="L2132">                    target.moveCaretPosition(dot);</span>
                } else {
<span class="nc" id="L2134">                    target.setCaretPosition(dot);</span>
                }
            }
<span class="nc" id="L2137">        }</span>

        private boolean select;
    }

    /*
     * Select the word around the caret
     * @see DefaultEditorKit#endAction
     * @see DefaultEditorKit#getActions
     */
    static class SelectWordAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        SelectWordAction() {
<span class="nc" id="L2156">            super(selectWordAction);</span>
<span class="nc" id="L2157">            start = new BeginWordAction(&quot;pigdog&quot;, false);</span>
<span class="nc" id="L2158">            end = new EndWordAction(&quot;pigdog&quot;, true);</span>
<span class="nc" id="L2159">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2163">            start.actionPerformed(e);</span>
<span class="nc" id="L2164">            end.actionPerformed(e);</span>
<span class="nc" id="L2165">        }</span>

        private Action start;
        private Action end;
    }

    /*
     * Select the line around the caret
     * @see DefaultEditorKit#endAction
     * @see DefaultEditorKit#getActions
     */
    static class SelectLineAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        SelectLineAction() {
<span class="nc" id="L2185">            super(selectLineAction);</span>
<span class="nc" id="L2186">            start = new BeginLineAction(&quot;pigdog&quot;, false);</span>
<span class="nc" id="L2187">            end = new EndLineAction(&quot;pigdog&quot;, true);</span>
<span class="nc" id="L2188">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2192">            start.actionPerformed(e);</span>
<span class="nc" id="L2193">            end.actionPerformed(e);</span>
<span class="nc" id="L2194">        }</span>

        private Action start;
        private Action end;
    }

    /*
     * Select the paragraph around the caret
     * @see DefaultEditorKit#endAction
     * @see DefaultEditorKit#getActions
     */
    static class SelectParagraphAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        SelectParagraphAction() {
<span class="nc" id="L2214">            super(selectParagraphAction);</span>
<span class="nc" id="L2215">            start = new BeginParagraphAction(&quot;pigdog&quot;, false);</span>
<span class="nc" id="L2216">            end = new EndParagraphAction(&quot;pigdog&quot;, true);</span>
<span class="nc" id="L2217">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2221">            start.actionPerformed(e);</span>
<span class="nc" id="L2222">            end.actionPerformed(e);</span>
<span class="nc" id="L2223">        }</span>

        private Action start;
        private Action end;
    }

    /*
     * Select the entire document
     * @see DefaultEditorKit#endAction
     * @see DefaultEditorKit#getActions
     */
    static class SelectAllAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         * @param nm  the name of the action, Action.NAME.
         * @param select whether to extend the selection when
         *  changing the caret position.
         */
        SelectAllAction() {
<span class="nc" id="L2243">            super(selectAllAction);</span>
<span class="nc" id="L2244">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2248">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2249" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L2250">                Document doc = target.getDocument();</span>
<span class="nc" id="L2251">                target.setCaretPosition(0);</span>
<span class="nc" id="L2252">                target.moveCaretPosition(doc.getLength());</span>
            }
<span class="nc" id="L2254">        }</span>

    }

    /*
     * Remove the selection, if any.
     * @see DefaultEditorKit#unselectAction
     * @see DefaultEditorKit#getActions
     */
    static class UnselectAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         */
        UnselectAction() {
<span class="nc" id="L2269">            super(unselectAction);</span>
<span class="nc" id="L2270">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2274">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2275" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L2276">                target.setCaretPosition(target.getCaretPosition());</span>
            }
<span class="nc" id="L2278">        }</span>

    }

    /*
     * Toggles the ComponentOrientation of the text component.
     * @see DefaultEditorKit#toggleComponentOrientationAction
     * @see DefaultEditorKit#getActions
     */
    static class ToggleComponentOrientationAction extends TextAction {

        /**
         * Create this action with the appropriate identifier.
         */
        ToggleComponentOrientationAction() {
<span class="nc" id="L2293">            super(toggleComponentOrientationAction);</span>
<span class="nc" id="L2294">        }</span>

        /** The operation to perform when this action is triggered. */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L2298">            JTextComponent target = getTextComponent(e);</span>
<span class="nc bnc" id="L2299" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc" id="L2300">                ComponentOrientation last = target.getComponentOrientation();</span>
                ComponentOrientation next;
<span class="nc bnc" id="L2302" title="All 2 branches missed.">                if( last == ComponentOrientation.RIGHT_TO_LEFT )</span>
<span class="nc" id="L2303">                    next = ComponentOrientation.LEFT_TO_RIGHT;</span>
                else
<span class="nc" id="L2305">                    next = ComponentOrientation.RIGHT_TO_LEFT;</span>
<span class="nc" id="L2306">                target.setComponentOrientation(next);</span>
<span class="nc" id="L2307">                target.repaint();</span>
            }
<span class="nc" id="L2309">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>