<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GlyphPainter1.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.text</a> &gt; <span class="el_source">GlyphPainter1.java</span></div><h1>GlyphPainter1.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1999, 2006, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.text;

import java.awt.*;

/**
 * A class to perform rendering of the glyphs.
 * This can be implemented to be stateless, or
 * to hold some information as a cache to
 * facilitate faster rendering and model/view
 * translation.  At a minimum, the GlyphPainter
 * allows a View implementation to perform its
 * duties independent of a particular version
 * of JVM and selection of capabilities (i.e.
 * shaping for i18n, etc).
 * &lt;p&gt;
 * This implementation is intended for operation
 * under the JDK1.1 API of the Java Platform.
 * Since the JDK is backward compatible with
 * JDK1.1 API, this class will also function on
 * Java 2.  The JDK introduces improved
 * API for rendering text however, so the GlyphPainter2
 * is recommended for the DK.
 *
 * @author  Timothy Prinzing
 * @see GlyphView
 */
<span class="nc" id="L51">class GlyphPainter1 extends GlyphView.GlyphPainter {</span>

    /**
     * Determine the span the glyphs given a start location
     * (for tab expansion).
     */
    public float getSpan(GlyphView v, int p0, int p1,
                         TabExpander e, float x) {
<span class="nc" id="L59">        sync(v);</span>
<span class="nc" id="L60">        Segment text = v.getText(p0, p1);</span>
<span class="nc" id="L61">        int[] justificationData = getJustificationData(v);</span>
<span class="nc" id="L62">        int width = Utilities.getTabbedTextWidth(v, text, metrics, (int) x, e, p0,</span>
                                                 justificationData);
<span class="nc" id="L64">        SegmentCache.releaseSharedSegment(text);</span>
<span class="nc" id="L65">        return width;</span>
    }

    public float getHeight(GlyphView v) {
<span class="nc" id="L69">        sync(v);</span>
<span class="nc" id="L70">        return metrics.getHeight();</span>
    }

    /**
     * Fetches the ascent above the baseline for the glyphs
     * corresponding to the given range in the model.
     */
    public float getAscent(GlyphView v) {
<span class="nc" id="L78">        sync(v);</span>
<span class="nc" id="L79">        return metrics.getAscent();</span>
    }

    /**
     * Fetches the descent below the baseline for the glyphs
     * corresponding to the given range in the model.
     */
    public float getDescent(GlyphView v) {
<span class="nc" id="L87">        sync(v);</span>
<span class="nc" id="L88">        return metrics.getDescent();</span>
    }

    /**
     * Paints the glyphs representing the given range.
     */
    public void paint(GlyphView v, Graphics g, Shape a, int p0, int p1) {
<span class="nc" id="L95">        sync(v);</span>
        Segment text;
<span class="nc" id="L97">        TabExpander expander = v.getTabExpander();</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">        Rectangle alloc = (a instanceof Rectangle) ? (Rectangle)a : a.getBounds();</span>

        // determine the x coordinate to render the glyphs
<span class="nc" id="L101">        int x = alloc.x;</span>
<span class="nc" id="L102">        int p = v.getStartOffset();</span>
<span class="nc" id="L103">        int[] justificationData = getJustificationData(v);</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (p != p0) {</span>
<span class="nc" id="L105">            text = v.getText(p, p0);</span>
<span class="nc" id="L106">            int width = Utilities.getTabbedTextWidth(v, text, metrics, x, expander, p,</span>
                                                     justificationData);
<span class="nc" id="L108">            x += width;</span>
<span class="nc" id="L109">            SegmentCache.releaseSharedSegment(text);</span>
        }

        // determine the y coordinate to render the glyphs
<span class="nc" id="L113">        int y = alloc.y + metrics.getHeight() - metrics.getDescent();</span>

        // render the glyphs
<span class="nc" id="L116">        text = v.getText(p0, p1);</span>
<span class="nc" id="L117">        g.setFont(metrics.getFont());</span>

<span class="nc" id="L119">        Utilities.drawTabbedText(v, text, x, y, g, expander,p0,</span>
                                 justificationData);
<span class="nc" id="L121">        SegmentCache.releaseSharedSegment(text);</span>
<span class="nc" id="L122">    }</span>

    public Shape modelToView(GlyphView v, int pos, Position.Bias bias,
                             Shape a) throws BadLocationException {

<span class="nc" id="L127">        sync(v);</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">        Rectangle alloc = (a instanceof Rectangle) ? (Rectangle)a : a.getBounds();</span>
<span class="nc" id="L129">        int p0 = v.getStartOffset();</span>
<span class="nc" id="L130">        int p1 = v.getEndOffset();</span>
<span class="nc" id="L131">        TabExpander expander = v.getTabExpander();</span>
        Segment text;

<span class="nc bnc" id="L134" title="All 2 branches missed.">        if(pos == p1) {</span>
            // The caller of this is left to right and borders a right to
            // left view, return our end location.
<span class="nc" id="L137">            return new Rectangle(alloc.x + alloc.width, alloc.y, 0,</span>
<span class="nc" id="L138">                                 metrics.getHeight());</span>
        }
<span class="nc bnc" id="L140" title="All 4 branches missed.">        if ((pos &gt;= p0) &amp;&amp; (pos &lt;= p1)) {</span>
            // determine range to the left of the position
<span class="nc" id="L142">            text = v.getText(p0, pos);</span>
<span class="nc" id="L143">            int[] justificationData = getJustificationData(v);</span>
<span class="nc" id="L144">            int width = Utilities.getTabbedTextWidth(v, text, metrics, alloc.x, expander, p0,</span>
                                                     justificationData);
<span class="nc" id="L146">            SegmentCache.releaseSharedSegment(text);</span>
<span class="nc" id="L147">            return new Rectangle(alloc.x + width, alloc.y, 0, metrics.getHeight());</span>
        }
<span class="nc" id="L149">        throw new BadLocationException(&quot;modelToView - can't convert&quot;, p1);</span>
    }

    /**
     * Provides a mapping from the view coordinate space to the logical
     * coordinate space of the model.
     *
     * @param v the view containing the view coordinates
     * @param x the X coordinate
     * @param y the Y coordinate
     * @param a the allocated region to render into
     * @param biasReturn always returns &lt;code&gt;Position.Bias.Forward&lt;/code&gt;
     *   as the zero-th element of this array
     * @return the location within the model that best represents the
     *  given point in the view
     * @see View#viewToModel
     */
    public int viewToModel(GlyphView v, float x, float y, Shape a,
                           Position.Bias[] biasReturn) {

<span class="nc" id="L169">        sync(v);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">        Rectangle alloc = (a instanceof Rectangle) ? (Rectangle)a : a.getBounds();</span>
<span class="nc" id="L171">        int p0 = v.getStartOffset();</span>
<span class="nc" id="L172">        int p1 = v.getEndOffset();</span>
<span class="nc" id="L173">        TabExpander expander = v.getTabExpander();</span>
<span class="nc" id="L174">        Segment text = v.getText(p0, p1);</span>
<span class="nc" id="L175">        int[] justificationData = getJustificationData(v);</span>
<span class="nc" id="L176">        int offs = Utilities.getTabbedTextOffset(v, text, metrics,</span>
                                                 alloc.x, (int) x, expander, p0,
                                                 justificationData);
<span class="nc" id="L179">        SegmentCache.releaseSharedSegment(text);</span>
<span class="nc" id="L180">        int retValue = p0 + offs;</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if(retValue == p1) {</span>
            // No need to return backward bias as GlyphPainter1 is used for
            // ltr text only.
<span class="nc" id="L184">            retValue--;</span>
        }
<span class="nc" id="L186">        biasReturn[0] = Position.Bias.Forward;</span>
<span class="nc" id="L187">        return retValue;</span>
    }

    /**
     * Determines the best location (in the model) to break
     * the given view.
     * This method attempts to break on a whitespace
     * location.  If a whitespace location can't be found, the
     * nearest character location is returned.
     *
     * @param v the view
     * @param p0 the location in the model where the
     *  fragment should start its representation &gt;= 0
     * @param pos the graphic location along the axis that the
     *  broken view would occupy &gt;= 0; this may be useful for
     *  things like tab calculations
     * @param len specifies the distance into the view
     *  where a potential break is desired &gt;= 0
     * @return the model location desired for a break
     * @see View#breakView
     */
    public int getBoundedPosition(GlyphView v, int p0, float x, float len) {
<span class="nc" id="L209">        sync(v);</span>
<span class="nc" id="L210">        TabExpander expander = v.getTabExpander();</span>
<span class="nc" id="L211">        Segment s = v.getText(p0, v.getEndOffset());</span>
<span class="nc" id="L212">        int[] justificationData = getJustificationData(v);</span>
<span class="nc" id="L213">        int index = Utilities.getTabbedTextOffset(v, s, metrics, (int)x, (int)(x+len),</span>
                                                  expander, p0, false,
                                                  justificationData);
<span class="nc" id="L216">        SegmentCache.releaseSharedSegment(s);</span>
<span class="nc" id="L217">        int p1 = p0 + index;</span>
<span class="nc" id="L218">        return p1;</span>
    }

    void sync(GlyphView v) {
<span class="nc" id="L222">        Font f = v.getFont();</span>
<span class="nc bnc" id="L223" title="All 4 branches missed.">        if ((metrics == null) || (! f.equals(metrics.getFont()))) {</span>
            // fetch a new FontMetrics
<span class="nc" id="L225">            Container c = v.getContainer();</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">            metrics = (c != null) ? c.getFontMetrics(f) :</span>
<span class="nc" id="L227">                Toolkit.getDefaultToolkit().getFontMetrics(f);</span>
        }
<span class="nc" id="L229">    }</span>



    /**
     * @return justificationData from the ParagraphRow this GlyphView
     * is in or {@code null} if no justification is needed
     */
    private int[] getJustificationData(GlyphView v) {
<span class="nc" id="L238">        View parent = v.getParent();</span>
<span class="nc" id="L239">        int [] ret = null;</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (parent instanceof ParagraphView.Row) {</span>
<span class="nc" id="L241">            ParagraphView.Row row = ((ParagraphView.Row) parent);</span>
<span class="nc" id="L242">            ret = row.justificationData;</span>
        }
<span class="nc" id="L244">        return ret;</span>
    }

    // --- variables ---------------------------------------------

    FontMetrics metrics;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>