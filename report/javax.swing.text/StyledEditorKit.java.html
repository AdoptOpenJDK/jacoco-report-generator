<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>StyledEditorKit.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Foo</a> &gt; <a href="index.html" class="el_package">javax.swing.text</a> &gt; <span class="el_source">StyledEditorKit.java</span></div><h1>StyledEditorKit.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 1997, 2004, Oracle and/or its affiliates. All rights reserved.
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 only, as
 * published by the Free Software Foundation.  Oracle designates this
 * particular file as subject to the &quot;Classpath&quot; exception as provided
 * by Oracle in the LICENSE file that accompanied this code.
 *
 * This code is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 * version 2 for more details (a copy is included in the LICENSE file that
 * accompanied this code).
 *
 * You should have received a copy of the GNU General Public License version
 * 2 along with this work; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 *
 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 * or visit www.oracle.com if you need additional information or have any
 * questions.
 */
package javax.swing.text;

import java.io.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import javax.swing.event.*;
import javax.swing.Action;
import javax.swing.JEditorPane;
import javax.swing.KeyStroke;
import javax.swing.UIManager;

/**
 * This is the set of things needed by a text component
 * to be a reasonably functioning editor for some &lt;em&gt;type&lt;/em&gt;
 * of text document.  This implementation provides a default
 * implementation which treats text as styled text and
 * provides a minimal set of actions for editing styled text.
 *
 * @author  Timothy Prinzing
 */
public class StyledEditorKit extends DefaultEditorKit {

    /**
     * Creates a new EditorKit used for styled documents.
     */
<span class="nc" id="L52">    public StyledEditorKit() {</span>
<span class="nc" id="L53">        createInputAttributeUpdated();</span>
<span class="nc" id="L54">        createInputAttributes();</span>
<span class="nc" id="L55">    }</span>

    /**
     * Gets the input attributes for the pane.  When
     * the caret moves and there is no selection, the
     * input attributes are automatically mutated to
     * reflect the character attributes of the current
     * caret location.  The styled editing actions
     * use the input attributes to carry out their
     * actions.
     *
     * @return the attribute set
     */
    public MutableAttributeSet getInputAttributes() {
<span class="nc" id="L69">        return inputAttributes;</span>
    }

    /**
     * Fetches the element representing the current
     * run of character attributes for the caret.
     *
     * @return the element
     */
    public Element getCharacterAttributeRun() {
<span class="nc" id="L79">        return currentRun;</span>
    }

    // --- EditorKit methods ---------------------------

    /**
     * Fetches the command list for the editor.  This is
     * the list of commands supported by the superclass
     * augmented by the collection of commands defined
     * locally for style operations.
     *
     * @return the command list
     */
    public Action[] getActions() {
<span class="nc" id="L93">        return TextAction.augmentList(super.getActions(), this.defaultActions);</span>
    }

    /**
     * Creates an uninitialized text storage model
     * that is appropriate for this type of editor.
     *
     * @return the model
     */
    public Document createDefaultDocument() {
<span class="nc" id="L103">        return new DefaultStyledDocument();</span>
    }

    /**
     * Called when the kit is being installed into
     * a JEditorPane.
     *
     * @param c the JEditorPane
     */
    public void install(JEditorPane c) {
<span class="nc" id="L113">        c.addCaretListener(inputAttributeUpdater);</span>
<span class="nc" id="L114">        c.addPropertyChangeListener(inputAttributeUpdater);</span>
<span class="nc" id="L115">        Caret caret = c.getCaret();</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">        if (caret != null) {</span>
<span class="nc" id="L117">            inputAttributeUpdater.updateInputAttributes</span>
<span class="nc" id="L118">                                  (caret.getDot(), caret.getMark(), c);</span>
        }
<span class="nc" id="L120">    }</span>

    /**
     * Called when the kit is being removed from the
     * JEditorPane.  This is used to unregister any
     * listeners that were attached.
     *
     * @param c the JEditorPane
     */
    public void deinstall(JEditorPane c) {
<span class="nc" id="L130">        c.removeCaretListener(inputAttributeUpdater);</span>
<span class="nc" id="L131">        c.removePropertyChangeListener(inputAttributeUpdater);</span>

        // remove references to current document so it can be collected.
<span class="nc" id="L134">        currentRun = null;</span>
<span class="nc" id="L135">        currentParagraph = null;</span>
<span class="nc" id="L136">    }</span>

   /**
     * Fetches a factory that is suitable for producing
     * views of any models that are produced by this
     * kit.  This is implemented to return View implementations
     * for the following kinds of elements:
     * &lt;ul&gt;
     * &lt;li&gt;AbstractDocument.ContentElementName
     * &lt;li&gt;AbstractDocument.ParagraphElementName
     * &lt;li&gt;AbstractDocument.SectionElementName
     * &lt;li&gt;StyleConstants.ComponentElementName
     * &lt;li&gt;StyleConstants.IconElementName
     * &lt;/ul&gt;
     *
     * @return the factory
     */
    public ViewFactory getViewFactory() {
<span class="nc" id="L154">        return defaultFactory;</span>
    }

    /**
     * Creates a copy of the editor kit.
     *
     * @return the copy
     */
    public Object clone() {
<span class="nc" id="L163">        StyledEditorKit o = (StyledEditorKit)super.clone();</span>
<span class="nc" id="L164">        o.currentRun = o.currentParagraph = null;</span>
<span class="nc" id="L165">        o.createInputAttributeUpdated();</span>
<span class="nc" id="L166">        o.createInputAttributes();</span>
<span class="nc" id="L167">        return o;</span>
    }

    /**
     * Creates the AttributeSet used for the selection.
     */
    private void createInputAttributes() {
<span class="nc" id="L174">        inputAttributes = new SimpleAttributeSet() {</span>
            public AttributeSet getResolveParent() {
<span class="nc bnc" id="L176" title="All 2 branches missed.">                return (currentParagraph != null) ?</span>
<span class="nc" id="L177">                           currentParagraph.getAttributes() : null;</span>
            }

            public Object clone() {
<span class="nc" id="L181">                return new SimpleAttributeSet(this);</span>
            }
        };
<span class="nc" id="L184">    }</span>

    /**
     * Creates a new &lt;code&gt;AttributeTracker&lt;/code&gt;.
     */
    private void createInputAttributeUpdated() {
<span class="nc" id="L190">        inputAttributeUpdater = new AttributeTracker();</span>
<span class="nc" id="L191">    }</span>


<span class="nc" id="L194">    private static final ViewFactory defaultFactory = new StyledViewFactory();</span>

    Element currentRun;
    Element currentParagraph;

    /**
     * This is the set of attributes used to store the
     * input attributes.
     */
    MutableAttributeSet inputAttributes;

    /**
     * This listener will be attached to the caret of
     * the text component that the EditorKit gets installed
     * into.  This should keep the input attributes updated
     * for use by the styled actions.
     */
    private AttributeTracker inputAttributeUpdater;

    /**
     * Tracks caret movement and keeps the input attributes set
     * to reflect the current set of attribute definitions at the
     * caret position.
     * &lt;p&gt;This implements PropertyChangeListener to update the
     * input attributes when the Document changes, as if the Document
     * changes the attributes will almost certainly change.
     */
<span class="nc" id="L221">    class AttributeTracker implements CaretListener, PropertyChangeListener, Serializable {</span>

        /**
         * Updates the attributes. &lt;code&gt;dot&lt;/code&gt; and &lt;code&gt;mark&lt;/code&gt;
         * mark give the positions of the selection in &lt;code&gt;c&lt;/code&gt;.
         */
        void updateInputAttributes(int dot, int mark, JTextComponent c) {
            // EditorKit might not have installed the StyledDocument yet.
<span class="nc" id="L229">            Document aDoc = c.getDocument();</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">            if (!(aDoc instanceof StyledDocument)) {</span>
<span class="nc" id="L231">                return ;</span>
            }
<span class="nc" id="L233">            int start = Math.min(dot, mark);</span>
            // record current character attributes.
<span class="nc" id="L235">            StyledDocument doc = (StyledDocument)aDoc;</span>
            // If nothing is selected, get the attributes from the character
            // before the start of the selection, otherwise get the attributes
            // from the character element at the start of the selection.
            Element run;
<span class="nc" id="L240">            currentParagraph = doc.getParagraphElement(start);</span>
<span class="nc bnc" id="L241" title="All 4 branches missed.">            if (currentParagraph.getStartOffset() == start || dot != mark) {</span>
                // Get the attributes from the character at the selection
                // if in a different paragrah!
<span class="nc" id="L244">                run = doc.getCharacterElement(start);</span>
            }
            else {
<span class="nc" id="L247">                run = doc.getCharacterElement(Math.max(start-1, 0));</span>
            }
<span class="nc bnc" id="L249" title="All 2 branches missed.">            if (run != currentRun) {</span>
                    /*
                     * PENDING(prinz) All attributes that represent a single
                     * glyph position and can't be inserted into should be
                     * removed from the input attributes... this requires
                     * mixing in an interface to indicate that condition.
                     * When we can add things again this logic needs to be
                     * improved!!
                     */
<span class="nc" id="L258">                currentRun = run;</span>
<span class="nc" id="L259">                createInputAttributes(currentRun, getInputAttributes());</span>
            }
<span class="nc" id="L261">        }</span>

        public void propertyChange(PropertyChangeEvent evt) {
<span class="nc" id="L264">            Object newValue = evt.getNewValue();</span>
<span class="nc" id="L265">            Object source = evt.getSource();</span>

<span class="nc bnc" id="L267" title="All 4 branches missed.">            if ((source instanceof JTextComponent) &amp;&amp;</span>
                (newValue instanceof Document)) {
                // New document will have changed selection to 0,0.
<span class="nc" id="L270">                updateInputAttributes(0, 0, (JTextComponent)source);</span>
            }
<span class="nc" id="L272">        }</span>

        public void caretUpdate(CaretEvent e) {
<span class="nc" id="L275">            updateInputAttributes(e.getDot(), e.getMark(),</span>
<span class="nc" id="L276">                                  (JTextComponent)e.getSource());</span>
<span class="nc" id="L277">        }</span>
    }

    /**
     * Copies the key/values in &lt;code&gt;element&lt;/code&gt;s AttributeSet into
     * &lt;code&gt;set&lt;/code&gt;. This does not copy component, icon, or element
     * names attributes. Subclasses may wish to refine what is and what
     * isn't copied here. But be sure to first remove all the attributes that
     * are in &lt;code&gt;set&lt;/code&gt;.&lt;p&gt;
     * This is called anytime the caret moves over a different location.
     *
     */
    protected void createInputAttributes(Element element,
                                         MutableAttributeSet set) {
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (element.getAttributes().getAttributeCount() &gt; 0</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">            || element.getEndOffset() - element.getStartOffset() &gt; 1</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">            || element.getEndOffset() &lt; element.getDocument().getLength()) {</span>
<span class="nc" id="L294">            set.removeAttributes(set);</span>
<span class="nc" id="L295">            set.addAttributes(element.getAttributes());</span>
<span class="nc" id="L296">            set.removeAttribute(StyleConstants.ComponentAttribute);</span>
<span class="nc" id="L297">            set.removeAttribute(StyleConstants.IconAttribute);</span>
<span class="nc" id="L298">            set.removeAttribute(AbstractDocument.ElementNameAttribute);</span>
<span class="nc" id="L299">            set.removeAttribute(StyleConstants.ComposedTextAttribute);</span>
        }
<span class="nc" id="L301">    }</span>

    // ---- default ViewFactory implementation ---------------------

<span class="nc" id="L305">    static class StyledViewFactory implements ViewFactory {</span>

        public View create(Element elem) {
<span class="nc" id="L308">            String kind = elem.getName();</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">            if (kind != null) {</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">                if (kind.equals(AbstractDocument.ContentElementName)) {</span>
<span class="nc" id="L311">                    return new LabelView(elem);</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">                } else if (kind.equals(AbstractDocument.ParagraphElementName)) {</span>
<span class="nc" id="L313">                    return new ParagraphView(elem);</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                } else if (kind.equals(AbstractDocument.SectionElementName)) {</span>
<span class="nc" id="L315">                    return new BoxView(elem, View.Y_AXIS);</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                } else if (kind.equals(StyleConstants.ComponentElementName)) {</span>
<span class="nc" id="L317">                    return new ComponentView(elem);</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">                } else if (kind.equals(StyleConstants.IconElementName)) {</span>
<span class="nc" id="L319">                    return new IconView(elem);</span>
                }
            }

            // default to text display
<span class="nc" id="L324">            return new LabelView(elem);</span>
        }

    }

    // --- Action implementations ---------------------------------

<span class="nc" id="L331">    private static final Action[] defaultActions = {</span>
        new FontFamilyAction(&quot;font-family-SansSerif&quot;, &quot;SansSerif&quot;),
        new FontFamilyAction(&quot;font-family-Monospaced&quot;, &quot;Monospaced&quot;),
        new FontFamilyAction(&quot;font-family-Serif&quot;, &quot;Serif&quot;),
        new FontSizeAction(&quot;font-size-8&quot;, 8),
        new FontSizeAction(&quot;font-size-10&quot;, 10),
        new FontSizeAction(&quot;font-size-12&quot;, 12),
        new FontSizeAction(&quot;font-size-14&quot;, 14),
        new FontSizeAction(&quot;font-size-16&quot;, 16),
        new FontSizeAction(&quot;font-size-18&quot;, 18),
        new FontSizeAction(&quot;font-size-24&quot;, 24),
        new FontSizeAction(&quot;font-size-36&quot;, 36),
        new FontSizeAction(&quot;font-size-48&quot;, 48),
        new AlignmentAction(&quot;left-justify&quot;, StyleConstants.ALIGN_LEFT),
        new AlignmentAction(&quot;center-justify&quot;, StyleConstants.ALIGN_CENTER),
        new AlignmentAction(&quot;right-justify&quot;, StyleConstants.ALIGN_RIGHT),
        new BoldAction(),
        new ItalicAction(),
        new StyledInsertBreakAction(),
        new UnderlineAction()
    };

    /**
     * An action that assumes it's being fired on a JEditorPane
     * with a StyledEditorKit (or subclass) installed.  This has
     * some convenience methods for causing character or paragraph
     * level attribute changes.  The convenience methods will
     * throw an IllegalArgumentException if the assumption of
     * a StyledDocument, a JEditorPane, or a StyledEditorKit
     * fail to be true.
     * &lt;p&gt;
     * The component that gets acted upon by the action
     * will be the source of the ActionEvent if the source
     * can be narrowed to a JEditorPane type.  If the source
     * can't be narrowed, the most recently focused text
     * component is changed.  If neither of these are the
     * case, the action cannot be performed.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public abstract static class StyledTextAction extends TextAction {

        /**
         * Creates a new StyledTextAction from a string action name.
         *
         * @param nm the name of the action
         */
        public StyledTextAction(String nm) {
<span class="nc" id="L386">            super(nm);</span>
<span class="nc" id="L387">        }</span>

        /**
         * Gets the target editor for an action.
         *
         * @param e the action event
         * @return the editor
         */
        protected final JEditorPane getEditor(ActionEvent e) {
<span class="nc" id="L396">            JTextComponent tcomp = getTextComponent(e);</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">            if (tcomp instanceof JEditorPane) {</span>
<span class="nc" id="L398">                return (JEditorPane) tcomp;</span>
            }
<span class="nc" id="L400">            return null;</span>
        }

        /**
         * Gets the document associated with an editor pane.
         *
         * @param e the editor
         * @return the document
         * @exception IllegalArgumentException for the wrong document type
         */
        protected final StyledDocument getStyledDocument(JEditorPane e) {
<span class="nc" id="L411">            Document d = e.getDocument();</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">            if (d instanceof StyledDocument) {</span>
<span class="nc" id="L413">                return (StyledDocument) d;</span>
            }
<span class="nc" id="L415">            throw new IllegalArgumentException(&quot;document must be StyledDocument&quot;);</span>
        }

        /**
         * Gets the editor kit associated with an editor pane.
         *
         * @param e the editor pane
         * @return the kit
         * @exception IllegalArgumentException for the wrong document type
         */
        protected final StyledEditorKit getStyledEditorKit(JEditorPane e) {
<span class="nc" id="L426">            EditorKit k = e.getEditorKit();</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (k instanceof StyledEditorKit) {</span>
<span class="nc" id="L428">                return (StyledEditorKit) k;</span>
            }
<span class="nc" id="L430">            throw new IllegalArgumentException(&quot;EditorKit must be StyledEditorKit&quot;);</span>
        }

        /**
         * Applies the given attributes to character
         * content.  If there is a selection, the attributes
         * are applied to the selection range.  If there
         * is no selection, the attributes are applied to
         * the input attribute set which defines the attributes
         * for any new text that gets inserted.
         *
         * @param editor the editor
         * @param attr the attributes
         * @param replace   if true, then replace the existing attributes first
         */
        protected final void setCharacterAttributes(JEditorPane editor,
                                              AttributeSet attr, boolean replace) {
<span class="nc" id="L447">            int p0 = editor.getSelectionStart();</span>
<span class="nc" id="L448">            int p1 = editor.getSelectionEnd();</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">            if (p0 != p1) {</span>
<span class="nc" id="L450">                StyledDocument doc = getStyledDocument(editor);</span>
<span class="nc" id="L451">                doc.setCharacterAttributes(p0, p1 - p0, attr, replace);</span>
            }
<span class="nc" id="L453">            StyledEditorKit k = getStyledEditorKit(editor);</span>
<span class="nc" id="L454">            MutableAttributeSet inputAttributes = k.getInputAttributes();</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">            if (replace) {</span>
<span class="nc" id="L456">                inputAttributes.removeAttributes(inputAttributes);</span>
            }
<span class="nc" id="L458">            inputAttributes.addAttributes(attr);</span>
<span class="nc" id="L459">        }</span>

        /**
         * Applies the given attributes to paragraphs.  If
         * there is a selection, the attributes are applied
         * to the paragraphs that intersect the selection.
         * if there is no selection, the attributes are applied
         * to the paragraph at the current caret position.
         *
         * @param editor the editor
         * @param attr the attributes
         * @param replace   if true, replace the existing attributes first
         */
        protected final void setParagraphAttributes(JEditorPane editor,
                                           AttributeSet attr, boolean replace) {
<span class="nc" id="L474">            int p0 = editor.getSelectionStart();</span>
<span class="nc" id="L475">            int p1 = editor.getSelectionEnd();</span>
<span class="nc" id="L476">            StyledDocument doc = getStyledDocument(editor);</span>
<span class="nc" id="L477">            doc.setParagraphAttributes(p0, p1 - p0, attr, replace);</span>
<span class="nc" id="L478">        }</span>

    }

    /**
     * An action to set the font family in the associated
     * JEditorPane.  This will use the family specified as
     * the command string on the ActionEvent if there is one,
     * otherwise the family that was initialized with will be used.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class FontFamilyAction extends StyledTextAction {

        /**
         * Creates a new FontFamilyAction.
         *
         * @param nm the action name
         * @param family the font family
         */
        public FontFamilyAction(String nm, String family) {
<span class="nc" id="L506">            super(nm);</span>
<span class="nc" id="L507">            this.family = family;</span>
<span class="nc" id="L508">        }</span>

        /**
         * Sets the font family.
         *
         * @param e the event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L516">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L518">                String family = this.family;</span>
<span class="nc bnc" id="L519" title="All 4 branches missed.">                if ((e != null) &amp;&amp; (e.getSource() == editor)) {</span>
<span class="nc" id="L520">                    String s = e.getActionCommand();</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">                    if (s != null) {</span>
<span class="nc" id="L522">                        family = s;</span>
                    }
                }
<span class="nc bnc" id="L525" title="All 2 branches missed.">                if (family != null) {</span>
<span class="nc" id="L526">                    MutableAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L527">                    StyleConstants.setFontFamily(attr, family);</span>
<span class="nc" id="L528">                    setCharacterAttributes(editor, attr, false);</span>
<span class="nc" id="L529">                } else {</span>
<span class="nc" id="L530">                    UIManager.getLookAndFeel().provideErrorFeedback(editor);</span>
                }
            }
<span class="nc" id="L533">        }</span>

        private String family;
    }

    /**
     * An action to set the font size in the associated
     * JEditorPane.  This will use the size specified as
     * the command string on the ActionEvent if there is one,
     * otherwise the size that was initialized with will be used.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class FontSizeAction extends StyledTextAction {

        /**
         * Creates a new FontSizeAction.
         *
         * @param nm the action name
         * @param size the font size
         */
        public FontSizeAction(String nm, int size) {
<span class="nc" id="L562">            super(nm);</span>
<span class="nc" id="L563">            this.size = size;</span>
<span class="nc" id="L564">        }</span>

        /**
         * Sets the font size.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L572">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L574">                int size = this.size;</span>
<span class="nc bnc" id="L575" title="All 4 branches missed.">                if ((e != null) &amp;&amp; (e.getSource() == editor)) {</span>
<span class="nc" id="L576">                    String s = e.getActionCommand();</span>
                    try {
<span class="nc" id="L578">                        size = Integer.parseInt(s, 10);</span>
<span class="nc" id="L579">                    } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L580">                    }</span>
                }
<span class="nc bnc" id="L582" title="All 2 branches missed.">                if (size != 0) {</span>
<span class="nc" id="L583">                    MutableAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L584">                    StyleConstants.setFontSize(attr, size);</span>
<span class="nc" id="L585">                    setCharacterAttributes(editor, attr, false);</span>
<span class="nc" id="L586">                } else {</span>
<span class="nc" id="L587">                    UIManager.getLookAndFeel().provideErrorFeedback(editor);</span>
                }
            }
<span class="nc" id="L590">        }</span>

        private int size;
    }

    /**
     * An action to set foreground color.  This sets the
     * &lt;code&gt;StyleConstants.Foreground&lt;/code&gt; attribute for the
     * currently selected range of the target JEditorPane.
     * This is done by calling
     * &lt;code&gt;StyledDocument.setCharacterAttributes&lt;/code&gt;
     * on the styled document associated with the target
     * JEditorPane.
     * &lt;p&gt;
     * If the target text component is specified as the
     * source of the ActionEvent and there is a command string,
     * the command string will be interpreted as the foreground
     * color.  It will be interpreted by called
     * &lt;code&gt;Color.decode&lt;/code&gt;, and should therefore be
     * legal input for that method.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class ForegroundAction extends StyledTextAction {

        /**
         * Creates a new ForegroundAction.
         *
         * @param nm the action name
         * @param fg the foreground color
         */
        public ForegroundAction(String nm, Color fg) {
<span class="nc" id="L629">            super(nm);</span>
<span class="nc" id="L630">            this.fg = fg;</span>
<span class="nc" id="L631">        }</span>

        /**
         * Sets the foreground color.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L639">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L641">                Color fg = this.fg;</span>
<span class="nc bnc" id="L642" title="All 4 branches missed.">                if ((e != null) &amp;&amp; (e.getSource() == editor)) {</span>
<span class="nc" id="L643">                    String s = e.getActionCommand();</span>
                    try {
<span class="nc" id="L645">                        fg = Color.decode(s);</span>
<span class="nc" id="L646">                    } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L647">                    }</span>
                }
<span class="nc bnc" id="L649" title="All 2 branches missed.">                if (fg != null) {</span>
<span class="nc" id="L650">                    MutableAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L651">                    StyleConstants.setForeground(attr, fg);</span>
<span class="nc" id="L652">                    setCharacterAttributes(editor, attr, false);</span>
<span class="nc" id="L653">                } else {</span>
<span class="nc" id="L654">                    UIManager.getLookAndFeel().provideErrorFeedback(editor);</span>
                }
            }
<span class="nc" id="L657">        }</span>

        private Color fg;
    }

    /**
     * An action to set paragraph alignment.  This sets the
     * &lt;code&gt;StyleConstants.Alignment&lt;/code&gt; attribute for the
     * currently selected range of the target JEditorPane.
     * This is done by calling
     * &lt;code&gt;StyledDocument.setParagraphAttributes&lt;/code&gt;
     * on the styled document associated with the target
     * JEditorPane.
     * &lt;p&gt;
     * If the target text component is specified as the
     * source of the ActionEvent and there is a command string,
     * the command string will be interpreted as an integer
     * that should be one of the legal values for the
     * &lt;code&gt;StyleConstants.Alignment&lt;/code&gt; attribute.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class AlignmentAction extends StyledTextAction {

        /**
         * Creates a new AlignmentAction.
         *
         * @param nm the action name
         * @param a the alignment &amp;gt;= 0
         */
        public AlignmentAction(String nm, int a) {
<span class="nc" id="L695">            super(nm);</span>
<span class="nc" id="L696">            this.a = a;</span>
<span class="nc" id="L697">        }</span>

        /**
         * Sets the alignment.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L705">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L706" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L707">                int a = this.a;</span>
<span class="nc bnc" id="L708" title="All 4 branches missed.">                if ((e != null) &amp;&amp; (e.getSource() == editor)) {</span>
<span class="nc" id="L709">                    String s = e.getActionCommand();</span>
                    try {
<span class="nc" id="L711">                        a = Integer.parseInt(s, 10);</span>
<span class="nc" id="L712">                    } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L713">                    }</span>
                }
<span class="nc" id="L715">                MutableAttributeSet attr = new SimpleAttributeSet();</span>
<span class="nc" id="L716">                StyleConstants.setAlignment(attr, a);</span>
<span class="nc" id="L717">                setParagraphAttributes(editor, attr, false);</span>
            }
<span class="nc" id="L719">        }</span>

        private int a;
    }

    /**
     * An action to toggle the bold attribute.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class BoldAction extends StyledTextAction {

        /**
         * Constructs a new BoldAction.
         */
        public BoldAction() {
<span class="nc" id="L742">            super(&quot;font-bold&quot;);</span>
<span class="nc" id="L743">        }</span>

        /**
         * Toggles the bold attribute.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L751">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L753">                StyledEditorKit kit = getStyledEditorKit(editor);</span>
<span class="nc" id="L754">                MutableAttributeSet attr = kit.getInputAttributes();</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">                boolean bold = (StyleConstants.isBold(attr)) ? false : true;</span>
<span class="nc" id="L756">                SimpleAttributeSet sas = new SimpleAttributeSet();</span>
<span class="nc" id="L757">                StyleConstants.setBold(sas, bold);</span>
<span class="nc" id="L758">                setCharacterAttributes(editor, sas, false);</span>
            }
<span class="nc" id="L760">        }</span>
    }

    /**
     * An action to toggle the italic attribute.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class ItalicAction extends StyledTextAction {

        /**
         * Constructs a new ItalicAction.
         */
        public ItalicAction() {
<span class="nc" id="L781">            super(&quot;font-italic&quot;);</span>
<span class="nc" id="L782">        }</span>

        /**
         * Toggles the italic attribute.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L790">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L792">                StyledEditorKit kit = getStyledEditorKit(editor);</span>
<span class="nc" id="L793">                MutableAttributeSet attr = kit.getInputAttributes();</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">                boolean italic = (StyleConstants.isItalic(attr)) ? false : true;</span>
<span class="nc" id="L795">                SimpleAttributeSet sas = new SimpleAttributeSet();</span>
<span class="nc" id="L796">                StyleConstants.setItalic(sas, italic);</span>
<span class="nc" id="L797">                setCharacterAttributes(editor, sas, false);</span>
            }
<span class="nc" id="L799">        }</span>
    }

    /**
     * An action to toggle the underline attribute.
     * &lt;p&gt;
     * &lt;strong&gt;Warning:&lt;/strong&gt;
     * Serialized objects of this class will not be compatible with
     * future Swing releases. The current serialization support is
     * appropriate for short term storage or RMI between applications running
     * the same version of Swing.  As of 1.4, support for long term storage
     * of all JavaBeans&amp;trade;
     * has been added to the &lt;code&gt;java.beans&lt;/code&gt; package.
     * Please see {@link java.beans.XMLEncoder}.
     */
    public static class UnderlineAction extends StyledTextAction {

        /**
         * Constructs a new UnderlineAction.
         */
        public UnderlineAction() {
<span class="nc" id="L820">            super(&quot;font-underline&quot;);</span>
<span class="nc" id="L821">        }</span>

        /**
         * Toggles the Underline attribute.
         *
         * @param e the action event
         */
        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L829">            JEditorPane editor = getEditor(e);</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">            if (editor != null) {</span>
<span class="nc" id="L831">                StyledEditorKit kit = getStyledEditorKit(editor);</span>
<span class="nc" id="L832">                MutableAttributeSet attr = kit.getInputAttributes();</span>
<span class="nc bnc" id="L833" title="All 2 branches missed.">                boolean underline = (StyleConstants.isUnderline(attr)) ? false : true;</span>
<span class="nc" id="L834">                SimpleAttributeSet sas = new SimpleAttributeSet();</span>
<span class="nc" id="L835">                StyleConstants.setUnderline(sas, underline);</span>
<span class="nc" id="L836">                setCharacterAttributes(editor, sas, false);</span>
            }
<span class="nc" id="L838">        }</span>
    }


    /**
     * StyledInsertBreakAction has similar behavior to that of
     * &lt;code&gt;DefaultEditorKit.InsertBreakAction&lt;/code&gt;. That is when
     * its &lt;code&gt;actionPerformed&lt;/code&gt; method is invoked, a newline
     * is inserted. Beyond that, this will reset the input attributes to
     * what they were before the newline was inserted.
     */
    static class StyledInsertBreakAction extends StyledTextAction {
        private SimpleAttributeSet tempSet;

        StyledInsertBreakAction() {
<span class="nc" id="L853">            super(insertBreakAction);</span>
<span class="nc" id="L854">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L857">            JEditorPane target = getEditor(e);</span>

<span class="nc bnc" id="L859" title="All 2 branches missed.">            if (target != null) {</span>
<span class="nc bnc" id="L860" title="All 4 branches missed.">                if ((!target.isEditable()) || (!target.isEnabled())) {</span>
<span class="nc" id="L861">                    UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L862">                    return;</span>
                }
<span class="nc" id="L864">                StyledEditorKit sek = getStyledEditorKit(target);</span>

<span class="nc bnc" id="L866" title="All 2 branches missed.">                if (tempSet != null) {</span>
<span class="nc" id="L867">                    tempSet.removeAttributes(tempSet);</span>
                }
                else {
<span class="nc" id="L870">                    tempSet = new SimpleAttributeSet();</span>
                }
<span class="nc" id="L872">                tempSet.addAttributes(sek.getInputAttributes());</span>
<span class="nc" id="L873">                target.replaceSelection(&quot;\n&quot;);</span>

<span class="nc" id="L875">                MutableAttributeSet ia = sek.getInputAttributes();</span>

<span class="nc" id="L877">                ia.removeAttributes(ia);</span>
<span class="nc" id="L878">                ia.addAttributes(tempSet);</span>
<span class="nc" id="L879">                tempSet.removeAttributes(tempSet);</span>
<span class="nc" id="L880">            }</span>
            else {
                // See if we are in a JTextComponent.
<span class="nc" id="L883">                JTextComponent text = getTextComponent(e);</span>

<span class="nc bnc" id="L885" title="All 2 branches missed.">                if (text != null) {</span>
<span class="nc bnc" id="L886" title="All 4 branches missed.">                    if ((!text.isEditable()) || (!text.isEnabled())) {</span>
<span class="nc" id="L887">                        UIManager.getLookAndFeel().provideErrorFeedback(target);</span>
<span class="nc" id="L888">                        return;</span>
                    }
<span class="nc" id="L890">                    text.replaceSelection(&quot;\n&quot;);</span>
                }
            }
<span class="nc" id="L893">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.4.201312031056</span></div></body></html>